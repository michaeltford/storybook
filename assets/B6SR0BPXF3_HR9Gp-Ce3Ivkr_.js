import{e as Bo,n as U,A as Kt,f as $o,h as Un,j as Wo,m as Go,Z as Vt,P as zo,M as rt,Q as Pt,S as wt}from"./index-ZiyYtj3X.js";import{X as le,Z as Ve}from"./index-DvhsF04y.js";import"./preload-helper-D9Z9MdNV.js";import"./index-J-Hv9Xln.js";import"./iframe-CBk8unIv.js";import"./index-CMiH3ff9.js";import"./index--CXhSu_I.js";import"./client-vjV3QKWK.js";/**
 * @license @sheetxl/sdk - SDK - A high-performance, embeddable spreadsheet engine. - v0.6.6
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */var _s=typeof global=="object"&&global&&global.Object===Object&&global,Ko=typeof self=="object"&&self&&self.Object===Object&&self,ke=_s||Ko||Function("return this")(),ge=ke.Symbol,Ls=Object.prototype,Vo=Ls.hasOwnProperty,Ho=Ls.toString,At=ge?ge.toStringTag:void 0,Yo=Object.prototype.toString,Xr=ge?ge.toStringTag:void 0;function Xe(e){return e==null?e===void 0?"[object Undefined]":"[object Null]":Xr&&Xr in Object(e)?function(t){var n=Vo.call(t,At),r=t[At];try{t[At]=void 0;var i=!0}catch{}var s=Ho.call(t);return i&&(n?t[At]=r:delete t[At]),s}(e):function(t){return Yo.call(t)}(e)}function Oe(e){return e!=null&&typeof e=="object"}function Nn(e){return typeof e=="symbol"||Oe(e)&&Xe(e)=="[object Symbol]"}function Rn(e,t){for(var n=-1,r=e==null?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}var D=Array.isArray,Zr=ge?ge.prototype:void 0,Qr=Zr?Zr.toString:void 0;function xs(e){if(typeof e=="string")return e;if(D(e))return Rn(e,xs)+"";if(Nn(e))return Qr?Qr.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var qo=/\s/,Xo=/^\s+/;function Zo(e){return e&&e.slice(0,function(t){for(var n=t.length;n--&&qo.test(t.charAt(n)););return n}(e)+1).replace(Xo,"")}function Te(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Qo=/^[-+]0x[0-9a-f]+$/i,Jo=/^0b[01]+$/i,ea=/^0o[0-7]+$/i,ta=parseInt,na=1/0;function ra(e){return e?(e=function(t){if(typeof t=="number")return t;if(Nn(t))return NaN;if(Te(t)){var n=typeof t.valueOf=="function"?t.valueOf():t;t=Te(n)?n+"":n}if(typeof t!="string")return t===0?t:+t;t=Zo(t);var r=Jo.test(t);return r||ea.test(t)?ta(t.slice(2),r?2:8):Qo.test(t)?NaN:+t}(e))===na||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:e===0?e:0}function On(e){var t=ra(e),n=t%1;return t==t?n?t-n:t:0}function dt(e){return e}function Ke(e){if(!Te(e))return!1;var t=Xe(e);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"}var Jr,Fn=ke["__core-js_shared__"],ei=(Jr=/[^.]+$/.exec(Fn&&Fn.keys&&Fn.keys.IE_PROTO||""))?"Symbol(src)_1."+Jr:"",ia=Function.prototype.toString;function it(e){if(e!=null){try{return ia.call(e)}catch{}try{return e+""}catch{}}return""}var sa=/^\[object .+?Constructor\]$/,oa=Function.prototype,aa=Object.prototype,ca=oa.toString,ua=aa.hasOwnProperty,la=RegExp("^"+ca.call(ua).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ha(e){return!(!Te(e)||(t=e,ei&&ei in t))&&(Ke(e)?la:sa).test(it(e));var t}function st(e,t){var n=function(r,i){return r?.[i]}(e,t);return ha(n)?n:void 0}var lr=st(ke,"WeakMap"),ti=Object.create,fa=function(){function e(){}return function(t){if(!Te(t))return{};if(ti)return ti(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();function X(){}var da=Date.now,ni,Dn,jn,ln=function(){try{var e=st(Object,"defineProperty");return e({},"",{}),e}catch{}}(),pa=ln?function(e,t){return ln(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:dt,ma=(ni=pa,Dn=0,jn=0,function(){var e=da(),t=16-(e-jn);if(jn=e,t>0){if(++Dn>=800)return arguments[0]}else Dn=0;return ni.apply(void 0,arguments)});function Cs(e,t){for(var n=-1,r=e==null?0:e.length;++n<r&&t(e[n],n,e)!==!1;);return e}function ks(e,t,n,r){for(var i=e.length,s=n+-1;++s<i;)if(t(e[s],s,e))return s;return-1}function Ea(e){return e!=e}function Sr(e,t,n){return t==t?function(r,i,s){for(var o=s-1,a=r.length;++o<a;)if(r[o]===i)return o;return-1}(e,t,n):ks(e,Ea,n)}function bs(e,t){return!!(e!=null&&e.length)&&Sr(e,t,0)>-1}var ga=/^(?:0|[1-9]\d*)$/;function yn(e,t){var n=typeof e;return!!(t=t??9007199254740991)&&(n=="number"||n!="symbol"&&ga.test(e))&&e>-1&&e%1==0&&e<t}function _r(e,t,n){t=="__proto__"&&ln?ln(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Bt(e,t){return e===t||e!=e&&t!=t}var Ta=Object.prototype.hasOwnProperty;function vn(e,t,n){var r=e[t];Ta.call(e,t)&&Bt(r,n)&&(n!==void 0||t in e)||_r(e,t,n)}function hr(e,t,n,r){var i=!n;n||(n={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=e[a]),i?_r(n,a,c):vn(n,a,c)}return n}var ri=Math.max;function Lr(e,t){return ma(function(n,r,i){return r=ri(r===void 0?n.length-1:r,0),function(){for(var s=arguments,o=-1,a=ri(s.length-r,0),c=Array(a);++o<a;)c[o]=s[r+o];o=-1;for(var u=Array(r+1);++o<r;)u[o]=s[o];return u[r]=i(c),function(l,f,h){switch(h.length){case 0:return l.call(f);case 1:return l.call(f,h[0]);case 2:return l.call(f,h[0],h[1]);case 3:return l.call(f,h[0],h[1],h[2])}return l.apply(f,h)}(n,this,u)}}(e,t,dt),e+"")}function xr(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=9007199254740991}function be(e){return e!=null&&xr(e.length)&&!Ke(e)}function Ps(e,t,n){if(!Te(n))return!1;var r=typeof t;return!!(r=="number"?be(n)&&yn(t,n.length):r=="string"&&t in n)&&Bt(n[t],e)}var Aa=Object.prototype;function $t(e){var t=e&&e.constructor;return e===(typeof t=="function"&&t.prototype||Aa)}function ii(e){return Oe(e)&&Xe(e)=="[object Arguments]"}var ws=Object.prototype,Ia=ws.hasOwnProperty,Na=ws.propertyIsEnumerable,Sn=ii(function(){return arguments}())?ii:function(e){return Oe(e)&&Ia.call(e,"callee")&&!Na.call(e,"callee")},Ms=typeof exports=="object"&&exports&&!exports.nodeType&&exports,si=Ms&&typeof module=="object"&&module&&!module.nodeType&&module,oi=si&&si.exports===Ms?ke.Buffer:void 0,Mt=(oi?oi.isBuffer:void 0)||function(){return!1},z={};function _n(e){return function(t){return e(t)}}z["[object Float32Array]"]=z["[object Float64Array]"]=z["[object Int8Array]"]=z["[object Int16Array]"]=z["[object Int32Array]"]=z["[object Uint8Array]"]=z["[object Uint8ClampedArray]"]=z["[object Uint16Array]"]=z["[object Uint32Array]"]=!0,z["[object Arguments]"]=z["[object Array]"]=z["[object ArrayBuffer]"]=z["[object Boolean]"]=z["[object DataView]"]=z["[object Date]"]=z["[object Error]"]=z["[object Function]"]=z["[object Map]"]=z["[object Number]"]=z["[object Object]"]=z["[object RegExp]"]=z["[object Set]"]=z["[object String]"]=z["[object WeakMap]"]=!1;var Us=typeof exports=="object"&&exports&&!exports.nodeType&&exports,Lt=Us&&typeof module=="object"&&module&&!module.nodeType&&module,Bn=Lt&&Lt.exports===Us&&_s.process,Ye=function(){try{var e=Lt&&Lt.require&&Lt.require("util").types;return e||Bn&&Bn.binding&&Bn.binding("util")}catch{}}(),ai=Ye&&Ye.isTypedArray,Cr=ai?_n(ai):function(e){return Oe(e)&&xr(e.length)&&!!z[Xe(e)]},Ra=Object.prototype.hasOwnProperty;function Fs(e,t){var n=D(e),r=!n&&Sn(e),i=!n&&!r&&Mt(e),s=!n&&!r&&!i&&Cr(e),o=n||r||i||s,a=o?function(l,f){for(var h=-1,m=Array(l);++h<l;)m[h]=f(h);return m}(e.length,String):[],c=a.length;for(var u in e)!t&&!Ra.call(e,u)||o&&(u=="length"||i&&(u=="offset"||u=="parent")||s&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||yn(u,c))||a.push(u);return a}function Ds(e,t){return function(n){return e(t(n))}}var Oa=Ds(Object.keys,Object),ya=Object.prototype.hasOwnProperty;function js(e){if(!$t(e))return Oa(e);var t=[];for(var n in Object(e))ya.call(e,n)&&n!="constructor"&&t.push(n);return t}function Ae(e){return be(e)?Fs(e):js(e)}var $n,va=Object.prototype.hasOwnProperty,he=($n=function(e,t){if($t(t)||be(t))hr(t,Ae(t),e);else for(var n in t)va.call(t,n)&&vn(e,n,t[n])},Lr(function(e,t){var n=-1,r=t.length,i=r>1?t[r-1]:void 0,s=r>2?t[2]:void 0;for(i=$n.length>3&&typeof i=="function"?(r--,i):void 0,s&&Ps(t[0],t[1],s)&&(i=r<3?void 0:i,r=1),e=Object(e);++n<r;){var o=t[n];o&&$n(e,o,n,i)}return e})),Sa=Object.prototype.hasOwnProperty;function _a(e){if(!Te(e))return function(i){var s=[];if(i!=null)for(var o in Object(i))s.push(o);return s}(e);var t=$t(e),n=[];for(var r in e)(r!="constructor"||!t&&Sa.call(e,r))&&n.push(r);return n}function Bs(e){return be(e)?Fs(e,!0):_a(e)}var La=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,xa=/^\w*$/;function kr(e,t){if(D(e))return!1;var n=typeof e;return!(n!="number"&&n!="symbol"&&n!="boolean"&&e!=null&&!Nn(e))||xa.test(e)||!La.test(e)||t!=null&&e in Object(t)}var It=st(Object,"create"),Ca=Object.prototype.hasOwnProperty,ka=Object.prototype.hasOwnProperty;function Je(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ht(e,t){for(var n=e.length;n--;)if(Bt(e[n][0],t))return n;return-1}Je.prototype.clear=function(){this.__data__=It?It(null):{},this.size=0},Je.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Je.prototype.get=function(e){var t=this.__data__;if(It){var n=t[e];return n==="__lodash_hash_undefined__"?void 0:n}return Ca.call(t,e)?t[e]:void 0},Je.prototype.has=function(e){var t=this.__data__;return It?t[e]!==void 0:ka.call(t,e)},Je.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=It&&t===void 0?"__lodash_hash_undefined__":t,this};var ba=Array.prototype.splice;function $e(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}$e.prototype.clear=function(){this.__data__=[],this.size=0},$e.prototype.delete=function(e){var t=this.__data__,n=Ht(t,e);return!(n<0)&&(n==t.length-1?t.pop():ba.call(t,n,1),--this.size,!0)},$e.prototype.get=function(e){var t=this.__data__,n=Ht(t,e);return n<0?void 0:t[n][1]},$e.prototype.has=function(e){return Ht(this.__data__,e)>-1},$e.prototype.set=function(e,t){var n=this.__data__,r=Ht(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};var Ut=st(ke,"Map");function Yt(e,t){var n,r,i=e.__data__;return((r=typeof(n=t))=="string"||r=="number"||r=="symbol"||r=="boolean"?n!=="__proto__":n===null)?i[typeof t=="string"?"string":"hash"]:i.map}function We(e){var t=-1,n=e==null?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}We.prototype.clear=function(){this.size=0,this.__data__={hash:new Je,map:new(Ut||$e),string:new Je}},We.prototype.delete=function(e){var t=Yt(this,e).delete(e);return this.size-=t?1:0,t},We.prototype.get=function(e){return Yt(this,e).get(e)},We.prototype.has=function(e){return Yt(this,e).has(e)},We.prototype.set=function(e,t){var n=Yt(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function br(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var n=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=n.cache;if(s.has(i))return s.get(i);var o=e.apply(this,r);return n.cache=s.set(i,o)||s,o};return n.cache=new(br.Cache||We),n}br.Cache=We;var Pa=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,wa=/\\(\\)?/g,Ma=function(e){var t=br(e,function(r){return n.size===500&&n.clear(),r}),n=t.cache;return t}(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(Pa,function(n,r,i,s){t.push(i?s.replace(wa,"$1"):r||n)}),t});function Ln(e,t){return D(e)?e:kr(e,t)?[e]:Ma(function(n){return n==null?"":xs(n)}(e))}function Wt(e){if(typeof e=="string"||Nn(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}function Pr(e,t){for(var n=0,r=(t=Ln(t,e)).length;e!=null&&n<r;)e=e[Wt(t[n++])];return n&&n==r?e:void 0}function wr(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}var ci=ge?ge.isConcatSpreadable:void 0;function Ua(e){return D(e)||Sn(e)||!!(ci&&e&&e[ci])}function Mr(e,t,n,r,i){var s=-1,o=e.length;for(n||(n=Ua),i||(i=[]);++s<o;){var a=e[s];n(a)?wr(i,a):r||(i[i.length]=a)}return i}function Ne(e){return e!=null&&e.length?Mr(e):[]}var $s=Ds(Object.getPrototypeOf,Object);function Ws(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var s=Array(i);++r<i;)s[r]=e[r+t];return s}function Fa(e,t,n,r){var i=-1,s=e==null?0:e.length;for(r&&s&&(n=e[++i]);++i<s;)n=t(n,e[i],i,e);return n}function xe(e){var t=this.__data__=new $e(e);this.size=t.size}xe.prototype.clear=function(){this.__data__=new $e,this.size=0},xe.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},xe.prototype.get=function(e){return this.__data__.get(e)},xe.prototype.has=function(e){return this.__data__.has(e)},xe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof $e){var r=n.__data__;if(!Ut||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new We(r)}return n.set(e,t),this.size=n.size,this};var Gs=typeof exports=="object"&&exports&&!exports.nodeType&&exports,ui=Gs&&typeof module=="object"&&module&&!module.nodeType&&module,li=ui&&ui.exports===Gs?ke.Buffer:void 0,hi=li?li.allocUnsafe:void 0;function Ur(e,t){for(var n=-1,r=e==null?0:e.length,i=0,s=[];++n<r;){var o=e[n];t(o,n,e)&&(s[i++]=o)}return s}function zs(){return[]}var Da=Object.prototype.propertyIsEnumerable,fi=Object.getOwnPropertySymbols,Fr=fi?function(e){return e==null?[]:(e=Object(e),Ur(fi(e),function(t){return Da.call(e,t)}))}:zs,ja=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)wr(t,Fr(e)),e=$s(e);return t}:zs;function Ks(e,t,n){var r=t(e);return D(e)?r:wr(r,n(e))}function fr(e){return Ks(e,Ae,Fr)}var dr=st(ke,"DataView"),pr=st(ke,"Promise"),ht=st(ke,"Set"),di="[object Map]",pi="[object Promise]",mi="[object Set]",Ei="[object WeakMap]",gi="[object DataView]",Ba=it(dr),$a=it(Ut),Wa=it(pr),Ga=it(ht),za=it(lr),me=Xe;(dr&&me(new dr(new ArrayBuffer(1)))!=gi||Ut&&me(new Ut)!=di||pr&&me(pr.resolve())!=pi||ht&&me(new ht)!=mi||lr&&me(new lr)!=Ei)&&(me=function(e){var t=Xe(e),n=t=="[object Object]"?e.constructor:void 0,r=n?it(n):"";if(r)switch(r){case Ba:return gi;case $a:return di;case Wa:return pi;case Ga:return mi;case za:return Ei}return t});var Ka=Object.prototype.hasOwnProperty,hn=ke.Uint8Array,Va=/\w*$/,Ti=ge?ge.prototype:void 0,Ai=Ti?Ti.valueOf:void 0;function Ha(e,t,n){var r,i,s,o,a,c=e.constructor;switch(t){case"[object ArrayBuffer]":return a=new(o=e).constructor(o.byteLength),new hn(a).set(new hn(o)),a;case"[object Boolean]":case"[object Date]":return new c(+e);case"[object DataView]":return s=(i=e).buffer,new i.constructor(s,i.byteOffset,i.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(u){var l=u.buffer;return new u.constructor(l,u.byteOffset,u.length)}(e);case"[object Map]":case"[object Set]":return new c;case"[object Number]":case"[object String]":return new c(e);case"[object RegExp]":return function(u){var l=new u.constructor(u.source,Va.exec(u));return l.lastIndex=u.lastIndex,l}(e);case"[object Symbol]":return r=e,Ai?Object(Ai.call(r)):{}}}var Ii=Ye&&Ye.isMap,Ya=Ii?_n(Ii):function(e){return Oe(e)&&me(e)=="[object Map]"},Ni=Ye&&Ye.isSet,qa=Ni?_n(Ni):function(e){return Oe(e)&&me(e)=="[object Set]"},Vs="[object Arguments]",Hs="[object Function]",Ys="[object Object]",W={};function nn(e,t,n,r,i,s){var o;if(o!==void 0)return o;if(!Te(e))return e;var a=D(e);if(a)return o=function(h){var m=h.length,g=new h.constructor(m);return m&&typeof h[0]=="string"&&Ka.call(h,"index")&&(g.index=h.index,g.input=h.input),g}(e),function(h,m){var g=-1,N=h.length;for(m||(m=Array(N));++g<N;)m[g]=h[g];return m}(e,o);var c=me(e),u=c==Hs||c=="[object GeneratorFunction]";if(Mt(e))return function(h){var m=h.length,g=hi?hi(m):new h.constructor(m);return h.copy(g),g}(e);if(c==Ys||c==Vs||u&&!i)return o=u?{}:function(h){return typeof h.constructor!="function"||$t(h)?{}:fa($s(h))}(e),function(h,m){return hr(h,Fr(h),m)}(e,function(h,m){return h&&hr(m,Ae(m),h)}(o,e));if(!W[c])return i?e:{};o=Ha(e,c),s||(s=new xe);var l=s.get(e);if(l)return l;s.set(e,o),qa(e)?e.forEach(function(h){o.add(nn(h,t,n,h,e,s))}):Ya(e)&&e.forEach(function(h,m){o.set(m,nn(h,t,n,m,e,s))});var f=a?void 0:fr(e);return Cs(f||e,function(h,m){f&&(h=e[m=h]),vn(o,m,nn(h,t,n,m,e,s))}),o}W[Vs]=W["[object Array]"]=W["[object ArrayBuffer]"]=W["[object DataView]"]=W["[object Boolean]"]=W["[object Date]"]=W["[object Float32Array]"]=W["[object Float64Array]"]=W["[object Int8Array]"]=W["[object Int16Array]"]=W["[object Int32Array]"]=W["[object Map]"]=W["[object Number]"]=W[Ys]=W["[object RegExp]"]=W["[object Set]"]=W["[object String]"]=W["[object Symbol]"]=W["[object Uint8Array]"]=W["[object Uint8ClampedArray]"]=W["[object Uint16Array]"]=W["[object Uint32Array]"]=!0,W["[object Error]"]=W[Hs]=W["[object WeakMap]"]=!1;function ee(e){return nn(e,4)}function Gt(e){for(var t=-1,n=e==null?0:e.length,r=0,i=[];++t<n;){var s=e[t];s&&(i[r++]=s)}return i}function ft(e){var t=-1,n=e==null?0:e.length;for(this.__data__=new We;++t<n;)this.add(e[t])}function qs(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function Dr(e,t){return e.has(t)}ft.prototype.add=ft.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},ft.prototype.has=function(e){return this.__data__.has(e)};function Ri(e,t,n,r,i,s){var o=1&n,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var u=s.get(e),l=s.get(t);if(u&&l)return u==t&&l==e;var f=-1,h=!0,m=2&n?new ft:void 0;for(s.set(e,t),s.set(t,e);++f<a;){var g=e[f],N=t[f];if(r)var S=o?r(N,g,f,t,e,s):r(g,N,f,e,t,s);if(S!==void 0){if(S)continue;h=!1;break}if(m){if(!qs(t,function(E,p){if(!Dr(m,p)&&(g===E||i(g,E,n,r,s)))return m.push(p)})){h=!1;break}}else if(g!==N&&!i(g,N,n,r,s)){h=!1;break}}return s.delete(e),s.delete(t),h}function Xa(e){var t=-1,n=Array(e.size);return e.forEach(function(r,i){n[++t]=[i,r]}),n}function jr(e){var t=-1,n=Array(e.size);return e.forEach(function(r){n[++t]=r}),n}var Oi=ge?ge.prototype:void 0,Wn=Oi?Oi.valueOf:void 0,Za=Object.prototype.hasOwnProperty,yi="[object Arguments]",vi="[object Array]",qt="[object Object]",Si=Object.prototype.hasOwnProperty;function Qa(e,t,n,r,i,s){var o=D(e),a=D(t),c=o?vi:me(e),u=a?vi:me(t),l=(c=c==yi?qt:c)==qt,f=(u=u==yi?qt:u)==qt,h=c==u;if(h&&Mt(e)){if(!Mt(t))return!1;o=!0,l=!1}if(h&&!l)return s||(s=new xe),o||Cr(e)?Ri(e,t,n,r,i,s):function(E,p,d,T,v,A,y){switch(d){case"[object DataView]":if(E.byteLength!=p.byteLength||E.byteOffset!=p.byteOffset)return!1;E=E.buffer,p=p.buffer;case"[object ArrayBuffer]":return!(E.byteLength!=p.byteLength||!A(new hn(E),new hn(p)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Bt(+E,+p);case"[object Error]":return E.name==p.name&&E.message==p.message;case"[object RegExp]":case"[object String]":return E==p+"";case"[object Map]":var R=Xa;case"[object Set]":var I=1&T;if(R||(R=jr),E.size!=p.size&&!I)return!1;var O=y.get(E);if(O)return O==p;T|=2,y.set(E,p);var M=Ri(R(E),R(p),T,v,A,y);return y.delete(E),M;case"[object Symbol]":if(Wn)return Wn.call(E)==Wn.call(p)}return!1}(e,t,c,n,r,i,s);if(!(1&n)){var m=l&&Si.call(e,"__wrapped__"),g=f&&Si.call(t,"__wrapped__");if(m||g){var N=m?e.value():e,S=g?t.value():t;return s||(s=new xe),i(N,S,n,r,s)}}return!!h&&(s||(s=new xe),function(E,p,d,T,v,A){var y=1&d,R=fr(E),I=R.length;if(I!=fr(p).length&&!y)return!1;for(var O=I;O--;){var M=R[O];if(!(y?M in p:Za.call(p,M)))return!1}var w=A.get(E),F=A.get(p);if(w&&F)return w==p&&F==E;var $=!0;A.set(E,p),A.set(p,E);for(var x=y;++O<I;){var C=E[M=R[O]],j=p[M];if(T)var Y=y?T(j,C,M,p,E,A):T(C,j,M,E,p,A);if(!(Y===void 0?C===j||v(C,j,d,T,A):Y)){$=!1;break}x||(x=M=="constructor")}if($&&!x){var B=E.constructor,te=p.constructor;B==te||!("constructor"in E)||!("constructor"in p)||typeof B=="function"&&B instanceof B&&typeof te=="function"&&te instanceof te||($=!1)}return A.delete(E),A.delete(p),$}(e,t,n,r,i,s))}function Br(e,t,n,r,i){return e===t||(e==null||t==null||!Oe(e)&&!Oe(t)?e!=e&&t!=t:Qa(e,t,n,r,Br,i))}function Xs(e){return e==e&&!Te(e)}function Zs(e,t){return function(n){return n!=null&&n[e]===t&&(t!==void 0||e in Object(n))}}function Ja(e){var t=function(n){for(var r=Ae(n),i=r.length;i--;){var s=r[i],o=n[s];r[i]=[s,o,Xs(o)]}return r}(e);return t.length==1&&t[0][2]?Zs(t[0][0],t[0][1]):function(n){return n===e||function(r,i,s,o){var a=s.length,c=a;if(r==null)return!c;for(r=Object(r);a--;){var u=s[a];if(u[2]?u[1]!==r[u[0]]:!(u[0]in r))return!1}for(;++a<c;){var l=(u=s[a])[0],f=r[l],h=u[1];if(u[2]){if(f===void 0&&!(l in r))return!1}else if(!Br(h,f,3,o,new xe))return!1}return!0}(n,0,t)}}function ec(e,t){return e!=null&&t in Object(e)}function Qs(e,t,n){for(var r=-1,i=(t=Ln(t,e)).length,s=!1;++r<i;){var o=Wt(t[r]);if(!(s=e!=null&&n(e,o)))break;e=e[o]}return s||++r!=i?s:!!(i=e==null?0:e.length)&&xr(i)&&yn(o,i)&&(D(e)||Sn(e))}function tc(e,t){return kr(e)&&Xs(t)?Zs(Wt(e),t):function(n){var r=function(i,s,o){var a=i==null?void 0:Pr(i,s);return a===void 0?o:a}(n,e);return r===void 0&&r===t?function(i,s){return i!=null&&Qs(i,s,ec)}(n,e):Br(t,r,3)}}function nc(e){return kr(e)?(t=Wt(e),function(n){return n?.[t]}):function(n){return function(r){return Pr(r,n)}}(e);var t}function Ce(e){return typeof e=="function"?e:e==null?dt:typeof e=="object"?D(e)?tc(e[0],e[1]):Ja(e):nc(e)}function rc(e,t,n,r){for(var i=-1,s=e==null?0:e.length;++i<s;){var o=e[i];t(r,o,n(o),e)}return r}var ic=function(e,t,n){for(var r=-1,i=Object(e),s=n(e),o=s.length;o--;){var a=s[++r];if(t(i[a],a,i)===!1)break}return e},_i,ot=(_i=function(e,t){return e&&ic(e,t,Ae)},function(e,t){if(e==null)return e;if(!be(e))return _i(e,t);for(var n=e.length,r=-1,i=Object(e);++r<n&&t(i[r],r,i)!==!1;);return e});function sc(e,t,n,r){return ot(e,function(i,s,o){t(r,i,n(i),o)}),r}var Js=Object.prototype,oc=Js.hasOwnProperty,$r=Lr(function(e,t){e=Object(e);var n=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&Ps(t[0],t[1],i)&&(r=1);++n<r;)for(var s=t[n],o=Bs(s),a=-1,c=o.length;++a<c;){var u=o[a],l=e[u];(l===void 0||Bt(l,Js[u])&&!oc.call(e,u))&&(e[u]=s[u])}return e});function Li(e){return Oe(e)&&be(e)}var fn=Lr(function(e,t){return Li(e)?function(n,r,i,s){var o=-1,a=bs,c=!0,u=n.length,l=[],f=r.length;if(!u)return l;r.length>=200&&(a=Dr,c=!1,r=new ft(r));e:for(;++o<u;){var h=n[o],m=h;if(h=h!==0?h:0,c&&m==m){for(var g=f;g--;)if(r[g]===m)continue e;l.push(h)}else a(r,m,s)||l.push(h)}return l}(e,Mr(t,0,Li,!0)):[]});function pt(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function J(e,t,n){var r=e==null?0:e.length;return r?Ws(e,(t=t===void 0?1:On(t))<0?0:t,r):[]}function Ft(e,t,n){var r=e==null?0:e.length;return r?Ws(e,0,(t=r-(t=t===void 0?1:On(t)))<0?0:t):[]}function k(e,t){var n;return(D(e)?Cs:ot)(e,typeof(n=t)=="function"?n:dt)}function ac(e,t){for(var n=-1,r=e==null?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function cc(e,t){var n=!0;return ot(e,function(r,i,s){return n=!!t(r,i,s)}),n}function Re(e,t,n){return(D(e)?ac:cc)(e,Ce(t))}function eo(e,t){var n=[];return ot(e,function(r,i,s){t(r,i,s)&&n.push(r)}),n}function pe(e,t){return(D(e)?Ur:eo)(e,Ce(t))}var uc=Math.max,xi,mt=(xi=function(e,t,n){var r=e==null?0:e.length;if(!r)return-1;var i=n==null?0:On(n);return i<0&&(i=uc(r+i,0)),ks(e,Ce(t),i)},function(e,t,n){var r=Object(e);if(!be(e)){var i=Ce(t);e=Ae(e),t=function(o){return i(r[o],o,r)}}var s=xi(e,t,n);return s>-1?r[i?e[s]:s]:void 0});function ye(e){return e&&e.length?e[0]:void 0}function lc(e,t){var n=-1,r=be(e)?Array(e.length):[];return ot(e,function(i,s,o){r[++n]=t(i,s,o)}),r}function _(e,t){return(D(e)?Rn:lc)(e,Ce(t))}function Ee(e,t){return Mr(_(e,t))}var Ci,hc=Object.prototype.hasOwnProperty,fc=(Ci=function(e,t,n){hc.call(e,n)?e[n].push(t):_r(e,n,[t])},function(e,t){var n=D(e)?rc:sc,r={};return n(e,Ci,Ce(t),r)}),dc=Object.prototype.hasOwnProperty;function pc(e,t){return e!=null&&dc.call(e,t)}function L(e,t){return e!=null&&Qs(e,t,pc)}function ae(e){return typeof e=="string"||!D(e)&&Oe(e)&&Xe(e)=="[object String]"}function Z(e){return e==null?[]:function(t,n){return Rn(n,function(r){return t[r]})}(e,Ae(e))}var mc=Math.max;function ie(e,t,n,r){e=be(e)?e:Z(e),n=n?On(n):0;var i=e.length;return n<0&&(n=mc(i+n,0)),ae(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&Sr(e,t,n)>-1}function ki(e,t,n){return e!=null&&e.length?Sr(e,t,0):-1}var Ec=Object.prototype.hasOwnProperty;function G(e){if(e==null)return!0;if(be(e)&&(D(e)||typeof e=="string"||typeof e.splice=="function"||Mt(e)||Cr(e)||Sn(e)))return!e.length;var t=me(e);if(t=="[object Map]"||t=="[object Set]")return!e.size;if($t(e))return!js(e).length;for(var n in e)if(Ec.call(e,n))return!1;return!0}var bi=Ye&&Ye.isRegExp,Ge=bi?_n(bi):function(e){return Oe(e)&&Xe(e)=="[object RegExp]"};function ze(e){return e===void 0}function gc(e,t,n,r){if(!Te(e))return e;for(var i=-1,s=(t=Ln(t,e)).length,o=s-1,a=e;a!=null&&++i<s;){var c=Wt(t[i]),u=n;if(c==="__proto__"||c==="constructor"||c==="prototype")return e;if(i!=o){var l=a[c];(u=void 0)==null&&(u=Te(l)?l:yn(t[i+1])?[]:{})}vn(a,c,u),a=a[c]}return e}function ve(e,t){if(e==null)return{};var n=Rn(function(r){return Ks(r,Bs,ja)}(e),function(r){return[r]});return t=Ce(t),function(r,i,s){for(var o=-1,a=i.length,c={};++o<a;){var u=i[o],l=Pr(r,u);s(l,u)&&gc(c,Ln(u,r),l)}return c}(e,n,function(r,i){return t(r,i[0])})}function Tc(e,t,n,r,i){return i(e,function(s,o,a){n=r?(r=!1,s):t(n,s,o,a)}),n}function fe(e,t,n){var r=D(e)?Fa:Tc,i=arguments.length<3;return r(e,Ce(t),n,i,ot)}function xn(e,t){return(D(e)?Ur:eo)(e,function(n){if(typeof n!="function")throw new TypeError("Expected a function");return function(){var r=arguments;switch(r.length){case 0:return!n.call(this);case 1:return!n.call(this,r[0]);case 2:return!n.call(this,r[0],r[1]);case 3:return!n.call(this,r[0],r[1],r[2])}return!n.apply(this,r)}}(Ce(t)))}function Ac(e,t){var n;return ot(e,function(r,i,s){return!(n=t(r,i,s))}),!!n}function to(e,t,n){return(D(e)?qs:Ac)(e,Ce(t))}var Ic=ht&&1/jr(new ht([,-0]))[1]==1/0?function(e){return new ht(e)}:X;function mr(e){return e&&e.length?function(t,n,r){var i=-1,s=bs,o=t.length,a=!0,c=[],u=c;if(o>=200){var l=Ic(t);if(l)return jr(l);a=!1,s=Dr,u=new ft}else u=c;e:for(;++i<o;){var f=t[i],h=f;if(f=f!==0?f:0,a&&h==h){for(var m=u.length;m--;)if(u[m]===h)continue e;c.push(f)}else s(u,h,r)||(u!==c&&u.push(h),c.push(f))}return c}(e):[]}function Er(e){console&&console.error&&console.error(`Error: ${e}`)}function no(e){console&&console.warn&&console.warn(`Warning: ${e}`)}function ro(e){const t=new Date().getTime(),n=e();return{time:new Date().getTime()-t,value:n}}function io(e){function t(){}t.prototype=e;const n=new t;function r(){return typeof n.bar}return r(),r(),e}function Nc(e){return ae((t=e).LABEL)&&t.LABEL!==""?e.LABEL:e.name;var t}class Pe{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){this._definition=t}accept(t){t.visit(this),k(this.definition,n=>{n.accept(t)})}}class de extends Pe{constructor(t){super([]),this.idx=1,he(this,ve(t,n=>n!==void 0))}set definition(t){}get definition(){return this.referencedRule!==void 0?this.referencedRule.definition:[]}accept(t){t.visit(this)}}class Et extends Pe{constructor(t){super(t.definition),this.orgText="",he(this,ve(t,n=>n!==void 0))}}class ue extends Pe{constructor(t){super(t.definition),this.ignoreAmbiguities=!1,he(this,ve(t,n=>n!==void 0))}}class ce extends Pe{constructor(t){super(t.definition),this.idx=1,he(this,ve(t,n=>n!==void 0))}}class we extends Pe{constructor(t){super(t.definition),this.idx=1,he(this,ve(t,n=>n!==void 0))}}class Me extends Pe{constructor(t){super(t.definition),this.idx=1,he(this,ve(t,n=>n!==void 0))}}class Q extends Pe{constructor(t){super(t.definition),this.idx=1,he(this,ve(t,n=>n!==void 0))}}class Se extends Pe{constructor(t){super(t.definition),this.idx=1,he(this,ve(t,n=>n!==void 0))}}class _e extends Pe{get definition(){return this._definition}set definition(t){this._definition=t}constructor(t){super(t.definition),this.idx=1,this.ignoreAmbiguities=!1,this.hasPredicates=!1,he(this,ve(t,n=>n!==void 0))}}class K{constructor(t){this.idx=1,he(this,ve(t,n=>n!==void 0))}accept(t){t.visit(this)}}function rn(e){function t(n){return _(n,rn)}if(e instanceof de){const n={type:"NonTerminal",name:e.nonTerminalName,idx:e.idx};return ae(e.label)&&(n.label=e.label),n}if(e instanceof ue)return{type:"Alternative",definition:t(e.definition)};if(e instanceof ce)return{type:"Option",idx:e.idx,definition:t(e.definition)};if(e instanceof we)return{type:"RepetitionMandatory",idx:e.idx,definition:t(e.definition)};if(e instanceof Me)return{type:"RepetitionMandatoryWithSeparator",idx:e.idx,separator:rn(new K({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Se)return{type:"RepetitionWithSeparator",idx:e.idx,separator:rn(new K({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof Q)return{type:"Repetition",idx:e.idx,definition:t(e.definition)};if(e instanceof _e)return{type:"Alternation",idx:e.idx,definition:t(e.definition)};if(e instanceof K){const n={type:"Terminal",name:e.terminalType.name,label:Nc(e.terminalType),idx:e.idx};ae(e.label)&&(n.terminalLabel=e.label);const r=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(n.pattern=Ge(r)?r.source:r),n}if(e instanceof Et)return{type:"Rule",name:e.name,orgText:e.orgText,definition:t(e.definition)};throw Error("non exhaustive match")}class gt{visit(t){const n=t;switch(n.constructor){case de:return this.visitNonTerminal(n);case ue:return this.visitAlternative(n);case ce:return this.visitOption(n);case we:return this.visitRepetitionMandatory(n);case Me:return this.visitRepetitionMandatoryWithSeparator(n);case Se:return this.visitRepetitionWithSeparator(n);case Q:return this.visitRepetition(n);case _e:return this.visitAlternation(n);case K:return this.visitTerminal(n);case Et:return this.visitRule(n);default:throw Error("non exhaustive match")}}visitNonTerminal(t){}visitAlternative(t){}visitOption(t){}visitRepetition(t){}visitRepetitionMandatory(t){}visitRepetitionMandatoryWithSeparator(t){}visitRepetitionWithSeparator(t){}visitAlternation(t){}visitTerminal(t){}visitRule(t){}}function dn(e,t=[]){return e instanceof ce||e instanceof Q||e instanceof Se||(e instanceof _e?to(e.definition,n=>dn(n,t)):!(e instanceof de&&ie(t,e))&&e instanceof Pe&&(e instanceof de&&t.push(e),Re(e.definition,n=>dn(n,t))))}function Le(e){if(e instanceof de)return"SUBRULE";if(e instanceof ce)return"OPTION";if(e instanceof _e)return"OR";if(e instanceof we)return"AT_LEAST_ONE";if(e instanceof Me)return"AT_LEAST_ONE_SEP";if(e instanceof Se)return"MANY_SEP";if(e instanceof Q)return"MANY";if(e instanceof K)return"CONSUME";throw Error("non exhaustive match")}class Cn{walk(t,n=[]){k(t.definition,(r,i)=>{const s=J(t.definition,i+1);if(r instanceof de)this.walkProdRef(r,s,n);else if(r instanceof K)this.walkTerminal(r,s,n);else if(r instanceof ue)this.walkFlat(r,s,n);else if(r instanceof ce)this.walkOption(r,s,n);else if(r instanceof we)this.walkAtLeastOne(r,s,n);else if(r instanceof Me)this.walkAtLeastOneSep(r,s,n);else if(r instanceof Se)this.walkManySep(r,s,n);else if(r instanceof Q)this.walkMany(r,s,n);else{if(!(r instanceof _e))throw Error("non exhaustive match");this.walkOr(r,s,n)}})}walkTerminal(t,n,r){}walkProdRef(t,n,r){}walkFlat(t,n,r){const i=n.concat(r);this.walk(t,i)}walkOption(t,n,r){const i=n.concat(r);this.walk(t,i)}walkAtLeastOne(t,n,r){const i=[new ce({definition:t.definition})].concat(n,r);this.walk(t,i)}walkAtLeastOneSep(t,n,r){const i=Pi(t,n,r);this.walk(t,i)}walkMany(t,n,r){const i=[new ce({definition:t.definition})].concat(n,r);this.walk(t,i)}walkManySep(t,n,r){const i=Pi(t,n,r);this.walk(t,i)}walkOr(t,n,r){const i=n.concat(r);k(t.definition,s=>{const o=new ue({definition:[s]});this.walk(o,i)})}}function Pi(e,t,n){return[new ce({definition:[new K({terminalType:e.separator})].concat(e.definition)})].concat(t,n)}function xt(e){if(e instanceof de)return xt(e.referencedRule);if(e instanceof K)return[e.terminalType];if(function(t){return t instanceof ue||t instanceof ce||t instanceof Q||t instanceof we||t instanceof Me||t instanceof Se||t instanceof K||t instanceof Et}(e))return function(t){let n=[];const r=t.definition;let i,s=0,o=r.length>s,a=!0;for(;o&&a;)i=r[s],a=dn(i),n=n.concat(xt(i)),s+=1,o=r.length>s;return mr(n)}(e);if(function(t){return t instanceof _e}(e))return function(t){const n=_(t.definition,r=>xt(r));return mr(Ne(n))}(e);throw Error("non exhaustive match")}const so="_~IN~_";class Rc extends Cn{constructor(t){super(),this.topProd=t,this.follows={}}startWalking(){return this.walk(this.topProd),this.follows}walkTerminal(t,n,r){}walkProdRef(t,n,r){const i=(s=t.referencedRule,o=t.idx,s.name+o+so+this.topProd.name);var s,o;const a=n.concat(r),c=xt(new ue({definition:a}));this.follows[i]=c}}function b(e){return e.charCodeAt(0)}function Gn(e,t){Array.isArray(e)?e.forEach(function(n){t.push(n)}):t.push(e)}function Nt(e,t){if(e[t]===!0)throw"duplicate flag "+t;e[t],e[t]=!0}function at(e){if(e===void 0)throw Error("Internal Error - Should never get here!");return!0}function wi(e){return e.type==="Character"}const pn=[];for(let e=b("0");e<=b("9");e++)pn.push(e);const mn=[b("_")].concat(pn);for(let e=b("a");e<=b("z");e++)mn.push(e);for(let e=b("A");e<=b("Z");e++)mn.push(e);const Mi=[b(" "),b("\f"),b(`
`),b("\r"),b("	"),b("\v"),b("	"),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b(" "),b("\u2028"),b("\u2029"),b(" "),b(" "),b("　"),b("\uFEFF")],Oc=/[0-9a-fA-F]/,Xt=/[0-9]/,yc=/[1-9]/;class gr{visitChildren(t){for(const n in t){const r=t[n];t.hasOwnProperty(n)&&(r.type!==void 0?this.visit(r):Array.isArray(r)&&r.forEach(i=>{this.visit(i)},this))}}visit(t){switch(t.type){case"Pattern":this.visitPattern(t);break;case"Flags":this.visitFlags(t);break;case"Disjunction":this.visitDisjunction(t);break;case"Alternative":this.visitAlternative(t);break;case"StartAnchor":this.visitStartAnchor(t);break;case"EndAnchor":this.visitEndAnchor(t);break;case"WordBoundary":this.visitWordBoundary(t);break;case"NonWordBoundary":this.visitNonWordBoundary(t);break;case"Lookahead":this.visitLookahead(t);break;case"NegativeLookahead":this.visitNegativeLookahead(t);break;case"Character":this.visitCharacter(t);break;case"Set":this.visitSet(t);break;case"Group":this.visitGroup(t);break;case"GroupBackReference":this.visitGroupBackReference(t);break;case"Quantifier":this.visitQuantifier(t)}this.visitChildren(t)}visitPattern(t){}visitFlags(t){}visitDisjunction(t){}visitAlternative(t){}visitStartAnchor(t){}visitEndAnchor(t){}visitWordBoundary(t){}visitNonWordBoundary(t){}visitLookahead(t){}visitNegativeLookahead(t){}visitCharacter(t){}visitSet(t){}visitGroup(t){}visitGroupBackReference(t){}visitQuantifier(t){}}let sn={};const vc=new class{constructor(){this.idx=0,this.input="",this.groupIdx=0}saveState(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}}restoreState(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx}pattern(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar("/");const t=this.disjunction();this.consumeChar("/");const n={type:"Flags",loc:{begin:this.idx,end:e.length},global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};for(;this.isRegExpFlag();)switch(this.popChar()){case"g":Nt(n,"global");break;case"i":Nt(n,"ignoreCase");break;case"m":Nt(n,"multiLine");break;case"u":Nt(n,"unicode");break;case"y":Nt(n,"sticky")}if(this.idx!==this.input.length)throw Error("Redundant input: "+this.input.substring(this.idx));return{type:"Pattern",flags:n,value:t,loc:this.loc(0)}}disjunction(){const e=[],t=this.idx;for(e.push(this.alternative());this.peekChar()==="|";)this.consumeChar("|"),e.push(this.alternative());return{type:"Disjunction",value:e,loc:this.loc(t)}}alternative(){const e=[],t=this.idx;for(;this.isTerm();)e.push(this.term());return{type:"Alternative",value:e,loc:this.loc(t)}}term(){return this.isAssertion()?this.assertion():this.atom()}assertion(){const e=this.idx;switch(this.popChar()){case"^":return{type:"StartAnchor",loc:this.loc(e)};case"$":return{type:"EndAnchor",loc:this.loc(e)};case"\\":switch(this.popChar()){case"b":return{type:"WordBoundary",loc:this.loc(e)};case"B":return{type:"NonWordBoundary",loc:this.loc(e)}}throw Error("Invalid Assertion Escape");case"(":let t;switch(this.consumeChar("?"),this.popChar()){case"=":t="Lookahead";break;case"!":t="NegativeLookahead"}at(t);const n=this.disjunction();return this.consumeChar(")"),{type:t,value:n,loc:this.loc(e)}}return function(){throw Error("Internal Error - Should never get here!")}()}quantifier(e=!1){let t;const n=this.idx;switch(this.popChar()){case"*":t={atLeast:0,atMost:1/0};break;case"+":t={atLeast:1,atMost:1/0};break;case"?":t={atLeast:0,atMost:1};break;case"{":const r=this.integerIncludingZero();switch(this.popChar()){case"}":t={atLeast:r,atMost:r};break;case",":let i;this.isDigit()?(i=this.integerIncludingZero(),t={atLeast:r,atMost:i}):t={atLeast:r,atMost:1/0},this.consumeChar("}")}if(e===!0&&t===void 0)return;at(t)}if(e!==!0||t!==void 0)return at(t)?(this.peekChar(0)==="?"?(this.consumeChar("?"),t.greedy=!1):t.greedy=!0,t.type="Quantifier",t.loc=this.loc(n),t):void 0}atom(){let e;const t=this.idx;switch(this.peekChar()){case".":e=this.dotAll();break;case"\\":e=this.atomEscape();break;case"[":e=this.characterClass();break;case"(":e=this.group()}if(e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),at(e))return e.loc=this.loc(t),this.isQuantifier()&&(e.quantifier=this.quantifier()),e}dotAll(){return this.consumeChar("."),{type:"Set",complement:!0,value:[b(`
`),b("\r"),b("\u2028"),b("\u2029")]}}atomEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return this.decimalEscapeAtom();case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}decimalEscapeAtom(){return{type:"GroupBackReference",value:this.positiveInteger()}}characterClassEscape(){let e,t=!1;switch(this.popChar()){case"d":e=pn;break;case"D":e=pn,t=!0;break;case"s":e=Mi;break;case"S":e=Mi,t=!0;break;case"w":e=mn;break;case"W":e=mn,t=!0}if(at(e))return{type:"Set",value:e,complement:t}}controlEscapeAtom(){let e;switch(this.popChar()){case"f":e=b("\f");break;case"n":e=b(`
`);break;case"r":e=b("\r");break;case"t":e=b("	");break;case"v":e=b("\v")}if(at(e))return{type:"Character",value:e}}controlLetterEscapeAtom(){this.consumeChar("c");const e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error("Invalid ");return{type:"Character",value:e.toUpperCase().charCodeAt(0)-64}}nulCharacterAtom(){return this.consumeChar("0"),{type:"Character",value:b("\0")}}hexEscapeSequenceAtom(){return this.consumeChar("x"),this.parseHexDigits(2)}regExpUnicodeEscapeSequenceAtom(){return this.consumeChar("u"),this.parseHexDigits(4)}identityEscapeAtom(){return{type:"Character",value:b(this.popChar())}}classPatternCharacterAtom(){switch(this.peekChar()){case`
`:case"\r":case"\u2028":case"\u2029":case"\\":case"]":throw Error("TBD");default:return{type:"Character",value:b(this.popChar())}}}characterClass(){const e=[];let t=!1;for(this.consumeChar("["),this.peekChar(0)==="^"&&(this.consumeChar("^"),t=!0);this.isClassAtom();){const n=this.classAtom();if(n.type,wi(n)&&this.isRangeDash()){this.consumeChar("-");const r=this.classAtom();if(r.type,wi(r)){if(r.value<n.value)throw Error("Range out of order in character class");e.push({from:n.value,to:r.value})}else Gn(n.value,e),e.push(b("-")),Gn(r.value,e)}else Gn(n.value,e)}return this.consumeChar("]"),{type:"Set",complement:t,value:e}}classAtom(){switch(this.peekChar()){case"]":case`
`:case"\r":case"\u2028":case"\u2029":throw Error("TBD");case"\\":return this.classEscape();default:return this.classPatternCharacterAtom()}}classEscape(){switch(this.consumeChar("\\"),this.peekChar()){case"b":return this.consumeChar("b"),{type:"Character",value:b("\b")};case"d":case"D":case"s":case"S":case"w":case"W":return this.characterClassEscape();case"f":case"n":case"r":case"t":case"v":return this.controlEscapeAtom();case"c":return this.controlLetterEscapeAtom();case"0":return this.nulCharacterAtom();case"x":return this.hexEscapeSequenceAtom();case"u":return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}}group(){let e=!0;this.consumeChar("("),this.peekChar(0)==="?"?(this.consumeChar("?"),this.consumeChar(":"),e=!1):this.groupIdx++;const t=this.disjunction();this.consumeChar(")");const n={type:"Group",capturing:e,value:t};return e&&(n.idx=this.groupIdx),n}positiveInteger(){let e=this.popChar();if(yc.test(e)===!1)throw Error("Expecting a positive integer");for(;Xt.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}integerIncludingZero(){let e=this.popChar();if(Xt.test(e)===!1)throw Error("Expecting an integer");for(;Xt.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)}patternCharacter(){const e=this.popChar();switch(e){case`
`:case"\r":case"\u2028":case"\u2029":case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":throw Error("TBD");default:return{type:"Character",value:b(e)}}}isRegExpFlag(){switch(this.peekChar(0)){case"g":case"i":case"m":case"u":case"y":return!0;default:return!1}}isRangeDash(){return this.peekChar()==="-"&&this.isClassAtom(1)}isDigit(){return Xt.test(this.peekChar(0))}isClassAtom(e=0){switch(this.peekChar(e)){case"]":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}isTerm(){return this.isAtom()||this.isAssertion()}isAtom(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case".":case"\\":case"[":case"(":return!0;default:return!1}}isAssertion(){switch(this.peekChar(0)){case"^":case"$":return!0;case"\\":switch(this.peekChar(1)){case"b":case"B":return!0;default:return!1}case"(":return this.peekChar(1)==="?"&&(this.peekChar(2)==="="||this.peekChar(2)==="!");default:return!1}}isQuantifier(){const e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}}isPatternCharacter(){switch(this.peekChar()){case"^":case"$":case"\\":case".":case"*":case"+":case"?":case"(":case")":case"[":case"|":case"/":case`
`:case"\r":case"\u2028":case"\u2029":return!1;default:return!0}}parseHexDigits(e){let t="";for(let n=0;n<e;n++){const r=this.popChar();if(Oc.test(r)===!1)throw Error("Expecting a HexDecimal digits");t+=r}return{type:"Character",value:parseInt(t,16)}}peekChar(e=0){return this.input[this.idx+e]}popChar(){const e=this.peekChar(0);return this.consumeChar(void 0),e}consumeChar(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error("Expected: '"+e+"' but found: '"+this.input[this.idx]+"' at offset: "+this.idx);if(this.idx>=this.input.length)throw Error("Unexpected end of input");this.idx++}loc(e){return{begin:e,end:this.idx}}};function En(e){const t=e.toString();if(sn.hasOwnProperty(t))return sn[t];{const n=vc.pattern(t);return sn[t]=n,n}}const oo="Complement Sets are not supported for first char optimization",gn=`Unable to use "first char" lexer optimizations:
`;function Sc(e,t=!1){try{const n=En(e);return Tr(n.value,{},n.flags.ignoreCase)}catch(n){if(n.message===oo)t&&no(`${gn}	Unable to optimize: < ${e.toString()} >
	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{let r="";t&&(r=`
	This will disable the lexer's first char optimizations.
	See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),Er(`${gn}
	Failed parsing: < ${e.toString()} >
	Using the @chevrotain/regexp-to-ast library
	Please open an issue at: https://github.com/chevrotain/chevrotain/issues`+r)}}return[]}function Tr(e,t,n){switch(e.type){case"Disjunction":for(let i=0;i<e.value.length;i++)Tr(e.value[i],t,n);break;case"Alternative":const r=e.value;for(let i=0;i<r.length;i++){const s=r[i];switch(s.type){case"EndAnchor":case"GroupBackReference":case"Lookahead":case"NegativeLookahead":case"StartAnchor":case"WordBoundary":case"NonWordBoundary":continue}const o=s;switch(o.type){case"Character":Zt(o.value,t,n);break;case"Set":if(o.complement===!0)throw Error(oo);k(o.value,c=>{if(typeof c=="number")Zt(c,t,n);else{const u=c;if(n===!0)for(let l=u.from;l<=u.to;l++)Zt(l,t,n);else{for(let l=u.from;l<=u.to&&l<vt;l++)Zt(l,t,n);if(u.to>=vt){const l=u.from>=vt?u.from:vt,f=u.to,h=He(l),m=He(f);for(let g=h;g<=m;g++)t[g]=g}}}});break;case"Group":Tr(o.value,t,n);break;default:throw Error("Non Exhaustive Match")}const a=o.quantifier!==void 0&&o.quantifier.atLeast===0;if(o.type==="Group"&&Ar(o)===!1||o.type!=="Group"&&a===!1)break}break;default:throw Error("non exhaustive match!")}return Z(t)}function Zt(e,t,n){const r=He(e);t[r]=r,n===!0&&function(i,s){const o=String.fromCharCode(i),a=o.toUpperCase();if(a!==o){const c=He(a.charCodeAt(0));s[c]=c}else{const c=o.toLowerCase();if(c!==o){const u=He(c.charCodeAt(0));s[u]=u}}}(e,t)}function Ui(e,t){return mt(e.value,n=>{if(typeof n=="number")return ie(t,n);{const r=n;return mt(t,i=>r.from<=i&&i<=r.to)!==void 0}})}function Ar(e){const t=e.quantifier;return!(!t||t.atLeast!==0)||!!e.value&&(D(e.value)?Re(e.value,Ar):Ar(e.value))}class _c extends gr{constructor(t){super(),this.targetCharCodes=t,this.found=!1}visitChildren(t){if(this.found!==!0){switch(t.type){case"Lookahead":return void this.visitLookahead(t);case"NegativeLookahead":return void this.visitNegativeLookahead(t)}super.visitChildren(t)}}visitCharacter(t){ie(this.targetCharCodes,t.value)&&(this.found=!0)}visitSet(t){t.complement?Ui(t,this.targetCharCodes)===void 0&&(this.found=!0):Ui(t,this.targetCharCodes)!==void 0&&(this.found=!0)}}function Wr(e,t){if(t instanceof RegExp){const n=En(t),r=new _c(e);return r.visit(n),r.found}return mt(t,n=>ie(e,n.charCodeAt(0)))!==void 0}const et="PATTERN",Rt="defaultMode",zn="modes";let ao=typeof new RegExp("(?:)").sticky=="boolean";function Lc(e,t){const n=(t=$r(t,{useSticky:ao,debug:!1,safeMode:!1,positionTracking:"full",lineTerminatorCharacters:["\r",`
`],tracer:(p,d)=>d()})).tracer;let r;n("initCharCodeToOptimizedIndexMap",()=>{(function(){if(G(on)){on=new Array(65536);for(let p=0;p<65536;p++)on[p]=p>255?255+~~(p/255):p}})()}),n("Reject Lexer.NA",()=>{r=xn(e,p=>p[et]===oe.NA)});let i,s,o,a,c,u,l,f,h,m,g,N=!1;n("Transform Patterns",()=>{N=!1,i=_(r,p=>{const d=p[et];if(Ge(d)){const T=d.source;return T.length!==1||T==="^"||T==="$"||T==="."||d.ignoreCase?T.length!==2||T[0]!=="\\"||ie(["d","D","s","S","t","r","n","t","0","c","b","B","f","v","w","W"],T[1])?t.useSticky?Di(d):Fi(d):T[1]:T}if(Ke(d))return N=!0,{exec:d};if(typeof d=="object")return N=!0,d;if(typeof d=="string"){if(d.length===1)return d;{const T=d.replace(/[\\^$.*+?()[\]{}|]/g,"\\$&"),v=new RegExp(T);return t.useSticky?Di(v):Fi(v)}}throw Error("non exhaustive match")})}),n("misc mapping",()=>{s=_(r,p=>p.tokenTypeIdx),o=_(r,p=>{const d=p.GROUP;if(d!==oe.SKIPPED){if(ae(d))return d;if(ze(d))return!1;throw Error("non exhaustive match")}}),a=_(r,p=>{const d=p.LONGER_ALT;if(d)return D(d)?_(d,T=>ki(r,T)):[ki(r,d)]}),c=_(r,p=>p.PUSH_MODE),u=_(r,p=>L(p,"POP_MODE"))}),n("Line Terminator Handling",()=>{const p=lo(t.lineTerminatorCharacters);l=_(r,d=>!1),t.positionTracking!=="onlyOffset"&&(l=_(r,d=>L(d,"LINE_BREAKS")?!!d.LINE_BREAKS:uo(d,p)===!1&&Wr(p,d.PATTERN)))}),n("Misc Mapping #2",()=>{f=_(r,co),h=_(i,Pc),m=fe(r,(p,d)=>{const T=d.GROUP;return ae(T)&&T!==oe.SKIPPED&&(p[T]=[]),p},{}),g=_(i,(p,d)=>({pattern:i[d],longerAlt:a[d],canLineTerminator:l[d],isCustom:f[d],short:h[d],group:o[d],push:c[d],pop:u[d],tokenTypeIdx:s[d],tokenType:r[d]}))});let S=!0,E=[];return t.safeMode||n("First Char Optimization",()=>{E=fe(r,(p,d,T)=>{if(typeof d.PATTERN=="string"){const v=He(d.PATTERN.charCodeAt(0));Kn(p,v,g[T])}else if(D(d.START_CHARS_HINT)){let v;k(d.START_CHARS_HINT,A=>{const y=He(typeof A=="string"?A.charCodeAt(0):A);v!==y&&(v=y,Kn(p,y,g[T]))})}else if(Ge(d.PATTERN))if(d.PATTERN.unicode)S=!1,t.ensureOptimizations&&Er(`${gn}	Unable to analyze < ${d.PATTERN.toString()} > pattern.
	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{const v=Sc(d.PATTERN,t.ensureOptimizations);G(v)&&(S=!1),k(v,A=>{Kn(p,A,g[T])})}else t.ensureOptimizations&&Er(`${gn}	TokenType: <${d.name}> is using a custom token pattern without providing <start_chars_hint> parameter.
	This will disable the lexer's first char optimizations.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),S=!1;return p},[])}),{emptyGroups:m,patternIdxToConfig:g,charCodeToPatternIdxToConfig:E,hasCustom:N,canBeOptimized:S}}function xc(e,t){let n=[];const r=function(o){const a=pe(o,l=>!L(l,et)),c=_(a,l=>({message:"Token Type: ->"+l.name+"<- missing static 'PATTERN' property",type:V.MISSING_PATTERN,tokenTypes:[l]})),u=fn(o,a);return{errors:c,valid:u}}(e);n=n.concat(r.errors);const i=function(o){const a=pe(o,l=>{const f=l[et];return!(Ge(f)||Ke(f)||L(f,"exec")||ae(f))}),c=_(a,l=>({message:"Token Type: ->"+l.name+"<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.",type:V.INVALID_PATTERN,tokenTypes:[l]})),u=fn(o,a);return{errors:c,valid:u}}(r.valid),s=i.valid;return n=n.concat(i.errors),n=n.concat(function(o){let a=[];const c=pe(o,u=>Ge(u[et]));return a=a.concat(function(u){class l extends gr{constructor(){super(...arguments),this.found=!1}visitEndAnchor(m){this.found=!0}}const f=pe(u,h=>{const m=h.PATTERN;try{const g=En(m),N=new l;return N.visit(g),N.found}catch{return Cc.test(m.source)}});return _(f,h=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+h.name+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:V.EOI_ANCHOR_FOUND,tokenTypes:[h]}))}(c)),a=a.concat(function(u){class l extends gr{constructor(){super(...arguments),this.found=!1}visitStartAnchor(m){this.found=!0}}const f=pe(u,h=>{const m=h.PATTERN;try{const g=En(m),N=new l;return N.visit(g),N.found}catch{return kc.test(m.source)}});return _(f,h=>({message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+h.name+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:V.SOI_ANCHOR_FOUND,tokenTypes:[h]}))}(c)),a=a.concat(function(u){const l=pe(u,f=>{const h=f[et];return h instanceof RegExp&&(h.multiline||h.global)});return _(l,f=>({message:"Token Type: ->"+f.name+"<- static 'PATTERN' may NOT contain global('g') or multiline('m')",type:V.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[f]}))}(c)),a=a.concat(function(u){const l=[];let f=_(u,h=>fe(u,(m,g)=>(h.PATTERN.source!==g.PATTERN.source||ie(l,g)||g.PATTERN===oe.NA||(l.push(g),m.push(g)),m),[]));return f=Gt(f),_(pe(f,h=>h.length>1),h=>{const m=_(h,g=>g.name);return{message:`The same RegExp pattern ->${ye(h).PATTERN}<-has been used in all of the following Token Types: ${m.join(", ")} <-`,type:V.DUPLICATE_PATTERNS_FOUND,tokenTypes:h}})}(c)),a=a.concat(function(u){const l=pe(u,f=>f.PATTERN.test(""));return _(l,f=>({message:"Token Type: ->"+f.name+"<- static 'PATTERN' must not match an empty string",type:V.EMPTY_MATCH_PATTERN,tokenTypes:[f]}))}(c)),a}(s)),n=n.concat(function(o){const a=pe(o,c=>{if(!L(c,"GROUP"))return!1;const u=c.GROUP;return u!==oe.SKIPPED&&u!==oe.NA&&!ae(u)});return _(a,c=>({message:"Token Type: ->"+c.name+"<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String",type:V.INVALID_GROUP_TYPE_FOUND,tokenTypes:[c]}))}(s)),n=n.concat(function(o,a){const c=pe(o,u=>u.PUSH_MODE!==void 0&&!ie(a,u.PUSH_MODE));return _(c,u=>({message:`Token Type: ->${u.name}<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->${u.PUSH_MODE}<-which does not exist`,type:V.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[u]}))}(s,t)),n=n.concat(function(o){const a=[],c=fe(o,(u,l,f)=>{const h=l.PATTERN;return h===oe.NA||(ae(h)?u.push({str:h,idx:f,tokenType:l}):Ge(h)&&(m=h,mt([".","\\","[","]","|","^","$","(",")","?","*","+","{"],g=>m.source.indexOf(g)!==-1)===void 0)&&u.push({str:h.source,idx:f,tokenType:l})),u;var m},[]);return k(o,(u,l)=>{k(c,({str:f,idx:h,tokenType:m})=>{if(l<h&&function(g,N){if(Ge(N)){const S=N.exec(g);return S!==null&&S.index===0}if(Ke(N))return N(g,0,[],{});if(L(N,"exec"))return N.exec(g,0,[],{});if(typeof N=="string")return N===g;throw Error("non exhaustive match")}(f,u.PATTERN)){const g=`Token: ->${m.name}<- can never be matched.
Because it appears AFTER the Token Type ->${u.name}<-in the lexer's definition.
See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;a.push({message:g,type:V.UNREACHABLE_PATTERN,tokenTypes:[u,m]})}})}),a}(s)),n}const Cc=/[^\\][$]/,kc=/[^\\[][\^]|^\^/;function Fi(e){const t=e.ignoreCase?"i":"";return new RegExp(`^(?:${e.source})`,t)}function Di(e){const t=e.ignoreCase?"iy":"y";return new RegExp(`${e.source}`,t)}function bc(e,t,n){const r=[];let i=!1;const s=xn(Gt(Ne(Z(e.modes))),a=>a[et]===oe.NA),o=lo(n);return t&&k(s,a=>{const c=uo(a,o);if(c!==!1){const u=function(f,h){if(h.issue===V.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
	The problem is in the <${f.name}> Token Type
	 Root cause: ${h.errMsg}.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(h.issue===V.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
	The problem is in the <${f.name}> Token Type
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error("non exhaustive match")}(a,c),l={message:u,type:c.issue,tokenType:a};r.push(l)}else L(a,"LINE_BREAKS")?a.LINE_BREAKS===!0&&(i=!0):Wr(o,a.PATTERN)&&(i=!0)}),t&&!i&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://chevrotain.io/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:V.NO_LINE_BREAKS_FLAGS}),r}function co(e){const t=e.PATTERN;if(Ge(t))return!1;if(Ke(t)||L(t,"exec"))return!0;if(ae(t))return!1;throw Error("non exhaustive match")}function Pc(e){return!(!ae(e)||e.length!==1)&&e.charCodeAt(0)}const wc={test:function(e){const t=e.length;for(let n=this.lastIndex;n<t;n++){const r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function uo(e,t){if(L(e,"LINE_BREAKS"))return!1;if(Ge(e.PATTERN)){try{Wr(t,e.PATTERN)}catch(n){return{issue:V.IDENTIFY_TERMINATOR,errMsg:n.message}}return!1}if(ae(e.PATTERN))return!1;if(co(e))return{issue:V.CUSTOM_LINE_BREAK};throw Error("non exhaustive match")}function lo(e){return _(e,t=>ae(t)?t.charCodeAt(0):t)}function Kn(e,t,n){e[t]===void 0?e[t]=[n]:e[t].push(n)}const vt=256;let on=[];function He(e){return e<vt?e:on[e]}function Ct(e,t){const n=e.tokenTypeIdx;return n===t.tokenTypeIdx||t.isParent===!0&&t.categoryMatchesMap[n]===!0}function Tn(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}let ji=1;const Bi={};function zt(e){const t=function(n){let r=ee(n),i=n,s=!0;for(;s;){i=Gt(Ne(_(i,a=>a.CATEGORIES)));const o=fn(i,r);r=r.concat(o),G(o)?s=!1:i=o}return r}(e);(function(n){k(n,r=>{fo(r)||(Bi[ji]=r,r.tokenTypeIdx=ji++),$i(r)&&!D(r.CATEGORIES)&&(r.CATEGORIES=[r.CATEGORIES]),$i(r)||(r.CATEGORIES=[]),L(r,"categoryMatches")||(r.categoryMatches=[]),function(i){return L(i,"categoryMatchesMap")}(r)||(r.categoryMatchesMap={})})})(t),function(n){k(n,r=>{ho([],r)})}(t),function(n){k(n,r=>{r.categoryMatches=[],k(r.categoryMatchesMap,(i,s)=>{r.categoryMatches.push(Bi[s].tokenTypeIdx)})})}(t),k(t,n=>{n.isParent=n.categoryMatches.length>0})}function ho(e,t){k(e,n=>{t.categoryMatchesMap[n.tokenTypeIdx]=!0}),k(t.CATEGORIES,n=>{const r=e.concat(t);ie(r,n)||ho(r,n)})}function fo(e){return L(e,"tokenTypeIdx")}function $i(e){return L(e,"CATEGORIES")}function Mc(e){return L(e,"tokenTypeIdx")}const Uc={buildUnableToPopLexerModeMessage:e=>`Unable to pop Lexer Mode after encountering Token ->${e.image}<- The Mode Stack is empty`,buildUnexpectedCharactersMessage:(e,t,n,r,i)=>`unexpected character: ->${e.charAt(t)}<- at offset: ${t}, skipped ${n} characters.`};var V;(function(e){e[e.MISSING_PATTERN=0]="MISSING_PATTERN",e[e.INVALID_PATTERN=1]="INVALID_PATTERN",e[e.EOI_ANCHOR_FOUND=2]="EOI_ANCHOR_FOUND",e[e.UNSUPPORTED_FLAGS_FOUND=3]="UNSUPPORTED_FLAGS_FOUND",e[e.DUPLICATE_PATTERNS_FOUND=4]="DUPLICATE_PATTERNS_FOUND",e[e.INVALID_GROUP_TYPE_FOUND=5]="INVALID_GROUP_TYPE_FOUND",e[e.PUSH_MODE_DOES_NOT_EXIST=6]="PUSH_MODE_DOES_NOT_EXIST",e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]="MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE",e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]="MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY",e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]="MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST",e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]="LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED",e[e.SOI_ANCHOR_FOUND=11]="SOI_ANCHOR_FOUND",e[e.EMPTY_MATCH_PATTERN=12]="EMPTY_MATCH_PATTERN",e[e.NO_LINE_BREAKS_FLAGS=13]="NO_LINE_BREAKS_FLAGS",e[e.UNREACHABLE_PATTERN=14]="UNREACHABLE_PATTERN",e[e.IDENTIFY_TERMINATOR=15]="IDENTIFY_TERMINATOR",e[e.CUSTOM_LINE_BREAK=16]="CUSTOM_LINE_BREAK",e[e.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE=17]="MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE"})(V||(V={}));const St={deferDefinitionErrorsHandling:!1,positionTracking:"full",lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,"\r"],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:Uc,traceInitPerf:!1,skipValidations:!1,recoveryEnabled:!0};Object.freeze(St);class oe{constructor(t,n=St){if(this.lexerDefinition=t,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},this.TRACE_INIT=(i,s)=>{if(this.traceInitPerf===!0){this.traceInitIndent++;const o=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${o}--> <${i}>`);const{time:a,value:c}=ro(s),u=a>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&u(`${o}<-- <${i}> time: ${a}ms`),this.traceInitIndent--,c}return s()},typeof n=="boolean")throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);this.config=he({},St,n);const r=this.config.traceInitPerf;r===!0?(this.traceInitMaxIdent=1/0,this.traceInitPerf=!0):typeof r=="number"&&(this.traceInitMaxIdent=r,this.traceInitPerf=!0),this.traceInitIndent=-1,this.TRACE_INIT("Lexer Constructor",()=>{let i,s=!0;this.TRACE_INIT("Lexer Config handling",()=>{if(this.config.lineTerminatorsPattern===St.lineTerminatorsPattern)this.config.lineTerminatorsPattern=wc;else if(this.config.lineTerminatorCharacters===St.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://chevrotain.io/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(n.safeMode&&n.ensureOptimizations)throw Error('"safeMode" and "ensureOptimizations" flags are mutually exclusive.');this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking),D(t)?i={modes:{defaultMode:ee(t)},defaultMode:Rt}:(s=!1,i=ee(t))}),this.config.skipValidations===!1&&(this.TRACE_INIT("performRuntimeChecks",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(function(a){const c=[];return L(a,Rt)||c.push({message:"A MultiMode Lexer cannot be initialized without a <"+Rt+`> property in its definition
`,type:V.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),L(a,zn)||c.push({message:`A MultiMode Lexer cannot be initialized without a <modes> property in its definition
`,type:V.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),L(a,zn)&&L(a,Rt)&&!L(a.modes,a.defaultMode)&&c.push({message:`A MultiMode Lexer cannot be initialized with a ${Rt}: <${a.defaultMode}>which does not exist
`,type:V.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),L(a,zn)&&k(a.modes,(u,l)=>{k(u,(f,h)=>{ze(f)?c.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:<${l}> at index: <${h}>
`,type:V.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED}):L(f,"LONGER_ALT")&&k(D(f.LONGER_ALT)?f.LONGER_ALT:[f.LONGER_ALT],m=>{ze(m)||ie(u,m)||c.push({message:`A MultiMode Lexer cannot be initialized with a longer_alt <${m.name}> on token <${f.name}> outside of mode <${l}>
`,type:V.MULTI_MODE_LEXER_LONGER_ALT_NOT_IN_CURRENT_MODE})})})}),c}(i,this.trackStartLines,this.config.lineTerminatorCharacters))}),this.TRACE_INIT("performWarningRuntimeChecks",()=>{this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(bc(i,this.trackStartLines,this.config.lineTerminatorCharacters))})),i.modes=i.modes?i.modes:{},k(i.modes,(a,c)=>{i.modes[c]=xn(a,u=>ze(u))});const o=Ae(i.modes);if(k(i.modes,(a,c)=>{this.TRACE_INIT(`Mode: <${c}> processing`,()=>{if(this.modes.push(c),this.config.skipValidations===!1&&this.TRACE_INIT("validatePatterns",()=>{this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(xc(a,o))}),G(this.lexerDefinitionErrors)){let u;zt(a),this.TRACE_INIT("analyzeTokenTypes",()=>{u=Lc(a,{lineTerminatorCharacters:this.config.lineTerminatorCharacters,positionTracking:n.positionTracking,ensureOptimizations:n.ensureOptimizations,safeMode:n.safeMode,tracer:this.TRACE_INIT})}),this.patternIdxToConfig[c]=u.patternIdxToConfig,this.charCodeToPatternIdxToConfig[c]=u.charCodeToPatternIdxToConfig,this.emptyGroups=he({},this.emptyGroups,u.emptyGroups),this.hasCustom=u.hasCustom||this.hasCustom,this.canModeBeOptimized[c]=u.canBeOptimized}})}),this.defaultMode=i.defaultMode,!G(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){const a=_(this.lexerDefinitionErrors,c=>c.message).join(`-----------------------
`);throw new Error(`Errors detected in definition of Lexer:
`+a)}k(this.lexerDefinitionWarning,a=>{no(a.message)}),this.TRACE_INIT("Choosing sub-methods implementations",()=>{if(ao?(this.chopInput=dt,this.match=this.matchWithTest):(this.updateLastIndex=X,this.match=this.matchWithExec),s&&(this.handleModes=X),this.trackStartLines===!1&&(this.computeNewColumn=dt),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=X),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else{if(!/onlyOffset/i.test(this.config.positionTracking))throw Error(`Invalid <positionTracking> config option: "${this.config.positionTracking}"`);this.createTokenInstance=this.createOffsetOnlyToken}this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom)}),this.TRACE_INIT("Failed Optimization Warnings",()=>{const a=fe(this.canModeBeOptimized,(c,u,l)=>(u===!1&&c.push(l),c),[]);if(n.ensureOptimizations&&!G(a))throw Error(`Lexer Modes: < ${a.join(", ")} > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`)}),this.TRACE_INIT("clearRegExpParserCache",()=>{sn={}}),this.TRACE_INIT("toFastProperties",()=>{io(this)})})}tokenize(t,n=this.defaultMode){if(!G(this.lexerDefinitionErrors)){const r=_(this.lexerDefinitionErrors,i=>i.message).join(`-----------------------
`);throw new Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+r)}return this.tokenizeInternal(t,n)}tokenizeInternal(t,n){let r,i,s,o,a,c,u,l,f,h,m,g,N,S,E;const p=t,d=p.length;let T=0,v=0;const A=this.hasCustom?0:Math.floor(t.length/10),y=new Array(A),R=[];let I=this.trackStartLines?1:void 0,O=this.trackStartLines?1:void 0;const M=function(q){const ne={};return k(Ae(q),Ue=>{const se=q[Ue];if(!D(se))throw Error("non exhaustive match");ne[Ue]=[]}),ne}(this.emptyGroups),w=this.trackStartLines,F=this.config.lineTerminatorsPattern;let $=0,x=[],C=[];const j=[],Y=[];let B;function te(){return x}function Ze(q){const ne=He(q),Ue=C[ne];return Ue===void 0?Y:Ue}Object.freeze(Y);const Tt=q=>{if(j.length===1&&q.tokenType.PUSH_MODE===void 0){const ne=this.config.errorMessageProvider.buildUnableToPopLexerModeMessage(q);R.push({offset:q.startOffset,line:q.startLine,column:q.startColumn,length:q.image.length,message:ne})}else{j.pop();const ne=pt(j);x=this.patternIdxToConfig[ne],C=this.charCodeToPatternIdxToConfig[ne],$=x.length;const Ue=this.canModeBeOptimized[ne]&&this.config.safeMode===!1;B=C&&Ue?Ze:te}};function Hr(q){j.push(q),C=this.charCodeToPatternIdxToConfig[q],x=this.patternIdxToConfig[q],$=x.length,$=x.length;const ne=this.canModeBeOptimized[q]&&this.config.safeMode===!1;B=C&&ne?Ze:te}let Ie;Hr.call(this,n);const Yr=this.config.recoveryEnabled;for(;T<d;){c=null;const q=p.charCodeAt(T),ne=B(q),Ue=ne.length;for(r=0;r<Ue;r++){Ie=ne[r];const se=Ie.pattern;u=null;const Fe=Ie.short;if(Fe!==!1?q===Fe&&(c=se):Ie.isCustom===!0?(E=se.exec(p,T,y,M),E!==null?(c=E[0],E.payload!==void 0&&(u=E.payload)):c=null):(this.updateLastIndex(se,T),c=this.match(se,t,T)),c!==null){if(a=Ie.longerAlt,a!==void 0){const De=a.length;for(s=0;s<De;s++){const je=x[a[s]],Qe=je.pattern;if(l=null,je.isCustom===!0?(E=Qe.exec(p,T,y,M),E!==null?(o=E[0],E.payload!==void 0&&(l=E.payload)):o=null):(this.updateLastIndex(Qe,T),o=this.match(Qe,t,T)),o&&o.length>c.length){c=o,u=l,Ie=je;break}}}break}}if(c!==null){if(f=c.length,h=Ie.group,h!==void 0&&(m=Ie.tokenTypeIdx,g=this.createTokenInstance(c,T,m,Ie.tokenType,I,O,f),this.handlePayload(g,u),h===!1?v=this.addToken(y,v,g):M[h].push(g)),t=this.chopInput(t,f),T+=f,O=this.computeNewColumn(O,f),w===!0&&Ie.canLineTerminator===!0){let se,Fe,De=0;F.lastIndex=0;do se=F.test(c),se===!0&&(Fe=F.lastIndex-1,De++);while(se===!0);De!==0&&(I+=De,O=f-Fe,this.updateTokenEndLineColumnLocation(g,h,Fe,De,I,O,f))}this.handleModes(Ie,Tt,Hr,g)}else{const se=T,Fe=I,De=O;let je=Yr===!1;for(;je===!1&&T<d;)for(t=this.chopInput(t,1),T++,i=0;i<$;i++){const Qe=x[i],Mn=Qe.pattern,qr=Qe.short;if(qr!==!1?p.charCodeAt(T)===qr&&(je=!0):Qe.isCustom===!0?je=Mn.exec(p,T,y,M)!==null:(this.updateLastIndex(Mn,T),je=Mn.exec(t)!==null),je===!0)break}if(N=T-se,O=this.computeNewColumn(O,N),S=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(p,se,N,Fe,De),R.push({offset:se,line:Fe,column:De,length:N,message:S}),Yr===!1)break}}return this.hasCustom||(y.length=v),{tokens:y,groups:M,errors:R}}handleModes(t,n,r,i){if(t.pop===!0){const s=t.push;n(i),s!==void 0&&r.call(this,s)}else t.push!==void 0&&r.call(this,t.push)}chopInput(t,n){return t.substring(n)}updateLastIndex(t,n){t.lastIndex=n}updateTokenEndLineColumnLocation(t,n,r,i,s,o,a){let c,u;n!==void 0&&(c=r===a-1,u=c?-1:0,i===1&&c===!0||(t.endLine=s+u,t.endColumn=o-1-u))}computeNewColumn(t,n){return t+n}createOffsetOnlyToken(t,n,r,i){return{image:t,startOffset:n,tokenTypeIdx:r,tokenType:i}}createStartOnlyToken(t,n,r,i,s,o){return{image:t,startOffset:n,startLine:s,startColumn:o,tokenTypeIdx:r,tokenType:i}}createFullToken(t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:n+a-1,startLine:s,endLine:s,startColumn:o,endColumn:o+a-1,tokenTypeIdx:r,tokenType:i}}addTokenUsingPush(t,n,r){return t.push(r),n}addTokenUsingMemberAccess(t,n,r){return t[n]=r,++n}handlePayloadNoCustom(t,n){}handlePayloadWithCustom(t,n){n!==null&&(t.payload=n)}matchWithTest(t,n,r){return t.test(n)===!0?n.substring(r,t.lastIndex):null}matchWithExec(t,n){const r=t.exec(n);return r!==null?r[0]:null}}function kt(e){return po(e)?e.LABEL:e.name}function po(e){return ae(e.LABEL)&&e.LABEL!==""}oe.SKIPPED="This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.",oe.NA=/NOT_APPLICABLE/;const Fc="parent",Wi="categories",Gi="label",zi="group",Ki="push_mode",Vi="pop_mode",Hi="longer_alt",Yi="line_breaks",qi="start_chars_hint";function P(e){return function(t){const n=t.pattern,r={};if(r.name=t.name,ze(n)||(r.PATTERN=n),L(t,Fc))throw`The parent property is no longer supported.
See: https://github.com/chevrotain/chevrotain/issues/564#issuecomment-349062346 for details.`;return L(t,Wi)&&(r.CATEGORIES=t[Wi]),zt([r]),L(t,Gi)&&(r.LABEL=t[Gi]),L(t,zi)&&(r.GROUP=t[zi]),L(t,Vi)&&(r.POP_MODE=t[Vi]),L(t,Ki)&&(r.PUSH_MODE=t[Ki]),L(t,Hi)&&(r.LONGER_ALT=t[Hi]),L(t,Yi)&&(r.LINE_BREAKS=t[Yi]),L(t,qi)&&(r.START_CHARS_HINT=t[qi]),r}(e)}const tt=P({name:"EOF",pattern:oe.NA});function Gr(e,t,n,r,i,s,o,a){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:s,startColumn:o,endColumn:a,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}zt([tt]);const mo={buildMismatchTokenMessage:({expected:e,actual:t,previous:n,ruleName:r})=>`Expecting ${po(e)?`--> ${kt(e)} <--`:`token of type --> ${e.name} <--`} but found --> '${t.image}' <--`,buildNotAllInputParsedMessage:({firstRedundant:e,ruleName:t})=>"Redundant input, expecting EOF but found: "+e.image,buildNoViableAltMessage({expectedPathsPerAlt:e,actual:t,previous:n,customUserDescription:r,ruleName:i}){const s="Expecting: ",o=`
but found: '`+ye(t).image+"'";if(r)return s+r+o;{const a=_(fe(e,(c,u)=>c.concat(u),[]),c=>`[${_(c,u=>kt(u)).join(", ")}]`);return s+`one of these possible Token sequences:
${_(a,(c,u)=>`  ${u+1}. ${c}`).join(`
`)}`+o}},buildEarlyExitMessage({expectedIterationPaths:e,actual:t,customUserDescription:n,ruleName:r}){const i="Expecting: ",s=`
but found: '`+ye(t).image+"'";return n?i+n+s:i+`expecting at least one iteration which starts with one of these possible Token sequences::
  <${_(e,o=>`[${_(o,a=>kt(a)).join(",")}]`).join(" ,")}>`+s}};Object.freeze(mo);const Dc={buildRuleNotFoundError:(e,t)=>"Invalid grammar, reference to a rule which is not defined: ->"+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+"<-"},nt={buildDuplicateFoundError(e,t){const n=e.name,r=ye(t),i=r.idx,s=Le(r),o=(a=r)instanceof K?a.terminalType.name:a instanceof de?a.nonTerminalName:"";var a;let c=`->${s}${i>0?i:""}<- ${o?`with argument: ->${o}<-`:""}
                  appears more than once (${t.length} times) in the top level rule: ->${n}<-.                  
                  For further details see: https://chevrotain.io/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return c=c.replace(/[ \t]+/g," "),c=c.replace(/\s\s+/g,`
`),c},buildNamespaceConflictError:e=>`Namespace conflict found in grammar.
The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <${e.name}>.
To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`,buildAlternationPrefixAmbiguityError(e){const t=_(e.prefixPath,r=>kt(r)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;return`Ambiguous alternatives: <${e.ambiguityIndices.join(" ,")}> due to common lookahead prefix
in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError(e){const t=_(e.prefixPath,i=>kt(i)).join(", "),n=e.alternation.idx===0?"":e.alternation.idx;let r=`Ambiguous Alternatives Detected: <${e.ambiguityIndices.join(" ,")}> in <OR${n}> inside <${e.topLevelRule.name}> Rule,
<${t}> may appears as a prefix path in all these alternatives.
`;return r+=`See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#AMBIGUOUS_ALTERNATIVES
For Further details.`,r},buildEmptyRepetitionError(e){let t=Le(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <${t}> within Rule <${e.topLevelRule.name}> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError:e=>"deprecated",buildEmptyAlternationError:e=>`Ambiguous empty alternative: <${e.emptyChoiceIdx+1}> in <OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
Only the last alternative may be an empty alternative.`,buildTooManyAlternativesError:e=>`An Alternation cannot have more than 256 alternatives:
<OR${e.alternation.idx}> inside <${e.topLevelRule.name}> Rule.
 has ${e.alternation.definition.length+1} alternatives.`,buildLeftRecursionError(e){const t=e.topLevelRule.name;return`Left Recursion found in grammar.
rule: <${t}> can be invoked from itself (directly or indirectly)
without consuming any Tokens. The grammar path that causes this is: 
 ${`${t} --> ${_(e.leftRecursionPath,n=>n.name).concat([t]).join(" --> ")}`}
 To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_factoring.`},buildInvalidRuleNameError:e=>"deprecated",buildDuplicateRuleNameError(e){let t;return t=e.topLevelRule instanceof Et?e.topLevelRule.name:e.topLevelRule,`Duplicate definition, rule: ->${t}<- is already defined in the grammar: ->${e.grammarName}<-`}};class jc extends gt{constructor(t,n){super(),this.nameToTopRule=t,this.errMsgProvider=n,this.errors=[]}resolveRefs(){k(Z(this.nameToTopRule),t=>{this.currTopLevel=t,t.accept(this)})}visitNonTerminal(t){const n=this.nameToTopRule[t.nonTerminalName];if(n)t.referencedRule=n;else{const r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,t);this.errors.push({message:r,type:re.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:t.nonTerminalName})}}}class Bc extends Cn{constructor(t,n){super(),this.topProd=t,this.path=n,this.possibleTokTypes=[],this.nextProductionName="",this.nextProductionOccurrence=0,this.found=!1,this.isAtEndOfPath=!1}startWalking(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error("The path does not start with the walker's top Rule!");return this.ruleStack=ee(this.path.ruleStack).reverse(),this.occurrenceStack=ee(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes}walk(t,n=[]){this.found||super.walk(t,n)}walkProdRef(t,n,r){if(t.referencedRule.name===this.nextProductionName&&t.idx===this.nextProductionOccurrence){const i=n.concat(r);this.updateExpectedNext(),this.walk(t.referencedRule,i)}}updateExpectedNext(){G(this.ruleStack)?(this.nextProductionName="",this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())}}class $c extends Bc{constructor(t,n){super(t,n),this.path=n,this.nextTerminalName="",this.nextTerminalOccurrence=0,this.nextTerminalName=this.path.lastTok.name,this.nextTerminalOccurrence=this.path.lastTokOccurrence}walkTerminal(t,n,r){if(this.isAtEndOfPath&&t.terminalType.name===this.nextTerminalName&&t.idx===this.nextTerminalOccurrence&&!this.found){const i=n.concat(r),s=new ue({definition:i});this.possibleTokTypes=xt(s),this.found=!0}}}class kn extends Cn{constructor(t,n){super(),this.topRule=t,this.occurrence=n,this.result={token:void 0,occurrence:void 0,isEndOfRule:void 0}}startWalking(){return this.walk(this.topRule),this.result}}class Wc extends kn{walkMany(t,n,r){if(t.idx===this.occurrence){const i=ye(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof K&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkMany(t,n,r)}}class Xi extends kn{walkManySep(t,n,r){if(t.idx===this.occurrence){const i=ye(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof K&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkManySep(t,n,r)}}class Gc extends kn{walkAtLeastOne(t,n,r){if(t.idx===this.occurrence){const i=ye(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof K&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOne(t,n,r)}}class Zi extends kn{walkAtLeastOneSep(t,n,r){if(t.idx===this.occurrence){const i=ye(n.concat(r));this.result.isEndOfRule=i===void 0,i instanceof K&&(this.result.token=i.terminalType,this.result.occurrence=i.idx)}else super.walkAtLeastOneSep(t,n,r)}}function Ir(e,t,n=[]){n=ee(n);let r=[],i=0;function s(o){const a=Ir(o.concat(J(e,i+1)),t,n);return r.concat(a)}for(;n.length<t&&i<e.length;){const o=e[i];if(o instanceof ue||o instanceof de)return s(o.definition);if(o instanceof ce)r=s(o.definition);else{if(o instanceof we)return s(o.definition.concat([new Q({definition:o.definition})]));if(o instanceof Me)return s([new ue({definition:o.definition}),new Q({definition:[new K({terminalType:o.separator})].concat(o.definition)})]);if(o instanceof Se){const a=o.definition.concat([new Q({definition:[new K({terminalType:o.separator})].concat(o.definition)})]);r=s(a)}else if(o instanceof Q){const a=o.definition.concat([new Q({definition:o.definition})]);r=s(a)}else{if(o instanceof _e)return k(o.definition,a=>{G(a.definition)===!1&&(r=s(a.definition))}),r;if(!(o instanceof K))throw Error("non exhaustive match");n.push(o.terminalType)}}i++}return r.push({partialPath:n,suffixDef:J(e,i)}),r}function Eo(e,t,n,r){const i="EXIT_NONE_TERMINAL",s=[i],o="EXIT_ALTERNATIVE";let a=!1;const c=t.length,u=c-r-1,l=[],f=[];for(f.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!G(f);){const h=f.pop();if(h===o){a&&pt(f).idx<=u&&f.pop();continue}const m=h.def,g=h.idx,N=h.ruleStack,S=h.occurrenceStack;if(G(m))continue;const E=m[0];if(E===i){const p={idx:g,def:J(m),ruleStack:Ft(N),occurrenceStack:Ft(S)};f.push(p)}else if(E instanceof K)if(g<c-1){const p=g+1;if(n(t[p],E.terminalType)){const d={idx:p,def:J(m),ruleStack:N,occurrenceStack:S};f.push(d)}}else{if(g!==c-1)throw Error("non exhaustive match");l.push({nextTokenType:E.terminalType,nextTokenOccurrence:E.idx,ruleStack:N,occurrenceStack:S}),a=!0}else if(E instanceof de){const p=ee(N);p.push(E.nonTerminalName);const d=ee(S);d.push(E.idx);const T={idx:g,def:E.definition.concat(s,J(m)),ruleStack:p,occurrenceStack:d};f.push(T)}else if(E instanceof ce){const p={idx:g,def:J(m),ruleStack:N,occurrenceStack:S};f.push(p),f.push(o);const d={idx:g,def:E.definition.concat(J(m)),ruleStack:N,occurrenceStack:S};f.push(d)}else if(E instanceof we){const p=new Q({definition:E.definition,idx:E.idx}),d={idx:g,def:E.definition.concat([p],J(m)),ruleStack:N,occurrenceStack:S};f.push(d)}else if(E instanceof Me){const p=new K({terminalType:E.separator}),d=new Q({definition:[p].concat(E.definition),idx:E.idx}),T={idx:g,def:E.definition.concat([d],J(m)),ruleStack:N,occurrenceStack:S};f.push(T)}else if(E instanceof Se){const p={idx:g,def:J(m),ruleStack:N,occurrenceStack:S};f.push(p),f.push(o);const d=new K({terminalType:E.separator}),T=new Q({definition:[d].concat(E.definition),idx:E.idx}),v={idx:g,def:E.definition.concat([T],J(m)),ruleStack:N,occurrenceStack:S};f.push(v)}else if(E instanceof Q){const p={idx:g,def:J(m),ruleStack:N,occurrenceStack:S};f.push(p),f.push(o);const d=new Q({definition:E.definition,idx:E.idx}),T={idx:g,def:E.definition.concat([d],J(m)),ruleStack:N,occurrenceStack:S};f.push(T)}else if(E instanceof _e)for(let p=E.definition.length-1;p>=0;p--){const d={idx:g,def:E.definition[p].definition.concat(J(m)),ruleStack:N,occurrenceStack:S};f.push(d),f.push(o)}else if(E instanceof ue)f.push({idx:g,def:E.definition.concat(J(m)),ruleStack:N,occurrenceStack:S});else{if(!(E instanceof Et))throw Error("non exhaustive match");f.push(zc(E,g,N,S))}}return l}function zc(e,t,n,r){const i=ee(n);i.push(e.name);const s=ee(r);return s.push(1),{idx:t,def:e.definition,ruleStack:i,occurrenceStack:s}}var H;function Qi(e){if(e instanceof ce||e==="Option")return H.OPTION;if(e instanceof Q||e==="Repetition")return H.REPETITION;if(e instanceof we||e==="RepetitionMandatory")return H.REPETITION_MANDATORY;if(e instanceof Me||e==="RepetitionMandatoryWithSeparator")return H.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof Se||e==="RepetitionWithSeparator")return H.REPETITION_WITH_SEPARATOR;if(e instanceof _e||e==="Alternation")return H.ALTERNATION;throw Error("non exhaustive match")}function Kc(e,t,n,r){const i=e.length,s=Re(e,o=>Re(o,a=>a.length===1));if(t)return function(o){const a=_(o,c=>c.GATE);for(let c=0;c<i;c++){const u=e[c],l=u.length,f=a[c];if(f===void 0||f.call(this)!==!1)e:for(let h=0;h<l;h++){const m=u[h],g=m.length;for(let N=0;N<g;N++){const S=this.LA(N+1);if(n(S,m[N])===!1)continue e}return c}}};if(s&&!r){const o=fe(_(e,a=>Ne(a)),(a,c,u)=>(k(c,l=>{L(a,l.tokenTypeIdx)||(a[l.tokenTypeIdx]=u),k(l.categoryMatches,f=>{L(a,f)||(a[f]=u)})}),a),{});return function(){const a=this.LA(1);return o[a.tokenTypeIdx]}}return function(){for(let o=0;o<i;o++){const a=e[o],c=a.length;e:for(let u=0;u<c;u++){const l=a[u],f=l.length;for(let h=0;h<f;h++){const m=this.LA(h+1);if(n(m,l[h])===!1)continue e}return o}}}}function Vc(e,t,n){const r=Re(e,s=>s.length===1),i=e.length;if(r&&!n){const s=Ne(e);if(s.length===1&&G(s[0].categoryMatches)){const o=s[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===o}}{const o=fe(s,(a,c,u)=>(a[c.tokenTypeIdx]=!0,k(c.categoryMatches,l=>{a[l]=!0}),a),[]);return function(){const a=this.LA(1);return o[a.tokenTypeIdx]===!0}}}return function(){e:for(let s=0;s<i;s++){const o=e[s],a=o.length;for(let c=0;c<a;c++){const u=this.LA(c+1);if(t(u,o[c])===!1)continue e}return!0}return!1}}(function(e){e[e.OPTION=0]="OPTION",e[e.REPETITION=1]="REPETITION",e[e.REPETITION_MANDATORY=2]="REPETITION_MANDATORY",e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]="REPETITION_MANDATORY_WITH_SEPARATOR",e[e.REPETITION_WITH_SEPARATOR=4]="REPETITION_WITH_SEPARATOR",e[e.ALTERNATION=5]="ALTERNATION"})(H||(H={}));class Hc extends Cn{constructor(t,n,r){super(),this.topProd=t,this.targetOccurrence=n,this.targetProdType=r}startWalking(){return this.walk(this.topProd),this.restDef}checkIsTarget(t,n,r,i){return t.idx===this.targetOccurrence&&this.targetProdType===n&&(this.restDef=r.concat(i),!0)}walkOption(t,n,r){this.checkIsTarget(t,H.OPTION,n,r)||super.walkOption(t,n,r)}walkAtLeastOne(t,n,r){this.checkIsTarget(t,H.REPETITION_MANDATORY,n,r)||super.walkOption(t,n,r)}walkAtLeastOneSep(t,n,r){this.checkIsTarget(t,H.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}walkMany(t,n,r){this.checkIsTarget(t,H.REPETITION,n,r)||super.walkOption(t,n,r)}walkManySep(t,n,r){this.checkIsTarget(t,H.REPETITION_WITH_SEPARATOR,n,r)||super.walkOption(t,n,r)}}class go extends gt{constructor(t,n,r){super(),this.targetOccurrence=t,this.targetProdType=n,this.targetRef=r,this.result=[]}checkIsTarget(t,n){t.idx!==this.targetOccurrence||this.targetProdType!==n||this.targetRef!==void 0&&t!==this.targetRef||(this.result=t.definition)}visitOption(t){this.checkIsTarget(t,H.OPTION)}visitRepetition(t){this.checkIsTarget(t,H.REPETITION)}visitRepetitionMandatory(t){this.checkIsTarget(t,H.REPETITION_MANDATORY)}visitRepetitionMandatoryWithSeparator(t){this.checkIsTarget(t,H.REPETITION_MANDATORY_WITH_SEPARATOR)}visitRepetitionWithSeparator(t){this.checkIsTarget(t,H.REPETITION_WITH_SEPARATOR)}visitAlternation(t){this.checkIsTarget(t,H.ALTERNATION)}}function Ji(e){const t=new Array(e);for(let n=0;n<e;n++)t[n]=[];return t}function Vn(e){let t=[""];for(let n=0;n<e.length;n++){const r=e[n],i=[];for(let s=0;s<t.length;s++){const o=t[s];i.push(o+"_"+r.tokenTypeIdx);for(let a=0;a<r.categoryMatches.length;a++){const c="_"+r.categoryMatches[a];i.push(o+c)}}t=i}return t}function Yc(e,t,n){for(let r=0;r<e.length;r++){if(r===n)continue;const i=e[r];for(let s=0;s<t.length;s++)if(i[t[s]]===!0)return!1}return!0}function To(e,t){const n=_(e,o=>Ir([o],1)),r=Ji(n.length),i=_(n,o=>{const a={};return k(o,c=>{k(Vn(c.partialPath),u=>{a[u]=!0})}),a});let s=n;for(let o=1;o<=t;o++){const a=s;s=Ji(a.length);for(let c=0;c<a.length;c++){const u=a[c];for(let l=0;l<u.length;l++){const f=u[l].partialPath,h=u[l].suffixDef,m=Vn(f);if(Yc(i,m,c)||G(h)||f.length===t){const g=r[c];if(Rr(g,f)===!1){g.push(f);for(let N=0;N<m.length;N++){const S=m[N];i[c][S]=!0}}}else{const g=Ir(h,o+1,f);s[c]=s[c].concat(g),k(g,N=>{k(Vn(N.partialPath),S=>{i[c][S]=!0})})}}}}return r}function zr(e,t,n,r){const i=new go(e,H.ALTERNATION,r);return t.accept(i),To(i.result,n)}function Nr(e,t,n,r){const i=new go(e,n);t.accept(i);const s=i.result,o=new Hc(t,e,n).startWalking();return To([new ue({definition:s}),new ue({definition:o})],r)}function Rr(e,t){e:for(let n=0;n<e.length;n++){const r=e[n];if(r.length===t.length){for(let i=0;i<r.length;i++){const s=t[i],o=r[i];if(!(s===o||o.categoryMatchesMap[s.tokenTypeIdx]!==void 0))continue e}return!0}}return!1}function es(e){return Re(e,t=>Re(t,n=>Re(n,r=>G(r.categoryMatches))))}function qc(e,t,n,r){const i=Ee(e,c=>function(u,l){const f=new Zc;u.accept(f);const h=f.allProductions,m=fc(h,Xc);return _(Z(ve(m,g=>g.length>1)),g=>{const N=ye(g),S=l.buildDuplicateFoundError(u,g),E=Le(N),p={message:S,type:re.DUPLICATE_PRODUCTIONS,ruleName:u.name,dslName:E,occurrence:N.idx},d=Ao(N);return d&&(p.parameter=d),p})}(c,n)),s=function(c,u,l){const f=[],h=_(u,m=>m.name);return k(c,m=>{const g=m.name;if(ie(h,g)){const N=l.buildNamespaceConflictError(m);f.push({message:N,type:re.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:g})}}),f}(e,t,n),o=Ee(e,c=>function(u,l){const f=new Kr;return u.accept(f),Ee(f.alternations,h=>h.definition.length>255?[{message:l.buildTooManyAlternativesError({topLevelRule:u,alternation:h}),type:re.TOO_MANY_ALTS,ruleName:u.name,occurrence:h.idx}]:[])}(c,n)),a=Ee(e,c=>function(u,l,f,h){const m=[];if(fe(l,(g,N)=>N.name===u.name?g+1:g,0)>1){const g=h.buildDuplicateRuleNameError({topLevelRule:u,grammarName:f});m.push({message:g,type:re.DUPLICATE_RULE_NAME,ruleName:u.name})}return m}(c,e,r,n));return i.concat(s,o,a)}function Xc(e){return`${Le(e)}_#_${e.idx}_#_${Ao(e)}`}function Ao(e){return e instanceof K?e.terminalType.name:e instanceof de?e.nonTerminalName:""}class Zc extends gt{constructor(){super(...arguments),this.allProductions=[]}visitNonTerminal(t){this.allProductions.push(t)}visitOption(t){this.allProductions.push(t)}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}visitAlternation(t){this.allProductions.push(t)}visitTerminal(t){this.allProductions.push(t)}}function Io(e,t,n,r=[]){const i=[],s=an(t.definition);if(G(s))return[];{const o=e.name;ie(s,e)&&i.push({message:n.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:r}),type:re.LEFT_RECURSION,ruleName:o});const a=Ee(fn(s,r.concat([e])),c=>{const u=ee(r);return u.push(c),Io(e,c,n,u)});return i.concat(a)}}function an(e){let t=[];if(G(e))return t;const n=ye(e);if(n instanceof de)t.push(n.referencedRule);else if(n instanceof ue||n instanceof ce||n instanceof we||n instanceof Me||n instanceof Se||n instanceof Q)t=t.concat(an(n.definition));else if(n instanceof _e)t=Ne(_(n.definition,s=>an(s.definition)));else if(!(n instanceof K))throw Error("non exhaustive match");const r=dn(n),i=e.length>1;if(r&&i){const s=J(e);return t.concat(an(s))}return t}class Kr extends gt{constructor(){super(...arguments),this.alternations=[]}visitAlternation(t){this.alternations.push(t)}}function Qc(e,t,n){const r=new Kr;e.accept(r);let i=r.alternations;return i=xn(i,s=>s.ignoreAmbiguities===!0),Ee(i,s=>{const o=s.idx,a=s.maxLookahead||t,c=zr(o,e,a,s),u=function(f,h,m,g){const N=[],S=fe(f,(E,p,d)=>(h.definition[d].ignoreAmbiguities===!0||k(p,T=>{const v=[d];k(f,(A,y)=>{d!==y&&Rr(A,T)&&h.definition[y].ignoreAmbiguities!==!0&&v.push(y)}),v.length>1&&!Rr(N,T)&&(N.push(T),E.push({alts:v,path:T}))}),E),[]);return _(S,E=>{const p=_(E.alts,d=>d+1);return{message:g.buildAlternationAmbiguityError({topLevelRule:m,alternation:h,ambiguityIndices:p,prefixPath:E.path}),type:re.AMBIGUOUS_ALTS,ruleName:m.name,occurrence:h.idx,alternatives:E.alts}})}(c,s,e,n),l=function(f,h,m,g){const N=fe(f,(S,E,p)=>{const d=_(E,T=>({idx:p,path:T}));return S.concat(d)},[]);return Gt(Ee(N,S=>{if(h.definition[S.idx].ignoreAmbiguities===!0)return[];const E=S.idx,p=S.path;return _(pe(N,d=>{return h.definition[d.idx].ignoreAmbiguities!==!0&&d.idx<E&&(T=d.path,v=p,T.length<v.length&&Re(T,(A,y)=>{const R=v[y];return A===R||R.categoryMatchesMap[A.tokenTypeIdx]}));var T,v}),d=>{const T=[d.idx+1,E+1],v=h.idx===0?"":h.idx;return{message:g.buildAlternationPrefixAmbiguityError({topLevelRule:m,alternation:h,ambiguityIndices:T,prefixPath:d.path}),type:re.AMBIGUOUS_PREFIX_ALTS,ruleName:m.name,occurrence:v,alternatives:T}})}))}(c,s,e,n);return u.concat(l)})}class Jc extends gt{constructor(){super(...arguments),this.allProductions=[]}visitRepetitionWithSeparator(t){this.allProductions.push(t)}visitRepetitionMandatory(t){this.allProductions.push(t)}visitRepetitionMandatoryWithSeparator(t){this.allProductions.push(t)}visitRepetition(t){this.allProductions.push(t)}}function eu(e){const t=$r(e,{errMsgProvider:Dc}),n={};return k(e.rules,r=>{n[r.name]=r}),function(r,i){const s=new jc(r,i);return s.resolveRefs(),s.errors}(n,t.errMsgProvider)}const No="MismatchedTokenException",Ro="NoViableAltException",Oo="EarlyExitException",yo="NotAllInputParsedException",vo=[No,Ro,Oo,yo];function Qt(e){return ie(vo,e.name)}Object.freeze(vo);class bn extends Error{constructor(t,n){super(t),this.token=n,this.resyncedTokens=[],Object.setPrototypeOf(this,new.target.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}class ts extends bn{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=No}}class tu extends bn{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Ro}}class nu extends bn{constructor(t,n){super(t,n),this.name=yo}}class ru extends bn{constructor(t,n,r){super(t,n),this.previousToken=r,this.name=Oo}}const Hn={},So="InRuleRecoveryException";class iu extends Error{constructor(t){super(t),this.name=So}}function su(e,t,n,r,i,s,o){const a=this.getKeyForAutomaticLookahead(r,i);let c=this.firstAfterRepMap[a];if(c===void 0){const h=this.getCurrRuleFullName();c=new s(this.getGAstProductions()[h],i).startWalking(),this.firstAfterRepMap[a]=c}let u=c.token,l=c.occurrence;const f=c.isEndOfRule;this.RULE_STACK.length===1&&f&&u===void 0&&(u=tt,l=1),u!==void 0&&l!==void 0&&this.shouldInRepetitionRecoveryBeTried(u,l,o)&&this.tryInRepetitionRecovery(e,t,n,u)}const Yn=1024,qn=1280,Jt=1536;function Xn(e,t,n){return n|t|e}class ou{constructor(t){var n;this.maxLookahead=(n=t?.maxLookahead)!==null&&n!==void 0?n:Be.maxLookahead}validate(t){const n=this.validateNoLeftRecursion(t.rules);if(G(n)){const r=this.validateEmptyOrAlternatives(t.rules),i=this.validateAmbiguousAlternationAlternatives(t.rules,this.maxLookahead),s=this.validateSomeNonEmptyLookaheadPath(t.rules,this.maxLookahead);return[...n,...r,...i,...s]}return n}validateNoLeftRecursion(t){return Ee(t,n=>Io(n,n,nt))}validateEmptyOrAlternatives(t){return Ee(t,n=>function(r,i){const s=new Kr;return r.accept(s),Ee(s.alternations,o=>Ee(Ft(o.definition),(a,c)=>G(Eo([a],[],Ct,1))?[{message:i.buildEmptyAlternationError({topLevelRule:r,alternation:o,emptyChoiceIdx:c}),type:re.NONE_LAST_EMPTY_ALT,ruleName:r.name,occurrence:o.idx,alternative:c+1}]:[]))}(n,nt))}validateAmbiguousAlternationAlternatives(t,n){return Ee(t,r=>Qc(r,n,nt))}validateSomeNonEmptyLookaheadPath(t,n){return function(r,i,s){const o=[];return k(r,a=>{const c=new Jc;a.accept(c),k(c.allProductions,u=>{const l=Qi(u),f=u.maxLookahead||i;if(G(Ne(Nr(u.idx,a,l,f)[0]))){const h=s.buildEmptyRepetitionError({topLevelRule:a,repetition:u});o.push({message:h,type:re.NO_NON_EMPTY_LOOKAHEAD,ruleName:a.name})}})}),o}(t,n,nt)}buildLookaheadForAlternation(t){return function(n,r,i,s,o,a){const c=zr(n,r,i);return a(c,s,es(c)?Tn:Ct,o)}(t.prodOccurrence,t.rule,t.maxLookahead,t.hasPredicates,t.dynamicTokensEnabled,Kc)}buildLookaheadForOptional(t){return function(n,r,i,s,o,a){const c=Nr(n,r,o,i),u=es(c)?Tn:Ct;return a(c[0],u,s)}(t.prodOccurrence,t.rule,t.maxLookahead,t.dynamicTokensEnabled,Qi(t.prodType),Vc)}}const en=new class extends gt{constructor(){super(...arguments),this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}reset(){this.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]}}visitOption(e){this.dslMethods.option.push(e)}visitRepetitionWithSeparator(e){this.dslMethods.repetitionWithSeparator.push(e)}visitRepetitionMandatory(e){this.dslMethods.repetitionMandatory.push(e)}visitRepetitionMandatoryWithSeparator(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)}visitRepetition(e){this.dslMethods.repetition.push(e)}visitAlternation(e){this.dslMethods.alternation.push(e)}};function ns(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}function rs(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}function _o(e,t){Object.defineProperty(e,"name",{enumerable:!1,configurable:!0,writable:!1,value:t})}function au(e,t){const n=Ae(e),r=n.length;for(let i=0;i<r;i++){const s=e[n[i]],o=s.length;for(let a=0;a<o;a++){const c=s[a];c.tokenTypeIdx===void 0&&this[c.name](c.children,t)}}}function cu(e,t){const n=function(){};_o(n,e+"BaseSemantics");const r={visit:function(i,s){if(D(i)&&(i=i[0]),!ze(i))return this[i.name](i.children,s)},validateVisitor:function(){const i=function(s,o){return function(a,c){const u=pe(c,f=>Ke(a[f])===!1),l=_(u,f=>({msg:`Missing visitor method: <${f}> on ${a.constructor.name} CST Visitor.`,type:Or.MISSING_METHOD,methodName:f}));return Gt(l)}(s,o)}(this,t);if(!G(i)){const s=_(i,o=>o.msg);throw Error(`Errors Detected in CST Visitor <${this.constructor.name}>:
	${s.join(`

`).replace(/\n/g,`
	`)}`)}}};return(n.prototype=r).constructor=n,n._RULE_NAMES=t,n}var Or;(function(e){e[e.REDUNDANT_METHOD=0]="REDUNDANT_METHOD",e[e.MISSING_METHOD=1]="MISSING_METHOD"})(Or||(Or={}));const Pn={description:"This Object indicates the Parser is during Recording Phase"};Object.freeze(Pn);const is=!0,ss=Math.pow(2,8)-1,Lo=P({name:"RECORDING_PHASE_TOKEN",pattern:oe.NA});zt([Lo]);const xo=Gr(Lo,`This IToken indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,-1,-1,-1,-1,-1,-1);Object.freeze(xo);const uu={name:`This CSTNode indicates the Parser is in Recording Phase
	See: https://chevrotain.io/docs/guide/internals.html#grammar-recording for details`,children:{}};function Ot(e,t,n,r=!1){An(n);const i=pt(this.recordingProdStack),s=Ke(t)?t:t.DEF,o=new e({definition:[],idx:n});return r&&(o.separator=t.SEP),L(t,"MAX_LOOKAHEAD")&&(o.maxLookahead=t.MAX_LOOKAHEAD),this.recordingProdStack.push(o),s.call(this),i.definition.push(o),this.recordingProdStack.pop(),Pn}function lu(e,t){An(t);const n=pt(this.recordingProdStack),r=D(e)===!1,i=r===!1?e:e.DEF,s=new _e({definition:[],idx:t,ignoreAmbiguities:r&&e.IGNORE_AMBIGUITIES===!0});L(e,"MAX_LOOKAHEAD")&&(s.maxLookahead=e.MAX_LOOKAHEAD);const o=to(i,a=>Ke(a.GATE));return s.hasPredicates=o,n.definition.push(s),k(i,a=>{const c=new ue({definition:[]});s.definition.push(c),L(a,"IGNORE_AMBIGUITIES")?c.ignoreAmbiguities=a.IGNORE_AMBIGUITIES:L(a,"GATE")&&(c.ignoreAmbiguities=!0),this.recordingProdStack.push(c),a.ALT.call(this),this.recordingProdStack.pop()}),Pn}function os(e){return e===0?"":`${e}`}function An(e){if(e<0||e>ss){const t=new Error(`Invalid DSL Method idx value: <${e}>
	Idx value must be a none negative value smaller than ${ss+1}`);throw t.KNOWN_RECORDER_ERROR=!0,t}}const cn=Gr(tt,"",NaN,NaN,NaN,NaN,NaN,NaN);Object.freeze(cn);const Be=Object.freeze({recoveryEnabled:!1,maxLookahead:3,dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:mo,nodeLocationTracking:"none",traceInitPerf:!1,skipValidations:!1}),tn=Object.freeze({recoveryValueFunc:()=>{},resyncEnabled:!0});var re,Zn;(function(e){e[e.INVALID_RULE_NAME=0]="INVALID_RULE_NAME",e[e.DUPLICATE_RULE_NAME=1]="DUPLICATE_RULE_NAME",e[e.INVALID_RULE_OVERRIDE=2]="INVALID_RULE_OVERRIDE",e[e.DUPLICATE_PRODUCTIONS=3]="DUPLICATE_PRODUCTIONS",e[e.UNRESOLVED_SUBRULE_REF=4]="UNRESOLVED_SUBRULE_REF",e[e.LEFT_RECURSION=5]="LEFT_RECURSION",e[e.NONE_LAST_EMPTY_ALT=6]="NONE_LAST_EMPTY_ALT",e[e.AMBIGUOUS_ALTS=7]="AMBIGUOUS_ALTS",e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]="CONFLICT_TOKENS_RULES_NAMESPACE",e[e.INVALID_TOKEN_NAME=9]="INVALID_TOKEN_NAME",e[e.NO_NON_EMPTY_LOOKAHEAD=10]="NO_NON_EMPTY_LOOKAHEAD",e[e.AMBIGUOUS_PREFIX_ALTS=11]="AMBIGUOUS_PREFIX_ALTS",e[e.TOO_MANY_ALTS=12]="TOO_MANY_ALTS",e[e.CUSTOM_LOOKAHEAD_VALIDATION=13]="CUSTOM_LOOKAHEAD_VALIDATION"})(re||(re={}));class Dt{static performSelfAnalysis(t){throw Error("The **static** `performSelfAnalysis` method has been deprecated.	\nUse the **instance** method with the same name instead.")}performSelfAnalysis(){this.TRACE_INIT("performSelfAnalysis",()=>{let t;this.selfAnalysisDone=!0;const n=this.className;this.TRACE_INIT("toFastProps",()=>{io(this)}),this.TRACE_INIT("Grammar Recording",()=>{try{this.enableRecording(),k(this.definedRulesNames,i=>{const s=this[i].originalGrammarAction;let o;this.TRACE_INIT(`${i} Rule`,()=>{o=this.topLevelRuleRecord(i,s)}),this.gastProductionsCache[i]=o})}finally{this.disableRecording()}});let r=[];if(this.TRACE_INIT("Grammar Resolving",()=>{r=eu({rules:Z(this.gastProductionsCache)}),this.definitionErrors=this.definitionErrors.concat(r)}),this.TRACE_INIT("Grammar Validations",()=>{if(G(r)&&this.skipValidations===!1){const s=(i={rules:Z(this.gastProductionsCache),tokenTypes:Z(this.tokensMap),errMsgProvider:nt,grammarName:n},qc((i=$r(i,{errMsgProvider:nt})).rules,i.tokenTypes,i.errMsgProvider,i.grammarName)),o=function(a){return _(a.lookaheadStrategy.validate({rules:a.rules,tokenTypes:a.tokenTypes,grammarName:a.grammarName}),c=>Object.assign({type:re.CUSTOM_LOOKAHEAD_VALIDATION},c))}({lookaheadStrategy:this.lookaheadStrategy,rules:Z(this.gastProductionsCache),tokenTypes:Z(this.tokensMap),grammarName:n});this.definitionErrors=this.definitionErrors.concat(s,o)}var i}),G(this.definitionErrors)&&(this.recoveryEnabled&&this.TRACE_INIT("computeAllProdsFollows",()=>{const i=function(s){const o={};return k(s,a=>{const c=new Rc(a).startWalking();he(o,c)}),o}(Z(this.gastProductionsCache));this.resyncFollows=i}),this.TRACE_INIT("ComputeLookaheadFunctions",()=>{var i,s;(s=(i=this.lookaheadStrategy).initialize)===null||s===void 0||s.call(i,{rules:Z(this.gastProductionsCache)}),this.preComputeLookaheadFunctions(Z(this.gastProductionsCache))})),!Dt.DEFER_DEFINITION_ERRORS_HANDLING&&!G(this.definitionErrors))throw t=_(this.definitionErrors,i=>i.message),new Error(`Parser Definition Errors detected:
 ${t.join(`
-------------------------------
`)}`)})}constructor(t,n){this.definitionErrors=[],this.selfAnalysisDone=!1;const r=this;if(r.initErrorHandler(n),r.initLexerAdapter(),r.initLooksAhead(n),r.initRecognizerEngine(t,n),r.initRecoverable(n),r.initTreeBuilder(n),r.initContentAssist(),r.initGastRecorder(n),r.initPerformanceTracer(n),L(n,"ignoredIssues"))throw new Error(`The <ignoredIssues> IParserConfig property has been deprecated.
	Please use the <IGNORE_AMBIGUITIES> flag on the relevant DSL method instead.
	See: https://chevrotain.io/docs/guide/resolving_grammar_errors.html#IGNORING_AMBIGUITIES
	For further details.`);this.skipValidations=L(n,"skipValidations")?n.skipValidations:Be.skipValidations}}Dt.DEFER_DEFINITION_ERRORS_HANDLING=!1,Zn=Dt,[class{initRecoverable(e){this.firstAfterRepMap={},this.resyncFollows={},this.recoveryEnabled=L(e,"recoveryEnabled")?e.recoveryEnabled:Be.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=su)}getTokenToInsert(e){const t=Gr(e,"",NaN,NaN,NaN,NaN,NaN,NaN);return t.isInsertedInRecovery=!0,t}canTokenTypeBeInsertedInRecovery(e){return!0}canTokenTypeBeDeletedInRecovery(e){return!0}tryInRepetitionRecovery(e,t,n,r){const i=this.findReSyncTokenType(),s=this.exportLexerState(),o=[];let a=!1;const c=this.LA(1);let u=this.LA(1);const l=()=>{const f=this.LA(0),h=this.errorMessageProvider.buildMismatchTokenMessage({expected:r,actual:c,previous:f,ruleName:this.getCurrRuleFullName()}),m=new ts(h,c,this.LA(0));m.resyncedTokens=Ft(o),this.SAVE_ERROR(m)};for(;!a;){if(this.tokenMatcher(u,r))return void l();if(n.call(this))return l(),void e.apply(this,t);this.tokenMatcher(u,i)?a=!0:(u=this.SKIP_TOKEN(),this.addToResyncTokens(u,o))}this.importLexerState(s)}shouldInRepetitionRecoveryBeTried(e,t,n){return n!==!1&&!this.tokenMatcher(this.LA(1),e)&&!this.isBackTracking()&&!this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t))}getFollowsForInRuleRecovery(e,t){const n=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(n)}tryInRuleRecovery(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){const n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new iu("sad sad panda")}canPerformInRuleRecovery(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)}canRecoverWithSingleTokenInsertion(e,t){if(!this.canTokenTypeBeInsertedInRecovery(e)||G(t))return!1;const n=this.LA(1);return mt(t,r=>this.tokenMatcher(n,r))!==void 0}canRecoverWithSingleTokenDeletion(e){return!!this.canTokenTypeBeDeletedInRecovery(e)&&this.tokenMatcher(this.LA(2),e)}isInCurrentRuleReSyncSet(e){const t=this.getCurrFollowKey();return ie(this.getFollowSetFromFollowKey(t),e)}findReSyncTokenType(){const e=this.flattenFollowSet();let t=this.LA(1),n=2;for(;;){const r=mt(e,i=>Ct(t,i));if(r!==void 0)return r;t=this.LA(n),n++}}getCurrFollowKey(){if(this.RULE_STACK.length===1)return Hn;const e=this.getLastExplicitRuleShortName(),t=this.getLastExplicitRuleOccurrenceIndex(),n=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(e),idxInCallingRule:t,inRule:this.shortRuleNameToFullName(n)}}buildFullFollowKeyStack(){const e=this.RULE_STACK,t=this.RULE_OCCURRENCE_STACK;return _(e,(n,r)=>r===0?Hn:{ruleName:this.shortRuleNameToFullName(n),idxInCallingRule:t[r],inRule:this.shortRuleNameToFullName(e[r-1])})}flattenFollowSet(){return Ne(_(this.buildFullFollowKeyStack(),e=>this.getFollowSetFromFollowKey(e)))}getFollowSetFromFollowKey(e){if(e===Hn)return[tt];const t=e.ruleName+e.idxInCallingRule+so+e.inRule;return this.resyncFollows[t]}addToResyncTokens(e,t){return this.tokenMatcher(e,tt)||t.push(e),t}reSyncTo(e){const t=[];let n=this.LA(1);for(;this.tokenMatcher(n,e)===!1;)n=this.SKIP_TOKEN(),this.addToResyncTokens(n,t);return Ft(t)}attemptInRepetitionRecovery(e,t,n,r,i,s,o){}getCurrentGrammarPath(e,t){return{ruleStack:this.getHumanReadableRuleStack(),occurrenceStack:ee(this.RULE_OCCURRENCE_STACK),lastTok:e,lastTokOccurrence:t}}getHumanReadableRuleStack(){return _(this.RULE_STACK,e=>this.shortRuleNameToFullName(e))}},class{initLooksAhead(e){this.dynamicTokensEnabled=L(e,"dynamicTokensEnabled")?e.dynamicTokensEnabled:Be.dynamicTokensEnabled,this.maxLookahead=L(e,"maxLookahead")?e.maxLookahead:Be.maxLookahead,this.lookaheadStrategy=L(e,"lookaheadStrategy")?e.lookaheadStrategy:new ou({maxLookahead:this.maxLookahead}),this.lookAheadFuncsCache=new Map}preComputeLookaheadFunctions(e){k(e,t=>{this.TRACE_INIT(`${t.name} Rule Lookahead`,()=>{const{alternation:n,repetition:r,option:i,repetitionMandatory:s,repetitionMandatoryWithSeparator:o,repetitionWithSeparator:a}=function(c){en.reset(),c.accept(en);const u=en.dslMethods;return en.reset(),u}(t);k(n,c=>{const u=c.idx===0?"":c.idx;this.TRACE_INIT(`${Le(c)}${u}`,()=>{const l=this.lookaheadStrategy.buildLookaheadForAlternation({prodOccurrence:c.idx,rule:t,maxLookahead:c.maxLookahead||this.maxLookahead,hasPredicates:c.hasPredicates,dynamicTokensEnabled:this.dynamicTokensEnabled}),f=Xn(this.fullRuleNameToShort[t.name],256,c.idx);this.setLaFuncCache(f,l)})}),k(r,c=>{this.computeLookaheadFunc(t,c.idx,768,"Repetition",c.maxLookahead,Le(c))}),k(i,c=>{this.computeLookaheadFunc(t,c.idx,512,"Option",c.maxLookahead,Le(c))}),k(s,c=>{this.computeLookaheadFunc(t,c.idx,Yn,"RepetitionMandatory",c.maxLookahead,Le(c))}),k(o,c=>{this.computeLookaheadFunc(t,c.idx,Jt,"RepetitionMandatoryWithSeparator",c.maxLookahead,Le(c))}),k(a,c=>{this.computeLookaheadFunc(t,c.idx,qn,"RepetitionWithSeparator",c.maxLookahead,Le(c))})})})}computeLookaheadFunc(e,t,n,r,i,s){this.TRACE_INIT(`${s}${t===0?"":t}`,()=>{const o=this.lookaheadStrategy.buildLookaheadForOptional({prodOccurrence:t,rule:e,maxLookahead:i||this.maxLookahead,dynamicTokensEnabled:this.dynamicTokensEnabled,prodType:r}),a=Xn(this.fullRuleNameToShort[e.name],n,t);this.setLaFuncCache(a,o)})}getKeyForAutomaticLookahead(e,t){return Xn(this.getLastExplicitRuleShortName(),e,t)}getLaFuncFromCache(e){return this.lookAheadFuncsCache.get(e)}setLaFuncCache(e,t){this.lookAheadFuncsCache.set(e,t)}},class{initTreeBuilder(e){if(this.CST_STACK=[],this.outputCst=e.outputCst,this.nodeLocationTracking=L(e,"nodeLocationTracking")?e.nodeLocationTracking:Be.nodeLocationTracking,this.outputCst)if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=rs,this.setNodeLocationFromNode=rs,this.cstPostRule=X,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=X,this.setNodeLocationFromNode=X,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=ns,this.setNodeLocationFromNode=ns,this.cstPostRule=X,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=X,this.setNodeLocationFromNode=X,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else{if(!/none/i.test(this.nodeLocationTracking))throw Error(`Invalid <nodeLocationTracking> config option: "${e.nodeLocationTracking}"`);this.setNodeLocationFromToken=X,this.setNodeLocationFromNode=X,this.cstPostRule=X,this.setInitialNodeLocation=X}else this.cstInvocationStateUpdate=X,this.cstFinallyStateUpdate=X,this.cstPostTerminal=X,this.cstPostNonTerminal=X,this.cstPostRule=X}setInitialNodeLocationOnlyOffsetRecovery(e){e.location={startOffset:NaN,endOffset:NaN}}setInitialNodeLocationOnlyOffsetRegular(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}}setInitialNodeLocationFullRecovery(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}}setInitialNodeLocationFullRegular(e){const t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}}cstInvocationStateUpdate(e){const t={name:e,children:Object.create(null)};this.setInitialNodeLocation(t),this.CST_STACK.push(t)}cstFinallyStateUpdate(){this.CST_STACK.pop()}cstPostRuleFull(e){const t=this.LA(0),n=e.location;n.startOffset<=t.startOffset==1?(n.endOffset=t.endOffset,n.endLine=t.endLine,n.endColumn=t.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)}cstPostRuleOnlyOffset(e){const t=this.LA(0),n=e.location;n.startOffset<=t.startOffset==1?n.endOffset=t.endOffset:n.startOffset=NaN}cstPostTerminal(e,t){const n=this.CST_STACK[this.CST_STACK.length-1];var r,i,s;i=t,s=e,(r=n).children[s]===void 0?r.children[s]=[i]:r.children[s].push(i),this.setNodeLocationFromToken(n.location,t)}cstPostNonTerminal(e,t){const n=this.CST_STACK[this.CST_STACK.length-1];(function(r,i,s){r.children[i]===void 0?r.children[i]=[s]:r.children[i].push(s)})(n,t,e),this.setNodeLocationFromNode(n.location,e.location)}getBaseCstVisitorConstructor(){if(ze(this.baseCstVisitorConstructor)){const e=cu(this.className,Ae(this.gastProductionsCache));return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor}getBaseCstVisitorConstructorWithDefaults(){if(ze(this.baseCstVisitorWithDefaultsConstructor)){const e=function(t,n,r){const i=function(){};_o(i,t+"BaseSemanticsWithDefaults");const s=Object.create(r.prototype);return k(n,o=>{s[o]=au}),(i.prototype=s).constructor=i,i}(this.className,Ae(this.gastProductionsCache),this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor}getLastExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-1]}getPreviousExplicitRuleShortName(){const e=this.RULE_STACK;return e[e.length-2]}getLastExplicitRuleOccurrenceIndex(){const e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]}},class{initLexerAdapter(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1}set input(e){if(this.selfAnalysisDone!==!0)throw Error("Missing <performSelfAnalysis> invocation at the end of the Parser's constructor.");this.reset(),this.tokVector=e,this.tokVectorLength=e.length}get input(){return this.tokVector}SKIP_TOKEN(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):cn}LA(e){const t=this.currIdx+e;return t<0||this.tokVectorLength<=t?cn:this.tokVector[t]}consumeToken(){this.currIdx++}exportLexerState(){return this.currIdx}importLexerState(e){this.currIdx=e}resetLexerState(){this.currIdx=-1}moveToTerminatedState(){this.currIdx=this.tokVector.length-1}getLexerPosition(){return this.exportLexerState()}},class{initRecognizerEngine(e,t){if(this.className=this.constructor.name,this.shortRuleNameToFull={},this.fullRuleNameToShort={},this.ruleShortNameIdx=256,this.tokenMatcher=Tn,this.subruleIdx=0,this.definedRulesNames=[],this.tokensMap={},this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache={},L(t,"serializedGrammar"))throw Error(`The Parser's configuration can no longer contain a <serializedGrammar> property.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_6-0-0
	For Further details.`);if(D(e)){if(G(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset=="number")throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://chevrotain.io/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(D(e))this.tokensMap=fe(e,(r,i)=>(r[i.name]=i,r),{});else if(L(e,"modes")&&Re(Ne(Z(e.modes)),Mc)){const r=mr(Ne(Z(e.modes)));this.tokensMap=fe(r,(i,s)=>(i[s.name]=s,i),{})}else{if(!Te(e))throw new Error("<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition");this.tokensMap=ee(e)}this.tokensMap.EOF=tt;const n=Re(L(e,"modes")?Ne(Z(e.modes)):Z(e),r=>G(r.categoryMatches));this.tokenMatcher=n?Tn:Ct,zt(Z(this.tokensMap))}defineRule(e,t,n){if(this.selfAnalysisDone)throw Error(`Grammar rule <${e}> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);const r=L(n,"resyncEnabled")?n.resyncEnabled:tn.resyncEnabled,i=L(n,"recoveryValueFunc")?n.recoveryValueFunc:tn.recoveryValueFunc,s=this.ruleShortNameIdx<<12;let o;return this.ruleShortNameIdx++,this.shortRuleNameToFull[s]=e,this.fullRuleNameToShort[e]=s,o=this.outputCst===!0?function(...a){try{this.ruleInvocationStateUpdate(s,e,this.subruleIdx),t.apply(this,a);const c=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(c),c}catch(c){return this.invokeRuleCatch(c,r,i)}finally{this.ruleFinallyStateUpdate()}}:function(...a){try{return this.ruleInvocationStateUpdate(s,e,this.subruleIdx),t.apply(this,a)}catch(c){return this.invokeRuleCatch(c,r,i)}finally{this.ruleFinallyStateUpdate()}},Object.assign(o,{ruleName:e,originalGrammarAction:t})}invokeRuleCatch(e,t,n){const r=this.RULE_STACK.length===1,i=t&&!this.isBackTracking()&&this.recoveryEnabled;if(Qt(e)){const s=e;if(i){const o=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(o)){if(s.resyncedTokens=this.reSyncTo(o),this.outputCst){const a=this.CST_STACK[this.CST_STACK.length-1];return a.recoveredNode=!0,a}return n(e)}if(this.outputCst){const a=this.CST_STACK[this.CST_STACK.length-1];a.recoveredNode=!0,s.partialCstResult=a}throw s}if(r)return this.moveToTerminatedState(),n(e);throw s}throw e}optionInternal(e,t){const n=this.getKeyForAutomaticLookahead(512,t);return this.optionInternalLogic(e,t,n)}optionInternalLogic(e,t,n){let r,i=this.getLaFuncFromCache(n);if(typeof e!="function"){r=e.DEF;const s=e.GATE;if(s!==void 0){const o=i;i=()=>s.call(this)&&o.call(this)}}else r=e;if(i.call(this)===!0)return r.call(this)}atLeastOneInternal(e,t){const n=this.getKeyForAutomaticLookahead(Yn,e);return this.atLeastOneInternalLogic(e,t,n)}atLeastOneInternalLogic(e,t,n){let r,i=this.getLaFuncFromCache(n);if(typeof t!="function"){r=t.DEF;const s=t.GATE;if(s!==void 0){const o=i;i=()=>s.call(this)&&o.call(this)}}else r=t;if(i.call(this)!==!0)throw this.raiseEarlyExitException(e,H.REPETITION_MANDATORY,t.ERR_MSG);{let s=this.doSingleRepetition(r);for(;i.call(this)===!0&&s===!0;)s=this.doSingleRepetition(r)}this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],i,Yn,e,Gc)}atLeastOneSepFirstInternal(e,t){const n=this.getKeyForAutomaticLookahead(Jt,e);this.atLeastOneSepFirstInternalLogic(e,t,n)}atLeastOneSepFirstInternalLogic(e,t,n){const r=t.DEF,i=t.SEP;if(this.getLaFuncFromCache(n).call(this)!==!0)throw this.raiseEarlyExitException(e,H.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG);{r.call(this);const s=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,s,r,Zi],s,Jt,e,Zi)}}manyInternal(e,t){const n=this.getKeyForAutomaticLookahead(768,e);return this.manyInternalLogic(e,t,n)}manyInternalLogic(e,t,n){let r,i=this.getLaFuncFromCache(n);if(typeof t!="function"){r=t.DEF;const o=t.GATE;if(o!==void 0){const a=i;i=()=>o.call(this)&&a.call(this)}}else r=t;let s=!0;for(;i.call(this)===!0&&s===!0;)s=this.doSingleRepetition(r);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],i,768,e,Wc,s)}manySepFirstInternal(e,t){const n=this.getKeyForAutomaticLookahead(qn,e);this.manySepFirstInternalLogic(e,t,n)}manySepFirstInternalLogic(e,t,n){const r=t.DEF,i=t.SEP;if(this.getLaFuncFromCache(n).call(this)===!0){r.call(this);const s=()=>this.tokenMatcher(this.LA(1),i);for(;this.tokenMatcher(this.LA(1),i)===!0;)this.CONSUME(i),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,i,s,r,Xi],s,qn,e,Xi)}}repetitionSepSecondInternal(e,t,n,r,i){for(;n();)this.CONSUME(t),r.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,n,r,i],n,Jt,e,i)}doSingleRepetition(e){const t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t}orInternal(e,t){const n=this.getKeyForAutomaticLookahead(256,t),r=D(e)?e:e.DEF,i=this.getLaFuncFromCache(n).call(this,r);if(i!==void 0)return r[i].ALT.call(this);this.raiseNoAltException(t,e.ERR_MSG)}ruleFinallyStateUpdate(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&this.isAtEndOfInput()===!1){const e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new nu(t,e))}}subruleInternal(e,t,n){let r;try{const i=n!==void 0?n.ARGS:void 0;return this.subruleIdx=t,r=e.apply(this,i),this.cstPostNonTerminal(r,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),r}catch(i){throw this.subruleInternalError(i,n,e.ruleName)}}subruleInternalError(e,t,n){throw Qt(e)&&e.partialCstResult!==void 0&&(this.cstPostNonTerminal(e.partialCstResult,t!==void 0&&t.LABEL!==void 0?t.LABEL:n),delete e.partialCstResult),e}consumeInternal(e,t,n){let r;try{const i=this.LA(1);this.tokenMatcher(i,e)===!0?(this.consumeToken(),r=i):this.consumeInternalError(e,i,n)}catch(i){r=this.consumeInternalRecovery(e,t,i)}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.name,r),r}consumeInternalError(e,t,n){let r;const i=this.LA(0);throw r=n!==void 0&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:t,previous:i,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new ts(r,t,i))}consumeInternalRecovery(e,t,n){if(!this.recoveryEnabled||n.name!=="MismatchedTokenException"||this.isBackTracking())throw n;{const r=this.getFollowsForInRuleRecovery(e,t);try{return this.tryInRuleRecovery(e,r)}catch(i){throw i.name===So?n:i}}}saveRecogState(){const e=this.errors,t=ee(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:t,CST_STACK:this.CST_STACK}}reloadRecogState(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK}ruleInvocationStateUpdate(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t)}isBackTracking(){return this.isBackTrackingStack.length!==0}getCurrRuleFullName(){const e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull[e]}shortRuleNameToFullName(e){return this.shortRuleNameToFull[e]}isAtEndOfInput(){return this.tokenMatcher(this.LA(1),tt)}reset(){this.resetLexerState(),this.subruleIdx=0,this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]}},class{ACTION(e){return e.call(this)}consume(e,t,n){return this.consumeInternal(t,e,n)}subrule(e,t,n){return this.subruleInternal(t,e,n)}option(e,t){return this.optionInternal(t,e)}or(e,t){return this.orInternal(t,e)}many(e,t){return this.manyInternal(e,t)}atLeastOne(e,t){return this.atLeastOneInternal(e,t)}CONSUME(e,t){return this.consumeInternal(e,0,t)}CONSUME1(e,t){return this.consumeInternal(e,1,t)}CONSUME2(e,t){return this.consumeInternal(e,2,t)}CONSUME3(e,t){return this.consumeInternal(e,3,t)}CONSUME4(e,t){return this.consumeInternal(e,4,t)}CONSUME5(e,t){return this.consumeInternal(e,5,t)}CONSUME6(e,t){return this.consumeInternal(e,6,t)}CONSUME7(e,t){return this.consumeInternal(e,7,t)}CONSUME8(e,t){return this.consumeInternal(e,8,t)}CONSUME9(e,t){return this.consumeInternal(e,9,t)}SUBRULE(e,t){return this.subruleInternal(e,0,t)}SUBRULE1(e,t){return this.subruleInternal(e,1,t)}SUBRULE2(e,t){return this.subruleInternal(e,2,t)}SUBRULE3(e,t){return this.subruleInternal(e,3,t)}SUBRULE4(e,t){return this.subruleInternal(e,4,t)}SUBRULE5(e,t){return this.subruleInternal(e,5,t)}SUBRULE6(e,t){return this.subruleInternal(e,6,t)}SUBRULE7(e,t){return this.subruleInternal(e,7,t)}SUBRULE8(e,t){return this.subruleInternal(e,8,t)}SUBRULE9(e,t){return this.subruleInternal(e,9,t)}OPTION(e){return this.optionInternal(e,0)}OPTION1(e){return this.optionInternal(e,1)}OPTION2(e){return this.optionInternal(e,2)}OPTION3(e){return this.optionInternal(e,3)}OPTION4(e){return this.optionInternal(e,4)}OPTION5(e){return this.optionInternal(e,5)}OPTION6(e){return this.optionInternal(e,6)}OPTION7(e){return this.optionInternal(e,7)}OPTION8(e){return this.optionInternal(e,8)}OPTION9(e){return this.optionInternal(e,9)}OR(e){return this.orInternal(e,0)}OR1(e){return this.orInternal(e,1)}OR2(e){return this.orInternal(e,2)}OR3(e){return this.orInternal(e,3)}OR4(e){return this.orInternal(e,4)}OR5(e){return this.orInternal(e,5)}OR6(e){return this.orInternal(e,6)}OR7(e){return this.orInternal(e,7)}OR8(e){return this.orInternal(e,8)}OR9(e){return this.orInternal(e,9)}MANY(e){this.manyInternal(0,e)}MANY1(e){this.manyInternal(1,e)}MANY2(e){this.manyInternal(2,e)}MANY3(e){this.manyInternal(3,e)}MANY4(e){this.manyInternal(4,e)}MANY5(e){this.manyInternal(5,e)}MANY6(e){this.manyInternal(6,e)}MANY7(e){this.manyInternal(7,e)}MANY8(e){this.manyInternal(8,e)}MANY9(e){this.manyInternal(9,e)}MANY_SEP(e){this.manySepFirstInternal(0,e)}MANY_SEP1(e){this.manySepFirstInternal(1,e)}MANY_SEP2(e){this.manySepFirstInternal(2,e)}MANY_SEP3(e){this.manySepFirstInternal(3,e)}MANY_SEP4(e){this.manySepFirstInternal(4,e)}MANY_SEP5(e){this.manySepFirstInternal(5,e)}MANY_SEP6(e){this.manySepFirstInternal(6,e)}MANY_SEP7(e){this.manySepFirstInternal(7,e)}MANY_SEP8(e){this.manySepFirstInternal(8,e)}MANY_SEP9(e){this.manySepFirstInternal(9,e)}AT_LEAST_ONE(e){this.atLeastOneInternal(0,e)}AT_LEAST_ONE1(e){return this.atLeastOneInternal(1,e)}AT_LEAST_ONE2(e){this.atLeastOneInternal(2,e)}AT_LEAST_ONE3(e){this.atLeastOneInternal(3,e)}AT_LEAST_ONE4(e){this.atLeastOneInternal(4,e)}AT_LEAST_ONE5(e){this.atLeastOneInternal(5,e)}AT_LEAST_ONE6(e){this.atLeastOneInternal(6,e)}AT_LEAST_ONE7(e){this.atLeastOneInternal(7,e)}AT_LEAST_ONE8(e){this.atLeastOneInternal(8,e)}AT_LEAST_ONE9(e){this.atLeastOneInternal(9,e)}AT_LEAST_ONE_SEP(e){this.atLeastOneSepFirstInternal(0,e)}AT_LEAST_ONE_SEP1(e){this.atLeastOneSepFirstInternal(1,e)}AT_LEAST_ONE_SEP2(e){this.atLeastOneSepFirstInternal(2,e)}AT_LEAST_ONE_SEP3(e){this.atLeastOneSepFirstInternal(3,e)}AT_LEAST_ONE_SEP4(e){this.atLeastOneSepFirstInternal(4,e)}AT_LEAST_ONE_SEP5(e){this.atLeastOneSepFirstInternal(5,e)}AT_LEAST_ONE_SEP6(e){this.atLeastOneSepFirstInternal(6,e)}AT_LEAST_ONE_SEP7(e){this.atLeastOneSepFirstInternal(7,e)}AT_LEAST_ONE_SEP8(e){this.atLeastOneSepFirstInternal(8,e)}AT_LEAST_ONE_SEP9(e){this.atLeastOneSepFirstInternal(9,e)}RULE(e,t,n=tn){if(ie(this.definedRulesNames,e)){const i={message:nt.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:re.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(i)}this.definedRulesNames.push(e);const r=this.defineRule(e,t,n);return this[e]=r,r}OVERRIDE_RULE(e,t,n=tn){const r=function(s,o,a){const c=[];let u;return ie(o,s)||(u=`Invalid rule override, rule: ->${s}<- cannot be overridden in the grammar: ->${a}<-as it is not defined in any of the super grammars `,c.push({message:u,type:re.INVALID_RULE_OVERRIDE,ruleName:s})),c}(e,this.definedRulesNames,this.className);this.definitionErrors=this.definitionErrors.concat(r);const i=this.defineRule(e,t,n);return this[e]=i,i}BACKTRACK(e,t){return function(){this.isBackTrackingStack.push(1);const n=this.saveRecogState();try{return e.apply(this,t),!0}catch(r){if(Qt(r))return!1;throw r}finally{this.reloadRecogState(n),this.isBackTrackingStack.pop()}}}getGAstProductions(){return this.gastProductionsCache}getSerializedGastProductions(){return _(Z(this.gastProductionsCache),rn)}},class{initErrorHandler(e){this._errors=[],this.errorMessageProvider=L(e,"errorMessageProvider")?e.errorMessageProvider:Be.errorMessageProvider}SAVE_ERROR(e){if(Qt(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:ee(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error("Trying to save an Error which is not a RecognitionException")}get errors(){return ee(this._errors)}set errors(e){this._errors=e}raiseEarlyExitException(e,t,n){const r=this.getCurrRuleFullName(),i=Nr(e,this.getGAstProductions()[r],t,this.maxLookahead)[0],s=[];for(let a=1;a<=this.maxLookahead;a++)s.push(this.LA(a));const o=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:i,actual:s,previous:this.LA(0),customUserDescription:n,ruleName:r});throw this.SAVE_ERROR(new ru(o,this.LA(1),this.LA(0)))}raiseNoAltException(e,t){const n=this.getCurrRuleFullName(),r=zr(e,this.getGAstProductions()[n],this.maxLookahead),i=[];for(let a=1;a<=this.maxLookahead;a++)i.push(this.LA(a));const s=this.LA(0),o=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:r,actual:i,previous:s,customUserDescription:t,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new tu(o,this.LA(1),s))}},class{initContentAssist(){}computeContentAssist(e,t){const n=this.gastProductionsCache[e];if(ze(n))throw Error(`Rule ->${e}<- does not exist in this grammar.`);return Eo([n],t,this.tokenMatcher,this.maxLookahead)}getNextPossibleTokenTypes(e){const t=ye(e.ruleStack),n=this.getGAstProductions()[t];return new $c(n,e).startWalking()}},class{initGastRecorder(e){this.recordingProdStack=[],this.RECORDING_PHASE=!1}enableRecording(){this.RECORDING_PHASE=!0,this.TRACE_INIT("Enable Recording",()=>{for(let e=0;e<10;e++){const t=e>0?e:"";this[`CONSUME${t}`]=function(n,r){return this.consumeInternalRecord(n,e,r)},this[`SUBRULE${t}`]=function(n,r){return this.subruleInternalRecord(n,e,r)},this[`OPTION${t}`]=function(n){return this.optionInternalRecord(n,e)},this[`OR${t}`]=function(n){return this.orInternalRecord(n,e)},this[`MANY${t}`]=function(n){this.manyInternalRecord(e,n)},this[`MANY_SEP${t}`]=function(n){this.manySepFirstInternalRecord(e,n)},this[`AT_LEAST_ONE${t}`]=function(n){this.atLeastOneInternalRecord(e,n)},this[`AT_LEAST_ONE_SEP${t}`]=function(n){this.atLeastOneSepFirstInternalRecord(e,n)}}this.consume=function(e,t,n){return this.consumeInternalRecord(t,e,n)},this.subrule=function(e,t,n){return this.subruleInternalRecord(t,e,n)},this.option=function(e,t){return this.optionInternalRecord(t,e)},this.or=function(e,t){return this.orInternalRecord(t,e)},this.many=function(e,t){this.manyInternalRecord(e,t)},this.atLeastOne=function(e,t){this.atLeastOneInternalRecord(e,t)},this.ACTION=this.ACTION_RECORD,this.BACKTRACK=this.BACKTRACK_RECORD,this.LA=this.LA_RECORD})}disableRecording(){this.RECORDING_PHASE=!1,this.TRACE_INIT("Deleting Recording methods",()=>{const e=this;for(let t=0;t<10;t++){const n=t>0?t:"";delete e[`CONSUME${n}`],delete e[`SUBRULE${n}`],delete e[`OPTION${n}`],delete e[`OR${n}`],delete e[`MANY${n}`],delete e[`MANY_SEP${n}`],delete e[`AT_LEAST_ONE${n}`],delete e[`AT_LEAST_ONE_SEP${n}`]}delete e.consume,delete e.subrule,delete e.option,delete e.or,delete e.many,delete e.atLeastOne,delete e.ACTION,delete e.BACKTRACK,delete e.LA})}ACTION_RECORD(e){}BACKTRACK_RECORD(e,t){return()=>!0}LA_RECORD(e){return cn}topLevelRuleRecord(e,t){try{const n=new Et({definition:[],name:e});return n.name=e,this.recordingProdStack.push(n),t.call(this),this.recordingProdStack.pop(),n}catch(n){if(n.KNOWN_RECORDER_ERROR!==!0)try{n.message=n.message+`
	 This error was thrown during the "grammar recording phase" For more info see:
	https://chevrotain.io/docs/guide/internals.html#grammar-recording`}catch{throw n}throw n}}optionInternalRecord(e,t){return Ot.call(this,ce,e,t)}atLeastOneInternalRecord(e,t){Ot.call(this,we,t,e)}atLeastOneSepFirstInternalRecord(e,t){Ot.call(this,Me,t,e,is)}manyInternalRecord(e,t){Ot.call(this,Q,t,e)}manySepFirstInternalRecord(e,t){Ot.call(this,Se,t,e,is)}orInternalRecord(e,t){return lu.call(this,e,t)}subruleInternalRecord(e,t,n){if(An(t),!e||L(e,"ruleName")===!1){const o=new Error(`<SUBRULE${os(t)}> argument is invalid expecting a Parser method reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw o.KNOWN_RECORDER_ERROR=!0,o}const r=pt(this.recordingProdStack),i=e.ruleName,s=new de({idx:t,nonTerminalName:i,label:n?.LABEL,referencedRule:void 0});return r.definition.push(s),this.outputCst?uu:Pn}consumeInternalRecord(e,t,n){if(An(t),!fo(e)){const s=new Error(`<CONSUME${os(t)}> argument is invalid expecting a TokenType reference but got: <${JSON.stringify(e)}>
 inside top level rule: <${this.recordingProdStack[0].name}>`);throw s.KNOWN_RECORDER_ERROR=!0,s}const r=pt(this.recordingProdStack),i=new K({idx:t,terminalType:e,label:n?.LABEL});return r.definition.push(i),xo}},class{initPerformanceTracer(e){if(L(e,"traceInitPerf")){const t=e.traceInitPerf,n=typeof t=="number";this.traceInitMaxIdent=n?t:1/0,this.traceInitPerf=n?t>0:t}else this.traceInitMaxIdent=0,this.traceInitPerf=Be.traceInitPerf;this.traceInitIndent=-1}TRACE_INIT(e,t){if(this.traceInitPerf===!0){this.traceInitIndent++;const n=new Array(this.traceInitIndent+1).join("	");this.traceInitIndent<this.traceInitMaxIdent&&console.log(`${n}--> <${e}>`);const{time:r,value:i}=ro(t),s=r>10?console.warn:console.log;return this.traceInitIndent<this.traceInitMaxIdent&&s(`${n}<-- <${e}> time: ${r}ms`),this.traceInitIndent--,i}return t()}}].forEach(e=>{const t=e.prototype;Object.getOwnPropertyNames(t).forEach(n=>{if(n==="constructor")return;const r=Object.getOwnPropertyDescriptor(t,n);r&&(r.get||r.set)?Object.defineProperty(Zn.prototype,n,r):Zn.prototype[n]=e.prototype[n]})});class hu extends Dt{constructor(t,n=Be){const r=ee(n);r.outputCst=!1,super(t,r)}}const fu=P({name:"WhiteSpace",pattern:/\s+/,group:oe.SKIPPED}),Co=P({name:"String",pattern:/"(""|[^"])*"/}),du=P({name:"SingleQuotedString",pattern:/'(''|[^'])*'/}),pu=P({name:"SheetQuoted",pattern:/'((?![\\/[\]*?:]).)+?'!/}),mu=P({name:"FunctionToken",pattern:/[A-Za-z_]+[A-Za-z_0-9.]*\(/}),ko=P({name:"NamedTableReference",pattern:/[A-Za-z_]+[A-Za-z_0-9.]*\[/}),Eu=P({name:"BracketedString",pattern:/\[([^[\]]*)\]/,longer_alt:[ko,Co]}),bo=P({name:"LiteralError",pattern:/#PARSE!|#NULL!|#DIV\/0!|#VALUE!|#NUM!|#FIELD!|#N\/A|#GETTING_DATA|#SPILL!|#CONNECT!|#BLOCKED!|#UNKNOWN!|#FIELD!|#CALC!|#BUSY!|#PYTHON!|#TIMEOUT!/}),Po=P({name:"RefError",pattern:/#REF!|#NAME\?/}),gu=P({name:"Sheet",pattern:/[A-Za-z_.\d\u007F-\uFFFF]+!/}),Tu=/^[a-zA-Z_][a-zA-Z0-9_.?]*:?/,wn=P({name:"Name",pattern:{exec:(e,t)=>{try{const n=Tu.exec(e.substring(t));if(n){const r=n[0];if(r.endsWith(":")){const i=r.length;return r[i-2]==="."?[r.substring(0,i-2)]:[r.substring(0,i-1)]}return[r]}}catch(n){console.warn("Error parsing name",n)}return null}},line_breaks:!1,start_chars_hint:(()=>{const e=[];for(let t=65;t<=90;t++)e.push(t);for(let t=97;t<=122;t++)e.push(t);for(let t=48;t<=57;t++)e.push(t);return e})()}),Au=P({name:"Cell",pattern:/[$]?[A-Za-z]{1,3}[$]?[1-9][0-9]*/,longer_alt:wn}),Iu=P({name:"Column",pattern:/[$]?[A-Za-z]{1,3}/,longer_alt:wn}),Nu=P({name:"AbsRow",pattern:/[$][0-9]+/,longer_alt:wn}),Ru=P({name:"NumberToken",pattern:/[0-9]+[.]?[0-9]*([eE][+-][0-9]+)?/}),Ou=P({name:"Boolean",pattern:/TRUE|FALSE/i}),yu=P({name:"Comma",pattern:/,/}),vu=P({name:"RangeUnion",pattern:/:/}),Su=P({name:"RangeTrimFull",pattern:/\.:\./}),_u=P({name:"RangeTrimLeading",pattern:/\.:/}),Lu=P({name:"RangeTrimTrailing",pattern:/:\./}),xu=P({name:"Semicolon",pattern:/;/}),Cu=P({name:"OpenParen",pattern:/\(/}),ku=P({name:"CloseParen",pattern:/\)/}),bu=P({name:"OpenSquareParen",pattern:/\[/}),Pu=P({name:"CloseSquareParen",pattern:/]/});P({name:"exclamationMark",pattern:/!/});const wu=P({name:"OpenCurlyParen",pattern:/{/}),Mu=P({name:"CloseCurlyParen",pattern:/}/}),Uu=P({name:"QuoteS",pattern:/'/}),as=P({name:"MulOp",pattern:/\*/}),Fu=P({name:"PlusOp",pattern:/\+/}),Du=P({name:"DivOp",pattern:/\//}),ju=P({name:"MinOp",pattern:/-/}),Bu=P({name:"ImplicitIntersectOp",pattern:/@/}),$u=P({name:"ConcatOp",pattern:/&/}),Wu=P({name:"ExOp",pattern:/\^/}),Gu=P({name:"PercentOp",pattern:/%/}),wo=P({name:"TableSpecifier",pattern:/#(All|Data|Headers|Totals|This Row)/i}),zu=P({name:"ArrayAnchorOp",pattern:/#/,longer_alt:[wo,bo,Po]}),Ku=P({name:"GtOp",pattern:/>/}),Vu=P({name:"EqOp",pattern:/=/}),Hu=P({name:"LtOp",pattern:/</}),Mo=[fu,Co,pu,du,mu,ko,Eu,bo,Po,gu,Au,Ou,Iu,Nu,wo,zu,Bu,wn,Ru,yu,Su,_u,Lu,vu,xu,Cu,ku,bu,Pu,wu,Mu,Uu,as,Fu,Du,ju,$u,Wu,as,Gu,P({name:"NeqOp",pattern:/<>/}),P({name:"GteOp",pattern:/>=/}),P({name:"LteOp",pattern:/<=/}),Ku,Vu,Hu],Yu=new oe(Mo,{ensureOptimizations:!0}),Vr={};Mo.forEach(e=>{Vr[e.name]=e});const qe={boolean:3,string:2,number:1},qu=(e,t)=>{let n=e+t;return n=Math.abs(n)<99e-14?0:n,isFinite(n)?n:Number.NaN},Xu=(e,t)=>{let n=e-t;return n=Math.abs(n)<99e-14?0:n,isFinite(n)?n:Number.NaN},Uo=(e,t)=>{let n=e*t;return n=Math.abs(n)<99e-14?0:n,isFinite(n)?n:Number.NaN},Fo=(e,t)=>{if(t===0)return 1/0;let n=e/t;return n=Math.abs(n)<99e-14?0:n,isFinite(n)?n:Number.NaN},Zu=(e,t)=>{const n=e**t;return isFinite(n)?n:Number.NaN},Qu=(e="",t="")=>(e===null&&(e=""),t===null&&(t=""),typeof e=="boolean"&&(e=e?"TRUE":"FALSE"),typeof t=="boolean"&&(t=t?"TRUE":"FALSE"),""+e+t),Ju=(e=null,t=null)=>typeof e==typeof t&&e===t,el=(e=null,t=null)=>typeof e!=typeof t||e!==t,tl=(e=null,t=null)=>{const n=typeof e,r=typeof t;return n===r?e>t:qe[n]>qe[r]},nl=(e=null,t=null)=>{const n=typeof e,r=typeof t;return n===r?e>=t:qe[n]>=qe[r]},rl=(e=null,t=null)=>{const n=typeof e,r=typeof t;return n===r?e<t:qe[n]<qe[r]},il=(e=null,t=null)=>{const n=typeof e,r=typeof t;return n===r?e<=t:qe[n]<=qe[r]},sl={type:rt.Number,coerce:!0,includeBoolean:!0,includeMistyped:!0,mismatchFill:U.BuiltIn.NA},ol={type:rt.String,coerce:!0,includeMistyped:!0,mismatchFill:U.BuiltIn.NA},Do={type:null,coerce:!0,includeMistyped:!0,mismatchFill:U.BuiltIn.NA},lt=(e,t,n,r)=>{if(t!==null&&t.colStart!==void 0&&(t=e.getValueAt(t.rowStart,t.colStart)),n!==null&&n.colStart!==void 0&&(n=e.getValueAt(n.rowStart,n.colStart)),typeof t=="number"&&typeof n=="number")return r(t,n);let i,s;return t?.isIRange?i=t:n?.isIRange&&(s=n),!i&&!s?(t=Pt(t,wt(t,!0),rt.Number,!0,!1),n=Pt(n,wt(n,!0),rt.Number,!0,!1),t instanceof U.Value?t:n instanceof U.Value?n:r(t,n)):(i||(i=e.getRange(t)),i.broadcast(n,r,sl).fillEmpty(0))},ct=(e,t,n,r)=>{let i,s;return t!==null&&t.colStart!==void 0&&(t=e.getValueAt(t.rowStart,t.colStart)),n!==null&&n.colStart!==void 0&&(n=e.getValueAt(n.rowStart,n.colStart)),t?.isIRange?(i=t,s=n):n?.isIRange&&(i=n,s=t),i?i.broadcast(s,r,Do):r(t,n)},cs=(e,t)=>{t==null&&(t=0);let n,r=1;if(e==="+")return t;if(e!=="-")throw new U.Value(`Unrecognized prefix: ${e}`);return r=-r,t?.isIRange&&(n=t),n?n.broadcast(r,Uo,Do):typeof(t=Pt(t,wt(t,!0),rt.Number))!="number"||isNaN(t)?U.BuiltIn.Value:t*r},yt=(e,t,n,r)=>{if(!t)return U.BuiltIn.Ref;if(t.isIReferenceRange&&(t=t.getCoords()),t.colStart===void 0)return U.BuiltIn.Ref;if(n.isIReferenceRange&&(n=n.getCoords()),n.colStart===void 0)return U.BuiltIn.Ref;const i=r(t,n);return i?e.getReference(i):U.BuiltIn.Null},al={"+":(e,t,n)=>lt(e,t,n,qu),"-":(e,t,n)=>lt(e,t,n,Xu),"*":(e,t,n)=>lt(e,t,n,Uo),"/":(e,t,n)=>lt(e,t,n,Fo),"^":(e,t,n)=>lt(e,t,n,Zu)," ":(e,t,n,r)=>yt(e,t,n,Ve.intersectRanges),":":(e,t,n,r)=>yt(e,t,n,Ve.unionRanges),".:.":(e,t,n,r)=>{const i=yt(e,t,n,Ve.unionRanges);return e.getFunction("TRIMRANGE").execute(i,3,3)},".:":(e,t,n,r)=>{const i=yt(e,t,n,Ve.unionRanges);return e.getFunction("TRIMRANGE").execute(i,1,1)},":.":(e,t,n,r)=>{const i=yt(e,t,n,Ve.unionRanges);return e.getFunction("TRIMRANGE").execute(i,2,2)},"&":(e,t,n)=>((r,i,s,o)=>{if(i!==null&&i.colStart!==void 0&&(i=r.getValueAt(i.rowStart,i.colStart)),s!==null&&s.colStart!==void 0&&(s=r.getValueAt(s.rowStart,s.colStart)),typeof i=="string"&&typeof s=="string")return o(i,s);let a,c;return i?.isIRange?a=i:s?.isIRange&&(c=s),a||c?(a||(a=r.getRange(i)),a.broadcast(s,o,ol)):o(i=Pt(i,wt(i,!0),rt.String),s=Pt(s,wt(s,!0),rt.String))})(e,t,n,Qu),"=":(e,t,n)=>ct(e,t,n,Ju),"<>":(e,t,n)=>ct(e,t,n,el),">":(e,t,n)=>ct(e,t,n,tl),"<":(e,t,n)=>ct(e,t,n,rl),">=":(e,t,n)=>ct(e,t,n,nl),"<=":(e,t,n)=>ct(e,t,n,il)},cl={"-":(e,t)=>cs("-",t),"+":(e,t)=>cs("+",t),"@":(e,t)=>{if(!t||!t.isIReferenceRange)return t;const n=t.getCoords(),r=t,i=e.getPosition(),s=r.getHeight(),o=r.getWidth();if(o>1&&s>1)return U.BuiltIn.Value;if(s>1){const a=i.rowIndex-n.rowStart;if(a>=0&&a<s)return r.getValueAt(a,0)}else{if(!(o>1))return r.getValueAt(0,0);{const a=i.colIndex-n.colStart;if(a>=0&&a<o)return r.getValueAt(0,a)}}return U.BuiltIn.Value}},ul={"%":(e,t)=>lt(e,t,100,Fo),"#":(e,t)=>e.getSpillAt(t.rowStart,t.colStart)||U.BuiltIn.Ref};function us(e){const t=(e=e.toUpperCase()).length;let n=0;for(let r=0;r<t;r++){const i=e.charCodeAt(r);isNaN(i)||(n+=(i-64)*26**(t-r-1))}return n}function Qn(e){return{type:"cell",value:Object.freeze({colIndex:e.colIndex,rowIndex:e.rowIndex,$colIndex:e.$colIndex||!1,$rowIndex:e.$rowIndex||!1}),inputs:null,isReference:!0}}function ls(e,t){const n=e.startsWith("$");n&&(e=e.substring(1));let r=parseInt(e)-1;return n||r===Number.MIN_SAFE_INTEGER||(r-=t.colIndex),{type:"cell",value:Object.freeze({colIndex:Number.MIN_SAFE_INTEGER,$colIndex:!1,rowIndex:r,$rowIndex:n}),inputs:null,isReference:!0}}function hs(e,t){return{type:"function",value:e=e.toUpperCase(),inputs:t}}function Jn(e,t){return{type:"tableReference",value:e,inputs:t}}function er(e){return{type:"tableSpecifier",value:e,inputs:null,isReference:!0}}function yr(e,t,n,r=!1){const i={type:"infix",value:e,inputs:[t,n]};return r&&(i.isReference=!0),i}function tr(e,t,n=!1){const r={type:"postfix",value:e,inputs:[t]};return n&&(r.isReference=!0),r}function _t(e,t,n=!1){const r={type:"prefix",value:e,inputs:[t]};return n&&(r.isReference=!0),r}function nr(e){return{type:"named",value:e,inputs:null,isReference:!0}}function fs(e){return{type:"number",value:Number(e),isLiteral:!0}}function rr(e){let t=e;const n=e&&e.length>1&&e[0]==='"'&&e[e.length-1]==='"';return n&&(t=e.substring(1,e.length-1)),{type:n?"quotedString":"string",value:t,isLiteral:!0}}function ds(e){return{type:"boolean",value:e==="TRUE"||e.toUpperCase()==="TRUE",isLiteral:!0}}function ps(e){return{type:"error",value:U.getBuiltInByLabel(e.toUpperCase()),isLiteral:!0}}function In(e){return{type:"error",value:e?U.getBuiltInByLabel(e.toUpperCase()):U.BuiltIn.Ref,inputs:null,isReference:!0}}function jt(e,t){return function n(r,i){const s=r.inputs;let o;if(s){const u=s.length;for(let l=0;l<u;l++){const f=s[l],h=n(f,r);h!==f&&(o||(o=[...s]),o[l]=h)}}const a=o?{...r,inputs:o}:r,c=t(a,i);return c===void 0?a:c}(e,void 0)||this}function un(e,t){let n=0,r=jt(e,d=>{const T={...d};return T.evalIndex=n++,T});const i=new Array(n),s=new Set,o=new Map;let a;const c=new Map,u=[],l=[];r=jt(r,(d,T)=>{const v=d.type,A=d.evalIndex;if(i[A]=null,d.isReference){const y=d,R={node:d,index:c.size,op:null,value:null,inputs:null};if(c.set(y,R),v==="cell"){const I=y.value;return I.$colIndex&&(R.hasHorizontalAbs=!0),I.$rowIndex&&(R.hasVerticalAbs=!0),R.value=o.size,o.set(y,o.size),s.add(R),d.refIndex=l.length,void l.push(R.index)}if(v==="infix"||v==="prefix"||v==="postfix"||v==="spill"){const I=y.inputs,O=I.length,M=d.value;R.op=M;const w=new Array(O);R.inputs=w;for(let F=0;F<O;F++){const $=I[F],x=c.get($);x&&(x.hasHorizontalAbs&&(R.hasHorizontalAbs=!0),x.hasVerticalAbs&&(R.hasVerticalAbs=!0)),w[F]=x?x.index:-1,s.delete(x)}if(s.add(R),jo.includes(M)){const F=I[0],$=!!F&&F.type==="cell",x=I[1],C=!!x&&x.type==="cell";$&&C&&(l.splice(x.refIndex,1),x.refIndex=F.refIndex,d.refIndex=F.refIndex,l[F.refIndex]=R.index)}else M==="#"&&(d.refIndex=I[0].refIndex);return void u.push(d)}if(v==="error"||v==="named"){a||(a=new Map);const I=y.value;let O=a.get(I);return R.op=v,O===void 0&&(O=a.size,a.set(I,O)),R.value=O,s.add(R),d.refIndex=l.length,void l.push(R.index)}v==="tableReference"&&(R.op=v),v==="tableSpecifier"&&(R.op=v),v==="structuredArg"&&(R.op=v)}else if(T&&T.isReference){const y=d,R={node:d,index:c.size,op:"function",value:d.value,inputs:null};c.set(y,R)}if(d.isLiteral)if(v!=="array")i[A]=d.value;else{const y=d.value,R=y.length,I=new Array(R);for(let O=0;O<R;O++){const M=y[O].value,w=M.length,F=new Array(w);for(let $=0;$<w;$++){const x=M[$];let C=x.value;if(x.type==="prefix"){const j=x.value;C=x.inputs[0].value,j==="-"&&(C=-C)}F[$]=C}I[O]=F}i[A]=zo(I)}else{if(v!=="empty")return u.push(d),d;i[A]=void 0}});const f=new Array(o.size);o.forEach((d,T)=>{const v=T.value,A=v.colIndex,y=v.rowIndex,R=v.$colIndex,I=v.$rowIndex,O={colStart:A,rowStart:y,colEnd:A,rowEnd:y,$colStart:R,$rowStart:I,$colEnd:R,$rowEnd:I};A===Number.MIN_SAFE_INTEGER&&(O.colEnd=Number.MAX_SAFE_INTEGER),y===Number.MIN_SAFE_INTEGER&&(O.rowEnd=Number.MAX_SAFE_INTEGER),v.sheetName&&(O.sheetName=v.sheetName),f[d]=O});const h=f.length,m=new Array(h);for(let d=0;d<h;d++)m[d]={colStart:0,rowStart:0,colEnd:0,rowEnd:0,sheetName:null};const g=new Array(c.size);let N;c.forEach(d=>{g[d.index]=d}),a&&(N=[],a.forEach((d,T)=>{N.push(T)}));const S=[];s.forEach(d=>{S.push(d.index)});const E=u.length;for(let d=0;d<E;d++){const T=u[d],v=T.type;if(v==="infix"){const A=T.value;T.fn=al[A]}else if(v==="prefix"){const A=T.value;T.fn=cl[A]}else if(v==="postfix"){const A=T.value;T.fn=ul[A]}}const p=function(d){const T=[],v=(R,I)=>{const O={type:R.type,value:R.value};R.evalIndex!==void 0&&(O.evalIndex=R.evalIndex),R.refIndex!==void 0&&(O.refIndex=R.refIndex),I&&(O.ctx=I),T.push(O)},A=(R,I,O,M)=>{if(I==null||T.length>1&&R==="whitespace"&&T[T.length-1].type==="whitespace")return;const w={type:R,value:I};O&&(w.ctx=O),M!==void 0&&(w.evalIndex=M),T.push(w)};(function R(I,O,M){const w=I.evalIndex??M??0,F=I.type,$=(x,C,j)=>{if(!x)return;const Y=x.length;for(let B=0;B<Y;B++)R(x[B],C,j),B<Y-1&&A("comma",",",C)};if(I.isLiteral){if(A("whitespace",I.wsBefore,O),F==="array"){A("type","{",O);const x=I.value,C=x.length;for(let j=0;j<C;j++){const Y=x[j],B=Y.value,te=B.length;for(let Ze=0;Ze<te;Ze++){const Tt=B[Ze];A("whitespace",Tt.wsBefore,O),R(Tt,O,w),A("whitespace",Tt.wsAfter,O),Ze<te-1&&A("comma",",",O)}j<C-1&&(A("whitespace",Y.wsBefore,O),A("comma",";",O),A("whitespace",Y.wsAfter,O))}I.error||A("type","}",O)}else F==="quotedString"&&(I={type:F,value:'"'+I.value+'"'}),v(I,O);A("whitespace",I.wsAfter,O)}else if(F==="infix")R(I.inputs[0],O,w),A("whitespace",I.wsBefore,O),v(I,O),A("whitespace",I.wsAfter,O),R(I.inputs[1],O,w);else if(F==="prefix")A("whitespace",I.wsBefore,O),v(I,O),A("whitespace",I.wsAfter,O),R(I.inputs[0],O,w);else if(F==="postfix")R(I.inputs[0],O,w),A("whitespace",I.wsBefore,O),v(I,O),A("whitespace",I.wsAfter,O);else{A("whitespace",I.wsBefore,O);const x=I.inputs;switch(F){case"function":v(I,O);const C={name:String(I.value),argIndex:-1};if(A("paren","(",C,I.evalIndex),x){const Y=x.length;for(let B=0;B<Y;B++){const te={...C,argIndex:B};R(x[B],te,w),B<Y-1&&A("comma",",",te)}}I.error||A("paren",")",C,I.evalIndex);break;case"cell":v(I,O);break;case"paren":A(F,"(",O,w),$(x,O,w),I.error||A(F,")",O,w);break;case"squareParen":A(F,"[",O,w),$(x,O,w),I.error||A(F,"]",O,w);break;case"tableReference":v(I,O);const j={name:String(I.value),argIndex:-1};if(A("paren","[",j),x){const Y=x.length;for(let B=0;B<Y;B++){const te={...j,argIndex:B};R(x[B],te,w),B<Y-1&&A("comma",",",te)}}I.error||A("paren","]",j);break;default:I.value!==void 0&&v(I,O),x&&x.forEach(Y=>R(Y,O,w))}A("whitespace",I.wsAfter,O)}})(d);const y=T.length;for(let R=0;R<y;R++){const I=T[R];if(I.type==="whitespace"&&I.evalIndex===void 0){const O=T[R+1];O&&O.evalIndex!==void 0&&(I.evalIndex=O.evalIndex)}}return T}(r);return{ast:r,evaluations:i,executions:u,precedentsAbsolute:m,precedentsExecute:g,precedentsNamed:N,precedentsRelative:f,precedentsRoot:S,references:l,tokens:p,error:t}}function ms(e,t){let n,r=-1,i="";Number.isSafeInteger(e.previousToken?.startLine)?(r=e.previousToken.startLine,n=e.previousToken.endColumn+1):Number.isSafeInteger(e.token?.startLine)&&(r=e.token.startLine,n=e.token.startColumn),r!==-1?(i+=`
`+t.split(`
`)[r-1]+`
`,i+=Array(n-1).fill(" ").join("")+`^
`,i+=`Error at position ${r}:${n}
`+e.message,e.errorLocation={line:r,column:n}):i=t+`
`+e.message;const s=new U.Parse(i);return s.details=e,s}const ir=function(e,t){return t.wsBefore&&(e.wsBefore=t.wsBefore),t.wsAfter&&(e.wsAfter=t.wsAfter),t.image&&(e.image=t.image),e},ll="_XLFN.",Es=Object.freeze([[":",".:.",".:",,":."],["^"],["*","/"],["+","-"],["&"],["<",">","=","<>","<=",">="]]),jo=Object.freeze([":",".:.",".:",,":."]),hl=Object.freeze([":"," ",".:.",".:",,":."]),fl=Object.freeze(["@"]),dl=Object.freeze(["#"]),sr=Object.freeze(hl.concat(fl).concat(dl)),{String:gs,SheetQuoted:pl,SingleQuotedString:ml,FunctionToken:El,NamedTableReference:gl,LiteralError:Ts,RefError:As,Cell:Tl,Sheet:Al,Name:Is,NumberToken:Ns,Boolean:Rs,Column:Il,AbsRow:Nl,ImplicitIntersectOp:or,Comma:ut,RangeUnion:Rl,RangeTrimFull:Ol,RangeTrimLeading:yl,RangeTrimTrailing:vl,Semicolon:Sl,OpenParen:_l,CloseParen:ar,OpenSquareParen:Os,CloseSquareParen:ys,OpenCurlyParen:Ll,CloseCurlyParen:xl,MulOp:Cl,PlusOp:cr,DivOp:kl,MinOp:ur,ConcatOp:bl,ExOp:Pl,PercentOp:wl,ArrayAnchorOp:vs,TableSpecifier:Ml,BracketedString:Ss,NeqOp:Ul,GteOp:Fl,LteOp:Dl,GtOp:jl,EqOp:Bl,LtOp:$l}=Vr;class Wl extends hu{constructor(){super(Vr,{nodeLocationTracking:"full",maxLookahead:1,skipValidations:!0,recoveryEnabled:!0}),this.position={colIndex:0,rowIndex:0},this.astErrors=[];const t=this,n=(r,i,s)=>{let o;t.CONSUME(i);const a=t.getLexerPosition();o=t.ACTION(()=>(o={type:r,value:null,inputs:null},this._ensureWhitespace(o,a,!0)));const c=[],u=t.SUBRULE(t.intersectOp);u&&c.push(u);const l=t.SUBRULE(t.group),f=t.OPTION(()=>this.CONSUME(s));return o=t.ACTION(()=>{if(l)for(let h=0;h<l.length;h++)c.push(l[h]);return o&&(f||this._reportError(o,"Missing closing parenthesis",a),o.inputs=c),this._ensureWhitespace(o,t.getLexerPosition(),!1,!0)}),o};t.RULE("infixOp",()=>{const r=[],i=[t.SUBRULE(t.postfixOp)];return t.MANY(()=>{const s=t.OR(t.c1||(t.c1=[{ALT:()=>t.CONSUME(Rl).image},{ALT:()=>t.CONSUME(cr).image},{ALT:()=>t.CONSUME(ur).image},{ALT:()=>t.CONSUME(Cl).image},{ALT:()=>t.CONSUME(kl).image},{ALT:()=>t.CONSUME(Pl).image},{ALT:()=>t.CONSUME(bl).image},{ALT:()=>t.CONSUME(jl).image},{ALT:()=>t.CONSUME(Bl).image},{ALT:()=>t.CONSUME($l).image},{ALT:()=>t.CONSUME(Ul).image},{ALT:()=>t.CONSUME(Fl).image},{ALT:()=>t.CONSUME(Dl).image},{ALT:()=>t.CONSUME(Ol).image},{ALT:()=>t.CONSUME(yl).image},{ALT:()=>t.CONSUME(vl).image}]));r.push([s,t.getLexerPosition(),sr.includes(s)]),i.push(t.SUBRULE2(t.postfixOp))}),t.ACTION(()=>{let s=r.length;const o=Es.length;for(let a=0;s>0&&a<o;a++){const c=Es[a];let u=r.length;for(let l=0;l<u;l++){const f=r[l],h=f[0];if(!c.includes(h))continue;let m=yr(h,i[l],i[l+1],f[2]);m=this._ensureWhitespace(m,f[1]),r.splice(l,1),i.splice(l,2,m),l--,u--,s--}}}),i[0]}),t.RULE("plusMinusOp",()=>t.OR([{ALT:()=>t.CONSUME(cr).image},{ALT:()=>t.CONSUME(ur).image}])),t.RULE("postfixOp",()=>{let r=t.SUBRULE(t.prefixOp);const i=[];return t.MANY(()=>{const s=t.OR([{ALT:()=>t.CONSUME(wl).image},{ALT:()=>t.CONSUME(vs).image}]);t.ACTION(()=>{i.push([s,t.getLexerPosition()])})}),t.ACTION(()=>{const s=i.length;if(s!==0)for(let o=0;o<s;o++){const a=i[o],c=a[0],u=a[1],l=sr.includes(c);r=tr(c,r,l),r=this._ensureWhitespace(r,u)}}),r}),t.RULE("prefixOp",()=>{const r=[];t.MANY(()=>{const s=t.OR([{ALT:()=>t.CONSUME(cr).image},{ALT:()=>t.CONSUME(ur).image},{ALT:()=>t.CONSUME(or).image}]);t.ACTION(()=>{r.push([s,t.getLexerPosition()])})});let i=t.SUBRULE(t.formula);return t.ACTION(()=>{const s=r.length;if(s!==0)for(let o=s-1;o>=0;o--){const a=r[o],c=a[0],u=a[1],l=sr.includes(c);i=_t(c,i,l),i=this._ensureWhitespace(i,u)}}),i}),t.RULE("intersectOp",()=>{const r=[t.SUBRULE(t.infixOp)];return t.MANY(()=>{t.OPTION({GATE:()=>{const i=t.LA(0);return t.LA(1).startOffset>i.endOffset+1},DEF:()=>{r.push(t.SUBRULE3(t.infixOp))}})}),t.ACTION(()=>{for(;r.length>1;){let i=r.length-1;for(let s=0;s<i;s++){const o=r[s],a=r[s+1],c=yr(" ",o,a,!0);if(delete o.wsAfter,a.wsBefore){const u=a.wsBefore.slice(0,-1),l=u.length;delete a.wsBefore,l>0&&(c.wsBefore=u)}s+1<i&&delete a.wsAfter,r.splice(s,2,c),s--,i--}}}),r[0]}),t.RULE("formula",()=>t.OR9([{ALT:()=>t.SUBRULE(t.referenceWithoutInfix)},{ALT:()=>t.SUBRULE(t.function)},{ALT:()=>t.SUBRULE(t.paren)},{ALT:()=>t.SUBRULE(t.namedTableReference)},{ALT:()=>t.SUBRULE(t.bracketedString)},{ALT:()=>t.SUBRULE(t.squareParen)},{ALT:()=>t.SUBRULE(t.literal)},{ALT:()=>t.SUBRULE(t.literalArray)}])),t.RULE("group",()=>{const r=[];return t.MANY(()=>{t.CONSUME(ut);const i=t.SUBRULE2(t.intersectOp);t.ACTION(()=>{r.push(i)})}),r}),t.RULE("paren",()=>n("paren",_l,ar)),t.RULE("literalArray",()=>{let r={type:"row",value:[],isLiteral:!0};t.CONSUME(Ll);const i=t.getLexerPosition();let s=t.ACTION(()=>this._ensureWhitespace({type:"array",value:[r],isLiteral:!0},i,!0));const o=t.SUBRULE(t.literalForArray);t.ACTION(()=>{r.value.push(o)}),t.MANY(()=>{const c=t.OR([{ALT:()=>t.CONSUME(ut).image},{ALT:()=>t.CONSUME(Sl).image}]),u=t.SUBRULE2(t.literalForArray);t.ACTION(()=>{c===","||(r={type:"row",value:[],isLiteral:!0},s.value.push(r)),r.value.push(u)})});const a=t.OPTION(()=>this.CONSUME(xl));return s=t.ACTION(()=>(a||this._reportError(s,"Missing closing parenthesis '}'",i),this._ensureWhitespace(s,t.getLexerPosition(),!1,!0))),s}),t.RULE("literalForArray",()=>t.OR([{ALT:()=>{const r=t.OPTION(()=>t.SUBRULE(t.plusMinusOp)),i=t.CONSUME(Ns),s=t.ACTION(()=>this._ensureWhitespace(fs(i.image),t.getLexerPosition()));return r?t.ACTION(()=>function(o,a){return{type:"prefix",value:o,inputs:[a]}}(r,s)):s}},{ALT:()=>{const r=t.CONSUME(gs);return t.ACTION(()=>this._ensureWhitespace(rr(r.image),t.getLexerPosition()))}},{ALT:()=>{const r=t.CONSUME(Rs);return t.ACTION(()=>this._ensureWhitespace(ds(r.image),t.getLexerPosition()))}},{ALT:()=>{const r=t.CONSUME(Ts);return t.ACTION(()=>this._ensureWhitespace(ps(r.image),t.getLexerPosition()))}},{ALT:()=>{const r=t.CONSUME(As);return t.ACTION(()=>this._ensureWhitespace(In(r.image),t.getLexerPosition()))}}])),t.RULE("literal",()=>t.OR([{ALT:()=>{const r=t.CONSUME(Ns);return t.ACTION(()=>this._ensureWhitespace(fs(r.image),t.getLexerPosition()))}},{ALT:()=>{const r=t.CONSUME(gs);return t.ACTION(()=>this._ensureWhitespace(rr(r.image),t.getLexerPosition()))}},{ALT:()=>{const r=t.CONSUME(Rs);return t.ACTION(()=>this._ensureWhitespace(ds(r.image),t.getLexerPosition()))}},{ALT:()=>{const r=t.CONSUME(Ts);return t.ACTION(()=>this._ensureWhitespace(ps(r.image),t.getLexerPosition()))}}])),t.RULE("function",()=>{const r=t.CONSUME(El).image.slice(0,-1),i=t.getLexerPosition(),s=t.SUBRULE(t.functionArguments);let o=t.ACTION(()=>this._ensureWhitespace(hs(r,s),i,!0));const a=t.OPTION(()=>this.CONSUME(ar));return o=t.ACTION(()=>(a||this._reportError(o,"Missing closing parenthesis ')'",i),this._ensureWhitespace(o,t.getLexerPosition(),!1,!0))),o}),t.RULE("functionArguments",()=>{const r=[];return t.MANY2(()=>{let i;t.CONSUME2(ut),i=t.ACTION(()=>this._ensureWhitespace({type:"empty",value:""},t.getLexerPosition(),!1,!0)),r.push(i)}),t.OPTION(()=>{r.push(t.SUBRULE(t.intersectOp)),t.MANY(()=>{let i;t.CONSUME1(ut),i=t.ACTION(()=>this._ensureWhitespace({type:"empty",value:""},t.getLexerPosition(),!1,!0)),r.push(i),t.OPTION3(()=>{r.pop(),r.push(t.SUBRULE2(t.intersectOp))})})}),r}),t.RULE("bracketedString",()=>{const r=t.CONSUME(Ss),i=t.getLexerPosition();return t.ACTION(()=>{const s=r.image;let o=Jn("",[er(s.substring(1,s.length-1))]);return o=this._ensureWhitespace(o,i,!0,!1),o=this._ensureWhitespace(o,t.getLexerPosition(),!1,!0),o})}),t.RULE("squareParen",()=>{t.CONSUME(Os);const r=t.getLexerPosition();let i=Jn("",[t.SUBRULE(t.structuredArgument)]);const s=t.OPTION(()=>this.CONSUME(ys));return t.ACTION(()=>{s||this._reportError(i,"Missing closing parenthesis ']'",r),i=this._ensureWhitespace(i,r,!0,!1),i=this._ensureWhitespace(i,t.getLexerPosition(),!1,!0)}),i}),t.RULE("namedTableReference",()=>{const r=t.CONSUME(gl).image.slice(0,-1),i=t.getLexerPosition(),s=t.SUBRULE(t.structuredArguments);let o=t.ACTION(()=>this._ensureWhitespace(Jn(r,s),i,!0));const a=t.OPTION(()=>this.CONSUME(ys));return o=t.ACTION(()=>(a||this._reportError(o,"Missing closing parenthesis ']'",i),this._ensureWhitespace(o,t.getLexerPosition(),!1,!0))),o}),t.RULE("structuredArguments",()=>{const r=[];return t.MANY2(()=>{t.CONSUME2(ut),t.ACTION(()=>{r.push(this._ensureWhitespace({type:"empty",value:""},t.getLexerPosition(),!1,!0))})}),t.OPTION(()=>{const i=t.SUBRULE(t.structuredArgument);t.ACTION(()=>{i&&r.push(i)}),t.MANY(()=>{t.CONSUME1(ut),t.OPTION3(()=>{let s=t.SUBRULE2(t.structuredArgument);t.ACTION(()=>{s||(s=this._ensureWhitespace({type:"empty",value:""},t.getLexerPosition(),!1,!0)),r.push(s)})})})}),r}),t.RULE("structuredArgument",()=>{const r=t.OPTION(()=>t.CONSUME(or)),i=t.getLexerPosition(),s=t.OPTION2(()=>this.CONSUME(Os));let o=t.OR([{ALT:()=>{const a=t.CONSUME(Ml);return t.ACTION(()=>this._ensureWhitespace(er(a.image),t.getLexerPosition()))}},{ALT:()=>{const a=t.CONSUME(Ss);return t.ACTION(()=>this._ensureWhitespace(er(a.image),t.getLexerPosition()))}},{ALT:()=>{const a=t.CONSUME(Is);return t.ACTION(()=>this._ensureWhitespace(nr(a.image),t.getLexerPosition()))}},{ALT:()=>{const a=t.CONSUME(ml);return t.ACTION(()=>this._ensureWhitespace(rr(a.image),t.getLexerPosition()))}}]);if(s){const a=t.OPTION3(()=>this.CONSUME(ar));t.ACTION(()=>(a||this._reportError(o,"Missing closing parenthesis ']'",i),this._ensureWhitespace(o,t.getLexerPosition(),!1,!0))),o={type:"structuredArg",value:null,inputs:[o]}}return t.ACTION(()=>{r&&(o=_t(r.image,o,!0),o=this._ensureWhitespace(o,t.getLexerPosition()))}),o}),t.RULE("referenceWithoutInfix",()=>t.OR([{ALT:()=>t.SUBRULE(t.reference)},{ALT:()=>{const r=t.SUBRULE(t.prefixSheetName),i=t.SUBRULE2(t.formula);return t.ACTION(()=>{if((s=i)&&s.isFormulaError)return i;var s;i.ref&&(i.ref.sheet=r)}),i}}])),t.RULE("reference",()=>{const r=t.OPTION4(()=>t.CONSUME(or));let i=t.OR([{ALT:()=>{const s=t.CONSUME(Tl),o=t.getLexerPosition(),a=t.OPTION(()=>t.CONSUME(vs));return t.ACTION(()=>{const c=this._ensureWhitespace(function(u,l){const f=u.match(/([$]?)([A-Za-z]{1,3})([$]?)([1-9][0-9]*)/);let h=us(f[2])-1;const m=f[1].length===1;let g=+f[4]-1;const N=f[3].length===1;return m||h===Number.MIN_SAFE_INTEGER||(h-=l.colIndex),N||g===Number.MIN_SAFE_INTEGER||(g-=l.rowIndex),{type:"cell",value:Object.freeze({colIndex:h,rowIndex:g,$colIndex:m,$rowIndex:N}),inputs:null,isReference:!0}}(s.image,t.position),o);return a?this._ensureWhitespace(tr("#",c,!0),o):c})}},{ALT:()=>{const s=t.CONSUME(Is);return t.ACTION(()=>this._ensureWhitespace(nr(s.image),t.getLexerPosition()))}},{ALT:()=>{const s=t.CONSUME(Il);return t.ACTION(()=>this._ensureWhitespace(function(o,a){const c=o.startsWith("$");c&&(o=o.substring(1));let u=us(o)-1;return c||u===Number.MIN_SAFE_INTEGER||(u-=a.colIndex),{type:"cell",value:Object.freeze({colIndex:u,rowIndex:Number.MIN_SAFE_INTEGER,$colIndex:c,$rowIndex:!1}),inputs:null,isReference:!0}}(s.image,t.position),t.getLexerPosition()))}},{ALT:()=>{const s=t.CONSUME(Nl);return t.ACTION(()=>this._ensureWhitespace(ls(s.image,t.position),t.getLexerPosition()))}},{ALT:()=>{const s=t.CONSUME(As);return t.ACTION(()=>this._ensureWhitespace(In(s.image),t.getLexerPosition()))}}]);return t.ACTION(()=>{r&&(i=_t(r,i,!0),i=this._ensureWhitespace(i,t.getLexerPosition()))}),i}),t.RULE("prefixSheetName",()=>t.OR([{ALT:()=>t.CONSUME(Al).image.slice(0,-1)},{ALT:()=>t.CONSUME(pl).image.slice(1,-2).replace(/''/g,"'")}])),t.performSelfAnalysis()}_reportError(t,n,r=void 0,i="SyntaxError"){r===void 0&&(r=this.getLexerPosition()),t.error=!0,this.astErrors.push({name:i,message:n,previousToken:this.input[r],ast:t})}_ensureWhitespace(t,n,r=!1,i=!1){if(!t)return console.warn("node is null"),t;const s=this.input,o=s[n];if(t.image||(t.image=o.image),!i){const a=o.startOffset,c=s[n-1],u=c?.endOffset??-1;u+1<a&&(t.wsBefore=" ".repeat(a-u-1))}if(!r){const a=o.endOffset,c=s[n+1],u=c?.startOffset??this.inputTextLength;a+1<u&&(t.wsAfter=" ".repeat(u-a-1))}return t}_createAST(t,n){const r=function(a){const c=Yu.tokenize(a);if(c.errors.length>0){const u=c.errors[0],l=u.line,f=u.column;let h=`
`+a.split(`
`)[l-1]+`
`;throw h+=Array(f-1).fill(" ").join("")+`^
`,u.message=h+`Error at position ${l}:${f}
`+u.message,u.errorLocation={line:l,column:f},new U.Parse(u.message,{line:l,column:f,offset:u.offset,length:u.length})}return c}(n);let i;if(!r)return i={type:"text",value:n},i;const s=r.tokens;this.input=s,this.inputTextLength=n.length;const o=t.getPosition();return this.position=o,this.astErrors=[],this.reset(),i=this.intersectOp(),i=jt(i,(a,c)=>{let u=a.type;if(u==="function"&&a.value&&a.value.toUpperCase().startsWith(ll)){const l=a.value.substring(6);let f=a.image.substring(6),h=a;l==="ANCHORARRAY"?(h=tr("#",a.inputs[0],!0),f="#"):l==="SINGLE"?(h=_t("@",a.inputs[0],!0),f="@"):h=hs(l,a.inputs),ir(h,a),h.image=f,u=(a=h).type}if(c?.isReference){const l=c.value;if((l===":"||l===".:."||l===".:"||l===":.")&&Number.isInteger(a.value)){const f=c.inputs[0]===a?c.inputs[1]:c.inputs[0];if(f&&Number.isInteger(f.value)){const h=ls(a.image,o);return ir(h,a),h}}}else if(u==="cell"){const l=a.value;if(l.rowIndex===Number.MIN_SAFE_INTEGER||l.colIndex>=16384){const f=nr(a.image);return ir(f,a),f}}return a}),i}build(t,n){if(n.length===0)throw Error("Input must not be empty.");let r,i,s;try{r=this._createAST(t,n)}catch(c){s=c instanceof U.Parse?c:new U.Parse(c.message,c)}const o=this.errors;o.length>0&&(s=ms(o[0],n));const a=this.astErrors;return a.length>0&&(s=ms(a[0],n)),i=r?un(r,s):{ast:null,evaluations:le.EmptyArray,executions:le.EmptyArray,precedentsAbsolute:le.EmptyArray,precedentsExecute:le.EmptyArray,precedentsNamed:null,precedentsRelative:le.EmptyArray,precedentsRoot:le.EmptyArray,references:le.EmptyArray,tokens:le.EmptyArray,error:s},i}}class bt{constructor(t,n){this._options=t,this._compiled=n}getTextAt(t,n,r=!1){return r?Kt(this._compiled.tokens):$o(this._compiled.tokens,t,n)}getTokens(){return this._compiled.tokens}getError(){return this._compiled.error??null}isEquals(t){if(!(t&&t instanceof bt))return!1;if(this===t)return!0;const n=this._compiled.tokens,r=t._compiled.tokens;return n.length!==r.length?!1:Kt(n)===Kt(r)}getReferences(){const t=this._compiled,n=t.references,r=n.length;if(r===0)return le.EmptyArray;const i=t.precedentsExecute,s=t.precedentsRelative,o=new Array(r);for(let a=0;a<r;a++){const c=i[n[a]],u=c.inputs;if(u&&u.length===2){const l=s[i[u[0]].value],f=s[i[u[1]].value];o[a]={colStart:l.colStart,rowStart:l.rowStart,colEnd:f.colEnd,rowEnd:f.rowEnd,$colStart:l.$colStart,$rowStart:l.$rowStart,$colEnd:f.$colEnd,$rowEnd:f.$rowEnd,sheetName:l.sheetName}}else if(c.node.type==="cell"){const l=s[c.value];o[a]={...l}}else if(c.op==="named"){const l=t.precedentsNamed;o[a]=l[c.value]}else c.op==="error"&&(o[a]=c.node.value)}return o}setReferenceAt(t,n){const r=this._compiled,i=r.references;if(i.length===0)return le.EmptyArray;const s=r.precedentsExecute,o=i[t];if(o===void 0)throw new Error(`Invalid reference index: ${t}`);const a=s[o],c=a.node,u=c.inputs??le.EmptyArray;let l,f,h=!1;n&&(l={colIndex:n.colStart,rowIndex:n.rowStart,$colIndex:n.$colStart??!1,$rowIndex:n.$rowStart??!1},n.sheetName&&(l.sheetName=n.sheetName),h=!Ve.isSingleCell(n),h&&(f={colIndex:n.colEnd,rowIndex:n.rowEnd,$colIndex:n.$colEnd??!1,$rowIndex:n.$rowEnd??!1},n.colEnd===Number.MAX_SAFE_INTEGER&&(f.colIndex=Number.MIN_SAFE_INTEGER),n.rowEnd===Number.MAX_SAFE_INTEGER&&(f.rowIndex=Number.MIN_SAFE_INTEGER)));const m=u.length===2;let g=-1,N=-1;if(m)g=u[0].evalIndex,N=u[1].evalIndex;else{if(c.type!=="cell")throw a.op==="named"?new Error("Cannot setReference for a named reference"):new Error(`Invalidate reference index: ${t}`);g=c.evalIndex}const S=this._compiled.ast,E=jt(S,T=>{if(!T||!T.isReference)return;const v=T.type;if(!n&&jo.includes(T.value)){const I=u[0],O=u[1];let M=I.evalIndex===g,w=O.evalIndex===N;if(M||w){const F=In();return F.image="#REF!",F}}if(!(v==="cell"||v==="error"))return;const A=T.evalIndex;let y,R=A===g;if(R||A===N){if(n)if(m===h){let I=R?l:f;y={...T},y.value=I,y.image=null}else y=h?yr(":",Qn(l),Qn(f),!0):Qn(l);else y=In(),y.image="#REF!";return y}});if(E===S)return this;const p=un(E,this._compiled.error),d=this._options;return new bt(d,p)}_resolveNamed(t,n,r,i){const s=this._options?.getNamed;if(!s)return U.BuiltIn.Name;let o=s?.(t,this._options.getSheetName?.())?.[0];return o?(o.isFormulaError||(o=Un(o,n,r,i)),o):U.BuiltIn.Name}getDirectPrecedentsAt(t,n,r=!1,i,s){const o=this._compiled,a=o.precedentsRoot,c=a.length;if(c===0)return le.EmptyArray;const u=o.precedentsRelative,l=o.precedentsAbsolute,f=u.length;for(let E=0;E<f;E++){const p=u[E];let d=l[E],T=Un(p,t,n,d);l[E]=T}let h=!1;const m=o.precedentsExecute,g=m.length,N=vr;for(let E=0;E<g;E++){const p=m[E],d=p.op;if(!d){const R=l[p.value];N[p.index]=R;continue}if(d==="named"){h=!0,N[p.index]=this._resolveNamed(p.node.value,t,n);continue}if(d==="error"){N[p.index]=p.node.value;continue}if(d==="@"||d==="#"){N[p.index]=N[p.inputs[0]];continue}const T=p.inputs;if(!T)continue;let v=N[T[0]];if(v===void 0){N[p.index]=U.BuiltIn.Value;continue}if(v.isFormulaError){N[p.index]=v;continue}let A,y=N[T[1]];y!==void 0?y.isFormulaError?N[p.index]=y:(d===" "?A=Ve.intersectRanges(v,y):d!==":"&&d!==".:."&&d!==":."&&d!==".:"||(A=N[p.index]=Ve.unionRanges(v,y)),N[p.index]=A??U.BuiltIn.Null):N[p.index]=U.BuiltIn.Value}const S=new Array(c);for(let E=0;E<c;E++){const p=a[E],d=N[p];if(S[E]=d?.rowStart!==void 0?{...d}:d,i||s){const T=m[p];h&&T.op==="named"?(i&&(i[E]=d.$colStart||d.$colEnd),s&&(s[E]=d.$rowStart||d.$rowEnd)):(i&&(i[E]=T.hasVerticalAbs),s&&(s[E]=T.hasHorizontalAbs))}}return S}evaluate(t,n,r){const i=t.getPosition(),s=i?.rowIndex??0,o=i?.colIndex??0;let a=this._compiled;if(n!==void 0){let A;if(jt(a.ast,y=>{y.evalIndex===n&&(A=y)}),!A)throw new Error(`Invalid evalIndex: ${n}`);a=un(A,a.error)}if(a.error)return a.error;const c=a.evaluations,u=a.executions;let l,f;r||(r=this._resolvePrecedents(t));const h=a.precedentsExecute,m=a.precedentsRelative,g=a.precedentsAbsolute,N=h.length;for(let A=0;A<N;A++){const y=h[A],R=y.op;if(R){if(R==="named"){const I=y.node;let O=this._resolveNamed(y.node.value,s,o);O?.colStart!==void 0&&(O=t.getReference(O)),c[I.evalIndex]=O}else if(R==="error"){const I=y.node;c[I.evalIndex]=y.node.value}}else{const I=m[y.value];let O=g[A];const M=Un(I,s,o,O),w=y.node;c[w.evalIndex]=M}}const S=a.precedentsRoot,E=S.length;if(E!==r.length)return U.BuiltIn.Parse;for(let A=0;A<E;A++){const y=h[S[A]].node;let R=r[A];R.isIRange&&y.type==="cell"&&R.size>1&&(R=R.getValueAt(0,0)??null),c[y.evalIndex]=R}let p;const d=A=>{const y=A.inputs,R=y?y.length:0;let I;switch(A.type){case"infix":const O=A.value;let M=c[y[0].evalIndex],w=c[y[1].evalIndex];if(O==="+"&&typeof M=="number"&&typeof w=="number"){const C=M+w;return Math.abs(C)<99e-14?0:C}if(O==="-"&&typeof M=="number"&&typeof w=="number"){const C=M-w;return Math.abs(C)<99e-14?0:C}if(M&&M.isFormulaError)return M;if(w&&w.isFormulaError)return w;const F=A.fn;return I=F?F(t,M,w):U.BuiltIn.Value,I=Vt(I,null),I;case"function":p||(p=new Array(R)),p.length!==R&&(p.length=R);for(let C=0;C<R;C++)p[C]=c[y[C].evalIndex];return I=this._callFunction(t,A,p),I&&typeof I.then=="function"?I.then(C=>{C=Vt(C,t),I instanceof U.Known&&(f=I),c[A.evalIndex]=C}).catch(C=>{const j=C instanceof U.Known?C:new U.Value("Uncaught error",{cause:C});c[A.evalIndex]=j}):I instanceof U.Known&&(f=I),I;case"prefix":case"postfix":let $=c[y[0].evalIndex];if($&&$.isFormulaError)return $;const x=A.fn;return I=x?x(t,$):U.BuiltIn.Value,I;case"paren":if(R===1)return c[y[0].evalIndex];{const C=new Array(R);for(let j=0;j<R;j++)C[j]=c[y[j].evalIndex];return C}case"named":return null;case"empty":return}};let T=u.length;for(let A=0;A<T;A++){const y=u[A];if(f)return f;if(l)l=l.then(()=>{const R=d(y);return c[y.evalIndex]=R,R});else{const R=d(y);c[y.evalIndex]=R,R&&typeof R.then=="function"&&(l=R)}}if(l)return l.then(()=>{const A=c[c.length-1];return this._finalizeReturnValue(t,A)});const v=c[c.length-1];return this._finalizeReturnValue(t,v)}_resolvePrecedents(t){const n=t.getPosition(),r=n?.rowIndex??0,i=n?.colIndex??0,s=this.getDirectPrecedentsAt(r,i),o=s.length;let a;if(o>0){a=new Array(o);for(let c=0;c<o;c++){const u=s[c];if(u instanceof U.Known)a[c]=u;else if(Array.isArray(u)){const l=new Array(u.length);for(let f=0;f<u.length;f++)l[f]=t.getReference(u[f]);a[c]=l}else a[c]=t.getReference(u)}}else a=le.EmptyArray;return a}wrapImplicit(t,n,r){const i=this._compiled.ast;if(!i||!i.isReference)return this;if(i.type==="cell")return this;if(i.value==="@")return this;if(!r)return this;const s=Wo(n)+Go(t);if(r.has(s))return this;const o=un(_t("@",i,!0),this._compiled.error);return new bt(this._options,o)}_callFunction(t,n,r){const i=n?.cacheFn??t.getFunction(n.value);if(!i)return new U.Parse;const s=i.isBuiltIn();let o;s?n.cacheFn=i:this._context=t;try{o=i.execute(...r)}catch(a){o=a instanceof U.Known?a:new U.Value(a.message,{cause:a})}return s||(this._context=null),o===void 0?new U.Parse:o}_finalizeReturnValue(t,n){if(n&&n.colStart!==void 0&&(n=t.getValueAt(n.rowStart,n.colStart)),Array.isArray(n))if(n.length===1&&Array.isArray(n[0])&&n[0].length===1)n=n[0][0],Array.isArray(n)&&(n=U.BuiltIn.Value);else try{n=t.getRange(n)}catch{n=U.BuiltIn.Value}return n?.isIRange?n.size===1?(n=n.getValueAt(0,0,Gl),(n=Vt(n,t))===null&&(n=0)):n=n.fillEmpty(0):(n=Vt(n,t))===null&&(n=0),n}get[Symbol.toStringTag](){return"[FormulaBlock]"}toString(){const t=this._compiled;if(t.error)return t.error.toString();const n=this._context;if(n){const r=n.getPosition();return this.getTextAt(r.rowIndex,r.colIndex)}return Kt(t.tokens)}}const vr=new Array(20);for(let e=0;e<vr.length;e++)vr[e]={colStart:0,rowStart:0,colEnd:0,rowEnd:0,sheetName:null};const Gl={type:null};class Ql{constructor(t){this._options={getEntireCoords:Bo,...t},this._astBuilder=new Wl}parse(t,n){t.getPosition().sheetName;const r=this._astBuilder.build(t,n);return new bt(this._options,r)}eval(t,n){return this.parse(t,n).evaluate(t)}}export{Ql as FormulaParser};
