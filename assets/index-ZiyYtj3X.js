const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./BuabryqTvHfqYpLE-DpI2rgMV.js","./preload-helper-D9Z9MdNV.js","./index-DvhsF04y.js","./index-J-Hv9Xln.js","./iframe-CBk8unIv.js","./index-CMiH3ff9.js","./client-vjV3QKWK.js","./index--CXhSu_I.js","./B6SR0BPXF3_HR9Gp-Ce3Ivkr_.js","./paGhkNtzUuyqCkUg-DiP-oemB.js","./index-BQ5g15rz.js","./Cyt8i0yMUhcyUi_X-jaVpGV8s.js","./DkcoDi-4aZ6TgzgC-DJnLMZ8t.js"])))=>i.map(i=>d[i]);
import{_ as ao}from"./preload-helper-D9Z9MdNV.js";import{o as Nt,X as V,Z as J,y as ct,k as FS,l as Ch,m as sr,G as Ot,n as ql,p as Pt,s as Rp,Y as cs,q as gi,u as Ip,j as Rc,H as Et,K as zr,v as OS,w as DS,i as wt,a as Fe,A as _r,x as Fo,b as Ap,T as LS,z as BS,C as zS,D as PS,E as xh,F as vo,W as HS,c as ot,I as Vd,J as Ee,d as Ae,L as Qa,M as Mp,B as $S,e as xn,r as VS,N as Vs,P as Tp,Q as WS,R as jS}from"./index-DvhsF04y.js";import{j as ge,r as Eo}from"./index-J-Hv9Xln.js";import{r as T,m as ut}from"./iframe-CBk8unIv.js";import{M as kp,a as dl,y as Np,S as GS,C as US,s as qS,b as Fp,v as JS,V as qu,_ as KS,d as XS}from"./index--CXhSu_I.js";/**
 * @license @sheetxl/primitives - Primitives - Base types for SheetXL functions. - v0.6.6
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const Me={Number:"n",String:"s",Boolean:"b",Error:"e",RichData:"r",Null:"z"};var B,hl,He;(hl=B||(B={})).Orientation={Column:"column",Row:"row"},hl.Orientations={...hl.Orientation,Both:"both"},hl.Direction={Up:"up",Down:"down",Left:"left",Right:"right"},(s=>{s.Code={Parse:0,Null:1,Div0:2,Value:3,Ref:4,Name:5,Num:6,NA:7,GettingData:8,Spill:9,Connect:10,Blocked:11,Unknown:12,Field:13,Calc:14,Busy:16,Python:19,Timeout:20},s.Label={Parse:"#PARSE!",Null:"#NULL!",Div0:"#DIV/0!",Value:"#VALUE!",Ref:"#REF!",Name:"#NAME?",Num:"#NUM!",NA:"#N/A",GettingData:"#GETTING_DATA",Spill:"#SPILL!",Connect:"#CONNECT!",Blocked:"#BLOCKED!",Unknown:"#UNKNOWN!",Field:"#FIELD!",Calc:"#CALC!",Busy:"#BUSY!",Python:"#PYTHON!",Timeout:"#TIMEOUT!"};const v=class v extends Error{constructor(P,U,ne,ee){super(ne,ee),this._label=U,this._code=P,this.details=ee}get isFormulaError(){return!0}getLabel(){return this._label}getCode(){return this._code}equals(P){return!!P&&(this._code===P._code||this._code===P.code)}get[Symbol.toStringTag](){return"[FormulaError]"}toString(){return this.message||this._label}};v.code=s.Code.Unknown;let e=v;s.Known=e;const y=class y extends e{constructor(P,U){super(s.Code.Parse,s.Label.Parse,P,U)}getDetails(){const P=this.details;return{line:P?.line??1,column:P?.column??1,offset:P?.offset??0,length:P?.length??0}}};y.code=s.Code.Parse;let t=y;s.Parse=t;const _=class _ extends e{constructor(P,U){super(s.Code.Null,s.Label.Null,P,U)}};_.code=s.Code.Null;let n=_;s.Null=n;const C=class C extends e{constructor(P,U){super(s.Code.Div0,s.Label.Div0,P,U)}};C.code=s.Code.Div0;let r=C;s.Div0=r;const E=class E extends e{constructor(P,U){super(s.Code.Value,s.Label.Value,P,U)}};E.code=s.Code.Value;let o=E;s.Value=o;const x=class x extends e{constructor(P,U){super(s.Code.Ref,s.Label.Ref,P,U)}};x.code=s.Code.Ref;let i=x;s.Ref=i;const R=class R extends e{constructor(P,U){super(s.Code.Name,s.Label.Name,P,U)}};R.code=s.Code.Name;let l=R;s.Name=l;const I=class I extends e{constructor(P,U){super(s.Code.Num,s.Label.Num,P,U)}};I.code=s.Code.Num;let a=I;s.Num=a;const A=class A extends e{constructor(P,U){super(s.Code.NA,s.Label.NA,P,U)}};A.code=s.Code.NA;let c=A;s.NA=c;const M=class M extends e{constructor(P,U){super(s.Code.GettingData,s.Label.GettingData,P,U)}};M.code=s.Code.GettingData;let u=M;s.GettingData=u;const k=class k extends e{constructor(P,U){super(s.Code.Spill,s.Label.Spill,P,U)}};k.code=s.Code.Spill;let d=k;s.Spill=d;const F=class F extends e{constructor(P,U){super(s.Code.Connect,s.Label.Connect,P,U)}};F.code=s.Code.Connect;let h=F;s.Connect=h;const L=class L extends e{constructor(P,U){super(s.Code.Blocked,s.Label.Blocked,P,U)}};L.code=s.Code.Blocked;let f=L;s.Blocked=f;const N=class N extends e{constructor(P,U){super(s.Code.Unknown,s.Label.Unknown,P,U)}};N.code=s.Code.Unknown;let g=N;s.Unknown=g;const D=class D extends e{constructor(P,U){super(s.Code.Field,s.Label.Field,P,U)}};D.code=s.Code.Field;let m=D;s.Field=m;const O=class O extends e{constructor(P,U){super(s.Code.Calc,s.Label.Calc,P,U)}};O.code=s.Code.Calc;let p=O;s.Calc=p;const H=class H extends e{constructor(P,U){super(s.Code.Busy,s.Label.Busy,P,U)}};H.code=s.Code.Busy;let w=H;s.Busy=w;const z=class z extends e{constructor(P,U){super(s.Code.Python,s.Label.Python,P,U)}};z.code=s.Code.Python;let S=z;s.Python=S;const j=class j extends e{constructor(P,U){super(s.Code.Timeout,s.Label.Timeout,P,U)}};j.code=s.Code.Timeout;let b=j;s.Timeout=b})(He||(He={}));const Zt={};Zt[He.Code.Parse]=He.Parse,Zt[He.Code.Null]=He.Null,Zt[He.Code.Div0]=He.Div0,Zt[He.Code.Value]=He.Value,Zt[He.Code.Ref]=He.Ref,Zt[He.Code.Name]=He.Name,Zt[He.Code.Num]=He.Num,Zt[He.Code.NA]=He.NA,Zt[He.Code.GettingData]=He.GettingData,Zt[He.Code.Spill]=He.Spill,Zt[He.Code.Connect]=He.Connect,Zt[He.Code.Blocked]=He.Blocked,Zt[He.Code.Unknown]=He.Unknown,Zt[He.Code.Field]=He.Field,Zt[He.Code.Calc]=He.Calc,Zt[He.Code.Busy]=He.Busy,Zt[He.Code.Python]=He.Python,Zt[He.Code.Timeout]=He.Timeout;const Op=new Map,Wd=new Map,Dp=new Map,Lp=new Map,Eh=Object.keys(Zt);for(let s=0;s<Eh.length;s++){const e=Eh[s],t=Zt[e];Dp.set(He.Label[e],t),Lp.set(He.Code[e],t);const n=new t;Op.set(n.getLabel(),n),Wd.set(n.getCode(),n)}const ZS=Wd.get(He.Code.Unknown);var Lt;(Lt=He||(He={})).BuiltIn={Parse:new Lt.Parse,Null:new Lt.Null,Div0:new Lt.Div0,Value:new Lt.Value,Ref:new Lt.Ref,Name:new Lt.Name,Num:new Lt.Num,NA:new Lt.NA,GettingData:new Lt.GettingData,Spill:new Lt.Spill,Connect:new Lt.Connect,Blocked:new Lt.Blocked,Unknown:new Lt.Unknown,Field:new Lt.Field,Calc:new Lt.Calc,Busy:new Lt.Busy,Python:new Lt.Python,Timeout:new Lt.Timeout},Lt.getBuiltInByLabel=s=>Op.get(s),Lt.newTypedError=(s,e,t)=>{let n;return n=typeof s=="string"?Dp.get(s):Lp.get(s),n||(n=Lt.Unknown),new n(e,t)},Lt.getBuiltInById=s=>Wd.get(s)||ZS;class YS{constructor(e){this._subscribeFn=e}subscribe(e,t,n){const r=typeof e=="object"?{next:e.next||(()=>{}),error:e.error||(()=>{}),complete:e.complete||(()=>{}),unsubscribe:()=>{}}:{next:e||(()=>{}),error:t||(()=>{}),complete:n||(()=>{}),unsubscribe:()=>{}},o=this._subscribeFn(r);return r.unsubscribe=()=>{typeof o=="function"&&o()},r}}/**
 * @license @sheetxl/sdk - SDK - A high-performance, embeddable spreadsheet engine. - v0.6.6
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const Rh=(s,e)=>{const t=new Map;return s.forEach((n,r)=>{e.get(r)!==n&&t.set(r,n)}),t};let Ih=!1;class Ah{constructor(e){this._record=e}getId(){return this._record.id}getDescription(){return this._record.description}getMeta(){return Object.freeze(this._record.meta)}getAuthor(){return this._record.author}getTimestamp(){return this._record.timestamp}getOperation(){return this._record.operation}}var vs;let ir=(vs=class{constructor(e){this._listeners=new Set,this._listenersState=new Map,this._commits=new Map,this._locked=!1,this._current=null,this._pending=null,this._isSync=e?.sync??Ih,this._isTransient=e?.transient??!1,this._author=e?.author;const t={id:"0",description:"initial",meta:{},author:this._author,timestamp:Date.now(),states:new Map,version:0,previousId:null},n={record:t,commit:new Ah(t)};this._current=n,this._cacheModel=null,this._cacheState=null,this._states=t.states,this._transactionStack=[],this._transactionOpen=!1;const r=new Map;r.set(t.id,n),this._commits=r}getLog(e,t=100){const n=[];let r=e;do{const o=this._commits.get(r);if(!o)throw new Error(`Invalid commit id: '${r}'`);if(n.push(o.commit),r=o.record.previousId,!r)return n}while(n.length<t)}getCommitCount(){return this._commits.size}isOpenTransaction(){return this._transactionStack.length>0||this._transactionOpen}getPendingView(){const e=this._transactionStack;return e.length>0?e[0].getView():null}getState(e){const t=this._transactionStack;if(t.length===0){if(this._cacheModel===e)return this._cacheState;const n=this._states.get(e);return this._cacheModel=e,this._cacheState=n,n}return t[t.length-1].getState(e)}getCurrentCommit(){return this._pending?.commit??this._current.commit}restore(e,t){const n=this._getCommitContainer(e,t);if(this._current.commit.getId()===n.commit.getId())return n.commit;let r;t?.viewId&&t?.viewId!=="custom"||(r=n.record.viewAfter);const o=Rh(n.record.states,this._current.record.states);this._notifyStates("onBeforeCommitStart",this._current,o,r,!0,!1),this._current=n,this._states=this._current.record.states,this._cacheModel=null,this._cacheState=null,this._notifyStates("onAfterStateChange",n,o,r,!1,!0,!0),this._notify("onCommitChange",n.commit,!0),this._transactionOpen=!0;try{this._notifyStates("onRestoreOrRevert",n,n.record.states,r,!1,!0)}finally{this._transactionOpen=!1}return n.commit}revert(e,t){const n=this._getCommitContainer(e,t),r=this._commits.get(n.record.previousId);if(!r)throw new Error(`Invalid commit id: '${n.record.previousId}'`);let o;t?.viewId&&t?.viewId!==" custom"||(o=n.record.viewBefore??n.record.viewAfter);const i=Rh(r.record.states,this._current.record.states);this._notifyStates("onBeforeCommitStart",this._current,i,o,!0,!1),this._current=r,this._states=this._current.record.states,this._cacheModel=null,this._cacheState=null,this._notifyStates("onAfterStateChange",r,i,o,!0,!1,!0),this._notify("onCommitChange",r.commit,!0),this._transactionOpen=!0;try{this._notifyStates("onRestoreOrRevert",r,r.record.states,o,!0,!0)}finally{this._transactionOpen=!1}return r.commit}_getCommitContainer(e,t){const n=this._commits.get(e);if(!n)throw new Error(`Invalid commit id: '${e}'`);if(this._isTransient)throw new Error("Cannot revert transient store");if(t?.force&&this._transactionStack.length>0&&this._transactionStack[0].rollback(),this._transactionStack.length!==0)throw new Error("Open transactions.");return n}_pruneForwards(e){}beginCommit(e,t){const n=this._transactionStack,r=n.length;if(this._locked)throw console.warn("TransactionStore locked",n),new Error(`TransactionStore is locked by '${n[r-1].getDescription()}`);const o=e?.preventFurtherTransactions,i=this,l=(c,u,d)=>{const h=i._transactionStack;r!==h.length-1&&console.warn("Transaction stack out of sync",r,h.length,h),o&&(this._locked=!1),h.pop(),t?.(c,u,d),h.length===0&&(i._pending=null)};let a;if(n.length===0){const c=this._current.record,u={states:new Map,id:V.uuidV4(),description:typeof e=="string"?e:e?.description??null,meta:{},timestamp:Date.now(),author:null,version:c.version+1,previousId:c.id,viewBefore:null,viewAfter:{},operation:e?.operation},d={record:u,commit:new Ah(u)};this._pending=d,this._notify("onCommitStart",d.commit),a=new QS(this,d,c?.states,e,l)}else a=n[n.length-1].beginTransaction(e,l);return o&&(this._locked=!0),this._transactionStack.push(a),a}doBatch(e,t,n){let r;const o=this.beginCommit(t,n),i=this.getCurrentCommit();try{r=e?.(i);const l=()=>{o.commit(t)};if(r&&typeof r.then=="function")return new Promise((a,c)=>{r.then(u=>{try{l(),a(u)}catch(d){c(d)}}).catch(u=>{o.rollback(),c(u)})});l()}catch(l){throw o.rollback(),l}return r}remove(e){return!!e}addListener(e){const t=this._listeners;return t.add(e),()=>{t.delete(e)}}addStateListener(e,t){if(!e)throw new Error("Model is required");if(!t)throw new Error("Listener is required");let n=this._listenersState.get(e);return n||(n=new Set,this._listenersState.set(e,n)),n.add(t),()=>{n.delete(t),n.size===0&&this._listenersState.delete(e)}}dispatchEvents(e,t=!1){!t||this._isSync?e():setTimeout(e,0)}_commitRecord(e,t,n){let r=e.record,o=e.commit;if(!this._isTransient){if(n){const i=this._commits.get(r.previousId);if(i){r.previousId=i.record.id;const l=i.record,a=l.states;a&&r.states.forEach((c,u)=>{a.set(u,c)}),l.viewAfter={...l.viewAfter,...r.viewAfter},l.meta={...l.meta,...r.meta},l.timestamp=r.timestamp,r=l,o=i.commit,e={record:r,commit:o}}}this._commits.set(r.id,e)}this._current=e,this._states=this._current.record.states,this._cacheModel=null,this._cacheState=null,n||this._notify("onCommitChange",o),this._notifyStates("onAfterStateChange",e,t,e.record.viewAfter,!1,!1,!0),n||this._notify("onCommitEnd",o,!0)}_notifyStates(e,t,n,r,o=!1,i=!1,l=!1){const a=t.commit,c=this._listenersState;n.forEach((u,d)=>{const h=c.get(d);h&&this.dispatchEvents(()=>{h.forEach(f=>{f[e]?.(u,r,a,o,i)})},l)})}_notify(e,t,n=!1){this.dispatchEvents(()=>{this._listeners.forEach(r=>{r[e]?.(t)})},n)}},vs.setDefaultSync=e=>{Ih=e},vs);class Bp{constructor(e,t){this._children=new Set,this._depth=0,this._container=null,this._closed=!1,this._container=e,t=typeof t=="string"?{description:t}:t,this._description=t?.description??"",t?.viewBefore!==void 0&&(e.record.viewBefore=e.record.viewBefore&&t.viewBefore?{...e.record.viewBefore,...t.viewBefore}:t.viewBefore),t?.viewAfter!==void 0&&(e.record.viewAfter=e.record.viewAfter&&t.viewAfter?{...e.record.viewAfter,...t.viewAfter}:t.viewAfter)}getView(){return this._container.record.viewAfter??this._container.record.viewBefore}getDepth(){return this._depth}getDescription(){return this._description}getStates(){return this._states}beginTransaction(e,t){this._ensureOpen();const n=new e_(this,this._container,typeof e=="string"?{description:e}:e,t);return this._children||this._children,this._children.add(n),n}updateState(e,t){this._ensureOpen();const n=this.getState(e),r=typeof t=="function"?t(n):t===void 0?n:{...n,...t};if(r){let o=this._states;o||(o=new Map,this._states=o),o.set(e,r)}return r}commit(e){if(this._ensureOpen(),typeof e=="string"&&(e={description:e}),e){if(e.description&&(this._description=e.description),e.meta&&(this._meta=V.mergeContentful(e.meta,this._meta)),e.viewAfter!==void 0){const t=this._container.record;let n=e.viewAfter;if(n===null)t.viewAfter=null;else{const r=t.viewAfter;typeof n=="function"&&(n=n(r)),t.viewAfter={...r,...n}}}if(e.viewBefore!==void 0){const t=this._container.record;let n=e.viewBefore;if(n===null)t.viewAfter=null;else{const r=t.viewBefore;typeof n=="function"&&(n=n(r)),t.viewBefore={...r,...n}}}}return this._children&&this._children.forEach(t=>{t.commit(e)}),this}isClose(){return this._closed}_ensureOpen(){if(this._closed)throw this._descriptions&&console.warn(`stack: [${this._descriptions.join(",")}]`),new Error("Transaction already closed")}_removeChild(e){this._children.delete(e),this._mergeStates(e._states)}_mergeStates(e){if(!e||e.size===0)return;let t=this._states;return t?(e.forEach((n,r)=>{const o=this.updateState(r,n);t.set(r,o)}),t):(this._states=e,e)}}class QS extends Bp{constructor(e,t,n,r,o){super(t,r),this._store=e,this._prevStates=n,this._onClose=o,this._states=new Map,this._meta=t.record.meta}getId(){return this._container.commit.getId()}getParent(){return this}commit(e){const t=this._states,n=this._container,r=n.record.viewAfter;this._store._notifyStates("onBeforeCommitStart",n,t,r,!1,!1),super.commit(e),this._store._notifyStates("onBeforeCommitEnd",n,t,r,!1,!1);const o=new Map(this._prevStates);return this._states.forEach((i,l)=>{i===null?o.delete(l):o.set(l,i)}),this._states=o,this._description&&(n.record.description=this._description),this._meta&&(n.record.meta=this._meta),n.record.states=o,this._closed=!0,this._onClose?.(this,!1,e),this._store._commitRecord(n,t,e?.forceAmend??!1),this}rollback(){return this._ensureOpen(),this._children&&this._children.forEach(e=>{e.rollback()}),this._closed=!0,this._onClose?.(this,!0,null),this}updateState(e,t){const n=super.updateState(e,t);return this._states.set(e,n),n}getState(e){let t=this._states.get(e);return t||(t=this._prevStates.get(e)),t}_mergeStates(e){return!e||e.size===0?new Map:super._mergeStates(e)}}class e_ extends Bp{constructor(e,t,n,r){if(super(t,n),!e)throw new Error("Parent transaction required");this._parent=e,this._depth=this._parent.getDepth()+1,this._onClose=r}getId(){return this._parent.getId()}getParent(){return this._parent}getState(e){const t=this._states?this._states.get(e):void 0;return t!==void 0?t:this._parent.getState(e)}commit(e){return super.commit(e),this._parent._removeChild(this),this._closed=!0,this._onClose?.(this,!1,e),this._parent??this}rollback(){return this._ensureOpen(),this._children&&this._children.forEach(e=>{e.rollback()}),this._parent._removeChild(this),this._closed=!0,this._onClose?.(this,!0,null),this._parent??this}}const zp=()=>{try{return"0.6.6"}catch{return""}},kr=Object.freeze(Object.defineProperty({__proto__:null,getBuildDate:()=>{try{return"Sat Aug 23 2025"}catch{return""}},getBuildVersion:zp},Symbol.toStringTag,{value:"Module"})),t_=`
  https://www.sheetxl.com ${zp()}`,Ic="#1976d2",n_=()=>typeof window=="object"?window.location.hostname:V.getOS(),Go=Object.freeze(Object.defineProperty({__proto__:null,generateNodeId:async()=>"0",getKey:async()=>{throw new Error("getKey is not implemented in browser environment")},printBanner:async s=>{const e=s?console.log:V.consoleWithNoSource,t=`%c
███████╗██╗  ██╗███████╗███████╗████████╗ ██╗  ██╗██╗
██╔════╝██║  ██║██╔════╝██╔════╝╚══██╔══╝ ╚██╗██╔╝██║
███████╗███████║█████╗  █████╗     ██║     ╚███╔╝ ██║
╚════██║██╔══██║██╔══╝  ██╔══╝     ██║     ██╔██╗ ██║
███████║██║  ██║███████╗███████╗   ██║    ██╔╝ ██╗███████╗
╚══════╝╚═╝  ╚═╝╚══════╝╚══════╝   ╚═╝    ╚═╝  ╚═╝╚══════╝${t_}
   `;return await e(`${t}`,`font-family:monospace;color:${Ic};font-size:12px;`),Promise.resolve()},printDetails:async(s,e=!1,t=!1,n=!1)=>{let r;const o=console.log,i=[`color:${Ic};font-size:12px`];if(s.isEval()?(i.push(`font-family:monospace;color:${Ic};font-size:12px;`),r="%cEvaluation Only",i[0]="color:#E12929;font-size:12px",r+=`%c
Please visit https://my.sheetxl.com to register.`):(r=`%cLicensee: ${s.licensee()??"Invalid License"}
`,r+=`Expires: ${s.expiration()?.toLocaleDateString()??"Never"}`,s.domains()&&s.domains().length>0&&(r+=`
Domains: ${s.domains().join(", ")}`),s.cpuCount()>0&&(r+=`
Cpus: ${s.cpuCount()}`)),!n&&s.exceptions().length>0){i.push("color:red;font-size:12px"),r+=`
Exceptions:
%c`;for(let l=0;l<s.exceptions().length;l++)r+=`  ${s.exceptions()[l]}`}return t&&(i.push("color:#FFA726;font-size:12px"),r+="%c",r+=`
Location: '${n_()}'`,r+=`
KeyFrom: '${s.keyFrom()}'`),await o(`${r}`,...i),Promise.resolve()},setKey:async(s,e=!1)=>{throw new Error("setKey is not implemented in browser environment")}},Symbol.toStringTag,{value:"Module"})),r_=(s,e,t=126)=>((n,r,o=126)=>{let i=n.split("");for(let l=0;l<i.length;l++)i[l].charCodeAt(0)<=o&&(i[l]=String.fromCharCode((i[l].charCodeAt(0)+r)%o));return i.join("")})(s,t-e),o_=s=>typeof window=="object"?window.atob(s):Buffer.from(s,"base64").toString("ascii");function go(s,e,t,n,r){return St(t-213,s)}function St(s,e){const t=jd();return St=function(n,r){let o=t[n-=265];if(St.ZCySCQ===void 0){const a=function(c,u){let d,h,f=[],g=0,m="";for(c=function(p){let w="",S="";for(let b,v,y=0,_=0;v=p.charAt(_++);~v&&(b=y%4?64*b+v:v,y++%4)?w+=String.fromCharCode(255&b>>(-2*y&6)):0)v="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+/=".indexOf(v);for(let b=0,v=w.length;b<v;b++)S+="%"+("00"+w.charCodeAt(b).toString(16)).slice(-2);return decodeURIComponent(S)}(c),h=0;h<256;h++)f[h]=h;for(h=0;h<256;h++)g=(g+f[h]+u.charCodeAt(h%u.length))%256,d=f[h],f[h]=f[g],f[g]=d;h=0,g=0;for(let p=0;p<c.length;p++)h=(h+1)%256,g=(g+f[h])%256,d=f[h],f[h]=f[g],f[g]=d,m+=String.fromCharCode(c.charCodeAt(p)^f[(f[h]+f[g])%256]);return m};St.wPWiPN=a,s=arguments,St.ZCySCQ=!0}const i=n+t[0],l=s[i];return l?o=l:(St.sriZdq===void 0&&(St.sriZdq=!0),o=St.wPWiPN(o,r),s[i]=o),o},St(s,e)}(function(){const s="0Alf",e="8PJc",t="QUhH",n="B30l",r="&f@8";function o(u,d,h,f,g){return St(f-508,d)}const i=jd();function l(u,d,h,f,g){return St(f-361,h)}function a(u,d,h,f,g){return St(f- -970,d)}function c(u,d,h,f,g){return St(f-454,d)}for(;;)try{if(-parseInt(l(0,0,s,789))/1+-parseInt(l(0,0,"jxCx",636))/2*(-parseInt(l(0,0,e,645))/3)+parseInt(a(0,"&v4P",0,-589))/4*(-parseInt(o(0,t,0,793))/5)+parseInt(c(0,"MyX@",0,914))/6+-parseInt(c(0,"#1e1",0,760))/7*(-parseInt(c(0,"0Alf",0,886))/8)+parseInt(o(0,"sjnP",0,899))/9*(-parseInt(c(0,n,0,747))/10)+parseInt(o(0,r,0,973))/11===834360)break;i.push(i.shift())}catch{i.push(i.shift())}})();const Ia=()=>{const s="AQ]R",e="obnA";function t(l,a,c,u,d){return St(d-195,c)}if(typeof window===t(0,0,"KsZ3",0,489))return window[t(0,0,"J$[^",0,616)][n=809,r=s,St(n-492,r)];var n,r,o,i;return V[o=e,i=10,St(i- -409,o)]()},Ju=()=>{const s="nLh&";function e(t,n,r,o,i){return St(i-627,t)}return Ia()[e("dsNL",0,0,0,961)](e("jxCx",0,0,0,905))||Ia()===St(396,s)};function Qr(s,e,t,n,r){return St(t- -228,s)}const s_=(s,e,t,n)=>{function r(a,c,u,d,h){return St(c-300,h)}function o(a,c,u,d,h){return St(a-163,d)}function i(a,c,u,d,h){return St(d-643,u)}function l(a,c,u,d,h){return St(d-525,a)}return{licensee:()=>s[r(0,640,0,0,"#1e1")],expiration:()=>new Date(s[r(0,573,0,0,"jxCx")]),domains:()=>s[o(540,0,0,"l^Ri")]??[],developerCount:()=>{return s[a="B]VF",c=-352,St(c- -684,a)]??1;var a,c},cpuCount:()=>s[i(0,0,"#1e1",953)]??0,type:()=>s[i(0,0,"U%t$",938)]??l("cR0^",0,0,841),exceptions:()=>e,isValidFor:a=>{return!(e?.[c="QUhH",u=1136,o(u-564,0,0,c)]>0);var c,u},isValid:()=>!0,isEval:()=>!1,features:()=>Object[i(0,0,"(kun",998)](s[r(0,676,0,0,"8PJc")]??{}),keyFrom:()=>t,getBuildVersion:kr[r(0,723,0,0,"U%t$")],getBuildDate:kr[l("A5u&",0,0,854)]}},Mh=s=>{const e="QGhB",t="(kun",n="O$Lr",r="R#dA",o="]p^x",i="l^Ri";let l=V[d(-455,"AQ]R")];function a(g,m,p,w,S){return St(g- -892,p)}function c(g,m,p,w,S){return St(m-551,g)}function u(g,m,p,w,S){return St(m-740,w)}function d(g,m,p,w,S){return St(g- -734,m)}if(Ju()||V[u(0,1155,0,e)]()){const g=kr[h="*NEo",f=144,St(f- -286,h)](),m=new Date(g),p=new Date;Math[c(t,898)]((p[a(-447,0,n)]()-m[a(-553,0,r)]())/864e5)>=120&&(l=[u(0,1135,0,o)])}else l=[];var h,f;return{licensee:()=>a(-524,0,"8PJc"),expiration:()=>null,domains:()=>[Ia()],developerCount:()=>1,cpuCount:()=>0,type:()=>a(-519,0,"(kun"),isEval:()=>!0,exceptions:()=>l,isValidFor:()=>l[a(-478,0,"QGhB")]===0,isValid:()=>!1,features:()=>Object[d(-421,"urYU")]({}),keyFrom:()=>s,getBuildVersion:kr[u(0,1144,0,"Ca!v")],getBuildDate:kr[c(i,866)]}};function fo(s,e,t,n,r){return St(n-696,r)}const Tt={promise:null,details:null,bannerPrinted:!1,detailsPrinted:!1,licenseKey:null,keyFrom:null};let Ac=!1;function br(s,e,t,n,r){return St(e- -509,r)}let Th=!1;function er(s,e,t,n,r){return St(r-271,n)}const kh=er(0,0,0,"QGhB",641)[Qr("]4iZ",0,198)]("")[Qr("%COd",0,196)]((s,e)=>e+s,"");class i_{constructor(){function e(t,n,r,o,i){return Qr(i,0,t- -278)}this[e(-218,0,0,0,"J$[^")][e(-241,0,0,0,"hKPg")]=null}async[Qr("No5Q",0,110)](e,t=!1){const n="C(NV",r="#1e1",o="J$[^",i="B]VF",l="!gJ[",a="U%t$",c="4H^j",u="urYU",d="l^Ri";if(!e||e[g(n,-162,-73)](g("&v4P",26,-19))||e[g("O$Lr",-233,-135)](p(450,492,r))||e[g("sjnP",-176,-107)](f(58,-27,"*Ha4",42,-35))||e[p(496,522,"kHHA")](p(439,469,o)))return Ac=!0,await this[p(419,452,i)](!0);function h(S,b,v,y,_){return br(0,b- -192,0,0,S)}function f(S,b,v,y,_){return br(0,_-10,0,0,v)}if(Ac=!1,!t&&Tt[g("0Alf",37,-30)]){const S=await this[f(0,0,"&f@8",0,-154)]();if(S[w(633,594,711,"obnA")]()&&!S[f(0,0,"B]VF",0,-63)]())return S}function g(S,b,v,y,_){return er(0,0,0,S,v- -728)}Tt[w(541,461,602,"mVsE")]=e,Tt[w(515,522,429,"nLh&")]=f(0,0,"J$[^",0,-216),Tt[w(499,532,590,"A5u&")]=null,Tt[f(0,0,n,0,-199)]=null;const m=await this[h("&f@8",-356)]();if(!m[f(0,0,"urYU",0,-132)]())throw await this[p(431,454,l)](!0),new Error(p(421,332,a));function p(S,b,v,y,_){return er(0,0,0,v,S- -237)}function w(S,b,v,y,_){return br(0,S-742,0,0,y)}if(V[w(592,556,651,"C(NV")]()&&(await Go[g(c,0,-126)](e,t),!(await this[h(u,-290)]())[f(0,0,"QUhH",0,-231)]()))throw await this[f(0,0,d,0,-125)](!0),new Error(g("&f@8",0,-159));return m}async[er(0,0,0,"gT#B",561)](e=!1){const t="&f@8",n="FkS^",r="R]WG",o="R]WG",i="0Alf",l="U%t$",a="urYU",c="9PwR",u="Ca!v",d="Jre5",h="A5u&",f="A5u&",g="QUhH",m="(kun",p="sjnP",w="U!fT",S="gT#B",b="!gJ[",v="gT#B";if(Tt[y(1311,1268,1368,"A5u&")])return Tt[k(-115,t,-104,-122,-112)];function y(F,L,N,D,O){return go(D,0,L-661)}if(!this[y(1052,1150,1153,n)][x(1203,1136,1121,r)]&&(this[x(1266,1199,1171,"O$Lr")][I(187,128,167,248,"U%t$")]=new Error("FV")),Tt[k(-9,"]4iZ",110,114,39)])return Tt[k(38,o,75,-76,-10)];let _=null;Tt[I(205,133,161,112,"nLh&")]=new Promise(F=>{_=F});let C,E=null;function x(F,L,N,D,O){return Qr(D,0,L-1073)}function R(F,L,N,D,O){return Qr(N,0,F-58)}function I(F,L,N,D,O){return br(0,N-343,0,0,O)}const A=async(F,L)=>{function N(D,O,H,z,j){return x(0,D- -1228,0,H)}try{const D=(z=>{let j=z;const q=j[j.length-1],P=q.charCodeAt(0)-52;if(j=j.substring(0,j.length-1),j=j.split("").reverse().join(""),j=o_(j),j=j.trim(),j[j.length-1]!==q)throw new Error;j=j.substring(0,j.length-1),j=r_(j,P);try{j.startsWith("{")||(j="{"+j);const U=JSON.parse(j),ne={licensee:U.l,domains:U.d,nodeId:U.n,expiry:U.e,developerCount:U.dc,cpuCount:U.cc,type:U.t};return U.f&&(ne.features=U.f),ne}catch{throw new Error("Invalid license key.")}})(L),O=await(async z=>{const j="cR0^",q="hKPg",P="9PwR",U="QGhB",ne="obnA",ee="gT#B",ve="O$Lr",le="U%t$",Ce="gT#B",re="!gJ[",ae="A5u&",fe=z[he(-96,-107,-83,"!gJ[",-145)],ye=z[he(-109,-131,-107,j,-196)]?new Date(z[Le("&v4P",722,779)]):null;function he(W,Ze,Xe,Ge,ce){return St(ce- -567,Ge)}const we=z[xe(510,"C(NV",506)];function be(W,Ze,Xe,Ge,ce){return St(W- -942,ce)}const me=[];if(ye?isNaN(ye)?me[de("dsNL",541,619,548)](be(-485,0,0,0,"]p^x")):ye<new Date&&me[de(q,538,535,505)](Le("B]VF",792,807)+ye[be(-552,0,0,0,P)]()):me[be(-481,0,0,0,"AQ]R")](de(q,552,397,471)),V[xe(584,U,578)]()){if(!we)return me[Le(ne,847,919)](xe(420,ee,482)),me;const W=await Go[he(0,0,0,ve,-266)]();W!==we&&me[xe(469,le,521)](xe(579,Ce,549)+we+xe(426,le,507)+W)}else{if(Ju())return me;if(fe&&fe[he(0,0,0,"B]VF",-117)]!==0){let W=!1;const Ze=Ia();for(let Xe=0;!W&&Xe<fe[he(0,0,0,ae,-126)];Xe++)W=Ze[be(-605,0,0,0,"(kun")](fe[Xe]);!W&&me[he(0,0,0,"J$[^",-188)](de("QGhB",404,524,425))}else me[xe(589,"l^Ri",543)](de(re,593,617,555))}function de(W,Ze,Xe,Ge,ce){return St(Ge-145,W)}function xe(W,Ze,Xe,Ge,ce){return St(Xe-163,Ze)}function Le(W,Ze,Xe,Ge,ce){return St(Xe-465,W)}return me})(D),H=s_(D,O,F);return H[N(-42,0,v)]()[N(-114,0,"*NEo")]>0&&(C=H),H}catch{C=(D=>{const O="%COd",H="A5u&";function z(j,q,P,U,ne){return St(U- -767,ne)}return{licensee:()=>null,expiration:()=>null,domains:()=>[],developerCount:()=>0,cpuCount:()=>0,type:()=>z(0,0,0,-415,"Ca!v"),exceptions:()=>{return[(j=H,q=540,z(0,0,0,q-872,j)+D+"'")];var j,q},isValidFor:j=>!1,isValid:()=>!1,isEval:()=>!1,features:()=>Object[z(0,0,0,-455,"Ca!v")]({}),keyFrom:()=>D,getBuildVersion:kr[z(0,0,0,-421,"9PwR")],getBuildDate:kr[z(0,0,0,-446,O)]}})(F)}};Tt[x(0,1233,0,"U%t$")]&&(E=await A(Tt[k(-167,"*NEo",-191,-180,-125)],Tt[x(0,1272,0,i)]));let M=!1;if(Ac&&(M=!0,E=Mh(y(0,1185,0,l))),!E)if(V[y(0,1257,0,"Nm*N")]()){if(!E){const F=process[R(208,0,a)],L=F[k(89,"O$Lr",19,-7,3)]||F[y(0,1308,0,"]p^x")]||F[x(0,1287,0,"l^Ri")]||F[x(0,1247,0,"dsNL")];L&&(E=await A(k(62,c,67,100,1),L))}if(!E){const F=await Go[y(0,1163,0,u)]();F&&(E=await A(x(0,1304,0,"kHHA"),F))}!E&&(M=!0)}else{if(!E)try{const F=await fetch("./"+kh);let L=null;if(F[R(231,0,"urYU")]===200){const N=(await F[x(0,1251,0,"l^Ri")]())[x(0,1152,0,d)](`
`);for(let D=0;!L&&D<N[I(0,0,289,0,"9PwR")];D++){const O=N[D][x(0,1238,0,"0Alf")]();O[k(-21,h,-145,-23,-66)]("#")||O[y(0,1230,0,"(kun")]===0||(L=O)}}if(L){const N=k(-136,"*Ha4",-109,-151,-121)+kh+"')";E=await A(N,L)}}catch{}!E&&Ju()&&(M=!0)}function k(F,L,N,D,O){return Qr(L,0,O- -189)}if(!E&&M&&(E=Mh(R(187,0,f))),!E&&C&&(E=C),!E&&(E={licensee:()=>null,expiration:()=>null,domains:()=>[],developerCount:()=>0,cpuCount:()=>0,type:()=>null,isEval:()=>!1,exceptions:()=>[x(0,1175,0,"U%t$")],isValidFor:F=>!1,isValid:()=>!1,features:()=>Object[y(0,1151,0,"mVsE")]({}),keyFrom:()=>I(0,0,159,0,"YxB5"),getBuildVersion:kr[R(276,0,"QUhH")],getBuildDate:kr[x(0,1132,0,g)]}),Tt[y(0,1305,0,m)]=E,_(E),e&&!(Tt[y(0,1317,0,"L%nm")]&&Tt[R(166,0,"cR0^")])&&(M||E[x(0,1149,0,p)]()[k(0,w,0,0,41)]>0||E[k(0,"KsZ3",0,0,-64)]()?.pb)){if(Th)return void setTimeout(()=>{var F,L;this[F=b,L=1302,y(0,L-31,0,F)](!1,!1)},8e3);await this[y(0,1144,0,"U!fT")](!1,!1)}return Tt[y(0,1266,0,S)]}async[br(0,-160,0,0,"4H^j")](e){const t="(kun",n="l^Ri",r="&f@8",o="O$Lr",i="mVsE";function l(d,h,f,g,m){return fo(0,0,0,m- -1625,h)}function a(d,h,f,g,m){return fo(0,0,0,g- -1597,f)}Tt[u(-397,"urYU",-459,-449,-408)]=!0;const c=await this[u(-281,t,-299,-381,-329)]();function u(d,h,f,g,m){return Qr(h,0,m- -500)}return await Go[a(0,0,n,-535)](e),!Tt[l(0,"dsNL",0,0,-531)]&&(c[u(0,r,0,0,-265)]()||c[u(0,o,0,0,-410)]()[l(0,"!gJ[",0,0,-648)]>0)&&await this[u(0,i,0,0,-400)](e),Promise[a(0,0,"QUhH",-493)]()}async[fo(0,0,0,1059,"]p^x")](e=!1,t=!1,n=!1){const r="]4iZ",o="#1e1",i="mVsE";function l(u,d,h,f,g){return er(0,0,0,u,g- -712)}Tt[c(830,"(kun",902,820)]=!0;const a=await this[l(r,0,0,0,-106)]();function c(u,d,h,f,g){return br(0,f-1030,0,0,d)}Tt[l("obnA",0,0,0,-8)]||!(a[c(986,"R]WG",1007,910)]()||a[l(o,0,0,0,-139)]()[l("9PwR",0,0,0,14)]>0)?await Go[l(i,0,0,0,-170)](a,e,t,n):await this[l("J$[^",0,0,0,-155)](e)}async[er(0,0,0,"kHHA",646)](e,t){const n="MyX@",r="U!fT",o="B]VF";if(!e&&(Tt[a(-259,-346,-365,-379,"8PJc")]||Tt[a(-325,-357,-350,-439,n)]))return;var i,l;function a(h,f,g,m,p){return fo(0,0,0,f- -1493,p)}Tt[i=-73,l="obnA",go(l,0,i- -719)]=!0,Tt[a(-414,-432,-519,-351,"8PJc")]=!0,await this[a(-287,-350,-364,-432,r)](e);const c=V[d(132,"Jre5",153)](),u=e||c?console[a(0,-415,0,0,"QUhH")]:V[d(251,o,165)];function d(h,f,g,m,p){return er(0,0,0,f,g- -415)}c&&u(""),await this[a(0,-449,0,0,"%COd")](e,t),u("")}[fo(0,0,0,1060,"AQ]R")](){return this[e="KsZ3",t=283,go(e,0,t- -378)]();var e,t}[er(0,0,0,"dsNL",720)](e){return this[t=-325,n="Jre5",br(0,t- -268,0,0,n)](!0,e);var t,n}[go("]4iZ",0,626)](){return Tt[n=-189,r="sjnP",go(r,0,n- -705)]||Tt[e="MyX@",t=822,er(0,0,0,e,t-111)];var e,t,n,r}[go("(kun",0,536)](e){Th=!0}async[fo(0,0,0,1133,"jxCx")](){return this[e=832,t="cR0^",er(0,0,0,t,e-117)](!0);var e,t}async[go("cR0^",0,575)](e,t){const n="]4iZ",r="(kun",o=await this[i=n,l=-36,er(0,0,0,i,l- -642)]();var i,l,a,c;return await this[a=r,c=47,fo(0,0,0,c- -1010,a)](!0,e,t),o}async[br(0,-242,0,0,"YxB5")](){var e,t;return await Go[e=-401,t="JlKq",br(0,e- -331,0,0,t)]()}}const ec=new i_;function jd(){const s=["W58+yc/cTN9xdmopzMtdLa","dstcOSkpWQ3cPaSiW7zQ","W6ldV3X0CgCZW4ZdHYW","rmkQW4DadCoLW6a","Emogy3JdHmkEF0S","v8kkW5PVW5FdKdznFq","WOpcJvhcRSo3fG","WONcMLRcRmo5gW","W5/dPd1kBxCbW4VdGcetWOXtWPK","W47cLwqw","WOdcR1FdG8kzzW","WRa7gmkz","WRRcJ0BcOSoJb8odW4ZdTmobWPKUW6C","W4ZcVmo8W6zDiSo+aHpdQX4y","r3NcO8o8WPpcMSoVWPNdHbpdOs3cLW","W7iBW5jcW73cL8keW5ZdMeO","WPddQSoPA8oDydWlWRjjdSkHW5VcQa","WPDYW6ZdLYVdGfOXWOixAq","maHdiJ7cJ2G","WRhdUCo8zSobBtSYWQ9oqmkzW5FcR8owq2X3","l8ktntJcG8oCkqKgWQ1Ix8oFWOi","WPjPqCo1WQuzW7byW44stG","W5NcTSoLW6fBhW","l8kAoZVcImoykqONWQjxACoaWRa","WOdcIvxcPW","WRHWW7FdKdhdTG","WQ/cLuVdPCoSW7W","WPldQSo8FSobFIOO","WOnVW6JdMdBdReG","pbvJ","yfBcSCkt","WPD1W7BdKq","zCkWW7FcTmkMemkNowlcIa3dGG","W7W1wG","j2uzyCkdW6m","WPRcQhJdNSkjCrr2WPhdUq","WQ7cICkjW7aIW78Jx8oq","WP7dNK1hWPhdHmoWdZdcRHDRW488W75o","W7FcJMeFFdZcTu/dS18AWRieW7ddRG7dHJfEfG","W5lcIxqBFIBcTctdUK8","W4BdNNBdPINdIa","W4BdICkvy8kEaZJcQhiJiMtcRGPuAmoJqG","t2ddTmojW6VdP29qW5TKhrpcN2m","WRpdLu9hWPtdGCoN","hb9HWRK","W6hdUxjRBwCb","xx/cSmo5WOJcJ8oFWPxdNXZcQdhcGuvmAmkUW4/cN8k7WPOsACkqW7i","uf1bW6hdSmoNW6/cJSkc","pdpcSmkKWP/dIq","f8oaw1COWQRcLmkZW6FcKXGXWQrq","WOlcMKdcJ8oOb8oMW4ddRmot","W5hcOSk1cmkZWQOg","kG90nYFcLq","amonsLm1WR7cI8k8W7NcKXuGWQ9hwHLYoh0","a8oqxf4","sSkHW4vJfmoLW6JdOZVdTW7cVSkHw8kX","DvxcO8kx","WPnLW73dJq","W5/dN1ZdVshdL8oY","W6i/tLZdN1v/","W7W/u1tdH0S","lsZdOSkPWP7dKcegWOtcNubizSkNWPpdOSkZWOW3WOi","bG10lZVcGM1vW78","lmkqoZRcGCovkvmlWOv7uSo/","ACklsCoPW7fUz8ooW6RcHW","WP1Lq8k8WR0j","WPHZy8k0WQ0e","W6JdRCk0WOJcJSof","WQ0uW6nUW6lcLSkr","W5FdImkVwSkCea","W5/cTmkxjSkm","w8kDW69yW6ZdVbvnBJT4W7jWh8oYuw3cVZW","FeZcOCkAFSorW4uw","bYZcR8kSWPJdKZm","W5NcHwm8ztZcVqVdIvmlWQqdW6ZdPq","WPtcKeXuW6hdUW","DIfNsSkjW6FcT8oqW7q","BCkAvSoqW7C","barRWRhcKSkQkKOaWOu","wvG8W63dJ8oUEhSYWOZcH8kYqa","W4aWBmkvWR4mW7Dt","wmkOWPFdOtLcWPFdGSozbSkwqa","WOhcMKdcQSoKh8o0","uaDnWRZcHSkSoW","W5RcSmknb8k6WReYWQRdIfNcUCkJjq","s0hcLmoqWQNcTSoN","W5JdPwTNAh0aWOxdVY1qWQjyWPpcJCkOaY1GegXKpSouW5tdUva","WPJcJmkTW6OQW7C","pKNcVSkqW73cQZ/cKHH6WQi","iCoGWRFdQCoNbG","t8oQW5ddMeGMDxZcSs/cQItdG8oA","WOXGvaNcKsjRdHL2WQSzcre","W73dRNnHChW","WPrOW6ddNcVdULC","AgaedCojkmoep1VcUmkyWQ5m","W6pcVSoNW6fheSozfXZdRbCz","B8kWW55jW5hdItW","W7C/sxhdHKP2WQJdG10nruTAlW","CmokzSoAsCk+u8kHWRddVKab","qCovy2ddMmkiE0W6","a8oxrLG1","WP3cMSkgW7S/W7m","WPBdRSoZzmorFH8PWQLofmkWW5O","W4K1pSkvBe0","WOxcK8oGpmkEbIFcQfi0","W4JcPmkqaq","W57dG8k3A8kjcG","BSkyvCouW6P0Ba","uwFcP8o0WPhcH8opW5ZdLqRdUcJcLLzrBSkLWOe","q8oFESouu8kI","WPpcILFdQSoRW68pWRBdQCkVka","W5SZfLhdJxOUocnUWQqooW","W6ulW5vU","WOpcKvJdVSo2W7SlWQVdSSk1","iZiNW5ddTmoN","WPJcOSkHtKe","E3HBWPhcRmk/qCkPedBcOmosWRFcUW","WO/dUmkJWReCuSkTedRdSXmiWOK","WRyVb8keWQznqW","W7xdRMLNBxGx","WQBdVSoQu8oKWRhcOSonW74","W7KPA1ldN0P+","u8kOWO3dHdHd","CmokzSoAsCk+","WPTSW5RdK8o1lCoHWO/dIsqXW5S","W5y1WRhcGgZcTqWLWRScveez","k0pcP8kxW7VcKa","WQjJdGFcHHvsWO/dJ2G5ta","Eq7dRSooW6RcJs3cMrjP","W43cIbKCamoXl2yp","WO1SW5BdMmo7da","iLtcTmkFW6xcGthcJWi","W5atW5zYW6hcOSkxW4FdLua","WRHUw8k6WQuiW6aDW48vubFcMhe","dYBcRmkQWOxdLq","cGOpWONcSSkMWRi","y0BcTSk3y8oBW48wWRdcMItdHgS","W4ZcUmkTtSoABtu3WQi","WQjQvfZdGeDDWOu","t1pcSmkszmomW6GzWQ3cKqRdKW","W7C/sxhdHKP2WQJdKvKluW","t3ZcSSkjzComW4uNWPW","sSkHW4vQbmo1","WOJdHLPkWPtdICo1wZS","W5NdJf/dPs3dOSoH","vmkOWPRdPt5eWPy","CCopCXtcVSkfWR9k","CCobAgNdKSky","W4RcMwCB","WORcTCk8teu2W55LW44","W782aSktzLW","aY8uW4FdUCoIfSk7bdBcOCoIWOZcM07dMbpcJbFdLG","WOhcMKdcQSoKh8o0W7NdSSojWP42W7hcJG","WPNcRNBdGCkuCsy","B8kWW4r4W4RdHs13Bb1FW5j3ka","W6JdUmk2WOtcKSkrWQxcRvTd","hdhcRCktWRZcPqWtW6TSpHxcSq","gYJcOmkyWQNcOZuoW6XX","oJmnW4VdVmo4fW","WR/cS8oSW5FdKSoCW7/cQwf+A8kRkG","W6u1imkvDG","WOD3W5ddMmoVgSoHWRddJtq","WPlcKmkgW68KW7CNFmoCW47dNMOwpCkrrWvWtG","W67dSmkGWQlcJCkqWQlcTG","W7VcLNysmbNcUaZdULGkWRjkW4JdRLC","s8k2W5reg8oP","pWLWjIJcGW","mSoXWRtdQCoHxW","WObLW7hdUYRdQ1C7WQGtB2i","W7/cOCo4W6vCcmoYaGS","W70rW5vYW7BcGSkiW5a","BCkTW4L4W4JdKdb9tae","WPVdMvHdWPpdNSoXdZdcRGCUW7a5WQGhWOhcMWhcNfu2dGJcSgRcOSk0WRK","oXP7ltFcLfXtW7m4WPnjWQy","WOhcKfXJW7FdTYRdPComWR0Fiq","E8kHW4TVW4ZdLW57vHO","WPBcIKtcU8o/fSo0W5RdKmosWPKSW6a","qCkvrLKYWQlcOmkQ","WO/dTmk+DSoUWQW","WO4Hs8kuWRT7xmkrCGbWpmkR","er0zWQlcQCk6WRO","WRrUW4hdLmoVhCoaWP7dNcW0W4tdSW","W7BdRMLeCx0iW4hdTYvhWQi","W7dcJZCsEtBcTahdRfnzWQCyW6ZdVuFdItfd","W7mRzG3cVxi","WPxcMSkEW7KNW7qYtSohW7NdMvexgG","W4JcGxSlDrpcPW","fSols0uwWQ/cK8kl","ECkptSo9W6zZAmotW6pcKa","W5JcQ8oHW6LacSoOjGddQXWFWRVdGq","WOdcKvdcUmoAgSoZW4e","W5BcQ8orW7jCWQhdLSkIWPNdK8onWONcGG","W6eQW6HikKpcNW","W6hdQCk2WOtcJmkwWQNcPW","WRldIfHdWO3dMCo9qddcSG","WR3cLSklW7KLW6GNc8oqW4ldHK0lc8kAeHH9cW","WOFcS33dICk0zG","WP7cHhGBy3xcVWddQXyuWRyEW6ddOW4","ftCdW4RdVmoVe8oVdq","W5xdG8kTtSkicZJcQwaNjhlcLbfi","WOpcK1VcPmo/","WRNcHvPiW6ZdQGldPmo8WR0ckmoo"];return(jd=function(){return s})()}const Ku=(s,e)=>{const t=[];for(let n=0;n<s.length;n++){const r=s[n];t.push({x:r.x+e.x,y:r.y+e.y})}return t},Xu=(s,e)=>{if(!s)return{...e};if(!e)return{...s};let t=Math.min(s.x,e.x),n=Math.min(s.y,e.y);return{x:t,y:n,width:Math.max(s.width+s.x,e.width+e.x)-t,height:Math.max(s.height+s.y,e.height+e.y)-n}},Mc=s=>[{x:s.x,y:s.y},{x:s.x+s.width,y:s.y},{x:s.x+s.width,y:s.y+s.height},{x:s.x,y:s.y+s.height}],Zu=s=>{let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;for(let o=0;o<s.length;o++){let i=s[o];e=Math.min(e,i.x),t=Math.min(t,i.y),n=Math.max(n,i.x),r=Math.max(r,i.y)}return{x:e,y:t,width:n-e,height:r-t}},Tc=(s,e,t)=>{if(!t){const l=Zu(s);t={x:l.x+l.width/2,y:l.y+l.height/2}}s=Ku(s,{x:-t.x,y:-t.y});const n=e*Math.PI/180,r=Math.sin(n),o=Math.cos(n),i=[];for(let l=0;l<s.length;l++){const a=s[l],c=o*a.x-r*a.y,u=r*a.x+o*a.y;i.push({x:c,y:u})}return s=Ku(i,{x:t.x,y:t.y})},Pp=(s,e,t,n,r,o,i,l,a=!0)=>{if(s===t&&e===n||r===i&&o===l)return!1;let c=(l-o)*(t-s)-(i-r)*(n-e);if(c===0)return!1;let u=((i-r)*(e-o)-(l-o)*(s-r))/c,d=((t-s)*(e-o)-(n-e)*(s-r))/c;return(!a||!(u<0||u>1||d<0||d>1))&&{x:s+u*(t-s),y:e+u*(n-e)}},_n=(s,e,t=!0)=>Pp(s.p1.x,s.p1.y,s.p2.x,s.p2.y,e.p1.x,e.p1.y,e.p2.x,e.p2.y,t),gl=s=>({top:{p1:s[0],p2:s[1]},left:{p1:s[3],p2:s[0]},right:{p1:s[1],p2:s[2]},bottom:{p1:s[2],p2:s[3]}}),Nh=(s,e,t)=>{let n=t*Math.PI/180,r=Math.sin(n),o=Math.cos(n);return{x:s*o-e*r,y:s*r+e*o}},Wr=(s,e)=>{let t=s.p2.x-e.x,n=s.p2.y-e.y;const r=Nh(t,n,90);t=r.x+e.x,n=r.y+e.y;let o=s.p1.x-e.x,i=s.p1.y-e.y;const l=Nh(o,i,90);return o=l.x+e.x,i=l.y+e.y,{p1:{x:o,y:i},p2:{x:t,y:n}}},on=Object.freeze(Object.defineProperty({__proto__:null,angleToPoints:(s,e)=>{const t=(180-s)/180*Math.PI,n=Math.abs(e.width*Math.sin(t))+Math.abs(e.height*Math.cos(t)),r=Math.sin(t)*n/2,o=Math.cos(t)*n/2,i=e.width/2,l=e.height/2;return{x1:i-r,y1:l-o,x2:i+r,y2:l+o}},boundsToPoints:Mc,centerPoint:s=>({x:s.width/2+s.x,y:s.height/2+s.y}),clipToOuterRect:(s,e,t=0)=>{if(t<0&&(t+=360),t>90&&t<=180?t+=180:t>180&&t<=270&&(t-=180),t===0||t===180)return{height:e.height,width:e.width};if(t===90||t===270)return{height:e.width,width:e.height};let n=Mc({...e,x:0,y:0}),r=Mc({...s,x:0,y:0});r=Ku(r,{x:e.width/2-s.width/2,y:e.height/2-s.height/2}),r=Tc(r,t);let o=gl(r),i=gl(n);if(t>90){const a=_n(o.top,i.top);if(a){const u=a,d=_n(o.bottom,i.bottom,!1)||r[3];r[0]=_n(o.top,Wr(o.bottom,d),!1)||r[0],r[1]=u,r[3]=d,r[2]=_n(o.bottom,Wr(o.top,u),!1)||r[2],o=gl(r)}const c=_n(o.top,i.left);if(c){const u=c,d=_n(o.bottom,i.right,!1)||r[2];r[0]=u,r[1]=_n(o.top,Wr(o.bottom,d),!1)||r[1],r[3]=_n(o.bottom,Wr(o.top,u),!1)||r[3],r[2]=d}}else if(t<90){const a=_n(o.top,i.top);if(a){const u=a,d=_n(o.bottom,i.bottom,!1)||r[2];r[0]=u,r[1]=_n(o.top,Wr(o.bottom,d),!1)||r[1],r[3]=_n(o.bottom,Wr(o.top,u),!1)||r[3],r[2]=d,o=gl(r)}const c=_n(o.top,i.right);if(c){const u=c,d=_n(o.bottom,i.left,!1)||r[3];r[0]=_n(o.top,Wr(o.bottom,d),!1)||r[0],r[1]=u,r[3]=d,r[2]=_n(o.bottom,Wr(o.top,u),!1)||r[2]}}r=Tc(r,-t);const l=Zu(r);return{width:l.width,height:l.height}},findIntersectMath:(s,e,t,n)=>{let r=Pp(s.x,s.y,e.x,e.y,5e4,0,-5e4,0);return r&&(t=Math.min(t,r.x),n=Math.max(n,r.x)),{min:t,max:n}},leastSquaresSlopeAndIntercept:s=>{let e=0,t=0,n=0,r=0,o=0,i=0,l=0,a=s.length;if(a===0)return{m:0,b:0};if(a===1)return{m:1,b:s[0]};for(let u=0;u<a;u++)i=u+1,l=s[u],l==null||isNaN(l)||(e+=i,t+=l,r+=i*i,n+=i*l,o++);const c=(o*n-e*t)/(o*r-e*e);return{m:c,b:t/o-c*e/o}},minBoundingRect:Zu,rotatePoints:Tc,unionBounds:Xu},Symbol.toStringTag,{value:"Module"}));class mt{constructor(e,t,n){this._root=kc,this._size=0,this._maxNodeSize=n>=4?Math.min(n,256):32,this._compare=t||mt.defaultComparator,e&&this.setPairs(e)}get size(){return this._size}get length(){return this._size}get isEmpty(){return this._size===0}clear(){this._root=kc,this._size=0}forEach(e,t){return t!==void 0&&(e=e.bind(t)),this.forEachPair((n,r)=>e(r,n,this))}forEachPair(e,t){const n=this.minKey(),r=this.maxKey();return this.forRange(n,r,!0,e,t)}get(e,t){return this._root.get(e,t,this)}set(e,t,n){this._root.isShared&&(this._root=this._root.clone());const r=this._root.set(e,t,n,this);return r===!0||r===!1?r:(this._root=new l_([this._root,r]),!0)}has(e){return this.forRange(e,e,!0,void 0)!==0}delete(e){return this.editRange(e,e,!0,mt.DeleteRange)!==0}with(e,t,n){const r=this.clone();return r.set(e,t,n)||n?r:this}withPairs(e,t){const n=this.clone();return n.setPairs(e,t)!==0||t?n:this}withKeys(e,t){const n=this.clone();let r=!1;for(let o=0;o<e.length;o++)r=n.set(e[o],void 0,!1)||r;return t&&!r?this:n}without(e,t){return this.withoutRange(e,e,!0,t)}withoutKeys(e,t){const n=this.clone();return n.deleteKeys(e)||!t?n:this}withoutRange(e,t,n,r){const o=this.clone();return o.deleteRange(e,t,n)===0&&r?this:o}filter(e,t){const n=this.greedyClone();let r;return n.editAll((o,i,l)=>{if(!e(o,i,l))return r=mt.DeleteValue}),!r&&t?this:n}mapValues(e){const t=this.greedyClone();return t.editAll((n,r,o)=>e(r,n,o)),t}reduce(e,t){let n,r=0,o=t;const i=this.entries(this.minKey());for(;!(n=i.next()).done;)o=e(o,n.value,r++,this);return o}entries(e,t){const n=this.findPath(e);if(n===void 0)return Uo();let{nodeQueue:r,nodeIndex:o,leaf:i}=n,l=t!==void 0?1:0,a=e===void 0?-1:i.indexOf(e,0,this._compare)-1;return Uo(()=>{e:for(;;)switch(l){case 0:if(++a<i.keys.length)return{done:!1,value:[i.keys[a],i.values[a]]};l=2;continue;case 1:if(++a<i.keys.length){const u=i.keys[a],d=i.values[a];return t?(t.done=!1,t.value[0]=u,t.value[1]=d,t):{done:!1,value:[u,d]}}l=2;case 2:for(var c=-1;;){if(++c>=r.length){l=3;continue e}if(++o[c]<r[c].length)break}for(;c>0;c--)r[c-1]=r[c][o[c]].children,o[c-1]=0;i=r[0][o[0]],a=-1,l=t!==void 0?1:0;continue;case 3:return Qu}})}entriesReversed(e,t,n){if(e===void 0&&(n=void 0,(e=this.maxKey())===void 0))return Uo();let{nodeQueue:r,nodeIndex:o,leaf:i}=this.findPath(e)||this.findPath(this.maxKey());zn(!r[0]||i===r[0][o[0]],"wat!");let l=i.indexOf(e,0,this._compare);!n&&l<i.keys.length&&this._compare(i.keys[l],e)<=0&&l++;let a=t!==void 0?1:0;return Uo(()=>{e:for(;;)switch(a){case 0:if(--l>=0)return{done:!1,value:[i.keys[l],i.values[l]]};a=2;continue;case 1:if(--l>=0){const u=i.keys[l],d=i.values[l];return t?(t.done=!1,t.value[0]=u,t.value[1]=d,t):{done:!1,value:[u,d]}}a=2;case 2:for(var c=-1;;){if(++c>=r.length){a=3;continue e}if(--o[c]>=0)break}for(;c>0;c--)r[c-1]=r[c][o[c]].children,o[c-1]=r[c-1].length-1;i=r[0][o[0]],l=i.keys.length,a=t!==void 0?1:0;continue;case 3:return Qu}})}findPath(e){let t,n,r=this._root;if(r.isLeaf)t=Fh,n=Fh;else{t=[],n=[];for(let o=0;!r.isLeaf;o++){if(t[o]=r.children,n[o]=e===void 0?0:r.indexOf(e,0,this._compare),n[o]>=t[o].length)return;r=t[o][n[o]]}t.reverse(),n.reverse()}return{nodeQueue:t,nodeIndex:n,leaf:r}}diffAgainst(e,t,n,r){if(e._compare!==this._compare)throw new Error("SortedMap: Comparators are not the same.");if(this.isEmpty||e.isEmpty)return this.isEmpty&&e.isEmpty?void 0:this.isEmpty?n===void 0?void 0:mt.stepToEnd(mt.makeDiffCursor(e),n):t===void 0?void 0:mt.stepToEnd(mt.makeDiffCursor(this),t);const{_compare:o}=this,i=mt.makeDiffCursor(this),l=mt.makeDiffCursor(e);let a=!0,c=!0,u=mt.compare(i,l,o);for(;a&&c;){const d=mt.compare(i,l,o),{leaf:h,internalSpine:f,levelIndices:g}=i,{leaf:m,internalSpine:p,levelIndices:w}=l;if(h||m){if(u!==0){if(d===0){if(h&&m&&r){const S=h.values[g[g.length-1]],b=m.values[w[w.length-1]];if(!Object.is(S,b)){const v=r(i.currentKey,S,b);if(v&&v.break)return v.break}}}else if(d>0){if(m&&n){const S=m.values[w[w.length-1]],b=n(l.currentKey,S);if(b&&b.break)return b.break}}else if(t&&h&&u!==0){const S=h.values[g[g.length-1]],b=t(i.currentKey,S);if(b&&b.break)return b.break}}}else if(!h&&!m&&d===0){const S=f.length-1,b=p.length-1,v=f[S][g[S]];if(p[b][w[b]]===v){u=0,a=mt.step(i,!0),c=mt.step(l,!0);continue}}u=d,d<0?a=mt.step(i):c=mt.step(l)}return a&&t?mt.finishCursorWalk(i,l,o,t):c&&n?mt.finishCursorWalk(l,i,o,n):void 0}static finishCursorWalk(e,t,n,r){const o=mt.compare(e,t,n);if(o===0){if(!mt.step(e))return}else o<0&&zn(!1,"cursor walk terminated early");return mt.stepToEnd(e,r)}static stepToEnd(e,t){let n=!0;for(;n;){const{leaf:r,levelIndices:o,currentKey:i}=e;if(r){const l=t(i,r.values[o[o.length-1]]);if(l&&l.break)return l.break}n=mt.step(e)}}static makeDiffCursor(e){const{_root:t,height:n}=e;return{height:n,internalSpine:[[t]],levelIndices:[0],leaf:void 0,currentKey:t.maxKey()}}static step(e,t){const{internalSpine:n,levelIndices:r,leaf:o}=e;if(t===!0||o){const i=r.length;if(t===!0||r[i-1]===0){const l=n.length;if(l===0)return!1;const a=l-1;let c=a;for(;c>=0;){if(r[c]>0)return c<i-1&&(e.leaf=void 0,r.pop()),c<a&&(e.internalSpine=n.slice(0,c+1)),e.currentKey=n[c][--r[c]].maxKey(),!0;c--}return!1}{const l=--r[i-1];return e.currentKey=o.keys[l],!0}}{const i=n.length,l=i-1,a=n[l][r[l]];if(a.isLeaf){e.leaf=a;const c=r[i]=a.values.length-1;e.currentKey=a.keys[c]}else{const c=a.children;n[i]=c;const u=c.length-1;r[i]=u,e.currentKey=c[u].maxKey()}return!0}}static compare(e,t,n){const{height:r,currentKey:o,levelIndices:i}=e,{height:l,currentKey:a,levelIndices:c}=t,u=n(a,o);if(u!==0)return u;const d=r<l?r:l;return i.length-(r-d)-(c.length-(l-d))}keys(e,t){const n=this.entries(e,t);return Uo(()=>{const r=n.next();return r.value&&(r.value=r.value[0]),r})}values(e,t){const n=this.entries(e,t);return Uo(()=>{const r=n.next();return r.value&&(r.value=r.value[1]),r})}get maxNodeSize(){return this._maxNodeSize}minKey(){return this._root.minKey()}maxKey(){return this._root.maxKey()}clone(){this._root.isShared=!0;const e=new mt(void 0,this._compare,this._maxNodeSize);return e._root=this._root,e._size=this._size,e}greedyClone(e){const t=new mt(void 0,this._compare,this._maxNodeSize);return t._root=this._root.greedyClone(e),t._size=this._size,t}toArray(e=2147483647){const t=this.minKey(),n=this.maxKey();return t!==void 0?this.getRange(t,n,!0,e):[]}keysArray(){const e=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,(t,n)=>{e.push(t)}),e}valuesArray(){const e=[];return this._root.forRange(this.minKey(),this.maxKey(),!0,!1,this,0,(t,n)=>{e.push(n)}),e}toString(){return this.toArray().toString()}setIfNotPresent(e,t){return this.set(e,t,!1)}nextHigherPair(e,t){return e===void 0?this._root.minPair(t):this._root.getPairOrNextHigher(e,this._compare,!1,t)}nextHigherKey(e,t){const n=this.nextHigherPair(e,t);return n&&n[0]}nextLowerPair(e,t){return e===void 0?this._root.maxPair(t):this._root.getPairOrNextLower(e,this._compare,!1,t)}nextLowerKey(e,t){const n=this.nextLowerPair(e,t);return n&&n[0]}getPairOrNextLower(e,t){return this._root.getPairOrNextLower(e,this._compare,!0,t)}getPairOrNextHigher(e,t){return this._root.getPairOrNextHigher(e,this._compare,!0,t)}changeIfPresent(e,t){return this.editRange(e,e,!0,(n,r)=>({value:t}))!==0}getRange(e,t,n,r=67108863){const o=[];return this._root.forRange(e,t,n,!1,this,0,(i,l)=>(o.push([i,l]),o.length>r?mt.Break:void 0)),o}setPairs(e,t){let n=0;for(let r=0;r<e.length;r++)this.set(e[r][0],e[r][1],t)&&n++;return n}forRange(e,t,n,r,o){const i=this._root.forRange(e,t,n,!1,this,o||0,r);return typeof i=="number"?i:i.break}forEditRange(e,t,n,r,o,i){return this._root.forRange(e,t,n,r,this,i||0,o)}editRange(e,t,n,r,o){let i=this._root;i.isShared&&(this._root=i=i.clone());try{const l=i.forRange(e,t,n,!0,this,o||0,r);return typeof l=="number"?l:l.break}finally{let l;for(;i.keys.length<=1&&!i.isLeaf;)l||=i.isShared,this._root=i=i.keys.length===0?kc:i.children[0];l&&(i.isShared=!0)}}editAll(e,t){return this.editRange(this.minKey(),this.maxKey(),!0,e,t)}deleteRange(e,t,n){return this.editRange(e,t,n,mt.DeleteRange)}deleteKeys(e){let t=0;for(let n=0;n<e.length;n++)this.delete(e[n])&&t++;return t}get height(){let e=this._root,t=-1;for(;e;)t++,e=e.isLeaf?void 0:e.children[0];return t}freeze(){const e=this;e.clear=e.set=e.editRange=function(){throw new Error("SortedMap: Attempted to modify when frozen.")}}unfreeze(){delete this.clear,delete this.set,delete this.editRange}get isFrozen(){return this.hasOwnProperty("editRange")}checkValid(){const e=this._root.checkValid(0,this,0);zn(e===this.size,"size mismatch: counted ",e,"but stored",this.size)}}function Uo(s=()=>Qu){const e={next:s};return Symbol&&Symbol.iterator&&(e[Symbol.iterator]=function(){return this}),e}Symbol&&Symbol.iterator&&(mt.prototype[Symbol.iterator]=mt.prototype.entries),mt.prototype.where=mt.prototype.filter,mt.prototype.setRange=mt.prototype.setPairs,mt.prototype.add=mt.prototype.set;let Hp=class Yu{get isLeaf(){return this.children===void 0}constructor(e=[],t){this.keys=e,this.values=t||dn,this.isShared=void 0}maxKey(){return this.keys[this.keys.length-1]}indexOf(e,t,n){const r=this.keys;let o=0,i=r.length,l=i>>1;for(;o<i;){const a=n(r[l],e);if(a<0)o=l+1;else{if(!(a>0)){if(a===0)return l;if(e==e)return r.length;throw new Error("SortedMap: NaN was used as a key.")}i=l}l=o+i>>1}return l^t}minKey(){return this.keys[0]}minPair(e){if(this.keys.length!==0)return(e=e??[null,null])[0]=this.keys[0],e[1]=this.values[0],e}maxPair(e){if(this.keys.length===0)return;const t=this.keys.length-1;return(e=e??[null,null])[0]=this.keys[t],e[1]=this.values[t],e}clone(){const e=this.values,t=e===dn?e:e.slice(0),n=this.keys.slice(0);return new Yu(n,t)}greedyClone(e){return this.isShared&&!e?this:this.clone()}get(e,t,n){const r=this.indexOf(e,-1,n._compare);return r<0?t:this.values[r]}getPairOrNextLower(e,t,n,r){const o=this.indexOf(e,-1,t),i=o<0?~o-1:n?o:o-1;if(i>=0){const l=this.keys[i],a=this.values[i];return r?(r[0]=l,r[1]=a,r):[l,a]}}getPairOrNextHigher(e,t,n,r){const o=this.indexOf(e,-1,t),i=o<0?~o:n?o:o+1;if(i<this.keys.length){const l=this.keys[i],a=this.values[i];return r?(r[0]=l,r[1]=a,r):[l,a]}}checkValid(e,t,n){const r=this.keys.length,o=this.values.length;return zn(this.values===dn?r<=o:r===o,"keys/values length mismatch: depth",e,"with lengths",r,o,"and baseIndex",n),zn(e===0||r>0,"empty leaf at depth",e,"and baseIndex",n),r}set(e,t,n,r){let o=this.indexOf(e,-1,r._compare);if(o<0){if(o=~o,r._size++,this.keys.length<r._maxNodeSize)return this.insertInLeaf(o,e,t,n,r);{const i=this.splitOffRightSide();let l=this;return o>this.keys.length&&(o-=this.keys.length,l=i),l.insertInLeaf(o,e,t,n,r),i}}if(n!==!1){t!==void 0&&this.reifyValues(),this.keys[o]=e;let i=t;if(typeof n=="function"){const l=n(this.values[o],e,t);l!==void 0&&(i=l)}this.values[o]=i}return!1}reifyValues(){return this.values===dn?this.values=this.values.slice(0,this.keys.length):this.values}insertInLeaf(e,t,n,r,o){if(this.keys.splice(e,0,t),this.values===dn){for(;dn.length<o._maxNodeSize;)dn.push(void 0);if(n===void 0)return!0;this.values=dn.slice(0,this.keys.length-1)}let i=n;if(typeof r=="function"){const l=r(void 0,t,n);l!==void 0&&(i=l)}return this.values.splice(e,0,i),!0}takeFromRight(e){let t=this.values;e.values===dn?t!==dn&&t.push(void 0):(t=this.reifyValues(),t.push(e.values.shift())),this.keys.push(e.keys.shift())}takeFromLeft(e){let t=this.values;e.values===dn?t!==dn&&t.unshift(void 0):(t=this.reifyValues(),t.unshift(e.values.pop())),this.keys.unshift(e.keys.pop())}splitOffRightSide(){const e=this.keys.length>>1,t=this.keys.splice(e),n=this.values===dn?dn:this.values.splice(e);return new Yu(t,n)}forRange(e,t,n,r,o,i,l){const a=o._compare;let c,u;if(t===e){if(!n||(u=(c=this.indexOf(e,-1,a))+1,c<0))return i}else c=this.indexOf(e,0,a),u=this.indexOf(t,-1,a),u<0?u=~u:n===!0&&u++;const d=this.keys,h=this.values;if(l!==void 0)for(let f=c;f<u;f++){const g=d[f],m=l(g,h[f],i++);if(m!==void 0){if(m.break!==void 0)return m;if(r===!0){if(g!==d[f]&&o._compare(g,d[f])!==0||this.isShared===!0)throw new Error("SortedMap: illegally changed or cloned in editRange.");m.delete?(this.keys.splice(f,1),this.values!==dn&&this.values.splice(f,1),o._size--,f--,u--):m.hasOwnProperty("value")&&(h[f]=m.value)}}}else i+=u-c;return i}mergeSibling(e,t){if(this.keys.push.apply(this.keys,e.keys),this.values===dn){if(e.values===dn)return;this.values=this.values.slice(0,this.keys.length)}this.values.push.apply(this.values,e.reifyValues())}},l_=class Jl extends Hp{constructor(e,t){if(!t){t=[];for(let n=0;n<e.length;n++)t[n]=e[n].maxKey()}super(t),this.children=e}clone(){const e=this.children.slice(0);for(let t=0;t<e.length;t++)e[t].isShared=!0;return new Jl(e,this.keys.slice(0))}greedyClone(e){if(this.isShared&&!e)return this;const t=new Jl(this.children.slice(0),this.keys.slice(0));for(let n=0;n<t.children.length;n++)t.children[n]=t.children[n].greedyClone(e);return t}minKey(){return this.children[0].minKey()}minPair(e){return this.children[0].minPair(e)}maxPair(e){return this.children[this.children.length-1].maxPair(e)}get(e,t,n){const r=this.indexOf(e,0,n._compare),o=this.children;return r<o.length?o[r].get(e,t,n):void 0}getPairOrNextLower(e,t,n,r){const o=this.indexOf(e,0,t),i=this.children;if(o>=i.length)return this.maxPair(r);const l=i[o].getPairOrNextLower(e,t,n,r);return l===void 0&&o>0?i[o-1].maxPair(r):l}getPairOrNextHigher(e,t,n,r){const o=this.indexOf(e,0,t),i=this.children,l=i.length;if(o>=l)return;const a=i[o].getPairOrNextHigher(e,t,n,r);return a===void 0&&o<l-1?i[o+1].minPair(r):a}checkValid(e,t,n){const r=this.keys.length,o=this.children.length;zn(r===o,"keys/children length mismatch: depth",e,"lengths",r,o,"baseIndex",n),zn(r>1||e>0,"internal node has length",r,"at depth",e,"baseIndex",n);let i=0,l=this.children,a=this.keys,c=0;for(let d=0;d<o;d++)i+=l[d].checkValid(e+1,t,n+i),c+=l[d].keys.length,zn(i>=c,"wtf",n),zn(d===0||l[d-1].constructor===l[d].constructor,"type mismatch, baseIndex:",n),l[d].maxKey()!==a[d]&&zn(!1,"keys[",d,"] =",a[d],"is wrong, should be ",l[d].maxKey(),"at depth",e,"baseIndex",n),d===0||t._compare(a[d-1],a[d])<0||zn(!1,"sort violation at depth",e,"index",d,"keys",a[d-1],a[d]);const u=c===0;return(u||c>t.maxNodeSize*o)&&zn(!1,u?"too few":"too many","children (",c,i,") at depth",e,"maxNodeSize:",t.maxNodeSize,"children.length:",o,"baseIndex:",n),i}set(e,t,n,r){const o=this.children,i=r._maxNodeSize,l=r._compare;let a=Math.min(this.indexOf(e,0,l),o.length-1),c=o[a];if(c.isShared&&(o[a]=c=c.clone()),c.keys.length>=i){let d;a>0&&(d=o[a-1]).keys.length<i&&l(c.keys[0],e)<0?(d.isShared&&(o[a-1]=d=d.clone()),d.takeFromRight(c),this.keys[a-1]=d.maxKey()):(d=o[a+1])!==void 0&&d.keys.length<i&&l(c.maxKey(),e)<0&&(d.isShared&&(o[a+1]=d=d.clone()),d.takeFromLeft(c),this.keys[a]=o[a].maxKey())}const u=c.set(e,t,n,r);if(u===!1)return!1;if(this.keys[a]=c.maxKey(),u===!0)return!0;if(this.keys.length<i)return this.insert(a+1,u),!0;{const d=this.splitOffRightSide();let h=this;return l(u.maxKey(),this.maxKey())>0&&(h=d,a-=this.keys.length),h.insert(a+1,u),d}}insert(e,t){this.children.splice(e,0,t),this.keys.splice(e,0,t.maxKey())}splitOffRightSide(){const e=this.children.length>>1;return new Jl(this.children.splice(e),this.keys.splice(e))}takeFromRight(e){this.keys.push(e.keys.shift()),this.children.push(e.children.shift())}takeFromLeft(e){this.keys.unshift(e.keys.pop()),this.children.unshift(e.children.pop())}forRange(e,t,n,r,o,i,l){const a=o._compare,c=this.keys,u=this.children;let d=this.indexOf(e,0,a),h=d,f=Math.min(t===e?d:this.indexOf(t,0,a),c.length-1);if(r){if(h<=f)try{for(;h<=f;h++){u[h].isShared&&(u[h]=u[h].clone());const g=u[h].forRange(e,t,n,r,o,i,l);if(c[h]=u[h].maxKey(),typeof g!="number")return g;i=g}}finally{const g=o._maxNodeSize>>1;for(d>0&&d--,h=f;h>=d;h--)u[h].keys.length<=g&&(u[h].keys.length!==0?this.tryMerge(h,o._maxNodeSize):(c.splice(h,1),u.splice(h,1)));u.length!==0&&u[0].keys.length===0&&zn(!1,"emptiness bug")}}else for(;h<=f;h++){const g=u[h].forRange(e,t,n,r,o,i,l);if(typeof g!="number")return g;i=g}return i}tryMerge(e,t){const n=this.children;return e>=0&&e+1<n.length&&n[e].keys.length+n[e+1].keys.length<=t&&(n[e].isShared&&(n[e]=n[e].clone()),n[e].mergeSibling(n[e+1],t),n.splice(e+1,1),this.keys.splice(e+1,1),this.keys[e]=n[e].maxKey(),!0)}mergeSibling(e,t){const n=this.keys.length;this.keys.push.apply(this.keys,e.keys);const r=e.children;if(this.children.push.apply(this.children,r),e.isShared&&!this.isShared)for(let o=0;o<r.length;o++)r[o].isShared=!0;this.tryMerge(n-1,t)}};const dn=[],Qu=Object.freeze({done:!0,value:void 0}),kc=function(){const s=new Hp;return s.isShared=!0,s}(),Fh=[],zn=(s,...e)=>{if(!s)throw e.unshift("SortedMap:"),new Error(e.join(" "))};var jr;(jr=mt||(mt={})).DeleteValue=Object.freeze({delete:!0}),jr.Break=Object.freeze({break:!0}),jr.DeleteRange=()=>jr.DeleteValue,jr.EmptySortedMap=(()=>{const s=new jr;return s.freeze(),s})(),jr.defaultComparator=function(s,e){if(Number.isFinite(s)&&Number.isFinite(e))return s-e;let t=typeof s,n=typeof e;if(t!==n)return t<n?-1:1;if(t==="object"){if(s===null)return e===null?0:-1;if(e===null)return 1;if(t=typeof(s=s.valueOf()),n=typeof(e=e.valueOf()),t!==n)return t<n?-1:1}return s<e?-1:s>e?1:s===e?0:Number.isNaN(s)?Number.isNaN(e)?0:-1:Number.isNaN(e)?1:Array.isArray(s)?0:Number.NaN},jr.simpleComparator=function(s,e){return s>e?1:s<e?-1:0};const Oh=[-1,null],a_={done:!1,value:[-1,null]};var At;(s=>{s.Builder=class{constructor(t,n=0,r=0){this._tuples=[],this._minors=null,this._values=null,this._minorMin=Number.MAX_SAFE_INTEGER,this._minorMax=0,this._majorIndex=Number.MIN_SAFE_INTEGER,this._minorIndex=Number.MIN_SAFE_INTEGER,this._offsetMajor=0,this._offsetMinor=0,this._createList=t,this._offsetMajor=n,this._offsetMinor=r}addValues(t,n,r){if(r&&r.isIList)return this.addValue(t,n,r);Array.isArray(r)||(r=[r]),this.addValue(t,n,r[0]);const o=r.length,i=this._values;for(let l=1;l<o;l++)i.push(r[l]);return this._minorIndex=this._minorIndex+i.length-1,this}addValue(t,n,r){const o=this._majorIndex,i=this._minorIndex;if(t+=this._offsetMajor,n+=this._offsetMinor,t<o||t===o&&n<=i)throw new e(`major: ${t}, minor: ${n}, prevMajor: ${this._majorIndex}, prevMinor: ${this._minorIndex}`);let l=this._minors;if(t!==o){if(l){this._minorMin=Math.min(this._minorMin,l[0][0]);const a=l[l.length-1];this._minorMax=Math.max(this._minorMax,a[0]+a[1].length-1)}this._minors=l=[],this._tuples.push([t,l]),this._majorIndex=t}if(r&&r.isIList){n===i+1&&o!==t&&this._values;const a=r;l.push([n,a]),n=n+a.length-1}else{let a=null;n!==i+1||o!==t?(this._values=a=[],l.push([n,a])):a=this._values,a.push(r)}return this._minorIndex=n,this}build(){const t=this._tuples;if(t.length===0)return null;const n=this._minors;this._minorMin=Math.min(this._minorMin,n[0][0]);const r=n[n.length-1];this._minorMax=Math.max(this._minorMax,r[0]+r[1].length-1);const o=this._createList;if(o){const i=n.length;for(let l=0;l<i;l++)n[l][1]=o(n[l][1])}return{tuples:t,bounds:{majorStart:t[0][0],minorStart:this._minorMin,majorEnd:t[t.length-1][0],minorEnd:this._minorMax}}}},s.TransposedBuilder=class{constructor(t,n=0,r=0){this._majorMin=Number.MAX_SAFE_INTEGER,this._majorMax=0,this._majorIndex=Number.MIN_SAFE_INTEGER,this._minorIndex=Number.MIN_SAFE_INTEGER,this._offsetMajor=0,this._offsetMinor=0,this._createList=t,this._offsetMajor=n,this._offsetMinor=r,this._minors=new mt}addValues(t,n,r){Array.isArray(r)||(r=[r]);const o=r.length;for(let i=0;i<o;i++){const l=n+i;this.addValue(t,l,r[i])}return this}addValue(t,n,r){let o,i;const l=this._majorIndex;let a=this._minorIndex;if(t+=this._offsetMajor,n+=this._offsetMinor,i=this._current,t!==l){if(this._majorIndex=t,t<l)throw new e(`major: ${t}, minor: ${n}, prevMajor: ${this._majorIndex}, prevMinor: ${this._minorIndex}`);a=Number.MIN_SAFE_INTEGER}else if(i=this._current,n<=a)throw new e(`major: ${t}, minor: ${n}, prevMajor: ${this._majorIndex}, prevMinor: ${this._minorIndex}`);if(i&&i.minor===n&&(o=i.span),o)i.minor>=n&&i.next&&(this._current=i.next);else{const f=this._minors,g=i?i.next??i.prev:null;if(g){let m;const p=g.minor;g&&g.minor===n?(i=g,o=i.span):m=p>n?f.getPairOrNextHigher(n,Oh):f.getPairOrNextLower(n,Oh),m&&(i=m[1],m[0]===n&&(o=i.span))}if(!o){this._majorMin=Math.min(this._majorMin,t),o=[n,[[t,[]]]];const m={minor:n,span:o,prev:null,next:null};i&&(i.minor<n?(m.prev=i,m.next=i.next,i.next&&(i.next.prev=m),i.next=m):(m.prev=i.prev,m.next=i,i.prev&&(i.prev.next=m),i.prev=m)),f.set(n,m),this._current=m;const p=this._first;(!p||n<p.minor)&&(this._first=m),m.next&&(this._current=m.next)}}let c=o[1];const u=c[c.length-1];let d=u[0],h=u[1];return d+h.length!==t&&(h=[],d=t,c.push([d,h])),h.push(r),this._majorMax=Math.max(this._majorMax,t),this._minorIndex=n,this}build(){const t=[],n=this._createList,r=this._minors.entries(void 0,a_);let o=r.next();for(;!o.done;){const i=o.value[1].span;if(n)for(let l=0;l<i.length;l++)i[l][1]=this._createList(i[l][1]);t.push(i),o=r.next()}return t.length===0?null:{tuples:t,bounds:{majorStart:t[0][0],minorStart:this._majorMin,majorEnd:t[t.length-1][0],minorEnd:this._majorMax}}}};class e extends DS{constructor(n="Out of order",r=null){super(n,r),this.name="OutOfOrderError"}}s.OutOfOrderError=e})(At||(At={}));const c_={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}};function Nc(s){return(e={})=>{const t=e.width?String(e.width):s.defaultWidth;return s.formats[t]||s.formats[s.defaultWidth]}}const u_={date:Nc({formats:{full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},defaultWidth:"full"}),time:Nc({formats:{full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},defaultWidth:"full"}),dateTime:Nc({formats:{full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},defaultWidth:"full"})},d_={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"};function Ws(s){return(e,t)=>{let n;if((t?.context?String(t.context):"standalone")==="formatting"&&s.formattingValues){const r=s.defaultFormattingWidth||s.defaultWidth,o=t?.width?String(t.width):r;n=s.formattingValues[o]||s.formattingValues[r]}else{const r=s.defaultWidth,o=t?.width?String(t.width):s.defaultWidth;n=s.values[o]||s.values[r]}return n[s.argumentCallback?s.argumentCallback(e):e]}}function js(s){return(e,t={})=>{const n=t.width,r=n&&s.matchPatterns[n]||s.matchPatterns[s.defaultMatchWidth],o=e.match(r);if(!o)return null;const i=o[0],l=n&&s.parsePatterns[n]||s.parsePatterns[s.defaultParseWidth],a=Array.isArray(l)?function(u,d){for(let h=0;h<u.length;h++)if(d(u[h]))return h}(l,u=>u.test(i)):function(u,d){for(const h in u)if(Object.prototype.hasOwnProperty.call(u,h)&&d(u[h]))return h}(l,u=>u.test(i));let c;return c=s.valueCallback?s.valueCallback(a):a,c=t.valueCallback?t.valueCallback(c):c,{value:c,rest:e.slice(i.length)}}}var Gs;const h_={code:"en-US",formatDistance:(s,e,t)=>{let n;const r=c_[s];return n=typeof r=="string"?r:e===1?r.one:r.other.replace("{{count}}",e.toString()),t?.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n},formatLong:u_,formatRelative:(s,e,t,n)=>d_[s],localize:{ordinalNumber:(s,e)=>{const t=Number(s),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},era:Ws({values:{narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},defaultWidth:"wide"}),quarter:Ws({values:{narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},defaultWidth:"wide",argumentCallback:s=>s-1}),month:Ws({values:{narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},defaultWidth:"wide"}),day:Ws({values:{narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},defaultWidth:"wide"}),dayPeriod:Ws({values:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},defaultWidth:"wide",formattingValues:{narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},defaultFormattingWidth:"wide"})},match:{ordinalNumber:(Gs={matchPattern:/^(\d+)(th|st|nd|rd)?/i,parsePattern:/\d+/i,valueCallback:s=>parseInt(s,10)},(s,e={})=>{const t=s.match(Gs.matchPattern);if(!t)return null;const n=t[0],r=s.match(Gs.parsePattern);if(!r)return null;let o=Gs.valueCallback?Gs.valueCallback(r[0]):r[0];return o=e.valueCallback?e.valueCallback(o):o,{value:o,rest:s.slice(n.length)}}),era:js({matchPatterns:{narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},defaultMatchWidth:"wide",parsePatterns:{any:[/^b/i,/^(a|c)/i]},defaultParseWidth:"any"}),quarter:js({matchPatterns:{narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},defaultMatchWidth:"wide",parsePatterns:{any:[/1/i,/2/i,/3/i,/4/i]},defaultParseWidth:"any",valueCallback:s=>s+1}),month:js({matchPatterns:{narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},defaultParseWidth:"any"}),day:js({matchPatterns:{narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},defaultMatchWidth:"wide",parsePatterns:{narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},defaultParseWidth:"any"}),dayPeriod:js({matchPatterns:{narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},defaultMatchWidth:"any",parsePatterns:{any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},defaultParseWidth:"any"})},options:{weekStartsOn:0,firstWeekContainsDate:1}},Dh=(s,e)=>{switch(s){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});default:return e.date({width:"full"})}},Lh=(s,e)=>{switch(s){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});default:return e.time({width:"full"})}},Bh={p:Lh,P:(s,e)=>{const t=s.match(/(P+)(p+)?/)||[],n=t[1],r=t[2];if(!r)return Dh(s,e);let o;switch(n){case"P":o=e.dateTime({width:"short"});break;case"PP":o=e.dateTime({width:"medium"});break;case"PPP":o=e.dateTime({width:"long"});break;default:o=e.dateTime({width:"full"})}return o.replace("{{date}}",Dh(n,e)).replace("{{time}}",Lh(r,e))}},g_=/^D+$/,f_=/^Y+$/,m_=["D","DD","YY","YYYY"];function p_(s){return g_.test(s)}function w_(s){return f_.test(s)}function zh(s,e,t){const n=function(r,o,i){const l=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${o}\`) for formatting ${l} to the input \`${i}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}(s,e,t);if(console.warn(n),m_.includes(s))throw new RangeError(n)}const Ph=Symbol.for("constructDateFrom");function gs(s,e){return typeof s=="function"?s(e):s&&typeof s=="object"&&Ph in s?s[Ph](e):s instanceof Date?new s.constructor(e):new Date(e)}let S_={};function $p(){return S_}function Aa(s,e){return gs(e||s,s)}class Vp{constructor(){this.subPriority=0}validate(e,t){return!0}}class __ extends Vp{constructor(e,t,n,r,o){super(),this.value=e,this.validateValue=t,this.setValue=n,this.priority=r,o&&(this.subPriority=o)}validate(e,t){return this.validateValue(e,this.value,t)}set(e,t,n){return this.setValue(e,t,this.value,n)}}class y_ extends Vp{constructor(e,t){super(),this.priority=10,this.subPriority=-1,this.context=e||(n=>gs(t,n))}set(e,t){return t.timestampIsSet?e:gs(e,function(n,r){const o=function(i){return typeof i=="function"&&i.prototype?.constructor===i}(r)?new r(0):gs(r,0);return o.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),o.setHours(n.getHours(),n.getMinutes(),n.getSeconds(),n.getMilliseconds()),o}(e,this.context))}}let Kl=class{run(s,e,t,n){const r=this.parse(s,e,t,n);return r?{setter:new __(r.value,this.validate,this.set,this.priority,this.subPriority),rest:r.rest}:null}validate(s,e,t){return!0}};const Wp=/^(1[0-2]|0?\d)/,b_=/^(3[0-1]|[0-2]?\d)/,v_=/^\d/,C_=/^\d{1,2}/,x_=/^\d{1,3}/,E_=/^\d{1,4}/;function Dr(s,e){return s&&{value:e(s.value),rest:s.rest}}function no(s,e){const t=e.match(s);return t?{value:parseInt(t[0],10),rest:e.slice(t[0].length)}:null}function Ai(s,e){switch(s){case 1:return no(v_,e);case 2:return no(C_,e);case 3:return no(x_,e);case 4:return no(E_,e);default:return no(new RegExp("^\\d{1,"+s+"}"),e)}}class jp extends Kl{constructor(){super(...arguments),this.incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"],this.priority=110}parse(e,t,n){const r=o=>o-1;switch(t){case"M":return Dr(no(Wp,e),r);case"MM":return Dr(Ai(2,e),r);case"Mo":return Dr(n.ordinalNumber(e,{unit:"month"}),r);case"MMM":return n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"});case"MMMMM":return n.month(e,{width:"narrow",context:"formatting"});default:return n.month(e,{width:"wide",context:"formatting"})||n.month(e,{width:"abbreviated",context:"formatting"})||n.month(e,{width:"narrow",context:"formatting"})}}validate(e,t){return t>=0&&t<=11}set(e,t,n){return e.setMonth(n,1),e.setHours(0,0,0,0),e}}const R_=[31,28,31,30,31,30,31,31,30,31,30,31],I_=[31,29,31,30,31,30,31,31,30,31,30,31];function A_(s,e,t){const n=$p(),r=t?.weekStartsOn??t?.locale?.options?.weekStartsOn??n.weekStartsOn??n.locale?.options?.weekStartsOn??0,o=Aa(s,t?.in),i=o.getDay(),l=7-r;return function(a,c,u){const d=Aa(a,u?.in);return isNaN(c)?gs(u?.in||a,NaN):(c&&d.setDate(d.getDate()+c),d)}(o,e<0||e>6?e-(i+l)%7:((e%7+7)%7+l)%7-(i+l)%7,t)}const fi={y:new class extends Kl{constructor(){super(...arguments),this.priority=130,this.incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"]}parse(s,e,t){const n=r=>({year:r,isTwoDigitYear:e==="yy"});switch(e){case"y":return Dr(Ai(4,s),n);case"yo":return Dr(t.ordinalNumber(s,{unit:"year"}),n);default:return Dr(Ai(e.length,s),n)}}validate(s,e){return e.isTwoDigitYear||e.year>0}set(s,e,t){const n=s.getFullYear();if(t.isTwoDigitYear){const o=function(i,l){const a=l>0,c=a?l:1-l;let u;if(c<=50)u=i||100;else{const d=c+50;u=i+100*Math.trunc(d/100)-(i>=d%100?100:0)}return a?u:1-u}(t.year,n);return s.setFullYear(o,0,1),s.setHours(0,0,0,0),s}const r="era"in e&&e.era!==1?1-t.year:t.year;return s.setFullYear(r,0,1),s.setHours(0,0,0,0),s}},M:new jp,d:new class extends Kl{constructor(){super(...arguments),this.priority=90,this.subPriority=1,this.incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}parse(s,e,t){switch(e){case"d":return no(b_,s);case"do":return t.ordinalNumber(s,{unit:"date"});default:return Ai(e.length,s)}}validate(s,e){const t=function(r){return r%400==0||r%4==0&&r%100!=0}(s.getFullYear()),n=s.getMonth();return t?e>=1&&e<=I_[n]:e>=1&&e<=R_[n]}set(s,e,t){return s.setDate(t),s.setHours(0,0,0,0),s}},E:new class extends Kl{constructor(){super(...arguments),this.priority=90,this.incompatibleTokens=["D","i","e","c","t","T"]}parse(s,e,t){switch(e){case"E":case"EE":case"EEE":return t.day(s,{width:"abbreviated",context:"formatting"})||t.day(s,{width:"short",context:"formatting"})||t.day(s,{width:"narrow",context:"formatting"});case"EEEEE":return t.day(s,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(s,{width:"short",context:"formatting"})||t.day(s,{width:"narrow",context:"formatting"});default:return t.day(s,{width:"wide",context:"formatting"})||t.day(s,{width:"abbreviated",context:"formatting"})||t.day(s,{width:"short",context:"formatting"})||t.day(s,{width:"narrow",context:"formatting"})}}validate(s,e){return e>=0&&e<=6}set(s,e,t,n){return(s=A_(s,t,n)).setHours(0,0,0,0),s}}},M_=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,T_=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,k_=/^'([^]*?)'?$/,N_=/''/g,F_=/\S/,O_=/[a-zA-Z]/;function D_(s,e,t,n){const r=()=>gs(n?.in||t,NaN),o=Object.assign({},$p()),i=n?.locale??o.locale??h_,l=n?.firstWeekContainsDate??n?.locale?.options?.firstWeekContainsDate??o.firstWeekContainsDate??o.locale?.options?.firstWeekContainsDate??1,a=n?.weekStartsOn??n?.locale?.options?.weekStartsOn??o.weekStartsOn??o.locale?.options?.weekStartsOn??0;if(!e)return s?r():Aa(t,n?.in);const c={firstWeekContainsDate:l,weekStartsOn:a,locale:i},u=[new y_(n?.in,t)],d=e.match(T_).map(p=>{const w=p[0];return w in Bh?(0,Bh[w])(p,i.formatLong):p}).join("").match(M_),h=[];for(let p of d){!n?.useAdditionalWeekYearTokens&&w_(p)&&zh(p,e,s),!n?.useAdditionalDayOfYearTokens&&p_(p)&&zh(p,e,s);const w=p[0],S=fi[w];if(S){const{incompatibleTokens:b}=S;if(Array.isArray(b)){const y=h.find(_=>b.includes(_.token)||_.token===w);if(y)throw new RangeError(`The format string mustn't contain \`${y.fullToken}\` and \`${p}\` at the same time`)}else if(S.incompatibleTokens==="*"&&h.length>0)throw new RangeError(`The format string mustn't contain \`${p}\` and any other token at the same time`);h.push({token:w,fullToken:p});const v=S.run(s,p,i.match,c);if(!v)return r();u.push(v.setter),s=v.rest}else{if(w.match(O_))throw new RangeError("Format string contains an unescaped latin alphabet character `"+w+"`");if(p==="''"?p="'":w==="'"&&(p=L_(p)),s.indexOf(p)!==0)return r();s=s.slice(p.length)}}if(s.length>0&&F_.test(s))return r();const f=u.map(p=>p.priority).sort((p,w)=>w-p).filter((p,w,S)=>S.indexOf(p)===w).map(p=>u.filter(w=>w.priority===p).sort((w,S)=>S.subPriority-w.subPriority)).map(p=>p[0]);let g=Aa(t,n?.in);if(isNaN(+g))return r();const m={};for(const p of f){if(!p.validate(g,c))return r();const w=p.set(g,m,c);Array.isArray(w)?(g=w[0],Object.assign(m,w[1])):g=w}return g}function L_(s){return s.match(k_)[1].replace(N_,"'")}const Gp=s=>!isNaN(s)&&(Object.prototype.toString.call(s)==="[object Date]"||s instanceof Date);function Hh(s,e,t){let n=s,r=s.length,o=e.length;for(var i=r;i<o;++i){const l=e[i];if(l==="#")return n;n=t?n+l:l+n}return n}function Hn(s,e){for(var t="";t.length<e;)t+=s;return t}function fs(s){for(var e="",t=s.length-1;t>=0;)e+=s.charAt(t--);return e}function Xn(s,e){var t=""+s;return t.length>=e?t:Hn("0",e-t.length)+t}function ed(s,e){var t=""+s;return t.length>=e?t:Hn(" ",e-t.length)+t}function Ma(s,e){var t=""+s;return t.length>=e?t:t+Hn(" ",e-t.length)}var $h=Math.pow(2,32);function qo(s,e){return s>$h||s<-$h?function(t,n){var r=""+Math.round(t);return r.length>=n?r:Hn("0",n-r.length)+r}(s,e):function(t,n){var r=""+t;return r.length>=n?r:Hn("0",n-r.length)+r}(Math.round(s),e)}function Xl(s,e){return e=e||0,s.length>=7+e&&(32|s.charCodeAt(e))==103&&(32|s.charCodeAt(e+1))==101&&(32|s.charCodeAt(e+2))==110&&(32|s.charCodeAt(e+3))==101&&(32|s.charCodeAt(e+4))==114&&(32|s.charCodeAt(e+5))==97&&(32|s.charCodeAt(e+6))==108}var Vh=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],Fc=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]],Ao={0:"General",1:"0",2:"0.00",3:"#,##0",4:"#,##0.00",5:"$#,##0_);($#,##0)",6:"$#,##0_);[Red]($#,##0)",7:"$#,##0.00_);($#,##0.00)",8:"$#,##0.00_);[Red]($#,##0.00)",9:"0%",10:"0.00%",11:"0.00E+00",12:"# ?/?",13:"# ??/??",14:"m/d/yy",15:"d-mmm-yy",16:"d-mmm",17:"mmm-yy",18:"h:mm AM/PM",19:"h:mm:ss AM/PM",20:"h:mm",21:"h:mm:ss",22:"m/d/yy h:mm",23:"General",24:"General",25:"General",26:"General",27:"m/d/yyyy",28:"m/d/yyyy",29:"m/d/yyyy",30:"m/d/yyyy",32:"h:mm:ss",31:"m/d/yyyy",33:"h:mm:ss",34:"h:mm:ss",35:"h:mm:ss",36:"m/d/yyyy",37:"#,##0_);(#,##0)",38:"#,##0_);[Red](#,##0)",39:"#,##0.00_);(#,##0.00)",40:"#,##0.00_);[Red](#,##0.00)",41:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',42:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)',43:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',44:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',45:"mm:ss",46:"[h]:mm:ss",47:"mmss.0",48:"##0.0E+0",49:"@",50:"m/d/yyyy",51:"m/d/yyyy",52:"m/d/yyyy",53:"m/d/yyyy",54:"m/d/yyyy",55:"m/d/yyyy",56:'"上午/下午 "hh"時"mm"分"ss"秒 "'},Wh={5:37,6:38,7:39,8:40,23:0,24:0,25:0,26:0,27:14,28:14,29:14,30:14,31:14,50:14,51:14,52:14,53:14,54:14,55:14,56:14,57:14,58:14,59:1,60:2,61:3,62:4,67:9,68:10,69:12,70:13,71:14,72:14,73:15,74:16,75:17,76:20,77:21,78:22,79:45,80:46,81:47,82:0},B_={5:'"$"#,##0_);\\("$"#,##0\\)',63:'"$"#,##0_);\\("$"#,##0\\)',6:'"$"#,##0_);[Red]\\("$"#,##0\\)',64:'"$"#,##0_);[Red]\\("$"#,##0\\)',7:'"$"#,##0.00_);\\("$"#,##0.00\\)',65:'"$"#,##0.00_);\\("$"#,##0.00\\)',8:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',66:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',41:'_(* #,##0_);_(* \\(#,##0\\);_(* "-"_);_(@_)',42:'_("$"* #,##0_);_("$"* \\(#,##0\\);_("$"* "-"_);_(@_)',43:'_(* #,##0.00_);_(* \\(#,##0.00\\);_(* "-"??_);_(@_)',44:'_("$"* #,##0.00_);_("$"* \\(#,##0.00\\);_("$"* "-"??_);_(@_)'};function Ta(s,e,t){for(var n=s<0?-1:1,r=s*n,o=0,i=1,l=0,a=1,c=0,u=0,d=Math.floor(r);c<e&&(l=(d=Math.floor(r))*i+o,u=d*c+a,!(r-d<5e-8));)r=1/(r-d),o=i,i=l,a=c,c=u;if(u>e&&(c>e?(u=a,l=o):(u=c,l=i)),!t)return[0,n*l,u];var h=Math.floor(n*l/u);return[h,n*l-h*u,u]}function mi(s,e,t){if(s>2958465||s<0)return null;var n=0|s,r=Math.floor(86400*(s-n)),o=0,i=[],l={D:n,T:r,u:86400*(s-n)-r,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(l.u)<1e-6&&(l.u=0),e&&e.date1904&&(n+=1462),l.u>.9999&&(l.u=0,++r===86400&&(l.T=r=0,++n,++l.D)),n===60)i=t?[1317,10,29]:[1900,2,29],o=3;else if(n===0)i=t?[1317,8,29]:[1900,1,0],o=6;else{n>60&&--n;var a=new Date(1900,0,1);a.setDate(a.getDate()+n-1),i=[a.getFullYear(),a.getMonth()+1,a.getDate()],o=a.getDay(),n<60&&(o=(o+6)%7),t&&(o=function(c,u){u[0]-=581;var d=c.getDay();return c<60&&(d=(d+6)%7),d}(a,i))}return l.y=i[0],l.m=i[1],l.d=i[2],l.S=r%60,r=Math.floor(r/60),l.M=r%60,r=Math.floor(r/60),l.H=r,l.q=o,l}var Up=new Date(1899,11,31,0,0,0),z_=Up.getTime(),P_=new Date(1900,2,1,0,0,0);function Gd(s,e=!1){var t=s.getTime();return e?t-=1262304e5:s>=P_&&(t+=864e5),(t-(z_+6e4*(s.getTimezoneOffset()-Up.getTimezoneOffset())))/864e5}function Oc(s){return s.indexOf(".")===-1?s:s.replace(/(?:\.0*|(\.\d*[1-9])0+)$/,"$1")}function H_(s){var e,t=Math.floor(Math.log(Math.abs(s))*Math.LOG10E);return e=t>=-4&&t<=-1?s.toPrecision(10+t):Math.abs(t)<=9?function(n){var r=n<0?12:11,o=Oc(n.toFixed(12));return o.length<=r||(o=n.toPrecision(10)).length<=r?o:n.toExponential(5)}(s):t===10?s.toFixed(10).substr(0,12):function(n){var r=Oc(n.toFixed(11));return r.length>(n<0?12:11)||r==="0"||r==="-0"?n.toPrecision(6):r}(s),Oc(function(n){return n.indexOf("E")===-1?n:n.replace(/(?:\.0*|(\.\d*[1-9])0+)[Ee]/,"$1E").replace(/(E[+-])(\d)$/,"$10$2")}(e.toUpperCase()))}function Dc(s,e){switch(typeof s){case"string":return s;case"boolean":return s?"TRUE":"FALSE";case"number":return(0|s)===s?s.toString(10):H_(s);case"undefined":return"";case"object":if(s==null)return"";if(Gp(s))return r0(14,Gd(s,e&&e.date1904),e)}throw new Error("unsupported value in General format: "+s)}function $_(s,e,t,n){var r,o="",i=0,l=0,a=t.y,c=0;switch(s){case 98:a=t.y+543;case 121:switch(e.length){case 1:case 2:r=a%100,c=2;break;default:r=a%1e4,c=4}break;case 109:switch(e.length){case 1:case 2:r=t.m,c=e.length;break;case 3:return Fc[t.m-1][1];case 5:return Fc[t.m-1][0];default:return Fc[t.m-1][2]}break;case 100:switch(e.length){case 1:case 2:r=t.d,c=e.length;break;case 3:return Vh[t.q][0];default:return Vh[t.q][1]}break;case 104:switch(e.length){case 1:case 2:r=1+(t.H+11)%12,c=e.length;break;default:throw new Error("bad hour format: "+e)}break;case 72:switch(e.length){case 1:case 2:r=t.H,c=e.length;break;default:throw new Error("bad hour format: "+e)}break;case 77:switch(e.length){case 1:case 2:r=t.M,c=e.length;break;default:throw new Error("bad minute format: "+e)}break;case 115:if(e!=="s"&&e!=="ss"&&e!==".0"&&e!==".00"&&e!==".000")throw new Error("bad second format: "+e);return t.u!==0||e!=="s"&&e!=="ss"?(l=n>=2?n===3?1e3:100:n===1?10:1,(i=Math.round(l*(t.S+t.u)))>=60*l&&(i=0),e==="s"?i===0?"0":""+i/l:(o=Xn(i,2+n),e==="ss"?o.substr(0,2):"."+o.substr(2,e.length-1))):Xn(t.S,e.length);case 90:switch(e){case"[h]":case"[hh]":r=24*t.D+t.H;break;case"[m]":case"[mm]":r=60*(24*t.D+t.H)+t.M;break;case"[s]":case"[ss]":r=60*(60*(24*t.D+t.H)+t.M)+Math.round(t.S+t.u);break;default:throw new Error("bad absolute time format: "+e)}c=e.length===3?1:2;break;case 101:r=a,c=1}return c>0?Xn(r,c):""}function ro(s){if(s.length<=3)return s;for(var e=s.length%3,t=s.substr(0,e);e!==s.length;e+=3)t+=(t.length>0?",":"")+s.substr(e,3);return t}var qp=/%/g;function Jp(s,e){var t,n=s.indexOf("E")-s.indexOf(".")-1;if(s.match(/^#+0.0E\+0$/)){if(e===0)return"0.0E+0";if(e<0)return"-"+Jp(s,-e);var r=s.indexOf(".");r===-1&&(r=s.indexOf("E"));var o=Math.floor(Math.log(e)*Math.LOG10E)%r;if(o<0&&(o+=r),(t=(e/Math.pow(10,o)).toPrecision(n+1+(r+o)%r)).indexOf("e")===-1){var i=Math.floor(Math.log(e)*Math.LOG10E);for(t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(i-t.length+o):t+="E+"+(i-o);t.substr(0,2)==="0.";)t=(t=t.charAt(0)+t.substr(2,r)+"."+t.substr(2+r)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,a,c,u){return a+c+u.substr(0,(r+o)%r)+"."+u.substr(o)+"E"})}else t=e.toExponential(n);return s.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),s.match(/E-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}var Kp=/[0#?] (\?+)( ?)\/( ?)(\d+)/,Xp=/^([0#?]+)\.([0#?]+)/,Zp=/\).*[0#]/,Yp=/\(###\) ###\\?-####/;function Un(s){var e="";let t,n=s.length;for(var r=0;r!==n;++r)switch(t=s.charAt(r),t){case"#":break;case" ":e+=" ";break;case"0":e+="0";break;case"?":e+="?";break;default:e+=String.fromCharCode(cc)}return e}function jh(s,e){var t=Math.pow(10,e);return""+Math.round(s*t)/t}function Gh(s,e){var t=Math.pow(10,e);return Math.round(s*t)/t}function Uh(s,e){var t=s-Math.floor(s),n=Math.pow(10,e);return e<(""+Math.round(t*n)).length?0:Math.round(t*n)}function Ln(s,e,t){if(s.charCodeAt(0)===40&&!e.match(Zp)){var n=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?Ln("n",n,t):"("+Ln("n",n,-t)+")"}if(e.charCodeAt(e.length-1)===44)return function(m,p,w){let S=p.length-1;for(;p.charCodeAt(S-1)===44;)--S;return Lr(m,p.substr(0,S),w/Math.pow(10,3*(p.length-S)))}(s,e,t);if(e.indexOf("%")!==-1)return function(m,p,w){let S=p.replace(qp,""),b=p.length-S.length;return Lr(m,S,w*Math.pow(10,2*b))+Hn("%",b)}(s,e,t);if(e.indexOf("E")!==-1)return Jp(e,t);if(e.charCodeAt(0)===36)return"$"+Ln(s,e.substr(e.charAt(1)===" "?2:1),t);var r,o,i,l,a=Math.abs(t),c=t<0?"-":"";if(e.match(/^00+$/))return c+qo(a,e.length);if(e.match(/^[#?]+$/))return(r=qo(t,0))==="0"&&(r=""),r.length>e.length?r:Un(e.substr(0,e.length-r.length))+r;if(o=e.match(Kp))return function(m,p,w){var S=parseInt(m[4],10),b=Math.round(p*S),v=Math.floor(b/S),y=b-v*S,_=S;return w+(v===0?"":""+v)+" "+(y===0?Hn(" ",m[1].length+1+m[4].length):ed(y,m[1].length)+m[2]+"/"+m[3]+Xn(_,m[4].length))}(o,a,c);if(e.match(/^#+0+$/))return c+qo(a,e.length-e.indexOf("0"));if(o=e.match(Xp)){i=Math.trunc(jh(t,o[2].length));var u=function(m){if(!isFinite(m))return 0;for(var p=1,w=0;Math.round(m*p)/p!==m;)p*=10,w++;return w}(l=Gh(Math.abs(i-t),o[2].length));return l=(l=""+Gh(l,u)).replace(/^0\./,""),r=Hh(""+Math.abs(i),o[1])+"."+Hh(""+l,o[2],!0),r=e.indexOf("0.")!==-1?r:r.replace(/^0\./,"."),t<0?"-"+r:r}if(o=(e=e.replace(/^#+([0.])/,"$1")).match(/^(0*)\.(#*)$/))return c+jh(a,o[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,o[1].length?"0.":".");if(o=e.match(/^#{1,3},##0(\.?)$/))return c+ro(qo(a,0));if(o=e.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+Ln(s,e,-t):ro(""+(Math.floor(t)+function(m,p){return p<(""+Math.round((m-Math.floor(m))*Math.pow(10,p))).length?1:0}(t,o[1].length)))+"."+Xn(Uh(t,o[1].length),o[1].length);if(o=e.match(/^#,#*,#0/))return Ln(s,e.replace(/^#,#*,/,""),t);if(o=e.match(/^([0#]+)(\\?-([0#]+))+$/))return r=fs(Ln(s,e.replace(/[\\-]/g,""),t)),i=0,fs(fs(e.replace(/\\/g,"")).replace(/[0#]/g,function(m){return i<r.length?r.charAt(i++):m==="0"?"0":""}));if(e.match(Yp))return"("+(r=Ln(s,"##########",t)).substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var d="";if(o=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(o[4].length,7),l=Ta(a,Math.pow(10,i)-1,!1),r=""+c,(d=Lr("n",o[1],l[1])).charAt(d.length-1)===" "&&(d=d.substr(0,d.length-1)+"0"),r+=d+o[2]+"/"+o[3],(d=Ma(l[2],i)).length<o[4].length&&(d=Un(o[4].substr(o[4].length-d.length))+d),r+=d;if(o=e.match(/[#0?] ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(o[1].length,o[4].length),7),l=Ta(a,Math.pow(10,i)-1,!0),c+Ln(s,e.substring(0,o.index+1),l[0])+" "+(l[1]?ed(l[1],i)+o[2]+"/"+o[3]+Ma(l[2],i):Hn(" ",2*i+1+o[2].length+o[3].length));if(o=e.match(/^[#0?]+$/))return r=qo(t,0),e.length<=r.length?r:Un(e.substr(0,e.length-r.length))+r;if(o=e.match(/^([#0?]+)\.([#0]+)$/)){r=""+t.toFixed(Math.min(o[2].length,10)).replace(/([^0])0+$/,"$1"),i=r.indexOf(".");var h=e.indexOf(".")-i,f=e.length-r.length-h;return Un(e.substr(0,h)+r+e.substr(e.length-f))}if(o=e.match(/^00,000\.([#0]*0)$/))return i=Uh(t,o[1].length),t<0?"-"+Ln(s,e,-t):ro(function(m){return m<2147483647&&m>-2147483648?""+(m>=0?0|m:m-1|0):""+Math.floor(m)}(t)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(m){return"00,"+(m.length<3?Xn(0,3-m.length):"")+m})+"."+Xn(i,o[1].length);switch(e){case"###,##0.00":return Ln(s,"#,##0.00",t);case"###,###":case"##,###":case"#,###":var g=ro(qo(a,0));return g!=="0"?c+g:"";case"###,###.00":return Ln(s,"###,##0.00",t).replace(/^0\./,".");case"#,###.00":return Ln(s,"#,##0.00",t).replace(/^0\./,".")}throw new Error("unsupported format |"+e+"|")}function Qp(s,e){var t,n=s.indexOf("E")-s.indexOf(".")-1;if(s.match(/^#+0.0E\+0$/)){if(e===0)return"0.0E+0";if(e<0)return"-"+Qp(s,-e);var r=s.indexOf(".");r===-1&&(r=s.indexOf("E"));var o=Math.floor(Math.log(e)*Math.LOG10E)%r;if(o<0&&(o+=r),!(t=(e/Math.pow(10,o)).toPrecision(n+1+(r+o)%r)).match(/[Ee]/)){var i=Math.floor(Math.log(e)*Math.LOG10E);t.indexOf(".")===-1?t=t.charAt(0)+"."+t.substr(1)+"E+"+(i-t.length+o):t+="E+"+(i-o),t=t.replace(/\+-/,"-")}t=t.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,function(l,a,c,u){return a+c+u.substr(0,(r+o)%r)+"."+u.substr(o)+"E"})}else t=e.toExponential(n);return s.match(/E\+00$/)&&t.match(/e[+-]\d$/)&&(t=t.substr(0,t.length-1)+"0"+t.charAt(t.length-1)),s.match(/E-/)&&t.match(/e\+/)&&(t=t.replace(/e\+/,"e")),t.replace("e","E")}function dr(s,e,t){if(s.charCodeAt(0)===40&&!e.match(Zp)){var n=e.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return t>=0?dr("n",n,t):"("+dr("n",n,-t)+")"}if(e.charCodeAt(e.length-1)===44)return function(g,m,p){for(var w=m.length-1;m.charCodeAt(w-1)===44;)--w;return Lr(g,m.substr(0,w),p/Math.pow(10,3*(m.length-w)))}(s,e,t);if(e.indexOf("%")!==-1)return function(g,m,p){var w=m.replace(qp,""),S=m.length-w.length;return Lr(g,w,p*Math.pow(10,2*S))+Hn("%",S)}(s,e,t);if(e.indexOf("E")!==-1)return Qp(e,t);if(e.charCodeAt(0)===36)return"$"+dr(s,e.substr(e.charAt(1)===" "?2:1),t);var r,o,i,l,a=Math.abs(t),c=t<0?"-":"";if(e.match(/^00+$/))return c+Xn(a,e.length);if(e.match(/^[#?]+$/))return r=""+t,t===0&&(r=""),r.length>e.length?r:Un(e.substr(0,e.length-r.length))+r;if(o=e.match(Kp))return function(g,m,p){return p+(m===0?"":""+m)+Hn(" ",g[1].length+2+g[4].length)}(o,a,c);if(e.match(/^#+0+$/))return c+Xn(a,e.length-e.indexOf("0"));if(o=e.match(Xp))return r=(""+t).replace(/^([^.]+)$/,"."+Un(o[2])).replace(/\.$/,"."+Un(o[2])),r=Xn(Math.abs(t),o[1].length)+r.replace(/\.(\d*)$/,function(g,m){return"."+m+Hn("0",Un(o[2]).length-m.length)}),r=e.indexOf("0.")!==-1?r:r.replace(/^0\./,"."),t<0?"-"+r:r;if(e=e.replace(/^#+([0.])/,"$1"),o=e.match(/^(0*)\.(#*)$/))return c+(""+a).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,o[1].length?"0.":".");if(o=e.match(/^#{1,3},##0(\.?)$/))return c+ro(""+a);if(o=e.match(/^#,##0\.([#0]*0)$/))return t<0?"-"+dr(s,e,-t):ro(""+t)+"."+Hn("0",o[1].length);if(o=e.match(/^#,#*,#0/))return dr(s,e.replace(/^#,#*,/,""),t);if(o=e.match(/^([0#]+)(\\?-([0#]+))+$/))return r=fs(dr(s,e.replace(/[\\-]/g,""),t)),i=0,fs(fs(e.replace(/\\/g,"")).replace(/[0#]/g,function(g){return i<r.length?r.charAt(i++):g==="0"?"0":""}));if(e.match(Yp))return"("+(r=dr(s,"##########",t)).substr(0,3)+") "+r.substr(3,3)+"-"+r.substr(6);var u="";if(o=e.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(o[4].length,7),l=Ta(a,Math.pow(10,i)-1,!1),r=""+c,(u=Lr("n",o[1],l[1])).charAt(u.length-1)===" "&&(u=u.substr(0,u.length-1)+"0"),r+=u+o[2]+"/"+o[3],(u=Ma(l[2],i)).length<o[4].length&&(u=Un(o[4].substr(o[4].length-u.length))+u),r+=u;if(o=e.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return i=Math.min(Math.max(o[1].length,o[4].length),7),c+((l=Ta(a,Math.pow(10,i)-1,!0))[0]||(l[1]?"":"0"))+" "+(l[1]?ed(l[1],i)+o[2]+"/"+o[3]+Ma(l[2],i):Hn(" ",2*i+1+o[2].length+o[3].length));if(o=e.match(/^[#0?]+$/))return r=""+t,e.length<=r.length?r:Un(e.substr(0,e.length-r.length))+r;if(o=e.match(/^([#0]+)\.([#0]+)$/)){r=""+t.toFixed(Math.min(o[2].length,10)).replace(/([^0])0+$/,"$1"),i=r.indexOf(".");var d=e.indexOf(".")-i,h=e.length-r.length-d;return Un(e.substr(0,d)+r+e.substr(e.length-h))}if(o=e.match(/^00,000\.([#0]*0)$/))return t<0?"-"+dr(s,e,-t):ro(""+t).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,function(g){return"00,"+(g.length<3?Xn(0,3-g.length):"")+g})+"."+Xn(0,o[1].length);switch(e){case"###,###":case"##,###":case"#,###":var f=ro(""+a);return f!=="0"?c+f:"";default:if(e.match(/\.[0#?]*$/))return dr(s,e.slice(0,e.lastIndexOf(".")),t)+Un(e.slice(e.lastIndexOf(".")))}throw new Error("unsupported format |"+e+"|")}function Lr(s,e,t){return(0|t)===t?dr(s,e,t):Ln(s,e,t)}function e0(s){var e=[],t=!1;const n=s.length;for(var r=0,o=0;r<n;++r)switch(s.charCodeAt(r)){case 34:t=!t;break;case 95:case 42:case 92:++r;break;case 59:e[e.length]=s.substr(o,r-o),o=r+1}if(e[e.length]=s.substr(o),t===!0)throw new Error("Format |"+s+"| unterminated string ");return e}var t0=/\[[HhMmSs\u0E0A\u0E19\u0E17]*\]/;function n0(s){for(var e=0,t="",n="",r=s.length;e<r;)switch(t=s.charAt(e)){case"G":Xl(s,e)&&(e+=6),e++;break;case'"':for(;s.charCodeAt(++e)!==34&&e<s.length;);++e;break;case"\\":case"_":e+=2;break;case"@":++e;break;case"B":case"b":if(s.charAt(e+1)==="1"||s.charAt(e+1)==="2")return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":case"上":if(s.substr(e,3).toUpperCase()==="A/P"||s.substr(e,5).toUpperCase()==="AM/PM"||s.substr(e,5).toUpperCase()==="上午/下午")return!0;++e;break;case"[":for(n=t;s.charAt(e++)!=="]"&&e<s.length;)n+=s.charAt(e);if(n.match(t0))return!0;break;case".":case"0":case"#":for(;e<s.length&&("0#?.,E+-%".indexOf(t=s.charAt(++e))>-1||t==="\\"&&s.charAt(e+1)==="-"&&"0#".indexOf(s.charAt(e+2))>-1););break;case"?":for(;s.charAt(++e)===t;);break;case"*":++e,s.charAt(e)!==" "&&s.charAt(e)!=="*"||++e;break;case"(":case")":++e;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;e<s.length&&"0123456789".indexOf(s.charAt(++e))>-1;);break;default:++e}return!1}var qh=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function Jh(s,e){if(e==null)return!1;var t=parseFloat(e[2]);switch(e[1]){case"=":if(s===t)return!0;break;case">":if(s>t)return!0;break;case"<":if(s<t)return!0;break;case"<>":if(s!==t)return!0;break;case">=":if(s>=t)return!0;break;case"<=":if(s<=t)return!0}return!1}function r0(s,e,t){t==null&&(t=V.EmptyObject);var n="";switch(typeof s){case"string":n=s==="m/d/yy"&&t.dateNF?t.dateNF:s;break;case"number":(n=s===14&&t.dateNF?t.dateNF:(t.table!=null?t.table:Ao)[s])==null&&(n=t.table&&t.table[Wh[s]]||Ao[Wh[s]]),n==null&&(n=B_[s]||"General")}if(Xl(n,0))return Dc(e,t);Gp(e)&&(e=Gd(e,t.date1904));var r=function(o,i){var l=e0(o),a=l.length,c=l[a-1].indexOf("@");if(c!==-1&&l[a-1][c-1]==="\\"&&(c=-1),a<4&&c>-1&&--a,l.length>4)throw new Error("We can't find right format for |"+l.join("|")+"|");if(typeof i!="number")return[4,l.length===4||c>-1?l[l.length-1]:"@"];switch(l.length){case 1:l=c>-1?["General","General","General",l[0]]:[l[0],l[0],l[0],"@"];break;case 2:l=c>-1?[l[0],l[0],l[0],l[1]]:[l[0],l[1],l[0],"@"];break;case 3:l=c>-1?[l[0],l[1],l[0],l[2]]:[l[0],l[1],l[2],"@"]}var u=i>0?l[0]:i<0?l[1]:l[2];if(l[0].indexOf("[")===-1&&l[1].indexOf("[")===-1)return[a,u];if(l[0].match(/\[[=<>]/)!=null||l[1].match(/\[[=<>]/)!=null){var d=l[0].match(qh),h=l[1].match(qh);return Jh(i,d)?[a,l[0]]:Jh(i,h)?[a,l[1]]:[a,l[d!=null&&h!=null?2:1]]}return[a,u]}(n,e);if(Xl(r[1]))return Dc(e,t);if(e===!0)e="TRUE";else if(e===!1)e="FALSE";else if(e===""||e==null)return"";return function(o,i,l,a){var c,u,d,h=[],f="",g=0,m="",p="t",w="H";let S=o.length;for(;g<S;)switch(m=o.charAt(g)){case"G":if(!Xl(o,g))throw new Error("unrecognized character "+m+" in "+o);h[h.length]={t:"G",v:"General"},g+=7;break;case'"':for(f="";(d=o.charCodeAt(++g))!==34&&g<o.length;)f+=String.fromCharCode(d);h[h.length]={t:"t",v:f},++g;break;case"\\":var b=o.charAt(++g),v=b==="("||b===")"?b:"t";h[h.length]={t:v,v:b},++g;break;case"@":h[h.length]={t:"T",v:i},++g;break;case"B":case"b":if(o.charAt(g+1)==="1"||o.charAt(g+1)==="2"){if(c==null&&(c=mi(i,l,o.charAt(g+1)==="2"))==null)return"";h[h.length]={t:"X",v:o.substr(g,2)},p=m,g+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":m=m.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(i<0||c==null&&(c=mi(i,l))==null)return"";for(f=m;++g<o.length&&o.charAt(g).toLowerCase()===m;)f+=m;m==="m"&&p.toLowerCase()==="h"&&(m="M"),m==="h"&&(m=w),h[h.length]={t:m,v:f},p=m;break;case"A":case"a":case"上":var y={t:m,v:m};if(c==null&&(c=mi(i,l)),o.substr(g,3).toUpperCase()==="A/P"?(c!=null&&(y.v=c.H>=12?"P":"A"),y.t="T",w="h",g+=3):o.substr(g,5).toUpperCase()==="AM/PM"?(c!=null&&(y.v=c.H>=12?"PM":"AM"),y.t="T",g+=5,w="h"):o.substr(g,5).toUpperCase()==="上午/下午"?(c!=null&&(y.v=c.H>=12?"下午":"上午"),y.t="T",g+=5,w="h"):(y.t="t",++g),c==null&&y.t==="T")return"";h[h.length]=y,p=m;break;case"[":for(f=m;o.charAt(g++)!=="]"&&g<o.length;)f+=o.charAt(g);if(f.slice(-1)!=="]")throw new Error('unterminated "[" block: |'+f+"|");if(f.match(t0)){if(c==null&&(c=mi(i,l))==null)return"";h[h.length]={t:"Z",v:f.toLowerCase()},p=f.charAt(1)}else f.indexOf("$")>-1&&(f=(f.match(/\$([^-[\]]*)/)||[])[1]||"$",n0(o)||(h[h.length]={t:"t",v:f}));break;case".":if(c!=null){for(f=m;++g<o.length&&(m=o.charAt(g))==="0";)f+=m;h[h.length]={t:"s",v:f};break}case"0":case"#":for(f=m;++g<o.length&&"0#?.,E+-%".indexOf(m=o.charAt(g))>-1;)f+=m;h[h.length]={t:"n",v:f};break;case"?":for(f=m;o.charAt(++g)===m;)f+=m;h[h.length]={t:m,v:f},p=m;break;case"*":if(++g,!(f=o.charAt(g)))throw new Error("no character specified for repeat function: "+o);h[h.length]={t:"R",v:f},++g;break;case"_":if(++g,!(f=o.charAt(g)))throw new Error("no character specified for spacing function: "+o);h[h.length]={t:"S",v:f},++g;break;case"(":case")":h[h.length]={t:a===1?"t":m,v:m},++g;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(f=m;g<o.length&&"0123456789".indexOf(o.charAt(++g))>-1;)f+=o.charAt(g);h[h.length]={t:"D",v:f};break;case" ":h[h.length]={t:m,v:m},++g;break;case"$":h[h.length]={t:"t",v:"$"},++g;break;default:if(",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(m)===-1)throw new Error("unrecognized character "+m+" in "+o);h[h.length]={t:"t",v:m},++g}var _,C=0,E=0;for(g=h.length-1,p="t";g>=0;--g)switch(h[g].t){case"h":case"H":h[g].t=w,p="h",C<1&&(C=1);break;case"s":(_=h[g].v.match(/\.0+$/))&&(E=Math.max(E,_[0].length-1)),C<3&&(C=3);case"d":case"y":case"M":case"e":p=h[g].t;break;case"m":p==="s"&&(h[g].t="M",C<2&&(C=2));break;case"X":break;case"Z":C<1&&h[g].v.match(/[Hh]/)&&(C=1),C<2&&h[g].v.match(/[Mm]/)&&(C=2),C<3&&h[g].v.match(/[Ss]/)&&(C=3)}switch(C){case 0:break;case 1:c.u>=.5&&(c.u=0,++c.S),c.S>=60&&(c.S=0,++c.M),c.M>=60&&(c.M=0,++c.H);break;case 2:c.u>=.5&&(c.u=0,++c.S),c.S>=60&&(c.S=0,++c.M)}var x,R="";for(S=h.length,g=0;g<S;++g)switch(h[g].t){case"t":case"T":case" ":case"D":break;case"X":h[g].v="",h[g].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":h[g].v=$_(h[g].t.charCodeAt(0),h[g].v,c,E),h[g].t="t";break;case"n":case"?":for(x=g+1;h[x]!=null&&((m=h[x].t)==="?"||m==="D"||(m===" "||m==="t")&&h[x+1]!=null&&(h[x+1].t==="?"||h[x+1].t==="t"&&h[x+1].v==="/")||h[g].t==="("&&(m===" "||m==="n"||m===")")||m==="t"&&(h[x].v==="/"||h[x].v===" "&&h[x+1]!=null&&h[x+1].t==="?"));)h[g].v+=h[x].v,h[x]={v:"",t:";"},++x;R+=h[g].v,g=x-1;break;case"G":h[g].t="t",h[g].v=Dc(i,l)}var I,A,M="";if(R.length>0){R.charCodeAt(0)===40?(I=i<0&&R.charCodeAt(0)===45?-i:i,A=Lr("n",R,I)):(A=Lr("n",R,I=i<0&&a>1?-i:i),I<0&&h[0]&&h[0].t==="t"&&(A=A.substr(1),h[0].v="-"+h[0].v)),x=A.length-1;var k=h.length;for(S=h.length,g=0;g<S;++g)if(h[g]!=null&&h[g].t!=="t"&&h[g].v.indexOf(".")>-1){k=g;break}var F=S;if(k===S&&A.indexOf("E")===-1){for(g=h.length-1;g>=0;--g)h[g]!=null&&"n?".indexOf(h[g].t)!==-1&&(x>=h[g].v.length-1?(x-=h[g].v.length,h[g].v=A.substr(x+1,h[g].v.length)):x<0?h[g].v="":(h[g].v=A.substr(0,x+1),x=-1),h[g].t=h[g].v.indexOf("?")>=0?"N":"t",F=g);x>=0&&F<h.length&&(h[F].v=A.substr(0,x+1)+h[F].v)}else if(k!==h.length&&A.indexOf("E")===-1){for(x=A.indexOf(".")-1,g=k;g>=0;--g)if(h[g]!=null&&"n?".indexOf(h[g].t)!==-1){for(u=h[g].v.indexOf(".")>-1&&g===k?h[g].v.indexOf(".")-1:h[g].v.length-1,M=h[g].v.substr(u+1);u>=0;--u)x>=0&&(h[g].v.charAt(u)==="0"||h[g].v.charAt(u)==="#"||h[g].v.charAt(u)==="?")&&(M=A.charAt(x--)+M);h[g].v=M,h[g].t=M.indexOf("?")>=0?"N":"t",F=g}for(x>=0&&F<h.length&&(h[F].v=A.substr(0,x+1)+h[F].v),x=A.indexOf(".")+1,g=k;g<h.length;++g)if(h[g]!=null&&("n?(".indexOf(h[g].t)!==-1||g===k)){for(u=h[g].v.indexOf(".")>-1&&g===k?h[g].v.indexOf(".")+1:0,M=h[g].v.substr(0,u);u<h[g].v.length;++u)x<A.length&&(M+=A.charAt(x++));h[g].v=M,h[g].t=M.indexOf("?")>=0?"N":"t",F=g}}}for(g=0;g<S;++g)h[g]!=null&&"n?".indexOf(h[g].t)>-1&&(I=a>1&&i<0&&g>0&&h[g-1].v==="-"?-i:i,h[g].v=Lr(h[g].t,h[g].v,I),h[g].t=h[g].v.indexOf("?")>=0?"N":"t");var L="";for(S=h.length,g=0;g<S;g++)if(h[g].t==="R")l?.onRepeatChar?.(L.length,h[g].v);else if(h[g].t==="S")l?.onSpacingChar?.(L.length,h[g].v),L+=l?.spacingCharacter??" ";else if(h[g].t==="N"){M=h[g].v;for(var N=0;N<M.length;N++)(m=M[N])==="?"&&(l?.onDigitChar?.(L.length,m),m=l?.digitCharacter??" "),L+=m}else h[g]!=null&&(L+=h[g].v);return L}(r[1],e,t,r[0])}function Kh(s,e){if(typeof e!="number"){e=+e||-1;for(var t=0;t<392;++t)if(Ao[t]!==void 0){if(Ao[t]===s){e=t;break}}else e<0&&(e=t);e<0&&(e=391)}return Ao[e]=s,e}const qt={format:r0,dateNumLocal:Gd,load:Kh,split_fmt:e0,_table:Ao,load_table:function(s){for(var e=0;e!==392;++e)s[e]!==void 0&&Kh(s[e],e)},parse_date_code:mi,is_date:n0,get_table:function(){return qt._table=Ao}},Kt="\\s*([-]?[0-9e]*[.]?[0-9]+)",V_=new RegExp(`^rgb\\(${Kt},${Kt},${Kt}\\)$`),W_=new RegExp(`^rgba\\(${Kt},${Kt},${Kt},${Kt}\\)$`),j_=new RegExp(`^lrgb\\(${Kt},${Kt},${Kt}\\)$`),G_=new RegExp(`^lrgba\\(${Kt},${Kt},${Kt},${Kt}\\)$`),U_=new RegExp(`^hsl\\(${Kt},${Kt},${Kt}\\)$`),q_=new RegExp(`^hsla\\(${Kt},${Kt},${Kt},${Kt}\\)$`),J_=new RegExp(/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/),K_=new RegExp(/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/),X_=new RegExp("^index(\\d+)$","i"),Lc=(s,e,t)=>[parseFloat(s),parseFloat(e),parseFloat(t)],Bc=(s,e=255)=>{const t=[...s];for(var n=0;n<s.length;n++)t[n]=s[n]/e;return t},Xh=(s,e=0)=>{const t=[...s];for(var n=0;n<s.length;n++)V.roundAccurately(s[n],e+8)%1==.5?t[n]=Math.floor(s[n]):t[n]=V.roundAccurately(s[n],e);return t},mn=(s,e=!0)=>{const t=[...s],n=e?1:255;for(var r=0;r<s.length;r++)t[r]=Math.max(0,Math.min(n,s[r]));return t},us=s=>Math.max(0,Math.min(1,s)),o0=s=>((s%=360)<0&&(s-=360),s),Mo=s=>{const e=[...s];for(var t=0;t<s.length;t++)e[t]=Zl(s[t]);return e},Oo=s=>{const e=[...s];for(var t=0;t<s.length;t++)e[t]=Yl(s[t]);return e},Zl=s=>s<.04045?s/12.92:Math.pow((s+.055)/1.055,2.4),Yl=s=>s<.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055,Do=s=>{let e=s[0],t=s[1],n=s[2];e%=360,e/=360,t/=100,n/=100;let r=n<.5?n*(1+t):n+t-t*n,o=2*n-r;return[Math.max(0,zc(o,r,e+1/3)),Math.max(0,zc(o,r,e)),Math.max(0,zc(o,r,e-1/3))]},zc=(s,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),6*t<1?s+6*(e-s)*t:2*t<1?e:3*t<2?s+6*(e-s)*(2/3-t):s),io=s=>{let e=s[0],t=s[1],n=s[2],r=Math.min(e,Math.min(t,n)),o=Math.max(e,Math.max(t,n)),i=0;o===r?i=0:o===e?i=(60*(t-n)/(o-r)+360)%360:o===t?i=60*(n-e)/(o-r)+120:o===n&&(i=60*(e-t)/(o-r)+240);const l=(o+r)/2;let a=0;return a=o===r?0:l<=.5?(o-r)/(o+r):(o-r)/(2-o-r),[i,100*a,100*l]},fn=0,Pc=1,Us=2,Ql=0,ea=1,ta=2,na=0,ra=1,oa=2,Z_=(s,e)=>{let t=e/100;return((n,r)=>{let o=Mo(n);o[0]=r(o[0],o),o[1]=r(o[1],o),o[2]=r(o[2],o);let i=Oo(o);return i=mn(i),i})(s,(n,r)=>n*t)},fl=2.55,Y_=(s,e)=>{const t=io(s),n=t[2],r=V.roundAccurately((o=n,(i=e)>0?(o*fl*(1-i)+(255-255*(1-i)))/fl:i<0?o*fl*(1+i)/fl:o),3);var o,i;t[2]=r;let l=Do(t);return l=mn(l),l},Q_=(s,e)=>{let t=Mo(s),n=e/100;for(var r=0;r<3;r++)t[r]=t[r]*n+(1-n);let o=Oo(t);return o=mn(o),o},Hc=(s,e,t)=>{let n=io(e),r=t/1;s===fn&&(r=o0(t)),n[s]=r;let o=Do(n);return o=mn(o),o},$c=(s,e,t)=>{let n=io(e);if(s===fn){let o=t/360;n[fn]=360*(n[fn]/360+o),n[fn]%=360,n[fn]<0&&(n[fn]-=360)}else{let o=t/.1;n[s]=.1*(n[s]/.1+o)}let r=Do(n);return r=mn(r),r},Vc=(s,e,t)=>{let n=io(e),r=t/100;n[s]=n[s]*r,s===fn&&(n[fn]=o0(n[fn]));let o=Do(n);return o=mn(o),o},vr=(s,e,t,n)=>{let r=Mo(e),o=t/100;n===na?r[s]=o:n===ra?r[s]+=o:n===oa&&(r[s]*=o);let i=Oo(r);return i=mn(i),i},ey=s=>{let e=Mo(s),t=.213*e[Ql]+.715*e[ea]+.072*e[ta];e[0]=t,e[1]=t,e[2]=t;let n=Oo(e);return n=mn(n),n},ty=s=>{let e=io(s);e[fn]+=180,e[fn]%=360,e[fn]<0&&(e[fn]-=360);let t=Do(e);return t=mn(t),t},Zh=(s,e=!0)=>{let t=e?Mo(s):[...s];const n=e?1:255;return t[0]=n-t[0],t[1]=n-t[1],t[2]=n-t[2],e&&(t=Oo(t)),t=mn(t,e),t},ny=s=>{const e=[0,0,0];return e[0]=Yl(s[0]),e[1]=Yl(s[1]),e[2]=Yl(s[2]),mn(e)},ry=s=>{const e=[0,0,0];return e[0]=Zl(s[0]),e[1]=Zl(s[1]),e[2]=Zl(s[2]),mn(e)},Yh=(s,e,t,n=null)=>{const r=o=>{let i=o.toString(16);return i.length===1?"0"+i:i};return(n===null?"":r(Math.round(255*n)))+r(Number(s)).toUpperCase()+r(Number(e)).toUpperCase()+r(Number(t)).toUpperCase()},Jo=.2126,Gr=.7152,Ko=.0722;var Tr;(s=>{s.RGBA=class{constructor(t,n,r,o=1){this._private={red:t,green:n,blue:r,alpha:o}}get red(){return this._private.red}get green(){return this._private.green}get blue(){return this._private.blue}get alpha(){return this._private.alpha??1}toString(t=!0){return t&&this._private.alpha!==null?`rgba(${this.red},${this.green},${this.blue},${this.alpha})`:`rgb(${this.red},${this.green},${this.blue})`}isEqual(t){return!!t&&t.red===this.red&&t.green===this.green&&t.blue===this.blue&&t.alpha===this.alpha}isAlmostEqual(t){if(!t)return!1;const n=1.5;return!(Math.abs(t.red-this.red)>n)&&!(Math.abs(t.green-this.green)>n)&&!(Math.abs(t.blue-this.blue)>n)&&!(Math.abs(t.alpha-this.alpha)>n)}},s.HSLA=class{constructor(t,n,r,o){this._private={hue:t,sat:n,lum:r,alpha:o}}get hue(){return this._private.hue}get sat(){return this._private.sat}get lum(){return this._private.lum}get alpha(){return this._private.alpha??1}toString(t=!0){return t&&this._private.alpha!==null?`hsla(${this.hue},${this.sat},${this.lum},${this.alpha})`:`hsl(${this.hue},${this.sat},${this.lum})`}isEqual(t){return!!t&&t.hue===this.hue&&t.sat===this.sat&&t.lum===this.lum&&t.alpha===this.alpha}isAlmostEqual(t){if(!t)return!1;const n=1.5;return!(Math.abs(t.hue-this.hue)>n)&&!(Math.abs(t.sat-this.sat)>n)&&!(Math.abs(t.lum-this.lum)>n)&&!(Math.abs(t.alpha-this.alpha)>n)}};class e extends s.RGBA{toString(n=!0){return n&&this._private.alpha!==null?"#"+Yh(this.red,this.green,this.blue,this.alpha??1).toUpperCase():"#"+Yh(this.red,this.green,this.blue).toUpperCase()}}s.HEX=e})(Tr||(Tr={}));const oy=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,sy=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,sa=function(s){if(!s)return null;s=s.replace(oy,function(t,n,r,o){return n+n+r+r+o+o});let e=sy.exec(s);return e?new Tr.RGBA(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)):null},Qh=["000000","FFFFFF","FF0000","00FF00","0000FF","FFFF00","FF00FF","00FFFF","000000","FFFFFF","FF0000","00FF00","0000FF","FFFF00","FF00FF","00FFFF","800000","008000","000080","808000","800080","008080","C0C0C0","808080","9999FF","993366","FFFFCC","CCFFFF","660066","FF8080","0066CC","CCCCFF","000080","FF00FF","FFFF00","00FFFF","800080","800000","008080","0000FF","00CCFF","CCFFFF","CCFFCC","FFFF99","99CCFF","FF99CC","CC99FF","FFCC99","3366FF","33CCCC","99CC00","FFCC00","FF9900","FF6600","666699","969696","003366","339966","003300","333300","993300","993366","333399","333333"],Co=new Map;for(let s=0;s<Qh.length;s++)Co.set(s,sa(Qh[s]));Co.set(-4105,null),Co.set(-4142,null),Co.set(64,sa("000000")),Co.set(65,sa("FFFFFF")),Co.set(81,sa("FFFFFF"));const ka=s=>Co.get(s),st={General:"General",Number:"Number",Currency:"Currency",Accounting:"Accounting",ShortDate:"Short Date",LongDate:"Long Date",MediumDate:"Medium Date",ShortTime:"Short Time",MediumTime:"Medium Time",LongTime:"Long Time",Comma:"Comma",Percentage:"Percentage",Fraction:"Fraction",Scientific:"Scientific",Text:"Text",Special:"Special",Custom:"Custom"};let Wc=null;const s0=()=>Wc||(Wc=Intl.DateTimeFormat().resolvedOptions().locale??"en-US",Wc),iy=/^\[\$-(.*?)\]/i,ly=/^[0-9a-fA-F]+$/,ay=qt.split_fmt,Ud=(s,e,t)=>{const n=iy.exec(s);let r=s0();if(n&&n[1]){let o=n[1];ly.test(o)||o.includes("-")}if(eg[s]&&(s=eg[s]),typeof e=="number"){const o=pi(s,e,{locale:r,...t});if(o!==null)return o.fmt}return qt.format(s,e,t)},pi=(s,e,t)=>{if(typeof e!="number")return null;const n=Ts(e,t?.date1904??!1),r=t?.locale??s0();let o=!1,i=s,l=-1;if((l=i.indexOf("Short Date"))!==-1){const a=new Intl.DateTimeFormat(r).format(n);i=i.substring(0,l)+a+i.substring(l+10),o=!0}if((l=i.indexOf("Medium Date"))!==-1){const a=qt.format(qt.get_table()[15],e,t);i=i.substring(0,l)+a+i.substring(l+11),o=!0}if((l=i.indexOf("Long Date"))!==-1){const a=new Intl.DateTimeFormat(r,{dateStyle:"full"}).format(n);i=i.substring(0,l)+a+i.substring(l+9),o=!0}if((l=i.indexOf("Short Time"))!==-1){const a=qt.format(qt.get_table()[20],e,t);i=i.substring(0,l)+a+i.substring(l+10),o=!0}if((l=i.indexOf("Medium Time"))!==-1){const a=qt.format(qt.get_table()[18],e,t);i=i.substring(0,l)+a+i.substring(l+11),o=!0}if((l=i.indexOf("Long Time"))!==-1){const a=new Intl.DateTimeFormat(r,{timeStyle:"medium"}).format(n);i=i.substring(0,l)+a+i.substring(l+9),o=!0}return o?{fmt:i,date:n}:null},eg=Object.freeze({"General Number":"General","General Date":"m/d/yyyy h:mm","Medium Date":qt.get_table()[15],"Medium Time":qt.get_table()[18],"Short Time":qt.get_table()[20],Currency:'"$"#,##0.00_);[Red]\\("$"#,##0.00\\)',Fixed:qt.get_table()[2],Standard:qt.get_table()[4],Percent:qt.get_table()[10],Scientific:qt.get_table()[11],"Yes/No":'"Yes";"Yes";"No";@',"True/False":'"True";"True";"False";@',"On/Off":'"Yes";"Yes";"No";@'}),cy=Object.freeze({black:0,white:1,red:2,green:3,blue:4,yellow:5,magenta:6,cyan:7}),uy=s=>{let e=null;if((s=s.toLowerCase()).startsWith("color")){const t=parseInt(s.substring(5));t>=0&&t<=56&&(e=`Index${t+7}`)}if(!e){const t=cy[s];t!==void 0&&(e=ka(t).toString())}return e},i0="=",dy="<>",l0=">",td="<",a0=">=",hy="<=",So=new Map;So.set(i0,(s,e)=>s===e),So.set(dy,(s,e)=>s!==e),So.set(l0,(s,e)=>s>e),So.set(td,(s,e)=>s<e),So.set(a0,(s,e)=>s>=e),So.set(hy,(s,e)=>s<=e);const gy=/(Black|Blue|Cyan|Green|Magenta|Red|White|Yellow|Color[0-9]+)/i,fy=/(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)/i,my=/\[(.*?)\]/g,py=(s,e)=>{const t={color:null,condition:null};let n=null,r=new RegExp(my);for(;(n=r.exec(s))!==null;){let o=!1,i=gy.exec(n[1]);if(i){if(o=!0,t.color)throw new Error(`format error, two colors specified: '${s}' and '${t.color}'.`);t.color=uy(i[1]),t.color||console.warn("Unable to parse LegacyColor",i[1])}let l=fy.exec(n[1]);if(l){if(o=!0,t.condition)throw new Error(`Format error, two conditions specified: ' ${s}'`);t.condition={op:l[1],comp:parseFloat(l[2])}}if(!o)return t}return t.condition||(t.condition=e),t},wy=(s,e)=>{let t=(r=>{const o=[];if(!r)return o;const i=r.split(";");for(let l=0;l<i.length;l++){let a=null;i.length===2?l===0?a={op:a0,comp:0}:l===1&&(a={op:td,comp:0}):i.length!==3&&i.length!==4||(a=l===0?{op:l0,comp:0}:l===1?{op:td,comp:0}:l===2?{op:i0,comp:0}:null);const c=i[l],u=py(c,a);o.push({format:c,colorAndCondition:u})}return o})(s),n=t[0].colorAndCondition;if(t.length===1&&n&&!n.condition&&n.color)return n.color;for(let r=0;r<t.length;r++){n=t[r].colorAndCondition;let o=n?.condition??void 0;if(r===3)return typeof e=="string"&&n?.color?n.color:null;if(o&&typeof e=="number"&&So.get(o.op)(e,o.comp))return n?.color??null}},tg=s=>{if(s===st.MediumDate||s===st.LongDate||s===st.ShortDate||s===st.MediumTime||s===st.LongTime||s===st.ShortTime)return!0},Sy=(s,e)=>s===e?0:tg(s)?1:tg(e)?-1:s===st.Percentage?1:e===st.Percentage?-1:s===st.Currency||s===st.Accounting?1:e===st.Currency||e===st.Accounting?-1:0,Ms=s=>(s instanceof Date||Object.prototype.toString.call(s)==="[object Date]")&&!isNaN(s.getTime()),_y=(s,e,t)=>{return t==="month"||t==="months"||t==="m"?(n=s,12*((r=e).getUTCFullYear()-n.getUTCFullYear())+(r.getUTCMonth()-n.getUTCMonth())+(r.getUTCDate()-n.getUTCDate()<0?-1:0)):t==="year"||t==="years"||t==="y"?((o,i)=>Math.abs(i.getFullYear()-o.getFullYear()))(s,e):t==="day"||t==="days"||t==="d"?((o,i)=>Math.floor((Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())-Date.UTC(o.getFullYear(),o.getMonth(),o.getDate()))/864e5))(s,e):void console.warn("invalid unit"+t);var n,r},ml="d",ng="m",rg="y",og=(s,e,t)=>{if(t==="month"||t==="months"||t==="m"){const n=new Date(s.getTime());return new Date(n.setMonth(n.getMonth()+e))}if(t==="year"||t==="years"||t==="y"){const n=new Date(s.getTime());return n.setFullYear(n.getFullYear()+e),n}if(t==="day"||t==="days"||t==="d"){const n=new Date(s.getTime());return n.setDate(n.getDate()+e),n}if(t==="hour"||t==="hours"||t==="h"){const n=new Date(s.getTime());return n.setHours(n.getHours()+e),n}return console.warn("invalid unit"+t),null},Ts=(s,e=!1)=>{let t=qt.parse_date_code(s,{date1904:e});return t?new Date(t.y,t.m-1,t.d,t.H,t.M,t.S,Math.round(1e3*t.u)):null},Ki=(s,e=!1)=>isNaN(s)?null:qt.dateNumLocal(s,e),yy=new class extends jp{parse(s,e,t){const n=r=>r-1;switch(e){case"M":return Dr(no(Wp,s),n);case"MM":return Dr(Ai(2,s),n);case"Mo":return Dr(t.ordinalNumber(s,{unit:"month"}),n);case"MMM":return t.month(s,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(s,{width:"narrow",context:"formatting"});default:return t.month(s,{width:"wide",context:"formatting"})}}},Cr=(s=>{let e=s,t=[];for(let n=0;n<e.length;n++){let r=e[n][0].indexOf("yyy")>-1,o=e[n][0].indexOf(".")>-1,i=e[n][0].indexOf("-")>-1;t.push({parseFormat:e[n][0],numberFormat:e[n][1],todaysYear:!r,windowYear:!0,containsDot:o,containsDash:i}),r&&t.push({parseFormat:e[n][0].replace(/yyy/g,"yyyy"),numberFormat:e[n][1],todaysYear:!1,windowYear:!1,containsDot:o,containsDash:i})}return t})([["MM-d","d-mmm"],["MM-yyy","mmm-yy"],["M-yyy","mmm-yy"],["M-d-yyy","m/d/yyyy"],["yyy-M-d","m/d/yyyy"],["yyy-d-M","m/d/yyyy"],["d.MMM","d-mmm"],["d.MMMM","d-mmm"],["d.MMM.yyy","d-mmm-yy"],["d.MMMM.yyy","d-mmm-yy"],["MMM.d","d-mmm"],["MMMM.d","d-mmm"],["MMM.yyy","mmm-yy"],["MMMM.yyy","mmm-yy"],["MMM dd, yyy","d-mmm-yy"],["MMMM dd, yyy","d-mmm-yy"],["EEE, MMMM dd, yyy","[$-x-sysdate]ddd, mmmm dd, yyyy"],["EEEE, MMMM dd, yyy","[$-x-sysdate]dddd, mmmm dd, yyyy"]]),by={year:0,month:1,day:0,hour:0,minute:0,second:0,millis:0},vy=(s,e=!1)=>{const t={...by,...s};return t.year=e?1904:1900,t.dow=-1,t.oaDateTime=((n,r=!1)=>{if(!n)return null;let o=n.day,i=n.hour;i>24&&(o+=Math.floor(i/24),i%=24),o>60&&--o;const l=new Date(n.year,n.month-1,o,i,n.minute,n.second,n.millis);return Ki(l,r)})(t,e),t},Cy=new RegExp("([0-9]{1,2})\\s*(P[M]?|A[M]?)\\s*$","i"),xy=new RegExp("([0-9]+)\\s*\\:$","i"),jc=new RegExp("(\\s*[0-9]{1,2})\\s+(P[M]?|A[M]?)\\s*$","i"),sg=new RegExp("(\\s*[0-9]{1,4})\\s*([\\.]{1}\\s*[0-9]+)?\\s*\\:","i"),Ey=new RegExp("(\\s*[0-9]{1,4})\\s*([\\.]{1}\\s*[0-9]*)?\\s*$","i"),c0=(s,e=!1,t=!1)=>{if(!s||s.trim().length<2||s.indexOf(":")===-1&&s.match(jc)===null)return null;let n=null,r=null,o=null,i=!1,l=!1,a="h:mm AM/PM",c=[],u=s,d=null;do{let p=u.indexOf(":");p===-1?(c.push(u),u=null):(c.push(u.substring(0,p+1)),u=u.substring(p+1,u.length))}while(c.length<3&&u&&u.length>0);if(u?.length>0)return null;const h=(p,w,S)=>{let b=p.match(w);if(!b)return null;d===null&&(d=p.substring(0,b.index));let v=parseInt(b[1]);if(b[2]&&o===null){if(S){let _=parseFloat(b[2].substring(1,b[2].length));isNaN(_)||(r=_)}let y=parseFloat(b[2]);isNaN(y)||(n=y),o=S}return v},f=(p,w)=>{let S=p.match(w);if(!S||S.length!==3)return null;d===null&&(d=p.substring(0,S.index)),i=!0;let b=parseInt(S[1]);return l=S[2].charAt(0)==="p"||S[2].charAt(0)==="P",b};c[c.length-1].trim().length===0&&c.pop();const g=[];if(c.length>0){let p=h(c[0],xy,!1);if(p===null&&(p=f(c[0],Cy)),p===null)return null;g.push(p)}if(c.length>2){let p=h(c[1],sg,!0);if(p===null&&(p=f(c[0],jc)),p===null)return null;g.push(p)}if(c.length>1){const p=c[c.length-1];let w=h(p,sg,!1);if(w===null&&(w=h(p,Ey,!1)),w===null&&(w=f(p,jc)),w===null)return null;g.push(w)}if(d!==null&&d.length>0&&!t)return null;if(o===!0&&(g.length===2&&g.splice(1,0,0),g[2]=r||0),i){if(g[0]>12||g[1]>=60||g[2]>=60)return null;g[0]===12?g[0]=l?12:0:l&&(g[0]+=12)}else a=c.length>2?"h:mm:ss":"h:mm",g[0]>23&&(a="[h]:mm:ss"),n!==null&&(a="mm:ss.0"),g[1]>=60&&(a="General"),g[2]>=60&&(a="General");a!=="General"&&(g.length===1&&g.push(0),g.length===2&&(n===null?g.push(0):g.unshift(0)));let m={hour:g[0]??0,minute:g[1]??0,second:g[2]??0,millis:1e3*(n??0)};return{numberFormat:a,parsed:vy(m,e),leadingText:d}},Ry={},qd=(s,e=!1,t=null)=>{const n=t??Date.now(),r=new Date(n).getFullYear();let o=s.trim().replaceAll(/\s+/g," ");o=o.replaceAll(/\s*([-/])\s*/g,"$1");let i=o.replaceAll(/[-/ ]/g,"."),l=o.replaceAll(/[/]/g,"-");const a=fi.M;fi.M=yy;for(let c=0;c<Cr.length;c++){let u=o;Cr[c].containsDot?u=i:Cr[c].containsDash&&(u=l);let d=D_(u,Cr[c].parseFormat,n,Ry),h=qt.dateNumLocal(d,e);if(Ms(d)&&(Cr[c].windowYear||h>0)){if(Cr[c].windowYear){let g=d.getFullYear()<=29?2e3+d.getFullYear():1900+d.getFullYear();d.setFullYear(g)}if(Cr[c].todaysYear&&d.setFullYear(r),h=qt.dateNumLocal(d,e),Cr[c].parseFormat.indexOf("EEE")>-1){const g=Ud("ddd",h,{date1904:e});if(!u.toLowerCase().includes(g.toLowerCase()))return null}let f=Cr[c].numberFormat;return fi.M=a,{asOADate:h,asJSDate:d,numberFormat:f}}}return fi.M=a,null};function Xi(s){if(!s)return!1;let e=s.replaceAll(/\[([^)]+)\]/g,"").toLowerCase();return e=e.replaceAll(/".*"/g,""),e=e.replaceAll(/\\./g,""),e=e.replace(/[_*]./g,""),!e.includes("time")&&!!(e.includes("d")||e.includes("m")&&!e.includes("h")&&!e.includes("s")||e.includes("y")||e==="short date"||e==="medium date"||e==="long date")}function tc(s){if(!s)return!1;let e=s.replaceAll(/\[([^)]+)\]/g,"").toLowerCase();return e=e.replaceAll(/".*"/g,""),e=e.replaceAll(/\\./g,""),e=e.replace(/[_*]./g,""),!e.includes("date")&&!(!e.includes("h")&&!e.includes("s")&&e!=="short time"&&e!=="medium time"&&e!=="long time")}var Na,ig,oe,xr;(ig=Na||(Na={})).SmallCaps={None:"none",Small:"small",All:"all"},ig.StrikeStyle={None:"none",Single:"single",Double:"double"},(xr=oe||(oe={})).TabStop=class{},xr.HorizontalAlignment={General:"general",Left:"left",Center:"center",Right:"right",Justify:"justify",Distributed:"distributed",CenterContinuous:"centerContinuous",Fill:"fill"},xr.VerticalAlignment={Top:"top",Center:"center",Bottom:"bottom",Justify:"justify",Distributed:"distributed"},xr.Orientation={Horizontal:"horizontal",Vertical:"90",Vertical270:"270",Stacked:"stacked"},xr.ReadingDirection={Auto:"auto",LeftToRight:"ltr",RightToLeft:"rtl"},xr.Overflow={Visible:"visible",Wrap:"wrap",Clip:"clip",Shrink:"shrink",Ellipsis:"ellipsis"},xr.Autofit={None:"none",Normal:"normal",Shape:"shape"},xr.TabStopAlignment={Default:"default",Left:"left",Right:"right",Center:"center"},xr.toCSSHorizontalTextAlign=s=>s?s.toLowerCase():null;const u0=(s,e,t=1e3)=>{if(!s)throw new Error("A template string must be specified.");if(e(s))return s;let n=new RegExp(/\d+/,"g").exec(s),r=null,o=0;n!==null?(r=s,o=parseFloat(n[0]),isNaN(o)&&(o=0)):(o=1,r=`${s}_${o}`);let i=isNaN(o)?0:o;for(;o<i+t;)try{const l=r.replace(/\d+/g,()=>""+o++);if(e(l))return l}catch{}throw new Error(`Unable to find valid name for '${s}'.`)},Cs=(s,e=!1)=>{if(!s||s.length===0)return s;const t=s.charAt(0);if(t>="a"&&t<="z"){const n=String.fromCharCode(t.charCodeAt(0)-32);return e?n+s.slice(1).toLowerCase():n+s.slice(1)}return s},lg=s=>{if(!s||typeof s!="string")return"";const e=s.split(/[\\/]/).pop()||"",t=e.lastIndexOf(".");return e===""||t<1?"":e.slice(t+1)},d0=s=>s.toLowerCase().replace(/([-_][a-z])/g,e=>e.toUpperCase().replace("-","").replace("_","")),h0=(s,e=36)=>s.substring(0,36)+(s.length>e?"…":""),ia=s=>{if(s===void 0)return 0;let e=s.toString().split(".");return e.length<=1?0:e[1].length||0},g0=new RegExp(/^["|'|`](.*)["|'|`]$/),Iy=new RegExp("^([a-zA-Z]+:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i"),f0=(s=",",e="'")=>new RegExp(`\\s*${s}\\s*(?=(?:[^${e}]*${e}[^${e}]*${e})*[^${e}]*$)`,"g"),m0=f0(),Jd=s=>s.replace(g0,"$1"),p0=(s,e="'")=>`${e}${s}${e}`,w0=(s,e=void 0,t=void 0)=>{let n=m0;return e===void 0&&t===void 0||(n=f0(e,t)),s.split(n)},S0=s=>{let e;try{e=new URL(s)}catch{return!1}return(e.protocol==="http:"||e.protocol==="https:")&&Iy.test(s)},Ay=new RegExp(/^[^\s@]+@[^\s@]+\.[^\s@]+$/i),_0=s=>!!s.toLowerCase().startsWith("mailto:")||Ay.test(s),y0=s=>((s>=26?y0((s/26|0)-1):"")+"abcdefghijklmnopqrstuvwxyz"[s%26|0]).toUpperCase(),Kd=Object.freeze(Object.defineProperty({__proto__:null,DefaultUnQuoteRegEx:m0,camelToSnake:s=>s&&s.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`),capitalize:Cs,clampString:h0,countDecimals:ia,findValidTextValue:u0,getBaseName:(s,e=!1)=>{if(!s||typeof s!="string")return"";const t=s.split(/[\\/]/).pop()||"";if(t==="")return"";const n=lg(t),r=n.length===0?t:t.slice(0,t.length-n.length-1);return e?Cs(r,!0):r},getFileNameExtension:lg,isQuoted:s=>s&&s.length>1&&g0.test(s)&&s[0]===s[s.length-1],isValidEmail:_0,isValidHttpUrl:S0,numberToAlphabet:y0,quote:p0,snakeToCamel:d0,splitUnquoted:w0,unquote:Jd},Symbol.toStringTag,{value:"Module"})),My=(s,e,t,n=null)=>{const r=(e||11*ke.getDeviceScale())/ke.getDeviceScale(),o=n?.letterSpacing||0,i=s.length,l=i*(.55*r)-(s.match(/[il.,;!|]/g)||[]).length*r*.15+(s.match(/[mwMW]/g)||[]).length*r*.1+(i>0?(i-1)*o:0),a=Math.ceil(1.2*r),c=Math.ceil(.8*r),u=Math.ceil(.2*r),d=Math.ceil(.45*r),h=Math.ceil(1.1*r),f=Math.max(1,Math.ceil(.08*r));return{width:l,lineHeight:a,baseline:c,lineGap:u,strikePosition:d,underlinePosition:h,strikeThickness:f,underlineThickness:f,actualBoundingBoxLeft:0,actualBoundingBoxRight:l,actualBoundingBoxAscent:c,actualBoundingBoxDescent:a-c,fontBoundingBoxAscent:c,fontBoundingBoxDescent:a-c,emHeightAscent:c,emHeightDescent:a-c,hangingBaseline:.8*c,alphabeticBaseline:c,ideographicBaseline:a}},hn={},ag=(s,e)=>{let t="normal";return s&&e?t="bold italic":s?t="bold":e&&(t="italic"),t},cg=s=>s.split(",").map(e=>{const t=(e=e.trim()).indexOf(" ")>=0,n=e.indexOf('"')>=0||e.indexOf("'")>=0;return t&&!n&&(e=`"${e}"`),e}).join(", "),ug=new Map,Gc=new Map;let Er=null;const Ty=(s,e,t,n=null)=>{const r=n?.letterSpacing||0;typeof window>"u"||hn.contextMeasure||(hn.canvasMeasure=document?document.createElement("canvas"):null,hn.contextMeasure=hn.canvasMeasure.getContext("2d"),hn.contextMeasure.letterSpacing=`${r}px`,hn.contextMeasure.textRendering="geometricPrecision",hn.contextMeasure.textBaseline="alphabetic",hn.contextMeasure.textAlign="left");const o=t||"calibri",i=e||11*ke.getDeviceScale(),l=n?.isBold||!1,a=n?.isItalic||!1;let c=null;if(s==="#"||s==="0"||s==="M"||s===""||s==="_"||s==="-"){c=((m,p,w,S,b,v)=>m+Math.round(100*p)/100+w+S+b+v)(s,i,o,l,a,r);const g=ug.get(c);if(g)return g}if(Er&&Er.text===s&&Er.size===e&&Er.family===t&&Er.options?.isBold===n?.isBold&&Er.options?.isItalic===n?.isItalic&&Er.options?.letterSpacing===n?.letterSpacing)return Er.metrics;let u={};const d=ag(l,a)+" "+V.roundAccurately(i,2)+"px "+cg(o);hn.contextMeasure?(hn.contextMeasure.font=d,hn.contextMeasure.letterSpacing=`${n?.letterSpacing??0}px`,u=hn.contextMeasure.measureText(s)):u.width=s.length*V.roundAccurately(i/ke.getDeviceScale()*.6,2);let h=Gc.get(d);if(!h&&typeof window<"u"){const g=document.createElement("div");g.style.visibility="hidden",g.style.position="absolute";const m=document.createElement("span");m.textContent="Mj",m.style.fontSize="100px",m.style.fontWeight=n?.isBold?"bold":"normal",m.style.fontStyle=n?.isItalic?"italic":"normal",m.style.fontFamily=`'${o}'`,m.style.lineHeight="1.2",g.appendChild(m),document.body.appendChild(g);const p=g.getBoundingClientRect(),w=m.getBoundingClientRect();document.body.removeChild(g),hn.contextMeasure.font=ag(l,a)+" "+V.roundAccurately(100,2)+"px "+cg(o);const S=hn.contextMeasure.measureText("M"),b=p.bottom-p.top,v=b-(S.fontBoundingBoxAscent+S.fontBoundingBoxDescent),y=S.fontBoundingBoxAscent+w.top,_=hn.contextMeasure.measureText("_"),C=y-_.actualBoundingBoxAscent,E=Math.max(1,Math.abs(_.actualBoundingBoxAscent+_.actualBoundingBoxDescent)),x=hn.contextMeasure.measureText("-"),R=V.roundAccurately(y-x.actualBoundingBoxAscent+Math.max(1,.05*b,0)),I=E,A=i/100;h={lineHeight:Math.ceil(b*A),baseline:Math.ceil(y*A),lineGap:Math.ceil(v*A),strikePosition:Math.ceil(R*A),underlinePosition:Math.ceil(C*A),strikeThickness:Math.ceil(I*A),underlineThickness:Math.ceil(E*A)},hn.contextMeasure.font=d,Gc.set(d,h)}h||(h={lineHeight:Math.ceil(1.2*i),baseline:Math.ceil(i)+Math.floor(.1*i),lineGap:Math.ceil(.1*i),strikePosition:Math.ceil(.55*i)+Math.floor(.1*i),strikeThickness:1,underlinePosition:Math.ceil(1.1*i),underlineThickness:1},Gc.set(d,h));const f={...u,width:u.width,...h};return c!==null&&ug.set(c,f),Er={text:s,size:e,family:t,options:n,metrics:f},f};let Xo=null;const ky=()=>{if(Xo)return Xo;try{const s=document.createElement("canvas"),e=s.getContext&&s.getContext("2d");e&&typeof e.fillText=="function"&&(Xo=Ty)}catch{}return Xo||(console.warn("⚠️ CanvasFontMeasurer not available, falling back to SimpleFontMeasurer"),Xo=My),Xo};let pl=null;var ke,Rr;(Rr=ke||(ke={})).Style={Normal:"normal",Italic:"italic"},Rr.Scheme={Major:"major",Minor:"minor",None:"none"},Rr.UnderlineStyle={None:"none",Double:"double",DoubleAccounting:"doubleAccounting",Single:"single",SingleAccounting:"singleAccounting"},Rr.VerticalAlignment={Baseline:"baseline",Sub:"sub",Super:"super"},Rr.setSharedMeasurer=s=>{pl=s},Rr.getSharedMeasurer=()=>pl||(pl=ky(),pl),Rr.getDeviceScale=()=>96/72*1,Rr.getPanoseFallback=s=>{const e=[],t=s.length;for(let i=0;i<t;i+=2)e.push(parseInt(s.substring(i,i+2),16));const n=e[0],r=e[1],o=e[3];switch(n){case 2:return o===9?"monospace":r>=2&&r<=8?"serif":"sans-serif";case 3:return"cursive";case 4:return"fantasy";case 5:return"monospace";default:return"sans-serif"}},Rr.GenericName={Serif:"serif",SanSerif:"sans-serif",MonoSpace:"monospace",Cursive:"cursive",Fantasy:"fantasy",SystemUI:"system-ui",UISystem:"ui-system",UISerif:"ui-serif",UISanSerif:"ui-sans-serif",UIMonoSpace:"ui-monospace",UIRounded:"ui-rounded",Math:"math",Emoji:"emoji",Fangsong:"fangsong"};class Ny{constructor(e){this._private={input:e},typeof e=="string"?this._private.name=e:Object.assign(this._private,e)}toJSON(){return this._private.input}getFamily(){return this._private.name}getPitch(){return this._private.pitch}getPanose(){return this._private.panose}toString(){return typeof this._private.input=="string"?this._private.input:JSON.stringify(this._private.input)}get isIFont(){return!0}}const b0=["Arial","Arial Black","Brush Script MT","Calibri","Comic Sans MS","Courier New","Garamond","Georgia","Impact","Luminari","Palatino Linotype","Tahoma","Times New Roman","Trebuchet MS","Verdana"],kn=new Map;kn.set(ke.GenericName.Serif,["Tahoma"]),kn.set(ke.GenericName.SanSerif,["Calibri"]),kn.set(ke.GenericName.MonoSpace,["Courier New"]),kn.set(ke.GenericName.Cursive,["Comic Sans MS"]),kn.set(ke.GenericName.Fantasy,["Luminari"]),kn.set(ke.GenericName.UISystem,["Arial"]),kn.set(ke.GenericName.UISerif,["Tahoma"]),kn.set(ke.GenericName.UISanSerif,["Arial"]),kn.set(ke.GenericName.UIMonoSpace,["Courier New"]),kn.set(ke.GenericName.UIRounded,["Arial"]),kn.set(ke.GenericName.Math,[]),kn.set(ke.GenericName.Emoji,[]),kn.set(ke.GenericName.Fangsong,[]);const nd=new Map;let v0=[];Xd(b0);const Fy=eval;function Xd(s){s||Xd(b0);let e=[];for(let t=0;t<s.length;t++){let n=s[t];typeof n=="string"&&(n=new Ny(n));let r=!0;const o="document";try{r=Fy(`${o}.fonts.check('12px ${n.getFamily()}')`)}catch{}const i={fontRef:n,loaded:r};e.push(i),nd.set(n.getFamily(),i)}v0=Object.freeze(e)}const Uc=new Map,FR=Object.freeze(Object.defineProperty({__proto__:null,findBestMatch:(s,e)=>{const t=Uc.get(s);if(t)return t.fontRef===null?null:t;let n=[s];e.fallbacks&&(n=n.concat(e.fallbacks));let r=null;for(let o=0;!r&&o<n.length;o++){let i=n[o];if(r=nd.get(i),!r){const l=kn.get(i);if(l)for(let a=0;!r&&a<l.length;a++)r=nd.get(l[a])}}return r?Uc.set(s,r):Uc.set(s,{fontRef:null,loaded:!1}),r},getFontList:function(){return v0},setFontList:Xd},Symbol.toStringTag,{value:"Module"}));let C0=class x0{constructor(e,t,n,r=null,o=null,i=null){this._private={wrapped:!0,insets:zr.EmptyRect,orientation:oe.Orientation.Horizontal,autoFit:oe.Autofit.None,fontScale:1,vertical:!1,columnCount:1,columnSpacing:0,verticalAlignment:oe.VerticalAlignment.Center,horizontalCentered:!1,lineReduction:0,isSpaceFirstLastPara:!1,presetTextWarp:null,paragraphs:V.EmptyArray},this._bounds=null,this._textBounds=null,this._lines=null,this._lastLayoutDims=void 0,this._lastLayout=void 0,this._private=Object.assign(this._private,e||{}),this._defaultFont=t,this._alignment=n,this._lines=r,this._bounds=Object.freeze(o),this._textBounds=Object.freeze(i)}visitParas(e){e?.visitTextFrame?.(this);const t=this.paragraphs,n=t.length;for(let r=0;r<n;r++){const o=t[r];e?.visitTextParagraph?.(o,r,n);const i=o.runs,l=i.length;for(let a=0;a<l;a++)e?.visitTextRun?.(i[a],a,l)}}visitLines(e){e?.visitTextFrame?.(this);const t=this.lines,n=t.length;for(let r=0;r<n;r++){const o=t[r];e?.visitTextLine?.(o,r,n);const i=o.runs,l=i.length;for(let a=0;a<l;a++)e?.visitTextRun?.(i[a],a,l)}}layout(e=null){return this._lastLayout&&this._lastLayoutDims?.width===e?.width&&this._lastLayoutDims?.height===e?.height||(this._lastLayout=$y(this,this._defaultFont,this._alignment,e),this._lastLayoutDims=e),this._lastLayout}clone(e){const t=e?.visitTextFrame?.(this),n=Object.assign(this._private,t||{});return delete n.bounds,new x0(n,this._defaultFont,this._alignment)}equals(e){return V.deepEqual(this._private,e._private)}createTemporaryTextFrame(e,t){return nc(e,this._defaultFont,this._alignment,t??this._private.wrapped)}get bounds(){if(this._bounds===null)throw new Error(dg);return this._bounds}get textBounds(){if(this._textBounds===null)throw new Error(dg);return this._textBounds}get lines(){return this._lines}get wrapped(){return this._private.wrapped}get insets(){return this._private.insets}get orientation(){return this._private.orientation}get autoFit(){return this._private.autoFit}get fontScale(){return this._private.fontScale}get vertical(){return this._private.vertical}get columnCount(){return this._private.columnCount}get columnSpacing(){return this._private.columnSpacing}get verticalAlignment(){return this._private.verticalAlignment}get horizontalCentered(){return this._private.horizontalCentered}get lineReduction(){return this._private.lineReduction}get isSpaceFirstLastPara(){return this._private.isSpaceFirstLastPara}get presetTextWarp(){return this._private.presetTextWarp}get paragraphs(){return this._private.paragraphs}};const dg="bounds can not be used until layout",Bi=class Bi{};Bi.NL=`
`,Bi.DefaultLineSpacing=100,Bi.DefaultTabWidth=72;let Fa=Bi,E0=class R0{constructor(e){this._private={defaultFontSize:11,defaultTabSize:Fa.DefaultTabWidth,tabOverrides:V.EmptyArray,spacingBefore:0,spacingAfter:0,lineSpacing:Fa.DefaultLineSpacing,align:oe.HorizontalAlignment.Left,endParagraphSize:0,indentLevel:0,leadingIndent:0,hangingIndent:0,rightMargin:0,bullet:null},this._private=Object.assign(this._private,e||{})}clone(e){const t=e?.visitTextParagraph?.(this,0,1),n=Object.assign(this._private,t||{});return delete n.bounds,new R0(n)}equals(e){return V.deepEqual(this._private,e._private)}get bounds(){return this._bounds}get defaultFontSize(){return this._private.defaultFontSize}get defaultTabSize(){return this._private.defaultTabSize}get tabOverrides(){return this._private.tabOverrides}get spacingBefore(){return this._private.spacingBefore}get spacingAfter(){return this._private.spacingAfter}get lineSpacing(){return this._private.lineSpacing}get align(){return this._private.align}get endParagraphSize(){return this._private.endParagraphSize}get indentLevel(){return this._private.indentLevel}get leadingIndent(){return this._private.leadingIndent}get hangingIndent(){return this._private.hangingIndent}get rightMargin(){return this._private.rightMargin}get bullet(){return this._private.bullet}get runs(){return this._private.runs}},I0=class A0{constructor(e,t=null){this._private={text:null,fontName:"Arial",bold:!1,italic:!1,superSub:!1,fontSize:11,letterSpacing:0,kerningMin:10,smallCaps:Na.SmallCaps.None,offset:0,strikeStyle:Na.StrikeStyle.None},this._private={...this._private,...e},this._bounds=t}clone(e){const t=e?.visitTextRun?.(this,0,1),n=Object.assign(this._private,t||{});return delete n.bounds,new A0(n)}equals(e){return V.deepEqual(this._private,e._private)}get bounds(){return this._bounds}get text(){return this._private.text}get fontName(){return this._private.fontName}get bold(){return this._private.bold}get italic(){return this._private.italic}get fontSize(){return this._private.fontSize}get superSub(){return this._private.superSub}get letterSpacing(){return this._private.letterSpacing}get kerningMin(){return this._private.kerningMin}get smallCaps(){return this._private.smallCaps}get offset(){return this._private.offset}get strikeStyle(){return this._private.strikeStyle}};class M0{constructor(e,t,n){this._private={},this._private={bounds:e,baseline:t,runs:n}}get bounds(){return this._private.bounds}get baseline(){return this._private.baseline}get runs(){return this._private.runs}get bullet(){return null}}function T0(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var hg,gg,fg,mg,pg,wg;function Oy(){if(mg)return fg;mg=1;const s=new Uint8Array(new Uint32Array([305419896]).buffer)[0]===18,e=(t,n,r)=>{let o=t[n];t[n]=t[r],t[r]=o};return fg={swap32LE:t=>{s&&(n=>{const r=n.length;for(let o=0;o<r;o+=4)e(n,o,o+3),e(n,o+1,o+2)})(t)}}}var Dy=function(){if(wg)return pg;wg=1;const s=function(){if(gg)return hg;function t(){this.table=new Uint16Array(16),this.trans=new Uint16Array(288)}function n(_,C){this.source=_,this.sourceIndex=0,this.tag=0,this.bitcount=0,this.dest=C,this.destLen=0,this.ltree=new t,this.dtree=new t}gg=1;var r=new t,o=new t,i=new Uint8Array(30),l=new Uint16Array(30),a=new Uint8Array(30),c=new Uint16Array(30),u=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),d=new t,h=new Uint8Array(320);function f(_,C,E,x){var R,I;for(R=0;R<E;++R)_[R]=0;for(R=0;R<30-E;++R)_[R+E]=R/E|0;for(I=x,R=0;R<30;++R)C[R]=I,I+=1<<_[R]}var g=new Uint16Array(16);function m(_,C,E,x){var R,I;for(R=0;R<16;++R)_.table[R]=0;for(R=0;R<x;++R)_.table[C[E+R]]++;for(_.table[0]=0,I=0,R=0;R<16;++R)g[R]=I,I+=_.table[R];for(R=0;R<x;++R)C[E+R]&&(_.trans[g[C[E+R]]++]=R)}function p(_){_.bitcount--||(_.tag=_.source[_.sourceIndex++],_.bitcount=7);var C=1&_.tag;return _.tag>>>=1,C}function w(_,C,E){if(!C)return E;for(;_.bitcount<24;)_.tag|=_.source[_.sourceIndex++]<<_.bitcount,_.bitcount+=8;var x=_.tag&65535>>>16-C;return _.tag>>>=C,_.bitcount-=C,x+E}function S(_,C){for(;_.bitcount<24;)_.tag|=_.source[_.sourceIndex++]<<_.bitcount,_.bitcount+=8;var E=0,x=0,R=0,I=_.tag;do x=2*x+(1&I),I>>>=1,++R,E+=C.table[R],x-=C.table[R];while(x>=0);return _.tag=I,_.bitcount-=R,C.trans[E+x]}function b(_,C,E){var x,R,I,A,M,k;for(x=w(_,5,257),R=w(_,5,1),I=w(_,4,4),A=0;A<19;++A)h[A]=0;for(A=0;A<I;++A){var F=w(_,3,0);h[u[A]]=F}for(m(d,h,0,19),M=0;M<x+R;){var L=S(_,d);switch(L){case 16:var N=h[M-1];for(k=w(_,2,3);k;--k)h[M++]=N;break;case 17:for(k=w(_,3,3);k;--k)h[M++]=0;break;case 18:for(k=w(_,7,11);k;--k)h[M++]=0;break;default:h[M++]=L}}m(C,h,0,x),m(E,h,x,R)}function v(_,C,E){for(;;){var x,R,I,A,M=S(_,C);if(M===256)return 0;if(M<256)_.dest[_.destLen++]=M;else for(x=w(_,i[M-=257],l[M]),R=S(_,E),A=I=_.destLen-w(_,a[R],c[R]);A<I+x;++A)_.dest[_.destLen++]=_.dest[A]}}function y(_){for(var C,E;_.bitcount>8;)_.sourceIndex--,_.bitcount-=8;if((C=256*(C=_.source[_.sourceIndex+1])+_.source[_.sourceIndex])!==(65535&~(256*_.source[_.sourceIndex+3]+_.source[_.sourceIndex+2])))return-3;for(_.sourceIndex+=4,E=C;E;--E)_.dest[_.destLen++]=_.source[_.sourceIndex++];return _.bitcount=0,0}return function(_,C){var E;for(E=0;E<7;++E)_.table[E]=0;for(_.table[7]=24,_.table[8]=152,_.table[9]=112,E=0;E<24;++E)_.trans[E]=256+E;for(E=0;E<144;++E)_.trans[24+E]=E;for(E=0;E<8;++E)_.trans[168+E]=280+E;for(E=0;E<112;++E)_.trans[176+E]=144+E;for(E=0;E<5;++E)C.table[E]=0;for(C.table[5]=32,E=0;E<32;++E)C.trans[E]=E}(r,o),f(i,l,4,3),f(a,c,2,1),i[28]=0,l[28]=258,hg=function(_,C){var E,x,R=new n(_,C);do{switch(E=p(R),w(R,2,0)){case 0:x=y(R);break;case 1:x=v(R,r,o);break;case 2:b(R,R.ltree,R.dtree),x=v(R,R.ltree,R.dtree);break;default:x=-3}if(x!==0)throw new Error("Data error")}while(!E);return R.destLen<R.dest.length?typeof R.dest.slice=="function"?R.dest.slice(0,R.destLen):R.dest.subarray(0,R.destLen):R.dest}}(),{swap32LE:e}=Oy();return pg=class{constructor(t){const n=typeof t.readUInt32BE=="function"&&typeof t.slice=="function";if(n||t instanceof Uint8Array){let r;if(n)this.highStart=t.readUInt32LE(0),this.errorValue=t.readUInt32LE(4),r=t.readUInt32LE(8),t=t.slice(12);else{const o=new DataView(t.buffer);this.highStart=o.getUint32(0,!0),this.errorValue=o.getUint32(4,!0),r=o.getUint32(8,!0),t=t.subarray(12)}t=s(t,new Uint8Array(r)),t=s(t,new Uint8Array(r)),e(t),this.data=new Uint32Array(t.buffer)}else({data:this.data,highStart:this.highStart,errorValue:this.errorValue}=t)}get(t){let n;return t<0||t>1114111?this.errorValue:t<55296||t>56319&&t<=65535?(n=(this.data[t>>5]<<2)+(31&t),this.data[n]):t<=65535?(n=(this.data[2048+(t-55296>>5)]<<2)+(31&t),this.data[n]):t<this.highStart?(n=this.data[2080+(t>>11)],n=this.data[n+(t>>5&63)],n=(n<<2)+(31&t),this.data[n]):this.data[this.data.length-4]}}}();const Ly=T0(Dy);var Sg,_g={},By=(Sg||(Sg=1,function(s){var e=typeof Uint8Array<"u"?Uint8Array:Array,t=43,n=47,r=48,o=97,i=65,l=45,a=95;function c(u){var d=u.charCodeAt(0);return d===t||d===l?62:d===n||d===a?63:d<r?-1:d<r+10?d-r+26+26:d<i+26?d-i:d<o+26?d-o+26:void 0}s.toByteArray=function(u){var d,h,f,g,m,p;if(u.length%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var w=u.length;m=u.charAt(w-2)==="="?2:u.charAt(w-1)==="="?1:0,p=new e(3*u.length/4-m),f=m>0?u.length-4:u.length;var S=0;function b(v){p[S++]=v}for(d=0,h=0;d<f;d+=4,h+=3)b((16711680&(g=c(u.charAt(d))<<18|c(u.charAt(d+1))<<12|c(u.charAt(d+2))<<6|c(u.charAt(d+3))))>>16),b((65280&g)>>8),b(255&g);return m===2?b(255&(g=c(u.charAt(d))<<2|c(u.charAt(d+1))>>4)):m===1&&(b((g=c(u.charAt(d))<<10|c(u.charAt(d+1))<<4|c(u.charAt(d+2))>>2)>>8&255),b(255&g)),p},s.fromByteArray=function(u){var d,h,f,g=u.length%3,m="";function p(S){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(S)}function w(S){return p(S>>18&63)+p(S>>12&63)+p(S>>6&63)+p(63&S)}for(d=0,f=u.length-g;d<f;d+=3)m+=w(h=(u[d]<<16)+(u[d+1]<<8)+u[d+2]);switch(g){case 1:m+=p((h=u[u.length-1])>>2),m+=p(h<<4&63),m+="==";break;case 2:m+=p((h=(u[u.length-2]<<8)+u[u.length-1])>>10),m+=p(h>>4&63),m+=p(h<<2&63),m+="="}return m}}(_g)),_g),rd={};const zy=[[4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,4,4,4,4,4,4,4,4,4,4,4],[0,4,4,1,1,4,4,4,4,1,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,4,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[4,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,1],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,1],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,1,0,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,0,0,1,1,1,1,1,1,1,0,0,4,2,4,1,1,1,1,1,0,1,1,1,0],[1,4,4,1,1,1,4,4,4,0,0,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,0,1,4,4,4,0,0,1,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,0,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,4,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,0,0,0,0,0,0,0,0,0,0,0,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,1,1,1,1,1,1,4,2,4,1,1,1,1,1,1,1,1,1,1],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,1,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,1,1,1,1,0,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,1,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,1,0,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,0,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,1,0,0,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,1,1,0],[0,4,4,1,1,1,4,4,4,0,1,0,0,0,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[1,4,4,1,1,1,4,4,4,1,1,1,1,1,0,1,1,1,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0],[0,4,4,1,1,0,4,4,4,0,0,0,0,0,0,0,0,0,0,0,4,2,4,0,0,0,0,0,0,0,0,1,0]],Py=new Ly(T0(By).toByteArray("AAgOAAAAAAAQ4QAAAQ0P8vDtnQuMXUUZx+eyu7d7797d9m5bHoWltKVUlsjLWE0VJNigQoMVqkStEoNQQUl5GIo1KKmogEgqkKbBRki72lYabZMGKoGAjQRtJJDaCCIRiiigREBQS3z+xzOTnZ3O+3HOhd5NfpkzZx7fN9988zivu2M9hGwB28F94DnwEngd/Asc1EtIs9c/bIPDwCxwLDgezHcodyo4w5C+CCwBS8FnwSXgCnA1uFbI93XwbXAbWAfWgx+CzWAb+An4KfgFeAzsYWWfYuFz4CXwGvgb+Dfo6yNkEEwGh4CZYB44FpwI3g1OY+kfBItZOo2fB84Hy8DF4HJwNbiWpV8PVoO1LH4n2NRXyN+KcAd4kNVP9XsY4aPgcfAbsBfs6SniL4K/sPjfEf6HlanXCRkCw2BGvUh/keWfXS/CY+pFXs7x9XHmM94LTmWIeU2cgbxnS/k/B3kf86jDhU8L9V2E40vAFWAlWFUfb++NOL4F3C7JX4/4GiE+hvgWsF0oS7mXldspnN+F493gyXrh9xTav0cg3EvzgVfBG6wsmVSEkxBOBgdPGpd7JI6PnqRvJ68/xlbHof53gPeA94OzwLngk+ACsAwsByvASrAK3MB0Ws3CtQjvBJvAVrADPMDSHkb4CNijaccTwvnf4fiPEs8Lxy+D18A/QU8/xjgYBjPAbDAKTgYLwOngTHAO+EQ/8wuEF4EvsPiVCFf2+9tsFStzA8LVHuXXBsi6QyqzUYiPMR/7Mc7dAx7oL8bzw/3u/Bw8Bp4Az4AXwCtgHzsmDXP5fiF9iiVvly5d0sHngar16NKlS5cuXbp06fLmYlqHXrcd3ph4P0THUY3iXh49novju4S0tzfs5d+JPKewfAsRntZb3K9ZhOMlrO6lCC8An28U9+OuovcPcPxlVu5rCL/VmHh/iHIrzn3fIPu7SN8Axmg+8AOwEWwCm7tp3bRuWjetm5Y8bSu4B9zbKO6ZVsnORrVU3f4uXTqZ2H3sLoyx3eDXjfDndE9qyj6L838CfwVvgFpzYnof4oNgOhgBc8Fos9DrZIQLmtXPP1MmF6wGj4H+KXoWguvADkXaPil+YpuQy8Am8Ey7ODdtmJDF4HowBp4De6HDTNjhfHAHeBr0DBBy0kDxfPbcgSIusgrcWhtnJ8vL+TPix7UIOQtcBq4C28Cr4KRBnANbwSuDE+s50JgyNNFuXbp06XIgsXjIvPafjvXozKY+fVFz/z0LT1uCtKVSWbrOLWPnztG8e0Xfy7ol8XtZJi7WtG+5od2UFXQ/A12vUeS7jp27yVKHjdsU9lXB869TyNvAzt0lpP2oWbwLdjiO78bx/Sz+EMJHwK9Y/LcIfw+eZ3F67/Hl5vh9xX80J+rwX8SvRDhpgL17iPAQMHNArfPrqHPewLheI+AERV6efwV418B4nOZ/H+IfYHV8GOF5LJ3eAz0fx8sM9S0fUNud39O9CulfGZhY5huI3wzWgNvBelbHZoTbNPVpfYjKQpkHwUNgl0LWblbnk0LbbDxr0OMFpL3iqWdu9nWYPlVAWkXY39LnGdCkDbeqv1YNbfcMQ3t9oe8lzm6NH9N1ZB6Ln4BwfkJZJk7RyFnYKt6b/JDQXx9p5X+eFdqOjzM9P9MB/lUlFzr20aXIdzlY4dmn9F3YqtvoO76/2hp/D/xA5Zue88nNyL8GbFbs075X0tyUig3Qd2MCnf//HjnzpbsR3g9+1kHzzVjdnE71/qVBX9rGPUh/ysNWe1neFzvIDi5zAufV1sT0N0poR22wkFUfTOPfA4N2mbZ5fSrqOHSw+IbkSBbOGSzSRgf91/GTUWYBOB2cIZQ/G8cfBZ8CFwrnL8XxF8FKcA24jqXdiPA7Qr61OF7H4mMItwzuv2/YLth1ISt3Hzu3k4W7EH5JqPdRHD/O4k+z8A8IX5Lq3y7Z4nXE9xn6kX6vQ4bKfy+ok+hH+xf3hq9dnTTHhjKd2GmDuWA242iHMq4cC7A8kJ7i8o1+skSa7Jieo38HCWnoNjKFhdSFBxzpZ7QE6lI8N4S14aASZcryaV/WWHw66f6NHuCoxuQxmvM56GX9QMd8Q4D65ywGP+ZzRJuM+zQvx/MOS2VFeqQ4IXnH26zM9Xe6/E6D+4foAzzuajPZp8Qyw5ayZVDWuH0z0BtYRkeIDqH9KO9VbH1btd/lhNqCzvl8zeLnG0S/hnU6baHfpiuO6yy0rd+DHURo/zYF5H26j03rQsip2ndzz82u1z9N4VjWKWeb68Tedpt95HRVXp7H1R6p+/Wt4FPy/PpWwscOLRJ+PVWF/+W0iVyGzs18TIvXkOJ1Wxm66vSXz+vylenrZcj1ub439W+K8RNCGTJi2p/TJ1K23VaXr35tRpnzmjxequgfcfyk6B/TGBVlyedsNgpdd/h+W1U3P99QyFPNo1X3TwpM/WLTIWYfoBqXrv6iskHZ/RFr79R6hIyHBrH3f1nrUVnjP8SnZZ+rYtzr9Exld5MNbPNErusAPg+77u/eDOPftU9yj39TH7rezxd1LvsZQJlzkWlOirG/79zjMj/mtHUKu7vKy+3/LnXr9okyKedjX5/0He9iP/j63LwOQdarEVlfy8OO/Lqw023j6xcqmwxLiOd6heM2i9cV9LJy8jMJ23yQ+rpbfu7EQ/pXE8KYvUSqvVnb4XzZa6LrHMXHR+zcLvqWbm/Bn0/HzIs6fWPHoat8XfnDKmZGxRxeMbn2UqZ5Q94nmcZRbqqUXbZ8+lcjE+cPX11t814orvvAXNcG8vqj2vvk1MGn3anlj0bIT72v47bvE+Lc98T9b6r7AKn6j+8Duf7D0nnZx/j7Zjn0j9nbpSTndaLr9WNLivP+iN23xF7L+fqv6ZouFyb78jxVXvv5jJ9YUs9/sddO8h7KNg5jrhfaJGztT6G7KF+1d6yCmD5Kdb2fan60rSc552fZr3zeQ9DpnPp+Si5cx5Ktv2QfSzF/mMbWdOm46rFI4XstnU9xeqX4NKb7TKEdcr6pZOK3ID1k/LvFHkVczEuZLEDr499YqvqBym1aEHWgcvoYOtv0M91qQl5TfpO/in6rWx8OVpT1Wedkv3f5xom3T/xeR/6Gx6V86PWAOB4bBpqWdN+yTcVxjIyGRz/FrDGu6w/3d7kPm8StX8RyPu+uuvpNju/vTLJV37GpvoM0oZPnW87VLnL/5pDno1NoW1R6yedU6TyUv3u19a3KFnIbTLYz+ZCLP4T0tU1uivFgso0pnsJ/UtXvarNY28Xq5cvkBDrQP/E5ZaiuQwwfmTlsOiQRU1fMuqrDd/3ISSuwjOwXOfTyGUMpZIXq4GpLn3pUcdfzch2x7XO1u2uZHOPb1G6b3Xg9PH1IIWeEpJlPQtqos2EKW8b0u8rnuP1UeVLoXJb9be0uG9nnbchjU+XTszT5VeNBThPHnc5OKj1U9aj0GTHIVaGy1YhEWT4ixns00DT+XEzWn/7VAsIc63Cov3OdyhwjrnaqQqZvWKXdypRdlq+k8msZ031U+Rm4fA+3TtyeR9hwfW9G9yxDN0fZMN33F+9TE6md4hwoxumfaUzI9fN3PFT3xVV2msrQ3UsnChm6Nulk8TndpS28D3zX9tTIPsF/z7Am5OkTjm1tI1JZW74+4VgsZ0N3L1yXV3WeP5uR7TGHHdvC3JQlxybfpd22tDlk/2eofRK8TzrN/qnar/K/OUTth6I/+jAnEptNbPvFHP2gs40N3+dfMWtwqvVct7/wfd8gtQ7imifial9ZJ9/3IHLYU6eDj3+4PhsNhX+vwvcWLnu6kGfEMe8DuciPfUfGZB8X/7HJy/Gefe5n+VRGFd/wyP2ta7/LO4yh/sbLV/k9lev6kfO9Dt/5U67b1/6u/epqB1U9Me23jfHY9sscAg4tkbLl+e4/U36rJ9ddxfd6sg5vq5ice42Wpk/pb9FOJ36/W9tpv4kbC79nUbZceX8Zu6/qJ+P3WvhvA8v3reh7Jbn2d6rrNC7XNZTLma4Ba0JI9efX2uLzF5scG/w9UNU1ZxW+ymUfzELeTllXlQ1rUuhzjS5fp9c964iFBOqeSz63bU065nZKdU+mDEz3qHIjjifquw0pnb/raRtvrnsYcb46ihT3taoYz6brdNW9l6rWRnE/navdPn1XlR1km7hcz1WlH/elKuSOSvLLuE8U6m8uzwRdfcGl73VyTHuyMvzJ1Sa2cWDTP/Z63Kc94n2B1PYr24dz1JlyHLlcP+S4B6vD1c9EW4q2LWstCvUjeVy63k/LMYdUNd5D1xQfvVTzX1VjkMsUv88N8VH5fReVn/Fjn++/h6X6Q8a6b1/q3g/i/ewi0/Scs8zxXeV6mWIOUPlPzBgdFerW+bZrm2P18dnjuK6HunEp+rHvPMXbr+sHVb/lnL+pTP57jPw9Cvk3PW178JD9qChfzuvTf7Htl38L1QUf/VKu9SFjwWbTWPvFEvu7Uq76y7+31g6QlYPc669pbsm9Xur2LWI9Pu8ypfDXqm3A2z8s1FWGn4ntL9NfQu2oSlftX9uetvTtv7J8Ql4zxfXGZ3zk8PeQ9w59x2uMfqI8/q5eKh/l9cb2rwsu9rSNl06ZP2Pmxtz+rNMx93yno0n2/82rVH7rQ+y9P15H6FyRun9ViH81ATmffI7nJ5r8uXXW6enbP6b/B8/l5OifVHYLnb9S39s2zcc+Ph+rh8+eQgVPS72elzGWY/tUtbbabBpDiI7yN1q6/4th2y+ErAc5+9BVvu/7KamJbWNZeuqI/R4tRf+YyD1HmOZM1bMV3/14Sn10c0Xu+Sj1nOXb5jL73ncdy02uvlXZNde65dOHYl7Vs4KYuS6FzWLn2zJlpZqPXPVPOa5yzKOyn1VhT9lmMfdbfH7D11Wf2PXN5h9y+dD287+qxgSnaYmnIrRtIb8pJe6/Uv9OVer6Whn0zfGO/BEloZI9ojmfAlUflClDd178bTmVHVTpZXOkAlk/lb42UujmI89HH5V+cl7XtowY6vTxLVWok6UrGzoGTHN+bB+6ri05687VNpvfuvRfaP2uMlNQth1D5JjGelm/8yn+9p3p/7qk9gnfeddXZmq/Sm333PJT659Kv1zjNbZ9uv2Oi//67CV8/N1nj1DmviyXDNVeJkaeaX8UsyesYg8cu2+NvdaPfb+lLDu5tvt/")),yg=function(s){switch(s){case 33:case 39:case 40:case 42:return 12;case 35:return 5;default:return s}},bg=function(s){switch(s){case 37:case 38:return 34;case 41:return 22;default:return s}};let qc=class{constructor(e,t=!1){this.position=e,this.required=t}};rd=class{nextCodePoint(){const s=this.string.charCodeAt(this.pos++),e=this.string.charCodeAt(this.pos);return 55296<=s&&s<=56319&&56320<=e&&e<=57343?(this.pos++,1024*(s-55296)+(e-56320)+65536):s}nextCharClass(){return yg(Py.get(this.nextCodePoint()))}getSimpleBreak(){switch(this.nextClass){case 41:return!1;case 34:case 37:case 38:return this.curClass=34,!1;case 36:return this.curClass=36,!1}return null}getPairTableBreak(s){let e=!1;switch(zy[this.curClass][this.nextClass]){case 0:e=!0;break;case 1:e=s===41;break;case 2:if(e=s===41,!e)return e=!1,e;break;case 3:if(s!==41)return e}return this.LB8a&&(e=!1),!this.LB21a||this.curClass!==16&&this.curClass!==17?this.LB21a=this.curClass===13:(e=!1,this.LB21a=!1),this.curClass===28?(this.LB30a++,this.LB30a==2&&this.nextClass===28&&(e=!0,this.LB30a=0)):this.LB30a=0,this.curClass=this.nextClass,e}nextBreak(){if(this.curClass==null){let s=this.nextCharClass();this.curClass=bg(s),this.nextClass=s,this.LB8a=s===31,this.LB30a=0}for(;this.pos<this.string.length;){this.lastPos=this.pos;const s=this.nextClass;if(this.nextClass=this.nextCharClass(),this.curClass===34||this.curClass===36&&this.nextClass!==37)return this.curClass=bg(yg(this.nextClass)),new qc(this.lastPos,!0);let e=this.getSimpleBreak();if(e===null&&(e=this.getPairTableBreak(s)),this.LB8a=this.nextClass===31,e)return new qc(this.lastPos)}return this.lastPos<this.string.length?(this.lastPos=this.string.length,new qc(this.string.length)):null}constructor(s){this.string=s,this.pos=0,this.lastPos=0,this.curClass=null,this.nextClass=null,this.LB8a=!1,this.LB21a=!1,this.LB30a=0}};class Hy{constructor(e){this._textMeasurer=e}_measureText(e){const t=this._fontSize,n=this._fontName,r=this._metricOptions;if(this._isSuperSub){const o=this._textMeasurer(e,.6*t,n,r);return{...this._textMeasurer("M",t,n,r),width:o.width}}return this._textMeasurer(e,t,n,r)}_breakWord(e,t,n){let r=0;for(;r<e.length;){let o={startPosition:this._charactersRead+r,text:"",x:0,y:0,width:0,widthWhitespace:0,height:0,baseline:0},i=!1,l=0;const a=this._maxWidth;do{i=!1;const c=e.substring(r,r+l+1),u=c.replace(/\s+$/,""),d=this._measureText(u);let h=d;c.length!==u.length&&(h=this._measureText(c)),(o.x+d.width<=a||c.length<=1)&&(o.text=c,o.width=d.width,o.widthWhitespace=h.width,o.height=Math.max(o.height,d.lineHeight),o.baseline=Math.max(o.baseline,d.baseline),i=!0,l++)}while(i&&r+l<e.length);if(i){const c=e.substring(r,e.length),u=c.replace(/\s+$/,""),d=this._measureText(u);let h=d;c.length!==u.length&&(h=this._measureText(c)),t.startPosition=this._charactersRead+r,t.width=d.width,o.widthWhitespace=h.width,t.height=Math.max(t.height,d.lineHeight),t.baseline=Math.max(t.baseline,d.baseline),t.text=c}else if(n?.(o)===!1)return!1;r+=l}}_breakWhiteSpace(e,t=null){for(;e&&this._charactersRead<e.length;){let n={startPosition:this._charactersRead,text:"",x:0,y:0,width:0,widthWhitespace:0,height:0,baseline:0},r=!1;const o=this._maxWidth,i=this._indent,l=this._breaker;do if(r=!1,n.startPosition===0&&n.text.length===0&&(n.x=i,this._lastBreak=l.nextBreak()),this._lastBreak){const a=e.substring(n.startPosition,this._lastBreak.position),c=a.replace(/\s+$/,""),u=this._measureText(c);let d=u;a.length!==c.length&&(d=this._measureText(a)),n.x+u.width<=o?(n.text=a,n.width=u.width,n.widthWhitespace=d.width,n.height=Math.max(n.height,u.lineHeight),n.baseline=Math.max(n.baseline,u.baseline),r=!0,this._charactersRead=this._lastBreak.position):n.text.length===0&&this._breakWord(a,n,t)!==!1&&(r=!0,this._charactersRead=this._lastBreak.position),(r||a.indexOf(`
`)===-1)&&this._lastBreak.required&&(this._lastBreak=l.nextBreak(),r=!1)}while(r&&(this._lastBreak=l.nextBreak()));if(t?.(n)===!1)return!1}}wrap(e,t=null){this._breaker=new rd(e),this._linesRead=[],this._charactersRead=0,this._maxXRead=0,this._maxXWhitespaceRead=0,this._maxYRead=0,this._fontName=t?.fontName??"Arial",this._fontSize=t?.fontSize??12,this._metricOptions={isBold:t?.bold??!1,isItalic:t?.italic??!1,letterSpacing:t?.letterSpacing??0},this._isSuperSub=t?.superSub??!1,this._indent=t?.indent??0,this._maxWidth=t?.maxWidth??Number.MAX_SAFE_INTEGER,this._maxWidth<=0&&(this._maxWidth=Number.MAX_SAFE_INTEGER),this._maxHeight=t?.maxHeight??Number.MAX_SAFE_INTEGER,this._maxHeight<=0&&(this._maxHeight=Number.MAX_SAFE_INTEGER);const n=o=>{if(this._linesRead.length>0){let i=this._linesRead[this._linesRead.length-1];o.y=i.y+i.height}if(o.y+o.height>this._maxHeight)return!1;this._maxXRead=Math.max(this._maxXRead,o.x+o.width),this._maxXWhitespaceRead=Math.max(this._maxXWhitespaceRead,o.x+o.widthWhitespace),this._maxYRead=Math.max(this._maxYRead,o.y+o.height),this._linesRead.push(o)};if(e===""){const o=this._measureText(e);n({startPosition:0,text:"",x:0,y:0,width:0,widthWhitespace:0,height:o.lineHeight,baseline:o.baseline})}else if(this._breakWhiteSpace(e,n),new rd(e.charAt(e.length-1).repeat(2)).nextBreak().required){const o=this._measureText(e);n({startPosition:e.length,text:"",x:0,y:0,width:0,widthWhitespace:0,height:o.lineHeight,baseline:o.baseline})}const r={bounds:{x:0,y:0,width:this._maxXRead,widthWhitespace:this._maxXWhitespaceRead,height:this._maxYRead},lines:this._linesRead};return this._breaker=null,this._linesRead=[],r}}const $y=(s,e,t,n=null,r=ke.getSharedMeasurer())=>{let o="",i=null,l=null;const a=s.paragraphs,c=a.length;for(let v=0;v<c;v++){const y=a[v].runs,_=y.length;for(let C=0;C<_;C++)o+=y[C].text,C===0&&(i=y[C]);v===0&&(l=a[v])}const u=s.insets??zr.EmptyRect,d=new Hy(r),h=n?.width?n.width-u.right-u.left:n?.width,f=n?.height?n.height-u.bottom-u.top:null,g=d.wrap(o,{fontName:i.fontName,fontSize:i.fontSize*ke.getDeviceScale(),bold:i.bold,italic:i.italic,superSub:i.superSub,letterSpacing:i.letterSpacing,maxWidth:s.wrapped&&h?h:null,maxHeight:f});let m=[];const p=g.lines,w=p.length,S=new Array(w);for(let v=0;v<w;v++){const y=p[v],_={x:y.x,y:y.y,width:y.width,height:y.height},C=new I0({text:y.text,fontName:i.fontFamily,fontSize:i.fontSize,bold:i.bold,italic:i.italic,superSub:i.superSub,letterSpacing:i.letterSpacing},_);m.push(C),S[v]=new M0(_,y.baseline,[C])}const b=new E0({runs:m,align:l.align});return new C0({paragraphs:[b],wrapped:s.wrapped,verticalAlignment:s.verticalAlignment},e,t,S,{x:g.bounds.x,y:g.bounds.y,width:g.bounds.widthWhitespace,height:g.bounds.height},{x:g.bounds.x,y:g.bounds.y,width:g.bounds.width,height:g.bounds.height})},vg=s=>{let e=!1,t=!1;for(let n=0;n<s.length;n++){const r=s.charCodeAt(n);if(r>=65&&r<=90?e=!0:r>=97&&r<=122&&(t=!0),e&&t)return 0}return e?1:t?-1:0},nc=(s,e,t,n,r=!1)=>{if(s==null)return null;const o=new I0({text:s,fontName:e.toCSS().fontFamily,fontSize:e.getSize(),bold:e.getWeight()>400,italic:e.getStyle()===ke.Style.Italic,superSub:!r&&(e.getVerticalAlignment()===ke.VerticalAlignment.Sub||e.getVerticalAlignment()===ke.VerticalAlignment.Super),letterSpacing:e.getLetterSpacing()}),i=r?oe.HorizontalAlignment.Left:t.getHorizontal(),l=t.getVertical(),a=new E0({runs:[o],align:i});let c=[];return c.push(new M0(null,e.getSize(),[o])),new C0({paragraphs:[a],wrapped:n&&(t.getOverflow()===oe.Overflow.Wrap||i===oe.HorizontalAlignment.Justify||i===oe.HorizontalAlignment.Distributed||l===oe.VerticalAlignment.Justify||l===oe.VerticalAlignment.Distributed),verticalAlignment:l},e,t,c)},wl=(s,e,t,n)=>({x:s*n-e*t,y:s*t+e*n}),Cg=s=>{let e=0,t=0,n=0,r=0,o=0,i=0,l=0,a=s.length;if(a===0)return{m:0,b:0};if(a===1)return{m:1,b:s[0]};for(let u=0;u<a;u++)i=u+1,l=s[u],l==null||isNaN(l)||(e+=i,t+=l,r+=i*i,n+=i*l,o++);const c=(o*n-e*t)/(o*r-e*e);return{m:c,b:t/o-c*e/o}},od=(s,e)=>{if(e===null)return null;const t=V.isObject(e);return s!=null&&t?V.mergeContentful(s,e):t?V.cloneObject(e):e},Vy=(s,e,t)=>s==null||typeof s=="object"&&Object.keys(s).length===0;function Zd(s,e,t,n){if(s===e)return s??null}function Wy(s){return s==null}function jy(s,e,t=1,n){if(t===0)return{preceding:s?[...s]:[],modified:[],trailing:[]};const r=function(a,c,u=1){let d=V.findEqualOrGreater(a,c,m=>m.max);const h=a.slice(0,d),f=[],g=[];if(!a[d])return{preceding:h,modified:f,trailing:g};for(let m=d;m<a.length;m++)c+u<a[m].min?g.push({...a[m],min:a[m].min-u,max:a[m].max-u}):c>=a[m].min?Math.max(c,a[m].max+1-u)>a[m].min&&f.push({...a[m],max:Math.max(c-1,a[m].max-u)}):c<a[m].min&&c+u<=a[m].max&&f.push({...a[m],min:Math.max(c,a[m].min-u),max:a[m].max-u});return{preceding:h,modified:f,trailing:g}}(s,e,t),o=r.preceding,i=r.trailing;let l=[];return o.length>0&&l.push(o.pop()),l=l.concat(r.modified),i.length>0&&l.push(i.shift()),{preceding:o,modified:To(l,{onMerge:Zd}).modified,trailing:i}}function sd(s,e,t){if(!s)throw new Error("runs can not be null");if(!e)return{preceding:[],modified:s?[...s]:[],trailing:[]};const n=function(i,l,a,c,u=!1){if(!l)return{preceding:[],modified:i?[...i]:[],trailing:[]};let d,h=V.findEqualOrGreater(i,l.min,S=>S.max),f=i.slice(0,h),g=i.slice(h),m=[],p={...l},w=g[0]||{min:l.min,max:l.max,value:void 0};for(d=u?(S,b,v)=>{const y=(c||od)(b,v,S);y!==void 0?S.value=y:delete S.value,m.push(S)}:(S,b,v)=>{const y=(c||od)(b??null,v,S);y!==void 0?S.value=y:delete S.value,m.push(S)};g.length>=0&&p.max-p.min>=0;){if(p.min<w.min)d({min:p.min,max:Math.min(p.max,w.min-1)},void 0,p.value),p={min:w.min,max:p.max,value:p.value},w={min:p.min,max:w.max,value:w.value};else if(p.min>w.min){const S=w.value!==void 0&&a?a(w,p.min):[w.value,w.value];m.push({min:w.min,max:Math.min(p.min,w.max)-1,value:S[0]}),p={min:Math.min(p.min,w.max),max:p.max,value:p.value},w={min:p.min,max:w.max,value:S[1]}}else{const S=w.value!==void 0&&a?a(w,p.min):[w.value,w.value];d({min:w.min,max:Math.min(p.max,w.max)},S[0],p.value),p={min:Math.min(p.max,w.max)+1,max:p.max,value:p.value},w={min:Math.min(p.max,w.max)+1,max:w.max,value:S[1]}}w.min<=w.max?g[0]=w:(g=g.slice(1),w=g[0]||{min:w.min,max:p.max})}return{preceding:f,modified:m,trailing:g}}(s,e,t?.onSplit,t?.onUpdate,t?.inPlace);let r=[];n.preceding.length>0&&r.push(n.preceding.pop()),r=r.concat(n.modified),n.trailing.length>0&&r.push(n.trailing.shift());const o=function(i,l){if(!i||i.length===0)return{preceding:[],modified:i?[...i]:[],trailing:[]};const a=Math.min(i.length-1,l?.startOffset??0),c=Math.min(i.length,l?.endOffset??i.length),u=l?.cull??Wy;let d=i.slice(0,a),h=i.slice(c);const f=[];for(let g=a;g<c;g++)u(i[g].value,i[g].min,i[g].max)!==!0&&f.push(i[g]);return{preceding:d,modified:f,trailing:h}}(To(r,{onMerge:t?.onMerge??Zd}).modified,{cull:t?.isCull||Vy});return{preceding:n.preceding,modified:o.modified,trailing:n.trailing}}function gr(s){return[...s.preceding,...s.modified,...s.trailing]}function To(s,e){if(!s||s.length===0)return{preceding:[],modified:s?[...s]:[],trailing:[]};const t=Math.min(s.length-1,e?.startOffset??0),n=Math.min(s.length,e?.endOffset??s.length),r=e?.onMerge??Zd;let o=s.slice(0,t),i=s.slice(n);const l=[];let a={...s[t]},c=s[t]?.max||0;for(let u=t+1;u<=n;u++){const d=s[u];let h=!1;if(d&&d.min<=s[u-1].max+1)if(a.value===void 0&&d.value===void 0)h=!0;else{const f=r(a.value,d.value,a.max-a.min+1,d.max-d.min+1);f!==void 0&&(h=!0,a.value=f)}h?a.max=Math.max(c,d.max):(l.push(a),a={...s[u]},d&&(a.max=Math.max(c,d.max))),a&&(c=a.max)}return{preceding:o,modified:l,trailing:i}}function xg(s){return s&&s.sort((e,t)=>{let n=e.min-t.min;return n===0&&(n=e.max-t.max),n})}const Eg=(s,e=!1)=>{if(!s||s.length===0)return V.EmptyArray;const t=e?s:s.sort(),n=[];let r=null;for(let o=0;o<t.length;o++){const i=t[o];r?r.max===i-1?r.max=i:(n.push(r),r={min:i,max:i}):r={min:i,max:i}}return r&&n.push(r),n},Rg=(s,e)=>s?e?s||e?s.min>e.max||s.max<e.min?null:{min:Math.max(s.min,e.min),max:Math.min(s.max,e.max)}:null:{...s}:{...e},k0=s=>{const e=s.length===0;return{runs:s,run:{min:e?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,max:e?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,value:null},index:Number.MAX_SAFE_INTEGER}},N0=(s,e)=>{const t=e.run,n=t.min,r=t.max;if(s>=n&&s<=r)return t.value;let o=e.index;const i=e.runs;if(o<i.length-1&&s>r){o++;const u=i[o],d=u.min,h=u.max;if(s>=d&&s<=h)return e.index=o,t.min=d,t.max=h,t.value=u.value,t.value}if(o!==Number.MAX_SAFE_INTEGER&&o>0&&s<n){o--;const u=i[o],d=u.min,h=u.max;if(s>=d&&s<=h)return e.index=o,t.min=d,t.max=h,t.value=u.value,t.value}if(o=V.findEqualOrGreater(i,s,u=>u.max),o===i.length)return o=i.length,e.index=o,t.min=i[o-1].max+1,t.max=Number.MAX_SAFE_INTEGER,t.value=null,null;const l=i[o],a=l.min,c=l.max;if(s>=a&&s<=c){e.index=o,t.min=a,t.max=c;const u=l.value;return t.value=u,u}return o--,e.index=o,t.min=o>=0?i[o].max+1:Number.MIN_SAFE_INTEGER,t.max=a-1,t.value=null,null},Ig=function(s,e,t,n){if(s.length===0){if(t!=null||n!=null){const c=e({min:t??n,max:n??t});if(c&&c.break)return c}return}const r=t??s[0].min,o=n??s[s.length-1].max;let i=r-1,l=V.findEqualOrGreater(s,r,c=>c.max),a=s[l];for(;a&&a.min<=o;){if(i<a.min-1){const u=e({min:Math.max(i+1,r),max:Math.min(a.min-1,o)});if(u&&u.break)return u}const c=e({...a,min:Math.max(a.min,r),max:Math.min(a.max,o)});if(c&&c.break)return c;i=a.max,a=s[++l]}if(i<o){const c=e({min:Math.min(i+1,o),max:o});if(c&&c.break)return c}},Ag=new RegExp("([0-9]+)$");var zi,Pe,Sl,G,_l;(s=>{s.Date=class{constructor(l){this._options=l}canFill(l,a){return Ms(l)}createFillAt(l,a){a={...this._options,...a};let c=0,u=this._options?.unit;u||(u=l.length===1?ml:((f,g=!1)=>{if(!f||f.length<1)return ml;let m=f;g||(m=f.slice(),m=m.sort((b,v)=>b.getTime()-v.getTime()));let p=!1,w=-1,S=-1;for(let b=0;b<m.length;b++){let v=m[b];if(b>m.length-1&&v.getTime()<m[b+1].getTime())throw new Error("Dates are expected to be sorted.");let y=12*v.getFullYear()+v.getMonth();if(y===S)return ml;S=y;let _=v.getFullYear();_>w?w=_:p=!0}return p?ng:rg})(l));const d=og(l[0],0,u);d.setHours(0,0,0,0);let h=1;a?.reverse&&(h*=-1,c*=-1);for(let f=1;f<l.length;f++){let g=_y(l[f-1],l[f],u);if(f===1)h=g;else if(g!==h)return null}return l.length===1&&a.multiFill,f=>{const g=og(d,h*f,u);if(c!==0){const m=0+c*f,p=m%1440,w=Math.floor(p/60),S=p%60;g.setHours(w,S,0,0);const b=Math.floor(m/1440),v=Math.floor(b/365),y=b%365,_=Math.floor(y/30),C=y%30;v>0&&g.setFullYear(g.getFullYear()+v),_>0&&g.setMonth(g.getMonth()+_),C>0&&g.setDate(g.getDate()+C)}return g}}},s.Linear=class{constructor(l){this._options=l}canFill(l,a){return typeof l=="number"||l===null}createFillAt(l,a){a={...this._options,...a};const c=Cg(l),u=c.b;let d=c.m;return l.length===1?(a.reverse&&(d=-d),a.multiFill?h=>h*d+u:null):h=>d*(h+1)+u}};const e={value:null,template:null},t={sensitivity:"accent"};s.Ordinal=class{_template(l){const a=l.match(Ag);if(!a)return null;const c=a[1],u=l.lastIndexOf(c);return u===-1?null:l.substring(0,u)}canFill(l,a){if(l===null)return!0;if(typeof l!="string")return e.value=null,!1;const c=this._template(l);return c&&(a===void 0||a===e.value&&c.localeCompare(e.template,void 0,t)===0)?(e.value=l,e.template=c,!0):(e.value=null,!1)}createFillAt(l,a){const c=[],u=l[0];let d=null,h=null,f=0;if(u){const S=u.match(Ag);if(S){d=S[1],d.startsWith("0")&&(f=d.length);const b=u.lastIndexOf(d);h=u.substring(0,b)}}const g=l.length;for(let S=0;S<g;S++){const b=l[S];let v=null;if(b){const y=b.substring(h.length,b.length);y.startsWith("0")&&(f=Math.max(f,y.length));const _=parseFloat(y);isNaN(_)||(v=_)}c.push(v)}const m=Cg(c),p=m.b;let w=m.m;return w!==0&&Number.isInteger(w)?S=>{if(l[S%g]===null)return null;const b=(g===1?a.reverse?-S:S:w*(S+1))+p,v=""+Math.abs(b),y="0".repeat(Math.max(0,f-v.length))+v;return h+y}:null}},s.Copy=class{canFill(l,a){return!0}createFillAt(l,a){const c=l.length;return u=>l[u%c]??null}};const n=Object.freeze(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]),r=Object.freeze(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]),o=Object.freeze(["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),i=Object.freeze(["January","February","March","April","May","June","July","August","September","October","November","December"]);s.List=class{constructor(l){this._lists=[],this._map=new Map;const a=[];if(l?.customLists){const d=l.customLists;for(let h=d.length-1;h>0;h--)a.push(d[h])}a.push(i),a.push(o),a.push(r),a.push(n);const c=this._map,u=[];for(let d=0;d<a.length;d++){const h=a[d],f=[];u.push(f);for(let g=0;g<h.length;g++){const m=h[g],p=Cs(m,!0),w=p.toLowerCase().trim();let S=c.get(w);S||(S=[],c.set(w,S));const b={value:p,asKey:w,major:d,minor:g};S.push(b),f.push(b)}}this._lists=Object.freeze(u)}canFill(l,a){return l===null?!0:typeof l!="string"?!1:!!this._map.get(l.toLowerCase().trim())}createFillAt(l,a){const c=[],u=l[0];c.push(u.toLowerCase().trim());const d=this._map.get(c[0]);let h;const f=new Map,g=new Set;for(let R=0;R<d.length;R++){const I=d[R];f.set(I.major,I)}if(l.length>1){for(let R=1;R<l.length;R++){const I=l[R].toLowerCase().trim(),A=this._map.get(I);if(!A)return null;R===1&&(h=A),c.push(I);for(let M=0;M<A.length;M++){const k=A[M].major;f.has(k)&&g.add(k)}}if(g.size===0)return null}let m=null;const p=this._lists;for(let R=0;!m&&R<p.length;R++)(l.length===1||g.has(R))&&(m=f.get(R));if(!m)return null;let w=null;for(let R=0;!w&&h&&R<h.length;R++)h[R].asKey===c[1]&&(w=h[R]);let S=!1,b=!1;const v=vg(u);v===1?S=!0:(v===-1||vg(u[0])===-1)&&(b=!0);const y=p[m.major];let _=m.minor,C=1;if(c.length>1){C=w.minor-m.minor;for(let R=2;R<c.length;R++)if(y[R+_].minor-y[R-1+_].minor!==C)return null}l.length===1&&a?.reverse&&(C=-C);const E=l.length,x=y.length;return R=>{if(l[R%E]===null)return null;let I=(R*C+_)%x;I<0&&(I=x+I);const A=y[I].value??null;return S?A.toUpperCase():b?A.toLowerCase():A}}},s.Composite=class{constructor(l){l=Array.isArray(l)?[...l]:[l],this._fillers=l}canFill(l,a){return!0}createFillAt(l,a){const c=this._fillers;a={multiFill:l.length>1,...a};const u=l.length;let d=0,h=!1;for(let C=0;!h&&C<=u;C++)l[C]===null?d++:h=!0;let f=0;h=!1;for(let C=u-1;!h&&C>=d;C--)l[C]===null?f++:h=!0;const g=[];let m=null,p=null,w=[],S=d,b=0;const v=C=>{if(m&&m.max+1===S){const E=m.value;E.fillAt.push(C),m.max=S,E.length++,E.valuesLength++}else m={min:S,max:S,value:{fillAt:[C],start:S,length:1,valuesLength:u,blankInterval:0}};g.push(m)},y=u-f;for(S=d;S<y;){let C=l[S];if(C===null){S++;continue}p=null;let E,x=1,R=!1;for(let k=0;!R&&k<c.length+1;k++){const F=c[k];F&&(R=F.canFill(C,E),R&&(p=F))}if(!p){C!==null&&v(C),S++;continue}let I=0;b=0,E=C;do C=l[S+x],R=p.canFill(C,E),R&&(C!==null?(E=C,I>0&&(x-I===1?b=I:I!==b&&(b=0)),I=0):I++,x++);while(R&&S+x<y);w=[l[S]];const A=1+b,M=x-I;for(let k=A;k<M;k+=A)w.push(l[S+k]);if(w.length>0){const k=w.length,F=k+(k-1)*b,L=p.createFillAt?.(w,a)??w;g.push({min:S,max:S+F-1,value:{fillAt:L,start:S,length:F,valuesLength:k,blankInterval:b}})}S+=x}const _=k0(g);return C=>{const E=C>=0,x=Math.abs(C),R=N0(x%u,_);if(!R)return null;const I=Math.floor(x/u),A=R.length,M=R.start,k=(I+(E?1:0))*M+(I+(E?0:1))*(u-(M+A));let F=C+(E?-k:k);const L=R.blankInterval;if(L!==0){let D=F%A;if(D%(1+L)!==0)return null;F=Math.floor(D/(1+L))+R.valuesLength*I}const N=R.fillAt;return typeof N=="function"?N(F):N[F%N.length]}}},s.Types={Series:new s.Composite([new s.Date,new s.Linear,new s.Ordinal,new s.List]),DateDays:new s.Date({unit:ml}),DateMonths:new s.Date({unit:ng}),DateYears:new s.Date({unit:rg}),Copy:new s.Copy},s.fillTo=(l,a,c,u)=>{const d=[],h=a.length,f=l.createFillAt(a,u);for(let g=h;g<c;g++)d.push(f(g));return d}})(zi||(zi={})),(Sl=Pe||(Pe={})).Type={None:"none",Solid:"solid",Gradient:"gradient",Pattern:"pattern",Image:"pattern",Background:"background",Group:"group",Custom:"custom"},Sl.GradientType={Linear:"linear",Path:"path",Circular:"circular",Rect:"rect"},Sl.TileMirror={None:"none",Vertical:"v",Horizontal:"h",Both:"b"},Sl.BuiltInSheetPattern={None:"none",Solid:"solid",DarkGray:"darkGray",MediumGray:"mediumGray",LightGray:"lightGray",Gray0625:"gray0625",Gray125:"gray125",DarkHorizontal:"darkHorizontal",DarkVertical:"darkVertical",DarkDown:"darkDown",DarkUp:"darkUp",DarkGrid:"darkGrid",DarkTrellis:"darkTrellis",LightHorizontal:"lightHorizontal",LightVertical:"lightVertical",LightDown:"lightDown",LightUp:"lightUp",LightGrid:"lightGrid",LightTrellis:"lightTrellis",Custom:"custom"},(_l=G||(G={})).AdjustmentType={Alpha:"alpha",AlphaOff:"alphaOff",AlphaMod:"alphaMod",Hue:"hue",Sat:"sat",Lum:"lum",HueOff:"hueOff",SatOff:"satOff",LumOff:"lumOff",HueMod:"hueMod",SatMod:"satMod",LumMod:"lumMod",Red:"red",Green:"green",Blue:"blue",RedOff:"redOff",GreenOff:"greenOff",BlueOff:"blueOff",RedMod:"redMod",GreenMod:"greenMod",BlueMod:"blueMod",Shade:"shade",Tint:"tint",ETint:"eTint",Gray:"gray",Comp:"comp",Inv:"inv",Gamma:"gamma",InvGamma:"invGamma"},_l.Named={ActiveBorder:"activeBorder",ActiveCaption:"activeCaption",CaptionText:"captionText",AppWorkspace:"appWorkspace",BtnFace:"btnFace",BtnShadow:"btnShadow",DkShadow3d:"3dDkShadow",BtnHighlight:"btnHighlight",Light3d:"3dLight",BtnText:"btnText",Background:"background",GrayText:"grayText",Highlight:"highlight",HighlightText:"highlightText",HotLight:"hotLight",InactiveBorder:"inactiveBorder",InactiveCaption:"inactiveCaption",InactiveCaptionText:"inactiveCaptionText",InfoBk:"infoBk",InfoText:"infoText",Menu:"menu",MenuText:"menuText",ScrollBar:"scrollBar",Window:"window",WindowFrame:"windowFrame",WindowText:"windowText",Transparent:"transparent",AliceBlue:"aliceBlue",AntiqueWhite:"antiqueWhite",Aqua:"aqua",Aquamarine:"aquamarine",Azure:"azure",Beige:"beige",Bisque:"bisque",Black:"black",BlanchedAlmond:"blanchedAlmond",Blue:"blue",BlueViolet:"blueViolet",Brown:"brown",BurlyWood:"burlyWood",CadetBlue:"cadetBlue",Chartreuse:"chartreuse",Chocolate:"chocolate",Coral:"coral",CornflowerBlue:"cornflowerBlue",Cornsilk:"cornsilk",Crimson:"crimson",Cyan:"cyan",DkBlue:"dkBlue",DkCyan:"dkCyan",DkGoldenrod:"dkGoldenrod",DkGray:"dkGray",DkGreen:"dkGreen",DkKhaki:"dkKhaki",DkMagenta:"dkMagenta",DkOliveGreen:"dkOliveGreen",DkOrange:"dkOrange",DkOrchid:"dkOrchid",DkRed:"dkRed",DkSalmon:"dkSalmon",DkSeaGreen:"dkSeaGreen",DkSlateBlue:"dkSlateBlue",DkSlateGray:"dkSlateGray",DkTurquoise:"dkTurquoise",DkViolet:"dkViolet",DeepPink:"deepPink",DeepSkyBlue:"deepSkyBlue",DimGray:"dimGray",DodgerBlue:"dodgerBlue",Firebrick:"firebrick",FloralWhite:"floralWhite",ForestGreen:"forestGreen",Fuchsia:"fuchsia",Gainsboro:"gainsboro",GhostWhite:"ghostWhite",Gold:"gold",Goldenrod:"goldenrod",Gray:"gray",Green:"green",GreenYellow:"greenYellow",Honeydew:"honeydew",HotPink:"hotPink",IndianRed:"indianRed",Indigo:"indigo",Ivory:"ivory",Khaki:"khaki",Lavender:"lavender",LavenderBlush:"lavenderBlush",LawnGreen:"lawnGreen",LemonChiffon:"lemonChiffon",LtBlue:"ltBlue",LtCoral:"ltCoral",LtCyan:"ltCyan",LtGoldenrodYellow:"ltGoldenrodYellow",LtGray:"ltGray",LtGreen:"ltGreen",LtPink:"ltPink",LtSalmon:"ltSalmon",LtSeaGreen:"ltSeaGreen",LtSkyBlue:"ltSkyBlue",LtSlateGray:"ltSlateGray",LtSteelBlue:"ltSteelBlue",LtYellow:"ltYellow",Lime:"lime",LimeGreen:"limeGreen",Linen:"linen",Magenta:"magenta",Maroon:"maroon",MedAquamarine:"medAquamarine",MedBlue:"medBlue",MedOrchid:"medOrchid",MedPurple:"medPurple",MedSeaGreen:"medSeaGreen",MedSlateBlue:"medSlateBlue",MedSpringGreen:"medSpringGreen",MedTurquoise:"medTurquoise",MedVioletRed:"medVioletRed",MidnightBlue:"midnightBlue",MintCream:"mintCream",MistyRose:"mistyRose",Moccasin:"moccasin",NavajoWhite:"navajoWhite",Navy:"navy",OldLace:"oldLace",Olive:"olive",OliveDrab:"oliveDrab",Orange:"orange",OrangeRed:"orangeRed",Orchid:"orchid",PaleGoldenrod:"paleGoldenrod",PaleGreen:"paleGreen",PaleTurquoise:"paleTurquoise",PaleVioletRed:"paleVioletRed",PapayaWhip:"papayaWhip",PeachPuff:"peachPuff",Peru:"peru",Pink:"pink",Plum:"plum",PowderBlue:"powderBlue",Purple:"purple",Red:"red",RosyBrown:"rosyBrown",RoyalBlue:"royalBlue",SaddleBrown:"saddleBrown",Salmon:"salmon",SandyBrown:"sandyBrown",SeaGreen:"seaGreen",SeaShell:"seaShell",Sienna:"sienna",Silver:"silver",SkyBlue:"skyBlue",SlateBlue:"slateBlue",SlateGray:"slateGray",Snow:"snow",SpringGreen:"springGreen",SteelBlue:"steelBlue",Tan:"tan",Teal:"teal",Thistle:"thistle",Tomato:"tomato",Turquoise:"turquoise",Violet:"violet",Wheat:"wheat",White:"white",WhiteSmoke:"whiteSmoke",Yellow:"yellow",YellowGreen:"yellowGreen",ButtonFace:"buttonFace",ButtonHighlight:"buttonHighlight",ButtonShadow:"buttonShadow",GradientActiveCaption:"gradientActiveCaption",GradientInactiveCaption:"gradientInactiveCaption",MenuBar:"menuBar",MenuHighlight:"menuHighlight"},_l.Scheme={Bg1:"bg1",Bg2:"bg2",Tx1:"tx1",Tx2:"tx2",Accent1:"accent1",Accent2:"accent2",Accent3:"accent3",Accent4:"accent4",Accent5:"accent5",Accent6:"accent6",Hlink:"hlink",FolHlink:"folHlink"},_l.Type={Scheme:"scheme",Named:"named",Index:"index",HSL:"hsl",RGB:"rgb",LRGB:"lrgb",Hex:"hex"};const Mg=[[4290032820,1,G.Named.ActiveBorder,!0],[4288263377,2,G.Named.ActiveCaption,!0],[4278190080,3,G.Named.CaptionText,!0],[4289440683,4,G.Named.AppWorkspace,!0],[4293980400,5,G.Named.BtnFace,!0],[4285098345,6,G.Named.BtnShadow,!0],[4278190080,7,G.Named.DkShadow3d,!0],[4293125091,8,G.Named.BtnHighlight,!0],[4293125091,9,G.Named.Light3d,!0],[4278190080,10,G.Named.BtnText,!0],[4278190080,11,G.Named.Background,!0],[4285361517,12,G.Named.GrayText,!0],[4281571839,13,G.Named.Highlight,!0],[4294967295,14,G.Named.HighlightText,!0],[4278216396,15,G.Named.HotLight,!0],[4294244348,16,G.Named.InactiveBorder,!0],[4290760155,17,G.Named.InactiveCaption,!0],[4278190080,18,G.Named.InactiveCaptionText,!0],[4294967265,19,G.Named.InfoBk,!0],[4278190080,20,G.Named.InfoText,!0],[4293980400,21,G.Named.Menu,!0],[4278190080,22,G.Named.MenuText,!0],[4291348680,23,G.Named.ScrollBar,!0],[4294967295,24,G.Named.Window,!0],[4284769380,25,G.Named.WindowFrame,!0],[4278190080,26,G.Named.WindowText,!0],[16777215,27,G.Named.Transparent],[4293982463,28,G.Named.AliceBlue],[4294634455,29,G.Named.AntiqueWhite],[4278255615,30,G.Named.Aqua],[4286578644,31,G.Named.Aquamarine],[4293984255,32,G.Named.Azure],[4294309340,33,G.Named.Beige],[4294960324,34,G.Named.Bisque],[4278190080,35,G.Named.Black],[4294962125,36,G.Named.BlanchedAlmond],[4278190335,37,G.Named.Blue],[4287245282,38,G.Named.BlueViolet],[4289014314,39,G.Named.Brown],[4292786311,40,G.Named.BurlyWood],[4284456608,41,G.Named.CadetBlue],[4286578432,42,G.Named.Chartreuse],[4291979550,43,G.Named.Chocolate],[4294934352,44,G.Named.Coral],[4284782061,45,G.Named.CornflowerBlue],[4294965468,46,G.Named.Cornsilk],[4292613180,47,G.Named.Crimson],[4278255615,48,G.Named.Cyan],[4278190219,49,G.Named.DkBlue],[4278225803,50,G.Named.DkCyan],[4290283019,51,G.Named.DkGoldenrod],[4289309097,52,G.Named.DkGray],[4278215680,53,G.Named.DkGreen],[4290623339,54,G.Named.DkKhaki],[4287299723,55,G.Named.DkMagenta],[4283788079,56,G.Named.DkOliveGreen],[4294937600,57,G.Named.DkOrange],[4288230092,58,G.Named.DkOrchid],[4287299584,59,G.Named.DkRed],[4293498490,60,G.Named.DkSalmon],[4287609995,61,G.Named.DkSeaGreen],[4282924427,62,G.Named.DkSlateBlue],[4281290575,63,G.Named.DkSlateGray],[4278243025,64,G.Named.DkTurquoise],[4287889619,65,G.Named.DkViolet],[4294907027,66,G.Named.DeepPink],[4278239231,67,G.Named.DeepSkyBlue],[4285098345,68,G.Named.DimGray],[4280193279,69,G.Named.DodgerBlue],[4289864226,70,G.Named.Firebrick],[4294966e3,71,G.Named.FloralWhite],[4280453922,72,G.Named.ForestGreen],[4294902015,73,G.Named.Fuchsia],[4292664540,74,G.Named.Gainsboro],[4294506751,75,G.Named.GhostWhite],[4294956800,76,G.Named.Gold],[4292519200,77,G.Named.Goldenrod],[4286611584,78,G.Named.Gray],[4278222848,79,G.Named.Green],[4289593135,80,G.Named.GreenYellow],[4293984240,81,G.Named.Honeydew],[4294928820,82,G.Named.HotPink],[4291648604,83,G.Named.IndianRed],[4283105410,84,G.Named.Indigo],[4294967280,85,G.Named.Ivory],[4293977740,86,G.Named.Khaki],[4293322490,87,G.Named.Lavender],[4294963445,88,G.Named.LavenderBlush],[4286381056,89,G.Named.LawnGreen],[4294965965,90,G.Named.LemonChiffon],[4289583334,91,G.Named.LtBlue],[4293951616,92,G.Named.LtCoral],[4292935679,93,G.Named.LtCyan],[4294638200,94,G.Named.LtGoldenrodYellow],[4292072403,95,G.Named.LtGray],[4287688336,96,G.Named.LtGreen],[4294948545,97,G.Named.LtPink],[4294942842,98,G.Named.LtSalmon],[4280332970,99,G.Named.LtSeaGreen],[4287090426,100,G.Named.LtSkyBlue],[4286023833,101,G.Named.LtSlateGray],[4289774814,102,G.Named.LtSteelBlue],[4294967264,103,G.Named.LtYellow],[4278255360,104,G.Named.Lime],[4281519410,105,G.Named.LimeGreen],[4294635750,106,G.Named.Linen],[4294902015,107,G.Named.Magenta],[4286578688,108,G.Named.Maroon],[4284927402,109,G.Named.MedAquamarine],[4278190285,110,G.Named.MedBlue],[4290401747,111,G.Named.MedOrchid],[4287852763,112,G.Named.MedPurple],[4282168177,113,G.Named.MedSeaGreen],[4286277870,114,G.Named.MedSlateBlue],[4278254234,115,G.Named.MedSpringGreen],[4282962380,116,G.Named.MedTurquoise],[4291237253,117,G.Named.MedVioletRed],[4279834992,118,G.Named.MidnightBlue],[4294311930,119,G.Named.MintCream],[4294960353,120,G.Named.MistyRose],[4294960309,121,G.Named.Moccasin],[4294958765,122,G.Named.NavajoWhite],[4278190208,123,G.Named.Navy],[4294833638,124,G.Named.OldLace],[4286611456,125,G.Named.Olive],[4285238819,126,G.Named.OliveDrab],[4294944e3,127,G.Named.Orange],[4294919424,128,G.Named.OrangeRed],[4292505814,129,G.Named.Orchid],[4293847210,130,G.Named.PaleGoldenrod],[4288215960,131,G.Named.PaleGreen],[4289720046,132,G.Named.PaleTurquoise],[4292571283,133,G.Named.PaleVioletRed],[4294963157,134,G.Named.PapayaWhip],[4294957753,135,G.Named.PeachPuff],[4291659071,136,G.Named.Peru],[4294951115,137,G.Named.Pink],[4292714717,138,G.Named.Plum],[4289781990,139,G.Named.PowderBlue],[4286578816,140,G.Named.Purple],[4294901760,141,G.Named.Red],[4290547599,142,G.Named.RosyBrown],[4282477025,143,G.Named.RoyalBlue],[4287317267,144,G.Named.SaddleBrown],[4294606962,145,G.Named.Salmon],[4294222944,146,G.Named.SandyBrown],[4281240407,147,G.Named.SeaGreen],[4294964718,148,G.Named.SeaShell],[4288696877,149,G.Named.Sienna],[4290822336,150,G.Named.Silver],[4287090411,151,G.Named.SkyBlue],[4285160141,152,G.Named.SlateBlue],[4285563024,153,G.Named.SlateGray],[4294966010,154,G.Named.Snow],[4278255487,155,G.Named.SpringGreen],[4282811060,156,G.Named.SteelBlue],[4291998860,157,G.Named.Tan],[4278222976,158,G.Named.Teal],[4292394968,159,G.Named.Thistle],[4294927175,160,G.Named.Tomato],[4282441936,161,G.Named.Turquoise],[4293821166,162,G.Named.Violet],[4294303411,163,G.Named.Wheat],[4294967295,164,G.Named.White],[4294309365,165,G.Named.WhiteSmoke],[4294967040,166,G.Named.Yellow],[4288335154,167,G.Named.YellowGreen],[4293980400,168,G.Named.ButtonFace],[4294967295,169,G.Named.ButtonHighlight],[4288716960,170,G.Named.ButtonShadow],[4290367978,171,G.Named.GradientActiveCaption],[4292338930,172,G.Named.GradientInactiveCaption],[4293980400,173,G.Named.MenuBar],[4281571839,174,G.Named.MenuHighlight]],Gy=new class{constructor(){this._lookupByName=new Map;for(let s=0;s<Mg.length;s++){const e=Mg[s],t=e[0],n=(t>>24&255)/255,r=t>>16&255,o=t>>8&255,i=255&t,l={id:e[1],name:e[2],rgbaColor:{r,g:o,b:i,a:n},system:e.length>3};this._lookupByName.set(l.name.toLowerCase(),l)}}valueOfName(s){return this._lookupByName.get(s?s.toLowerCase():"transparent")}},Jc=[{scheme:G.Scheme.Tx1,description:"First Text Color"},{scheme:G.Scheme.Tx2,description:"Second Text Color"},{scheme:G.Scheme.Bg1,description:"First Background Color"},{scheme:G.Scheme.Bg2,description:"Second Background Color"},{scheme:G.Scheme.Accent1,description:"Accent 1"},{scheme:G.Scheme.Accent2,description:"Accent 2"},{scheme:G.Scheme.Accent3,description:"Accent 3"},{scheme:G.Scheme.Accent4,description:"Accent 4"},{scheme:G.Scheme.Accent5,description:"Accent 5"},{scheme:G.Scheme.Accent6,description:"Accent 6"},{scheme:G.Scheme.Hlink,description:"Hyperlink"},{scheme:G.Scheme.FolHlink,description:"Followed Hyperlink"},{scheme:"dk1",description:"Text/Background - Dark 1"},{scheme:"lt1",description:"Text/Background - Light 1"},{scheme:"dk2",description:"Text/Background - Dark 2"},{scheme:"lt2",description:"Text/Background - Light 2"}],F0=new Map;for(let s=0;s<Jc.length;s++)F0.set(Jc[s].scheme.toLowerCase(),Jc[s]);const Tg=s=>s?{srgb:[s.red/255,s.green/255,s.blue/255],alpha:s.alpha!==void 0?s.alpha:1}:null,kg=function(s,e,t,n){let r=Tg((c=>{let u=Gy.valueOfName(c);return u?new Tr.RGBA(u.rgbaColor.r,u.rgbaColor.g,u.rgbaColor.b,u.rgbaColor.a):null})(s)),o=null,i=null,l=null;if(r===null&&(a=s,F0.get(a.toLowerCase()))){if(!e)throw new Error("a scheme val was used but a schemeLookup was not provided");o=s,i=e(o),r=Tg(i),l=G.Type.Scheme}var a;if(r===null){let c=s.match(J_)||s.match(K_);if(c){let u,d=1;c.length===4?u=[parseInt(c[1],16),parseInt(c[2],16),parseInt(c[3],16)]:(u=[parseInt(c[2],16),parseInt(c[3],16),parseInt(c[4],16)],d=us(parseInt(c[1],16)/255)),u=Bc(u),u=mn(u),r={srgb:u,alpha:d},l=G.Type.Hex}}if(r===null){let c=s.match(V_)||s.match(W_);if(c){let u=Lc(c[1],c[2],c[3]);u=Bc(u),u=mn(u),r={srgb:u,alpha:c[4]?us(parseFloat(c[4])):1},l=G.Type.RGB}}if(r===null){let c=s.match(j_)||s.match(G_);if(c){let u=Lc(c[1],c[2],c[3]);u=Bc(u,100),u=Oo(u),u=mn(u),r={srgb:u,alpha:c[4]?us(parseFloat(c[4])):1},l=G.Type.LRGB}}if(r===null){let c=s.match(U_)||s.match(q_);if(c){let u=Lc(c[1],c[2],c[3]);u=Do(u),u=mn(u),r={srgb:u,alpha:c[4]?us(parseFloat(c[4])):1},l=G.Type.HSL}}if(r===null){let c=s.match(X_);if(c){const u=parseInt(c[1]);let d=t?.(u)??ka(u);d&&(r={srgb:[d.red/255,d.green/255,d.blue/255],alpha:d.alpha},l=G.Type.Index)}}if(r===null)throw new Error("Not a valid color format: "+s);return{srgbAlpha:r,key:o,color:i,type:l}},id=new Map,Kc=Object.keys(G.AdjustmentType);for(let s=0;s<Kc.length;s++)id.set(G.AdjustmentType[Kc[s]].toLowerCase(),G.AdjustmentType[Kc[s]]);const Ng=new RegExp("\\s+\\s*(?![^()]*\\))|,\\s*(?![^()]*\\))"),Fg=new RegExp("\\s*[,]\\s*|\\s+");let Xc=null;const Og={[G.Scheme.Bg1]:"window",[G.Scheme.Bg2]:"E7E6E6",[G.Scheme.Tx1]:"windowText",[G.Scheme.Tx2]:"44546A",[G.Scheme.Accent1]:"4472C4",[G.Scheme.Accent2]:"ED7D31",[G.Scheme.Accent3]:"A5A5A5",[G.Scheme.Accent4]:"FFC000",[G.Scheme.Accent5]:"5B9BD5",[G.Scheme.Accent6]:"70AD47",[G.Scheme.Hlink]:"0563C1",[G.Scheme.FolHlink]:"954F72"};class $t{constructor(e,t,n,r=null){let o=null,i=null;if(e instanceof $t)o=e.getVal(),e.getAdjustments()&&(i=[...e.getAdjustments()]);else if(typeof e=="string"){const l=this._parse(e);o=l.val,i=l.adjs}else e?.val&&(o=e.val,i=e.adjs);if(!o)throw new Error("Unable to determine color value");this._private={val:o,adjs:i,schemeLookup:t,indexedLookup:n,parsedVal:kg(o,t,n),adjusted:null,resolved:null}}_parse(e){let t=null,n=e.toLowerCase().trim();const r=n.split(Ng);if(r&&(t=r[0],n=n.substring(t.length,n.length).trim()),!t)throw new Error("no color key found");const o=[],i=n.split(Fg);for(let l=0;l<i.length;l++){const a=i[l];if(!a)continue;const c=id.get(a.toLowerCase());if(!c)throw new Error("Invalid adjustment type:"+a);let u=null;if(!(c===G.AdjustmentType.Gray||c===G.AdjustmentType.Comp||c===G.AdjustmentType.Inv||c===G.AdjustmentType.Gamma||c===G.AdjustmentType.InvGamma)){l++;const d=i[l];if(u=parseFloat(d),u==null)throw new Error(`Invalid adjustment value: missing value for'${a}'`);if(isNaN(u))throw new Error("Invalid adjustment value:"+d)}o.push({[c]:u})}return{val:t,adjs:o}}_forceDark(e=!0){this._resolve();const t=this._private.resolved;let n=[t.red,t.green,t.blue];n=((l,a)=>{a=(a%360+360)%360;const c=[1,0,0,0,1,0,0,0,1],u=Math.cos(a*Math.PI/180),d=Math.sin(a*Math.PI/180);c[0]=Jo+.7874*u-Jo*d,c[1]=Gr-Gr*u-Gr*d,c[2]=Ko-Ko*u+.9278*d,c[3]=Jo-Jo*u+.143*d,c[4]=Gr+(1-Gr)*u+.14*d,c[5]=Ko-Ko*u-.283*d,c[6]=Jo-Jo*u-.7874*d,c[7]=Gr-Gr*u+Gr*d,c[8]=Ko+.9278*u+Ko*d;const h=p=>Math.round(Math.max(0,Math.min(255,p))),f=l[0],g=l[1],m=l[2];return[h(c[0]*f+c[1]*g+c[2]*m),h(c[3]*f+c[4]*g+c[5]*m),h(c[6]*f+c[7]*g+c[8]*m)]})(n,180),n=Zh(n,!1);let r=Mo(n);const o=io(r);if(o[Us]=.95*o[Us],r=Do(o),n=Oo(r),n=Xh(n),n=mn(n,!1),e)return new Tr.RGBA(n[0],n[1],n[2],t.alpha);const i=io(Mo(n));return new Tr.HSLA(i[0],i[1],i[2],t.alpha)}_resolve(){if(this._private.resolved){if(!this._private.parsedVal.key)return;let o=this._private.schemeLookup(this._private.parsedVal.key);if(o===this._private.parsedVal.color||o?.isEqual(this._private.parsedVal.color))return}const e=kg(this._private.val,this._private.schemeLookup,this._private.indexedLookup,this._private.last);let t=((o,i)=>{let l=[...o.srgb],a=o.alpha!==void 0?o.alpha:1;for(var c=0;i&&c<i.length;c++){const u=i[c],d=Object.keys(u)[0],h=u[d];d===G.AdjustmentType.Alpha?(a=h/100,a=Math.max(0,Math.min(1,a))):d===G.AdjustmentType.AlphaOff?(a+=h/100,a=Math.max(0,Math.min(1,a))):d===G.AdjustmentType.AlphaMod?(a*=h/100,a=Math.max(0,Math.min(1,a))):d===G.AdjustmentType.Hue?l=Hc(fn,l,h):d===G.AdjustmentType.Sat?l=Hc(Pc,l,h):d===G.AdjustmentType.Lum?l=Hc(Us,l,h):d===G.AdjustmentType.HueOff?l=$c(fn,l,h):d===G.AdjustmentType.SatOff?l=$c(Pc,l,h):d===G.AdjustmentType.LumOff?l=$c(Us,l,h):d===G.AdjustmentType.HueMod?l=Vc(fn,l,h):d===G.AdjustmentType.SatMod?l=Vc(Pc,l,h):d===G.AdjustmentType.LumMod?l=Vc(Us,l,h):d===G.AdjustmentType.Red?l=vr(Ql,l,h,na):d===G.AdjustmentType.Green?l=vr(ea,l,h,na):d===G.AdjustmentType.Blue?l=vr(ta,l,h,na):d===G.AdjustmentType.RedOff?l=vr(Ql,l,h,ra):d===G.AdjustmentType.GreenOff?l=vr(ea,l,h,ra):d===G.AdjustmentType.BlueOff?l=vr(ta,l,h,ra):d===G.AdjustmentType.RedMod?l=vr(Ql,l,h,oa):d===G.AdjustmentType.GreenMod?l=vr(ea,l,h,oa):d===G.AdjustmentType.BlueMod?l=vr(ta,l,h,oa):d===G.AdjustmentType.Shade?l=Z_(l,h):d===G.AdjustmentType.Tint?l=Q_(l,h):d===G.AdjustmentType.ETint?l=Y_(l,h):d===G.AdjustmentType.Gray?l=ey(l):d===G.AdjustmentType.Comp?l=ty(l):d===G.AdjustmentType.Inv?l=Zh(l,h):d===G.AdjustmentType.Gamma?l=ny(l):d===G.AdjustmentType.InvGamma?l=ry(l):console.warn("unknown adjustmentType: "+d)}return{srgb:l,alpha:a}})(e.srgbAlpha,this._private.adjs),n=((o,i=255)=>{const l=[...o];for(var a=0;a<o.length;a++)l[a]=o[a]*i;return l})(t.srgb);n=Xh(n);let r=us(t.alpha);this._private.adjusted=t,this._private.parsedVal=e,this._private.resolved=new Tr.RGBA(n[0],n[1],n[2],r)}static parse(e,t,n,r=null){if(e instanceof $t)return e;const o=e;let i=null,l=o?.trim(),a=null;try{if(!i){const d=l?.split(Ng);d&&(i=d[0],l=l.substring(i.length,l.length).trim())}if(!i)throw new Error("no color found");const c=[],u=l.split(Fg);for(let d=0;d<u.length;d++){const h=u[d];if(!h)continue;const f=id.get(h.toLowerCase());if(!f)throw new Error("Invalid adjustment type:"+h);let g=null;if(!(f===G.AdjustmentType.Gray||f===G.AdjustmentType.Comp||f===G.AdjustmentType.Inv||f===G.AdjustmentType.Gamma||f===G.AdjustmentType.InvGamma)){d++;const m=u[d];if(g=parseFloat(m),g==null)throw new Error(`Invalid adjustment value: missing value for'${h}'`);if(isNaN(g))throw new Error("Invalid adjustment value:"+m)}c.push({[f]:g})}a=new $t({val:i,adjs:c},t,n,r)}catch(c){throw c}return a}static getDefaultSchemeLookup(){if(!Xc){const e=new Map,t=Object.keys(Og);for(let n=0;n<t.length;n++){const r=t[n];e.set(r.toLowerCase(),$t.parse(Og[r],null))}Xc=n=>e.get(n.toLowerCase())?.toRGBA()}return Xc}isEqual(e){return e instanceof $t&&this.toString().toLowerCase()===e.toString().toLowerCase()}getVal(){return this._private.val}getAdjustments(){return this._private.adjs}adjust(e){return new $t({val:this._private.val,adjs:this._private.adjs?this._private.adjs.concat(e):e},this._private.schemeLookup,this._private.indexedLookup,this._private.last)}getType(){return this._resolve(),this._private.parsedVal.type??null}toCSS(e=!1,t=!0){const n=e?this._forceDark():this.toRGBA();return n.alpha===0?"none":n.toString(t)}toRGBA(e=!1){return this._resolve(),e?this._forceDark():this._private.resolved}toHSLA(e=!1){if(this._resolve(),e)return this._forceDark(!1);let t=io(this._private.adjusted.srgb);return new Tr.HSLA(t[0],t[1],t[2],us(this._private.adjusted.alpha??1))}toHex(e=!1){this._resolve();const t=e?this._forceDark():this._private.resolved;return new Tr.HEX(t.red,t.green,t.blue,t.alpha??1)}toBlackOrWhite(e=!1,t=157){const n=this.toRGBA(e),r=.299*n.red+.587*n.green+.114*n.blue>t;return new $t(r?"#000000":"#FFFFFF",this._private.schemeLookup,this._private.indexedLookup,this._private.last)}get[Symbol.toStringTag](){return this.toString()}toString(){let e=this._private.val;const t=this._private.adjs;for(let n=0;t&&n<t.length;n++){const r=t[n];if(!r)continue;const o=Object.keys(r)[0];e+=" "+o;const i=r[o];typeof i=="number"&&(e+=" "+i),n<t.length-1&&(e+=",")}return e}get isIColor(){return!0}}var pe,Dg;(Dg=pe||(pe={})).StrokeStyle={None:"none",DashDot:"dashDot",MediumDashDot:"mediumDashDot",Dotted:"dotted",Hair:"hair",Thin:"thin",Medium:"medium",Thick:"thick",MediumDashDotDot:"mediumDashDotDot",DashDotDot:"dashDotDot",Dashed:"dashed",MediumDashed:"mediumDashed",SlantDashDot:"slantDashDot",Double:"double"},Dg.Edge={Left:"left",Top:"top",Right:"right",Bottom:"bottom",Horizontal:"horizontal",Vertical:"vertical",DiagonalUp:"diagonalUp",DiagonalDown:"diagonalDown"};const O0=[],D0=new Map,Lg=Object.freeze([[pe.StrokeStyle.Thin,"Thin",1,null],[pe.StrokeStyle.Hair,"Hair",1,[1,1]],[pe.StrokeStyle.Dotted,"Dotted",1,[2,2]],[pe.StrokeStyle.Dashed,"Dashed",1,[3,1]],[pe.StrokeStyle.DashDot,"Dash Dot",1,[3,3,9,3]],[pe.StrokeStyle.DashDotDot,"Dash Dot Dot",1,[3,3,3,3,9,3]],[pe.StrokeStyle.Double,"Double",3,null],[pe.StrokeStyle.Medium,"Medium",2,null],[pe.StrokeStyle.MediumDashed,"Medium Dashed",2,[9,3]],[pe.StrokeStyle.MediumDashDot,"Medium Dash Dot",2,[3,3,9,3]],[pe.StrokeStyle.MediumDashDotDot,"Medium Dash Dot Dot",2,[3,3,3,3,9,3]],[pe.StrokeStyle.SlantDashDot,"Slant Dash Dot",2,[5,1,11,1]],[pe.StrokeStyle.Thick,"Thick",3,null],[pe.StrokeStyle.None,"None",0,null]]);for(let s=0;s<Lg.length;s++){const e=Lg[s],t=e[0],n=Object.freeze({style:t,description:e[1],width:e[2],pattern:e[3]});O0.push(n),D0.set(t,n)}(s=>{s.isEqualStrokes=(e,t)=>!(e&&!t||t&&!e)&&(e===t||e.getStyle()===t.getStyle()&&e.getColor().isEqual(t.getColor())),s.oppositeEdge=e=>e===s.Edge.Left?s.Edge.Right:e===s.Edge.Right?s.Edge.Left:e===s.Edge.Top?s.Edge.Bottom:e===s.Edge.Bottom?s.Edge.Top:e,s.BuiltInDefinitionsArray=O0,s.BuiltInDefinitions=D0})(pe||(pe={}));const Uy={Text:"text",Repeat:"repeat",Spacing:"spacing"},Bg=s=>!(!s.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/)&&!s.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/)),qy=Object.freeze({formatValue:Ud,isFractionFormat:Bg,adjustDecimalPlaces:(s,e)=>{if(!s)return"";const t=(i,l)=>{let a=i||"";const c=a.length===0||a.endsWith(".")?"0":a.charAt(a.length-1);return l<0?(a=a.substring(0,Math.max(0,a.length+l)),a==="."&&(a="")):(a.startsWith(".")||(a+="."),a+=c.repeat(l)),a},n=(i,l)=>{if(i==="General")return l>0?"0"+t("",l):i;if(Bg(i))return i;let a=i,c=-1,u=-1,d=a.indexOf("E");if(d>=0&&(a=a.substring(0,d)),c=a.indexOf("."),c>=0){a=a.substring(c,a.length);let h=a&&a.match(/([.]{1}[0,#]+)/);if(!h)return i;a=h[1],u=c+a.length}else{if(l<=0)return i;c=a.lastIndexOf("0"),c<0&&(c=a.lastIndexOf("#")),c>=0&&(c+=1),u=c,a=""}return c===-1?i:(a=t(a,l),i.substring(0,c)+a+i.substring(u,i.length))},r=[];let o=ay(s);for(let i=0;i<o.length;i++)r.push(n(o[i].trim(),e));return r.join(";")}}),Jy=qt._table,Yd=s=>s===14?"Short Date":Jy[s]??null,qs=[{numberFormat:"General",formatType:st.General,primary:1},{numberFormat:"0",formatType:st.Number,regMatch:/^0[.]{0,1}[0]*$/,args:{decimalPlaces:0,separator:!1}},{numberFormat:"#,##0.00",formatType:st.Number,regMatch:/^#,##0[.]{0,1}[0]*$/,primary:2,args:{decimalPlaces:2,separator:!0}},{numberFormat:"#,##0_);(#,##0)",formatType:st.Number,args:{decimalPlaces:0,separator:!0}},{numberFormat:"#,##0_);[Red](#,##0)",formatType:st.Number,args:{decimalPlaces:0,separator:!0}},{numberFormat:"#,##0.00_);(#,##0.00)",formatType:st.Number,args:{decimalPlaces:2,separator:!0}},{numberFormat:"#,##0.00_);[Red](#,##0.00)",formatType:st.Number,args:{decimalPlaces:2,separator:!0}},{numberFormat:"$#,##0.00",formatType:st.Currency,primary:3,args:{decimalPlaces:2,currencySymbol:"$"}},{numberFormat:"$#,##0_);($#,##0)",formatType:st.Currency,args:{decimalPlaces:0,currencySymbol:"$"}},{numberFormat:"$#,##0_);[Red]($#,##0)",formatType:st.Currency,args:{decimalPlaces:0,currencySymbol:"$"}},{numberFormat:"$#,##0.00_);($#,##0.00)",formatType:st.Currency,args:{decimalPlaces:2,currencySymbol:"$"}},{numberFormat:"$#,##0.00_);[Red]($#,##0.00)",formatType:st.Currency,args:{decimalPlaces:2,currencySymbol:"$"}},{numberFormat:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)',primary:4,formatType:st.Accounting},{numberFormat:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)',formatType:st.Accounting},{numberFormat:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)',formatType:st.Accounting},{numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',formatType:st.Accounting},{numberFormat:"Short Date",formatType:st.ShortDate,primary:5},{numberFormat:"d-mmm-yy",formatType:st.MediumDate,primary:5.5},{numberFormat:"Long Date",formatType:st.LongDate,primary:6},{numberFormat:"h:mm",formatType:st.ShortTime,primary:7},{numberFormat:"h:mm AM/PM",formatType:st.MediumTime,primary:7.5},{numberFormat:"Long Time",formatType:st.LongTime,primary:8},{numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)',formatType:st.Comma,primary:9},{numberFormat:"0.00%",formatType:st.Percentage,primary:10,args:{decimalPlaces:2},regMatch:/^^[0#?]*[.]{0,1}[0#?]*%*$/},{numberFormat:"0%",formatType:st.Percentage,args:{decimalPlaces:0}},{numberFormat:"# ?/?",formatType:st.Fraction,primary:11},{numberFormat:"# ??/??",formatType:st.Fraction},{numberFormat:"0.00E+00",formatType:st.Scientific,primary:12,args:{decimalPlaces:2},regMatch:/^[0#?]*[.]{0,1}[0#?]*E\+[0#?]*$/},{numberFormat:"##0.0E+0",formatType:st.Custom,args:{decimalPlaces:0}},{numberFormat:"@",formatType:st.Text,primary:13},{numberFormat:"d-mmm",formatType:st.Custom},{numberFormat:"mmm-yy",formatType:st.Custom},{numberFormat:"h:mm:ss",formatType:st.Custom},{numberFormat:"m/d/yyyy h:mm",formatType:st.Custom},{numberFormat:"mm:ss",formatType:st.Custom},{numberFormat:"mm:ss.0",formatType:st.Custom},{numberFormat:"[h]:mm:ss",formatType:st.Custom}],Zc=[{numberFormat:"00000",formatType:st.Special,primary:11},{numberFormat:"00000-0000",formatType:st.Special},{numberFormat:"[<=9999999]###-####;(###) ###-####",formatType:st.Special},{numberFormat:"000-00-0000",formatType:st.Special}],Zi=new Map,wi=[];for(let s=0;s<qs.length;s++){let e=qs[s].numberFormat.toLowerCase();Zi.set(e,qs[s]),qs[s].regMatch&&wi.unshift(qs[s])}for(let s=0;s<Zc.length;s++){let e=Zc[s].numberFormat.toLowerCase();Zi.set(e,Zc[s])}const ld=[],L0=new Map;Zi.forEach(function(s,e,t){s.primary&&(ld.push(s),L0.set(V.textToKey(s.formatType),s.numberFormat))}),ld.sort(function(s,e){return s.primary-e.primary});const zg=Zi.get(st.General.toLowerCase());class Ky{lookupStyle(e){if(!e)return zg;if(typeof e=="number"&&(e=Yd(e)),!e.toLowerCase)return console.warn("Invalid numberFormat",e),zg;e=e.toLowerCase();let t=Zi.get(e);if(t)return t;for(let n=0;!t&&n<wi.length;n++)wi[n].regMatch&&e.match(wi[n].regMatch)&&(t=wi[n]);return t||{numberFormat:e,formatType:st.Custom}}lookupPrimary(){return ld}lookupDefault(e){return L0.get(V.textToKey(e))}}var Vt,yl,Qe,Pg;(yl=Vt||(Vt={})).Type=st,yl.Parser=qy,yl.Styles=new Ky,yl.ParseRunType=Uy,(Pg=Qe||(Qe={})).BuiltInName={Normal:"Normal",RowLevel:"RowLevel_#",ColLevel:"ColLevel_#",Comma:"Comma",Currency:"Currency",Percent:"Percent",Comma0:"Comma [0]",Currency0:"Currency [0]",Hyperlink:"Hyperlink",FollowedHyperlink:"Followed Hyperlink",Note:"Note",WarningText:"Warning Text",Unknown12:"??-12",Unknown13:"??-13",Unknown14:"??-14",Title:"Title",Heading1:"Heading 1",Heading2:"Heading 2",Heading3:"Heading 3",Heading4:"Heading 4",Input:"Input",Output:"Output",Calculation:"Calculation",CheckCell:"Check Cell",LinkedCell:"Linked Cell",Total:"Total",Good:"Good",Bad:"Bad",Neutral:"Neutral",Accent1:"Accent1",Accent1_20:"20% - Accent1",Accent1_40:"40% - Accent1",Accent1_60:"60% - Accent1",Accent2:"Accent2",Accent2_20:"20% - Accent2",Accent2_40:"40% - Accent2",Accent2_60:"60% - Accent2",Accent3:"Accent3",Accent3_20:"20% - Accent3",Accent3_40:"40% - Accent3",Accent3_60:"60% - Accent3",Accent4:"Accent4",Accent4_20:"20% - Accent4",Accent4_40:"40% - Accent4",Accent4_60:"60% - Accent4",Accent5:"Accent5",Accent5_20:"20% - Accent5",Accent5_40:"40% - Accent5",Accent5_60:"60% - Accent5",Accent6:"Accent6",Accent6_20:"20% - Accent6",Accent6_40:"40% - Accent6",Accent6_60:"60% - Accent6",ExplanatoryText:"Explanatory Text"},Pg.IconSet={Arrows3:"3Arrows",ArrowsGray3:"3ArrowsGray",Flags3:"3Flags",Signs3:"3Signs",Symbols3:"3Symbols",Symbols3_2:"3Symbols2",TrafficLights3:"3TrafficLights1",TrafficLights3_2:"3TrafficLights2",Arrows4:"4Arrows",ArrowsGray4:"4ArrowsGray",Rating4:"4Rating",RedToBlack4:"4RedToBlack",TrafficLights4:"4TrafficLights",Arrows5:"5Arrows",ArrowsGray5:"5ArrowsGray",Quarters5:"5Quarters",Rating5:"5Rating"};const Xy=(s,e,t,n,r)=>{const o=JSON.parse(JSON.stringify(s.definition));o.adjs||(o.adjs=[]);let i="",l=0,a=0;e>0?(a=e,l=100-e,i=`Lighter ${e}%`):e<0&&(l=100+e,i=`Darker ${-e}%`),l&&o.adjs.push({[G.AdjustmentType.LumMod]:l}),a&&o.adjs.push({[G.AdjustmentType.LumOff]:a});const c=new $t({val:o.val,adjs:o.adjs},t),u=c.toString();n?.set(u,c);const d=c.toRGBA().toString();return r?.set(d,c),{description:s.description+", "+i,definition:o}},Zy=(s,e,t,n)=>{let r=[];for(let o=0;o<s.length;o++){let i=[];r.push(i);const l=c=>{for(let u=0;u<c.length;u++)i.push(Xy(s[o],c[u],e,t,n))};let a=new $t({val:s[o].definition.val,adjs:s[o].definition.adjs},e).toHSLA().lum;l(a===0?[50,35,25,15,5]:a===100?[-5,-15,-25,-35,-50]:a<=20?[90,75,50,25,10]:a>=80?[-10,-25,-50,-75,-90]:[80,60,40,-25,-50])}return r};var Hg,xo;(Hg||(Hg={})).buildPalette=Zy,(xo||(xo={})).BuiltInFilterType={BuiltIn:"builtIn",All:"all",Custom:"custom"};const Yy=[["Office","windowText","window","0E2841","E8E8E8","156082","E97132","196B24","0F9ED5","A02B93","4EA72E","467886","96607D"],["Office 2013-2022","windowText","window","44546A","E7E6E6","4472C4","ED7D31","A5A5A5","FFC000","5B9BD5","70AD47","0563C1","954F72"],["Office 2007-2010","windowText","window","1F497D","EEECE1","4F81BD","C0504D","9BBB59","8064A2","4BACC6","F79646","0000FF","800080"],["Grayscale","windowText","window","000000","F8F8F8","DDDDDD","B2B2B2","969696","808080","5F5F5F","4D4D4D","5F5F5F","919191"],["Atlas","windowText","window","454545","E0E0E0","F81B02","FC7715","AFBF41","50C49F","3B95C4","B560D4","FC5A1A","B49E74"],["Banded","2C2C2C","FFFFFF","099BDD","F2F2F2","FFC000","A5D028","08CC78","F24099","828288","F56617","005DBA","6C606A"],["Basis","000000","FFFFFF","565349","DDDDDD","A6B727","DF5327","FE9E00","418AB3","D7D447","818183","F59E00","B2B2B2"],["Berlin","windowText","window","9D360E","E7E6E6","F09415","C1B56B","4BAF73","5AA6C0","D17DF9","FA7E5C","FFAE3E","FCC77E"],["Celestial","windowText","window","18276C","EBEBEB","AC3EC1","477BD1","46B298","90BA4C","DD9D31","E25247","C573D2","CCAEE8"],["Circuit","windowText","window","134770","82FFFF","9ACD4C","FAA93A","D35940","B258D3","63A0CC","8AC4A7","B8FA56","7AF8CC"],["Damask","windowText","window","2A5B7F","ABDAFC","9EC544","50BEA3","4A9CCC","9A66CA","C54F71","DE9C3C","6BA9DA","A0BCD3"],["Depth","windowText","window","455F51","94D7E4","41AEBD","97E9D5","A2CF49","608F3D","F4DE3A","FCB11C","FBCA98","D3B86D"],["Dividend","windowText","window","3D3D3D","EBEBEB","4D1434","903163","B2324B","969FA7","66B1CE","40619D","828282","A5A5A5"],["Droplet","windowText","window","355071","AABED7","2FA3EE","4BCAAD","86C157","D99C3F","CE6633","A35DD1","56BCFE","97C5E3"],["Facet","windowText","window","2C3C43","EBEBEB","90C226","54A021","E6B91E","E76618","C42F1A","918655","99CA3C","B9D181"],["Frame","000000","FFFFFF","545454","BFBFBF","40BAD2","FAB900","90BB23","EE7008","1AB39F","D5393D","90BB23","EE7008"],["Gallery","windowText","window","454545","DFDBD5","B71E42","DE478E","BC72F0","795FAF","586EA6","6892A0","FA2B5C","BC658E"],["Integral","windowText","window","335B74","DFE3E5","1CADE4","2683C6","27CED7","42BA97","3E8853","62A39F","6B9F25","B26B02"],["Ion Boardroom","windowText","window","3B3059","EBEBEB","B31166","E33D6F","E45F3C","E9943A","9B6BF2","D53DD0","8F8F8F","A5A5A5"],["Ion","windowText","window","1E5155","EBEBEB","B01513","EA6312","E6B729","6AAC90","54849A","9E5E9B","58C1BA","9DFFCB"],["Madison","windowText","window","1F2D29","C5FAEB","A1D68B","5EC795","4DADCF","CDB756","E29C36","8EC0C1","6D9D9B","6D8583"],["Main Event","windowText","window","424242","C8C8C8","B80E0F","A6987D","7F9A71","64969F","9B75B2","80737A","F21213","B6A394"],["Mesh","windowText","window","363D46","EBEBEB","6F6F6F","BFBFA5","DCD084","E7BF5F","E9A039","CF7133","F28943","F1B76C"],["Metropolitan","windowText","window","162F33","EAF0E0","50B4C8","A8B97F","9B9256","657689","7A855D","84AC9D","2370CD","877589"],["Organic","windowText","window","212121","DADADA","83992A","3C9770","44709D","A23C33","D97828","DEB340","A8BF4D","B4CA80"],["Parallax","windowText","window","212121","CDD0D1","30ACEC","80C34F","E29D3E","D64A3B","D64787","A666E1","3085ED","82B6F4"],["Parcel","000000","FFFFFF","4A5356","E8E3CE","F6A21D","9BAFB5","C96731","9CA383","87795D","A0988C","00B0F0","738F97"],["Quotable","windowText","window","212121","636363","00C6BB","6FEBA0","B6DF5E","EFB251","EF755F","ED515C","8F8F8F","A5A5A5"],["Retrospect","000000","window","637052","CCDDEA","E48312","BD582C","865640","9B8357","C2BC80","94A088","2998E3","8C8C8C"],["Savon","windowText","window","1485A4","E3DED1","1CADE4","2683C6","27CED7","42BA97","3E8853","62A39F","F49100","739D9B"],["Slate","windowText","window","212123","DADADA","BC451B","D3BA68","BB8640","AD9277","A55A43","AD9D7B","E98052","F4B69B"],["Slice","windowText","window","146194","76DBF4","052F61","A50E82","14967C","6A9E1F","E87D37","C62324","0D2E46","356A95"],["Vapor Trail","windowText","window","454545","DADADA","DF2E28","FE801A","E9BF35","81BB42","32C7A9","4A9BDC","F0532B","F38B53"],["View","000000","FFFFFF","46464A","D6D3CC","6F6F74","92A9B9","A7B789","B9A489","8D6374","9B7362","67AABF","ABAFA5"],["Wisp","windowText","window","766F54","E3EACF","A53010","DE7E18","9F8351","728653","92AA4C","6AAC91","FB4A18","FB9318"],["Wood Type","windowText","window","696464","E9E5DC","D34817","9B2D1F","A28E6A","956251","918485","855D5D","CC9900","96A9A9"]],Qy=[["Office","Calibri Light","Calibri"],["Office 2013-2022","Calibri Light","Calibri"],["Office 2007-2010","Calibri Light","Calibri"],["Grayscale","Calibri Light","Calibri"],["Atlas","Calibri Light","Rockwell"],["Banded","Corbel","Corbel"],["Basis","Corbel","Corbel"],["Berlin","Trebuchet MS","Trebuchet MS"],["Celestial","Calibri Light","Calibri"],["Circuit","Tw Cen MT","Tw Cen MT"],["Damask","Bookman Old Style","Rockwell"],["Depth","Corbel","Corbel"],["Madison","Arial","Arial"],["Main Event","Impact","Impact"],["Mesh","Century Gothic","Century Gothic"],["Metropolitan","Calibri Light","Calibri Light"],["Organic","Garamond","Garamond"],["Parallax","Corbel","Corbel"],["Parcel","Gill Sans MT","Gill Sans MT"],["Quotable","Century Gothic","Century Gothic"],["Retrospect","Calibri Light","Calibri"],["Savon","Century Gothic","Century Gothic"],["Slate","Calisto MT","Calisto MT"],["Slice","Century Gothic","Century Gothic"],["Vapor Trail","Century Gothic","Century Gothic"],["View","Century Schoolbook","Century Schoolbook"],["Wisp","Century Gothic","Century Gothic"],["Wood Type","Rockwell Condensed","Rockwell"]],e1=[["Office","Office","Office"],["2013-2022","Office 2013-2022","Office 2013-2022"],["Atlas","Atlas","Atlas"],["Banded","Banded","Banded"],["Basis","Basis","Basis"],["Berlin","Berlin","Berlin"],["Celestial","Celestial","Celestial"],["Circuit","Circuit","Circuit"],["Damask","Damask","Damask"],["Depth","Depth","Depth"],["Dividend","Dividend","Dividend"],["Droplet","Droplet","Droplet"],["Facet","Facet","Facet"],["Frame","Frame","Frame"],["Gallery","Gallery","Gallery"],["Grayscale","Grayscale","Grayscale"],["Integral","Integral","Integral"],["Ion Boardroom","Ion Boardroom","Ion Boardroom"],["Ion","Ion","Ion"],["Madison","Madison","Madison"],["Main Event","Main Event","Main Event"],["Mesh","Mesh","Mesh"],["Metropolitan","Metropolitan","Metropolitan"],["Organic","Organic","Organic"],["Parallax","Parallax","Parallax"],["Parcel","Parcel","Parcel"],["Quotable","Quotable","Quotable"],["Retrospect","Retrospect","Retrospect"],["Savon","Savon","Savon"],["Slate","Slate","Slate"],["Slice","Slice","Slice"],["Vapor Trail","Vapor Trail","Vapor Trail"],["View","View","View"],["Wisp","Wisp","Wisp"],["Wood Type","Wood Type","Wood Type"],["Office 2007-2010","Office 2007-2010","Office 2007-2010"]],Yc="Themes is readonly. To make modifications create a new DocsThemes instance.",$g={[G.Scheme.Bg1]:"lt1",[G.Scheme.Bg2]:"lt2",[G.Scheme.Tx1]:"dk1",[G.Scheme.Tx2]:"dk2",[G.Scheme.Accent1]:"accent1",[G.Scheme.Accent2]:"accent2",[G.Scheme.Accent3]:"accent3",[G.Scheme.Accent4]:"accent4",[G.Scheme.Accent5]:"accent5",[G.Scheme.Accent6]:"accent6",[G.Scheme.Hlink]:"hlink",[G.Scheme.FolHlink]:"folHlink"},xs="Office",ad=[xs,"Calibri Light","Calibri"],Es=["dk1","lt1","dk2","lt2","accent1","accent2","accent3","accent4","accent5","accent6","hlink","folHlink"],B0=s=>{const e={};for(let t=0;t<s.length;t++){const n=s[t],r=n[0],o={name:r};e[r]=o;for(let i=0;i<Es.length;i++){const l=Es[i],a=n[i+1];if(!a)continue;const c=$t.parse(a);a&&(o[l]=c.toString())}}return e},z0=s=>{const e={};for(let t=0;t<s.length;t++){const n=s[t],r=n[0],o={name:r};e[r]=o,o.majorFont=n[1]??ad[1],o.minorFont=n[2]??ad[2]}return e},t1=B0([[xs,"windowText","window","44546A","E7E6E6","4472C4","ED7D31","A5A5A5","FFC000","5B9BD5","70AD47","0563C1","954F72"]]),n1=z0([ad]),Pi=t1[xs],ss=n1[xs];let fr=null;const r1=new class{constructor(){this._colors={};for(let s=0;s<Es.length;s++){const e=Es[s],t=$t.parse(Pi[e]);this._colors[e]=t}}getName(){return Pi.name}getDk1(){return this._colors.dk1}getLt1(){return this._colors.lt1}getDk2(){return this._colors.dk2}getLt2(){return this._colors.lt2}getAccent1(){return this._colors.accent1}getAccent2(){return this._colors.accent2}getAccent3(){return this._colors.accent3}getAccent4(){return this._colors.accent4}getAccent5(){return this._colors.accent5}getAccent6(){return this._colors.accent6}getHlink(){return this._colors.hlink}getFolHlink(){return this._colors.folHlink}toJSON(){return null}};class o1{constructor(e,t=r1){this._delegate=t,this._fromJSON(e)}_fromJSON(e){if(this._overrides={},!e)return;const t=Object.keys(e);if(t.length!==0)for(let n=0;n<t.length;n++){const r=t[n];this._overrides[r]=r==="name"?e[r]:$t.parse(e[r])}}_value(e,t){return this._overrides&&this._overrides[e]!==null&&this._overrides[e]!==void 0?this._overrides[e]:this._delegate?.[t]?.()}getName(){return this._value("name","getName")}getDk1(){return this._value("dk1","getDk1")}getLt1(){return this._value("lt1","getLt1")}getDk2(){return this._value("dk2","getDk2")}getLt2(){return this._value("lt2","getLt2")}getAccent1(){return this._value("accent1","getAccent1")}getAccent2(){return this._value("accent2","getAccent2")}getAccent3(){return this._value("accent3","getAccent3")}getAccent4(){return this._value("accent4","getAccent4")}getAccent5(){return this._value("accent5","getAccent5")}getAccent6(){return this._value("accent6","getAccent6")}getHlink(){return this._value("hlink","getHlink")}getFolHlink(){return this._value("folHlink","getFolHlink")}toJSON(){const e=V.toSafeJSON(this._overrides),t=this.getName();return t&&(e.name=t),e}}const s1=new class{constructor(){this._colors={};for(let s=0;s<Es.length;s++){const e=Es[s],t=$t.parse(Pi[e]);this._colors[e]=t}}getName(){return ss.name}getMajorFont(){return ss.majorFont}getMinorFont(){return ss.minorFont}getMajorFallbacks(){return ss.majorFallbacks}getMinorFallbacks(){return ss.minorFallbacks}};class i1{constructor(e,t=s1){this._delegate=t,this._fromJSON(e)}_fromJSON(e){if(this._overrides={},!e)return;const t=Object.keys(e);if(t.length!==0)for(let n=0;n<t.length;n++){const r=t[n];this._overrides[r]=e[r]}}_value(e,t){return this._overrides&&this._overrides[e]!==null&&this._overrides[e]!==void 0?this._overrides[e]:this._delegate?.[t]?.()}getName(){return this._value("name","getName")}getMajorFont(){return this._value("majorFont","getMajorFont")}getMinorFont(){return this._value("minorFont","getMinorFont")}getMajorFallbacks(){return this._value("majorFallbacks","getMajorFallbacks")}getMinorFallbacks(){return this._value("minorFallbacks","getMinorFallbacks")}toJSON(){const e=V.toSafeJSON(this._overrides),t=this.getName();return t&&(e.name=t),e}}let cd=class{constructor(e,t=null,n=null){if(this._cacheColors=new Map,!t&&e?.name){const a=fr?fr.get(e.name.toLowerCase()):null;a&&(t=a)}if(!t&&fr&&(t=fr.get(xs.toLowerCase())),this._name=e?.name??t?.getName(),!this._name)throw new Error("Theme must have a name.");this._builtInID=n,this._delegate=t,this._colors=new o1(e?.colors,this._delegate?.getColorScheme()),this._fonts=new i1(e?.fonts,this._delegate?.getFontScheme());const r=$g,o={},i=Object.keys(r);for(let a=0;a<i.length;a++){const c=i[a];o[c]=`get${Cs(r[c])}`}o.dk1="getDk1",o.dk2="getDk2",o.lt1="getLt1",o.lt2="getLt2",o.folhlink="getFolHlink",this._colorMap=o;const l=this;this._schemeLookup=a=>{let c=l._cacheColors[a];if(c)return c;const u=l._colorMap[a];if(!u)throw new Error(`Invalid color scheme key: ${a}`);const d=l.getColorScheme();let h=d[u].bind(d)();return h||(h=Pi[$g[a]??a]),c=new $t(h).toRGBA(),l._cacheColors[a]=c,c}}get builtInID(){return this._builtInID??null}getName(){return this._name??this._delegate?.getName()??null}isCustom(){return this._builtInID!==null&&this._builtInID!==void 0}getColorScheme(){return this._colors}getFontScheme(){return this._fonts}schemeLookup(){return this._schemeLookup}parseColor(e){return $t.parse(e,this._schemeLookup)}toJSON(){const e={name:this.getName()},t=this._colors.toJSON();t&&(Object.keys(t).length>1||t.name&&t.name!==e.name)&&(e.colors=t);const n=this._fonts.toJSON();return n&&(Object.keys(n).length>1||n.name&&n.name!==e.name)&&(e.fonts=n),Object.keys(e).length===1&&e.name===xs?null:e}};const l1=()=>{if(fr)return fr;const s=((t,n,r)=>{const o=[];for(let i=0;i<t.length;i++){const l=t[i],a=l[0],c=n[l[1]]??Pi,u=r[l[2]]??ss;o.push({name:a,colors:c,fonts:u})}return o})(e1,B0(Yy),z0(Qy)),e=new Map;for(let t=0;t<s.length;t++){const n=new cd(s[t]),r=new cd(null,n,t+1);e.set(r.getName().toLowerCase(),r)}return fr=e,e};class Qd{constructor(e=null,t=!1){l1(),this._isReadOnly=t,this._customMap=new Map,this._defaultTheme=this.getByName("Office")}getDefaultTheme(){return this._defaultTheme}setDefaultTheme(e){if(this._isReadOnly)throw new Error(Yc);if(!e)throw new Error("Theme cannot be null.");const t=this.getDefaultTheme();return this.getByName(e.getName())||this.setCustomTheme(e),this._defaultTheme=e,t}getByName(e){return e=e.toLowerCase(),this._customMap.get(e)||(fr.get(e)??null)}getItems(e){const t=e?.type??xo.BuiltInFilterType.All,n=new Map;return t!==xo.BuiltInFilterType.BuiltIn&&t!==xo.BuiltInFilterType.All||fr.forEach((r,o)=>n.set(o,r)),t!==xo.BuiltInFilterType.Custom&&t!==xo.BuiltInFilterType.All||this._customMap.forEach((r,o)=>n.set(o,r)),e?.selected&&n.set(e.selected.getName().toLowerCase(),e.selected),(r=>{const o=[...r];return o.sort((i,l)=>V.isDefined(i.builtInID)&&!V.isDefined(l.builtInID)?1:!V.isDefined(i.builtInID)&&V.isDefined(l.builtInID)?-1:V.isDefined(i.builtInID)&&V.isDefined(l.builtInID)?i.builtInID-l.builtInID:i.getName().localeCompare(l.getName())),o})(Array.from(n.values()))}getCount(){return this._customMap.size+fr.size}setCustomTheme(e){if(this._isReadOnly)throw new Error(Yc);const t=e.getName().toLowerCase(),n=this._customMap.get(t);return this._customMap.set(t,e),n??null}deleteCustomTheme(e){if(this._isReadOnly)throw new Error(Yc);let t=null;t=typeof e=="string"?e.toLowerCase():e.getName().toLowerCase();const n=this._customMap.get(t);return this._customMap.delete(t),n??null}}var Ro,Ut;(Ro||(Ro={})).ElementType={WholeTable:"wholeTable",FirstColumnStripe:"firstColumnStripe",SecondColumnStripe:"secondColumnStripe",FirstRowStripe:"firstRowStripe",SecondRowStripe:"secondRowStripe",LastColumn:"lastColumn",FirstColumn:"firstColumn",HeaderRow:"headerRow",TotalRow:"totalRow",FirstHeaderCell:"firstHeaderCell",LastHeaderCell:"lastHeaderCell",FirstTotalCell:"firstTotalCell",LastTotalCell:"lastTotalCell"},(Ro||(Ro={})).Empty=class{constructor(s){this._normalStyle=s}getName(){return"None"}isShownInTableStyles(){return!1}isShownInPivotStyles(){return!1}getRanged(s){return null}getProperties(){return V.EmptyObject}isBuiltIn(){return!0}delete(){}toJSON(){return null}get isITableStyle(){return!0}},(Ut||(Ut={})).Type={Absolute:"absolute",OneCell:"oneCell",TwoCell:"twoCell"};const Kn="Model has been closed. No further operations are allowed.",Vg="Name is required";class wn{constructor(e,t){this._listeners=new Set,this._pending=null,this._listeners=new Set,this._transactions=t??new ir({transient:!0}),this._src=e;const n=this;this._transactionsRemoveListener=this._transactions?.addListener({onCommitEnd(r){const o=n._pending;if(!o)return;n._pending=null;const i=r.getId(),l=new Set;for(let a=0;a<o.length;a++){const c=o[a];c.commitId===i&&n._doNotify(c.listeners,c.removes,c.options,l)}}})}addListeners(e,t){const n=t?.transactional??this._transactions.isOpenTransaction(),r={listeners:e},o=this,i=()=>{if(!n)return void o._listeners.delete(r);const l=o._transactions.getState(o)?.listeners,a=new Set(l);a.delete(r);const c=o._transactions.beginCommit();try{c.updateState(o,{listeners:a}),c.commit({forceAmend:!0})}catch(u){throw c.rollback(),u}};if(r.remove=t?.once?i:null,n){const l=o._transactions.getState(o)?.listeners,a=new Set(l);a.add(r);const c=this._transactions.beginCommit();try{c.updateState(o,{listeners:a}),c.commit({forceAmend:!0})}catch(u){throw c.rollback(),u}}else o._listeners.add(r);return i}async _doNotify(e,t=null,n,r){const o=n?.source??this._src,i=[],l=n?.params;for(let c=0;c<e.length;c++){const u=e[c];r&&r.has(u)||(r?.add(u),i.push(u(o,l)))}let a=null;if(t&&(a=()=>{for(let c=0;c<t.length;c++)t[c]()}),n?.async)return new Promise(async(c,u)=>{try{const d=await Promise.all(i);a?.(),c(d)}catch(d){a?.(),u(d)}});a?.()}notify(e,t){let n=null,r=null;const o=d=>{d.forEach(h=>{const f=h.listeners[e];f&&(n||(n=[]),n.push(f),h.remove&&(r||(r=[]),r.push(h.remove)))})},i=t?.transactional??this._transactions.isOpenTransaction();if(i){const d=this._transactions.getState(this)?.listeners;d&&o(d)}const l=n,a=r;n=null,r=null,o(this._listeners);const c=n,u=r;if(n=null,r=null,i){if(l&&this._doNotify(l,a,t),c){let d=this._pending;return d||(this._pending=d=[]),d.push({commitId:this._transactions.getCurrentCommit().getId(),listeners:c,removes:u,options:t}),this._doNotify(c,a,t)}}else if(c)return this._doNotify(c,u,t)}close(){this._transactions.remove(this),this._transactionsRemoveListener()}}let Lo=class{constructor(e){this._emitter=null,this._closed=!1,this._options={...e};const t=this;this._transactions=this._options?.transactions??new ir({transient:!0}),this._emitter=new wn(this,this._transactions),this._updateState({isDeleted:!1}),e?.json&&this._fromJSON(e.json),this._options?.setContainerReadOnlyCallback?.(()=>{t._processOnContainerReadOnly()}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){t._processStateChange(n,r,o)},onRestoreOrRevert(n,r,o){t._processRestoreOrRevert(n,r,o)}}),this._processInit()}_fromJSON(e){}isReadOnly(){return this._options.isReadOnly?.()??!1}isDeleted(){return this._getState().isDeleted??!1}getType(){return this._options.type}get isIModel(){return!0}_processTransactionDone(e){}_getDescription(){return null}_getState(){if(this._closed)throw new Error(Kn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_getTransactions(){return this._transactions}_updateState(e,t,n){if(this._closed)throw new Error(Kn);if(!e)return;const r=this._beginCommit(t?.description);try{r.updateState(this,e);let o=!1;if(n)for(let i=0;i<n.length;i++){const l=n[i];o=o||l==="onAnyChange",this._emitter.notify(l)}!o&&n&&n.length>0&&this._emitter.notify("onAnyChange"),r.commit()}catch(o){throw r.rollback(),o}return this}_getEmitter(){return this._emitter}_processInit(){}_processStateChange(e,t,n){}_processRestoreOrRevert(e,t,n){this._emitter.notify("onInvalidated")}delete(e){if(this._getState().isDeleted)throw new Error("Model has been deleted.");this._options.deleteFromContainer&&this._options.deleteFromContainer?.(e),this._delete()}_delete(){const e=this._getDescription(),t="Delete",n=e?`${t} ${e}`:t,r=this._beginCommit(n);try{this._processDelete(),r.commit()}catch(o){throw r.rollback(),o}}_processOnContainerDeleted(){this._processDelete()}_processDelete(){this._updateState({isDeleted:!0},null,["onDelete"])}_processOnContainerReadOnly(){this._emitter.notify("onReadOnlyChange")}addListeners(e,t){return this._emitter.addListeners(e,t)}beginCommit(e){return this._beginCommit(e)}doBatch(e,t){const n=this;return this._transactions.doBatch(e,typeof t=="string"?{description:t}:t,r=>{n._processTransactionDone(r)})}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}};class P0 extends Lo{_fromJSON(e){const t={};if(t.name=e?.name??null,!t.name)throw new Error(Vg);t.comment=e?.comment??null,t.hidden=e?.hidden??!1,t.scope=e?.scope??null,this._updateState(t,{description:this._options.createDescription??"Create Item"+(t.name?` '${t.name}'`:"")})}_toJSON(){const e=this._getState(),t={name:e.name};return e.comment&&(t.comment=e.comment),e.hidden&&(t.hidden=e.hidden),e.hidden&&(t.hidden=e.hidden),t}getName(){return this._getState().name}setName(e,t){if(!e)throw new Error(Vg);return this._updateState({name:e},{description:`Update Named '${e}'`,...t})}getComment(){return this._getState().comment}setComment(e,t){return this._updateState({comment:e},{description:"Set Comment",...t})}isHidden(){return this._getState().hidden}getScope(){return this._getState().scope}get isINamed(){return!0}}var Wg,ms,Tn;(Wg||(Wg={})).SortOn={Value:"value",FillColor:"fillColor",FontColor:"fontColor",Icon:"icon"},(Tn=ms||(ms={})).CaseInsensitiveOptions={sensitivity:"base",numeric:!1},Tn.CaseSensitiveOptions={sensitivity:"case",numeric:!1},Tn.BooleanCollator=Object.freeze({type:Me.Boolean,compare:(s,e,t)=>s===!0?1:-1}),Tn.StringCollator=Object.freeze({type:Me.String,compare:(s,e,t)=>s.localeCompare(e,"en",t),defaultOptions:Tn.CaseInsensitiveOptions}),Tn.NumberCollator=Object.freeze({type:Me.Number,compare:(s,e,t)=>s<e?-1:1}),Tn.RichDataCollator=Object.freeze({type:Me.RichData,compare:(s,e,t)=>s.type.localeCompare(e.type,"en")}),Tn.DefaultRangeOptions=Object.freeze({hasHeader:!1,reverse:!1,includeHidden:!1,collatorOptions:Tn.CaseInsensitiveOptions,orientation:B.Orientation.Row,offset:0}),Tn.DefaultCollators=Object.freeze([Tn.BooleanCollator,Tn.StringCollator,Tn.NumberCollator,Tn.RichDataCollator]);const a1=(s,e,t,n)=>{let r;for(;!(r=s.next()).done;)try{e(r.value[1],r.value[0],t)}catch(o){if(typeof s.throw!="function")throw o;s.throw(o)}typeof s.return=="function"&&s.return()},H0=s=>{const e=s.next.bind(s),t={next:n=>{const r=e(n);return r.done?Ct:{done:r.done,value:r.value[1]}},[Symbol.iterator]:()=>t,...s.return&&{return:s.return.bind(s)},...s.throw&&{throw:s.throw.bind(s)}};return t},Js=s=>{if(!s||s.length===0)return null;let e=Number.MAX_SAFE_INTEGER,t=-1,n=null;return(r,o=!1)=>{if(r===e)return r;o!==!1&&(e=Number.MAX_SAFE_INTEGER),r!==e+(o?-1:1)&&(t=((l,a,c=!0)=>{if(!l||l.length===0)return null;let u,d=-1;return c?(d=V.findEqualOrGreater(l,a,h=>h.max),u=l[d]):(d=V.findEqualOrLesser(l,a,h=>h.min),u=l[d]),u?(c?a>u.max&&(d+=1,u=l[d]):a<u.min&&(d-=1,u=l[d]),u?d:-1):-1})(s,r,!o),n=s[t]);let i=r;if(o)for(;n&&i<=n.max;)i=n.min-1,n=s[--t];else for(;n&&i>=n.min;)i=n.max+1,n=s[++t];return e=i,i}},Ct=Object.freeze({done:!0,value:void 0}),Qt=Object.freeze({next:()=>Ct,[Symbol.iterator]:()=>Qt});var ps;Object.seal({done:!1,value:void 0}),(s=>{s.isList=t=>!!t&&!!t.isIList,s.isListLike=t=>!!t&&typeof t.length=="number"&&typeof t.at=="function",s.fromArray=(t,n,r,o)=>new e(t,n,r,o);class e{constructor(n,r,o,i){this.g=r,this.s=o;let l=n??i;if(o&&n&&!i){i=new Array(n.length);for(let a=0;a<n.length;a++){let c=n[a];i[a]=o(c,a)}l=i}this.a=l??V.EmptyArray,r&&(this.at=a=>{a<0&&(a=l.length+a);const c=l[a];if(c!==void 0)return r(c,a)})}at(n){const r=this.a;return n<0&&(n=r.length+n),r[n]}fromArray(n){return new e(n,this.g,this.s)}get length(){return this.a.length}get isIList(){return!0}}s.ArrayList=e})(ps||(ps={}));class Zn{constructor(e){if(this._s=null,this._r=null,this._l=0,e&&e.length>0){const t=ps.isList(e)&&!Array.isArray(e)?e:new ps.ArrayList(e);this._s=t,this._l=e.length}}at(e){const t=this._s;if(t)return t.at(e);const n=this._c;if(n&&n.min<=e&&n.max>=e){const l=n.value;return l.v.at(e-n.min+l.s)}const r=this._r,o=r[V.findEqualOrGreater(r,e,l=>l.max)];if(!o)return;const i=o.value;return this._c=o,i.v.at(e-o.min+i.s)}toArray(e=Number.MAX_SAFE_INTEGER){const t=[],n=this.entries(c1);let r=n.next();for(;!r.done&&t.length<e;)t.push(r.value[1]),r=n.next();return t}entries(e){const t=this.length;if(t===0)return Qt;let n,r,o,i=!0,l=0,a=t-1;if(e){i=!e.reverse;const f=e.bounds;f&&(l=Math.max(f.min??l,l),a=Math.min(f.max??a,a)),n=e.reuseResult??null,r=e.processSkip}const c=i?1:-1;let u=(i?l:a)-c;const d=this._s;if(d)o=f=>{if(!(f<l||f>a))return d.at(f)};else{const f=this._r;let g=i?0:f.length-1,m=f[g];const p=(w,S)=>{const b=w===g?m:f[w];if(b&&S>=b.min&&S<=b.max)return g=w,m=b,b};o=w=>{if(w<l||w>a)return;let S=p(g,w);if(S||(S=p(g+c,w)),!S){const v=V.findEqualOrGreater(f,w,y=>y.max);S=p(v,w)}if(!S)return;const b=S.value;return b.v.at(w-S.min+b.s)}}const h={next:f=>{let g,m=u+c;return f!==void 0&&(f<0&&(f=t+f),m=f),m<l||m>a||r&&(m=r(m,!i),m<l||m>a)?Ct:(g=o(m),u=m,n?(Si.done=!1,Si.value[0]=m,Si.value[1]=g,Si):{done:!1,value:[u,g]})},[Symbol.iterator]:()=>h};return h}slice(e,t=void 0){const n=this._r??jg(this._s);if(!n)return Qc;const r=this.length;if(e=Math.min(Math.max(0,e),r),(t=Math.min(Math.max(0,t??r),r))-e<=0)return Qc;if(e<=0&&t>=r)return this;const o=e,i=t-1;let l=[],a=0;for(let u=0;u<n.length;u++){let d=n[u];const h=d.max;if(o===0&&h<=i){l.push(d);continue}const f=d.min;if(f>i){u=n.length;continue}if(h<o){a=h+1;continue}const g=Math.max(0,o-f),m=Math.max(0,h-i),p=m+g,w=d.value;l.push({min:f-a,max:h-p-a,value:{s:w.s+g,e:w.e-m,v:w.v}}),a+=p}const c=new Zn;return c._r=l,c._l=i-o+1,c}concat(e){if(!e)return this;if(!ps.isListLike(e))throw new Error("Value must be IListLike");const t=this._l;if(t===0)return e.isIReadableList?e:e.length===0?Qc:new Zn(e);const n=e,r=e.length;if(r===0)return this;const o=this._r??jg(this._s),i=o.slice(0,o.length-1);let l=o[o.length-1],a=l?l.min:0,c=l?l.max:0,u=l?l.value:null,d=u?u.v:null,h=u?u.e-u.s:0;const f=p=>{const w=p.s,S=p.e,b=S-w;if(b+h<u1&&d&&d.fromArray){let _=p.v;const C=[],E=u.s,x=u.e;for(let I=E;I<=x;I++)C.push(d.at(I));for(let I=w;I<=S;I++)C.push(_.at(I));const R=d.fromArray(C);if(R)return _=R,h=_.length-1,u={s:0,e:h,v:_},l={min:a,max:a+h,value:u},c=a+h,void(d=_)}i.push(l);const v=c+1,y=v+b;l={min:v,max:y,value:p},a=v,c=y,u=l?l.value:null,d=u?u.v:null,h=u?u.e-u.s:0};if(e instanceof Zn){const p=e._s;if(p)f({s:0,e:p.length-1,v:p});else{const w=e._r;for(let S=0;S<w.length;S++)f(w[S].value)}}else f({s:0,e:r-1,v:n});i.push(l);const g=new Zn,m=t+r;return i.length===1&&i[0].min===0&&i[0].max===m-1?g._s=i[0].value.v:g._r=i,g._l=m,g}get length(){return this._l}[Symbol.iterator](){return H0(this.entries())}get isIReadableList(){return!0}get isIList(){return!0}get[Symbol.toStringTag](){return"[ImmutableList]"}toString(){const e=this.length;if(e===0)return"";let t="";for(let n=0;n<e;n++){n>0&&(t+=",");const r=this.at(n);t+=r==null?"":String(r)}return t}}const jg=s=>[{min:0,max:s.length-1,value:{s:0,e:s.length-1,v:s}}],Qc=new Zn,Si=Object.seal({done:!1,value:[-1,null]}),c1=Object.freeze({reverse:!1,bounds:{min:0,max:Number.MAX_SAFE_INTEGER},skipRuns:null,reuseResult:Si}),u1=4;var Oa;(s=>{const e=(n,r)=>{const o=n!==ct.Row;return r?(i,l)=>{if(i===l)return 0;const a=i[0],c=i[1],u=l[1];if(c===u)return a?-1:1;const d=l[0];let h=0,f=0;if(o?(h=a?c.colEnd:c.colStart,f=d?u.colEnd:u.colStart):(h=a?c.rowEnd:c.rowStart,f=d?u.rowEnd:u.rowStart),h===f&&a!==d)return a?-1:1;if(h!==f)return f-h;let g=0,m=0;if(o?(g=a?c.colStart:c.colEnd,m=d?u.colStart:u.colEnd):(g=a?c.rowStart:c.rowEnd,m=d?u.rowStart:u.rowEnd),g===m&&a!==d)return a?-1:1;if(g!==m)return m-g;const p=i[2]??0;return(l[2]??0)-p}:(i,l)=>{if(i===l)return 0;const a=i[0],c=i[1],u=l[1];if(c===u)return a?-1:1;const d=l[0];let h=0,f=0;if(o?(h=a?c.colStart:c.colEnd,f=d?u.colStart:u.colEnd):(h=a?c.rowStart:c.rowEnd,f=d?u.rowStart:u.rowEnd),h===f&&a!==d)return a?-1:1;if(h!==f)return h-f;let g=0,m=0;return o?(g=a?c.colEnd:c.colStart,m=d?u.colEnd:u.colStart):(g=a?c.rowEnd:c.rowStart,m=d?u.rowEnd:u.rowStart),g===m&&a!==d?a?-1:1:g!==m?g-m:(i[2]??0)-(l[2]??0)}};class t{constructor(r,o){if(this._isColumn=!0,this._isByCell=!1,this._isReverse=!1,this._cursor=null,this._reuse=null,this._localReuse={done:!1,value:[null,null]},this._eventsMajor=null,this._eventMajorIndex=0,this._majorStart=0,this._majorEnd=0,this._eventMinorPeek=null,this._minorStart=0,this._minorEnd=0,!r||r.length===0)return;let i=ct.Column,l=!1,a=!0,c=!1;o&&(i=o.orientation??ct.Column,this._isColumn=a=i!==ct.Row,this._isReverse=l=o.reverse??!1,this._isByCell=c=o.byCell??!1);const u=r.length,d=new Array(2*u);for(let m=0;m<u;m++){const p=r[m],w=[null,null];d[2*m]=[!0,p,m,w],d[2*m+1]=[!1,p,m,w]}d.sort(e(i,l)),this._eventsMajor=d;const h=d[0][1];this._majorStart=l?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER,this._majorEnd=a?l?h.colEnd+1:h.colStart-1:l?h.rowEnd+1:h.rowStart-1,this._eventsMinor=new mt(null,e(a?ct.Row:ct.Column,l));const f=new Array(16);f.length=0,this._cursor={cell:null,range:{colStart:h.colStart,rowStart:h.rowStart,colEnd:h.colEnd,rowEnd:h.rowEnd},overlaps:f},c&&(this._cursor.cell={colIndex:l?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,rowIndex:l?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER});const g=o?.reuseIterator;g&&(this._reuse=g,g.value=this._cursor)}next(r){const o=this._isColumn,i=this._isReverse;if(r){if(!this._isByCell)throw new Error("nextCell is only supported when byCell is true");const x=J.createCellComparator(o?ct.Column:ct.Row,i);let R;do{const I=this._cursor,A=I.cell;if(A.colIndex!==Number.MAX_SAFE_INTEGER&&x(A,r)>=0)throw new Error("nextCell must be after the current iteration cell");if(R=this.next(),R.done)return R;const M=R.value.cell;if(x(M,r)>=0)return R;const k=I.range;if(o){const F=r.colIndex===A.colIndex;A.rowIndex=i?F?Math.max(r.rowIndex,k.rowStart):k.rowStart:F?Math.min(r.rowIndex,k.rowEnd):k.rowEnd}else{const F=r.rowIndex===A.rowIndex;A.colIndex=i?F?Math.max(r.colIndex,k.colStart):k.colStart:F?Math.min(r.colIndex,k.colEnd):k.colEnd}if(x(A,r)>=0)return M.rowIndex=A.rowIndex,M.colIndex=A.colIndex,R}while(!R.done);return R}let l=this._cursor;if(!l)return Ct;let a=this._reuse;if(!a){const x=l.cell,R=l.range,I={cell:null,range:{colStart:R.colStart,rowStart:R.rowStart,colEnd:R.colEnd,rowEnd:R.rowEnd},overlaps:[...l.overlaps]};x&&(I.cell={colIndex:x.colIndex,rowIndex:x.rowIndex}),this._cursor=I,a={done:!1,value:I}}const c=a.value,u=c.range,d=c.cell,h=this._isByCell,f=i?-1:1;let g=!1;if(h){const x=d.rowIndex,R=d.colIndex,I=o?x:R,A=o?i?u.rowStart:u.rowEnd:i?u.colStart:u.colEnd;if((i?I>=A:I<=A)&&(o?d.rowIndex=x+f:d.colIndex=R+f,i?I>A:I<A))return a;const M=o?d.colIndex:d.rowIndex,k=o?i?u.colStart:u.colEnd:i?u.rowStart:u.rowEnd;(i?M>k:M<k)&&(g=!0)}const m=c.overlaps;let p=this._majorStart,w=this._majorEnd,S=this._eventsMinor,b=this._minorStart,v=this._minorEnd,y=this._eventsMinorIterator,_=this._eventMinorPeek,C=_;for(;C&&!C.done;){const x=C.value[0];if(x[0])C=null;else{if(_=y.next(),_.done)m.length=0;else{const R=x[1];let I=m.length;if(I>1){const A=m.indexOf(R);A!==-1&&(m[A]=m[I-1])}if(m.length=I-1,I=m.length,I>0){const A=_.value[0],M=A[1],k=o?i?M.colStart:M.colEnd:i?M.rowStart:M.rowEnd;if(i?p>=k:p<=k){let F=!1;if(A[0]){const L=o?i?M.rowEnd:M.rowStart:i?M.colEnd:M.colStart;(i?L<v+f:L>v+f)&&(b=v+f,v=L-f,F=!0)}else{const L=o?i?M.rowStart:M.rowEnd:i?M.colStart:M.colEnd;(i?L<v:L>v)&&(b=v+f,v=L,F=!0)}if(F)return o?(u.rowStart=i?v:b,u.rowEnd=i?b:v):(u.colStart=i?v:b,u.colEnd=i?b:v),this._minorStart=b,this._minorEnd=v,this._eventMinorPeek=_,a}}}_.done&&(_=null),C=_}}if(!_)if(g){y=S.entries(void 0,this._localReuse),_=y.next(),this._eventsMinorIterator=y;const x=_.value[0][1],R=o?i?x.rowEnd:x.rowStart:i?x.colEnd:x.colStart;o?(d.colIndex=d.colIndex+f,d.rowIndex=R):(d.colIndex=R,d.rowIndex=d.rowIndex+f)}else{let x=this._eventMajorIndex;const R=this._eventsMajor,I=R.length;if(x>=I)return this._cursor=null,Ct;let A=R[x],M=A[0],k=!1;for(;!M&&!k&&A;){const L=A[1],N=o?i?L.colStart:L.colEnd:i?L.rowStart:L.rowEnd;if(i?N<w:N>w){k=!0;continue}const D=A[3];S.delete(D[0]),S.delete(D[1]),x++,A=R[x],A&&(M=A[0])}let F=S.size>0?w+f:-1;for(k=!1;M&&!k&&A;){const L=A[1];if(F!==-1&&(o?i?L.colEnd:L.colStart:i?L.rowEnd:L.rowStart)!==F){k=!0;continue}const N=A[2],D=[!0,L,N],O=[!1,L,N],H=A[3];if(H[0]=D,H[1]=O,S.set(D,0),S.set(O,0),F===-1&&(F=o?i?L.colEnd:L.colStart:i?L.rowEnd:L.rowStart),x++,A=R[x],!A||(M=A[0],!M))continue;const z=A[1];(o?i?z.colEnd:z.colStart:i?z.rowEnd:z.rowStart)!==F&&(k=!0)}if(F!==-1&&(p=F),h&&(o?d.colIndex=p:d.rowIndex=p),this._eventMajorIndex=x,x>=I)return this._eventsMinorIterator=y,this._cursor=null,Ct;if(A){const L=A[0],N=A[1],D=o?i?N.colEnd:N.colStart:i?N.rowEnd:N.rowStart,O=o?i?N.colStart:N.colEnd:i?N.rowStart:N.rowEnd;w=L?D-f:O}m.length=0,y=S.entries(void 0,this._localReuse),_=y.next(),this._eventsMinorIterator=y}let E=_;do{const x=E.value;E=null;const R=x[0],I=R[1];if(!R[0])continue;const A=o?i?I.rowEnd:I.rowStart:i?I.colEnd:I.colStart;b!==A&&(b=A),_=y.next();const M=_.value[0],k=M[0],F=M[1],L=o?i?F.rowEnd:F.rowStart:i?F.colEnd:F.colStart;if(k&&L===b)E=_;else{const N=o?i?I.rowStart:I.rowEnd:i?I.colStart:I.colEnd,D=o?i?F.rowStart:F.rowEnd:i?F.colStart:F.colEnd;v=(i?Math.max:Math.min)(N,k?L-f:D),h&&(o?d.rowIndex=b:d.colIndex=b)}m[m.length]=Object.freeze(I)}while(E);return o?(u.colStart=i?w:p,u.colEnd=i?p:w,u.rowStart=i?v:b,u.rowEnd=i?b:v):(u.rowStart=i?w:p,u.rowEnd=i?p:w,u.colStart=i?v:b,u.colEnd=i?b:v),this._eventMinorPeek=_,this._minorStart=b,this._minorEnd=v,this._majorStart=p,this._majorEnd=w,a}return(r){return null}throw(r){return null}[Symbol.iterator](){return this}}s.IteratorInstance=t})(Oa||(Oa={}));const Xr=(s,e=Ot.Right,t=null)=>{if(!s)return s;if(s.length===0)return[];const n=e===Ot.Right,r=e===Ot.Left,o=e===Ot.Up,i=e===Ot.Down;return s.sort((l,a)=>{if(!l&&!a)return 0;if(l&&!a)return-1;if(a&&!l)return 1;const c=t?.(l,a)??0;return c!==0?c:n?l.rowStart===a.rowStart?l.colStart-a.colStart:l.rowStart-a.rowStart:i?l.colStart===a.colStart?l.rowStart-a.rowStart:l.colStart-a.colStart:r?l.rowStart===a.rowStart?a.colStart-l.colStart:a.rowStart-l.rowStart:o?l.colStart===a.colStart?a.rowStart-l.rowStart:a.colStart-l.colStart:0})},d1=(s,e)=>{const t=e.min,n=s.min;if(e.max===Number.MAX_SAFE_INTEGER){const r=t,o=s.max;return n<=r&&r<=o?0:o<r?-1:n>r?1:(console.warn("coords are not inserted correctly",s,e),0)}return n-t};let Mi=class ud{constructor(e){this._runs=null,this._dataCoords=null,this._count=0,this._length=0,this._maxCoords=null,this._options=e,e?.maxCoords&&(this._maxCoords=Object.freeze({...e.maxCoords})),this._runs=new mt(void 0,d1,e?.nodeSize),this._reuseRunsIterator={done:!1,value:[null,null]},this._reuseRunsEntry=[null,null]}_validateBounds(e=Number.MIN_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER){const n=this._maxCoords,r=n?.min??Number.MIN_SAFE_INTEGER,o=n?.max??Number.MAX_SAFE_INTEGER;if(e<r||t>o)throw new Nt}entries(e){let t,n,r=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,i=!0;e&&(e?.bounds&&(r=e.bounds?.min??Number.MIN_SAFE_INTEGER,o=e.bounds?.max??Number.MAX_SAFE_INTEGER,this._validateBounds(r,o)),i=!e.reverse,t=h1(e.reuseResult),n=e.processSkip);const l=this._dataCoords;if(!l)return Qt;r=Math.max(l.min,r),o=Math.min(l.max,o);let a=null,c=null,u=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER;if(n){const p=n;n=(w,S)=>p(w+u,S)-u}const h=p=>{let w;p!==Number.MIN_SAFE_INTEGER&&p!==Number.MAX_SAFE_INTEGER&&(Vn.min=p,w=Vn),a=i?this._runs.entries(w,this._reuseRunsIterator):this._runs.entriesReversed(w,this._reuseRunsIterator),u=Number.MAX_SAFE_INTEGER,d=Number.MIN_SAFE_INTEGER,c=null},f=p=>{if(p!==void 0){if(p<u||p>d)return void(c=void 0);p-=u}if(!c)return;let w=c.next(p);if(!c)return;let S=w.value,b=S?.[1];return w.done?void(c=void 0):g1(S[0]+u,b,t)},g=p=>{let w;return w=f(p),w||(w=(S=>{let b;do{if(S!==void 0&&h(S),!a)return;if(b=a.next(),b.done)return void(a=void 0);const v=b.value,y=v[0],_=v[1],C=y.min,E=y.max,x=Math.max(C,r)-C,R=Math.max(x,Math.min(E,o))-C;Zo.bounds.min=x,Zo.bounds.max=R,Zo.reverse=!i,Zo.processSkip=n,Zo.reuseResult=t,u=C,d=E,c=_.entries(Zo);const I=f(S);if(I)return I;S=void 0}while(!b.done);a=void 0})(p),w||Ct)},m={next(p){if(p!==void 0&&(p<0||p>o))throw new Nt;return g(p)},return:p=>null,throw:p=>null};return h(i?r:o),m}runs(e){let t,n=Number.MIN_SAFE_INTEGER,r=Number.MAX_SAFE_INTEGER,o=!0,i=!1;e&&(e.bounds&&(n=e.bounds?.min??Number.MIN_SAFE_INTEGER,r=e.bounds?.max??Number.MAX_SAFE_INTEGER,this._validateBounds(n,r),e.overflowRun&&(i=!0)),o=!e.reverse,t=f1(e.reuseResult));const l=this._dataCoords;if(!l)return Qt;n=Math.max(l.min,n),r=Math.min(l.max,r);let a=null;const c=d=>{let h;d!==Number.MIN_SAFE_INTEGER&&d!==Number.MAX_SAFE_INTEGER&&(Vn.min=d,h=Vn),a=o?this._runs.entries(h,this._reuseRunsIterator):this._runs.entriesReversed(h,this._reuseRunsIterator)},u={next(d){if(d!==void 0){if(d<n||d>r)throw new Nt;c(d)}if(!a)return Ct;const h=a.next();if(h.done)return a=void 0,Ct;const f=h.value,g=f[0];let m=g;const p=m.min,w=m.max;if(o&&p>r||!o&&w<n)return Ct;let S=f[1];return i||(w>r&&(S=S.slice(0,S.length-(w-r)),m={...m},m.max=r),p<n&&(S=S.slice(n-p),m===g&&(m={...m}),m.min=n)),m1(m,S,t)},return:d=>null,throw:d=>null};return c(o?n:r),u}slice(e,t){const n=this._runs,r=n.minKey().min,o=n.maxKey().max;if(t===void 0&&(t=o+1),this._count===0||e<=r&&t-1>=o)return this.clone();const i=Math.max(r,e),l=Math.min(o,t-1),a=l-i,c=[];let u=0;tu.bounds.min=i,tu.bounds.max=l;const d=this.runs(tu);let h=d.next();for(;!h.done;){const g=h.value;let m=g[0],p=g[1];m={min:m.min-i,max:m.max-i},m.min<0&&(p=p.slice(-m.min),m.min=0),m.max>=a&&(p=p.slice(0,p.length-(m.max-a)),m.max=a),u+=p.length,c.push([m,p]),h=d.next()}const f=new ud(this._options);return f._runs.setPairs(c),f._updateCount(u),f}concat(e){const t=this.clone();if(!e||e.length===0)return t;const n=this._runs.nextLowerPair(void 0,this._reuseRunsEntry),r=n[0],o=n[1],i=r.max+1;let l=!1,a=0;const c=[];if(e.isISparseList){const u=e.runs();let d=u.next();for(;!d.done;){const h=d.value;let f=h[0];const g={min:f.min+i,max:f.max+i};let m=h[1];if(f.min===0){l=!0,a-=o.length,m=o.concat(m);const p=r.min;g.min=p,g.max=m.length-1+p}a+=m.length,c.push([g,m]),d=u.next()}}else{const u=e.length,d={min:r.min,max:u-1+i};e=o.concat(e),l=!0,a+=u,c.push([d,e])}return l&&t._runs.delete(r),t._runs.setPairs(c),t._updateCount(a),t}toArray(e=Number.MAX_SAFE_INTEGER,t=!0){if(this.length===0)return V.EmptyArray;const n=t?0:Number.MIN_SAFE_INTEGER,r=Math.min(this._runs.maxKey().max,e);return eu.bounds.min=Number.MIN_SAFE_INTEGER,eu.bounds.max=r,p1(this.entries(eu),t,r,n)}get isIReadableList(){return!0}get length(){return this._length}getCoords(){return this._dataCoords}clear(){this._runs.clear(),this._dataCoords=null,this._count=0,this._length=0}get isISparseList(){return!0}get isIList(){return!0}_updateCount(e){if(this._count+=e,this._lastRunsRead=void 0,this._lastListRead=void 0,this._count>0){const t=this._runs,n=Object.freeze({min:t.minKey().min,max:t.maxKey().max});this._dataCoords=n,this._length=n.max+1}else this._dataCoords=null,this._length=0}_update(e,t,n=null,r=void 0){const o=e,i=o+t-1;let l=0,a=i,c=i,u=null,d=null;Vn.min=o,Yo.min=i,(n||r)&&(Vn.min-=1,Yo.min+=1);const h=this._runs;let f=!1;if(h.editRange(Vn,Yo,!0,(g,m,p)=>{const w=g.min,S=g.max;return w<o&&S+1>=o&&(a=w,u=m),w-1<=i&&S>i&&(c=w,d=m),l-=S-w+1,f=!0,mt.DeleteValue}),n||r===void 0||(n=new Zn([r])),n){let g=n;f=!0;let m=o;u&&(u=u.slice(0,o-a),g=u.concat(g),m=a),d&&(d=d.slice(i+1-c),g=g.concat(d)),l+=g.length,h.set({min:m,max:m+g.length-1},g)}else u&&(u=u.slice(0,o-a),l+=u.length,h.set({min:a,max:a+u.length-1},u)),d&&(d=d.slice(i+1-c),l+=d.length,h.set({min:i+1,max:i+d.length},d));return this._updateCount(l),f}setAt(e,t){if(e===void 0)throw new sr;return this._validateBounds(e,e),this._update(e,1,null,t)}setRunAt(e,t){if(!t||t.length===0)return!1;if(e===void 0||!t.length)throw new sr;const n=t.length;return this._validateBounds(e,e+n-1),this._update(e,n,t)}delete(e,t){return t===void 0&&(t=Math.max(this.getCoords().max-e+1,0)),!(t<=0)&&(this._validateBounds(e,e),this._update(e,t,null))}shift(e,t){if(t===0)return!1;let n=e,r=e;t<0&&(r=e-t-1),this._validateBounds(n,r);const o=this._runs,i=o.maxKey();if(t<0&&r>=i.max&&n<=o.minKey().min)return this._runs.clear(),this._dataCoords=null,this._count=0,this._length=0,!0;let l=0,a=n,c=r,u=null,d=null;Vn.min=a,Yo.min=i.min,t<0&&(Vn.min-=1,Yo.min+=1);let h=!1;const f=[];if(o.editRange(Vn,Yo,!0,(g,m,p)=>{const w=g.min,S=g.max;return w<n&&S+1>=n&&(a=w,u=m),(w<n||t<0)&&w-1<=r&&g.max>r&&(c=w,d=m),t>0&&w>=n||t<0&&w-1>r?f.push([{min:w+t,max:S+t},m]):l-=S-w+1,h=!0,mt.DeleteValue}),t>0){const g=u||d;g&&(u=g.slice(0,n-a),c=e+t,d=g.slice(n-a))}else u&&(u=u.slice(0,n-a)),d&&(d=d.slice(r+1-c),c=e),u&&d&&a+u.length===c&&(u=u.concat(d),d=null);return u&&u.length>0&&(l+=u.length,o.set({min:a,max:a+u.length-1},u)),d&&(l+=d.length,o.set({min:c,max:c+d.length-1},d)),f.length>0&&o.setPairs(f),this._updateCount(l),h}at(e){Vn.min=e;const t=this._lastRunsRead;if(t){const i=t.min;if(i<=e&&t.max>=e)return this._lastListRead.at(e-i)}let n,r;const o=this._runs.getPairOrNextHigher(Vn,S1);if(o&&(n=o[0],r=o[1]),this._lastRunsRead=n,this._lastListRead=r,!(!n||e<n.min||e>n.max))return r.at(e-n.min)}[Symbol.iterator](){return H0(this.entries())}clone(){const e=new ud(this._options);return e._runs=this._runs.clone(),e._count=this._count,e._dataCoords=this._dataCoords,e._length=this._length,e}getMaxCoords(){return this._maxCoords||null}getCount(){return this._count}getRunsCount(){return this._runs.size}get[Symbol.toStringTag](){return"[SparseList]"}};Mi||(Mi={});const h1=s=>typeof s!="boolean"?(s&&!s.value&&(s.value=[-1,null]),s):s===!0?eh:void 0,g1=(s,e,t)=>{const n=t??{done:!1,value:[-1,null]},r=n.value;return r[0]=s,r[1]=e,n},f1=s=>typeof s!="boolean"?(s&&!s.value&&(s.value=[null,null]),s):s===!0?w1:void 0,m1=(s,e,t)=>{const n=t??{done:!1,value:[null,null]},r=n.value;return r[0]=s,r[1]=e,n},p1=(s,e=!1,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER)=>{const r=[];let o=s.next(),i=Math.max(n,0)-1;for(;!o.done;){if(e){const l=o.value[0];for(let a=i;a<l-1;a++)r.push(void 0);i=l}r.push(o.value[1]),o=s.next()}if(e)for(let l=i;l<t;l++)r.push(void 0);return r},w1=Object.seal({done:!1,value:[{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},null]}),eh=Object.seal({done:!1,value:[-1,null]}),Zo={reverse:!1,bounds:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},processSkip:null,reuseResult:eh},eu=Object.freeze({reverse:!1,bounds:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},processSkip:null,reuseResult:eh}),Vn={min:0,max:Number.MAX_SAFE_INTEGER},Yo={min:0,max:Number.MAX_SAFE_INTEGER},S1=[null,null],tu={bounds:{min:0,max:0},overflowRun:!0};class _1{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(e){return this.data.children.length===0?[]:this._all(this.data,e??[])}isEmpty(){return this.data.children.length===0}search(e,t){let n=this.data;if(n.children.length===0)return V.EmptyArray;if(!vl(e,n))return V.EmptyArray;const r=t??[],o=this.toBBox,i=[];for(;n;){const l=n.children,a=l.length,c=n.leaf;for(let u=0;u<a;u++){const d=l[u],h=c?o(d):d;vl(e,h)&&(c?r.push(d):ru(e,h)?this._all(d,r):i.push(d))}n=i.pop()}return r}collides(e){let t=this.data;if(!vl(e,t))return!1;const n=[];for(;t;){for(let r=0;r<t.children.length;r++){const o=t.children[r],i=t.leaf?this.toBBox(o):o;if(vl(e,i)){if(t.leaf||ru(e,i))return!0;n.push(o)}}t=n.pop()}return!1}load(e){if(!e||!e.length)return this;const t=this._minEntries;if(e.length<t){for(let r=0;r<e.length;r++)this.insert(e[r]);return this}let n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=is([]),this}remove(e,t){if(!e)return this;let n=this.data;const r=this.toBBox(e),o=[],i=[];let l,a,c;for(;n||o.length;){if(n||(n=o.pop(),a=o[o.length-1],l=i.pop(),c=!0),n.leaf){const u=y1(e,n.children,t);if(u!==-1)return n.children.splice(u,1),o.push(n),this._condense(o),this}c||n.leaf||!ru(n,r)?a?(l++,n=a.children[l],c=!1):n=null:(o.push(n),i.push(l),l=0,a=n,n=n.children[0])}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){const n=[];for(;e;)e.leaf?t.push(...e.children):n.push(...e.children),e=n.pop();return t}_build(e,t,n,r){const o=n-t+1;let i,l=this._maxEntries;if(o<=l)return i=is(e.slice(t,n+1)),Qo(i,this.toBBox),i;r||(r=Math.ceil(Math.log(o)/Math.log(l)),l=Math.ceil(o/Math.pow(l,r-1))),i=is([]),i.leaf=!1,i.height=r;const a=Math.ceil(o/l),c=a*Math.ceil(Math.sqrt(l));Gg(e,t,n,c,this.compareMinX);for(let u=t;u<=n;u+=c){const d=Math.min(u+c-1,n);Gg(e,u,d,a,this.compareMinY);for(let h=u;h<=d;h+=a){const f=Math.min(h+a-1,d);i.children.push(this._build(e,h,f,r-1))}}return Qo(i,this.toBBox),i}_chooseSubtree(e,t,n,r){for(;r.push(t),!t.leaf&&r.length-1!==n;){let o,i=1/0,l=1/0;for(let a=0;a<t.children.length;a++){const c=t.children[a],u=nu(c),d=C1(e,c)-u;d<l?(l=d,i=u<i?u:i,o=c):d===l&&u<i&&(i=u,o=c)}t=o||t.children[0]}return t}_insert(e,t,n=!1){const r=n?e:this.toBBox(e),o=[],i=this._chooseSubtree(r,this.data,t,o);for(i.children.push(e),yi(i,r);t>=0&&o[t].children.length>this._maxEntries;)this._split(o,t),t--;this._adjustParentBBoxes(r,o,t)}_split(e,t){const n=e[t],r=n.children.length,o=this._minEntries;this._chooseSplitAxis(n,o,r);const i=this._chooseSplitIndex(n,o,r),l=is(n.children.splice(i,n.children.length-i));l.height=n.height,l.leaf=n.leaf,Qo(n,this.toBBox),Qo(l,this.toBBox),t?e[t-1].children.push(l):this._splitRoot(n,l)}_splitRoot(e,t){this.data=is([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Qo(this.data,this.toBBox)}_chooseSplitIndex(e,t,n){let r=-1,o=1/0,i=1/0;for(let l=t;l<=n-t;l++){const a=_i(e,0,l,this.toBBox),c=_i(e,l,n,this.toBBox),u=x1(a,c),d=nu(a)+nu(c);u<o?(o=u,r=l,i=d<i?d:i):u===o&&d<i&&(i=d,r=l)}return r||n-t}_chooseSplitAxis(e,t,n){const r=e.leaf?this.compareMinX:b1,o=e.leaf?this.compareMinY:v1;this._allDistMargin(e,t,n,r)<this._allDistMargin(e,t,n,o)&&e.children.sort(r)}_allDistMargin(e,t,n,r){e.children.sort(r);const o=this.toBBox,i=_i(e,0,t,o),l=_i(e,n-t,n,o);let a=bl(i)+bl(l);for(let c=t;c<n-t;c++){const u=e.children[c];yi(i,e.leaf?o(u):u),a+=bl(i)}for(let c=n-t-1;c>=t;c--){const u=e.children[c];yi(l,e.leaf?o(u):u),a+=bl(l)}return a}_adjustParentBBoxes(e,t,n){for(let r=n;r>=0;r--)yi(t[r],e)}_condense(e){for(let t,n=e.length-1;n>=0;n--)e[n].children.length===0?n>0?(t=e[n-1].children,t.splice(t.indexOf(e[n]),1)):this.clear():Qo(e[n],this.toBBox)}}function y1(s,e,t){if(!t)return e.indexOf(s);for(let n=0;n<e.length;n++)if(t(s,e[n]))return n;return-1}function Qo(s,e){_i(s,0,s.children.length,e,s)}function _i(s,e,t,n,r=null){r||(r=is(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<t;o++){const i=s.children[o];yi(r,s.leaf?n(i):i)}return r}function yi(s,e){return s.minX=Math.min(s.minX,e.minX),s.minY=Math.min(s.minY,e.minY),s.maxX=Math.max(s.maxX,e.maxX),s.maxY=Math.max(s.maxY,e.maxY),s}function b1(s,e){return s.minX-e.minX}function v1(s,e){return s.minY-e.minY}function nu(s){return(s.maxX-s.minX)*(s.maxY-s.minY)}function bl(s){return s.maxX-s.minX+(s.maxY-s.minY)}function C1(s,e){return(Math.max(e.maxX,s.maxX)-Math.min(e.minX,s.minX))*(Math.max(e.maxY,s.maxY)-Math.min(e.minY,s.minY))}function x1(s,e){const t=Math.max(s.minX,e.minX),n=Math.max(s.minY,e.minY),r=Math.min(s.maxX,e.maxX),o=Math.min(s.maxY,e.maxY);return Math.max(0,r-t)*Math.max(0,o-n)}function ru(s,e){return s.minX<=e.minX&&s.minY<=e.minY&&e.maxX<=s.maxX&&e.maxY<=s.maxY}function vl(s,e){return e.minX<=s.maxX&&e.minY<=s.maxY&&e.maxX>=s.minX&&e.maxY>=s.minY}function is(s){return{children:s,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Gg(s,e,t,n,r){const o=[e,t];for(;o.length;){if((t=o.pop())-(e=o.pop())<=n)continue;const i=e+Math.ceil((t-e)/n/2)*n;$0(s,i,e,t,r),o.push(e,i,i,t)}}function $0(s,e,t,n,r){for(;n>t;){if(n-t>600){const a=n-t+1,c=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*d*(a-d)/a)*(c-a/2<0?-1:1);$0(s,e,Math.max(t,Math.floor(e-c*d/a+h)),Math.min(n,Math.floor(e+(a-c)*d/a+h)),r)}const o=s[e];let i=t,l=n;for(Ks(s,t,e),r(s[n],o)>0&&Ks(s,t,n);i<l;){for(Ks(s,i,l),i++,l--;r(s[i],o)<0;)i++;for(;r(s[l],o)>0;)l--}r(s[t],o)===0?Ks(s,t,l):(l++,Ks(s,l,n)),l<=e&&(t=l+1),e<=l&&(n=l-1)}}function Ks(s,e,t){const n=s[e];s[e]=s[t],s[t]=n}class Ug extends _1{toBBox(e){return{minX:10*e.colStart,minY:10*e.rowStart,maxX:10*e.colEnd+5,maxY:10*e.rowEnd+5}}compareMinX(e,t){return e.colStart-t.colStart}compareMinY(e,t){return e.rowStart-t.rowStart}isEmpty(){return this.data.children.length===0}searchRange(e,t=!1,n){if(this.isEmpty())return V.EmptyArray;const r=this.search(this.toBBox(e),n);return t?r.filter(o=>o.colStart>=e.colStart&&o.rowStart>=e.rowStart&&o.colEnd<=e.colEnd&&o.rowEnd<=e.rowEnd):r}}class _t{constructor(e){this._shared=null,this._rTree=null,this._cloneKey=null,this._lastMiss={colStart:Number.MAX_SAFE_INTEGER,rowStart:0,colEnd:0,rowEnd:0},this._lastSingle=null,this._lastSingleResult=null,this._options=e,this._rTree=new Ug(e?.maxNodeEntries??16)}visitRanges(e,t,n=null){let r=this.search(e);n&&(r=Xr(r,n));const o=[],i=[];let l=null;const a=r.length;for(let c=0;!l&&c<a;c++){const u=r[c],d=t?.(u);d&&(d.delete===!0?i.push(u):d.update!==void 0&&(i.push(u),o.push(d.update)),d&&d.break===!0&&(l=d))}for(let c=0;c<i.length;c++)this.remove(i[c]);return this.load(o),l}getBoundingCoords(){const e=this._getReadTree().toJSON();return e&&e.children&&e.children.length!==0?{colStart:e.minX/10,rowStart:e.minY/10,colEnd:(e.maxX-5)/10,rowEnd:(e.maxY-5)/10}:null}size(){return this._getReadTree().all().length}isEmpty(){return this._getReadTree().isEmpty()}search(e,t=!1,n){const r=this._getReadTree();if(r.isEmpty())return V.EmptyArray;let o;if(!t){if(o=this._lastMiss,o.colStart!==Number.MAX_SAFE_INTEGER&&J.isRangeWithinRange(e,o))return V.EmptyArray;if(this._lastSingle&&J.isRangeWithinRange(e,o))return this._lastSingleResult}const i=r.searchRange(e,t,n);return t||(i.length===0?(o.colStart=e.colStart,o.rowStart=e.rowStart,o.colEnd=e.colEnd,o.rowEnd=e.rowEnd):i.length===1?(this._lastSingle=i[0],this._lastSingleResult=i):(this._lastMiss.colStart=Number.MAX_SAFE_INTEGER,this._lastSingle=null,this._lastSingleResult=null)),i}has(e){const t=this._getReadTree();return t.collides(t.toBBox(e))}all(e){return this._getReadTree().all(e)}shift(e){const t=e.range,n=e.direction,r=e.cloneIfUpdate??!1,o=e.coordValidator??null,i=e.onShift??null,l=n===Ot.Left||n===Ot.Right,a=l?ct.Column:ct.Row,c=n===Ot.Up||n===Ot.Left?-1:1,u=(l?t.colEnd-t.colStart+1:t.rowEnd-t.rowStart+1)*c,d=[],h=[];let f=null;const g=this.getBoundingCoords();if(!g)return this;const m=n===Ot.Up||n===Ot.Left?Ot.Right:Ot.Left,p=new Map,w=new Map,S=this._options?.updateEntryOptions,b=S?.isMergeOnShift??!1,v=S?.isSplitOnExpand??!1,y=S?.isTrailingEdge??!1,_=n===Ot.Left||n===Ot.Up,C=S?.getSplit??la,E=S?.getShifted,x=S?.onShifted,R=S?.onRemoved,I=S?.onMerged,A=S?.onUpdated,M=x?[]:null,k=R?[]:null,F=A?[]:null;this.visitRanges({colStart:t.colStart-(l?1:0),rowStart:t.rowStart-(l?0:1),colEnd:l?g.colEnd:t.colEnd,rowEnd:l?t.rowEnd:g.rowEnd},D=>{if((l?D.colEnd<t.colStart:D.rowEnd<t.rowStart)&&!y)return;const O=A1(t,D,l?cs.Column:cs.Row),H=D.group;if(_&&!H&&t.colStart<=D.colStart&&t.rowStart<=D.rowStart&&t.colEnd>=D.colEnd&&t.rowEnd>=D.rowEnd){const U=Kg(D,null,{after:null,before:D,intersect:t,isSplit:O,orientation:a,amount:u},E,C,i,!1);if(U===void 0)return;if(U===null)return f=J.unionRanges(f,D),k&&k.push(D),void d.push(D)}let z={...D};n===Ot.Right?(t.colStart<=z.colStart&&(z.colStart+=u),z.colEnd+=u):n===Ot.Left?t.colStart<z.colStart?(z.colStart=Math.max(z.colStart+u,t.colStart),z.colEnd=Math.max(z.colEnd+u,z.colStart-1)):z.colEnd+=Math.max(u,t.colStart-z.colEnd-1):n===Ot.Down?(t.rowStart<=z.rowStart&&(z.rowStart+=u),z.rowEnd+=u):n===Ot.Up&&(t.rowStart<z.rowStart?(z.rowStart=Math.max(z.rowStart+u,t.rowStart),z.rowEnd=Math.max(z.rowEnd+u,t.rowStart-1)):z.rowEnd+=Math.max(u,t.rowStart-z.rowEnd-1)),(z.colEnd<z.colStart||z.rowEnd<z.rowStart)&&(z=null);const j=Kg(D,z,{after:z,before:D,intersect:t,isSplit:O,orientation:a,amount:u},E,C,i,v&&u>0);if(j===void 0)return;const q=j===null?[z]:j,P=q.length;if(q[0]!==D||P!==1){if(o)for(let ne=0;ne<P;ne++){const ee=q[ne];ee&&o(ee)}let U;H?(p.set(H.uuid,H),U=[],w.set(D.uuid,U)):d.push(D);for(let ne=0;ne<P;ne++){const ee=q[ne];f=J.unionRanges(f,ee),H?U.push(ee):(h.push(ee),M&&M.push(ee),F&&F.push(D))}}},m);let L=null;L=r&&(d.length>0||h.length>0||w.size>0)?this.clone():this,L._updateNodes(h,d),w.size>0&&L._updateGroupedEntries(p,w);let N=V.EmptyArray;if(b&&g&&f){let D=!0;if(u>0&&(D=l?t.rowStart>g.rowStart||t.rowEnd<g.rowEnd:t.colStart>g.colStart||t.colEnd<g.colEnd),D){const O=qg(f,J.unionRanges(g,f),l?0:1,l?1:0);I&&(N=L._mergeNodes(O,!1))}}return A&&F.length>0&&A(F),x&&M.length>0&&x(M),I&&N.length>0&&I(N),R&&k.length>0&&R(k),L}insertNonOverlapping(e,t){const n=t?.onIntersect??((b,v)=>({...b,value:v.value})),r=this.search(e),o=new Map,i=new Map,l=this._options?.updateEntryOptions,a=l?.onUpdated,c=l?.onRemoved,u=l?.onMerged,d=l?.getSplit,h=l?.getIntersect,f=l?.getUpdate;let g=null,m=null,p=null,w=function(b,v,y){const _=y?.getIntersect??R1,C=y?.getUpdate??I1;if(b.length===0){if(_){const O=_({...v,value:null},v);v=O&&O.value!==null?{...O}:null}if(C){const O=C(v);O!==void 0&&(v=O)}return v?[v]:V.EmptyArray}const E=y?.getSplit??E1,x=(O,H,z=!0)=>{const j=H.search(O),q=j.length;for(let P=0;P<q;P++){const U=j[P];if(J.isEqualRanges(U,O))continue;H?.remove(U);const ne=Rs(U,O,E,z);for(let ee=0;ee<ne.length;ee++){const ve=ne[ee];H.insert(ve),x(ve,H,!1)}}},R=new _t;R.load(b),x(v,R);const I=new _t;I.load([v]);const A=R.search(v);for(let O=0;O<A.length;O++)x(A[O],I);const M=(O,H,z)=>{let j=H.search(O);console.assert(j.length<=1,"intersecting incorrect ranges");const q=j[0]??{...O,value:null};if(J.isEqualRanges(q,O)){let P=_(q,O);H.remove(q),z.insert(P)}else{H.remove(q);const P=Rs(q,O,E),U=P.length;for(let ne=0;ne<U;ne++){const ee=P[ne];if(J.isEqualRanges(ee,O)){const ve=_(ee,O);z.insert(ve)}else H.insert(ee)}}},k=new _t,F=I.all(),L=F.length;for(let O=0;O<L;O++)M(F[O],R,k);const N=(O,H)=>{const z=O.all(),j=z.length;for(let q=0;q<j;q++){let P=z[q];if(C){const U=C(P);U!==void 0&&(P=U)}P!==null&&P.value!==null&&H.push(P)}},D=R.all();return N(k,D),D}(r,e,{getSplit:(b,v,y,_)=>{let C;return d?(C=d(b,v,y,_),C):(C=la(b,v,y,_),C)},getIntersect:(b,v)=>{h&&(v=h(b,v));const y=n(b,v);return y===void 0||(y===null||y.value===null)&&b.value?.onRemove?.(b),y},getUpdate:b=>{const v=b?.group;if(v){o.set(v.uuid,v);let _=i.get(b.lastId??b.uuid);_||(_=[],i.set(b.lastId??b.uuid,_)),_.push(b.value===null?null:b)}let y=b;if(f&&(y=f(b)),y&&y.value!==null)a&&(g||(g=[]),g.push(y));else if(c&&!p){p=[];let _=y&&y.value===null?y:{...b,value:null};p.push(_)}return y}});const S=this.getBoundingCoords();if(o.size>0){const b=[],v=w.length;for(let y=0;y<v;y++){let _=w[y];_.group||b.push(_)}w=b}if(this._updateNodes(w,r,t?.onUpdates),o.size>0&&this._updateGroupedEntries(o,i),S&&!t?.noMerge){const b=qg(e,J.unionRanges(S,e)),v=this.search(b);if(v.length>1){const y=l?.getMerged??Jg;let _=v;_=mr(_,ct.Column,1,y),_=mr(_,ct.Row,1,y),v.length!==_.length&&(u&&_.length>0&&(m=_),this._updateNodes(_,v,t?.onUpdates))}}return g&&a(g),m&&u(m),p&&c(p),this}insertGroup(e,t){t=t??V.uuidV4();const n=[],r=e.length;for(let o=0;o<r;o++){const i={...e[o],group:{entries:n,uuid:t,offset:o},uuid:V.uuidV4()};n.push(i),e[o]=i}return this.load(e),this._options?.updateEntryOptions?.onGroupUpdate?.(e,t),this}createCopiedEntries(e,t,n,r,o){return M1(this,e,t,n,r,o,this._options?.updateEntryOptions?.getSplit??la)}_updateGroupedEntries(e,t){const n=[],r=[],o=new Map,i=e.values();let l=i.next();for(;!l.done;){const a=l.value,c=a.entries,u=a.uuid,d=[];for(let h=0;h<c.length;h++){let f=c[h];n.push(f);let g=t.get(f.uuid);g===void 0&&(g=[{...f}]);for(let m=0;m<g.length;m++){let p=g[m];p!==null&&(p={...p,group:{offset:d.length,entries:d,uuid:u}},d.push(p),r.push(p))}}d.sort((h,f)=>h.group.offset-f.group.offset),o.set(u,d),l=i.next()}if(this._updateNodes(r,n),o){const a=this._options?.updateEntryOptions?.onGroupUpdate;if(a){const c=o.entries();let u=c.next();for(;!u.done;){const d=u.value[0];a(u.value[1],d),u=c.next()}}}}_copy(e,t){let n=e.rTree.all();const r=new Ug(this._options?.maxNodeEntries);return t&&(n=n.concat(t)),n.length>0&&r.load(n),{refCount:1,rTree:r}}_updateNodes(e,t,n){if(!(e&&e.length!==0||t&&t.length!==0))return;const r=this._getWritableTree();if(t){const o=t.length;for(let i=0;i<o;i++)r.remove(t[i])}e.length>0&&r.load(e),n?.(e,t,this),this._options?.updateEntryOptions?.onUpdates?.(e,t,this)}_mergeNodes(e,t){const n=this.search(e,t);let r=V.EmptyArray;if(n.length>1){const o=this._options?.updateEntryOptions.getMerged??Jg;let i=n;i.length>1&&(i=mr(i,ct.Column,1,o)),i.length>1&&(i=mr(i,ct.Row,1,o)),n.length!==i.length&&(r=i,this._updateNodes(i,n))}return r}_getReadTree(){return this._shared?.rTree??this._rTree}_ensureWritable(e){const t=this._shared;if(!t)return;if(t.refCount--,t.refCount===0)return this._shared=null,void(e&&this._rTree.load(e));const n=this._copy(t,e);this._shared=null,this._rTree=n.rTree}_getWritableTree(e){return this._lastMiss.colStart=Number.MAX_SAFE_INTEGER,this._lastSingle=null,this._lastSingleResult=null,this._shared?(this._ensureWritable(e),this._rTree):(e&&this._rTree.load(e),this._rTree)}remove(e,t){return e&&this._getWritableTree().remove(e,t??J.isEqualRanges),this}insert(e){return e&&this._getWritableTree().insert(e),this}load(e){return e&&e.length>0&&this._getWritableTree(e),this}clear(){return this.isEmpty()||this._getWritableTree().clear(),this}clone(e=null){if(e!==null&&this._cloneKey===e)return this;let t=this._shared;t||(t={rTree:this._rTree,refCount:1},this._shared=t),t.refCount++;const n=new _t(this._options);return n._shared=t,n._cloneKey=e,n}fromJSON(e){return this._getWritableTree().fromJSON(e),this}}const qg=(s,e=s,t=1,n=1)=>({...s,colStart:Math.max(s.colStart-t,e.colStart),rowStart:Math.max(s.rowStart-n,e.rowStart),colEnd:Math.min(s.colEnd+t,e.colEnd),rowEnd:Math.min(s.rowEnd+n,e.rowEnd)});function E1(s,e,t,n){return[{...e[0],value:s.value},{...e[0],value:s.value}]}function R1(s,e){return{...s}}function Rs(s,e,t=null,n=!0){if(J.isEqualRanges(s,e))return[{...s}];const r=J.intersectRanges(s,e,T1);if(!r)return null;const o=[],i=s.uuid;let l=s;if(l.rowStart<r.rowStart){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:r.rowStart-1};i&&(n&&(a.lastId=i),a.uuid=V.uuidV4());const c={...l,colStart:l.colStart,rowStart:r.rowStart,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=V.uuidV4());const u=c.rowStart-a.rowStart;Wn[0]=a,Wn[1]=c;const d=t(l,Wn,ct.Row,u);d!==void 0&&(o.push(d[0]),l=d[1])}if(l.rowEnd>r.rowEnd){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:r.rowEnd};i&&(n&&(a.lastId=i),a.uuid=V.uuidV4());const c={...l,colStart:l.colStart,rowStart:r.rowEnd+1,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=V.uuidV4());const u=c.rowStart-a.rowStart;Wn[0]=a,Wn[1]=c;const d=t(l,Wn,ct.Row,u);d!==void 0&&(o.push(d[1]),l=d[0])}if(l.colStart<r.colStart){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:r.colStart-1,rowEnd:l.rowEnd};i&&(n&&(a.lastId=i),a.uuid=V.uuidV4());const c={...l,colStart:r.colStart,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=V.uuidV4());const u=c.colStart-a.colStart;Wn[0]=a,Wn[1]=c;const d=t(l,Wn,ct.Column,u);d!==void 0&&(o.push(d[0]),l=d[1])}if(l.colEnd>r.colEnd){const a={...l,colStart:l.colStart,rowStart:l.rowStart,colEnd:r.colEnd,rowEnd:l.rowEnd};i&&(n&&(a.lastId=i),a.uuid=V.uuidV4());const c={...l,colStart:r.colEnd+1,rowStart:l.rowStart,colEnd:l.colEnd,rowEnd:l.rowEnd};i&&(n&&(c.lastId=i),c.uuid=V.uuidV4());const u=c.colStart-a.colStart;Wn[0]=a,Wn[1]=c;const d=t(l,Wn,ct.Column,u);d!==void 0&&(o.push(d[1]),l=d[0])}return l===s&&(l={...s}),o.push(l),o}function I1(s){return s.value===null?null:s}function mr(s,e=ct.Column,t=2,n,r){let o=[...s];if(t<=0||s.length<=1)return o;let i=e===ct.Column,l=0,a=!1;do{const c=o.sort(J.createRangeComparator(i?ct.Row:ct.Column));o=[],a=!1,o.push(c[0]);for(let u=1;u<c.length;u++){const d=c[u],h=o[o.length-1];let f=!1;if(f=i?h&&h.rowStart===d.rowStart&&h.rowEnd===d.rowEnd&&h.colEnd+1===d.colStart:h&&h.colStart===d.colStart&&h.colEnd===d.colEnd&&h.rowEnd+1===d.rowStart,f){let g={...h,colEnd:i?d.colEnd:h.colEnd,rowEnd:i?h.rowEnd:d.rowEnd};if(n){const m=r??[null,null];m[0]=h,m[1]=d,g=n(m,g,e)}if(g){o[o.length-1]=g,a=!0;continue}}o.push(d)}l++,i=!i}while(l<t&&a&&o.length>1);return o}const dd=(s,e=2,t=ct.Row,n,r,o)=>{if(s.length<=1)return[...s];let i=[];const l=t===ct.Column,a=new Oa.IteratorInstance(s,{orientation:l?ct.Row:ct.Column});let c=a.next();for(;!c.done;){const u=c.value;c=a.next();const d=u.range;if(e>0){const h=i[i.length-1];let f=!1;if(f=l?h&&h.rowStart===d.rowStart&&h.rowEnd===d.rowEnd&&h.colEnd+1===d.colStart:h&&h.colStart===d.colStart&&h.colEnd===d.colEnd&&h.rowEnd+1===d.rowStart,f){let g={...h,colEnd:l?d.colEnd:h.colEnd,rowEnd:l?h.rowEnd:d.rowEnd};if(g){i[i.length-1]=g;continue}}}i.push(d)}return e>1&&(i=mr(i,l?ct.Row:ct.Column,e,n,o)),i};function la(s,e,t,n){const r=s.value;if(r?.getSplit){const o=r.getSplit(e,t,n);if(o===void 0)return;e[0].value=o[0],e[1].value=o[1]}return e}function Jg(s,e,t){const n=s[0].value,r=s[1].value;if(n?.getMerged&&r){const o=n.getMerged(s[1].value,J.sanitizeRange(e),t);if(o===void 0)return;e.value=o}return e}const A1=(s,e,t=cs.Both)=>{const n=i=>i?s.rowStart>e.rowStart&&s.rowStart<=e.rowEnd||s.rowEnd<e.rowEnd&&s.rowEnd>=e.rowStart:s.colStart>e.colStart&&s.colStart<=e.colEnd||s.colEnd<e.colEnd&&s.colEnd>=e.colStart;let r=t===cs.Column,o=t===cs.Row;return t===cs.Both&&(r=o=!0),!(!r||!n(!0))||!(!o||!n(!1))};function Kg(s,e,t,n,r,o,i){const l=t.orientation===ct.Column,a=t.intersect,c=(u,d)=>{let h=u.value,f=null,g=d.after;if(i){let m=null,p=0,w=0;if(l&&a.colStart>u.colStart?(m={...u,colEnd:a.colStart-1},w=d.amount):!l&&a.rowStart>u.rowStart&&(m={...u,rowEnd:a.rowStart-1},p=d.amount),m){const S=Rs(s,m,r);if(S.length>1)for(let b=0;b<S.length;b++){let v=S[b];J.isEqualRanges(v,m)?(f=f??[],f.push(v)):(g=v,h=v.value,d={...d,after:{...v,colStart:v.colStart+w,rowStart:v.rowStart+p,colEnd:v.colEnd+w,rowEnd:v.rowEnd+p,uuid:V.uuidV4()},before:v,intersect:m,isSplit:!0})}}}if(n?g=n(d.before,d.after,d):h&&h.getShifted?g=h.getShifted(d):d.after&&(g={...d.after,value:u.value}),g!==void 0)return o&&(g!==d.after&&(d={...d,after:g}),o(d)),g=(m=>{if(!m){const p=s.value;return p.onRemove&&p.onRemove(J.sanitizeRange(t.before)),null}return m})(g),g&&(f=f??[],f.push(g)),f};if(t.isSplit){let u;u=l?{...s,rowStart:Math.max(a.rowStart,t.before.rowStart),rowEnd:Math.min(a.rowEnd,t.before.rowEnd)}:{...s,colStart:Math.max(a.colStart,t.before.colStart),colEnd:Math.min(a.colEnd,t.before.colEnd)};const d=Rs(s,u,r),h=[];for(let f=0;f<d.length;f++){const g=d[f];if(J.isEqualRanges(g,u)){let m=null;e&&(m=l?{colStart:e.colStart,rowStart:u.rowStart,colEnd:e.colEnd,rowEnd:u.rowEnd,value:g.value}:{colStart:u.colStart,rowStart:e.rowStart,colEnd:u.colEnd,rowEnd:e.rowEnd,value:g.value});const p=c(g,{...t,before:g,after:m});if(p)for(let w=0;w<p.length;w++)h.push(p[w])}else h.push(g)}return h}return c(s,t)}const M1=(s,e,t,n,r,o,i)=>{const l=t.colEnd-t.colStart+1,a=t.rowEnd-t.rowStart+1,c=t.colStart-e.colStart,u=t.rowStart-e.rowStart,d=n?.transpose??!1;let h=1,f=1;d?(h=e.rowEnd-e.rowStart+1,f=e.colEnd-e.colStart+1):(h=e.colEnd-e.colStart+1,f=e.rowEnd-e.rowStart+1);const g=Math.ceil(l/h),m=Math.ceil(a/f),p=r??[],w=o??V.EmptyArray,S=t.colEnd,b=t.rowEnd;return s.visitRanges(e,v=>{let y=v.value;if(!y.copyTo)return;let _=v;if(!J.isRangeWithinRange(_,e)){const F=Rs(_,e,i);_=F[F.length-1]}y=_.value;let C=_.colEnd-_.colStart+1,E=_.rowEnd-_.rowStart+1,x=c+_.colStart,R=u+_.rowStart;if(d){x=_.rowStart-e.rowStart+t.colStart,R=_.colStart-e.colStart+t.rowStart;const F=C;C=E,E=F}let I=g,A=m;const M=l<=I*C,k=a<=A*E;if(M||k){const F=y?.canTile?.({colStart:x,rowStart:R,colEnd:Math.min(x+(M?l:C)-1,S),rowEnd:Math.min(R+(k?a:E)-1,b)},n);!M||F!==!0&&F!==ct.Column||(C=l,I=1),!k||F!==!0&&F!==ct.Row||(E=a,A=1)}for(let F=0;F<I;F++){const L=x+F*h;for(let N=0;N<A;N++){const D=R+N*f,O=Math.min(L+C-1,S),H=Math.min(D+E-1,b),z={colStart:L,rowStart:D,colEnd:O,rowEnd:H};if(L>O||D>H)continue;const j=y.copyTo(z,n);j&&p.push({...z,value:j})}}},Ot.Right),{inserts:p,removes:w}},Wn=[null,null],T1={colStart:0,rowStart:0,colEnd:0,rowEnd:0},Pn=(s=Number.MIN_SAFE_INTEGER,e=Number.MIN_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r,o,i)=>{if(o&&(s!==Number.MIN_SAFE_INTEGER&&s<o.colStart||e!==Number.MIN_SAFE_INTEGER&&e<o.rowStart||t!==Number.MAX_SAFE_INTEGER&&t>o.colEnd||n!==Number.MAX_SAFE_INTEGER&&n>o.rowEnd))throw new Nt;return i&&(s=Math.max(i.colStart,s),e=Math.max(i.rowStart,e),t=Math.min(i.colEnd,t),n=Math.min(i.rowEnd,n),t<s||n<e)?null:(Xs.majorStart=r?s:e,Xs.majorEnd=r?t:n,Xs.minorStart=r?e:s,Xs.minorEnd=r?n:t,Xs)},Hi=(s,e,t)=>{const n={colStart:0,rowStart:0,colEnd:0,rowEnd:0};return n.colStart=e?s.majorStart:s.minorStart,n.rowStart=e?s.minorStart:s.majorStart,n.colEnd=e?s.majorEnd:s.minorEnd,n.rowEnd=e?s.minorEnd:s.majorEnd,n},Xs={majorStart:0,majorEnd:0,minorStart:0,minorEnd:0},Xg=(s,e)=>s[0]-e[0];class V0{constructor(e,t){this._isColumn=!0,this._isReverse=!1,this._skipMajors=!1,this._majorMin=Number.MAX_SAFE_INTEGER,this._majorMax=Number.MIN_SAFE_INTEGER,this._minorMin=Number.MAX_SAFE_INTEGER,this._minorMax=Number.MIN_SAFE_INTEGER,this._majorIndex=Number.MIN_SAFE_INTEGER,this._minorIndex=Number.MIN_SAFE_INTEGER,this._delegateMajorIndex=Number.MIN_SAFE_INTEGER,this._delegateMinorIndex=Number.MIN_SAFE_INTEGER,this._delegate=e;const n=(t.orientation??ct.Column)===ct.Column;this._isColumn=n,this._isReverse=t.reverse??!1,this._skipMajors=t.skipMajors??!1;const r=t.bounds,o=r.colStart,i=r.rowStart,l=r.colEnd,a=r.rowEnd;this._majorMin=n?o:i,this._majorMax=n?l:a,this._minorMin=n?i:o,this._minorMax=n?a:l,this._processMajorSkip=n?t.processColumnSkip:t.processRowSkip,this._processMinorSkip=n?t.processRowSkip:t.processColumnSkip;const c=e.next();this._delegateResult=c,this._initialize()}_initialize(){const e=this._isColumn,t=this._isReverse,n=t?-1:1;let r=t?this._majorMax:this._majorMin,o=(t?this._minorMax:this._minorMin)-n;const i=this._processMinorSkip;i&&(o=i(o,t));const l=this._processMajorSkip;l&&(r=l(r,t)),this._majorIndex=r,this._minorIndex=o;const a=this._delegateResult;if(a.done)this._delegateMajorIndex=this._majorMax,this._delegateMinorIndex=this._minorMax+n;else{const c=a.value[0];this._delegateMajorIndex=e?c.colIndex:c.rowIndex,this._delegateMinorIndex=e?c.rowIndex:c.colIndex}}next(e){e!==void 0&&(this._delegateResult=this._delegate.next(e),this._initialize());const t=this._isReverse,n=this._isColumn,r=this._majorMin,o=this._majorMax;let i=this._majorIndex,l=this._minorIndex;if(i>o||i<r)return Ct;let a=this._delegateMajorIndex,c=this._delegateMinorIndex,u=this._delegateResult.done;if(i===a&&l===c){const f=this._delegate.next();if(this._delegateResult=f,u=f.done,u)a=t?r:o,a=t?this._minorMin:this._minorMax;else{const g=f.value[0];a=n?g.colIndex:g.rowIndex,c=n?g.rowIndex:g.colIndex}this._delegateMajorIndex=a,this._delegateMinorIndex=c}const d=t?-1:1;if(this._minorIndex=l+=d,i===a&&l===c&&!u)return this._delegateResult;const h=this._processMinorSkip;if(h&&(l=h(l,t)),l>this._minorMax||l<this._minorMin){i+=d;const f=this._processMajorSkip;f&&(i=f(i,t)),this._skipMajors&&(!t&&i<a||t&&i>a)&&(i=a),this._majorIndex=i,l=t?this._minorMax:this._minorMin}return this._minorIndex=l,i===a&&l===c&&!u?this._delegateResult:i>o||i<r?Ct:{done:!1,value:[{colIndex:n?i:l,rowIndex:n?l:i}]}}return(e){return null}throw(e){return null}[Symbol.iterator](){return this}}let hd=class{constructor(e){this._isColumn=!0,this._majorSize=Number.MAX_SAFE_INTEGER,this._minorSize=Number.MAX_SAFE_INTEGER,this._majorMin=Number.MAX_SAFE_INTEGER,this._majorMax=Number.MIN_SAFE_INTEGER,this._minorMin=Number.MAX_SAFE_INTEGER,this._minorMax=Number.MIN_SAFE_INTEGER,this._majorIndex=Number.MAX_SAFE_INTEGER,this._minorIndex=Number.MAX_SAFE_INTEGER,this._minorOffset=0,this._minorRepeat=0,this._majorOffset=-1,this._majorRepeat=1,this._pattern=[];const t=e.delegate;this._delegate=t;const n=(e.orientation??ct.Column)===ct.Column;this._isColumn=n;const r=e.dims,o=e.bounds,i=o.colStart,l=o.rowStart,a=o.colEnd,c=o.rowEnd;if(this._majorSize=1+(n?a-i:c-l),this._minorSize=1+(n?c-l:a-i),this._majorMin=n?i:l,this._minorMin=n?l:i,this._majorMax=(n?i+r.major:l+r.major)-1,this._minorMax=(n?l+r.minor:i+r.minor)-1,this._majorSize>this._majorMax+1||this._minorSize>this._minorMax+1)throw new Error("The dimensions must be larger than the bounds.");const u=t.next();this._nextDelegateResult=u,this._initialize()}_initialize(){const e=this._isColumn,t=this._nextDelegateResult;if(t.done)this._nextResult=Ct;else{const n=t.value[0],r=e?n.colIndex:n.rowIndex,o=e?n.rowIndex:n.colIndex,i=[[o,t.value[1]]];this._minorSpan=i,this._majorIndex=r,this._minorIndex=o,this._pattern.push([r,i]),this._nextResult=t}}next(e){if(e!==void 0)throw new Rp;const t=this._nextResult,n=this._isColumn;let r=this._majorIndex,o=this._nextDelegateResult;if(!o.done){const c=o.value[0];if((n?c.colIndex:c.rowIndex)===r&&(o=this._delegate.next(),this._nextDelegateResult=o,!o.done)){const u=o.value,d=u[0],h=n?d.colIndex:d.rowIndex,f=n?d.rowIndex:d.colIndex;if(h===r)return this._minorSpan.push([f,u[1]]),this._minorOffset=this._minorSpan.length-1,this._minorIndex=f,this._nextResult=o,t}}const i=this._minorMax;let l=this._minorIndex;if(l<i){let c=this._minorOffset;c++;const u=this._minorSpan;c>=u.length&&(c=0,this._minorRepeat++);const d=u[c],h=this._minorMin;if(l=h+(d[0]-h+this._minorSize*this._minorRepeat),this._minorIndex=l,this._minorOffset=c,l<=i){const f=[{colIndex:n?r:l,rowIndex:n?l:r},d[1]];return this._nextResult={done:!1,value:f},t}}if(!o.done){const c=o.value,u=c[0],d=n?u.colIndex:u.rowIndex,h=n?u.rowIndex:u.colIndex,f=[[h,c[1]]];return this._pattern.push([d,f]),this._majorIndex=d,this._minorSpan=f,this._minorOffset=0,this._minorIndex=h,this._minorRepeat=0,this._nextResult=o,t}const a=this._majorMax;if(r<a){let c=this._majorOffset;c++;const u=this._pattern;c>=u.length&&(c=0,this._majorRepeat++);const d=u[c],h=d[1],f=h[0],g=this._majorMin;if(r=g+(d[0]-g+this._majorSize*this._majorRepeat),this._majorIndex=r,this._majorOffset=c,r<=a){this._minorSpan=h,this._minorOffset=0,l=f[0],this._minorIndex=l,this._minorRepeat=0;const m=[{colIndex:n?r:l,rowIndex:n?l:r},f[1]];return this._nextResult={done:!1,value:m},t}}return t.done||(this._nextResult=Ct),t}return(e){return null}throw(e){return null}[Symbol.iterator](){return this}};class Zg{constructor(e,t,n){this._comparator=e?.comparator??J.createCellComparator(e.orientation??ct.Column,e.reverse??!1),this._iterator1=t,this._iterator2=n;const r=t.next();this._nextResult1=r;const o=n.next();this._nextResult2=o,e?.reuseResult&&(e.reuseResult===!0?this._reuseResult={done:!1,value:[void 0,void 0,void 0,void 0]}:this._reuseResult=e.reuseResult)}next(e){let t=this._nextResult1,n=this._nextResult2;if(t.done&&n.done)return t;if(t.done){const l=n;this._nextResult2=this._iterator2.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[2]=u[0],c[3]=u[1],c[0]=void 0,c[1]=void 0,a}if(n.done){const l=t;this._nextResult1=this._iterator1.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[0]=u[0],c[1]=u[1],c[2]=void 0,c[3]=void 0,a}let r=(0,this._comparator)(t.value[0],n.value[0]);if(r<0){const l=t;this._nextResult1=this._iterator1.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[0]=u[0],c[1]=u[1],c[2]=void 0,c[3]=void 0,a}if(r>0){const l=n;this._nextResult2=this._iterator2.next();const a=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};a.done=!1;const c=a.value,u=l.value;return c[2]=u[0],c[3]=u[1],c[0]=void 0,c[1]=void 0,a}this._nextResult1=this._iterator1.next(),this._nextResult2=this._iterator2.next();const o=this._reuseResult??{done:!1,value:[void 0,void 0,void 0,void 0]};o.done=!1;const i=o.value;return i[0]=t.value[0],i[1]=t.value[1],i[2]=n.value[0],i[3]=n.value[1],o}return(e){return null}throw(e){return null}[Symbol.iterator](){return this}}const Yg="Must be an array of arrays.",aa=(s,e,t)=>{const n=e.majorStart,r=e.minorStart,o=e.majorEnd,i=[],l=e.minorEnd-r+1,a=typeof s=="function";for(let c=n;c<=o;c++){const u=new Array(l);if(a)if(t){let h=r;for(let f=0;f<l;f++)u[f]=s(h++,c)}else{let h=r;for(let f=0;f<l;f++)u[f]=s(c,h++)}else u.fill(s,0,l);const d=[[r,u]];i.push([c,d])}return{tuples:i,bounds:e}},Da=(s,e=!1,t=null,n=!1)=>{let r=0,o=0,i=Number.MAX_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER;if(t&&(r=t.majorStart??0,o=t.minorStart??0,i=(t.majorEnd??Number.MAX_SAFE_INTEGER)-r+1,l=(t.minorEnd??Number.MAX_SAFE_INTEGER)-o+1),e){const c=r;r=o,o=c;const u=i;i=l,l=u}if(!Array.isArray(s))throw new Error(Yg);if(s.length>i)throw new Nt;const a=e?new At.TransposedBuilder:new At.Builder;for(let c=0;c<s.length;c++){let u=s[c];if(u!=null&&u.length!==0){if(!Array.isArray(u))throw new Error(Yg);if(u.length>l)throw new Nt;if(n){let d=-1;for(let h=0;h<u.length;h++)u[h]==null?d!==-1&&(a.addValues(c+r,o+d,u.slice(d,h)),d=-1):d===-1&&(d=h);d!==-1&&a.addValues(c+r,o+d,u.slice(d))}else a.addValues(c+r,o,u)}}return a.build()},k1=(s,e,t)=>{if(s===e)return e},N1=(s,e,t)=>{if(s[0].value===s[1].value)return e},F1=[null,null],oo=(s=!0,e=k1)=>{const t=[];let n,r,o=Number.MIN_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER;return{append:(l,a,c)=>{let u=!0;if(c!==void 0){const f=r===void 0?c:e(r,c,s);f===void 0?u=!1:c=f}if(u&&a===i+1&&l===o)return s?n.rowEnd=a:n.colEnd=a,i=a,void(r=c);n&&t.push(n);const d=s?l:a,h=s?a:l;n={colStart:d,rowStart:h,colEnd:d,rowEnd:h,value:c},o=l,i=a,r=c},done:(l=!1)=>(n&&(t.push(n),n=null),l?mr(t,s?ct.Column:ct.Row,2,N1,F1):t)}};class wr{constructor(e){this._major=null,this._dataCoords=null,this._count=0,this._isColumn=!0,this._lastMajor=Number.MIN_SAFE_INTEGER,this._lastMinorSpan=null,this._maxCoords=null,this._isShared=!1,this._options={orientation:ct.Row,...e},this._isColumn=(e?.orientation??ct.Column)===ct.Column,e?.maxCoords&&(this._maxCoords=Object.freeze({colStart:Math.max(0,e.maxCoords.colStart??0),rowStart:Math.max(0,e.maxCoords.rowStart??0),colEnd:Math.min(Number.MAX_SAFE_INTEGER,e.maxCoords.colEnd??Number.MAX_SAFE_INTEGER),rowEnd:Math.min(Number.MAX_SAFE_INTEGER,e.maxCoords.rowEnd??Number.MAX_SAFE_INTEGER)})),this._createRun=e?.createRun??(t=>new Zn(t)),this._optionsMinor={},this._major=new Mi({nodeSize:O1})}getRuns(e){const t=this._isColumn,n=this._maxCoords,r=this.getCoords();if(!r)return Qt;const o=e?.bounds;let i,l;if(o){const p=Pn(o?.colStart??Number.MIN_SAFE_INTEGER,o?.rowStart??Number.MIN_SAFE_INTEGER,o?.colEnd??Number.MAX_SAFE_INTEGER,o?.rowEnd??Number.MAX_SAFE_INTEGER,t,n,r);if(!p)return Qt;i={bounds:{min:p.majorStart,max:p.majorEnd}},l={bounds:{min:p.minorStart,max:p.minorEnd}}}const a=this._major.entries(i);let c=a.next();if(c.done)return Qt;let u=c.value[0],d=c.value[1],h=d.runs(l),f=h.next();if(f.done)return Qt;let g=f.value[0].min,m=f.value[1];return{[Symbol.iterator](){return this},next(){if(c.done)return Ct;const p={done:!1,value:[u,g,m]};for(f=h.next();f.done&&!c.done;)c=a.next(),c.done||(u=c.value[0],d=c.value[1],h=d.runs(l),f=h.next());return f.done||(g=f.value[0].min,m=f.value[1]),p}}}getOrientation(){return this._isColumn?ct.Column:ct.Row}entries(e){const t=this._isColumn;let n=t,r=!0;const o=this._maxCoords,i=this.getCoords(),l=Pn(Number.MIN_SAFE_INTEGER,Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,t,o,i);if(!l)return Qt;let a,c,u,d=l.majorStart,h=l.majorEnd,f=l.minorStart,g=l.minorEnd,m=!1;if(e){e?.orientation&&(n=e?.orientation===ct.Column,r=t===n);const y=e?.bounds;if(y){const _=Pn(y.colStart,y.rowStart,y.colEnd,y.rowEnd,t,o,i);if(!_)return Qt;d=_.majorStart,h=_.majorEnd,f=_.minorStart,g=_.minorEnd}m=e.reverse??!1,u=(_=>typeof _!="boolean"?_:_===!0?{done:!1,value:[{colIndex:-1,rowIndex:-1},null]}:void 0)(e.reuseResult),a=t?e.processColumnSkip:e.processRowSkip,a&&(m?h=a(h,m):d=a(d,m)),c=t?e.processRowSkip:e.processColumnSkip,c&&(m?g=c(h,m):f=c(f,m))}if(!i)return Qt;r||d!==h||(r=!0),Bt.bounds.min=d,Bt.bounds.max=h,Bt.reverse=m,Bt.processSkip=a,Bt.reuseResult=bi;let p=this._major.entries(Bt),w=Qg();const S=y=>{if(!y.nextActive)return;const _=x=>{const R=y.nextMinorIndex,I=y.nextMinorValue,A=y.nextActive;return x?(y.nextMinorIndex=x[0],y.nextMinorValue=x[1],y.nextActive=!0):(y.nextActive=!1,y.nextMinorIndex=m?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER,y.nextMinorValue=null),y.value=I,y.minorIndex=R,y.active=A,Ur[0]=y.majorIndex,Ur[1]=R,Ur[2]=I,Ur},C=y.minorIterator;if(!C)return _();const E=C.next();return E.done&&(y.minorIterator=null),_(E.value)},b=y=>{if(p)for(;;){const _=p.next();if(_.done)return void(p=void 0);const C=_.value,E=C[1];E||console.warn("issue",E),y.majorIndex=C[0],y.active=!0,y.nextActive=!1,jn.bounds.min=f,jn.bounds.max=g,jn.reverse=m,jn.processSkip=c,jn.reuseResult=W0;const x=E.entries(jn),R=x.next();if(!R.done){const I=R.value;return y.nextMinorIndex=I[0],y.nextMinorValue=I[1],y.minorIterator=x,y.nextActive=!0,S(y)}}};let v=null;if(r)v=()=>{let y;return y=S(w),y||(y=b(w),y||void 0)};else{const y=m?g:f,_=m?f:g;let C,E=y,x=_,R=!0;const I=()=>{if(w.nextMajorCursor)return w=w.nextMajorCursor,w;w=C,(E<f||E>g||E===x)&&(w=null),E=x,x=_};v=()=>{for(;w;){let A=null;if(R){let M=C?Qg():w;if(A=b(M),A){C?(M.prevMajorCursor=w,w.nextMajorCursor=M,w=M):C=w,x=m?Math.max(x,w.nextMinorIndex):Math.min(x,w.nextMinorIndex);const k=w.minorIndex;k!==y&&(x=m?Math.max(x,k):Math.min(x,k),A=null)}else R=!1,I()}else{const M=w.minorIndex,k=w.nextMinorIndex;M===E?(Ur[0]=w.majorIndex,Ur[1]=M,Ur[2]=w.value,A=Ur):!m&&M>E||m&&M<E?x=m?Math.max(x,M):Math.min(x,M):!m&&k>E||m&&k<E?x=m?Math.max(x,k):Math.min(x,k):A=S(w),w.active&&(x=m?Math.max(x,w.nextMinorIndex):Math.min(x,w.nextMinorIndex)),_===E||w.active||(w.prevMajorCursor?w.prevMajorCursor.nextMajorCursor=w.nextMajorCursor:C=w.nextMajorCursor,w.nextMajorCursor&&(w.nextMajorCursor.prevMajorCursor=w.prevMajorCursor)),I()}if(A)return A}}}return{next(y){if(y)throw new Rp("Iterator with next argument is not supported.");const _=v();return _?((C,E,x,R,I)=>{const A=I??{done:!1,value:[{colIndex:-1,rowIndex:-1},null]},M=A.value,k=M[0];return k.colIndex=R?C:E,k.rowIndex=R?E:C,M[1]=x,A})(_[0],_[1],_[2],t,u):Ct},[Symbol.iterator](){return this},return:y=>null,throw:y=>null}}values(e){const t=this.entries(e);let n;return e?.reuseResult&&(n=e.reuseResult===!0?{done:!1,value:null}:e.reuseResult),{next(r){const o=t.next(r);return o.done?Ct:n?(n.value=o.value[1],n):{done:!1,value:o.value[1]}},[Symbol.iterator](){return this},return:r=>null,throw:r=>null}}keys(e){const t=this.entries(e);let n;return e?.reuseResult&&(n=e.reuseResult===!0?{done:!1,value:null}:e.reuseResult),{next(r){const o=t.next(r);return o.done?Ct:n?(n.value=o.value[0],n):{done:!1,value:o.value[0]}},[Symbol.iterator](){return this},return:r=>null,throw:r=>null}}_updateMajorSpan(e,t=!1){if(!e||e.length===0)return;t&&e.sort((a,c)=>a[0]-c[0]);const n=this._major,r=e[0];let o=r[0],i=o,l=[r[1]];for(let a=1;a<e.length;a++){const c=e[a],u=c[0],d=c[1];u===i+1?l.push(d):(n.setRunAt(o,new Zn(l)),o=u,l=[d]),i=u}l.length>0&&n.setRunAt(o,new Zn(l))}setValues(e){if(!e)throw new sr;if(e.length===0)return this;const t=(e=e.sort(Xg))[0][0],n=e[e.length-1][0];let r=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER;const i=this._isColumn,l=this._maxCoords;if(l){const y=i?l.colStart:l.rowStart,_=i?l.colEnd:l.rowEnd;if(t<y||n>_)throw new Nt;r=i?l.rowStart:l.colStart,o=i?l.rowEnd:l.colEnd}if(!e||e.length===0)return this;let a=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER,u=0,d=t-1;const h=[],f=(y,_,C)=>{if(d===C)throw new At.OutOfOrderError(`Duplicate major Indices: {${C}}.`);d=C,_=_.sort(Xg),y=y.clone();let E=Number.MIN_SAFE_INTEGER;const x=_.length;for(let R=0;R<x;R++){const I=_[R],A=I[0],M=I[1],k=A+M.length-1;if(E>=A)throw new At.OutOfOrderError(`Overlapping minor Indices: {${C}, ${A}}.`);if(A<r||k>o)throw new Nt;if(M&&M.length>0){const F=y.getCount();y.setRunAt(A,g(M));const L=y.getCount();u+=L-F,a=Math.min(a,y.getCoords().min),c=Math.max(c,y.getCoords().max)}E=k}p++,h.push([C,y])},g=this._createRun,m=this._optionsMinor;let p=0;const w=()=>{const y=e[p],_=y[0],C=y[1],E=new Mi(m);f(E,C,_)},S=this._major;Bt.bounds.min=t,Bt.bounds.max=n,Bt.reverse=!1,Bt.processSkip=null,Bt.reuseResult=bi;const b=S.entries(Bt);let v=b.next();for(;!v.done;){const y=v.value,_=y[0];let C=e[p],E=C[0];if(E>_)v=b.next();else{for(;E<_;)w(),C=e[p],E=C[0];if(E===_){const x=C[1],R=y[1];f(R,x,_)}v=b.next()}}for(;e[p];)w();return this._updateMajorSpan(h),this._updateCountAndCoords(u,t,a,n,c),this}_updateCountAndCoords(e,t,n,r,o,i=!1){const l=this._count+e;if(this._count=l,this._lastMajor=Number.MIN_SAFE_INTEGER,!this._dataCoords)return;const a=this._isColumn;let c=a?t:n,u=a?n:t,d=a?r:o,h=a?o:r;if(l===0)this._dataCoords=null;else{const f=this._dataCoords;f&&(c=(i?Math.max:Math.min)(c,f.colStart),u=(i?Math.max:Math.min)(u,f.rowStart),d=(i?Math.min:Math.max)(d,f.colEnd),h=(i?Math.min:Math.max)(h,f.rowEnd));const g={colStart:c,rowStart:u,colEnd:d,rowEnd:h};this._dataCoords=g}}clear(){this._major.clear(),this._dataCoords=null,this._count=0}delete(e){const t=this._count;if(!e)return this.clear(),t>0;const n=this._isColumn,r=this._maxCoords,o=this.getCoords(),i=Pn(e.colStart,e.rowStart,e.colEnd,e.rowEnd,n,r,o);if(!i||t===0)return!1;if(J.isRangeWithinRange(o,e))return this.clear(),t>0;const l=i.majorStart,a=i.majorEnd,c=i.minorStart,u=i.minorEnd;let d=n?o.colStart:o.rowStart,h=n?o.colEnd:o.rowEnd;const f=n?o.rowStart:o.colStart,g=n?o.rowEnd:o.colEnd;let m=!1,p=0;const w=this._major;if(c<=f&&u>=g){Bt.bounds.min=l,Bt.bounds.max=a;const E=w.entries(Bt);let x=E.next();for(;!x.done;)p-=x.value[1].getCount(),x=E.next();return w.delete(l,a-l+1),this._count+=p,this._dataCoords=null,p!==0}const S=[],b=this._isShared,v=[];Bt.bounds.min=l,Bt.bounds.max=a,jn.reverse=!1,jn.processSkip=null,jn.reuseResult=bi;const y=w.entries(Bt);let _=y.next();for(;!_.done;){const E=_.value,x=E[0];let R=E[1];const I=R.getCoords(),A=I.min,M=I.max;if(c<=A&&u>=A||c<=M&&c<=M)if((A===f&&c<=f||M===g&&u>=g)&&(m=!0),A>=c&&M<=u)S.push(x),p-=R.getCount();else{const k=R.getCount();b&&(R=R.clone(),v.push([x,R])),R.delete(c,u-c+1),p+=R.getCount()-k}_=y.next()}this._updateMajorSpan(v);const C=S.length;if(C>0){const E=Eg(S,!0);for(let R=0;R<E.length;R++){const I=E[R];w.delete(I.min,I.max-I.min+1)}const x=w.getCoords();if(!x)return this.clear(),!0;d=x.min,h=x.max}return m?(this._count+=p,this._dataCoords=null,!0):C===0?(this._count+=p,p!==0):(this._updateCountAndCoords(p,d,f,h,g,!0),p!==0)}shift(e,t){if(!e||!t)throw new sr;const n=this._isColumn,r=this._maxCoords,o=t===Ot.Right||t===Ot.Down,i=t===Ot.Left||t===Ot.Right,l=Pn(e.colStart,e.rowStart,e.colEnd,e.rowEnd,n,r,e);if(!l)return!1;const a=l.majorStart,c=l.majorEnd,u=l.minorStart,d=l.minorEnd,h=this.getCoords();if(!h)return!1;const f=n?h.colStart:h.rowStart,g=n?h.colEnd:h.rowEnd,m=n?h.rowStart:h.colStart,p=n?h.rowEnd:h.colEnd,w=u<=m&&d>=p,S=n===i;if((S&&w||!S&&a<=f&&c>=g)&&!Pn(h.colStart,h.rowStart,h.colEnd+(o&&i?e.colEnd-e.colStart+1:0),h.rowEnd+(o&&!i?e.rowEnd-e.rowStart+1:0),n,r)||S&&a>g||!S&&u>p)return!1;let b=S?c-a+1:d-u+1;if(!o&&(b*=-1,J.isRangeWithinRange(h,e)))return this.clear(),!0;let v=0;const y=this._major,_=[];if(Bt.bounds.min=a,Bt.bounds.max=S?Number.MAX_SAFE_INTEGER:c,jn.reverse=!o,jn.processSkip=null,jn.reuseResult=bi,S&&w){if(!o){Bt.bounds.max=c;const z=y.entries(Bt);let j=z.next();for(;!j.done;)v-=j.value[1].getCount(),j=z.next()}y.shift(a,b);const H=y.getCoords();return this._dataCoords=null,this._updateCountAndCoords(v,H.min,m,H.max,p),!0}let C=n?h.colStart:h.rowStart,E=n?h.colEnd:h.rowEnd,x=n?h.rowStart:h.colStart,R=n?h.rowEnd:h.colEnd;o||(x=Number.MAX_SAFE_INTEGER,R=Number.MIN_SAFE_INTEGER);let I=Number.MAX_SAFE_INTEGER;r&&(I=i?r.colEnd:r.rowEnd);const A=new Set,M=S?new Map:null,k=[],F=y.entries(Bt),L={bounds:{min:u,max:d}};let N=F.next();for(;!N.done;){const H=N.value,z=H[0],j=H[1].clone(),q=j.getCoords(),P=q.min,U=q.max;if(S&&M.set(z,j),u<=U){const ne=j.getCount();S?(z>=a-b&&a1(j.runs(L),(ve,le)=>{const Ce=le.min,re=le.max;let ae=ve;Ce-1<=d&&re>d&&(ae=ae.slice(0,d+1-Ce)),Ce<u&&re+1>=u&&(ae=ae.slice(u-Ce)),k.push({majorIndex:z+b,minorIndex:Math.max(Ce,u),run:ae})}),j.delete(u,d-u+1)):j.shift(u,b);const ee=j.getCount();if(ee===0)A.add(z),x=Math.min(x,U),R=Math.max(R,P);else{const ve=j.getCoords();if(x=Math.min(x,ve.min),R=Math.max(R,ve.max),R>I)throw new Nt}v+=ee-ne,_.push([z,j])}N=F.next()}const D=this._optionsMinor;let O=!1;for(let H=0;H<k.length;H++){const z=k[H],j=z.majorIndex,q=z.run;let P=M.get(j);P||(P=new Mi(D),M.set(j,P),_.push([j,P]),O=!0),P.setRunAt(z.minorIndex,q),v+=q.length,C=Math.min(C,j),E=Math.max(E,j),A&&A.delete(j)}if(this._updateMajorSpan(_,O),A&&A.size>0){const H=Array.from(A.values()),z=Eg(H);for(let q=0;q<z.length;q++){const P=z[q];y.delete(P.min,P.max-P.min+1)}const j=y.getCoords();if(!j)return this.clear(),!0;C=j.min,E=j.max}if(R!==p||x!==m)return this._count+=v,this._dataCoords=null,!0;{const H=this._count+v;this._count=H,this._dataCoords=H===0?null:Object.freeze({colStart:n?C:x,rowStart:n?x:C,colEnd:n?E:R,rowEnd:n?R:E})}return v!==0||!J.isEqualRanges(h,this.getCoords())}getCount(){return this._count}getValueAt(e,t){const n=this._isColumn,r=n?t:e,o=n?e:t,i=this._lastMajor;let l;if(i===r&&i!==Number.MIN_SAFE_INTEGER?l=this._lastMinorSpan:(l=this._major.at(r),this._lastMajor=r,this._lastMinorSpan=l),!!l)return l.at(o)}setValueAt(e,t,n){const r=this._isColumn,o=[r?t:e,[[r?e:t,[n]]]];this.setValues([o])}copyTo(e,t,n){if(this.getCount()===0)return;const r=this.getOrientation(),o=e.getOrientation(),i=this.getRuns({bounds:n});let l=i.next();const a=J.cellToRange(t);a.colEnd=n.colEnd-n.colStart+t.colIndex,a.rowEnd=n.rowEnd-n.rowStart+t.rowIndex;const c=this._isColumn,u=this._maxCoords,d=this.getCoords();let h,f=Pn(n.colStart??Number.MIN_SAFE_INTEGER,n.rowStart??Number.MIN_SAFE_INTEGER,n.colEnd??Number.MAX_SAFE_INTEGER,n.rowEnd??Number.MAX_SAFE_INTEGER,c,u,d);f={...f};const g=o!==ct.Row,m=e.getMaxCoords();h=Pn(a?.colStart??Number.MIN_SAFE_INTEGER,a?.rowStart??Number.MIN_SAFE_INTEGER,a?.colEnd??Number.MAX_SAFE_INTEGER,a?.rowEnd??Number.MAX_SAFE_INTEGER,g,m),h={...h};const p=h.majorStart-f.majorStart,w=h.minorStart-f.minorStart,S=r===o?new At.Builder:new At.TransposedBuilder;for(;!l.done;){const v=l.value[0];let y=l.value[1],_=l.value[2];y+_.length>f.minorEnd&&(_=_.slice(0,f.minorEnd-y+1)),y<f.minorStart&&(_=_.slice(f.minorStart-y),y=f.minorStart),S.addValues(v+p,y+w,_),l=i.next()}const b=S.build();e.delete(a),b&&e.setValues(b.tuples)}getCoords(){if(this._dataCoords)return this._dataCoords;if(this._major.getCount()===0)return null;let e=Number.MAX_SAFE_INTEGER,t=Number.MIN_SAFE_INTEGER,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER;const o=this._major.entries();let i=o.next();for(;!i.done;){const c=i.value,u=c[0];e=Math.min(u,e),t=Math.max(u,t);const d=c[1].getCoords();n=Math.min(d.min,n),r=Math.max(d.max,r),i=o.next()}const l=this._isColumn,a=Object.freeze({colStart:l?e:n,rowStart:l?n:e,colEnd:l?t:r,rowEnd:l?r:t});return this._dataCoords=a,a}clone(e){this._isShared=!0;const t=new wr(this._options);return t._isShared=!0,t._major=this._major.clone(),t._dataCoords=this._dataCoords,t._count=this._count,t}cloneEmpty(e){return new wr(this._options)}getMaxCoords(){return this._maxCoords||null}get[Symbol.toStringTag](){let e="";const t=this.getCoords();if(t){const n=t.colEnd-t.colStart+1,r=t.rowEnd-t.rowStart+1;e=`${this.getCount()}-${this._isColumn?n:r}x${this._isColumn?r:n}`}return`[SparseGrid:${e}]`}}wr||(wr={});const O1=12;Object.seal({done:!1,value:null});const Ur=[-1,-1,null],W0=Object.seal({done:!1,value:[-1,null]}),bi=Object.seal({done:!1,value:[-1,null]}),jn={bounds:{min:-1,max:-1},reverse:!1,processSkip:null,reuseResult:W0},Bt={bounds:{min:-1,max:-1},reverse:!1,processSkip:null,reuseResult:bi},Qg=()=>({majorIndex:-1,minorIndex:-1,value:null,active:!1,nextMinorIndex:-1,nextActive:!1,nextMinorValue:null,minorIterator:null,nextMajorCursor:null,prevMajorCursor:null});let D1=class gd{constructor(e){if(this._l=0,this._at=null,this._dt=ef.Undefined,this._a32=null,this._a64=null,this._cv=null,this._vt=null,this._vi32=null,this._vi64=null,this._vf32=null,this._vf64=null,!e)throw new Error("options is required");const t=e.length;if(this._l=t,this._dt=e.type,this._cv=e.getCoercedValue??null,t>0){e.types&&(this._at=e.types,this._vt=new Uint8Array(this._at));const n=e.values32??null;n&&(this._a32=n,this._vi32=new Int32Array(n),this._vf32=new Float32Array(n));const r=e.values64??null;if(r&&(this._a64=r,this._vf64=new Float64Array(r),this._vi64=new BigInt64Array(r)),!n&&!r)throw new Error("values32 or values64 is required")}}getConstructorOptions(){return{length:this._l,type:this._dt,types:this._at,values32:this._a32,values64:this._a64,getCoercedValue:this._cv}}at(e){if(e>>>0>=this._l)return;const t=this._vt,n=t&&t[e]||this._dt;let r,o=!1;switch(this._vi32?r=this._vi32[e]:(o=!0,r=Number(this._vi64[e])),n){case ca:return o?Number(r):r;case Ti:return o?this._vf64[e]:this._vf32[e];case ua:return!!r;case da:case ha:return this._cv(n,o?Number(r):r);case vi:return this._vi64[o?e:r];case Ci:return this._vf64[o?e:r];case U0:return Number.NaN;case q0:return Number.MAX_SAFE_INTEGER;case J0:return Number.MIN_SAFE_INTEGER;case j0:return 1/0;case G0:return-1/0;case K0:return null;case th:case ga:return}return this._cv(n,o?Number(r):r)}toArray(e){const t=[],n=Math.max(e,this._l);for(let r=0;r<n;r++)t.push(this.at(r));return t}get length(){return this._l}get[Symbol.toStringTag](){return"[MixTypedArrayList]"}toString(){const e=this._a32,t=this._a64;let n="";return e&&!t?n="32":t&&!e&&(n="64"),`{${n}${this._at?"":":SINGLE_TYPE"}}:${this._l}}`}static _createArrayBuffer(e){try{return new SharedArrayBuffer(e)}catch{}return new ArrayBuffer(e)}static fromArray(e,t,n,r,o=L1){const i=e.length;if(i===0)return new gd({type:ef.Undefined,length:i,getCoercedValue:n});let l=this._createArrayBuffer(i*Int8Array.BYTES_PER_ELEMENT),a=new Uint8Array(l),c=0,u=!1,d=tf(e[0],r);for(let _=0;_<i;_++){const C=e[_],E=tf(C,r);E!==Ci&&E!==vi||c++,d!==E&&(a[_]=E,u=!0)}u||(a=null,l=null);let h,f,g,m,p,w,S,b,v=!1;c/i>o&&(v=!0,c=i),c!==0&&(g=this._createArrayBuffer(c*BigInt64Array.BYTES_PER_ELEMENT),m=new BigInt64Array(g),p=new Float64Array(g)),v?(h=m,f=p):(w=this._createArrayBuffer(i*Int32Array.BYTES_PER_ELEMENT),S=new Int32Array(w),b=new Float32Array(w),h=S,f=b);let y=d;if(v)for(let _=0;_<i;_++){const C=e[_];switch(a&&(y=a[_]||d),y){case ca:h[_]=BigInt(C);break;case ua:h[_]=BigInt(C?1:0);break;case Ti:f[_]=C;break;case vi:h[_]=C;break;case Ci:f[_]=C;break;case da:case ha:h[_]=BigInt(t?.(y,C)??0);break;default:y>127&&y<255&&(h[_]=BigInt(t?.(y,C)??0))}}else{let _=0;for(let C=0;C<i;C++){const E=e[C];switch(a&&(y=a[C]||d),y){case ca:h[C]=E;break;case ua:h[C]=E?1:0;break;case Ti:f[C]=E;break;case vi:S[C]=_,m[_]=E,_++;break;case Ci:S[C]=_,p[_]=E,_++;break;case da:case ha:h[C]=t?.(y,E)??0;break;default:y>127&&y<255&&(h[C]=t?.(y,E)??0)}}}return new gd({length:i,types:u?l:null,type:d,values32:w,values64:g,getCoercedValue:n})}};const L1=.1,ca=1,Ti=2,ua=3,vi=4,Ci=5,da=6,ha=7,j0=8,G0=9,U0=10,q0=11,J0=12,K0=13,th=14,ga=127,ef={Undefined:th},tf=(s,e)=>{switch(typeof s){case"number":const t=s;return Number.isNaN(t)?U0:t===1/0?j0:t===-1/0?G0:Object.is(t,-0)?Ti:t===Number.MAX_SAFE_INTEGER?q0:t===Number.MIN_SAFE_INTEGER?J0:Number.isInteger(t)&&t<=2147483647&&t>=-2147483648?ca:Math.fround(t)===t?Ti:Ci;case"string":return da;case"boolean":return ua;case"object":if(s===null)return K0;if(s instanceof Error)return ha;if(!e)return ga;const n=e(s);if(n<128||n>255)throw new Error("Custom type must be between 128 and 255");return n;case"bigint":return vi;case"undefined":return th;case"symbol":case"function":return ga}return ga},xi=s=>{if(!s||s.length<=1)return!1;if(s.length===2)return J.isRangesIntersect(s[0],s[1]);const e=new _t;e.load(s);const t=s.length;for(let n=0;n<t;n++)if(e.search(s[n]).length>1)return!0;return!1},fd=(s,e,t)=>{const n=[];if(J.isRangesIntersect(s,e)){const r=V.subtractRect({top:s.rowStart,left:s.colStart,bottom:s.rowEnd+1,right:s.colEnd+1},{top:e.rowStart,left:e.colStart,bottom:e.rowEnd+1,right:e.colEnd+1},t===ct.Column),o=r.length;for(let i=0;i<o;i++){const l={colStart:r[i].left,rowStart:r[i].top,colEnd:r[i].right-1,rowEnd:r[i].bottom-1};n.push(l)}}else n.push(s);return n},nf=(s,e,t)=>{if(!e||!s?.[0])return;const n=s.length;for(let r=0;r<n;r++){const o=s[r];J.intersectRanges(o,e)&&t(o,!J.isRangeWithinRange(o,e),r)}},rf=(s,e)=>{const t=s.colStart,n=s.rowStart,r=e.colStart,o=e.rowStart;return(i,l)=>{const a=i.colIndex-t,c=l.colIndex-r;return a===c?i.rowIndex-n-(l.rowIndex-o):a-c}},of=(s,e)=>{const t=s.colStart,n=s.rowStart,r=e.colStart,o=e.rowStart;return(i,l)=>{const a=i.rowIndex-n,c=l.rowIndex-o;return a===c?i.colIndex-t-(l.colIndex-r):a-c}},fa=(s,e,t=!1,n=!1)=>{let r=e.colEnd-e.colStart+1,o=e.rowEnd-e.rowStart+1;if(n){const c=r;r=o,o=c}const i={colStart:s.colStart,rowStart:s.rowStart,colEnd:s.colStart+r-1,rowEnd:s.rowStart+o-1};if(t){let c=s.colStart,u=s.rowStart;return J.isSingleCell(s)?(c+=r-1,u+=o-1):(c+=s.colEnd-s.colStart,u+=s.rowEnd-s.rowStart),i.colEnd=n?u:c,i.rowEnd=n?c:u,i}const l=s.colEnd-s.colStart+1;if(l%r!==0)return i;const a=s.rowEnd-s.rowStart+1;return a%o!==0||(i.colEnd=s.colStart+l-1,i.rowEnd=s.rowStart+a-1),i};let ou=class{constructor(e,t){this._l=0,e&&t>0&&(this._u=e,this._l=t)}at(e){if(e>this._l||e<0||!this._u)return;const t=Math.floor(e%this._u.length);return this._u.at(t)}toArray(e){const t=[],n=this._u,r=n.length;for(let o=0;o<e;o++){const i=Math.floor(o%r);t.push(n.at(i))}return t}get length(){return this._l}get[Symbol.toStringTag](){return"[RepeatingList]"}get isIList(){return!0}};class gn{constructor(e,t,n=null,r=!1){this._isLiteral=!1,this._values=e,this._coords=t,this._type=n,this._isLiteral=r}getValueAt(e,t,n){const r=this._coords;if(!r)return;let o=this._values.getValueAt(e+r.rowStart,t+r.colStart)??null;o===void 0&&(o=null);const i=n?.type,l=i!==void 0?i:this._type;return l&&(o=nr(o,pn(o,!0),l)),o}_applyBuilder(e,t,n=!1){if(!t)return e;const r=t.build();return r&&(n&&(e=e.clone()),e.setValues(r.tuples)),e}_cloneFromBuilder(e,t,n,r){if(!e)return this;const o=e.build();if(!o)return this;let i=this._values;const l=i.getOrientation(),a=(t?.orientation??l)===B.Orientation.Column,c=Hi(o.bounds,a),u=this._coords??J.EmptyRange,d=Math.max(c.colEnd-c.colStart+1,n??u.colEnd-u.colStart+1),h=Math.max(c.rowEnd-c.rowStart+1,r??u.rowEnd-u.rowStart+1),f=u.colStart,g=u.rowStart,m=f+d-1,p=g+h-1;return i=i.clone(),i.setValues(o.tuples),new gn(i,{colStart:f,rowStart:g,colEnd:m,rowEnd:p},this._type,this._isLiteral)}forEach(e,t){if(!e)return;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value,i=e(o.value,o.coords,this);if(i)return i.break;r=n.next()}}reduce(e,t,n){if(!e)return t;const r=this.entries(n);let o=r.next(),i=t;for(;!o.done;){const l=o.value;i=e(i,l.value,l.coords,this),o=r.next()}return i}some(e,t){if(!e)return!1;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value;if(e(o.value,o.coords,this))return!0;r=n.next()}return!1}every(e,t){if(!e)return!0;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value;if(!e(o.value,o.coords,this))return!1;r=n.next()}return!0}replace(e,t){let n;if(n=e?.isIRange?e:$1(e,this._values,this._coords,this._type),this.size===0)return n;if(n.size===0)return this;const r=this._values.clone(),o=n._values,i=n._coords??J.EmptyRange,l=this._coords??J.EmptyRange,a=l.colStart,c=l.rowStart,u=a+(t.colIndex??0),d=c+(t.rowIndex??0);o.copyTo(r,{colIndex:u,rowIndex:d},i);const h=Math.max(this.getWidth(),n.getWidth()+(t?.colIndex??0)),f=Math.max(this.getHeight(),n.getHeight()+(t?.rowIndex??0));return new gn(r,{colStart:a,rowStart:c,colEnd:a+h-1,rowEnd:c+ +f-1},this._type)}slice(e){if(!e)return this;const t=this._coords??J.EmptyRange,n=(e.colStart??0)+t.colStart,r=(e.rowStart??0)+t.rowStart,o={colStart:n,rowStart:r,colEnd:(e.colEnd??t.colEnd-n)+t.colStart,rowEnd:(e.rowEnd??t.rowEnd-r)+t.rowStart},i=J.intersectRanges(t,o);return new gn(this._values,i,this._type)}resize(e,t,n=null){if(e<0||t<0)throw new Error(`Invalid resize dimensions: ${e} x ${t}`);const r=this._coords??J.EmptyRange,o=r.colEnd-r.colStart+1,i=r.rowEnd-r.rowStart+1;if(e===o&&t===i)return this;const l={colStart:r.colStart,rowStart:r.rowStart,colEnd:r.colStart+e-1,rowEnd:r.rowStart+t-1};let a=this._values;return(e>o||t>i)&&(a=a.clone(),e>o&&(sn.colStart=r.colEnd+1,sn.rowStart=r.rowStart,sn.colEnd=r.colEnd,sn.rowEnd=r.rowEnd,this._fill(a,r,n)),t>i&&(sn.colStart=r.colStart,sn.rowStart=r.rowEnd+1,sn.colEnd=r.colEnd,sn.rowEnd=r.rowEnd,this._fill(a,r,n))),new gn(a,l,this._type)}_mergeIterators(e,t,n){const r=this._coords??J.EmptyRange,o=e._coords??J.EmptyRange,i=this._values.getOrientation(),l=n?.orientation??i,a=l!==B.Orientation.Row,c=this._entries(n),u=this._entries(n),d=r.colStart,h=r.rowStart,f=d-o.colStart,g=h-o.rowStart,m=l===i?new At.Builder:new At.TransposedBuilder,p=new Zg({...n,bounds:r,comparator:(a?rf:of)(r,o)},c,u);let w=p.next();for(;!w.done;){const S=w.value;let b=S[1],v=S[3];const y=S[0],_=S[2],C=y?y.colIndex:_.colIndex+f,E=y?y.rowIndex:_.rowIndex+g,x=t(b,v,{colIndex:C-d,rowIndex:E-h},this),R=a?C:E,I=a?E:C;m.addValue(R,I,x),w=p.next()}return m}intersect(e,t,n){if(!e)throw new Error("Invalid range to intersect");const r=e,o=this._coords??null,i=r._coords??null;if(!J.intersectRanges(o,i))return new gn(this._values,null,this._type);const l=this._mergeIterators(r,t,n);return this._cloneFromBuilder(l,n)}startIncrementalUpdates(e){const t=e?.orientation??B.Orientation.Column,n=this._values.getOrientation(),r=(e?.orientation??n)!==B.Orientation.Row,o=t===n?new At.Builder:new At.TransposedBuilder,i=this,l=this._coords??J.EmptyRange,a=l.colStart,c=l.rowStart,u=r?a:c,d=r?c:a,h={pushAt(f,g,m){const p=r?g:f,w=r?f:g;return o.addValue(p+u,w+d,m),h},pushMultipleAt(f,g,m){const p=r?g:f,w=r?f:g;return o.addValues(p+u,w+d,m),h},apply(){const f=o.build();return f?(f.bounds.majorStart=u,f.bounds.minorStart=d,i._cloneFromBuilder(o,e)):null}};return h}map(e,t){const n=this._values;if(!this._coords||n.getCount()===0)return this;const r=n.getOrientation(),o=t?.orientation??r;let i;const l=this.entries(t);let a=l.next();a.done||(i=this._createTupleBuilder(o));const c=o===B.Orientation.Column;for(;!a.done;){const u=a.value,d=u.coords,h=e(u.value,d,this),f=c?d.colIndex:d.rowIndex,g=c?d.rowIndex:d.colIndex;i.addValue(f,g,h),a=l.next()}return this._cloneFromBuilder(i,t)}filter(e,t){const n=this._values;if(!this._coords||n.getCount()===0)return this;const r=n.getOrientation(),o=t?.orientation??r,i=this._createTupleBuilder(o),l=this.entries(t);let a=l.next();const c=o===B.Orientation.Column;for(;!a.done;){const u=a.value,d=u.coords,h=u.value;if(e(h,d,this)){const f=c?d.colIndex:d.rowIndex,g=c?d.rowIndex:d.colIndex;i.addValue(f,g,h)}a=l.next()}return this._cloneFromBuilder(i,t)}broadcast(e,t,n){let r=this._coords;if(e==null)return this;let o=n?.type,i=n?.otherType??o;const l=o?nr(null,Me.Null,o):null,a=i?nr(null,Me.Null,i):null;let c;if(e.isIRange)c=e;else{const O=this._values.clone();O.setValueAt(0,0,e),c=new gn(O,J.EmptyRange,pn(e,!0))}const u=c,d=this.getWidth(),h=this.getHeight(),f=u.getWidth(),g=u.getHeight();let m=Math.min(d,f),p=Math.min(h,g),w=Math.max(d,f),S=Math.max(h,g);const b=n?.mismatchFill;let v=!1;if(d!==f)if(d===1)m=f;else if(f===1)m=d;else{if(!b)throw new Error(`Incompatible shapes for broadcast: width dimensions ${d} and ${f} must be equal or one must be 1`);v=!0}if(h!==g)if(h===1)p=g;else if(g===1)p=h;else{if(!b)throw new Error(`Incompatible shapes for broadcast: height dimensions ${h} and ${g} must be equal or one must be 1`);v=!0}const y=this._values.getOrientation(),_=y,C=_===B.Orientation.Column;r=r??J.EmptyRange;let E,x,R=u._coords??J.EmptyRange;if(v&&(r={colStart:r.colStart,rowStart:r.rowStart,colEnd:r.colStart+m-1,rowEnd:r.rowStart+m-1},R={colStart:R.colStart,rowStart:R.rowStart,colEnd:R.colStart+m-1,rowEnd:R.rowStart+m-1}),d===1&&d<f||h===1&&h<g){const O={...r};d===1&&(O.colEnd=O.colStart),h===1&&(O.rowEnd=O.rowStart),E=new hd({delegate:this._entries({...n,orientation:_,bounds:O,reuseResult:!1}),bounds:O,orientation:_,dims:{major:C?m:p,minor:C?p:m}})}else E=this._entries({...n,orientation:_,bounds:r,reuseResult:!1});if(f===1&&f<d||g===1&&g<h){const O={...R};f===1&&(O.colEnd=O.colStart),g===1&&(O.rowEnd=O.rowStart),x=new hd({delegate:u._entries({...n,type:i??null,orientation:_,bounds:O,reuseResult:!1}),bounds:O,orientation:_,dims:{major:C?m:p,minor:C?p:m}})}else x=u._entries({...n,type:i??null,orientation:_,bounds:R,reuseResult:!1});const I=r.colStart,A=r.rowStart,M=I-R.colStart,k=A-R.rowStart,F=_===y?new At.Builder:new At.TransposedBuilder,L=new Zg({...n,bounds:r,comparator:(C?rf:of)(r,R)},E,x);let N,D=L.next();for(;!D.done;){const O=D.value;let H=O[1],z=O[3];const j=O[0],q=O[2],P=j?j.colIndex:q.colIndex+M,U=j?j.rowIndex:q.rowIndex+k;let ne,ee;H instanceof He.Value?ne=H:z instanceof He.Value&&(ne=z),ee=ne||t(H??l,z??a,{colIndex:P-I,rowIndex:U-A},this);const ve=C?P:U,le=C?U:P;F.addValue(ve,le,ee),D=L.next()}if(b&&w>m||S>p){const O=this._values.clone();if(this._applyBuilder(O,F),w>m){const H=Pn(I+m,A,I+w-1,A+S-1,C),z=aa(b,H,C);O.setValues(z.tuples)}if(S>p){const H=Pn(I,A+p,I+w-1,A+S-1,C),z=aa(b,H,C);O.setValues(z.tuples)}N=new gn(O,{colStart:I,rowStart:A,colEnd:I+w-1,rowEnd:A+S-1},this._type)}else N=this._cloneFromBuilder(F,n,w,S);return N}_fill(e,t,n){if(n===null)return void e.delete(t);const r=e.getOrientation()===B.Orientation.Column,o=Pn(t.colStart,t.rowStart,t.colEnd,t.rowEnd,r),i=aa(n,o,r);e.setValues(i.tuples)}_validateCoords(e){}fill(e,t){let n=this._coords;if(!n&&!t)return this;n=n??J.EmptyRange,t&&(sn.colStart=(t.colStart??0)+n.colStart,sn.rowStart=(t.rowStart??0)+n.rowStart,sn.colEnd=(t.colEnd??n.colEnd-n.colStart)+n.colStart,sn.rowEnd=(t.rowEnd??n.rowEnd-n.rowStart)+n.rowStart),this._validateCoords(sn);const r=this._values.clone();return this._fill(r,sn,e),(sn.rowEnd>n.rowEnd||sn.colEnd>n.colEnd)&&(n={colStart:n.colStart,rowStart:n.rowStart,colEnd:Math.max(n.colEnd,sn.colEnd),rowEnd:Math.max(n.rowEnd,sn.rowEnd)}),new gn(r,n,this._type)}empty(){const e=this._values.cloneEmpty();return new gn(e,null,this._type)}flatten(e){const t=[],n=this.values(e);let r=n.next();for(;!r.done;)t.push(r.value),r=n.next();return t}fillEmpty(e,t=1,n=1){const r=this._coords;if(!r)return this;const o=this._values;if(t<1&&n<1)throw new Error("Must be at least size of 1");const i=o.getOrientation(),l=i,a=l===B.Orientation.Column,c=Math.max(this.getWidth(),t),u=Math.max(this.getHeight(),n),d=a?r.colStart:r.rowStart,h=a?r.rowStart:r.colStart,f=a?r.colStart+c-1:r.rowStart+u-1,g=a?r.rowStart+u-1:r.colStart+c-1,m=o.getRuns({bounds:{colStart:r.colStart,rowStart:r.rowStart,colEnd:a?f:g,rowEnd:a?g:f},overflowRun:!0});let p=m.next(),w=d,S=h;const b=l===i?new At.Builder:new At.TransposedBuilder;for(;!p.done;){const v=p.value,y=v[0];for(;w<y;){const R=new ou([e],g+1-S);b.addValues(w,S,R),w++,S=h}const _=v[1],C=Math.max(_,h),E=v[2],x=Math.min(_+E.length-1,g);if(S<C){const R=new ou([e],_-S);b.addValues(w,S,R)}S=x+1,x>=g?(w=y+1,S=h):w=y,p=m.next()}for(;w<=f;){const v=new ou([e],g+1-S);b.addValues(w,S,v),w++,S=h}return this._cloneFromBuilder(b,void 0,c,u)}transpose(){if(this.size<=1)return this;const e=this._values.getOrientation(),t=this._coords,n=this.getWidth(),r=this.getHeight(),o=this._entries({orientation:e===B.Orientation.Column?B.Orientation.Row:B.Orientation.Column,bounds:t,reuseResult:!0}),i=e===B.Orientation.Column,l=new At.Builder,a=i?t.colStart:t.rowStart,c=i?t.rowStart:t.colStart;let u=o.next();for(;!u.done;){const d=u.value,h=d[0],f=i?h.colIndex:h.rowIndex-a,g=(i?h.rowIndex:h.colIndex-c)+a,m=f+c,p=d[1];l.addValue(g,m,p),u=o.next()}return this._cloneFromBuilder(l,void 0,r,n)}values(e){const t=this.entries(e);return{[Symbol.iterator](){return this},next(){const n=t.next();return n.done?Ct:{done:!1,value:n.value.value}}}}_createTupleBuilder(e){const t=this._coords,n=this._values.getOrientation(),r=e??n,o=r!==B.Orientation.Row,i=o?t.colStart:t.rowStart,l=o?t.rowStart:t.colStart;return r===n?new At.Builder(null,i,l):new At.TransposedBuilder(null,i,l)}entries(e){const t=this._coords;if(!t)return Qt;const n=e?.bounds;if(e={...e,bounds:t},n){const i=(n.colStart??0)-t.colStart,l=(n.rowStart??0)-t.rowStart,a=Math.max(i+t.colStart,t.colStart),c=Math.max(l+t.rowStart,t.rowStart),u=Math.min((n.colEnd??Number.MAX_SAFE_INTEGER)-i,t.colEnd-t.colStart)+1,d=Math.min((n.rowEnd??Number.MAX_SAFE_INTEGER)-l,t.rowEnd-t.rowStart)+1;e.bounds={colStart:a,rowStart:c,colEnd:a+u-1,rowEnd:c+d-1}}const r=this._entries(e),o={[Symbol.iterator]:()=>o,next(){for(;;){let i=r.next();if(i.done)return Ct;const l=i.value,a=l[0];return{done:!1,value:{coords:{colIndex:a.colIndex-t.colStart,rowIndex:a.rowIndex-t.rowStart},value:l[1]}}}}};return o}_entries(e){if(!this._coords)return Qt;let t=this._values.entries(e);const n=e?.type??this._type;let r=null;if(e?.includeEmpty&&(t=new V0(t,e),n&&(r=nr(null,Me.Null,n))),n){const o=t,i=e.coerce??!1,l=e.includeBoolean??!1,a=e.includeMistyped??!1;t={[Symbol.iterator]:()=>t,next(){for(;;){let c=o.next();if(c.done)return Ct;const u=c.value,d=u[1];let h=d;if(h==null)h=r;else if(n&&(i||!a)){let f=pn(h,!0),g=f!==n;if(g&&(i&&(h=nr(h,f,n,l),g=h?.isFormulaError),g&&!a))continue}return h===d?c:{done:!1,value:[u[0],h]}}}}}return t}getValues(e){if(!this._coords)return[[]];const t={...e,includeEmpty:!0,reverse:!1,bounds:{colStart:0,rowStart:0,colEnd:this.getWidth()-1,rowEnd:this.getHeight()-1}};let n=!1;t.orientation=e?.orientation??B.Orientation.Row,e&&(e.maxHeight&&(t.bounds.rowEnd=0+e.maxHeight-1),e.maxWidth&&(t.bounds.colEnd=0+e.maxWidth-1),e.trailingEmpties&&(n=e.trailingEmpties),t.orientation=e?.orientation??B.Orientation.Row);const r=[];if(!n){t.includeEmpty=!1,t.reverse=!0;const d=this.entries(t).next();if(d.done)return B1;const h=d.value.coords;t.bounds.colEnd=h.colIndex,t.bounds.rowEnd=h.rowIndex,t.includeEmpty=!0,t.reverse=!1}const o=this.entries(t),i=t.orientation!==B.Orientation.Row,l=e?.onValue;let a,c=-1,u=[];for(a=o.next();!a.done;){const d=a.value,h=d.coords,f=i?h.colIndex:h.rowIndex;f!==c&&(u=[],r.push(u),c=f);let g=d.value;if(l){const m=l(g,h.rowIndex,h.colIndex,this);m!==void 0&&(g=m)}u.push(g),a=o.next()}return r}toType(e){return new gn(this._values,this._coords,e,this._isLiteral)}getWidth(){const e=this._coords;return e?e.colEnd-e.colStart+1:0}getHeight(){const e=this._coords;return e?e.rowEnd-e.rowStart+1:0}get size(){const e=this._coords;return e?(e.colEnd-e.colStart+1)*(e.rowEnd-e.rowStart+1):0}isLiteral(){return this._isLiteral}getScalarType(){return this._type}[Symbol.iterator](){const e=this.entries();return{next(){const t=e.next();return t.done?Ct:{done:!1,value:t.value.value}},[Symbol.iterator](){return this}}}get[Symbol.toStringTag](){return"[Range]"}toString(){const e=this._coords,t=e?`${e.colEnd-e.colStart+1}x${e.rowEnd-e.rowStart+1}`:He.Ref.toString();let n="{";const r=this.entries({includeEmpty:!0,orientation:B.Orientation.Row});let o=r.next(),i=0,l=o.value?.coords.rowIndex??0;for(;!o.done&&i<10;){const a=o.value;a.coords.rowIndex>l?(n+=";",l=a.coords.rowIndex):i>0&&(n+=","),i++;let c=a.value;typeof c=="string"?c=`"${c}"`:typeof c=="boolean"&&(c=c?"TRUE":"FALSE"),n+=c,o=r.next()}return o.done?n+="}":n+="...",`[${t}:${n}]`}get isIRange(){return!0}}const sn={colStart:Number.MIN_SAFE_INTEGER,rowStart:Number.MIN_SAFE_INTEGER,colEnd:Number.MAX_SAFE_INTEGER,rowEnd:Number.MAX_SAFE_INTEGER},B1=Object.freeze([Object.freeze([null])]),Yi=Object.freeze({colStart:0,rowStart:0,colEnd:Math.pow(2,14)-1,rowEnd:Math.pow(2,20)-1}),z1=Object.freeze({colIndex:0,rowIndex:0}),md=()=>Yi,pn=(s,e=!1)=>typeof s=="number"?isNaN(s)||s===1/0||s===-1/0?Me.Error:Me.Number:typeof s=="string"?Me.String:typeof s=="boolean"?Me.Boolean:s?.isFormulaError?Me.Error:s===null?Me.Null:V.isObject(s)&&s.hasOwnProperty("type")&&typeof s.type=="string"?Me.RichData:e&&Ms(s)?"Date":s===void 0?(console.warn("undefined"),Me.Null):null,sf=new Map([[Me.Null,"any"],[Me.Number,"number"],[Me.String,"string"],[Me.Boolean,"boolean"],[Me.Error,"FormulaError"],[Me.RichData,"richData"],["*","Scalar"]]),P1=new Map([["p","IReferenceRange"],["r","IRange"]]),H1={orientation:B.Orientation.Row},nr=(s,e,t=Me.Number,n=!1,r=!1)=>{if(e===t||!t)return e===Me.Number&&(s=rc(s,null,"number")),s;if(t===Me.Number){switch(e){case Me.Null:return 0;case Me.String:let o=0;try{const i=vw(s);o=i&&typeof i.value=="number"?i.value:Number.NaN}catch{}return!Number.isFinite(o)||Math.abs(o)>999e305?He.BuiltIn.Value:o;case Me.Boolean:return n?s?1:0:He.BuiltIn.Value;case"Date":return Ki(s,r)??He.BuiltIn.Value;case Me.Error:return s}return s.toString()}if(t===Me.String){switch(e){case Me.Null:return"";case Me.Number:return s.toString();case Me.Boolean:return s?"TRUE":"FALSE";case Me.Error:return s}return s}if(t===Me.Boolean){switch(e){case Me.Null:return 0;case Me.Number:return!!s;case Me.String:let o=s.trim().toUpperCase();return o==="TRUE"||o!=="FALSE"&&He.BuiltIn.Value;case Me.Error:return s}return He.BuiltIn.Value}if(t==="Date"){switch(e){case Me.Number:return Ts(s,r)??He.BuiltIn.Value;case Me.String:try{const o=qd(s,r);if(o)return o.asJSDate??He.BuiltIn.Value}catch{}return s;case Me.Error:return s}return He.BuiltIn.Value}return He.BuiltIn.Value},lf=s=>{let e=s;for(;Array.isArray(e);){if(e.length>1)return!1;e=e[0]}return!e||!e.isIRange||e.size===1},X0=(s,e,t,n,r,o=!1)=>{if(Array.isArray(t)){const i=t.length;for(let l=0;l<i;l++){let a=t[l];if(Array.isArray(a)){const c=X0(s,e,a,n,r,o);if(o)continue;if(c instanceof He.Value)return c}else{if(n){if(a=nr(a,pn(a,!0),n,o),o)continue;if(a instanceof He.Value)return a}e.push(a)}}return}if(t&&t.colStart!==void 0){let i=s.getReference?.(t);n&&(i=i.toType(n)),t=i}if(t?.isIRange)return((i,l)=>{let a=i.next();for(;!a.done;){let c=a.value;if(c instanceof He.Value)return c;l.push(c),a=i.next()}})(t.values({type:n,coerce:!0,includeMistyped:!o,...H1}),e);if(n){if(t=nr(t,pn(t,!0),n,r!==null),o)return;if(t instanceof He.Value)return t}e.push(t)},Zs=(s,e,t,n,r,o)=>{if(r==="r"){let l=t;return l&&l.isIReferenceRange?(n&&(l=l.toType(n)),void e.push(t)):new He.Value("Cannot convert a literal to a reference.")}let i=t?.isIRange?t:null;if(r!=="l"){if(i){const l=i.getValues({type:n});return void e.push(l)}{Array.isArray(t)||(t=[t]);const l=t.length,a=new Array(l);for(let c=0;c<l;c++){let u=t[c];Array.isArray(u)||(u=[u]);const d=u.length,h=new Array(d);for(let f=0;f<d;f++){let g=u[f];if(n&&(g=nr(g,pn(g,!0),n)),g instanceof He.Value)return g;h[f]=g}a[c]=h}e.push(a)}}else{if(i)n&&i.getScalarType()!==n&&(i=i.toType(n));else try{if(!o&&(t=rc(t),n&&(t=nr(t,pn(t,!0),n,!0),t?.isFormulaError&&n!==Me.Error)))return e.push(t),t;i=s.getRange(t),n&&(i=i.toType(n))}catch(l){return l}e.push(i)}},rc=(s,e,t=typeof s)=>{if(t==="number")return isNaN(s)?He.BuiltIn.Num:isFinite(s)?s+=0:He.BuiltIn.Div0;if(s==null)return null;if(!e)return s;if(Array.isArray(s))try{s=e.getRange(s)}catch{return He.BuiltIn.Value}return e.isValidDate(s)?(e.formatResults("Short Date"),e.toOADate(s)):s},$1=(s,e,t,n)=>{let r;r=Array.isArray(s)?Array.isArray(s[0])?s:[s]:[[s]],e||(e=new wr({orientation:B.Orientation.Column}));const o=e.getOrientation()===B.Orientation.Column,i=Da(r,o,Pn(t?.colStart??0,t?.rowStart??0,void 0,void 0,o),!0),l=Hi(i.bounds,o);return e.setValues(i.tuples),new gn(e,l,n,!t)},V1=new RegExp(/^([$]?[a-zA-Z]*[$]?[0-9]*)[:]?([$]?[a-zA-Z]*[$]?[0-9]*)?$/),W1=new RegExp(/^(R(?:\[?[-+]?\d+\]?|\d+)?C(?:\[?[-+]?\d+\]?|\d+)?)(:(R(?:\[?[-+]?\d+\]?|\d+)?C(?:\[?[-+]?\d+\]?|\d+)?))?$/,"i"),j1=new RegExp(/^(R?)(\[?[-+]?\d+\]?|\d+)?(C?)(\[?[-+]?\d+\]?|\d+)?$/,"i"),G1=new RegExp("(?:'[^']+'|[A-Za-z0-9_\\-.]+?!)?(\\$?[A-Za-z]+\\$?\\d+(?::\\$?[A-Za-z]+\\$?\\d+)?|\\$?[A-Za-z]+:\\$?[A-Za-z]+|\\$?\\d+:\\$?\\d+)","g"),U1=/\s+/g,q1=/"(?:[^"]|"")*"|\[[^[\]]+\]/g,su=/[\uE000-\uF8FF]/g,rn="#REF!",Z0=Math.pow(2,14),J1=Math.pow(2,20);let af,cf;const Sr=s=>(af===s||(cf=""+(s+1),af=s),cf);let uf,iu;const lr=s=>{if(uf===s)return iu;if(uf=s,s<0)throw new Error("invalid column "+s);let e="";for(++s;s;s=Math.floor((s-1)/26))e=String.fromCharCode((s-1)%26+65)+e;return iu=e,iu},K1=/[^a-zA-Z0-9]/,Qi=s=>s?lr(s.colIndex)+Sr(s.rowIndex):null,co=s=>{if(!s)return rn;const e=lr(s.colIndex),t=Sr(s.rowIndex);return(s.$colIndex?"$"+e:e)+(s.$rowIndex?"$"+t:t)},nh=(s,e)=>{let t=s??e;var n;return t&&(t=Jd(t),t=t.replace(/'/g,"''"),n=t,K1.test(n)&&(t=p0(t))),t},Y0=(s,e)=>s?s+(s.endsWith("!")?"":"!")+e:rn,Pr=(s,e,t=Qi)=>{if(!s)return null;const n=s.colStart,r=s.rowStart,o=s.colEnd,i=s.rowEnd;if(n===o&&r===i)return t({colIndex:n,rowIndex:r});s={...e,...s};const l=n===Number.MIN_SAFE_INTEGER||e&&n<=e.colStart&&o>=e.colEnd,a=r===Number.MIN_SAFE_INTEGER||e&&r<=e.rowStart&&i>=e.rowEnd;let c=null;c=a?lr(n):l?Sr(r):t({colIndex:n,rowIndex:r});let u=null;return u=a?lr(o):l?Sr(i):t({colIndex:o,rowIndex:i}),c+":"+u},lu=(s,e,t=co)=>{if(!s)return rn;const n=s.colIndex,r=s.rowIndex,o=n===Number.MIN_SAFE_INTEGER;let i=null;if(r===Number.MIN_SAFE_INTEGER?(i=lr(n),s.$colIndex&&(i="$"+i)):o?(i=Sr(r),s.$rowIndex&&(i="$"+i)):i=t(s),s.sheetName||e){const l=nh(s.sheetName,e);i=Y0(l,i)}return i},Nr=(s,e,t=co)=>{if(!s)return rn;const n=s.rowStart!==void 0&&s.rowStart===s.rowEnd;if(s.colStart!==void 0&&s.colStart===s.colEnd&&n)return t({colIndex:s.colStart,rowIndex:s.rowStart,$colIndex:s.$colStart,$rowIndex:s.$rowStart});s={...e,...s};const r=e&&s.rowStart<=e.rowStart&&s.rowEnd>=e.rowEnd,o=e&&s.colStart<=e.colStart&&s.colEnd>=e.colEnd;let i=null;r?(i=lr(s.colStart),i=s.$colStart?"$"+i:i):o?(i=Sr(s.rowStart),i=s.$rowStart?"$"+i:i):i=t({colIndex:s.colStart,rowIndex:s.rowStart,$colIndex:s.$colStart,$rowIndex:s.$rowStart});let l=null;return r?(l=lr(s.colEnd),l=s.$colEnd?"$"+l:l):o?(l=Sr(s.rowEnd),l=s.$rowEnd?"$"+l:l):l=t({colIndex:s.colEnd,rowIndex:s.rowEnd,$colIndex:s.$colEnd,$rowIndex:s.$rowEnd}),i+":"+l},oc=(s,e,t=co)=>{const n=Nr(s,e,t),r=nh(s?.sheetName,e?.sheetName);return Y0(r,n)},Q0=(s,e=!1)=>{if(!s)return null;let t=0,n=0,r=!1,o=!1;const i=s.length;for(let a=0;a<i;++a){const c=s.charCodeAt(a);if(c>=48&&c<=57){if(n=10*n+(c-48),t===0&&!e)return}else if(c>=65&&c<=90){if(t=26*t+(c-64),n!==0)return}else if(c>=97&&c<=122){if(t=26*t+(c-96),n!==0)return}else{if(c!==36)return;if(t!==0||r){if(n!==0||o)return;o=!0}else r=!0}}const l={};return e||n!==0&&t!==0?(t>0&&(l.colIndex=t-1,r&&(l.$colIndex=r)),n>0&&(l.rowIndex=n-1,(o||e&&r)&&(l.$rowIndex=o||e&&r)),l):null},qn=(s,e=Yi,t=!1)=>{if(!s)return null;let n=s.toUpperCase();const r=nw(n,t);let o=null,i=null;if(r?.[1]){const a=!!r[2],c=t?ma:Q0;o=c(r[1],a),i=c(r[2]??r[1],a)}if(!o&&!i||o&&i&&(o.rowIndex===void 0&&i.rowIndex!==void 0||o.rowIndex!==void 0&&i.rowIndex===void 0||o.colIndex===void 0&&i.colIndex!==void 0||o.colIndex!==void 0&&i.colIndex===void 0))return null;const l={};return o&&(o.colIndex!==void 0&&(l.colStart=o.colIndex),o.rowIndex!==void 0&&(l.rowStart=o.rowIndex),o.$colIndex!==void 0&&(l.$colStart=o.$colIndex),o.$rowIndex!==void 0&&(l.$rowStart=o.$rowIndex),l?.colStart!==void 0&&l?.colStart>e?.colEnd)?null:(i&&(i.colIndex!==void 0&&(l.colEnd=i.colIndex),i.rowIndex!==void 0&&(l.rowEnd=i.rowIndex),i.$colIndex!==void 0&&(l.$colEnd=i.$colIndex),i.$rowIndex!==void 0&&(l.$rowEnd=i.$rowIndex)),{...e,...l})},el=(s,e,t=!1)=>{const n=(o=>{const i=o.lastIndexOf("!");if(i===-1)return null;let l=o.slice(0,i);return l=Jd(l),l=l.replace(/''/g,"'"),[l,o.slice(i+1)]})(s);let r;if(n){if(r=qn(n[1],e,t),!r)return null;r.sheetName=n[0]}else r=qn(s,e,t);return r||null},rh=(s,e,t=Nr,n=co)=>{if(!s||s.length===0)return null;const r=[],o=s.length;for(let i=0;i<o;i++){const l=s[i];let a=null;l?l.rowIndex!==void 0||l.colIndex!==void 0?a=n(l):l.rowStart!==void 0||l.colStart!==void 0?a=t(l,e,n):typeof l=="string"&&(a=l):a=rn,a&&r.push(a)}return r},ew=(s,e,t=oc,n=co)=>{const r=rh(s,e,t,n);return r?r.join(","):rn},tw=(s,e,t,n=el,r,o=!1)=>{if(e!==null){if(typeof e=="string"){const i=n(e,t,o);if(!i){const l=r?.(e);if(l){const a=l.length;for(let c=0;c<a;c++){const u=l[c];tw(s,u,t,n,r,o)}}return}e=i}else e.isICellRange?e=e.getCoords():e.isICell&&(e=J.cellToRange(e.getCoords()));if(e!==null){if(e.rowStart!==void 0||e.colStart!==void 0||e.colEnd!==void 0||e.rowEnd!==void 0){const i=e;s.push({...t,...i})}else if(e.rowIndex!==void 0||e.colIndex!==void 0){const i=e,l={...t,...i,colStart:i.colIndex,rowStart:i.rowIndex,colEnd:i.colIndex,rowEnd:i.rowIndex};l.sheetName===null&&t.sheetName&&(l.sheetName=t.sheetName),delete l.colIndex,delete l.rowIndex,s.push(l)}}else s.push(null)}else s.push(null)},oh=(s,e,t=el,n,r=!1)=>{if(!s)return[e];let o;o=typeof s=="string"?w0(s):s.isICellRanges?s.getCoords():Array.isArray(s)?s:[s];const i=[],l=o.length;for(let a=0;a<l;a++){const c=o[a];tw(i,c,e,t,n,r)}return i},ds=(s,e)=>{let t=0,n=0;const r=s.length;for(let o=0;o<r;++o){const i=s.charCodeAt(o);if(i>=48&&i<=57){if(t=10*t+(i-48),n===0)return}else if(i>=65&&i<=90){if(n=26*n+(i-64),t!==0)return}else if(!(i>=97&&i<=122)||(n=26*n+(i-96),t!==0))return}return e?(e.colIndex=n-1,e.rowIndex=t-1,e):{colIndex:n-1,rowIndex:t-1}},ma=(s,e=!1,t)=>{t?(t.colIndex=Number.MIN_SAFE_INTEGER,t.rowIndex=Number.MIN_SAFE_INTEGER,t.$colIndex=!1,t.$rowIndex=!1):t={colIndex:Number.MIN_SAFE_INTEGER,rowIndex:Number.MIN_SAFE_INTEGER,$colIndex:!1,$rowIndex:!1};const n=j1.exec(s);if(!n)return null;const r=n[1],o=n[3];if(!(e||r&&o))return null;if(r){const i=n[2];i?i&&(i.startsWith("[")?(t.rowIndex=parseInt(i.slice(1,-1)),t.$rowIndex=!1):(t.rowIndex=parseInt(i)-1,t.$rowIndex=!0)):(t.rowIndex=0,t.$rowIndex=!1)}if(o){const i=n[4];i?i.startsWith("[")?(t.colIndex=parseInt(i.slice(1,-1)),t.$colIndex=!1):(t.colIndex=parseInt(i)-1,t.$colIndex=!0):(t.colIndex=0,t.$colIndex=!1)}return t},pd=(s,e)=>{let t=0,n=0,r=!1,o=!1;const i=s.length;for(let l=0;l<i;++l){const a=s.charCodeAt(l);a>=48&&a<=57?t=10*t+(a-48):a>=65&&a<=90?n=26*n+(a-64):a>=97&&a<=122?n=26*n+(a-96):a===36&&(l===0?r=!0:o=!0)}return n--,t--,e.colIndex=n,e.rowIndex=t,t===-1?(e.$colIndex=r,e.$rowIndex=!1,e):n===-1?(e.$colIndex=!1,e.$rowIndex=r,e):(e.$colIndex=r,e.$rowIndex=o,e)},X1=s=>{let e=0;const t=s.length;for(let n=0;n<t;++n){const r=s.charCodeAt(n);if(r>=65&&r<=90)e=26*e+(r-64);else{if(!(r>=97&&r<=122))return e-1;e=26*e+(r-96)}}return e-1},Bn=(s,e)=>{let t=e;t?(t.rowStart=0,t.colStart=0,t.rowEnd=0,t.colEnd=0):t={rowStart:0,colStart:0,rowEnd:0,colEnd:0};let n=0,r=0,o=0,i=s.length;for(n=0;r<i&&(o=s.charCodeAt(r),o>96&&o<123&&(o-=32),!(o<65||o>91));++r)n=26*n+(o-64);for(t.colStart=--n,n=0;r<i;++r){let l=s.charCodeAt(r)-48;if(l<0||l>9)break;n=10*n+l}if(t.rowStart=--n,r===i||s.charCodeAt(++r)===58)return t.colEnd=t.colStart,t.rowEnd=t.rowStart,t;for(n=0;r!==i&&(o=s.charCodeAt(r),o>96&&o<123&&(o-=32),!(o<65||o>91));++r)n=26*n+(o-64);for(t.colEnd=--n,n=0;r!==i;++r){let l=s.charCodeAt(r)-48;if(l<0||l>9)break;n=10*n+l}return t.rowEnd=--n,t},nw=(s,e=!1)=>{const t=s.match(e?W1:V1);return s.endsWith(":")?null:t},wd={rowIndex:-1,colIndex:-1,$colIndex:!1,$rowIndex:!1},au=(s,e,t,n=Z0)=>{let r=s.lastIndexOf("!"),o="";r!==-1&&(o=s.slice(0,r)+"!",s=s.slice(r+1));let i=null;const l=()=>{let c="";const u=i.rowIndex;if(u!==-1)if(i.$rowIndex)c+=`R${u+1}`;else{const f=u-e;c+=f===0?"R":`R[${f}]`}let d="";const h=i.colIndex;if(h!==-1)if(i.$colIndex)d+=`C${h+1}`;else{const f=h-t;d+=f===0?"C":`C[${f}]`}o+=c+d};r=s.lastIndexOf(":");const a=r!==-1;if(a){const c=s.slice(0,r);s=s.slice(r+1),i=pd(c,wd),i.colIndex!==-1&&i.rowIndex!==-1&&(l(),o+=":")}return i=pd(s,wd),!a&&i.colIndex>n?s:(l(),o)},ws=[],Z1=s=>(ws.push(s),String.fromCharCode(57344+ws.length-1)),Y1=s=>{const e=s.charCodeAt(0)-57344;return ws[e]},Q1=(s,e,t)=>{let n="";const r=s.length;for(let o=0;o<r;o++){const i=s[o];n+=typeof i=="string"?i:rw(i,e,t)}return n},pa=(s,e)=>{let t="";const n=s.rowIndex;n!==Number.MIN_SAFE_INTEGER&&(s.$rowIndex?t+=`R${n+1}`:t+=n===0?"R":`R[${n+1}]`);let r="";const o=s.colIndex;return o!==Number.MIN_SAFE_INTEGER&&(s.$colIndex?r+=`C${o+1}`:r+=o===0?"C":`C[${o+1}]`),s.sheetName&&(t=nh(s.sheetName,e)+"!"+t),t+r},rw=(s,e,t)=>{let n="";const r=s.colIndex;r!==Number.MIN_SAFE_INTEGER&&(s.$colIndex?n+="$"+lr(r):n+=lr(r+t));const o=s.rowIndex;return o!==Number.MIN_SAFE_INTEGER&&(s.$rowIndex?n+="$"+Sr(o):n+=Sr(o+e)),n},PR=(s,e,t,n)=>{let r=s.colStart,o=s.rowStart,i=s.colEnd,l=s.rowEnd;const a=s.$colStart??!1,c=s.$rowStart??!1,u=s.$colEnd??!1,d=s.$rowEnd??!1;if(a||r===Number.MIN_SAFE_INTEGER||(r+=t),c||o===Number.MIN_SAFE_INTEGER||(o+=e),u||i===Number.MAX_SAFE_INTEGER||(i+=t),d||l===Number.MAX_SAFE_INTEGER||(l+=e),r>i){const f=r;r=i,i=f}if(o>l){const f=o;o=l,l=f}let h;return n?(h=n,h.colStart=r,h.rowStart=o,h.colEnd=i,h.rowEnd=l,h.$colStart=a,h.$rowStart=c,h.$colEnd=u,h.$rowEnd=d):h={colStart:r,rowStart:o,colEnd:i,rowEnd:l,$colStart:a,$rowStart:c,$colEnd:u,$rowEnd:d},s.sheetName&&(h.sheetName=s.sheetName),h},eb=(s,e,t,n)=>{ws.length=0;let r=0,o=s.replace(q1,Z1),i=0,l=o.replace(G1,(a,c,u)=>{const d=au(a,e,t);if(n){if(u>i){const f=o.slice(i,u).replace(su,(g,m)=>ws[r++]);n.push(f)}const h=a.lastIndexOf(":");if(h!==-1){const f=a.slice(0,h),g=a.slice(h+1),m=au(f,e,t),p=au(g,e,t);n.push(ma(m,!0)??m),n.push(":"),n.push(ma(p,!0)??p)}else n.push(ma(d,!0)??d)}return i=u+a.length,d});if(n&&i<o.length){const a=o.slice(i);n.push(a.replace(su,(c,u)=>ws[r++]))}return l=l.toUpperCase().replace(U1,""),l.replace(su,Y1)},Ss="Must specify an address.",ow="Only a single range is allowed for this operation. Use 'getRanges' instead.",df="Only a single cell is allowed.",sw="Invalid range. The Range must be specified as '{ TOP_LEFT:BOTTOM_RIGHT }'.",$i=s=>`Invalid address. Can not parse ${typeof s=="string"?`'${s}' `:""}as an address or named item.`,gt=()=>{throw new Error("Invalid range.")};let wa=class Sd{constructor(e,t,n=!1){this._c=e,this._cycleId=t,this._e=n}getCycleId(){return this._cycleId}getError(){return this._e}getCoords(){return this._c}setError(e,t){const n=this._c;return{...n,value:new Sd(n,t,e)}}getShifted(e){const t=e.after;if(!t)return null;const n=J.sanitizeRange(t);return{...n,value:new Sd(n,this._cycleId,this._e)}}getMerged(e,t,n){}getSplit(e,t){}};class rr{constructor(e,t){this._c=e,this._o=t}getCoords(){return this._c}getOrientation(){return this._o}getShifted(e){return e.after?{...e.after,value:new rr(e.after,this._o)}:null}getMerged(e,t,n){const r=this._o;return new rr(t,r)}getSplit(e,t){const n=this._o;return[new rr(e[0],n),new rr(e[1],n)]}getState(){return this._c}}const hf=(s,e)=>{if(!s||s.length===0)return V.EmptyArray;const t=[],n=e?B.Orientation.Column:B.Orientation.Row;for(let r=0;r<s.length;r++){const o=s[r],i=o[0],l=o[1];for(let a=0;a<l.length;a++){const c=l[a],u=c[0],d=c[1].length-1,h={colStart:e?i:u,rowStart:e?u:i,colEnd:e?i:u+d,rowEnd:e?u+d:i,value:new rr({colStart:e?i:u,rowStart:e?u:i,colEnd:e?i:u+d,rowEnd:e?u+d:i},n)};t.push(h)}}return t},_d=0,gf=1;class Mr{constructor(e,t,n){this.ref=e,this.formula=t;const r=e.colStart,o=e.rowStart;if(n){const i=n,l=i.length;for(let a=0;a<l;a++){const c=[...i[a]];i[a]=c;const u=c.length;for(let d=0;d<u;d++){const h={...c[d]};c[d]=h,h.colIndex=d+r,h.rowIndex=a+o,h.block=this}}this.calcs=i}else{const i=t.getDirectPrecedentsAt(o,r),l=i?.length??0,a=new Array(e.rowEnd-o+1),c=e.colEnd-r+1,u=a.length;for(let d=0;d<u;d++){const h=new Array(c),f=h.length;for(let g=0;g<f;g++)h[g]={block:this,colIndex:g+r,rowIndex:d+o,cycleId:0,markId:0,inDegree:0,dependents:V.EmptyArray,inputs:l===0?V.EmptyArray:new Array(l),precedents:l===0?V.EmptyArray:new Array(l),dynamic:null,cachedValue:void 0,removed:!1,pending:!1,pendingPrecedents:!1,pendingPromise:null,pendingResolved:!1,state:_d,error:void 0};a[d]=h}this.calcs=a}}toJSON(){const e=this.ref;return[Pr(e),this.formula.getTextAt(e.rowStart,e.colStart)]}getCoords(){return this.ref}getShifted(e){if(!e.after)return null;const t=J.sanitizeRange(e.after),n=[...this.calcs],r=new Mr(t,this.formula,n);return{...e.after,value:r}}setReferenceAt(e,t){const n=this.formula.setReferenceAt(e,t),r=[...this.calcs];return new Mr(this.ref,n,r)}getMerged(e,t,n){const r=this.formula,o=e.formula;if(!r.isEquals(o))return;const i=this.calcs,l=e.calcs;let a;if(n===B.Orientation.Row)a=[...i,...l];else{const c=i.length;a=new Array(c);for(let u=0;u<c;u++)a[u]=[...i[u],...l[u]]}return new Mr(t,r,a)}getSplit(e,t,n){const r=this.formula,o=t===B.Orientation.Column;let i,l;const a=this.calcs;if(o){const c=a.length;i=new Array(c),l=new Array(c);for(let u=0;u<c;u++){const d=a[u];i[u]=d.slice(0,n),l[u]=d.slice(n)}}else i=a.slice(0,n),l=a.slice(n);return[new Mr(e[0],r,i),new Mr(e[1],r,l)]}copyTo(e,t){const n=this.formula;return new Mr(e,n)}canTile(e,t){return!0}onRemove(e){const t=e.value.calcs,n=t.length;for(let r=0;r<n;r++){const o=t[r],i=o.length;for(let l=0;l<i;l++){const a=o[l];a.pendingPromise&&(a.pendingPromise.cancelled=!0),a.removed=!0}}}}const ff=Object.freeze({break:!0});var je;(je||(je={})).Type={Style:"style",Table:"table",Merge:"merge",Hyperlink:"hyperlink",Comments:"comments",Unlock:"unlock",Contentful:"contentful",Conditional:"conditional",Formula:"formula",Spill:"spill",Continuous:"continuous",Pending:"pending",CalcError:"calcError"};const tb=Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!1,[je.Type.Merge]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Formula]:!1,[je.Type.Spill]:!1,[je.Type.Pending]:!1,[je.Type.CalcError]:!1,[je.Type.Contentful]:!1,[je.Type.Conditional]:!1,[je.Type.Continuous]:!1}),iw=Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!1,[je.Type.Merge]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Formula]:!1,[je.Type.Spill]:!1,[je.Type.Pending]:!1,[je.Type.CalcError]:!1,[je.Type.Conditional]:!1,[je.Type.Continuous]:!1}),nb=Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!0,[je.Type.Merge]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Formula]:!1});Object.freeze({[je.Type.Style]:!1,[je.Type.Table]:!1,[je.Type.Hyperlink]:!1,[je.Type.Comments]:!1,[je.Type.Unlock]:!1,[je.Type.Contentful]:!1,[je.Type.Formula]:!1});const rb=Object.freeze({[je.Type.Style]:!1,[je.Type.Hyperlink]:!1,[je.Type.Continuous]:!1,[je.Type.Contentful]:!1}),Cl="This sheet is protected. To make a change, unprotect the sheet. You might be requested to enter a password.",ob=(s="update")=>`Unable to ${s}, this sheet is protected. To make a change, unprotect the sheet. You might be requested to enter a password.`,La="The range is outside of the bounds of the sheet.",mf="Listener can not be null",pf="We can't insert items. The sheet is protected.",wf=s=>`We can't create a ${s} that overlaps with another table or merge.`,Sf="Overlapping ranges can not be merged.",cu="We can't insert cells because this would push values off the end of the worksheet. These cells may appear empty but they have some formatting or formulas. Delete enough rows or columns and try again.",_f="Unable to partially fill over merged cells.",yf="Unable to sort merged cells unless they are all the same size.",On="Sheet has been closed. No further operations are allowed.",_s="IteratorContext can only be used during visit.",bf="When using addresses directly from the sheet do not include the sheet name.",lw=s=>`Unable to return more than ${s} values. To access values in a more scalable solution use 'ICellRange.forEach' or an iterator.`,vf="'setValue' expects a single value; when working with an array use 'setValue'.",Cf="Multiple selection ranges can not be copied.",xf="Unable to determine source.",Ef="When pasting before or after the cut area both areas must align.",es=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,Rf=new Set,yd=typeof process=="object"&&process?process:{},aw=(s,e,t,n)=>{typeof yd.emitWarning=="function"?yd.emitWarning(s,e,t,n):console.error(`[${t}] ${e}: ${s}`)};let Ba=globalThis.AbortController,If=globalThis.AbortSignal;if(Ba===void 0){If=class{onabort;_onabort=[];reason;aborted=!1;addEventListener(t,n){this._onabort.push(n)}},Ba=class{constructor(){e()}signal=new If;abort(t){if(!this.signal.aborted){this.signal.reason=t,this.signal.aborted=!0;for(const n of this.signal._onabort)n(t);this.signal.onabort?.(t)}}};let s=yd.env?.LRU_CACHE_IGNORE_AC_WARNING!=="1";const e=()=>{s&&(s=!1,aw("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",e))}}const Zr=s=>s&&s===Math.floor(s)&&s>0&&isFinite(s),cw=s=>Zr(s)?s<=Math.pow(2,8)?Uint8Array:s<=Math.pow(2,16)?Uint16Array:s<=Math.pow(2,32)?Uint32Array:s<=Number.MAX_SAFE_INTEGER?Sa:null:null;class Sa extends Array{constructor(e){super(e),this.fill(0)}}let sb=class Ei{heap;length;static#a=!1;static create(e){const t=cw(e);if(!t)return[];Ei.#a=!0;const n=new Ei(e,t);return Ei.#a=!1,n}constructor(e,t){if(!Ei.#a)throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}};class sh{#a;#d;#m;#I;#p;#k;#N;ttl;ttlResolution;ttlAutopurge;updateAgeOnGet;updateAgeOnHas;allowStale;noDisposeOnSet;noUpdateTTL;maxEntrySize;sizeCalculation;noDeleteOnFetchRejection;noDeleteOnStaleGet;allowStaleOnFetchAbort;allowStaleOnFetchRejection;ignoreFetchAbort;#o;#w;#r;#n;#e;#c;#h;#l;#s;#S;#i;#_;#y;#g;#b;#R;#u;#F;static unsafeExposeInternals(e){return{starts:e.#y,ttls:e.#g,sizes:e.#_,keyMap:e.#r,keyList:e.#n,valList:e.#e,next:e.#c,prev:e.#h,get head(){return e.#l},get tail(){return e.#s},free:e.#S,isBackgroundFetch:t=>e.#t(t),backgroundFetch:(t,n,r,o)=>e.#L(t,n,r,o),moveToTail:t=>e.#T(t),indexes:t=>e.#v(t),rindexes:t=>e.#C(t),isStale:t=>e.#f(t)}}get max(){return this.#a}get maxSize(){return this.#d}get calculatedSize(){return this.#w}get size(){return this.#o}get fetchMethod(){return this.#k}get memoMethod(){return this.#N}get dispose(){return this.#m}get onInsert(){return this.#I}get disposeAfter(){return this.#p}constructor(e){const{max:t=0,ttl:n,ttlResolution:r=1,ttlAutopurge:o,updateAgeOnGet:i,updateAgeOnHas:l,allowStale:a,dispose:c,onInsert:u,disposeAfter:d,noDisposeOnSet:h,noUpdateTTL:f,maxSize:g=0,maxEntrySize:m=0,sizeCalculation:p,fetchMethod:w,memoMethod:S,noDeleteOnFetchRejection:b,noDeleteOnStaleGet:v,allowStaleOnFetchRejection:y,allowStaleOnFetchAbort:_,ignoreFetchAbort:C}=e;if(t!==0&&!Zr(t))throw new TypeError("max option must be a nonnegative integer");const E=t?cw(t):Array;if(!E)throw new Error("invalid max value: "+t);if(this.#a=t,this.#d=g,this.maxEntrySize=m||this.#d,this.sizeCalculation=p,this.sizeCalculation){if(!this.#d&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(S!==void 0&&typeof S!="function")throw new TypeError("memoMethod must be a function if defined");if(this.#N=S,w!==void 0&&typeof w!="function")throw new TypeError("fetchMethod must be a function if specified");if(this.#k=w,this.#R=!!w,this.#r=new Map,this.#n=new Array(t).fill(void 0),this.#e=new Array(t).fill(void 0),this.#c=new E(t),this.#h=new E(t),this.#l=0,this.#s=0,this.#S=sb.create(t),this.#o=0,this.#w=0,typeof c=="function"&&(this.#m=c),typeof u=="function"&&(this.#I=u),typeof d=="function"?(this.#p=d,this.#i=[]):(this.#p=void 0,this.#i=void 0),this.#b=!!this.#m,this.#F=!!this.#I,this.#u=!!this.#p,this.noDisposeOnSet=!!h,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!b,this.allowStaleOnFetchRejection=!!y,this.allowStaleOnFetchAbort=!!_,this.ignoreFetchAbort=!!C,this.maxEntrySize!==0){if(this.#d!==0&&!Zr(this.#d))throw new TypeError("maxSize must be a positive integer if specified");if(!Zr(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");this.#W()}if(this.allowStale=!!a,this.noDeleteOnStaleGet=!!v,this.updateAgeOnGet=!!i,this.updateAgeOnHas=!!l,this.ttlResolution=Zr(r)||r===0?r:1,this.ttlAutopurge=!!o,this.ttl=n||0,this.ttl){if(!Zr(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.#B()}if(this.#a===0&&this.ttl===0&&this.#d===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.#a&&!this.#d){const x="LRU_CACHE_UNBOUNDED";(R=>!Rf.has(R))(x)&&(Rf.add(x),aw("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",x,sh))}}getRemainingTTL(e){return this.#r.has(e)?1/0:0}#B(){const e=new Sa(this.#a),t=new Sa(this.#a);this.#g=e,this.#y=t,this.#z=(o,i,l=es.now())=>{if(t[o]=i!==0?l:0,e[o]=i,i!==0&&this.ttlAutopurge){const a=setTimeout(()=>{this.#f(o)&&this.#x(this.#n[o],"expire")},i+1);a.unref&&a.unref()}},this.#A=o=>{t[o]=e[o]!==0?es.now():0},this.#E=(o,i)=>{if(e[i]){const l=e[i],a=t[i];if(!l||!a)return;o.ttl=l,o.start=a,o.now=n||r();const c=o.now-a;o.remainingTTL=l-c}};let n=0;const r=()=>{const o=es.now();if(this.ttlResolution>0){n=o;const i=setTimeout(()=>n=0,this.ttlResolution);i.unref&&i.unref()}return o};this.getRemainingTTL=o=>{const i=this.#r.get(o);if(i===void 0)return 0;const l=e[i],a=t[i];return!l||!a?1/0:l-((n||r())-a)},this.#f=o=>{const i=t[o],l=e[o];return!!l&&!!i&&(n||r())-i>l}}#A=()=>{};#E=()=>{};#z=()=>{};#f=()=>!1;#W(){const e=new Sa(this.#a);this.#w=0,this.#_=e,this.#M=t=>{this.#w-=e[t],e[t]=0},this.#P=(t,n,r,o)=>{if(this.#t(n))return 0;if(!Zr(r)){if(!o)throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(r=o(n,t),!Zr(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return r},this.#O=(t,n,r)=>{if(e[t]=n,this.#d){const o=this.#d-e[t];for(;this.#w>o;)this.#D(!0)}this.#w+=e[t],r&&(r.entrySize=n,r.totalCalculatedSize=this.#w)}}#M=e=>{};#O=(e,t,n)=>{};#P=(e,t,n,r)=>{if(n||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0};*#v({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#s;this.#H(t)&&(!e&&this.#f(t)||(yield t),t!==this.#l);)t=this.#h[t]}*#C({allowStale:e=this.allowStale}={}){if(this.#o)for(let t=this.#l;this.#H(t)&&(!e&&this.#f(t)||(yield t),t!==this.#s);)t=this.#c[t]}#H(e){return e!==void 0&&this.#r.get(this.#n[e])===e}*entries(){for(const e of this.#v())this.#e[e]===void 0||this.#n[e]===void 0||this.#t(this.#e[e])||(yield[this.#n[e],this.#e[e]])}*rentries(){for(const e of this.#C())this.#e[e]===void 0||this.#n[e]===void 0||this.#t(this.#e[e])||(yield[this.#n[e],this.#e[e]])}*keys(){for(const e of this.#v()){const t=this.#n[e];t===void 0||this.#t(this.#e[e])||(yield t)}}*rkeys(){for(const e of this.#C()){const t=this.#n[e];t===void 0||this.#t(this.#e[e])||(yield t)}}*values(){for(const e of this.#v())this.#e[e]===void 0||this.#t(this.#e[e])||(yield this.#e[e])}*rvalues(){for(const e of this.#C())this.#e[e]===void 0||this.#t(this.#e[e])||(yield this.#e[e])}[Symbol.iterator](){return this.entries()}[Symbol.toStringTag]="LRUCache";find(e,t={}){for(const n of this.#v()){const r=this.#e[n],o=this.#t(r)?r.__staleWhileFetching:r;if(o!==void 0&&e(o,this.#n[n],this))return this.get(this.#n[n],t)}}forEach(e,t=this){for(const n of this.#v()){const r=this.#e[n],o=this.#t(r)?r.__staleWhileFetching:r;o!==void 0&&e.call(t,o,this.#n[n],this)}}rforEach(e,t=this){for(const n of this.#C()){const r=this.#e[n],o=this.#t(r)?r.__staleWhileFetching:r;o!==void 0&&e.call(t,o,this.#n[n],this)}}purgeStale(){let e=!1;for(const t of this.#C({allowStale:!0}))this.#f(t)&&(this.#x(this.#n[t],"expire"),e=!0);return e}info(e){const t=this.#r.get(e);if(t===void 0)return;const n=this.#e[t],r=this.#t(n)?n.__staleWhileFetching:n;if(r===void 0)return;const o={value:r};if(this.#g&&this.#y){const i=this.#g[t],l=this.#y[t];if(i&&l){const a=i-(es.now()-l);o.ttl=a,o.start=Date.now()}}return this.#_&&(o.size=this.#_[t]),o}dump(){const e=[];for(const t of this.#v({allowStale:!0})){const n=this.#n[t],r=this.#e[t],o=this.#t(r)?r.__staleWhileFetching:r;if(o===void 0||n===void 0)continue;const i={value:o};if(this.#g&&this.#y){i.ttl=this.#g[t];const l=es.now()-this.#y[t];i.start=Math.floor(Date.now()-l)}this.#_&&(i.size=this.#_[t]),e.unshift([n,i])}return e}load(e){this.clear();for(const[t,n]of e){if(n.start){const r=Date.now()-n.start;n.start=es.now()-r}this.set(t,n.value,n)}}set(e,t,n={}){if(t===void 0)return this.delete(e),this;const{ttl:r=this.ttl,start:o,noDisposeOnSet:i=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:a}=n;let{noUpdateTTL:c=this.noUpdateTTL}=n;const u=this.#P(e,t,n.size||0,l);if(this.maxEntrySize&&u>this.maxEntrySize)return a&&(a.set="miss",a.maxEntrySizeExceeded=!0),this.#x(e,"set"),this;let d=this.#o===0?void 0:this.#r.get(e);if(d===void 0)d=this.#o===0?this.#s:this.#S.length!==0?this.#S.pop():this.#o===this.#a?this.#D(!1):this.#o,this.#n[d]=e,this.#e[d]=t,this.#r.set(e,d),this.#c[this.#s]=d,this.#h[d]=this.#s,this.#s=d,this.#o++,this.#O(d,u,a),a&&(a.set="add"),c=!1,this.#F&&this.#I?.(t,e,"add");else{this.#T(d);const h=this.#e[d];if(t!==h){if(this.#R&&this.#t(h)){h.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:f}=h;f===void 0||i||(this.#b&&this.#m?.(f,e,"set"),this.#u&&this.#i?.push([f,e,"set"]))}else i||(this.#b&&this.#m?.(h,e,"set"),this.#u&&this.#i?.push([h,e,"set"]));if(this.#M(d),this.#O(d,u,a),this.#e[d]=t,a){a.set="replace";const f=h&&this.#t(h)?h.__staleWhileFetching:h;f!==void 0&&(a.oldValue=f)}}else a&&(a.set="update");this.#F&&this.onInsert?.(t,e,t===h?"update":"replace")}if(r===0||this.#g||this.#B(),this.#g&&(c||this.#z(d,r,o),a&&this.#E(a,d)),!i&&this.#u&&this.#i){const h=this.#i;let f;for(;f=h?.shift();)this.#p?.(...f)}return this}pop(){try{for(;this.#o;){const e=this.#e[this.#l];if(this.#D(!0),this.#t(e)){if(e.__staleWhileFetching)return e.__staleWhileFetching}else if(e!==void 0)return e}}finally{if(this.#u&&this.#i){const e=this.#i;let t;for(;t=e?.shift();)this.#p?.(...t)}}}#D(e){const t=this.#l,n=this.#n[t],r=this.#e[t];return this.#R&&this.#t(r)?r.__abortController.abort(new Error("evicted")):(this.#b||this.#u)&&(this.#b&&this.#m?.(r,n,"evict"),this.#u&&this.#i?.push([r,n,"evict"])),this.#M(t),e&&(this.#n[t]=void 0,this.#e[t]=void 0,this.#S.push(t)),this.#o===1?(this.#l=this.#s=0,this.#S.length=0):this.#l=this.#c[t],this.#r.delete(n),this.#o--,t}has(e,t={}){const{updateAgeOnHas:n=this.updateAgeOnHas,status:r}=t,o=this.#r.get(e);if(o!==void 0){const i=this.#e[o];if(this.#t(i)&&i.__staleWhileFetching===void 0)return!1;if(!this.#f(o))return n&&this.#A(o),r&&(r.has="hit",this.#E(r,o)),!0;r&&(r.has="stale",this.#E(r,o))}else r&&(r.has="miss");return!1}peek(e,t={}){const{allowStale:n=this.allowStale}=t,r=this.#r.get(e);if(r===void 0||!n&&this.#f(r))return;const o=this.#e[r];return this.#t(o)?o.__staleWhileFetching:o}#L(e,t,n,r){const o=t===void 0?void 0:this.#e[t];if(this.#t(o))return o;const i=new Ba,{signal:l}=n;l?.addEventListener("abort",()=>i.abort(l.reason),{signal:i.signal});const a={signal:i.signal,options:n,context:r},c=(f,g=!1)=>{const{aborted:m}=i.signal,p=n.ignoreFetchAbort&&f!==void 0;if(n.status&&(m&&!g?(n.status.fetchAborted=!0,n.status.fetchError=i.signal.reason,p&&(n.status.fetchAbortIgnored=!0)):n.status.fetchResolved=!0),m&&!p&&!g)return u(i.signal.reason);const w=d;return this.#e[t]===d&&(f===void 0?w.__staleWhileFetching?this.#e[t]=w.__staleWhileFetching:this.#x(e,"fetch"):(n.status&&(n.status.fetchUpdated=!0),this.set(e,f,a.options))),f},u=f=>{const{aborted:g}=i.signal,m=g&&n.allowStaleOnFetchAbort,p=m||n.allowStaleOnFetchRejection,w=p||n.noDeleteOnFetchRejection,S=d;if(this.#e[t]===d&&(!w||S.__staleWhileFetching===void 0?this.#x(e,"fetch"):m||(this.#e[t]=S.__staleWhileFetching)),p)return n.status&&S.__staleWhileFetching!==void 0&&(n.status.returnedStale=!0),S.__staleWhileFetching;if(S.__returned===S)throw f};n.status&&(n.status.fetchDispatched=!0);const d=new Promise((f,g)=>{const m=this.#k?.(e,o,a);m&&m instanceof Promise&&m.then(p=>f(p===void 0?void 0:p),g),i.signal.addEventListener("abort",()=>{n.ignoreFetchAbort&&!n.allowStaleOnFetchAbort||(f(void 0),n.allowStaleOnFetchAbort&&(f=p=>c(p,!0)))})}).then(c,f=>(n.status&&(n.status.fetchRejected=!0,n.status.fetchError=f),u(f))),h=Object.assign(d,{__abortController:i,__staleWhileFetching:o,__returned:void 0});return t===void 0?(this.set(e,h,{...a.options,status:void 0}),t=this.#r.get(e)):this.#e[t]=h,h}#t(e){if(!this.#R)return!1;const t=e;return!!t&&t instanceof Promise&&t.hasOwnProperty("__staleWhileFetching")&&t.__abortController instanceof Ba}async fetch(e,t={}){const{allowStale:n=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:i=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:a=0,sizeCalculation:c=this.sizeCalculation,noUpdateTTL:u=this.noUpdateTTL,noDeleteOnFetchRejection:d=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:h=this.allowStaleOnFetchRejection,ignoreFetchAbort:f=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:m,forceRefresh:p=!1,status:w,signal:S}=t;if(!this.#R)return w&&(w.fetch="get"),this.get(e,{allowStale:n,updateAgeOnGet:r,noDeleteOnStaleGet:o,status:w});const b={allowStale:n,updateAgeOnGet:r,noDeleteOnStaleGet:o,ttl:i,noDisposeOnSet:l,size:a,sizeCalculation:c,noUpdateTTL:u,noDeleteOnFetchRejection:d,allowStaleOnFetchRejection:h,allowStaleOnFetchAbort:g,ignoreFetchAbort:f,status:w,signal:S};let v=this.#r.get(e);if(v===void 0){w&&(w.fetch="miss");const y=this.#L(e,v,b,m);return y.__returned=y}{const y=this.#e[v];if(this.#t(y)){const x=n&&y.__staleWhileFetching!==void 0;return w&&(w.fetch="inflight",x&&(w.returnedStale=!0)),x?y.__staleWhileFetching:y.__returned=y}const _=this.#f(v);if(!p&&!_)return w&&(w.fetch="hit"),this.#T(v),r&&this.#A(v),w&&this.#E(w,v),y;const C=this.#L(e,v,b,m),E=C.__staleWhileFetching!==void 0&&n;return w&&(w.fetch=_?"stale":"refresh",E&&_&&(w.returnedStale=!0)),E?C.__staleWhileFetching:C.__returned=C}}async forceFetch(e,t={}){const n=await this.fetch(e,t);if(n===void 0)throw new Error("fetch() returned undefined");return n}memo(e,t={}){const n=this.#N;if(!n)throw new Error("no memoMethod provided to constructor");const{context:r,forceRefresh:o,...i}=t,l=this.get(e,i);if(!o&&l!==void 0)return l;const a=n(e,l,{options:i,context:r});return this.set(e,a,i),a}get(e,t={}){const{allowStale:n=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:i}=t,l=this.#r.get(e);if(l!==void 0){const a=this.#e[l],c=this.#t(a);return i&&this.#E(i,l),this.#f(l)?(i&&(i.get="stale"),c?(i&&n&&a.__staleWhileFetching!==void 0&&(i.returnedStale=!0),n?a.__staleWhileFetching:void 0):(o||this.#x(e,"expire"),i&&n&&(i.returnedStale=!0),n?a:void 0)):(i&&(i.get="hit"),c?a.__staleWhileFetching:(this.#T(l),r&&this.#A(l),a))}i&&(i.get="miss")}#$(e,t){this.#h[t]=e,this.#c[e]=t}#T(e){e!==this.#s&&(e===this.#l?this.#l=this.#c[e]:this.#$(this.#h[e],this.#c[e]),this.#$(this.#s,e),this.#s=e)}delete(e){return this.#x(e,"delete")}#x(e,t){let n=!1;if(this.#o!==0){const r=this.#r.get(e);if(r!==void 0)if(n=!0,this.#o===1)this.#V(t);else{this.#M(r);const o=this.#e[r];if(this.#t(o)?o.__abortController.abort(new Error("deleted")):(this.#b||this.#u)&&(this.#b&&this.#m?.(o,e,t),this.#u&&this.#i?.push([o,e,t])),this.#r.delete(e),this.#n[r]=void 0,this.#e[r]=void 0,r===this.#s)this.#s=this.#h[r];else if(r===this.#l)this.#l=this.#c[r];else{const i=this.#h[r];this.#c[i]=this.#c[r];const l=this.#c[r];this.#h[l]=this.#h[r]}this.#o--,this.#S.push(r)}}if(this.#u&&this.#i?.length){const r=this.#i;let o;for(;o=r?.shift();)this.#p?.(...o)}return n}clear(){return this.#V("delete")}#V(e){for(const t of this.#C({allowStale:!0})){const n=this.#e[t];if(this.#t(n))n.__abortController.abort(new Error("deleted"));else{const r=this.#n[t];this.#b&&this.#m?.(n,r,e),this.#u&&this.#i?.push([n,r,e])}}if(this.#r.clear(),this.#e.fill(void 0),this.#n.fill(void 0),this.#g&&this.#y&&(this.#g.fill(0),this.#y.fill(0)),this.#_&&this.#_.fill(0),this.#l=0,this.#s=0,this.#S.length=0,this.#w=0,this.#o=0,this.#u&&this.#i){const t=this.#i;let n;for(;n=t?.shift();)this.#p?.(...n)}}}var lt,Af;(Af=lt||(lt={})).CalcStatus={Ready:"ready",Stale:"stale",Pending:"pending",Streaming:"streaming"},Af.Content={Values:"values",Formats:"formats",Formulas:"formula",Hyperlinks:"hyperlinks",Tables:"tables",Notes:"notes",Comments:"comments",Warnings:"warnings",Errors:"errors",Merges:"merges"};class ib{constructor(e,t,n){if(!n)throw new sr;if(typeof n=="string"&&(n={address:n}),typeof n.address!="string")throw new Error("Invalid hyperlink");this._t=e,this._r=t,this._p=n}open(e,t){return this._r(this.getAddress(),null,e??this.getTarget(),t)}getTarget(){return this._p.target||(this._p.address.startsWith("#")?"_self":"_blank")}getDisplayText(){return this._t()??this.getAddress()}getAddress(){return this._p.address??""}getTooltip(){return this._p.tooltip??null}get isIHyperlink(){return!0}}function Mf(s){return!/^(-?\d|--)/.test(s)}function Tf(s){const e=[];let t="",n="",r=7;for(let o,i=0;o=s.charAt(i);i++)if(/[a-zA-Z\d\xa0-\uffff_-]/.test(o)&&r===7)t+=o;else if(o==="\\"&&r===7)r=6;else if(o===" "&&r===7){if(t!==""){if(!Mf(t))return null;e.push(t),t=""}}else if(r===6)/[0-9a-f]/i.test(o)?(n+=o,r=8):(t+=o,r=7);else{if(r!==8)return null;/[0-9a-f]/i.test(o)&&n.length<6?n+=o:(t+=String.fromCodePoint(parseInt(n,16)),t+=o,n="",r=7)}if(t!==""){if(!Mf(t))return null;e.push(t)}return e.join(" ")}function kf(s,e){let t=e,n="";const r={"font-family":[]};for(let o,i=0;o=s.charAt(i);i+=1)if(t!==4||o!=='"'&&o!=="'")if(t===3&&o===",")t=4,n="";else if(t===4&&o===","){const l=Tf(n);l&&r["font-family"].push(l),n=""}else if(t===5&&o===" ")/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:deg|grad|rad|turn)$/.test(n)?(r["font-style"]+=" "+n,n=""):i-=1,t=1;else if(t!==1||o!==" "&&o!=="/")t===2&&o===" "?(/^(?:\+|-)?([0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(n)&&(r["line-height"]=n),t=4,n=""):n+=o;else{if(/^(?:(?:xx|x)-large|(?:xx|s)-small|small|large|medium)$/.test(n)||/^(?:larg|small)er$/.test(n)||/^(?:\+|-)?(?:[0-9]*\.)?[0-9]+(?:em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(n))t=o==="/"?2:4,r["font-size"]=n;else if(/^italic$/.test(n))r["font-style"]=n;else if(/^oblique$/.test(n))r["font-style"]=n,t=5;else if(/^small-caps$/.test(n))r["font-variant"]=n;else if(/^(?:bold(?:er)?|lighter|normal)$/.test(n))r["font-weight"]=n;else if(/^[+-]?(?:[0-9]*\.)?[0-9]+(?:e[+-]?(?:0|[1-9][0-9]*))?$/.test(n)){const l=parseFloat(n);l>=1&&l<=1e3&&(r["font-weight"]=n)}else/^(?:(?:ultra|extra|semi)-)?(?:condensed|expanded)$/.test(n)&&(r["font-stretch"]=n);n=""}else{let l=i+1;do if(l=s.indexOf(o,l)+1,!l)return null;while(s.charAt(l-2)==="\\");r["font-family"].push(s.slice(i+1,l-1).replace(/\\('|")/g,"$1")),i=l-1,t=3,n=""}if(t===3&&!/^\s*$/.test(n))return null;if(t===4){const o=Tf(n);o&&r["font-family"].push(o)}return r}const _a=s=>{if(typeof s!="string")return null;let e=function(o){const i=kf(o,4);return i!==null?i["font-family"]:null}(s);Array.isArray(e)&&e.length===0&&(e=null),e=e?{"font-family":e}:function(o){const i=kf(o,1);return i!==null&&i["font-size"]&&i["font-family"].length?i:null}(s);let t=null,n=null,r=null;if(e){let o=e["font-family"];const i=o.shift();i&&(t=i),o.length>0&&(n=o),e["font-size"]!==void 0&&(r=e["font-size"])}return{family:t,fallbacks:n,size:r}},pr=(s,e=!1)=>s?.toHex(e)?.toString(!1).toLowerCase()??null,Nf=s=>s==null?null:V.roundAccurately(s,2)+"pt",uw=(s,e)=>{let t="";const n=s&&s!==ke.UnderlineStyle.None;return e&&(t+="line-through"),n&&e&&(t+=" "),n&&(t+="underline",s!==!0&&s!==ke.UnderlineStyle.Single&&s!==ke.UnderlineStyle.SingleAccounting||(t+=" solid"),s!==ke.UnderlineStyle.Double&&s!==ke.UnderlineStyle.DoubleAccounting||(t+=" double")),t},lb=Object.freeze({underline:ke.UnderlineStyle.None,strike:!1}),dw=s=>s?(s=s.toLowerCase())==="single"?ke.UnderlineStyle.Single:s==="double"?ke.UnderlineStyle.Double:s==="single-accounting"||s==="singleaccounting"?ke.UnderlineStyle.SingleAccounting:s==="double-accounting"||s==="doubleaccounting"?ke.UnderlineStyle.DoubleAccounting:ke.UnderlineStyle.None:ke.UnderlineStyle.None,Ff=s=>s?s.toLowerCase():null,Of=s=>s?s===oe.Overflow.Visible||s===oe.Overflow.Clip||s===oe.Overflow.Shrink?"nowrap":s===oe.Overflow.Wrap?"normal":void 0:null,za=(s,e)=>{let t="";if(s&&(s.includes(" ")&&(s='"'+s+'"'),t=s),e)for(let n=0;n<e.length;n++)t.length>0&&(t+=", "),t+=e[n];return t},Df=s=>{let e="",t=!1,n="";for(let r=0;r<s.length;r++){const o=s.charAt(r);t&&o!=="]"&&o!=='"'?e+=o:o==='"'?(e+="\\0022",t=!t):["[","]",",","#",".","@","/",":",";","-"," "].includes(o)?(e+="\\"+o,o==="["?t=!0:o==="]"&&(t=!1)):["(",")"].includes(o)?e+=n==="_"?"\\"+o:"\\\\\\"+o:["$"].includes(o)?e+="\\0022"+o+"\\0022":e+=o,n=o}return'"'+e+'"'},ab="Thin",cb="Hairline",ub="Extra Light",db="Ultra Light",hb="Light",Lf="Normal",gb="Regular",fb="Medium",mb="Semi Bold",pb="Demi Bold",wb="Bold",Sb="Extra Bold",_b="Ultra Bold",yb="Black",bb="Heavy",vb="Extra Black",Cb="Ultra Black",xb="lighter",Eb="normal",Rb="bold",Ib="bolder",zt=new Map;zt.set(V.textToKey(ab),100),zt.set(V.textToKey(cb),100),zt.set(V.textToKey(ub),200),zt.set(V.textToKey(db),200),zt.set(V.textToKey(hb),300),zt.set(V.textToKey(Lf),400),zt.set(V.textToKey(gb),400),zt.set(V.textToKey(fb),500),zt.set(V.textToKey(mb),600),zt.set(V.textToKey(pb),600),zt.set(V.textToKey(Lf),400),zt.set(V.textToKey(wb),700),zt.set(V.textToKey(Sb),800),zt.set(V.textToKey(_b),800),zt.set(V.textToKey(yb),900),zt.set(V.textToKey(bb),900),zt.set(V.textToKey(vb),950),zt.set(V.textToKey(Cb),950),zt.set(V.textToKey(xb),100),zt.set(V.textToKey(Eb),400),zt.set(V.textToKey(Rb),700),zt.set(V.textToKey(Ib),700);const Ab="xx-small",Mb="x-small",Tb="small",kb="medium",Nb="large",Fb="x-large",Ob="xx-large",Db="xxx-large",Lb="smaller",Bb="larger",zb="math",Pb=new RegExp("^[0-9]*[.]?[0-9]+$","g"),Gn=new Map;Gn.set(V.textToKey(Ab),s=>.4*s),Gn.set(V.textToKey(Mb),s=>.5*s),Gn.set(V.textToKey(Tb),s=>.6*s),Gn.set(V.textToKey(kb),s=>s),Gn.set(V.textToKey(Nb),s=>1.1*s),Gn.set(V.textToKey(Fb),s=>1.25*s),Gn.set(V.textToKey(Ob),s=>1.5*s),Gn.set(V.textToKey(Db),s=>2*s),Gn.set(V.textToKey(Lb),s=>.9*s),Gn.set(V.textToKey(Bb),s=>1.1*s),Gn.set(V.textToKey(zb),s=>s);const ys=(s,e=11,t="pt")=>{if(!s)return null;let n=e;s=s.trim().toLowerCase();const r=t==="pt"?ke.getDeviceScale():1,o=t==="pt"?1:ke.getDeviceScale();if(Pb.test(s)){const i=parseFloat(s);isNaN(i)||(s=i+t)}if(s.endsWith("pt"))n=parseFloat(s.substring(0,s.length-2).trim())*o;else if(s.endsWith("px"))n=parseFloat(s.substring(0,s.length-2).trim())/r;else if(s.endsWith("em"))n=parseFloat(s.substring(0,s.length-2).trim())*e;else if(s.endsWith("rem"))n=parseFloat(s.substring(0,s.length-3).trim())*e;else if(s.endsWith("%"))n=parseFloat(s.substring(0,s.length-1).trim())/100*e;else if(typeof s=="string"){const i=V.textToKey(s),l=Gn.get(i);if(l)return l(e)}return isNaN(n)?null:n},Gt=new Map;Gt.set(Pe.BuiltInSheetPattern.None,{description:"None",cssKey:"none"}),Gt.set(Pe.BuiltInSheetPattern.Solid,{description:"Solid",cssKey:"solid"}),Gt.set(Pe.BuiltInSheetPattern.DarkGray,{description:"75% gray",cssKey:"gray-75"}),Gt.set(Pe.BuiltInSheetPattern.MediumGray,{description:"50% gray",cssKey:"gray-50"}),Gt.set(Pe.BuiltInSheetPattern.LightGray,{description:"25% gray",cssKey:"gray-25"}),Gt.set(Pe.BuiltInSheetPattern.Gray125,{description:"12.5% Gray",cssKey:"gray-125"}),Gt.set(Pe.BuiltInSheetPattern.Gray0625,{description:"6.25% Gray",cssKey:"gray-0625"}),Gt.set(Pe.BuiltInSheetPattern.DarkHorizontal,{description:"Horizontal Strip",cssKey:"horz-stripe"}),Gt.set(Pe.BuiltInSheetPattern.DarkVertical,{description:"Vertical Strip",cssKey:"vert-stripe"}),Gt.set(Pe.BuiltInSheetPattern.DarkDown,{description:"Reverse Diagonal Stripe",cssKey:"reverse-diag-stripe"}),Gt.set(Pe.BuiltInSheetPattern.DarkUp,{description:"Diagonal Strip",cssKey:"diag-stripe"}),Gt.set(Pe.BuiltInSheetPattern.DarkGrid,{description:"Diagonal Crosshatch",cssKey:"diag-cross"}),Gt.set(Pe.BuiltInSheetPattern.DarkTrellis,{description:"Thick Diagonal Crosshatch",cssKey:"thick-diag-cross"}),Gt.set(Pe.BuiltInSheetPattern.LightHorizontal,{description:"Thin Horizontal Stripe",cssKey:"thin-horz-stripe"}),Gt.set(Pe.BuiltInSheetPattern.LightVertical,{description:"Thin Vertical Stripe",cssKey:"thin-vert-stripe"}),Gt.set(Pe.BuiltInSheetPattern.LightDown,{description:"Thin Reverse Diagonal Stripe",cssKey:"thin-reverse-diag-stripe"}),Gt.set(Pe.BuiltInSheetPattern.LightUp,{description:"Thin Diagonal Stripe",cssKey:"thin-diag-stripe"}),Gt.set(Pe.BuiltInSheetPattern.LightGrid,{description:"Thin Horizontal Cross",cssKey:"thin-horz-cross"}),Gt.set(Pe.BuiltInSheetPattern.LightTrellis,{description:"Thin Diagonal Cross",cssKey:"thin-diag-cross"});let ya="";const hw=new Map;Gt.forEach((s,e)=>{ya.length>0&&(ya+="|"),ya+="\\b"+s.cssKey+"\\b",hw.set(s.cssKey,e)});const Hb=new RegExp(`(\\s*(?:${ya}))`,"g"),$b=s=>{if(!s)return null;let e=s.toLowerCase();e=e.replace(/;/,"");let t=e.match(Hb);if(!t)return null;let n=null;t&&t.length>0&&(n=(o=>{if(!o)return null;let i=e.indexOf(o);return e=e.substring(0,i)+e.substring(i+o.length,e.length),o.trim()})(t[0])),e=e.trim();const r=e?e.trim():null;return!n&&!r?null:{patternType:hw.get(n??"solid"),foreground:r??null}},gw=(s,e=!1,t=null)=>{if(!s||!s.getStops()||s.getStops().length<1)return null;if(s.getStops().length===1)return pr(s.getStops()[0].getColor(),e);let n="";for(let o=0;o<s.getStops().length;o++){const i=s.getStops()[o];n+=pr(i.getColor(),e)+" "+100*(i.getOffset()??o*(s.getStops().length-1))+"%",o<s.getStops().length-1&&(n+=", ")}let r=s.getAngle()??0;if(s.getGradientType()===Pe.GradientType.Path){const o=pr(s.getStops()[0]?.getColor(),e),i=pr((s.getStops()[1]??s.getStops()[0])?.getColor(),e),l=s.getFillTo()??{left:0,top:0,right:0,bottom:0},a=-1;let c=`${100-a}% ${100-a}%`;if(r=315,l.left===1&&l.right===1&&l.right===1&&l.bottom===1)r=135,c=`${a}% ${a}%`;else if(l.top!==0&&l.bottom!==0&&l.left===0&&l.right===0)r=225,c=`${100-a}% ${a}%`;else if(l.left===1&&l.right!==0&&l.top===0&&l.bottom===0)r=45,c=`${a}% ${100-a}%`;else if(l.left!==0&&l.right!==0&&l.top!==0&&l.bottom!==0)return`radial-gradient(${n})`;const u=70;return`conic-gradient(from ${r}deg at ${c}, ${o} 0deg, ${i} ${u/2}deg,${i} ${360-u/2}deg, ${o} 360deg)`}return`linear-gradient(${r}deg, ${n})`},bn=new Map;bn.set(pe.StrokeStyle.None,{size:null,cssKey:"none"}),bn.set(pe.StrokeStyle.DashDot,{size:.5,cssKey:"dot-dash"}),bn.set(pe.StrokeStyle.DashDotDot,{size:.5,cssKey:"dot-dot-dash"}),bn.set(pe.StrokeStyle.Dashed,{size:.5,cssKey:"dashed"}),bn.set(pe.StrokeStyle.MediumDashed,{size:1,cssKey:"dashed"}),bn.set(pe.StrokeStyle.Dotted,{size:.5,cssKey:"dotted"}),bn.set(pe.StrokeStyle.MediumDashDot,{size:1,cssKey:"dot-dash"}),bn.set(pe.StrokeStyle.MediumDashDotDot,{size:1,cssKey:"dot-dot-dash"}),bn.set(pe.StrokeStyle.Hair,{size:.5,cssKey:"hairline"}),bn.set(pe.StrokeStyle.Thin,{size:.5,cssKey:"solid"}),bn.set(pe.StrokeStyle.Thick,{size:1.5,cssKey:"solid"}),bn.set(pe.StrokeStyle.Medium,{size:1,cssKey:"solid"}),bn.set(pe.StrokeStyle.Double,{size:2,cssKey:"double"}),bn.set(pe.StrokeStyle.SlantDashDot,{size:1,cssKey:"dot-dash-slanted"});const _o=s=>{if(!s)return"none";const e=bn.get(s.getStyle());if(!e)return null;if(e.cssKey==="none")return e.cssKey;let t=((n,r=!1)=>n?.toRGBA(r).toString(!1)??null)(s?.getColor());return t=t?" "+t:"",`${e.size!==null?`${e.size}pt `:""}${e.cssKey}${t}`};let Pa=[];const Bf=new Set,bd=new Map,ki=(s,e)=>{let t=s.size!==null?`${s.size.toString()} ${s.cssKey}`:s.cssKey;bd.set(t,e),Bf.has(s.cssKey)||(Pa.push(s.cssKey),Bf.add(s.cssKey))};bn.forEach(ki);const uu=Object.keys(pe.StrokeStyle);for(let s=0;s<uu.length;s++)ki({size:null,cssKey:uu[s].toLowerCase()},pe.StrokeStyle[uu[s]]);ki({size:null,cssKey:"double"},pe.StrokeStyle.Double),ki({size:null,cssKey:"solid"},pe.StrokeStyle.Medium),ki({size:null,cssKey:"hidden"},pe.StrokeStyle.None),Pa.sort((s,e)=>e.length-s.length);let ba="";for(let s=0;s<Pa.length;s++)ba.length>0&&(ba+="|"),ba+="\\b"+Pa[s]+"\\b";const Vb=new RegExp(`(\\s*(?:${ba}))`,"g"),Wb=new RegExp("(\\s*[0-9]*[.]?[0-9]+(?:pt|px){0,1})","g"),fw=s=>{if(!s)return null;let e=s.toLowerCase(),t=e.match(Vb);if(!t)return null;const n=c=>{if(!c)return null;let u=e.indexOf(c);return e=e.substring(0,u)+e.substring(u+c.length,e.length).trim(),c.trim()};let r=null;if(t&&t.length>0&&(r=n(t[0])),!r)return null;let o=null;if(t=e.match(Wb),t&&t.length>0){let c=n(t[0]);o=parseFloat(c.substring(0,c.length-2))}e=e.trim();const i=e?e.trim():null;let l=o===null?r:`${o.toString()} ${r}`,a=bd.get(l);return a||(a=bd.get(r)),a?{color:i,style:a}:null},jb="start",Gb="end",Ub="left",qb="right",Jb="center",Kb="justify",Xb="justify-all",Zb="baseline",Yb="top",Qb="middle",ev="bottom",tv="sub",nv="text-top",rv="justify",ov="distributed",Yr=new Map;Yr.set(V.textToKey(jb),oe.HorizontalAlignment.Left),Yr.set(V.textToKey(Ub),oe.HorizontalAlignment.Left),Yr.set(V.textToKey(Gb),oe.HorizontalAlignment.Right),Yr.set(V.textToKey(qb),oe.HorizontalAlignment.Right),Yr.set(V.textToKey(Jb),oe.HorizontalAlignment.Center),Yr.set(V.textToKey(Kb),oe.HorizontalAlignment.Justify),Yr.set(V.textToKey(Xb),oe.HorizontalAlignment.Justify);const Ar=new Map;Ar.set(V.textToKey(Zb),oe.VerticalAlignment.Bottom),Ar.set(V.textToKey(Yb),oe.VerticalAlignment.Top),Ar.set(V.textToKey(Qb),oe.VerticalAlignment.Center),Ar.set(V.textToKey(ev),oe.VerticalAlignment.Bottom),Ar.set(V.textToKey(tv),oe.VerticalAlignment.Bottom),Ar.set(V.textToKey(nv),oe.VerticalAlignment.Top),Ar.set(V.textToKey(rv),oe.VerticalAlignment.Justify),Ar.set(V.textToKey(ov),oe.VerticalAlignment.Distributed);const mw=(s,e)=>{if(s instanceof $t)return{color:s};if(typeof s=="string")try{return{color:s==="none"||s==="transparent"?null:e(s)}}catch(t){throw t}return s},Vi={shorthand:(s,e)=>{if(!s||s==="none"||s==="transparent")return null;try{return e.parseColor(s).toString()}catch(t){console.warn("error",t)}return s},merge:(s,e,t)=>s},qr={shorthand:(s,e)=>{if(typeof s=="string"&&(s=fw(s)),!s)return null;const t={};return s.style&&(t.style=s.style),s.color&&(t.color=s.color),s.isIStroke?s.getProperties():t},properties:{color:Vi}},zf={shorthand:(s,e)=>s==="none"||s==="transparent"||typeof s=="object"&&Object.keys(s).length===0?{type:Pe.Type.None}:(s.getType?.(),Pe.Type.None,s)},Pf={shorthand:(s,e)=>(typeof(s=mw(s,e.parseColor.bind(e)))=="object"&&s.color&&(s.type=Pe.Type.Solid),s),merge:(s,e,t)=>s.color?s:(e?.toJSON&&(e=e.toJSON()),e?.type===Pe.Type.Solid?{...e}:e?.type===Pe.Type.Gradient?{type:Pe.Type.Solid,color:e?.stops?.[0]?.color??t.parseColor(G.Scheme.Bg1)}:e?.type===Pe.Type.Pattern?{type:Pe.Type.Solid,color:e?.foreground??t.parseColor(G.Scheme.Bg1)}:s?{...s}:null),properties:{color:Vi}},Hf={shorthand:(s,e)=>(typeof s=="object"&&s.stops&&(s.type=Pe.Type.Gradient),s),merge:(s,e,t)=>s.stops?s:(e?.toJSON&&(e=e.toJSON()),e?.type===Pe.Type.Gradient?{...e}:e?.type===Pe.Type.Solid?{type:Pe.Type.Gradient,stops:[{offset:0,color:e?.color??G.Scheme.Accent1},{offset:1,color:G.Scheme.Bg1}]}:e?.type===Pe.Type.Pattern?{type:Pe.Type.Gradient,stops:[{offset:0,color:e?.foreground??G.Scheme.Bg1},{offset:1,color:e?.background??G.Scheme.Accent1}]}:s?{...s}:null),properties:{stops:{shorthand:(s,e)=>s,arrayType:{shorthand:(s,e)=>s=mw(s,e.parseColor.bind(e)),properties:{color:Vi}}}}},$f={shorthand:(s,e)=>{if(typeof s=="object"){const t=s;(t.foreground||t.background||t.patternType)&&(t.type=Pe.Type.Pattern,t.patternType=t.patternType??Pe.BuiltInSheetPattern.Solid)}return s},merge:(s,e,t)=>{if(s.background&&s.foreground)return s;e?.toJSON&&(e=e.toJSON());const n=Pe.BuiltInSheetPattern.MediumGray;return e?.type===Pe.Type.Pattern?{...e,...s}:e?.type===Pe.Type.Solid?{patternType:n,...s,foreground:e?.color??G.Named.WindowText,background:G.Scheme.Bg1}:e?.type===Pe.Type.Gradient?{patternType:n,...s,foreground:e?.stops?.[0]?.color??G.Named.WindowText,background:e?.stops?.[1]?.color??G.Scheme.Bg1}:s?{type:Pe.Type.Pattern,patternType:Pe.BuiltInSheetPattern.Solid,foreground:G.Named.WindowText,background:G.Scheme.Bg1,...s}:null},properties:{foreground:Vi,background:Vi}},Ht={properties:{font:{shorthand:(s,e)=>{if(typeof s=="string"){const t=_a(s);if(t){const n={};if(t.family&&(n.family=t.family),t.fallbacks&&(n.fallbacks=t.fallbacks),t.size&&(n.size=ys(t.size)),Object.keys(t).length>0)return n}}return s},properties:{family:{shorthand:(s,e)=>_a(s)?.family??null},fallbacks:{shorthand:(s,e)=>{if(typeof s!="string")return s;let t=_a(s);if(!t)return null;let n=[t.family];return t.fallbacks&&(n=n.concat(t.fallbacks)),n}},size:{shorthand:(s,e)=>{let t=s;return typeof s=="string"&&(t=ys(s,e.getNormal().getFont().getSize())),isNaN(t)||typeof t!="number"?null:(t=Math.max(1,Math.min(V.roundAccurately(t,1),409)),t)}},weight:{shorthand:(s,e)=>{if(typeof s!="string")return s;const t=(n=>{let r=400;if(r=typeof n=="number"?n:parseFloat(n),!isNaN(r))return r;if(typeof n=="string"){const o=V.textToKey(n),i=zt.get(o);if(i)return i}return r})(s);return isNaN(t)||typeof t!="number"?null:t}},underline:{shorthand:(s,e)=>s?s===!0?ke.UnderlineStyle.Single:dw(s):ke.UnderlineStyle.None}}},fill:{shorthand:(s,e)=>{const t=[zf,Pf,Hf,$f];for(let n=0;n<t.length;n++){let r=t[n]?.shorthand?.(s,e);if(r?.type)return r}return s},getSubType:s=>s.type===Pe.Type.None?zf:s.type===Pe.Type.Solid?Pf:s.type===Pe.Type.Gradient?Hf:s.type===Pe.Type.Pattern?$f:null},alignment:{properties:{indent:{shorthand:(s,e)=>{let t=s;return typeof s=="string"&&(t=parseFloat(s)),isNaN(t)||typeof t!="number"?null:t}},rotation:{shorthand:(s,e)=>{let t=s;return typeof s=="string"&&(t=parseFloat(s)),isNaN(t)||typeof t!="number"?null:(t%=360,t<0&&(t+=360),t)}}}},border:{shorthand:(s,e)=>{if(typeof s=="string"){const t=fw(s);return{left:t,right:t,top:t,bottom:t,horizontal:null,vertical:null,diagonalUp:null,diagonalDown:null}}return s.isIBorder?s.getProperties():s},properties:{top:qr,left:qr,right:qr,bottom:qr,horizontal:qr,vertical:qr,diagonalUp:qr,diagonalDown:qr}},numberFormat:{shorthand:(s,e)=>{if(typeof s=="string"){let t=Vt.Styles.lookupDefault(s);return t!==void 0?t:s}return typeof s=="number"?Yd(s):null}}}},sv={properties:{style:Ht}},iv=Object.freeze({displayText:"",conditionalColor:null,repeatChars:V.EmptyArray,spacingChars:V.EmptyArray,repeatPlaceholder:null,formattedRuns:Object.freeze({runs:V.EmptyArray,length:0,width:0,lastRepeatIndex:-1}),canWrap:!1,asDate:null,isDateFormat:!1,isTimeFormat:!1,isDate1904:!1}),pw=(s,e,t,n,r,o=!1)=>{if(s==null)return iv;let i="",l=null,a=null,c=null;if(t===Me.Error)i=s.getLabel();else if(t===Me.RichData)i="(Rich Object)";else if(t===Me.Boolean)i=s?"TRUE":"FALSE";else if(n)try{i=Ud(n,s,{date1904:o,spacingCharacter:"",digitCharacter:"",onRepeatChar:(C,E)=>{a||(a=[]),a.push({offset:C,char:E})},onSpacingChar:(C,E)=>{c||(c=[]),c.push({offset:C,char:E})},onDigitChar:C=>{c||(c=[]),c.push({offset:C,char:"0"})}})}catch{}const u=Xi(n),d=tc(n),h=u||d?Ts(s,o):null;(u||d)&&parseFloat(s)<0&&(l="#",i=l.repeat(5));let f=null;const g=e.getAlignment(),m=g.getHorizontal(),p=g.getVertical(),w=g.getOverflow(),S=!(t!==Me.String||m===oe.HorizontalAlignment.Fill||a!==null&&a.length!==0||w!==oe.Overflow.Wrap&&m!==oe.HorizontalAlignment.Justify&&m!==oe.HorizontalAlignment.Distributed&&p!==oe.VerticalAlignment.Justify&&p!==oe.VerticalAlignment.Distributed);let b=i;S||t!==Me.String||(b=b.replaceAll(/\n/g,""));const v=c?.length>0||a?.length>0;if(w!==oe.Overflow.Wrap||v){const C=e.getFont();let E=C.getSize();C.isSuperSub()&&(E*=C.getSuperSubScale());let x=[];for(let L=0;L<c?.length;L++){const N=c[L],D=e.measureText(N.char,E).width;x.push({...N,type:"spacing",width:D})}if(a?.length>0){const L=a[a.length-1],N=e.measureText(L.char,E).width;x.push({...L,type:"repeat",width:N})}x=x.sort((L,N)=>L.offset-N.offset);let R=[],I=0,A=0,M=-1,k=-1;const F=L=>{const N={type:"text",width:e.measureText(L,E).width,text:L};R.push(N),A+=N.width,I+=L.length};for(let L=0;L<x.length;L++){const N=x[L];if(k!==N.offset){const O=b.substring(I,N.offset);O&&F(O)}const D={type:N.type,width:N.width,text:N.char};N.type!=="repeat"?A+=D.width:M=R.length,R.push(D),k=N.offset}if(I<b.length){let L=b.substring(I,b.length);L&&F(L)}f={runs:Object.freeze(R),length:I,width:A,lastRepeatIndex:M}}const y=wy(n,s),_={displayText:i??"",conditionalColor:y?r(y):null,repeatChars:a??V.EmptyArray,spacingChars:c??V.EmptyArray,repeatPlaceholder:l,formattedRuns:f,canWrap:S,asDate:h,isDateFormat:u,isTimeFormat:d,isDate1904:o};return Object.freeze(_)},jt=Object.freeze({fallbacks:V.EmptyArray,weight:400,style:ke.Style.Normal,fill:G.Scheme.Tx1,letterSpacing:null,underline:ke.UnderlineStyle.None,strike:!1,scheme:ke.Scheme.Minor,verticalAlign:ke.VerticalAlignment.Baseline,shadow:!1,outline:!1,extend:!1}),Jr=Object.freeze({style:pe.StrokeStyle.None,color:G.Scheme.Tx1}),lv=Object.freeze({[pe.Edge.Top]:Jr,[pe.Edge.Left]:Jr,[pe.Edge.Bottom]:Jr,[pe.Edge.Right]:Jr,[pe.Edge.Horizontal]:Jr,[pe.Edge.Vertical]:Jr,[pe.Edge.DiagonalUp]:Jr,[pe.Edge.DiagonalDown]:Jr}),av=Object.freeze({horizontal:oe.HorizontalAlignment.General,vertical:oe.VerticalAlignment.Bottom,indent:0,relativeIndent:0,overflow:oe.Overflow.Visible,rotation:0,stacked:!1,quotePrefix:!1,justifyLastLine:!1,readingOrder:oe.ReadingDirection.Auto,readingDirection:oe.ReadingDirection.Auto}),cv=Object.freeze({locked:!1,formulaHidden:!1}),ww=Object.freeze({fill:{type:Pe.Type.None},numberFormat:"General",alignment:av,font:jt,border:lv,protection:cv,quotePrefix:!1,namedStyle:null}),uv=(()=>{const s=[{named:Qe.BuiltInName.Normal},{named:Qe.BuiltInName.RowLevel},{named:Qe.BuiltInName.ColLevel},{named:Qe.BuiltInName.Comma,numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'},{named:Qe.BuiltInName.Currency,numberFormat:'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'},{named:Qe.BuiltInName.Percent,numberFormat:"0%"},{named:Qe.BuiltInName.Comma0,numberFormat:'_(* #,##0_);_(* (#,##0);_(* "-"_);_(@_)'},{named:Qe.BuiltInName.Currency0,numberFormat:'_($* #,##0_);_($* (#,##0);_($* "-"_);_(@_)'},{named:Qe.BuiltInName.Hyperlink,font:{...jt,fill:G.Scheme.Hlink,underline:ke.UnderlineStyle.Single}},{named:Qe.BuiltInName.FollowedHyperlink,font:{...jt,fill:G.Scheme.FolHlink,underline:ke.UnderlineStyle.Single}},{named:Qe.BuiltInName.Note,fill:"FFFFFFCC",font:{...jt,style:ke.Style.Normal,fill:G.Scheme.Tx1},border:{left:{style:pe.StrokeStyle.Thin,color:"FFB2B2B2"},top:{style:pe.StrokeStyle.Thin,color:"FFB2B2B2"},right:{style:pe.StrokeStyle.Thin,color:"FFB2B2B2"},bottom:{style:pe.StrokeStyle.Thin,color:"FFB2B2B2"}}},{named:Qe.BuiltInName.WarningText,font:{...jt,fill:"FFFF0000"}},{named:Qe.BuiltInName.Unknown12},{named:Qe.BuiltInName.Unknown13},{named:Qe.BuiltInName.Unknown14},{named:Qe.BuiltInName.Title,font:{...jt,size:18,fill:G.Scheme.Tx2}},{named:Qe.BuiltInName.Heading1,font:{...jt,size:15,weight:"bold",fill:G.Scheme.Tx2},border:{bottom:{style:pe.StrokeStyle.Thick,color:G.Scheme.Accent1}}},{named:Qe.BuiltInName.Heading2,font:{...jt,size:13,weight:"bold",fill:G.Scheme.Tx2},border:{bottom:{style:pe.StrokeStyle.Thick,color:"accent1 lumMod 40, lumOff 60"}}},{named:Qe.BuiltInName.Heading3,font:{...jt,weight:"bold",fill:G.Scheme.Tx2},border:{bottom:{style:pe.StrokeStyle.Medium,color:"accent1 lumMod 40, lumOff 60"}}},{named:Qe.BuiltInName.Heading4,font:{weight:"bold",fill:G.Scheme.Tx2,...jt}},{named:Qe.BuiltInName.Input,fill:"FFFFCC99",font:{...jt,fill:"FF3F3F76"},border:{left:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"},top:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"},right:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"},bottom:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"}}},{named:Qe.BuiltInName.Output,fill:"FFF2F2F2",font:{...jt,fill:"FF3F3F3F"},border:{left:{style:pe.StrokeStyle.Thin,color:"FF3F3F3F"},top:{style:pe.StrokeStyle.Thin,color:"FF3F3F3F"},right:{style:pe.StrokeStyle.Thin,color:"FF3F3F3F"},bottom:{style:pe.StrokeStyle.Thin,color:"FF3F3F3F"}}},{named:Qe.BuiltInName.Calculation,fill:"FFF2F2F2",font:{...jt,fill:"FFFA7D00"},border:{left:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"},top:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"},right:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"},bottom:{style:pe.StrokeStyle.Thin,color:"FF7F7F7F"}}},{named:Qe.BuiltInName.CheckCell,fill:"FFA5A5A5",font:{...jt,fill:G.Scheme.Bg1},border:{left:{style:pe.StrokeStyle.Double,color:"FF3F3F3F"},top:{style:pe.StrokeStyle.Double,color:"FF3F3F3F"},right:{style:pe.StrokeStyle.Double,color:"FF3F3F3F"},bottom:{style:pe.StrokeStyle.Double,color:"FF3F3F3F"}}},{named:Qe.BuiltInName.LinkedCell,font:{...jt,fill:"FFFA7D00"},border:{bottom:{style:pe.StrokeStyle.Double,color:"FFFF8001"}}},{named:Qe.BuiltInName.Total,font:{...jt,weight:"bold",fill:G.Scheme.Tx1},border:{top:{style:pe.StrokeStyle.Thin,color:G.Scheme.Accent1},bottom:{style:pe.StrokeStyle.Double,color:G.Scheme.Accent1}}},{named:Qe.BuiltInName.Good,fill:"FFC6EFCE",font:{...jt,fill:"FF006100"}},{named:Qe.BuiltInName.Bad,fill:"FFFFC7CE",font:{...jt,fill:"FF9C0006"}},{named:Qe.BuiltInName.Neutral,fill:"FFFFEB9C",font:{...jt,fill:"FF9C5700"}},{named:Qe.BuiltInName.Accent1},{named:Qe.BuiltInName.Accent1_20},{named:Qe.BuiltInName.Accent1_40},{named:Qe.BuiltInName.Accent1_60},{named:Qe.BuiltInName.Accent2},{named:Qe.BuiltInName.Accent2_20},{named:Qe.BuiltInName.Accent2_40},{named:Qe.BuiltInName.Accent2_60},{named:Qe.BuiltInName.Accent3},{named:Qe.BuiltInName.Accent3_20},{named:Qe.BuiltInName.Accent3_40},{named:Qe.BuiltInName.Accent3_60},{named:Qe.BuiltInName.Accent4},{named:Qe.BuiltInName.Accent4_20},{named:Qe.BuiltInName.Accent4_40},{named:Qe.BuiltInName.Accent4_60},{named:Qe.BuiltInName.Accent5},{named:Qe.BuiltInName.Accent5_20},{named:Qe.BuiltInName.Accent5_40},{named:Qe.BuiltInName.Accent5_60},{named:Qe.BuiltInName.Accent6},{named:Qe.BuiltInName.Accent6_20},{named:Qe.BuiltInName.Accent6_40},{named:Qe.BuiltInName.Accent6_60},{named:Qe.BuiltInName.ExplanatoryText,font:{...jt,style:ke.Style.Italic,fill:"FF7F7F7F"}}];for(let e=29;e<=52;e++){const t=(e-29)%4,n=Math.floor((e-29)/4);let r="";t===1?r=" lumMod 20, lumOff 80":t===2?r=" lumMod 40, lumOff 60":t===3&&(r=" lumMod 60, lumOff 40"),s[e].fill=`accent${n+1}${r}`,s[e].font={fill:t===0?G.Scheme.Bg1:G.Scheme.Tx1,...jt}}return V.deepFreeze(s)})(),dv=new class{_svgImage(s,e,t,n=8){return{backgroundImage:`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='${n}' height='${n}' viewBox='0 0 ${n} ${n}' shape-rendering='crispEdges' %3E%3Cpath d='${t}' stroke='${s}' %3E%3C/path%3E%3C/svg%3E")`,backgroundRepeat:"repeat",backgroundSize:`${n}px ${n}px`,backgroundPositionX:"0px",backgroundPositionY:"0px",backgroundPosition:""+-n,backgroundColor:e}}toCSS(s,e,t){return s&&s!==Pe.BuiltInSheetPattern.None?s===Pe.BuiltInSheetPattern.Solid?{background:t}:s===Pe.BuiltInSheetPattern.Gray0625?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 0.5 4.5 L 0.5 5.5 M 4.5 2.5 L 4.5 3.5 M 4.5 6.5 L 4.5 7.5",8):s===Pe.BuiltInSheetPattern.LightGray?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 0.5 2.5 L 0.5 3.5 M 2.5 -0.5 L 2.5 0.5 M 2.5 1.5 L 2.5 2.5 M 2.5 3.5 L 2.5 4.5",4):s===Pe.BuiltInSheetPattern.MediumGray?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 1.5 1.5 L 1.5 2.5 M 1.5 -0.5 L 1.5 0.5 M -0.5 -0.5 L -0.5 0.5",2):s===Pe.BuiltInSheetPattern.DarkGray?this._svgImage(e,t,"M 0 0 L 0 4  M 1 1 L 1 2 M 1 3 L 1 4  M 2 0 L 2 4  M 3 0.5 L 3 1.5 M 3 2.5 L 3 3.5 M 4 0 L 4 4",4):s===Pe.BuiltInSheetPattern.LightHorizontal?this._svgImage(e,t,"M 0 2 L 4 2",4):s===Pe.BuiltInSheetPattern.DarkHorizontal?this._svgImage(e,t,"M 0 2 L 4 2 M 0 3 L 4 3",4):s===Pe.BuiltInSheetPattern.LightVertical?this._svgImage(e,t,"M 2 0 L 2 4",4):s===Pe.BuiltInSheetPattern.DarkVertical?this._svgImage(e,t,"M 2 0 L 2 4 M 3 0 L 3 4",4):s===Pe.BuiltInSheetPattern.LightUp?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 1.5 3.5 L 1.5 4.5 M 1.5 -0.5 L 1.5 0.5 M 2.5 2.5 L 2.5 3.5 M 3.5 1.5 L 3.5 2.5",4):s===Pe.BuiltInSheetPattern.DarkUp?this._svgImage(e,t,"M 0.5 -0.5 L 0.5 1.5 M 0.5 3.5 L 0.5 4.5  M 1.5 2.5 L 1.5 4.5  M 2.5 1.5 L 2.5 3.5  M 3.5 0.5 L 3.5 2.5 M 1.5 -0.5 L 1.5 0.5",4):s===Pe.BuiltInSheetPattern.LightDown?this._svgImage(e,t,"M 0.5 0 L 0.5 1 M 1.5 1 L 1.5 2 M 2.5 2 L 2.5 3 M 3.5 3 L 3.5 4",4):s===Pe.BuiltInSheetPattern.DarkDown?this._svgImage(e,t,"M 0.5 -0.5 L 0.5 2 M 1.5 1 L 1.5 3 M 2.5 2 L 2.5 4 M 3.5 3 L 3.5 5 M 3.5 -0.5 L 3.5 1.0",4):s===Pe.BuiltInSheetPattern.LightGrid?this._svgImage(e,t,"M 1.5 -0.5 L 1.5 4.5 M -0.5 1.5 L 4.5 1.5",4):s===Pe.BuiltInSheetPattern.DarkGrid?this._svgImage(e,t,"M 0.5 -0.5 L 0.5 1.5 M 1.5 -0.5 L 1.5 1.5 M 2.5 1.5 L 2.5 3.5 M 3.5 1.5 L 3.5 3.5 M 0.5 3.5 L 0.5 4.5 M 1.5 3.5 L 1.5 4.5",4):s===Pe.BuiltInSheetPattern.LightTrellis?this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 1.5 3.5 L 1.5 4.5 M 1.5 -0.5 L 1.5 0.5 M 2.5 2.5 L 2.5 3.5 M 3.5 1.5 L 3.5 2.5 M 1.5 1.5 L 1.5 2.5 M 3.5 3.5 L 3.5 4.5 M 3.5 -0.5 L 3.5 0.5",4):s===Pe.BuiltInSheetPattern.DarkTrellis?this._svgImage(e,t,"M 0 0 L 4 0 M 0 1 L 2 1   M 0 2 L 4 2  M 2 3 L 4 3    M 0 4 L 4 4",4):(Pe.BuiltInSheetPattern.Custom,this._svgImage(e,t,"M 0.5 0.5 L 0.5 1.5 M 0.5 4.5 L 0.5 5.5 M 2.5 2.5 L 2.5 3.5 M 2.5 6.5 L 2.5 7.5 M 4.5 0.5 L 4.5 1.5 M 4.5 4.5 L 4.5 5.5 M 6.5 2.5 L 6.5 3.5 M 6.5 6.5 L 6.5 7.5",8)):{background:"none"}}},sc=(s,e,t)=>{if(e===void 0)return;if(e===null)return null;if(e.isIStyle)return e._p.getProperties();let n=null;return typeof e=="function"?n=e(typeof t=="function"?t():t):n=e,n};class hv{constructor(e,t){this._c=e,this._p=Object.freeze(Array.isArray(t)?t:[t??null])}value(e){const t=this._p;for(let n=t.length-1;n>=0;n--){const r=t[n];if(!r)continue;const o=r[e];if(o!==void 0)return o}}values(e){const t=this._p,n=t.length;let r;for(let o=0;o<n;o++){const i=t[o];if(!i)continue;const l=i[e];l!==void 0&&(r===void 0&&(r=[]),r.push(l))}return r}getProperties(){const e=this._p;return e?e[e.length-1]:null}toJSON(){return null}}class Hr{constructor(e,t){this._c=e,this._p=Object.freeze(t)}_value(e){const t=this._p;for(let n=t.length-1;n>=0;n--){const r=t[n];if(!r)continue;const o=r[e];if(o!==void 0)return o}}_values(e){const t=this._p,n=t.length;let r;for(let o=0;o<n;o++){const i=t[o];if(!i)continue;const l=i[e];l!==void 0&&(r===void 0&&(r=[]),r.push(l))}return r}getProperties(){const e=this._p;return e?e[e.length-1]:null}toJSON(){return null}}let ts=class extends Hr{constructor(e,t,n){super(t,n),this._edge=e}getStyle(){return this._value("style")}getColor(){const e=this._value("color");return e?this._c.parseColor(e):null}isNone(){return this.getStyle()===pe.StrokeStyle.None}toCSS(){const e=_o(this);switch(this._edge){case pe.Edge.Left:return{borderLeft:e};case pe.Edge.Right:return{borderRight:e};case pe.Edge.Top:return{borderTop:e};case pe.Edge.Bottom:return{borderBottom:e};case pe.Edge.DiagonalUp:case pe.Edge.DiagonalDown:return{borderDiagonalUp:e}}}get isIStroke(){return!0}};class gv extends Hr{getLeft(){return new ts(pe.Edge.Left,this._c,this._values(pe.Edge.Left))}getRight(){return new ts(pe.Edge.Right,this._c,this._values(pe.Edge.Right))}getTop(){return new ts(pe.Edge.Top,this._c,this._values(pe.Edge.Top))}getBottom(){return new ts(pe.Edge.Bottom,this._c,this._values(pe.Edge.Bottom))}getDiagonalUp(){return new ts(pe.Edge.DiagonalUp,this._c,this._values(pe.Edge.DiagonalUp))}getDiagonalDown(){return new ts(pe.Edge.DiagonalDown,this._c,this._values(pe.Edge.DiagonalDown))}isEmpty(){return!1}get isIBorder(){return!0}}class fv extends Hr{get isITextBoxAlignment(){return!0}getHorizontal(){return this._value("horizontal")}getVertical(){return this._value("vertical")}getIndent(){return this._value("indent")}getRelativeIndent(){return this._value("relativeIndent")}getOverflow(){return this._value("overflow")}getRotation(){return this._value("rotation")}getStacked(){return this._value("stacked")}getJustifyLastLine(){return this._value("justifyLastLine")}getReadingDirection(){return this._value("readingDirection")}}class mv extends Hr{isEqualMeasure(e){return!!e&&this.getFamily()===e.getFamily()&&!!V.isEqualArrays(this.getFallbacks(),e.getFallbacks())&&this.getSize()===e.getSize()&&this.getWeight()===e.getWeight()&&this.getStyle()===e.getStyle()&&this.getStrike()===e.getStrike()&&this.getScheme()===e.getScheme()&&this.getShadow()===e.getShadow()&&this.getOutline()===e.getOutline()&&this.getLetterSpacing()===e.getLetterSpacing()&&this.getVerticalAlignment()===e.getVerticalAlignment()}isSuperSub(){const e=this.getVerticalAlignment();return e===ke.VerticalAlignment.Sub||e===ke.VerticalAlignment.Super}isSuperScript(){const e=this.getVerticalAlignment();return e===ke.VerticalAlignment.Sub||e===ke.VerticalAlignment.Super}getSuperSubScale(){return this.getFamily(),this.getSize(),this.getVerticalAlignment(),.6}getSuperSubShift(){return this.getFamily(),e=this.getSize(),(t=this.getVerticalAlignment())===ke.VerticalAlignment.Super?-e/3:t===ke.VerticalAlignment.Sub?e/5:0;var e,t}toCSS(e,t=1,n=!1){const r={fontFamily:za(this.getFamily(),this.getFallbacks()),letterSpacing:`${this.getLetterSpacing()}px`,fontWeight:this.getWeight(),fontStyle:this.getStyle(),textDecoration:uw(this.getUnderline(),this.getStrike()),color:this.getFill().toCSS(e),fontSize:`${V.roundAccurately(this.getSize()*ke.getDeviceScale()*t,2)}px`,textRendering:"geometricPrecision"};if(n){const o=this._c.getNormal().getFont().toCSS(e,t,!1),i=r.textDecoration,l=r.fontWeight;V.removeEqualValues(r,o),i&&(r.textDecoration=i),l&&(r.fontWeight=l)}return r}getFamily(){return this._value("family")??this._c.getTheme().getFontScheme().getMinorFont()}getFallbacks(){let e=this._value("fallbacks")??this._c.getTheme().getFontScheme().getMinorFallbacks()??V.EmptyArray;return this.getFamily()==="Aptos Narrow"&&(e=["Calibri",...e]),e}getSize(){return this._value("size")??this._c.getDefaultFontSize()??11}getWeight(){return this._value("weight")}getStyle(){return this._value("style")}getFill(){const e=this._value("fill");return this._c.parseColor(e??G.Scheme.Bg1)}getLetterSpacing(){return this._value("letterSpacing")??this.getSize()/-25}getUnderline(){return this._value("underline")}getStrike(){return this._value("strike")}getScheme(){return this._value("scheme")}getVerticalAlignment(){return this._value("verticalAlign")}getShadow(){return this._value("shadow")}getOutline(){return this._value("outline")}getExtend(){return this._value("extend")}get isIStyledFont(){return!0}}const pv=Object.freeze({background:"none"});class Vf extends Hr{getType(){return Pe.Type.None}toCSS(e){return pv}toJSON(){return{type:Pe.Type.None}}}class wv extends Hr{getType(){return Pe.Type.Solid}getColor(){return this._c.parseColor(this._value("color")??G.Scheme.Bg1)}toCSS(e){return{background:this.getColor().toCSS(e)}}toJSON(){return{type:Pe.Type.Solid,color:this.getColor()?.toString()??null}}}class Sv extends Hr{getOffset(){return this._value("offset")??0}getColor(){return this._c.parseColor(this._value("color")??G.Scheme.Bg1)}}class _v extends Hr{getType(){return Pe.Type.Gradient}getStops(){const e=this._value("stops")??[],t=[],n=this._c;for(let r=0;r<e.length;r++){const o=e[r];t.push(new Sv(n,[o]))}return t}getGradientType(){return this._value("gradientType")??Pe.GradientType.Linear}getAngle(){return this._value("angle")??0}getFillTo(){return this._value("fillTo")??null}toCSS(e,t){const n=gw(this,e,t);return n?{background:n}:null}toJSON(){const e={type:Pe.Type.Gradient};if(this.getStops().length>0){let t=[];for(let n=0;n<t.length;n++)t.push({offset:t[n].offset,color:t[n].color.toString()});e.stops=t}return this.getAngle()!==0&&(e.angle=this.getAngle()),this.getGradientType()!==Pe.GradientType.Linear&&(e.gradientType=this.getGradientType()),this.getFillTo()&&(e.fillTo=this.getFillTo()),e}}class yv extends Hr{getType(){return Pe.Type.Pattern}getBackground(){const e=this._value("background")??G.Named.Window;return this._c.parseColor(e)}getForeground(){return this._c.parseColor(this._value("foreground")??G.Scheme.Tx1)}getPatternType(){return this._value("patternType")??Pe.BuiltInSheetPattern.None}toCSS(e){const t=this.getBackground().toCSS(e),n=this.getForeground().toCSS(e);return this.getPatternType()===Pe.BuiltInSheetPattern.None?{background:"none"}:this.getPatternType()===Pe.BuiltInSheetPattern.Solid?{background:this.getForeground().toCSS(e)}:dv.toCSS(this.getPatternType(),n,t)}toJSON(){const e={type:Pe.Type.Pattern};this.getPatternType()!==Pe.BuiltInSheetPattern.None&&(e.patternType=this.getPatternType());const t=this.getForeground();t&&(e.foreground=t.toString());const n=this.getBackground();return n&&(e.background=n.toString()),e}}class Sw{constructor(e){this._options=e,this._c=e.styles,this._p=new hv(e.styles,e.properties),this._hasVisibleStyling=!this.getFill()||this.getFill().getType()!==Pe.Type.None||!this.getBorder().isEmpty()}hasVisibleStyling(){return this._hasVisibleStyling}isNormal(){return!1}getNamed(){const e=this._p.value("named")??Qe.BuiltInName.Normal;return this._c.getNamed(e)}createTemporaryStyle(e){const t=this._c,n=sc(0,e,this),r=this._options,o=r.range,i=r.direct.cloneWithUpdate(n);return Is(t,i,o)}measureText(e,t=this.getFont().getSize(),n,r){const o=this.getFont();n||(n=o.getFamily());let i=o.getFallbacks();n==="Aptos Narrow"&&(i=["Calibri",...i]);const l=za(n,i);return ke.getSharedMeasurer()(e,t*ke.getDeviceScale(),l,{isBold:o.getWeight()>400,isItalic:o.getStyle().includes("italic"),letterSpacing:o.getLetterSpacing(),...r})}createTemporaryTextFrame(e,t=!1){return nc(e,this.getFont(),this.getAlignment(),t)}getBestFit(){if(this._bestFit!==void 0)return this._bestFit;const e=this.getInsets(),t=this.measureText("My");return this._bestFit={width:null,height:t.lineHeight+e.top+e.bottom},this._bestFit}getInsets(){if(this._insets!==void 0)return this._insets;const e=(this.getFont().getSize(),1),t=(n=this.getFont().getSize(),Math.max(2,Math.round(n<225?n/5:n/3.5)));var n;const r={top:e,left:t,bottom:e,right:t},o=this._p,i=o?.value("insets");return i&&(i.top!==void 0&&(r.top+=i.top),i.left!==void 0&&(r.left+=i.left),i.bottom!==void 0&&(r.bottom+=i.bottom),i.right!==void 0&&(r.right+=i.right)),this._insets=Object.freeze(r),this._insets}getBorder(){return new gv(this._c,this._p.values("border"))}getFont(){return new mv(this._c,this._p.values("font"))}getFill(){const e=this._p;let t=e.values("fill"),n=e.value("fill");return n.type===Pe.Type.None?new Vf(this._c,t):n.type===Pe.Type.Solid||!n.type&&n.color?new wv(this._c,t):n.type===Pe.Type.Gradient?new _v(this._c,t):n.type===Pe.Type.Pattern?new yv(this._c,t):new Vf(this._c,t)}getAlignment(){return new fv(this._c,this._p.values("alignment"))}getNumberFormat(){const e=this._p.value("numberFormat");return typeof e=="number"?Yd(e):e}getQuotePrefix(){return this._p.value("quotePrefix")}get isIStyle(){return!0}}const Is=(s,e,t)=>{const n=t?.rowStart??J.EmptyCell.rowIndex,r=t?.colStart??J.EmptyCell.colIndex,o=[ww],i=s.getNormalRanged(),l=i.getPropertiesAt(n,r,null);if(l&&o.push(l),!e)return new bv({styles:s,range:t,properties:o,layerTypes:null,direct:i});const a=e.getPropertiesAt(n,r,null);return a&&o.push(a),new Sw({styles:s,range:t,properties:o,direct:e})};class bv extends Sw{isNormal(){return!0}}const mo=(s,e)=>{if(s&&!e||e&&!s)return!1;if(s===e)return!0;if(s.style!==e.style)return!1;if(s.color===e.color)return!0;let t=s.color;(s&&s.color).isIColor&&(t=s.color.toString());let n=e.color;return(e&&e.color).isIColor&&(n=e.color.toString()),t===n};class Jt{constructor(e,t,n,r){this._c=e,this._r=t,this._p=n??null,this._t=r??null,this._e=this._p===null||Object.keys(this._p).length===1&&this._p.named===Qe.BuiltInName.Normal}isEmpty(){return this._e}getProperties(){return this._p}getCoords(){return this._r}cloneWithUpdate(e){if(e===void 0)return this;const t=this._c,n=this._r,r=this._p,o=Pt.resolveTypedUpdates(e,Ht,t,r);return new Jt(t,n,o)}copyTo(e,t){const n=this._c,r=this._r,o=e.rowStart-r.rowStart,i=e.colStart-r.colStart;let l=null;return J.isEqualRanges(r,this._t)||(l=J.translateRange(r,o,i)),new Jt(n,e,this._p,l)}canTile(e,t){return!this._p.border}_createShifted(e){return new Jt(this._c,e,this._p)}getShifted(e){return e.after?{...e.after,value:this._createShifted(J.sanitizeRange(e.after))}:null}getSplit(e,t){const n=this._c,r=this._p,o=this._r;let i=r;const l=e[0];let a=r;const c=e[1],u=r?r.border:null;if(u){const h=t===B.Orientation.Column;if(h?u.left!==void 0||u.right!==void 0||u.vertical!==void 0:u.top!==void 0||u.bottom!==void 0||u.horizontal!==void 0){i={...i};const f=this._splitBorderRange(u,o,l,h);f?i.border=f:f===null&&delete i.border,a={...a};const g=this._splitBorderRange(u,o,c,h);g?a.border=g:g===null&&delete a.border}}const d=this._t;return[new Jt(n,e[0],i,d),new Jt(n,e[1],a,d)]}getMerged(e,t,n){const r=n===B.Orientation.Column,o=this._p,i=e._p;if(o&&!i||i&&!o||!o&&!i)return;let l=Object.keys(o),a=Object.keys(i);if(l.length!==a.length)return;for(let h=0;h<l.length;h++){const f=l[h];if(f==="border")continue;const g=o[f],m=i[f];if(!V.deepEqual(g,m))return}const c=o.border,u=i.border;if(c&&!u||u&&!c)return;const d=this._c;if(c||u){const h=r?pe.Edge.Top:pe.Edge.Left,f=r?pe.Edge.Bottom:pe.Edge.Right;if(!mo(c[h],u[h])||!mo(c[f],u[f]))return;const g=this._r,m=e._r,p=1+(r?g.rowEnd-g.rowStart:g.colEnd-g.colStart),w=1+(r?g.colEnd-g.colStart:g.rowEnd-g.rowStart),S=1+(r?m.colEnd-m.colStart:m.rowEnd-m.rowStart),b=r?pe.Edge.Horizontal:pe.Edge.Vertical;if(p>1&&!mo(c[b],u[b]))return;const v=r?pe.Edge.Right:pe.Edge.Bottom,y=r?pe.Edge.Left:pe.Edge.Top;if(!mo(c[v],u[y]))return;const _=r?pe.Edge.Vertical:pe.Edge.Horizontal,C=c[v];if(w>1&&!mo(C,c[_]))return;const E=S===1?u[y]:u[_];if(S>1&&!mo(E,u[_])||!mo(C,E))return;const x={border:{[h]:c[h],[f]:c[f],[b]:c[b],[_]:C,[y]:c[y],[v]:u[v]}},R=Pt.resolveTypedUpdates(x,Ht,d,o);return new Jt(d,t,R)}return new Jt(d,t,this._p)}hasTrailingEdge(){return!0}isMergeOnShift(){return!0}_splitBorderRange(e,t,n,r){const o=r?pe.Edge.Left:pe.Edge.Top,i=r?pe.Edge.Right:pe.Edge.Bottom,l=r?pe.Edge.Vertical:pe.Edge.Horizontal,a=r?t.colStart:t.rowStart,c=r?t.colEnd:t.rowEnd,u=r?n.colStart:n.rowStart,d=r?n.colEnd:n.rowEnd;let h={...e};return delete h[o],delete h[i],delete h[l],a===u?e[o]&&(h[o]=e[o]):e[l]&&(h[o]=e[l]),c===d?e[i]&&(h[i]=e[i]):e[l]&&(h[i]=e[l]),d-u>0&&e[l]&&(h[l]=e[l]),Object.keys(h).length===0?null:h}_localizeBorderRange(e,t,n){if(!e)return;let r=null;const o=t.rowStart,i=t.rowEnd,l=n.rowStart,a=n.rowEnd;e.top&&l===o&&(r=r??{},r.top=e.top),e.bottom&&a===i&&(r=r??{},r.bottom=e.bottom),e.horizontal&&(a-l>0&&(r=r??{},r.horizontal=e.horizontal),l>o&&(r=r??{},r.top=e.horizontal),a<i&&(r=r??{},r.bottom=e.horizontal));const c=t.colStart,u=t.colEnd,d=n.colStart,h=n.colEnd;return e.left&&d===c&&(r=r??{},r.left=e.left),e.right&&h===u&&(r=r??{},r.right=e.right),e.vertical&&(h-d>0&&(r=r??{},r.vertical=e.vertical),d>c&&(r=r??{},r.left=e.vertical),h<u&&(r=r??{},r.right=e.vertical)),r}_localizeBorder(e,t,n,r){if(!e)return;let o=null;const i=t.rowStart,l=t.rowEnd;e.top&&n===i&&(o=o??{},o.top=e.top),e.bottom&&n===l&&(o=o??{},o.bottom=e.bottom),e.horizontal&&(n>i&&(o=o??{},o.top=e.horizontal),n<l&&(o=o??{},o.bottom=e.horizontal));const a=t.colStart,c=t.colEnd;return e.left&&r===a&&(o=o??{},o.left=e.left),e.right&&r===c&&(o=o??{},o.right=e.right),e.vertical&&(r>a&&(o=o??{},o.left=e.vertical),r<c&&(o=o??{},o.right=e.vertical)),o}getPropertiesAt(e,t,n){const r=this._p;let o=r,i=null;const l=this._t;if(l){const d=this._r,h=l.colEnd-l.colStart+1,f=l.rowEnd-l.rowStart+1;t=d.colStart+(t-d.colStart+(l.colStart-d.colStart))%h,e=d.rowStart+(e-d.rowStart+(l.rowStart-d.rowStart))%f}const a=r?.font;a&&a.fill&&(i=i??this._c.getNormalRanged().getPropertiesAt(e,t,n),i&&i.font&&a.fill===i.font.fill&&(o===r&&(o={...o}),o.font={...a},delete o.font.fill));const c=r?.fill;c&&(i=i??this._c.getNormalRanged().getPropertiesAt(e,t,n),i&&V.deepEqual(c,i.fill)&&(o===r&&(o={...o}),delete o.fill));const u=o?.border;if(u){const d=l??this._r,h=this._localizeBorder(u,d,e,t);h!==void 0&&(o===r&&(o={...o}),h===null?delete o.border:o.border=h)}return o}toJSON(){return V.toSafeJSON(this._p)}}const vv=Object.freeze({value:null,style:null,hyperlink:null,formula:null,type:Me.Null,stringToParse:null}),Wf=Object.seal({value:void 0,style:void 0,hyperlink:void 0,formula:void 0,type:void 0,stringToParse:void 0}),Cv=Object.seal({value:void 0,style:void 0,hyperlink:void 0,formula:void 0}),xv=Object.freeze({width:1,height:1}),Ev=new sh({max:1e3}),Rv=new class{isEditAllowed(){return!0}isFormulaHidden(){return!1}get isICellProtection(){return!0}},vd=(s,e,t=null,n=null,r=!1)=>{if(s===void 0)return;if(s===null)return vv;if(s&&s.isICell){const w=s,S=Wf;return S.value=w.getValue(),w.getStyle().isNormal()||(S.style=w.getStyle()._p.getProperties()),S.formula=w.getFormulaText(),S.hyperlink=w.getHyperlink(),S.type=w.getType(),S}let o;s.value!==void 0||s.style!==void 0||s.hyperlink!==void 0?o=s:(o=Cv,o.value=s,o.style=void 0,o.hyperlink=void 0);const i=Wf;i.type=void 0,i.value=void 0,i.style=void 0,i.formula=void 0,i.hyperlink=void 0,i.stringToParse=void 0;let l,a=o.value,c=!1;if(o.value!==void 0&&(l=pn(a),l||(c=Ms(a),c&&(l=Me.Number)),!l))throw new Error("Invalid cell type. See documentation for information on valid built in cell types and creating custom cell types.");let u,d,h=null,f=null,g;if(l===Me.String){if(g=o.value,t){let w=n?.get(g);if(!w){const S=g.length,b=g.charAt(0);b==="="&&S>1?(d=g.substring(1),a=null):(w=vw(g,t),!w||typeof w.value!="string"||b!=="+"&&b!=="-"||(d="="+g,a=null),w!==void 0&&n&&n.set(g,w))}w&&(w.value!==void 0&&(a=w.value,l=pn(a)),w.style!==void 0&&(h=w.style),w.hyperlink!==void 0&&(u=w.hyperlink)),!r&&t.parse&&(f=g)}}else if(c){const w=t?.date1904??e.date1904;a=Ki(o.value,w),h=S=>{if(!Xi(S.getNumberFormat()))return{numberFormat:"Short Date"}}}else a=o.value;let m=o.style;if(m&&m.isIStyle&&(m=m._p.getProperties()),u=o.hyperlink??u,h)if(m){const w=m;m=S=>{let b=S.createTemporaryStyle(h);return b=b.createTemporaryStyle(w),b=b._p.getProperties(),b}}else m=h;let p=!1;return a!==void 0&&(a===null?(i.value=null,i.type=Me.Null):(i.value=a,i.type=l),p=!0),m!==void 0&&(i.style=m,p=!0),u!==void 0&&(i.hyperlink=u,p=!0),d!==void 0&&(i.formula=d,p=!0),r||(i.stringToParse=f,p=!0),p?(i.type=l,i):void 0},_w=(s,e,t,n)=>pw(t,e,s,e.getNumberFormat(),r=>n.styles.parseColor(r),n.date1904),yw=(s,e,t,n,r=!1)=>{if(s===Me.Null)return null;let o="";if(r)o=""+t;else{const i=_w(s,e,t,n);if(i.formattedRuns){const l=i.formattedRuns.runs;for(let a=0;a<l.length;a++)o+=l[a].text}else o=i.displayText}return nc(o,e.getFont(),e.getAlignment(),s===Me.String,r)},ih=(s,e)=>{const t=e.getInsets();if(s===Me.Null)return t;let n=t;const r=ic(s,e),o=e.getAlignment().getIndent();if(o&&(r===oe.HorizontalAlignment.Left||r===oe.HorizontalAlignment.Right)){n={...t};const i=e.measureText(" ".repeat(1*o)),l=Math.min(3,Math.max(1,(26-e.getFont().getSize())/2));let a=i.width*l;r===oe.HorizontalAlignment.Left?n.left+=a:r===oe.HorizontalAlignment.Right&&(n.right+=a)}return Object.freeze(n)},ic=(s,e)=>{const t=e.getAlignment(),n=t.getRotation(),r=t.getHorizontal();return n!==0&&r===oe.HorizontalAlignment.General?n>0&&n<90||n>180&&n<=270?oe.HorizontalAlignment.Right:oe.HorizontalAlignment.Left:r===oe.HorizontalAlignment.General?s===Me.Null?oe.HorizontalAlignment.Left:s===Me.Boolean||s===Me.Error?oe.HorizontalAlignment.Center:e.getNumberFormat()==="@"?oe.HorizontalAlignment.Left:s===Me.Number?oe.HorizontalAlignment.Right:oe.HorizontalAlignment.Left:r},bw=(s,e,t,n,r,o,i,l,a)=>{if(t===Me.Null||r==="")return null;const c=e;if(!((O,H,z=!1,j=!1)=>{if(O===Me.Null)return!1;const q=H.getAlignment(),P=q.getHorizontal();if(P===oe.HorizontalAlignment.CenterContinuous||P===oe.HorizontalAlignment.Fill)return!0;if(P===oe.HorizontalAlignment.Distributed||O!==Me.String||q.getOverflow()!==oe.Overflow.Visible||P===oe.HorizontalAlignment.Right&&z||P===oe.HorizontalAlignment.Center&&z&&j||j&&(P===oe.HorizontalAlignment.General||P===oe.HorizontalAlignment.Left))return!1;const U=q.getVertical();return U!==oe.VerticalAlignment.Justify&&U!==oe.VerticalAlignment.Distributed})(t,n,o!==null&&o.colIndex+1===c,i!==null&&i.colIndex-1===c))return null;const u=Av(t,n,r,a),d=n.getAlignment(),h=d.getHorizontal(),f=d.getOverflow()===oe.Overflow.Wrap||t===Me.String&&(h===oe.HorizontalAlignment.Justify||h===oe.HorizontalAlignment.Distributed||d.getVertical()===oe.VerticalAlignment.Justify||d.getVertical()===oe.VerticalAlignment.Distributed),g=h===oe.HorizontalAlignment.Fill,m=h===oe.HorizontalAlignment.CenterContinuous||g;if(!u&&!m)return null;const p=(O=>O===oe.HorizontalAlignment.Center||O===oe.HorizontalAlignment.CenterContinuous?Et.Center:O===oe.HorizontalAlignment.Right?Et.Right:Et.Left)(ic(t,n));let w=0,S=0,b=0,v=0,y=1;if(m&&r!==null&&l){du.colIndex=e,du.rowIndex=s;const O=l.colEnd;y=Math.min(a.nextContentful(du,O),O)-e+1}const _=a.colHeaders,C=_.findOffset.bind(_),E=_.findIndex.bind(_);let x=C(c);const R=x;let I=C(c+y),A=I-x,M=c,k=c;const F={x:0,y:0,width:A,height:u?.height??0},L=c-c+y;let N=u?u.width-A:0,D=F;return A>0&&N>0&&!f&&(p===Et.Center&&(N/=2),p!==Et.Left&&p!==Et.Center||(k=E(I+N),i!==null&&(k=Math.min(k,i.colIndex-1)),I=C(k),v=N,S=k-c),p!==Et.Right&&p!==Et.Center||(M=E(x-N),o!==null&&(M=Math.max(M,o.colIndex+1)),x=C(M),b=N,w=c-M),F.x=R-x,D.x=F.x),y>1&&(S=p===Et.Center?Math.max(L-1,S):y-1,I=C(c+1),F.width=I-x,D={...F},D.width=A),{anchorBounds:F,leftIndex:w,rightIndex:S,leftOffset:b,rightOffset:v,colSpan:L,colBounds:D}};class Iv{constructor(e,t){if(this._styles=e,this._ri=t,t?.table){const n=t?.table;this._table=n.getStyle().getRanged(n)}if(t?.conditionals){this._conditionals=[];for(let n=0;n<t.conditionals.length;n++){const r=t.conditionals[n];this._conditionals.push(r)}}}getCoords(){return J.EmptyRange}getPropertiesAt(e,t,n){let r=null,o=this._ri.directStyle?.getPropertiesAt(e,t,n)??null;const i=this._styles;if(o&&o.named){const u=o.named;if(u!==Qe.BuiltInName.Normal){const d=this._styles.getNamed(u);d?r=d.getRanged().getPropertiesAt(e,t,n):console.warn(`A named styled was referenced but not found: '${u}'.`)}}let l=null;const a=this._table?.getPropertiesAt(e,t,n);a&&(l=l?Pt.resolveTypedUpdates(a,Ht,i,l):a),r&&(l=l?Pt.resolveTypedUpdates(r,Ht,i,l):r);const c=this._conditionals;if(c)for(let u=0;u<c.length;u++){const d=c[u].getPropertiesAt(e,t,n);d&&(l=l?Pt.resolveTypedUpdates(d,Ht,i,l):d)}return o&&(l=l?Pt.resolveTypedUpdates(o,Ht,i,l):o),l}cloneWithUpdate(e){return(this._ri.directStyle??this._styles.getNormalRanged()).cloneWithUpdate(e)}}const Ni=(s,e,t,n)=>{if(!t)return n.styles.getNormal();const r=n.styles;return Is(r,t?new Iv(r,t):null,e)},eo=(s,e,t,n,r,o,i,l=null,a=Ev)=>{if(t===null)return e?e.getBestFit():null;const c=s===Me.String,u=e.getFont(),d=u.getWeight(),h=u.getSize(),f=u.getFamily(),g=e.getAlignment(),m=g.getOverflow(),p=g.getRotation(),w=g.getVertical(),S=e.getNumberFormat(),b=c&&m===oe.Overflow.Visible,v=c&&(m===oe.Overflow.Wrap||w===oe.VerticalAlignment.Justify||w===oe.VerticalAlignment.Distributed),y=(l??"")+"\0"+h+f+d+S+p+b+v+o+i+(l?"":t),_=a.get(y);if(_)return _;let C=null,E=null;const x=ih(s,e),R=x.top+x.bottom+ +Fv(e);let I=!1,A=!1;i&&(A=!0,(p!==0||v)&&(A=!1));const M=A?void 0:yw(s,e,t,n),k=x.left+x.right+2;if(M){if(s===Me.Number&&S==="General"&&o){let N=t,D=V.splitNumber(N),O="";O=Math.abs(N)>=Math.pow(10,12)||Math.abs(N)<=Math.pow(10,-12)?`0.${"0".repeat(Math.max(2,Math.min(D.ipLength,5)))}E+00`:Math.abs(D.ipLength)===0?"0.0":Math.abs(D.fpLength)>0?"0".repeat(D.ipLength)+".0":"0".repeat(D.ipLength),N<0&&(O="-"+O),O="0".repeat(O.length);const H=e.measureText(O);C=H.width,E=H.lineHeight}else{let N=null;v&&(N={width:Math.max(1,r-k)});const D=M.layout(N);C=D.bounds.width,E=D.bounds.height}if(C!==null&&(C+=k),E!==null&&(E+=R),I=s===Me.String,p){I&&m===oe.Overflow.Wrap&&(I=!1);const N=((D,O)=>{const{x:H,y:z,width:j,height:q}=D,P=O*Math.PI/180,U=Math.sin(P),ne=Math.cos(P),ee=j/2,ve=q/2,le=wl(-ee,-ve,U,ne),Ce=wl(ee,-ve,U,ne),re=wl(-ee,ve,U,ne),ae=wl(ee,ve,U,ne);let fe=Math.min(le.x,Ce.x,re.x,ae.x)+ee,ye=Math.max(le.x,Ce.x,re.x,ae.x)+ee,he=Math.min(le.y,Ce.y,re.y,ae.y)+ve;return{x:H+fe,y:z+he,width:ye-fe,height:Math.max(le.y,Ce.y,re.y,ae.y)+ve-he}})({x:0,y:0,width:C,height:E},p);C=N.width,E=N.height}}else E=e.getBestFit().height;o&&I&&(C=0);const F={width:C,height:E},L=Object.freeze(F);return a.set(y,L),L},Av=(s,e,t,n)=>{const r=ih(s,e),o=ic(s,e);let i=r.left+r.right;o===oe.HorizontalAlignment.Left?i=r.right:o===oe.HorizontalAlignment.Right?i=r.left:o===oe.HorizontalAlignment.Center&&(i=r.left+r.right);const l=eo(s,e,t,n,Number.MAX_SAFE_INTEGER,!1,!1);return{width:Math.ceil(l.width-i),height:Math.ceil(l.height)}};let Ha=class va{constructor(e,t,n=Me.Null,r=null,o=null,i=null,l=null){this._options=e,this._coords=t??null,this._t=n,this._ri=o,this._v=r,this._p=i,this._n=l}getRange(){const e=this._coords;return this._options.getRange(e?J.cellToRange(e):null)}isEqual(e){if(!e)return!1;if(this===e)return!0;const t=e;return!!t.isICell&&this._v===t._v&&!!J.isEqualCells(this._coords,e.getCoords())&&this._options.sheet===t._options?.sheet}getCoords(){return this._coords}getA1(){const e=this._coords;return e?Nr(this._options.resolveRange(e).getCoords()):rn}getSheet(){return this._options.sheet}select(e){return this._options.opener("#"+Qi(this._coords),e)}getColumnFilter(){if(!this._ri)return null;let e=null;if(this._ri.table){const t=this._ri.table.getHeaderRange().getCoords();if(t&&J.isCellWithinRange(this._coords,t)){const n=this._coords.colIndex-t.colStart;e=this._ri.table.getColumnFilter(n)??null}}return e}getProtection(){return Rv}getTextOverflow(){const e=this._to;if(e!==void 0)return e;const t=this._ri;if(t&&t.merge)return this._to=null,null;const n=this._t;let r=null;if(n===Me.String||t&&t.continuous){const o=this.getStyle(),i=this._coords;r=bw(i.rowIndex,i.colIndex,n,o,this._v,this._p,this._n,t?.continuous?.getCoords()??null,this._options)}return r===null||r.leftIndex===0&&r.rightIndex===0&&r.colSpan<=1?(this._to=null,null):(this._to=r,this._to)}getRenderHorizontalAlignment(){return ic(this._t,this.getStyle())}isEmpty(){return this._v===null&&!this._ri}getExtrusions(){const e=this._ri;if(!e&&this._to===null)return null;if(e){const r=e.merge;if(r!==void 0)return r.getCoords()}const t=this.getTextOverflow();if(!t)return null;const n=this._coords;return{colStart:n.colIndex-t.leftIndex,rowStart:n.rowIndex,colEnd:n.colIndex+t.rightIndex,rowEnd:n.rowIndex}}isEditAllowed(){const e=this._options;return e?!e.getProtection().isLocked()||!!this._ri&&this.getProtection().isEditAllowed():!0}isFormulaHidden(){return!!this._options.getProtection().isLocked()&&!!this._ri&&this.getProtection().isFormulaHidden()}isContentful(){return this._v!==null}getBestFit(e,t=!1){return e===void 0&&(e=this._options.sheet.getColumnHeaders().getSpanSize(this._coords.colIndex)??64),eo(this._t,this.getStyle(),this._v,this._options,e,t,!1)}getInsets(){return this._v===null?this.getStyle().getInsets():ih(this._t,this.getStyle())}getTextFrame(e){let t,n;if(e&&(n=this.getFormulaText()),t=n??this._v,t===null)return null;const r=this.getStyle();return n?((o,i)=>i===Me.Null?null:nc(i,o.getFont(),o.getAlignment(),!1,!0))(r,t,this._options):yw(this._t,r,t,this._options,e)}getValue(){return this._v}getFormula(){let e=this._ri?.formula;if(!e)return null;const t=this._coords;return t?(Array.isArray(e)&&(e=e[0]),new Tv(this._options,e,t)):null}getFormulaText(){let e=this._ri?.formula;if(!e)return null;const t=this._coords;return t?(Array.isArray(e)&&(e=e[0]),"="+e.getFormulaTextAt(t.rowIndex,t.colIndex)):null}getCalcStatus(){const e=this._ri;return e&&e.pending?lt.CalcStatus.Pending:lt.CalcStatus.Ready}getType(){return this._t}getStyle(e=!1){if(!e&&this._styleConditional)return this._styleConditional;if(e&&this._styleSpecific)return this._styleSpecific;const t=Ni(0,J.cellToRange(this._coords),this._ri,this._options);return e?this._styleSpecific=t:this._styleConditional=t,t}createTemporaryCell(e){const t=this._options;if(e===null)return new va(t,this._coords,null);const n=vd(e,this._options);let r=this._ri;if(n.style!==void 0){const l=this._coords??J.EmptyCell,a=J.cellToRange(l),c=()=>Ni(0,a,this._ri,this._options),u=sc(this._options.styles,n.style,c),d=(this._ri?.directStyle??new Jt(t.styles,a)).cloneWithUpdate(u);r={...r,directStyle:d}}let o=this._t,i=this._v;return n&&n.value!==void 0&&(i=n.value,o=n.type),i===this._v&&o===this._t&&r===this._ri?this:i!==null||r?new va(this._options,this._coords,o,i,r):new va(this._options,this._coords)}_isDate1904(){return this._options.date1904}getNumberFormat(e){if(e!==void 0){const t=this._v;return pw(t,this.getStyle(),this._t,e,n=>this._options.styles.parseColor(n),this._isDate1904())}return _w(this._t,this.getStyle(),this._v,this._options)}toDate(){return this._t!==Me.Number?null:this._ri?this.getNumberFormat().asDate:null}toText(e){return this.getNumberFormat(e).displayText}toTextUnformatted(e){if(e){const n=this.getFormulaText();if(n)return n}let t=this._v;return this.isSpillOverflow()&&(t=null),((n,r,o,i)=>{if(r===Me.Null||n==null)return"";if(r===Me.Number){const l=n,a=Xi(o),c=tc(o);if(a||c){const u=parseFloat(n),d=u%1!=0,h=u>=1;if(u<0)return V.castToString(n);if(!a||c||d)if(!c||a||h){const f=pi("Short Date",l,i),g=pi("Long Time",l,i);if(f&&g)return f.fmt+" "+g.fmt}else{const f=pi("Long Time",l,i);if(f)return f.fmt}else{const f=pi("Short Date",l,i);if(f)return f.fmt}}}if(r===Me.Number&&o.endsWith("%")){let l=V.roundAccurately(100*parseFloat(n));if(!isNaN(l))return l+"%"}return r===Me.Boolean?n?"TRUE":"FALSE":r===Me.Error?n?.getLabel?.()??He.Label.Unknown:r===Me.RichData?"(Rich Object)":V.castToString(n)})(t,this._t,this.getStyle().getNumberFormat(),{date1904:this._isDate1904()})}getComments(){const e=this._ri?.comments;return e?Object.freeze(e):null}getHyperlink(){const e=this._ri?.hyperlink;return e?new ib(this.toText.bind(this),this._options.opener,e):null}getErrors(){const e=this._ri;return e&&e.calcError?[e.calcError]:V.EmptyArray}getWarnings(){return V.EmptyArray}getSpans(){const e=this._ri?.merge;if(!e)return xv;const t=e.getCoords();return Object.freeze({width:t.colEnd-t.colStart+1,height:t.rowEnd-t.rowStart+1})}isTopLeft(){const e=this._ri?.merge;if(!e)return!0;const t=e.getCoords();return this._coords&&this._coords.colIndex===t.colStart&&this._coords.rowIndex===t.rowStart}getSpill(){let e=this._ri?.spills;if(!e||!this._coords)return null;Array.isArray(e)||(xl[0]=e,e=xl);let t=null;for(let n=0;!t&&n<e.length;n++){const r=e[n];r.getError()||(t=r)}return t||(t=e[0]),this._options.getRange(t.getCoords())}isSpillOverflow(){let e=this._ri?.spills;if(!e)return!1;if(!this._coords)return null;Array.isArray(e)||(xl[0]=e,e=xl);for(let t=0;t<e.length;t++){const n=e[t].getCoords();if(this._coords.colIndex===n.colStart&&this._coords.rowIndex===n.rowStart)return!1}return!0}get[Symbol.toStringTag](){return"[Cell]"}toString(){let e="{blank}";return this._v!==null&&(e=this.toTextUnformatted(),this.getType()===Me.String&&(e=`'${e}'`)),`${this.getA1()} => ${e}`}get isICell(){return!0}},Mv=class extends Ha{constructor(s){super(s,null,null,null)}isEmpty(){return!0}isContentful(){return!1}toString(){return"{EMPTY CELL}"}};class Tv{constructor(e,t,n){this._options=e,this._entry=t,this._coords=n}getTokens(e){const t=this._coords;return t?this._entry.getTokensAt(t.rowIndex,t.colIndex,e):V.EmptyArray}evaluate(e){const t=this._coords;return t?this._options.calcGraph().evaluateAt(t.rowIndex,t.colIndex,e):V.EmptyArray}toText(e){const t=this._coords;return t?"="+this._entry.getFormulaTextAt(t.rowIndex,t.colIndex,e):null}getDirectPrecedents(){const e=this._coords;return e?this._options.calcGraph().getDirectPrecedentsAt(e.rowIndex,e.colIndex):V.EmptyArray}getReferences(){const e=this._coords;return e?this._entry.getReferencesAt(e.rowIndex,e.colIndex):V.EmptyArray}setReferenceAt(e,t){const n=this._coords;return n?(this._options.calcGraph().setReferenceAt(n.rowIndex,n.colIndex,e,t),this):V.EmptyArray}get[Symbol.toStringTag](){return"[Formula]"}toString(){return this.toText()}}const xl=[null],du={colIndex:-1,rowIndex:-1};let hu;const $a=(s,e,t,n=!1)=>{const r=t===B.Orientation.Row,o=s.length,i=new Array(o);for(let l=0;l<o;l++){const a=s[l];if(r){const c=a.colEnd-a.colStart+1;i[l]={...a,colStart:n?a.colEnd+1:a.colStart,rowStart:e.rowStart,colEnd:n?a.colEnd+c:a.colEnd,rowEnd:e.rowEnd}}else{const c=a.rowEnd-a.rowStart+1;i[l]={...a,colStart:e.colStart,rowStart:n?a.rowEnd+1:a.rowStart,colEnd:e.colEnd,rowEnd:n?a.rowEnd+c:a.rowEnd}}}return i},Wi=(s,e,t)=>{const n=e,r=s.length;for(let o=0;o<r;o++){const i=s[o];if((i.rowStart<=n.rowStart&&i.rowEnd>=n.rowEnd)!==t)return!t}return t},ji=(s,e,t)=>{const n=e,r=s.length;for(let o=0;o<r;o++){const i=s[o];if((i.colStart<=n.colStart&&i.colEnd>=n.colEnd)!==t)return!t}return t},jf=(s,e)=>{let t=0;const n=s.length;for(let r=0;r<n;r++){const o=s[r];e===B.Orientation.Column?t+=o.colEnd-o.colStart+1:t+=o.rowEnd-o.rowStart+1}return t},kv=(s,e)=>{if(e){if(s.colStart<=e.colStart&&s.colEnd>=e.colEnd)return B.Orientation.Row;if(s.rowStart<=e.rowStart&&s.rowEnd>=e.rowEnd)return B.Orientation.Column}return s?(t=>t.rowEnd-t.rowStart>t.colEnd-t.colStart?B.Orientation.Column:B.Orientation.Row)(s):B.Orientation.Row},El=()=>!1,gu=()=>!0,Rl=()=>null,Gf=()=>Qt,Ir=()=>0,Uf=new class extends Ha{constructor(){super(null,null)}createTemporaryCell(){return this}getType(){return Me.Error}getWarnings(){return[rn]}getStyle(s=!1){return hu||(hu=new tl().getNormal(),hu)}toString(){return`${this._coords?Qi(this._coords):rn} => ${this._v??"{blank}"}`}},ur=()=>so,so={forEach:()=>{},[Symbol.iterator]:Gf,entries:Gf,select:gt,find:gt,calculate:gt,getCell:()=>Uf,getValue:Rl,setValue:gt,setFormula:gt,setValues:gt,updateCells:gt,updateStyle:gt,getCells:()=>[[Uf]],getStyleUpdater:gt,getValues:()=>[[null]],getBounds:Rl,getIntersect:ur,getUnion:ur,getDifferences:gt,getResizeBy:ur,getResizeTo:ur,getOffsetBy:ur,getOffsetTo:ur,getFixed:ur,getUsedRange:ur,getEntireRows:ur,getEntireColumns:ur,getSurrounding:gt,getExtended:gt,isEntireRows:El,isEntireColumns:El,isEntireRange:El,getWidth:Ir,getHeight:Ir,size:0,sort:gt,clear:gt,setHyperlink:gt,setComments:gt,merge:gt,unmerge:gt,getMerges:gt,insert:gt,insertFrom:gt,delete:gt,getDefaultShiftOrientation:gt,getDefaultSortCriteria:gt,autoFill:gt,autoFit:gt,getSnapshot:gt,copyFrom:gt,doBatch:gt,startIncrementalUpdates:gt,getRowHeaders:gt,getColumnHeaders:gt,getCounts:gt,getCount:Ir,isContentful:El,addListener:gt,getColumnStart:Ir,getRowStart:Ir,getColumnEnd:Ir,getRowEnd:Ir,getRowCount:Ir,getColumnCount:Ir,getVisible:gt,getCoords:Rl,isEmpty:gu,toString:()=>rn,getA1:()=>rn,isInvalid:gu,getSheet:Rl,isReadOnly:gu,isICellRange:!0};function Fr(s,e=null,t=null,n=rn){return s||t?Object.freeze({...so,getSheet:()=>s,bounds:()=>t,getA1:()=>n,toString:()=>t?Pr(t,e):n}):so}const Nv=/^[\\+-]?[0-9]*\.?[0-9]*$/,vw=(s,e,t)=>{if(s===void 0)throw new Error("A value is required to create a cell from a text.");const n=t??{value:null};if((s=V.castToString(s)).trim()==="")return n;if(s.toUpperCase()==="TRUE"||s.toUpperCase()==="FALSE")return n.value=s.toUpperCase()==="TRUE",n;if(s.startsWith("'")&&!e?.ignoreQuotePrefix)return n.style={quotePrefix:!0},n.value=s.substring(1,s.length),n;n.value=s;const r=",",o="$",i=".";let l=s.trim(),a=1,c=!1;l=(p=>{const w=new RegExp("([(]{1}([^(|^)]+)[)]{1})").exec(p);if(w?.[2]){const S=p.substring(0,w.index)+w[2].trim()+p.substring(w.index+("("+w[2]+")").length-1,p.length-1);return S.indexOf("(")>-1||S.indexOf(")")>-1?p:(c=!0,a=-1,S)}return p})(l);let u=0;l=(p=>{const w=new RegExp("[0-9]+([eE][-+]?[0-9]+)?$").exec(p);if(w?.[1]){const S=p.substring(0,p.length-w[1].length);let b=1,v=w[1].substring(1,w[1].length);if(v.startsWith("-")?(v=v.substring(1,v.length),b=-1):v.startsWith("+")&&(v=v.substring(1,v.length)),!isNaN(v))return u=v*b,S}return p})(l);let d=!1;if(l=(p=>{const w=new RegExp(`^(\\${o}[\\ ]*\\-|\\${o}[\\ ]*\\+|\\-[\\ ]*\\${o}|\\+[\\ ]*\\${o}|\\-|\\+)?`).exec(p);if(w?.[1]){const S=w?.[1].indexOf(o)>-1,b=w?.[1].indexOf("-")>-1,v=w?.[1].indexOf("+")>-1,y=(S?o:"")+p.substring(w.index+w[1].length,p.length).trim(),_=y.indexOf("-")>-1,C=y.indexOf("+")>-1;return _||C?p:(d=b||v,b&&(a=-1),y)}return p})(l),d&&(c||l.length===0))return n;let h=!1;if(l=(p=>{if(new RegExp(`^(?:\\${o}[\\ ]*)?((\\d{1,3}(${r}\\d{3})*)|(\\d*))(\\${i}|\\${i}\\d*)?(?:[\\ ]*\\%)?$`).test(l)){const w=p.replace(new RegExp(`${r}`,"g"),"");return h=w.length<p.length,w}return p})(l),l.match(Nv)&&!isNaN(l)){if(n.value=l*a,u!==0)n.value=n.value*Math.pow(10,u),n.style={numberFormat:`0${i+"0".repeat(2)}E+00`};else if(h){let p=ia(l);n.style=p>0?{numberFormat:`#${r}##0${i+"0".repeat(2)}`}:{numberFormat:`#${r}##0`}}return n}if(l.trimEnd().endsWith("%")&&l.trimEnd().length>1){let p=l.substring(0,l.length-1);if(!isNaN(p)){n.value=p*a/100;const w=ia(p);n.style=S=>{if(!S.getNumberFormat().includes("%"))return{numberFormat:w>0?`0${i+"0".repeat(2)}%`:"0%"}}}return n}if(l.startsWith(o)&&s.trim().length>1){let p=l.replace(o,"");if(!isNaN(p)){let w=ia(p);n.value=p*a,n.style=S=>{if(S.getNumberFormat().includes(o))return;let b;return b=w>0?`${o}#${r}##0${i+"0".repeat(2)}_);[Red](${o}#${r}##0${i+"0".repeat(2)})`:`${o}#${r}##0_);[Red](${o}#${r}##0)`,{numberFormat:b}}}return n}let f=null,g=null;try{g=c0(s,e?.date1904,!0);let p=s;g&&(p=g.leadingText),p.trim().length>0&&(f=qd(p,e?.date1904)),!f&&g?.leadingText.trim().length>0&&(g=null)}catch{}if(f||g){n.style=w=>{let S=w.getNumberFormat();const b=Xi(S);if(f&&b)return;const v=tc(S);if(!g||!v){if(f&&g&&!b&&!v?S="m/d/yyyy h:mm":f&&!b?S=f.numberFormat:g&&!v&&(S=g.numberFormat),g&&g.parsed.oaDateTime>1&&(S="General"),f&&!b&&!g){const y=Vt.Parser.formatValue(f.numberFormat,f.asOADate,{date1904:e?.date1904}),_=Intl.DateTimeFormat().resolvedOptions().locale??"en-US";y===new Intl.DateTimeFormat(_).format(f.asJSDate)?S="Short Date":y===new Intl.DateTimeFormat(_,{dateStyle:"full"}).format(f.asJSDate)?S="Long Date":y===new Intl.DateTimeFormat(_,{timeStyle:"medium"}).format(f.asJSDate)&&(S="Long Time")}return{numberFormat:S}}};let p=0;return f&&(p+=f.asOADate),g&&(p+=g.parsed.oaDateTime),n.value=p,n}const m=He.getBuiltInByLabel(s);return m?(n.value=m,n):(n.value=s,S0(s)?n.hyperlink=s:_0(s)&&(n.hyperlink=s,n.hyperlink.toLowerCase().startsWith("mailto:")||(n.hyperlink=`mailto:${n.hyperlink}`)),s.includes(`
`)&&(n.style={...n?.style,alignment:{overflow:oe.Overflow.Wrap}}),n)},Fv=s=>{const e=s.getFont().getUnderline()===ke.UnderlineStyle.SingleAccounting,t=s.getFont().getUnderline()===ke.UnderlineStyle.DoubleAccounting;let n=0;return(e||t)&&(n=s.measureText("").underlineThickness+1,t?n*=2:n+=1),n},fu=s=>{const e=[];return s.getUsedRange().forEachSpan((t,n)=>{const r=n.getCoords();t===0&&e.push(r)},{includeStyles:!1}),gr(To(e))},mu=(s,e,t,n)=>{const r=n?.asJSDate;let o;t?o=iw:(r||n?.includeMergeOverflow)&&(o={},r&&(o[je.Type.Style]=!1,o[je.Type.Table]=!1),n.includeMergeOverflow&&(o[je.Type.Merge]=!1));const i=n?.orientation??B.Orientation.Row,l=n?.maxSize??1e4,a=s({includeEmpty:!0,orientation:i,reverse:n?.reverse,excludeHidden:n?.excludeHidden,includeMergeOverflow:n?.includeMergeOverflow,includeRangeTypes:o,bounds:e,excludeCellDetails:!r}),c=i!==B.Orientation.Row,u=[];let d,h=-1,f=null,g=0;for(d=a.next();!d.done;){if(g>l)throw new Error(lw(l));const m=d.value,p=m.context.getCoords(),w=c?p.colIndex:p.rowIndex;w!==h&&(f=[],u.push(f),h=w);let S=m.value;if(t)S=m.context.getCell();else if(r&&S!==null&&typeof S=="number"){const b=m.context.getCell().toDate();b&&(S=b)}f.push(S),d=a.next(),g++}return u},Ri=(s,e)=>s===e||!(!s||!e)&&s.rowStart===e.rowStart&&s.rowEnd===e.rowEnd&&s.colStart===e.colStart&&s.colEnd===e.colEnd&&s.$rowStart===e.$rowStart&&s.$rowEnd===e.$rowEnd&&s.$colStart===e.$colStart&&s.$colEnd===e.$colEnd,Cw=(s,e)=>{if(!s)return;const t={...s};return e?typeof e=="boolean"?(t.$colStart=e,t.$rowStart=e,t.$colEnd=e,t.$rowEnd=e,t):(typeof e.colStart=="boolean"&&(t.$colStart=e.colStart),typeof e.rowStart=="boolean"&&(t.$rowStart=e.rowStart),typeof e.colEnd=="boolean"&&(t.$colEnd=e.colEnd),typeof e.rowEnd=="boolean"&&(t.$rowEnd=e.rowEnd),t):t};let pu=class{constructor(e,t,n){const r=this;this.setState=o=>{const i=o[0];let l=o[1],a=o[2];if(t&&t.includeMergeOverflow&&a&&a.merge){const u=t.bounds,d=a.merge.getCoords();let h=!1;const f=d.colStart,g=d.rowStart,m=u.colStart,p=u.rowStart,w=i.colIndex,S=i.rowIndex;!h&&f<m&&g>=p&&w===m&&S===g&&(h=!0),!h&&g<p&&f>=m&&S===p&&w===f&&(h=!0),!h&&g<p&&f<m&&S===p&&w===m&&(h=!0),h&&(l=a.merge.tvTl())}a&&Object.keys(a).length===0&&(a=null);let c=l;return l===void 0?(this._t=null,this._v=null,c=null):(this._t=pn(c),this._v=c),this._r=a,this._p=o[3],this._n=o[4],this._c=i,c},this.clear=()=>{r._c=null},this.context={getCoords(){const o=r._c;if(!o)throw new Error(_s);return o},getCell(){const o=r._c;if(!o)throw new Error(_s);if(this.excludeCellDetails)throw new Error("IteratorContext can only return a cell if the forEach excludeCellDetails has not been set to false.");const i=r._r,l=r._t,a=r._v;return a!==null||i?new Ha(n,o,l,a,i,r._p,r._n):new Ha(n,o)},getType:()=>r._t,getA1(o){if(!r.context)throw new Error(_s);let i=r._c;return o&&(i={...r._c,...o}),n.resolveRange(i).toString()},toJSDate(o){if(r._t!==Me.Number)return null;let i=o;if(i===void 0)i=r._v;else if(typeof i!="number")throw new Error("The arguments are not valid.");return Ts(i,n.date1904)}}}};const Br=(s,e)=>{if(s||e)return s&&e?{...s,...e}:s||e},qf=(s,e,t,n=B.Orientation.Row)=>{const r=s.getRange(e,{excludeHidden:n}),o=r.forEach((w,S)=>({break:S.getCoords()}),{excludeCellDetails:!0,orientation:n});if(!o)return;const i=n===B.Orientation.Row,l=new Map,a=new Map,c=new Map;let u=null;const d=s.getRange(o).getMerges();let h=d.length>0?1+(i?d[0].rowEnd-d[0].rowStart:d[0].colEnd-d[0].colStart):1;const f=i?o.rowIndex:o.colIndex;if(r.forEach((w,S)=>{const b=S.getCoords(),v=i?b.colIndex:b.rowIndex,y=i?b.rowIndex:b.colIndex;if(y===f)l.set(v,w);else{if(y!==f+h)return ff;typeof w=="string"?u=!1:w!==null&&a.set(v,w)}if(u!=null)return ff},{orientation:n,excludeCellDetails:!0,address:e}),u===null){const w=a.entries();let S=w.next();for(;u===null&&!S.done;){const[b,v]=S.value,y=l.get(b);y&&(typeof y=="string"?c.set(b,y):u=!1),S=w.next()}u=u??c.size>0}const g={colStart:o.colIndex,rowStart:o.rowIndex,colEnd:e.colEnd,rowEnd:e.rowEnd};if(g.colStart>g.colEnd||g.rowStart>g.rowEnd||J.isSingleCell(g))return null;const m=Math.min(Math.max(t?.colIndex??0,g.colStart),g.colEnd),p=Math.min(Math.max(t?.rowIndex??0,g.rowStart),g.rowEnd);return{coords:g,options:{...ms.DefaultRangeOptions,hasHeader:u,orientation:n,offset:n===B.Orientation.Row?m-g.colStart:p-g.rowStart},headers:c}},Jf=(s,e,t=null)=>ps.fromArray(s,(n,r)=>{const o=n?.[1];if(o==null)return null;let i=n[0]??null;switch(o){case Me.String:i=e.getById(i);break;case Me.Error:i=He.getBuiltInById(i);case Me.RichData:}return i},(n,r)=>{const o=pn(n);let i=n;switch(o){case Me.String:i=e.add(i);break;case Me.Error:i=i.getCode();case Me.RichData:}return[i,o]},t),Kf=(s,e)=>{const t=[],n=e?B.Orientation.Column:B.Orientation.Row,r=s.length;for(let o=0;o<r;o++){const i=s[o],l=i[0],a=i[1],c=a.length;for(let u=0;u<c;u++){const d=a[u],h=d[0],f=d[1].length-1,g={colStart:e?l:h,rowStart:e?h:l,colEnd:e?l:h+f,rowEnd:e?h+f:l,value:new rr({colStart:e?l:h,rowStart:e?h:l,colEnd:e?l:h+f,rowEnd:e?h+f:l},n)};t.push(g)}}return t},Ys=(s,e,t=-1)=>{if(!s||s.length===0)return null;const n=s.length===1&&s[0].rowStart===s[0].rowEnd&&s[0].colStart===s[0].colEnd,r=t===-1?s.length-1:Math.min(Math.max(0,t),s.length-1);return{cell:e??{rowIndex:s[r].rowStart,colIndex:s[r].colStart},ranges:n?[]:[...s],rangeIndex:n?-1:r}},ls=s=>{if(!s)return null;const e=[];if(s.ranges&&s.ranges.length>0){const t=Math.max(0,Math.min(s.rangeIndex??0,s.ranges.length));for(let n=t;n<s.ranges.length;n++)e.push(s.ranges[n]);for(let n=0;n<t;n++)e.push(s.ranges[n])}else s.cell&&e.push(J.cellToRange(s.cell));return e},Ft=(s,e)=>{if(!s||s.length===0)return null;let t=s.length-1;const n=s[t],r=s[0];if(!r||!r)return null;const o=s.length===1&&r.rowStart===r.rowEnd&&r.colStart===r.colEnd;return n?{cell:{rowIndex:n.rowStart,colIndex:n.colStart},ranges:o?[]:[...s],rangeIndex:o?-1:t}:null},Xf="Item has been closed. No further operations are allowed.";let lc=class{constructor(e){if(this._emitter=null,this._closed=!1,!e)throw new Error("Anchored.ConstructorOptions is required");if(this._options={...e},!this._options.initialAnchor)throw new Error("Initial anchor is required");const t=this;this._transactions=this._options.transactions??new ir({transient:!0}),this._emitter=new wn(this,this._transactions),this._updateState({anchor:this._options.initialAnchor},{description:e?.createDescription??"Create Anchored Item"}),this._options.setContainerShiftCallback?.(n=>t._processContainerShift(n)),this._options.setContainerLayoutCallback?.(()=>{t._processContainerLayout()}),this._options.setContainerDeleteCallback?.(()=>{t._processContainerDelete()}),this._options.setContainerProtectionCallback?.(()=>{t._processContainerProtection()}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onBeforeCommitStart(n,r,o){t._processBeforeCommitStart(n,r,o)},onAfterStateChange(n,r,o){t._processStateChange(n,r,o),t._processAnchorCoords(),t._emitter.notify("onAnchorCoordsChange")},onRestoreOrRevert(n,r,o){t._processRestoreOrRevert(n,r,o)}})}_getEmitter(){return this._emitter}delete(e){this._options.deleteFromContainer?.(e)}getAnchorCoords(){return this._getState()?.anchor??null}getAnchorType(){return this._getState()?.anchorType??Ut.Type.TwoCell}isProtected(){return this._options.isProtected?.()??!1}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(Xf);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_getTransactions(){return this._transactions}_updateState(e,t,n){if(this._closed)throw new Error(Xf);if(!e)return;const r=this._beginCommit(t?.description);try{r.updateState(this,e);let o=!1;if(n)for(let i=0;i<n.length;i++){const l=n[i];o=o||l==="onAnyChange",this._emitter.notify(l)}!o&&n&&n.length>0&&this._emitter.notify("onAnyChange"),r.commit()}catch(o){throw r.rollback(),o}return this}_processContainerShift(e){let t=null;const n={anchor:e.after};return e.after||(n.isDeleted=!0,t=["onDelete"]),this._updateState(n,{description:"Update Anchor"},t),e.after}_processBeforeCommitStart(e,t,n){}_processStateChange(e,t,n){}_processRestoreOrRevert(e,t,n){this._emitter.notify("onInvalidated")}_processAnchorCoords(){}_processContainerLayout(){}_getDescription(){return null}_delete(){const e=this._getDescription(),t="Delete",n=e?`${t} ${e}`:t,r=this._beginCommit(n);try{this._processDelete(),r.commit()}catch(o){throw r.rollback(),o}}_processContainerDelete(){this._processDelete()}_processDelete(){}_processContainerProtection(){this._emitter.notify("onProtectedChange")}addListeners(e,t){return this._emitter.addListeners(e,t)}isClosed(){return this._closed}_processClose(){this._closed=!0,this._emitter.notify("onClose"),this._transactionsRemoveListener?.()}close(){this._closed||this._processClose()}get isIAnchored(){return!0}};var bs,po;(po=bs||(bs={})).fastStringToCol=X1,po.fastStringToCell=ds,po.fastStringToRange=Bn,po.rangeToString=Pr,po.cellToString=co,po.normalizeA1ToR1C1=eb,po.resolveRelativeToA1=Q1;const Ov=(s,e)=>s.offset-e.offset,Zf=s=>{if(!s||s.size===0)return[];let e=[];return s.forEach((t,n)=>{t&&Object.keys(t).length!==0&&e.push({...t,offset:n})}),e.sort(Ov)};class Dv extends lc{constructor(e){super({...e,createDescription:"Insert AutoSort"}),this._apply=e.apply,this._processUpdate=e.processUpdate,this._fromJSON(e.json)}getRange(){return this._getState().anchor}getFieldAt(e){const t=this._getState().byOffset.get(e)??null;return t?Object.keys(t).length===0||Object.keys(t).length===1&&t.hasOwnProperty("offset")?null:{collatorOptions:null,...t}:null}insertSort(){return null}getSort(){return null}apply(e){const t=this._getState().byOffset,n=new Map(t);for(let r=0;r<e.length;r++){const o={...e[r]},i=o.offset;delete o.offset,n.set(i,o)}return this._updateState({byOffset:n},{description:"Set Sort Criteria"}),this.reapply()}setFieldAt(e,t){const n=this._getState().byOffset,r=new Map(n);return t&&Object.keys(t).length>0?r.set(e,t):r.delete(e),this._updateState({byOffset:r},{description:"Sort"}),this.reapply()}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._processUpdate?.()}reapply(){const e=this._getState(),t=Zf(e.byOffset);return this._apply?.(t),this}clear(){return this._updateState({byOffset:new Map},{description:"Clear Sort"}),this.reapply()}_fromJSON(e){const t=e??{},n={byOffset:new Map};if(t.fields)for(let r=0;r<t.fields.length;r++){let o=t.fields[r];const i=o.offset;o={...t.fields[r]},delete o.offset,n.byOffset.set(i,o)}this._updateState(n,{description:"Load"})}toJSON(){const e={},t=this._getState();t.anchor&&(e.ref=bs.rangeToString(t.anchor,this._options.maxRangeCoords));const n=Zf(t.byOffset);return n.length>0&&(e.fields=n),Object.keys(e).length===0?null:e}}const Lv=(s,e)=>s.offset-e.offset,wu=s=>{if(!s||s.size===0)return[];let e=[];return s.forEach((t,n)=>{t&&Object.keys(t).length!==0&&e.push({...t,offset:n})}),e.sort(Lv)},Yf=(s,e=new Map)=>{if(!s||s.length===0)return e;for(let t=0;t<s.length;t++){const n={...s[t]},r=n.offset;delete n.offset,e.set(r,n)}return e},Su=s=>{let e=0;const t=s.entries();let n=null;do n=t.next(),n.value?.[1]&&n.value[1].hiddenButton&&e++;while(!n.done);return e};class xw extends lc{constructor(e){super({...e,createDescription:"Insert AutoFilter"}),this._apply=e.apply,this._processUpdate=e.processUpdate,e.setFilterCoordsCallback?.(t=>{this._getState().anchor}),this._fromJSON(e.json)}getCoords(){return this._getState().anchor}getFieldAt(e){const t=this._getState().byOffset.get(e)??null;return t?Object.keys(t).length===0||Object.keys(t).length===1&&t.hasOwnProperty("offset")?null:{hiddenButton:!1,criteria:V.EmptyArray,...t}:null}insertSort(){return null}getSort(){return null}apply(e){const t=this._getState().byOffset,n=new Map(t);return Yf(e,n),this._updateState({byOffset:n,hiddenCount:Su(n)},{description:"Set Filter Criteria"}),this.reapply()}setFieldAt(e,t){const n=this._getState(),r=n.anchor.colEnd-n.anchor.colStart+1;if(e<0||e>r-1)throw new Error(`Invalid range: '${e}'`);const o=n.byOffset,i=new Map(o);t&&Object.keys(t).length>0?i.set(e,t):i.delete(e);const l=o.get(e)?.hiddenButton===!0?1:0,a=t?.hiddenButton===!0?1:0;return this._updateState({byOffset:i,hiddenCount:Math.min(r,Math.max(0,n.hiddenCount+a-l))},{description:"Set Filter Criteria"}),this.reapply()}getShowFilterButton(){const e=this._getState(),t=e.anchor,n=t.colEnd-t.colStart+1;return e.hiddenCount<n}setShowFilterButton(e){const t=this.getAnchorCoords(),n=t.colEnd-t.colStart+1;let r=Array(n);const o=this._getState().byOffset,i=wu(o);for(let a=0;i&&a<i.length;a++){const c={...i[a]};r[c.offset]=c,e?delete c.hiddenButton:c.hiddenButton=!0}if(!e)for(let a=0;a<r.length;a++)r[a]||(r[a]={hiddenButton:!0});const l=new Map;for(let a=0;a<r.length;a++){const c=r[a];l.set(a,c)}return this._updateState({byOffset:l,hiddenCount:e?l.size:0},{description:(e?"Hide":"Show")+" Filter Buttons"}),this._processUpdate?.(),this}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._processUpdate?.()}_processContainerShift(e){if(e.after&&e.orientation===B.Orientation.Column){let t=e.intersect.colStart-e.before.colStart,n=e.amount;t<=0&&(n-=t,t=0);const r=this._getState().byOffset,o=new Map(r);if(r.forEach((i,l)=>{i&&Object.keys(i).length!==0&&(l>=t&&o.delete(l),l>t&&o.set(l+n,i))}),n>0&&this._getState().hiddenCount>0)for(let i=t;i<t+n;i++)o.set(i,{hiddenButton:!0});this._updateState({byOffset:o,hiddenCount:Su(o),sort:null},{description:"Update Fields"})}return super._processContainerShift(e)}reapply(){const e=this._getState(),t=wu(e.byOffset);return this._apply?.(t),this}clear(){return this._updateState({byOffset:new Map,hiddenCount:0,sort:null},{description:"Set Filter Criteria"}),this.reapply()}_fromJSON(e){const t=e??{},n={byOffset:new Map,hiddenCount:0};t.fields&&(Yf(t.fields,n.byOffset),n.hiddenCount=Su(n.byOffset)),t.sort,this._updateState(n,{description:"Load"})}toJSON(){const e={},t=this._getState();t.anchor&&(e.ref=Pr(t.anchor,this._options.maxRangeCoords));const n=wu(t.byOffset);return n.length>0&&(e.fields=n),t.sort,Object.keys(e).length===0?null:e}}const Cd="A table must have a least one row for the data.",Qf="Table1",Il=Object.freeze({showRowStripes:!0,showColumnStripes:!1,showFirstColumn:!1,showLastColumn:!1}),em=(s,e,t)=>{if(s.length!==e.length)return console.warn("make columns the same length"),!1;const n=new Set;for(let a=0;a<e.length;a++){const c=e[a]?.name;c&&n.add(c.toLocaleLowerCase())}for(let a=0;t&&a<t.length;a++){const c=t[a]?.name;c&&n.add(c.toLocaleLowerCase())}const r=(a,c="")=>{if(!a)return!1;const u=a.toLocaleLowerCase();return u===c||!n.has(u)};let o=1;const i=(a,c,u,d,h=1e3)=>{if(d(a,u=(u??"").trim().toLocaleLowerCase()))return a;for(;o<h;)try{const f=c+ ++o;if(d(f,u))return f}catch{}throw new Error(`Unable to find valid name for '${c}'.`)};let l=0;for(let a=0;a<s.length;a++){const c=s[a]?.name;if(c&&c===e[a]?.name)continue;const u=i(c,s[a]?.name||"Column",e[a]?.name,r);n.add(u.toLocaleLowerCase()),e[a]?.name!==u&&(s[a].name=u,l++)}return l>0};class Bv{constructor(e,t,n,r){this._name=e,this._filter=t,this._sort=n,this._offset=r}getName(){return this._name}getField(){return this._filter?this._filter.getFieldAt(this._offset)??null:null}setField(e){return this._filter?(this._filter.setFieldAt(this._offset,e),this):this}getSortField(){return this._sort?this._sort.getFieldAt(this._offset):null}setSortField(e){return this._sort?(this._sort.setFieldAt(this._offset,e),this):this}reapply(){return this._filter?.reapply(),this}clear(){return this._filter?.setFieldAt(this._offset,null),this._sort?.setFieldAt(this._offset,null),this}hasHiddenButton(){return this._filter?.getFieldAt(this._offset)?.hiddenButton??!1}}class zv extends P0{constructor(e,t,n,r){super({...r,type:"namedTable"}),this._names=e,this._sheet=t,this._table=n;const o=this;this._table.addListeners({onDelete:()=>{o._options.deleteFromContainer?o._options.deleteFromContainer?.():o._delete()},onAnyChange:()=>{o._emitter.notify("onAnyChange")},onAnchorCoordsChange:()=>{o._emitter.notify("onAnyChange")}},{transactional:!0})}async select(e){return await this._table.select(e),this}getRanges(){return this._names.getRanges(this._table.getUsedRange())}getScope(){return null}getType(){return"table"}getName(){return this._table.getName()}getValue(){return this._table}}class Pv extends lc{constructor(e){if(super({...e,createDescription:"Insert Table"}),this._isUpdatingHeader=!1,this._colHeadersSizeUnlistener=null,this._rowHeadersSizeUnlistener=null,this._visibleRange=null,this._isHeaderVisible=!0,this._isTotalVisible=!0,this._isFirstColumnVisible=!0,this._isLastColumnVisible=!0,this._range=null,!e.json)throw new Error("json is required");if(!e.json.ref)throw new Error("json.ref is required");const t=this;this._styles=e.styles??e.sheet?.getStyles()??new tl,this._names=e.names,this._sheet=e.sheet,this._processTableUpdate=e.processTableUpdate,this._setNameOnContainer=e.setNameOnContainer,this._options={...e},this._styleCache=null,this._stylePropsCache=null,this._stylesRemoveListener=this._styles.addListeners({onTableStylesChange(){t._styleCache=null,t._stylePropsCache=null,t._getEmitter().notify("onStyleChange"),t._getEmitter().notify("onAnyChange")}});const n={...e?.json};if(e.sheet){const r=e.sheet;if(this._autoExpandRemoveListener=r.getEntireRange().addListener(l=>{if(l.trigger!=="setCells"||l.isUndo)return;const a=t.getAnchorCoords();if(!a)return;let c=l.getSource().getCoords();Array.isArray(c)&&(c=c[0]);let u=null;if(c.rowStart>=a.rowStart&&c.rowEnd<=a.rowEnd&&c.colStart>=a.colStart&&c.colStart<=a.colEnd+1&&c.colEnd>a.colEnd){const d={...c,colStart:a.colEnd+1};if(r.getRange(d).isContentful()){const h={...d,rowStart:a.rowStart,rowEnd:d.rowStart-1};if(h.rowEnd-h.rowStart<0||!r.getRange(h).isContentful()){const f={...d,rowStart:d.rowEnd+1,rowEnd:a.rowEnd};(f.rowEnd-f.rowStart<0||!r.getRange(f).isContentful())&&(u={...a,colEnd:c.colEnd})}}}else if(!t.getShowTotals()&&c.colStart>=a.colStart&&c.colEnd<=a.colEnd&&c.rowStart>=a.rowStart&&c.rowStart<=a.rowEnd+1&&c.rowEnd>a.rowEnd){const d={...c,rowStart:a.rowEnd+1};if(r.getRange(d).isContentful()){const h={...d,colStart:a.colStart,colEnd:d.colStart-1};if(h.colEnd-h.colStart<0||!r.getRange(h).isContentful()){const f={...d,colStart:d.colEnd+1,colEnd:a.colEnd};(f.colEnd-f.colStart<0||!r.getRange(f).isContentful())&&(u={...a,rowEnd:c.rowEnd})}}}if(u&&r.getRange(u).getMerges().length>0&&(u=null),u&&r.getTables().getItems({address:u}).length!==1&&(u=null),u){const d=t._beginCommit("Table Auto Expansion");try{t.resize(u),d.commit({viewAfter:null})}catch(h){d.rollback(),console.warn("Unable to AutoExpand"),console.warn(h)}}},{transactional:!1,ignoreShifts:!0}),this._headerValueListener=()=>{if(this._isUpdatingHeader)return;const l=this._columnsFromSheet();l&&this._updateColumns(l.columns,!1,l.forceUpdate,null)},e.readSheetHeader){const l=this._columnsFromSheet();n.columns=l.columns}const o=()=>{const l=this.getAnchorCoords();let a=0,c=0;if(l&&(a=r.getColumnHeaders().findVisibleIndex(l.colEnd).min,c=r.getRowHeaders().findVisibleIndex(l.rowEnd).min),l&&(a<l.colEnd||c<l.rowEnd)){const u=r.getColumnHeaders(),d=r.getRowHeaders(),h=u.findVisibleIndex(l.colStart).max,f=d.findVisibleIndex(l.rowStart).max;this._visibleRange={colStart:h,colEnd:a,rowStart:f,rowEnd:c},this._isHeaderVisible=!d.at(l.rowStart).isHidden(),this._isTotalVisible=!d.at(l.rowEnd).isHidden(),this._isFirstColumnVisible=!u.at(l.colStart).isHidden(),this._isLastColumnVisible=!u.at(l.colEnd).isHidden()}else this._visibleRange=null,this._isHeaderVisible=!0,this._isTotalVisible=!0,this._isFirstColumnVisible=!0,this._isLastColumnVisible=!0},i={onSizesChange:()=>{o()}};this._colHeadersSizeUnlistener=r.getColumnHeaders().addListeners(i),this._rowHeadersSizeUnlistener=r.getRowHeaders().addListeners(i),o()}this._fromJSON(n),this._names&&(this._namedItem=this._createNamed(),this._namedItem&&this._names.add(this._namedItem))}getSnapshot(e){const t=this.toJSON(),n=this.getAnchorCoords(),r=this.getName(),o={...t};delete o.ref;const i=this,l=Object.freeze({...e});let a=!1;return{async copyTo(c,u){const d=c.tables,h=c.range;({...l,...u}).isCut&&!a&&(i.delete(),a=!0);const f={colStart:h.colStart,rowStart:h.rowStart,colEnd:n.colEnd-n.colStart+h.colStart,rowEnd:n.rowEnd-n.rowStart+h.rowStart};return d.add(f,{json:o,isLoad:!0,hasHeader:!0,styleName:o.styleOptions?.name??null}),f},getCoords:()=>n,getSource:()=>i,getName:()=>r,getMarkOptions:()=>l,isISnapshot:!0}}getAnchorType(){return Ut.Type.TwoCell}getStyle(){if(this._styleCache)return this._styleCache;const e=this._getState();return e?(this._styleCache=this._styles.getTableStyle(e.styleOptions.name)??this._styles.getDefaultTableStyle(),this._styleCache):this._styles.getTableStyle(null)}addRows(e,t=1){const n={...this._getState().anchor};return n.rowEnd+=t,this._modifyTable({anchor:n},"Add Table Row"+(t>1?"s":"")),this}deleteRowsAt(e,t=1){let n={...this._getState().anchor};return n.rowEnd-=t,n.rowEnd<n.rowStart&&(n=null),this._modifyTable({anchor:n},"Delete Table Row"+(t>1?"s":"")),this}addColumn(e,t){const n=this._getState(),r={...n.anchor};r.colEnd+=1;const o=[],i={name:`${t??n.columns[e-1]?.name??`Column${e+1}`}3`};o.push(i);const l=[...n.columns.slice(0,e),...o,...n.columns.slice(e)];return this._modifyTable({anchor:r,columns:l},"Add Table Column"),i}getColumns(){return this._getState()?.columns}convertToRange(e=Number.MAX_SAFE_INTEGER){let t=this._beginCommit("Convert to Range");try{if(this._sheet){const n=this.getAnchorCoords(),r=(n.colEnd-n.colStart+1)*(n.rowEnd-n.rowStart+1);if(r>e)throw new Error(`There are ${r} and there is a limit of ${e}.`);const o=this._sheet.getRange(n),i=o.startIncrementalUpdates({orientation:B.Orientation.Column});o.forEach((l,a)=>{const c=a.getCoords(),u=a.getCell();i.pushAt(c.rowIndex,c.colIndex,{style:u.getStyle(!1)})},{includeEmpty:!0,orientation:B.Orientation.Column}),i.apply()}this.delete()}catch{t.rollback(),t=null}return t&&t.commit(),this._sheet.getRange(this._getState()?.anchor)}resize(e,t="Resize Table"){let n=this._sheet.getRange(e).getCoords();const r=this._getState().anchor;if(r.rowStart!==n.rowStart||n.colEnd<r.colStart||n.colStart>r.colEnd)throw new Error("The top of the table must not change and the new table location must overlap with the original table.");const o=this._beginCommit(t);try{n=this._options.setContainerCoords(e),J.isEqualRanges(n,r)||this._modifyTable({anchor:n}),o.commit()}catch(i){throw console.warn(i),o.rollback(),i}return this._sheet.getRange(n)}getName(){return this._getState()?.name}setName(e){const t=this._beginCommit(`Set Table Name '${e}'`);try{this._modifyTable({name:e}),t.commit()}catch(n){throw t.rollback(),n}return this}getDescription(){return this._getState()?.description}setDescription(e){return this._modifyTable({description:e})}select(e){return this.getUsedRange().select(e)}getRange(){return this._range?this._range:this._getState()?this._range=this._sheet.getRange(this._getState().anchor):so}_processRestoreOrRevert(e,t,n){this._styleCache=null,super._processRestoreOrRevert(e,t,n)}_processAnchorCoords(){this._range=null,super._processAnchorCoords()}getUsedRange(){const e=this._getUsedCoords();return e?this._sheet.getRange(e):so}_getUsedCoords(){const e=this._getState(),t=e.headerRowCount,n=e.totalsRowCount,r=e.anchor;if(!r)return null;const o={...r,rowStart:r.rowStart+t,rowEnd:r.rowEnd-n};return o.rowEnd<o.rowStart||o.colEnd<o.colStart?null:o}getHeaderRange(){const e=this._getHeaderCoords();return e?this._sheet.getRange(e):so}_getHeaderCoords(){const e=this._getState(),t=e.headerRowCount;if(t<1)return null;const n=e.anchor;return n?{...n,rowEnd:n.rowStart+t-1}:null}getTotalRange(){const e=this._getTotalCoords();return e?this._sheet.getRange(e):so}_getTotalCoords(){const e=this._getState(),t=e.totalsRowCount;if(t<1)return null;const n=e.anchor;return n?{...n,rowStart:n.rowEnd-t+1}:null}getStyleOptions(){return this.isClosed()?Il:this._getState()?.styleOptions}updateStyleOptions(e,t="Update Style Info"){const n=this.getStyleOptions(),r=e?{...n,...e}:Il;return this._modifyTable({styleOptions:r},t),this._styleCache=null,this._getEmitter().notify("onStyleChange"),this}getStyleAt(e){let t=this._stylePropsCache;return t||(t=this.getStyle().getRanged(this),this._stylePropsCache=t),Is(this._styles,t,J.cellToRange(e))}getShowTotals(){return this._getState()?.totalsRowCount>0}setShowTotals(e){return this._modifyTable({totalsRowCount:e?1:0},"Toggle Show Totals")}getShowHeaders(){return this._getState()?.headerRowCount>0}setShowHeaders(e){return this._modifyTable({headerRowCount:e?1:0},"Toggle Show Headers")}getShowFilterButton(){const e=this.getFilter();return!!e&&e.getShowFilterButton()}setShowFilterButton(e){const t=this.getFilter();return t?(t.setShowFilterButton(e),this):this}_applyFilterAndSort(){console.log("apply Filter",this.getFilter(),this.getSort()),this._processTableUpdate?.(),this._getEmitter().notify("onAnyChange")}_processUpdate(){this._processTableUpdate?.(),this._getEmitter().notify("onAnyChange")}_createFilter(e){const t=this;return new xw({initialAnchor:this._getUsedCoords(),maxRangeCoords:this._options.maxRangeCoords,json:e,transactions:this._getTransactions(),setContainerShiftCallback(n){t._filterShiftCallback=n},setFilterCoordsCallback(n){t._filterCoordsCallback=n},deleteFromContainer:n=>{this._updateState({filter:null},{description:n?.description??"Delete Filter"}),t._processUpdate?.()},apply:n=>{t._applyFilterAndSort()},processUpdate:()=>{t._processUpdate?.()},isProtected:()=>t.isProtected()})}insertFilter(){let e=this.getFilter();return e||(e=this._createFilter(),this._updateState({filter:e},{description:"Insert Filter"}),e)}getFilter(){return this._getState()?.filter??null}_createSort(e){const t=this;return new Dv({initialAnchor:this._getUsedCoords(),maxRangeCoords:this._options.maxRangeCoords,json:e,transactions:this._getTransactions(),deleteFromContainer:n=>{this._updateState({sort:null},{description:n?.description??"Delete Sort"}),t._processUpdate?.()},apply:n=>{t._applyFilterAndSort()},processUpdate:()=>{t._processUpdate?.()},isProtected:()=>t.isProtected()})}insertSort(){let e=this.getSort();return e||(e=this._createSort(),this._updateState({sort:e},{description:"Insert Sort"}),e)}getSort(){return this._getState()?.sort??null}getColumnFilter(e){const t=this.getFilter();if(!t)return null;const n=this.getSort();let r=null;return r=this._getState()?.columns[e],r===null?null:new Bv(r.name,t,n,e)}getVisibleRefRangeCoords(){return this._visibleRange?this._visibleRange:this.getAnchorCoords()}getVisibleCellCoords(e){return e&&this._visibleRange?{colIndex:Math.min(this._visibleRange.colEnd,Math.max(this._visibleRange.colStart,this._sheet.getColumnHeaders().findVisibleIndex(e.colIndex).min)),rowIndex:Math.min(this._visibleRange.rowEnd,Math.max(this._visibleRange.rowStart,this._sheet.getRowHeaders().findVisibleIndex(e.rowIndex).min))}:e}isHeaderVisible(){return this._isHeaderVisible}isTotalVisible(){return this._isTotalVisible}isFirstColumnVisible(){return this._isFirstColumnVisible}isLastColumnVisible(){return this._isLastColumnVisible}_columnsFromSheet(){const e=this._getHeaderCoords();if(!e||!this._sheet){const n=this.getAnchorCoords();return{columns:n?Array(n.colEnd-n.colStart+1).fill(null):[],forceUpdate:!0}}const t={columns:[],forceUpdate:!1};return this._sheet.getRange({...e,rowEnd:e.rowStart}).forEach((n,r)=>{const o=r.getCell();t.columns.push({name:o.toText()}),t.forceUpdate=t.forceUpdate||o.getType()!==Me.String},{includeEmpty:!0}),t}_updateColumns(e,t,n=!1,r){if(this._isUpdatingHeader)return;const o=this._getHeaderCoords(),i=this._getUsedCoords(),l=[];if(i){const h=i.colEnd-i.colStart+1;for(let f=0;f<h;f++){const g=e[f];l.push({...g})}}let a=!1;const c=this._getState().columns;if(a=t?((h,f)=>{const g=new Set,m=S=>!!S&&!g.has(S.toLocaleLowerCase()),p=(S,b,v,y)=>y(S)?S:b+(v+1);let w=0;for(let S=0;S<h.length;S++){const b=p(h[S]?.name||f[S]?.name,h[S]?.name||"Column",w,m);g.add(b.toLocaleLowerCase()),h[S]?.name!==b&&(h[S].name=b,w++)}return w>0})(l,c):em(l,c,r),!(n||c.length!==l.length||a))return;const u="Update Columns";this._isUpdatingHeader=!0;let d=this._beginCommit(u);try{if(this._updateState({columns:l},{description:u}),this._sheet&&o){const h=this._sheet.getEntireRange().startIncrementalUpdates({orientation:B.Orientation.Row});for(let f=0;f<l.length;f++){const g=l[f].name;h.pushAt(o.rowStart,o.colStart+f,g)}h.apply({textParser:!1})}}catch{d.rollback()}return d&&d.commit(),this._isUpdatingHeader=!1,l}_processDelete(){this._getState().headerRemoveListener?.(),this._updateState({headerRemoveListener:null}),super._processDelete()}_processFilterUpdate(){const e=this._getUsedCoords();console.log("process on Filter and Sort dataRange",e)}_processContainerShift(e){if(e.isSplit)throw new Error("We can not partially insert or remove cells as this would split a table.");const t=this._getState();if(e.after&&e.after.rowStart+t.headerRowCount>=e.after.rowEnd+1)throw new Error(Cd);const n=e.orientation===B.Orientation.Column;if(e.amount<0&&e.after&&!n){const o=this._getHeaderCoords();if(o&&e.intersect.rowStart<=o.rowEnd&&e.intersect.rowEnd>=o.rowStart)throw new Error("We can not remove rows that contain table headers. Remove the table header.")}const r=super._processContainerShift(e);if(n){let o=e.amount,i=e.intersect.colStart-e.before.colStart;if(i<=0&&o>0)return;i<0&&(o-=i,i=0);const l=this._getState()?.columns;let a=[...l],c=[],u=[];if(o>0){a.splice(i,0,...Array(o).fill(null)),c=[...a];const d=new Set;for(let p=0;p<l.length;p++)d.add(l[p]?.name?.toLowerCase().trim());const h=l[i-1],f=h?.name?.match(/\d+$/);let g=null,m=0;f&&(g=f.input.substring(0,f.index),m=parseInt(f[0]));for(let p=0;p<o;p++){let w={...h};c[i+p]=w;const S=g+(m+p+1);S&&!d.has(S.toLowerCase().trim())&&(w.name=S)}em(c,a,null)}else c=a,u=c.splice(i,-o);this._updateState({columns:c},{description:"Process Columns"}),this._updateColumns(c,!1,!0,u)}else e.after||this._updateState({columns:[]},{description:"Process Columns"});return e.after||this._delete(),this._filterShiftCallback&&this._filterShiftCallback({...e,after:this._getUsedCoords()}),r}_modifyTable(e,t="Modify Table"){if(this.isClosed())throw new Error("Table has been closed. No further operations are allowed.");const n=this._getState(),r=n.anchor,o=n.headerRowCount,i=this._getHeaderCoords();let l=this._beginCommit(t);try{if(this._updateState(e),e.name!==void 0){if(!e.name)throw new Error("Table must have a name.");this._setNameOnContainer?.(e.name)}let a=e.anchor??null;if((e.anchor!==void 0||e.headerRowCount!==void 0||e.totalsRowCount!==void 0)&&e.headerRowCount!==void 0&&o!==e.headerRowCount)if(e.headerRowCount>o){const c=r.rowStart-(e.headerRowCount-o);this._sheet&&(c<this._options.maxRangeCoords.rowStart||this._sheet.getRange({...r,rowStart:c,rowEnd:r.rowStart-1}).isContentful())?(this._sheet.getRange({...r,rowStart:r.rowStart+e.headerRowCount,rowEnd:r.rowStart+e.headerRowCount}).insert(B.Orientation.Row),a={...r,rowEnd:r.rowEnd+(e.headerRowCount-o)}):a={...r,rowStart:r.rowStart+(o-e.headerRowCount)}}else i&&this._sheet&&this._sheet.doBatch(()=>{this._sheet.getRange(i).clear()},{}),a={...r,rowStart:r.rowStart+(o-(e.headerRowCount??o))};if(a){let c=n.columns;const u=e.headerRowCount!==void 0&&e.headerRowCount!==n.headerRowCount||e.totalsRowCount!==void 0&&e.totalsRowCount!==n.totalsRowCount,d=a.colStart!==r.colStart||a.colEnd!==r.colEnd;let h=[];if(d){const f=[...n.columns];a.colEnd>r.colEnd?f.splice(r.colEnd+1,0,...Array(a.colEnd-r.colEnd).fill(null)):a.colEnd<r.colEnd&&(h=f.splice(a.colEnd-1,r.colEnd-a.colEnd)),a.colStart<r.colStart?f.splice(0,0,...Array(r.colStart-a.colStart).fill(null)):a.colStart>r.colStart&&(h=h.concat(f.splice(0,a.colStart-r.colStart))),c=f}if(this._options.setContainerCoords?.(a),this._updateState({anchor:a,columns:c},{description:t}),!this._getUsedCoords())throw new Error(Cd);if(d||u){const f=u?{columns:c,forceUpdate:!0}:this._columnsFromSheet();f&&(this._updateColumns(f.columns,!1,f.forceUpdate,h),this._processHeaderListener())}this._filterCoordsCallback?.(a)}e.styleOptions!==void 0&&(this._styleCache=null),this._getEmitter().notify("onAnyChange"),l.commit()}catch(a){throw l.rollback(),a}return this}addListeners(e,t){return this._emitter.addListeners(e,t)}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._styleCache=null,this._stylePropsCache=null,this._processTableUpdate?.(),this._getEmitter().notify("onAnyChange")}_processHeaderListener(){if(this._getState().headerRemoveListener?.(),this._sheet){let e=this._getHeaderCoords();if(!e){const n=this._getUsedCoords();e={...n,rowEnd:n.rowStart}}const t=this._sheet.getRange(e).addListener(this._headerValueListener,{transactional:!0});this._updateState({headerRemoveListener:t})}}toJSON(){const e={},t=this._getState();if(!t)return null;if(t.name&&(e.name=t.name),t.anchor&&(e.ref=Pr(t.anchor,this._options.maxRangeCoords)),t.description&&(e.description=t.description),t.headerRowCount!==1&&(e.headerRowCount=t.headerRowCount),t.totalsRowCount!==0&&(e.totalsRowCount=t.totalsRowCount),t.columns&&(e.columns=[...t.columns]),t.styleOptions){const n=V.diffValues(t.styleOptions,{...Il,name:null});n&&(e.styleOptions=n)}if(t.filter){const n=t.filter.toJSON();n&&(e.filter=n,delete e.filter.ref)}return e}_createNamed(){return this._sheet?.getName()&&this._names?new zv(this._names,this._sheet,this,{transactions:this._getTransactions(),json:{name:this.getName()}}):null}_fromJSON(e){const t=e??{},n={headerRowCount:1,totalsRowCount:0};var r;if(t.name&&(n.name=t.name),t.ref&&(t.ref=(r=t.ref)&&typeof r=="string"?qn(r):r),this._names){const l=this._names.findValidName(n.name??Qf);n.name!==l&&(n.name=l)}n.name||(n.name=Qf),t.description&&(n.description=t.description),t.headerRowCount!==void 0&&(n.headerRowCount=t.headerRowCount),t.totalsRowCount!==void 0&&(n.totalsRowCount=t.totalsRowCount),n.columns=t.columns??V.EmptyArray,n.styleOptions={...Il,...t.styleOptions};const o="Insert Table";this._updateState(n,{description:o});const i=this._columnsFromSheet();i&&(n.columns=this._updateColumns(i.columns,!0,i.forceUpdate,null),delete n.columns),t.sort&&(n.sort=this._createSort(t.sort)),t.filter&&(n.filter=this._createFilter(t.filter)),this._modifyTable(n,o),this._processHeaderListener()}close(){super.close(),this.isClosed()||(this._autoExpandRemoveListener?.(),this._getState()?.headerRemoveListener?.(),this._updateState({headerRemoveListener:null},{description:"Close Table"}),this._stylesRemoveListener?.(),this._colHeadersSizeUnlistener?.(),this._rowHeadersSizeUnlistener?.())}get isITable(){return!0}}let Dn=null;const Qs="TableStyleMedium2",Yn=(s,e,t)=>{if(!s.border)return s;let n=((o,i,l)=>{if(!o)return o;let a=null;return(o.top||o.horizontal)&&(i.rowIndex!==l.rowStart||i.colIndex<l.colStart||i.colIndex>l.colEnd)&&(a=a??{...o},delete a.top,o.horizontal&&(a.top=o.horizontal)),(o.bottom||o.horizontal)&&(i.rowIndex!==l.rowEnd||i.colIndex<l.colStart||i.colIndex>l.colEnd)&&(a=a??{...o},delete a.bottom,o.horizontal&&(a.bottom=o.horizontal)),(o.left||o.vertical)&&(i.colIndex!==l.colStart||i.rowIndex<l.rowStart||i.rowIndex>l.rowEnd)&&(a=a??{...o},delete a.left,o.vertical&&(a.left=o.vertical)),(o.right||o.vertical)&&(i.colIndex!==l.colEnd||i.rowIndex<l.rowStart||i.rowIndex>l.rowEnd)&&(a=a??{...o},delete a.right,o.vertical&&(a.right=o.vertical)),o.horizontal&&(a=a??{...o},delete a.horizontal),o.vertical&&(a=a??{...o},delete a.vertical),a??o})(s.border,e,t),r=s;return n!==s.border&&(r={...s},Object.keys(n).length>0?r.border=n:delete r.border),r};class Hv{constructor(e,t,n){this._table=e,this._styles=t,this._properties=n}_resolveProperties(e){const t={name:e.name},n=this._styles,r=Object.values(Ro.ElementType),o=r.length;for(let i=0;i<o;i++){const l=r[i],a=e[l];if(!a||!V.isObject(a))continue;const c=Pt.resolveTypedUpdates(Object.freeze(a),Ht,n);t[l]=c}return Object.freeze(t)}getCoords(){return this._table.getAnchorCoords()}getPropertiesAt(e,t){const n=this._table,r=this._styles,o=this._properties;_u.rowIndex=e,_u.colIndex=t;const i=n.getVisibleCellCoords(_u),l=n.getVisibleRefRangeCoords();if(!l)return null;const a=Math.max(0,l.colEnd-l.colStart)+1,c=Math.max(0,l.rowEnd-l.rowStart)+1,u=Math.max(0,i.rowIndex-l.rowStart),d=Math.max(0,i.colIndex-l.colStart),h={rowIndex:u,colIndex:d},f=n.getStyleOptions();let g={},m=!1,p=0;n.isHeaderVisible()&&(p=n.getShowHeaders()?1:0,m=p>u);let w=!1,S=0;n.isTotalVisible()&&(S=n.getShowTotals()?1:0,w=c-S<=u);let b=d===a-1&&f.showLastColumn;n.isLastColumnVisible()||(b=!1);let v=d===0&&f.showFirstColumn;n.isFirstColumnVisible()||(v=!1);const y=!m&&!w;if(o.wholeTable&&(g=o.wholeTable,g.border&&(g=Yn(g,h,{rowStart:0,rowEnd:c-1,colStart:0,colEnd:a-1}))),y&&f.showColumnStripes){const _=o.firstColumnStripe?.size??1,C=o.secondColumnStripe?.size??1;let E=d%(_+C);const x=E<_;x||(E-=_);let R=x?o.firstColumnStripe:o.secondColumnStripe;if(R){const I={rowIndex:u,colIndex:E},A={rowStart:p,rowEnd:c-S-1,colStart:0,colEnd:Math.min(a-d,x?_:C)};x&&E===0&&d>0&&R.border?.left&&o.secondColumnStripe?.border.right&&(R={...R},R.border={...R.border},delete R.border.left),x&&E===_-1&&d<a-1&&R.border?.right&&o.secondColumnStripe?.border.left&&(R={...R},R.border={...R.border},delete R.border.right);const M=R.border?Yn(R,I,A):R;g=Pt.resolveTypedUpdates(M,Ht,r,g)}}if(y&&f.showRowStripes){const _=p,C=o.firstRowStripe?.size??1,E=o.secondRowStripe?.size??1;let x=(u-_)%(C+E);const R=x<C;R||(x-=C);let I=R?o.firstRowStripe:o.secondRowStripe;if(I){const A={colIndex:d,rowIndex:x},M={colStart:0,colEnd:a-1,rowStart:0,rowEnd:Math.min(c-u,R?C:E)};R&&x===0&&u>_&&I.border?.top&&o.secondRowStripe?.border.bottom&&(I={...I},I.border={...I.border},delete I.border.top),R&&x===C-1&&u<c-1&&I.border?.bottom&&o.secondRowStripe?.border.top&&(I={...I},I.border={...I.border},delete I.border.bottom);const k=I.border?Yn(I,A,M):I;g=Pt.resolveTypedUpdates(k,Ht,r,g)}}if(b&&o.lastColumn){let _=o.lastColumn;_.border&&(_=Yn(_,h,{rowStart:0,rowEnd:c-1,colStart:a-1,colEnd:a-1})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}if(v&&o.firstColumn){let _=o.firstColumn;_.border&&(_=Yn(_,h,{rowStart:0,rowEnd:c-1,colStart:0,colEnd:0})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}if(m&&o.headerRow){let _=o.headerRow;_.border&&(_=Yn(_,h,{rowStart:0,rowEnd:p-1,colStart:0,colEnd:a-1})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}if(w&&o.totalRow){let _=o.totalRow;_.border&&(_=Yn(_,h,{rowStart:c-S,rowEnd:c-1,colStart:0,colEnd:a-1})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}if(m&&v&&o.firstHeaderCell){let _=o.firstHeaderCell;_.border&&(_=Yn(_,h,{rowStart:0,rowEnd:p-1,colStart:0,colEnd:0})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}if(m&&b&&o.lastHeaderCell){let _=o.lastHeaderCell;_.border&&(_=Yn(_,h,{rowStart:0,rowEnd:p-1,colStart:a-1,colEnd:a-1})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}if(w&&v&&o.firstTotalCell){let _=o.firstTotalCell;_.border&&(_=Yn(_,h,{rowStart:c-S,rowEnd:c-1,colStart:0,colEnd:0})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}if(w&&b&&o.lastTotalCell){let _=o.lastTotalCell;_.border&&(_=Yn(_,h,{rowStart:c-S,rowEnd:c-1,colStart:a-1,colEnd:a-1})),g=Pt.resolveTypedUpdates(_,Ht,r,g)}return m&&o.headerRow&&n.getColumnFilter(d)&&!n.getColumnFilter(d).hasHiddenButton()&&(g.insets={right:15}),g}}class tm{constructor(e,t,n,r){this._styles=e,this._isBuiltIn=n,this._doDelete=r,this._properties=V.deepFreeze(this._resolveProperties(t)),this.isShownInTableStyles()}_resolveProperties(e){const t={name:e.name};e.table!==void 0&&(t.table=e.table),e.pivot!==void 0&&(t.pivot=e.pivot);const n=this._styles,r=Object.values(Ro.ElementType),o=r.length;for(let i=0;i<o;i++){const l=r[i],a=e[l];if(!a||!V.isObject(a))continue;const c=Pt.resolveTypedUpdates(Object.freeze(a),Ht,n);t[l]=c}return Object.freeze(t)}delete(){if(!this._doDelete)throw new Error("Not able to delete builtin style.");this._doDelete(this._properties.name)}getRanged(e){return new Hv(e,this._styles,this._properties)}getProperties(){return this._properties}getName(){return this._properties.name}isShownInTableStyles(){return this._properties.table!==!1}isShownInPivotStyles(){return this._properties.pivot??!1}isBuiltIn(){return this._isBuiltIn}toJSON(){const e=V.cloneObject(this._properties);return e.name=this._properties.name,e}get isITableStyle(){return!0}}const _u={rowIndex:0,colIndex:0};class $v extends Jt{constructor(e,t){super(e,J.EmptyRange,t)}isEmpty(){return this._p===null}getCoords(){return this._r}cloneWithUpdate(e){if(e===void 0)return this;const t=this._c,n=this._r,r=Pt.resolveTypedUpdates(e,Ht,t,this._p);return new Jt(t,n,r)}_createShifted(e){return new Jt(this._c,e,this._p)}getShifted(e){return e.after?{...e.after,value:this._createShifted(J.sanitizeRange(e.after))}:null}getSplit(e,t){const n=this._c,r=this._p;return[new Jt(n,e[0],r),new Jt(n,e[1],r)]}getMerged(e,t,n){const r=this._p,o=e._p;if(r&&!o||o&&!r||!r&&!o)return;let i=Object.keys(r),l=Object.keys(o);if(r.named===Qe.BuiltInName.Normal&&(i=i.filter(c=>c.toLowerCase()!==Qe.BuiltInName.Normal)),o.named===Qe.BuiltInName.Normal&&(l=l.filter(c=>c.toLowerCase()!==Qe.BuiltInName.Normal)),i.length!==l.length)return;for(let c=0;c<i.length;c++){const u=i[c],d=r[u],h=o[u];if(!V.deepEqual(d,h))return}const a=this._c;return new Jt(a,t,this._p)}getPropertiesAt(e,t){return this._p}toJSON(){return V.toSafeJSON(this._p)}}class nm{constructor(e,t,n,r=null){this._name=t.name,this._properties=t,this._rangeStyle=new $v(e,t.style),this._doDelete=n,this._builtInID=r}getRanged(){return this._rangeStyle}getName(){return this._name}isHidden(){return this._properties.hidden??!1}getILevel(){return this._properties.iLevel??null}getBuiltInID(){return this._builtInID}delete(){this._doDelete?.(this)}toJSON(){return this._properties?V.toSafeJSON(this._properties):null}get isINamed(){return!0}}let Vv=class{constructor(s,e,t,n,r){this._state=s,this._normalJSON=e??{},this._toJSONInternal=t,this._fromJSONInternal=n,this._onLastEnd=r,this._state.openScopes.add(this),this._isClosed=!1,this._state.byJSONs.set(Rc(this._normalJSON),0),this._state.byIds.set(0,this._normalJSON)}endPersist(){if(!this._state.openScopes.delete(this))throw new Error("PersistScope is closed.");this._isClosed=!0,this._state.openScopes.size===0&&this._onLastEnd()}getElementID(s){if(this._isClosed)throw new Error("PersistScope is closed.");const e=Rc(s=s??{});let t=this._state.byJSONs.get(e);return t!==void 0||(t=this._state.byJSONs.size,this._state.byJSONs.set(e,t),this._state.byIds.set(t,s)),t}getElementJSON(s){if(this._isClosed)throw new Error("PersistScope is closed.");return this._state.byIds.get(s)??null}fromJSON(s){if(this._isClosed)throw new Error("PersistScope is closed.");const e=JSON.parse(JSON.stringify(s||{}));this._fromJSONInternal(e);const t=e.direct;if(t)for(let n=0;n<t.length;n++){const r=n,o=t[n],i=Rc(o);this._state.byIds.set(r,o),this._state.byJSONs.set(i,r)}}toJSON(){if(this._isClosed)throw new Error("PersistScope is closed.");const s=[];return this._state.byIds.forEach((e,t)=>{s[t]=e}),s.length===1&&s.splice(0,1),this._toJSONInternal(s)}},tl=class{constructor(e=null,t=null,n=11){this._emitter=null,this._normalRanged=null,this._theme=e??new Qd().getDefaultTheme(),this._defaultFontSize=n;const r=this;this._emitter=new wn(this),this._schemeLookup=o=>r._theme.schemeLookup()(o),this._indexedColors=this._fromJSONIndexedColors(t),this._indexedLookup=o=>{const i=this._indexedColors[o];return i?i.toRGBA():ka(o)},this._initializeBuiltIns(),this._customCellStyles=new Map,this._customTableStyles=new Map,this._indexedColors=[],this._mruColors=[],this._persistCache=null}_initializeNamedStyles(e,t){for(let n=0;n<e.length;n++){const r=e[n],o={...r},i=r.named;delete o.named;const l=Pt.resolveTypedUpdates(o,Ht,this),a=new nm(this,{name:i,style:l},this._hideOrRemoveNamed.bind(this),n);i===Qe.BuiltInName.Normal&&(this._normalRanged=a.getRanged(),this._normalStyle=Is(this,null)),t.set(i.toLowerCase(),a)}}_initializeTableStyles(){const e=(()=>{if(Dn)return Dn;Dn=new Map;const n=(d,h)=>{if(h===0)return"TableStyleNone";let f="Custom";return d==="l"?f="Light":d==="m"?f="Medium":d==="d"&&(f="Dark"),`TableStyle${f}${h}`},r=(d,h=0)=>h===0?d:h>0?`${d} lumMod ${100-h}, lumOff ${h}`:h<0?`${d} lumMod ${100+h}`:void 0,o=d=>({type:Pe.Type.Pattern,patternType:Pe.BuiltInSheetPattern.Solid,foreground:d,background:d}),i=(d,h=!1)=>{const f={fill:d};return h&&(f.weight=700),f},l=(d,h=pe.StrokeStyle.Thin)=>({style:h,color:d}),a=(d,h)=>{for(let f=0;f<7;f++)d.push(h(`accent${f+1}`))};let c=0,u=[];u.push(["dk1",r("bg1",-15),"dk1"]),a(u,d=>[r(d,-25),r(d,80),d]),c=1;for(let d=0;d<7;d++){const h=n("l",d+c),f=u[d][0],g=u[d][1]??f,m=u[d][2]??f;Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{top:l(m),bottom:l(m)}},headerRow:{font:i(f,!0),border:{bottom:l(m)}},totalRow:{font:i(f,!0),border:{top:l(m)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(g)},firstColumnStripe:{fill:o(g)}}))}c+=7,u=[],u.push(["dk1","dk1","lt1"]),a(u,d=>["dk1",d,"lt1"]);for(let d=0;d<7;d++){const h=n("l",d+c),f=u[d][0],g=u[d][1],m=u[d][2];Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{left:l(g),right:l(g),top:l(g),bottom:l(g)}},headerRow:{font:i(m,!0),fill:o(g)},totalRow:{font:i(f,!0),border:{top:l(g,pe.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{border:{top:l(g)}},secondRowStripe:{border:{top:l(g)}},firstColumnStripe:{border:{left:l(g)}},secondColumnStripe:{border:{left:l(g)}}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15)]),a(u,d=>[d,r(d,80)]);for(let d=0;d<7;d++){const h=n("l",d+c),f="dk1",g=u[d][0],m=u[d][1];Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{left:l(g),right:l(g),top:l(g),bottom:l(g),horizontal:l(g),vertical:l(g)}},headerRow:{font:i(f,!0)},totalRow:{font:i(f,!0),border:{top:l(g,pe.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(m)},firstColumnStripe:{fill:o(m)}}))}c=1,u=[],u.push(["dk1","dk1",r("bg1",-15)]),a(u,d=>[d,r(d,40),r(d,80)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g="lt1",m=u[d][0],p=u[d][1],w=u[d][2];Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{left:l(p),right:l(p),top:l(p),bottom:l(p),horizontal:l(p)}},headerRow:{font:i(g,!0),fill:o(m)},totalRow:{font:i(f,!0),border:{top:l(m,pe.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(w)},firstColumnStripe:{fill:o(w)}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15),r("bg1",-35)]),a(u,d=>[d,r(d,80),r(d,60)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g="lt1",m=u[d][0],p=u[d][1],w=u[d][2];Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(p),border:{horizontal:l(g),vertical:l(g)}},headerRow:{font:i(g,!0),fill:o(m),border:{bottom:l(g,pe.StrokeStyle.Thick)}},totalRow:{font:i(g,!0),fill:o(m),border:{top:l(g,pe.StrokeStyle.Thick)}},firstColumn:{font:i(g,!0),fill:o(m)},lastColumn:{font:i(g,!0),fill:o(m)},firstRowStripe:{fill:o(w)},firstColumnStripe:{fill:o(w)}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15),r("bg1",-35)]),a(u,d=>[d,r(d,80),r(d,60)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g="lt1",m=u[d][0],p=r("bg1",-15);Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),border:{top:l(f,pe.StrokeStyle.Medium),bottom:l(f,pe.StrokeStyle.Medium),left:d===0?l(f,pe.StrokeStyle.Thin):void 0,right:d===0?l(f,pe.StrokeStyle.Thin):void 0,horizontal:d===0?l(f,pe.StrokeStyle.Thin):void 0,vertical:d===0?l(f,pe.StrokeStyle.Thin):void 0}},headerRow:{font:i(g,!0),fill:o(m),border:{bottom:l(f,pe.StrokeStyle.Medium)}},totalRow:{border:{top:l(f,pe.StrokeStyle.Double)}},firstColumn:{font:i(g,!0),fill:o(m)},lastColumn:{font:i(g,!0),fill:o(m)},firstRowStripe:{fill:o(p)},firstColumnStripe:{fill:o(p)}}))}c+=7,u=[],u.push(["dk1",r("bg1",-15),r("bg1",-35),"dk1"]),a(u,d=>[d,r(d,80),r(d,60),r(d,40)]);for(let d=0;d<7;d++){const h=n("m",d+c),f="dk1",g=u[d][0],m=u[d][1],p=u[d][2],w=u[d][3];Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(m),border:{top:l(w),right:l(w),left:l(w),bottom:l(w),vertical:l(w),horizontal:l(w)}},headerRow:{font:i(f),fill:o(m)},totalRow:{font:i(f),border:{top:l(g,pe.StrokeStyle.Medium)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(p)},firstColumnStripe:{fill:o(p)}}))}c=1,u=[],u.push(["dk1",r("dk1",15),r("dk1",25),r("dk1",50)]),a(u,d=>["dk1",r(d,-50),r(d,-25),d]);for(let d=0;d<7;d++){const h=n("d",d+c),f="lt1",g=u[d][0],m=u[d][1],p=u[d][2],w=u[d][3];Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(w)},headerRow:{font:i(f,!0),fill:o(g),border:{bottom:l(f,pe.StrokeStyle.Medium)}},totalRow:{font:i(f,!0),fill:o(m),border:{top:l(f,pe.StrokeStyle.Medium)}},firstColumn:{font:i(f,!0),fill:o(p),border:{right:l(f,pe.StrokeStyle.Medium)}},lastColumn:{font:i(f,!0),fill:o(p),border:{left:l(f,pe.StrokeStyle.Medium)}},firstRowStripe:{fill:o(p)},firstColumnStripe:{fill:o(p)}}))}c+=7,u=[],u.push([r("bg1",-15),"dk1",r("bg1",-35)]),u.push([r("accent1",80),"accent2",r("accent1",60)]),u.push([r("accent3",80),"accent4",r("accent3",60)]),u.push([r("accent5",80),"accent6",r("accent5",60)]);for(let d=0;d<4;d++){const h=n("d",d+c),f="dk1",g="lt1",m=u[d][0],p=u[d][1],w=u[d][2];Dn.set(h.toLocaleLowerCase(),Object.freeze({name:h,wholeTable:{font:i(f),fill:o(m)},headerRow:{font:i(g,!0),fill:o(p)},totalRow:{font:i(f,!0),border:{top:l(f,pe.StrokeStyle.Double)}},firstColumn:{font:i(f,!0)},lastColumn:{font:i(f,!0)},firstRowStripe:{fill:o(w)},firstColumnStripe:{fill:o(w)}}))}return Dn})(),t=new Map;return e.forEach((n,r)=>{const o=n.name.toLowerCase(),i=new tm(this,n,!0);t.set(o,i)}),t}_initializeBuiltIns(){const e=new Map;this._builtInsCellStyles=e,this._initializeNamedStyles(uv,e),this._builtInsTableStyles=this._initializeTableStyles(),this._emptyTableStyle=new Ro.Empty(this._normalStyle)}getNormal(){return this._normalStyle}getNormalRanged(){return this._normalRanged}setTheme(e){this._theme=e,this._emitter.notify("onThemeChange"),this._emitter.notify("onAnyChange")}getTheme(){return this._theme}setDefaultFontSize(e){this._defaultFontSize=e,this._emitter.notify("onDefaultFontChange"),this._emitter.notify("onAnyChange")}getDefaultFontSize(){return this._defaultFontSize}beginPersist(){return this._persistCache||(this._persistCache={byIds:new Map,byJSONs:new Map,openScopes:new Set}),new Vv(this._persistCache,{},this._toJSONInternal.bind(this),this._fromJSONInternal.bind(this),()=>{this._persistCache=null})}getNamed(e){if(!e)return null;e=e.toLowerCase();let t=null;return this._customCellStyles&&(t=this._customCellStyles.get(e)),t||(t=this._builtInsCellStyles.get(e)),t??null}getCustomNamed(){const e=Array.from(this._customCellStyles.values());return e.sort((t,n)=>t.getName().localeCompare(n.getName())),e}setNamed(e,t=!1){if(!e||!e.name||!e.style)throw new sr;this.validateStyleName(e.name,!1);const n=this._setCustomCellStyleInternal(e,t);return this._emitter.notify("onNamedStylesChange"),this._emitter.notify("onAnyChange"),n}_setCustomCellStyleInternal(e,t=!1,n=0){const r=e.name.toLowerCase(),o=this._builtInsCellStyles.get(r),i=o?.getBuiltInID()??null;let l=null;t&&(l=(this._customCellStyles.get(r)??o)?._properties??null);const a=sc(0,e.style,this.getNormal());e={...e,style:a};const c=Pt.resolveTypedUpdates(e,sv,this,l),u=new nm(this,c,this._hideOrRemoveNamed.bind(this),i);return c.name===Qe.BuiltInName.Normal&&(this._normalRanged=u.getRanged(),this._normalStyle=Is(this,null)),this._customCellStyles.set(r,u),u}_setCustomTableStyleInternal(e,t){const n=e.toLowerCase();let r=this._customTableStyles.get(n)??this._builtInsTableStyles.get(n);r&&(e=r.getName());const o=new tm(this,{...t,name:e},!1,this._deleteCustomTableStyle.bind(this));return this._customTableStyles.set(n,o),o}_hideOrRemoveNamed(e){let t=null;if(t=typeof e=="string"?e:e?.getName?.(),!t||(t=t.toLowerCase(),t===Qe.BuiltInName.Normal.toLowerCase()))return!1;const n=this._builtInsCellStyles.get(t);let r=!1;if(n&&!n.isHidden()){const o=n.toJSON();this.setNamed({...o,hidden:!0}),r=!0}else t=t.toLowerCase(),r=this._customCellStyles.delete(t);return r&&(this._emitter.notify("onNamedStylesChange"),this._emitter.notify("onAnyChange")),r}getTableStyle(e){if(!e)return this._emptyTableStyle;let t=this._customTableStyles.get(e.toLowerCase());return t||(t=this._builtInsTableStyles.get(e.toLowerCase())),t??null}getCustomTableStyles(){const e=Array.from(this._customTableStyles.values());return e.sort((t,n)=>t.getName().localeCompare(n.getName())),e}setDefaultTableStyle(e){const t=e?.toLowerCase();return this._defaultTableStyle=this._customTableStyles.get(t)??this._builtInsTableStyles.get(t)??this._builtInsTableStyles.get(Qs.toLowerCase()),this._emitter.notify("onTableStylesChange"),this._emitter.notify("onAnyChange"),e===this._defaultTableStyle.getName()}getDefaultTableStyle(){return this._defaultTableStyle||(this._defaultTableStyle=this._builtInsTableStyles.get(Qs.toLowerCase())),this._defaultTableStyle}_deleteCustomTableStyle(e){const t=this._customTableStyles.get(e?.toLowerCase());return!!t&&(this._customTableStyles.delete(e.toLowerCase()),this._defaultTableStyle?.getName()===t.getName()&&(this._defaultTableStyle=this._builtInsTableStyles.get(Qs.toLowerCase())),this._emitter.notify("onTableStylesChange"),this._emitter.notify("onAnyChange"),!0)}setCustomTableStyle(e,t){const n=this._setCustomTableStyleInternal(e,t);return this._emitter.notify("onTableStylesChange"),this._emitter.notify("onAnyChange"),n}validateStyleName(e,t=!1){if(!e||e.trim().length===0)throw new Error("Style name cannot be empty.");if(t&&this.getNamed(e)!==null)throw new Error("Style name is already taken.")}normalize(e){if(!e)return null;const t=Pt.resolveTypedUpdates(e,Ht,this),n=ww;let r=null;if(r=t.named?this.getNamed(t.named)?.getRanged().getPropertiesAt(0,0,null):this._normalRanged.getPropertiesAt(0,0,null),r){const i={...r};V.removeEqualValues(t,i)}const o=this.getTheme().getFontScheme();return V.removeEqualValues(t,{font:{size:this.getDefaultFontSize(),family:o.getMinorFont(),fallbacks:o.getMinorFallbacks()}}),V.removeEqualValues(t,n),t}schemeLookup(){return this._schemeLookup}indexedLookup(){return this._indexedLookup}parseColor(e){return $t.parse(e,this._schemeLookup,this._indexedLookup)}recentColors(){return this._mruColors}addRecentColor(e){if(!e)return;const t=this._mruColors,n=[],r=e.toString();for(let o=0;o<t.length&&o<10;o++)t[o].toString()!==r&&n.push(t[o]);return n.unshift(e),this._mruColors=Object.freeze(n),this._mruColors}clearRecentColors(){this._mruColors=Object.freeze([])}getIndexedColors(){return this._indexedColors}setCustomIndexedColors(e){this._indexedColors=e?.length>0?[...e]:null}getCustomIndexedColors(){const e=Math.max(this._indexedColors?.length,66),t=[];for(let n=0;n<e;n++)this._indexedColors[n]!==null&&t.push(this._indexedColors[n]??new $t(ka(n)?.toString()));return t}addListeners(e,t){return this._emitter.addListeners(e,t)}_toJSONInternal(e){const t={};e.length>0&&(t.direct=e);const n=this.getCustomNamed();let r=[];for(let a=0;a<n.length;a++){let c=n[a].toJSON();r.push(c)}r.length>0&&(t.named=r);const o={};this._defaultTableStyle&&this._defaultTableStyle.getName()!==Qs&&(o.defaultTableStyle=this._defaultTableStyle.getName());const i={},l=this.getCustomTableStyles();for(let a=0;a<l.length;a++){let c=l[a].toJSON();delete c.name,c&&Object.keys(c).length>0&&(i[l[a].getName()]=c)}if(Object.keys(i).length>0&&(o.styles=i),Object.keys(o).length>0&&(t.tables=o),this._indexedColors.length>0){t.indexedColors=[];for(let a=0;a<this._indexedColors.length;a++)t.indexedColors.push(this._indexedColors[a].toString())}if(this._mruColors.length>0){t.mruColors=[];for(let a=0;a<this._mruColors.length;a++)t.mruColors.push(this._mruColors[a].toString())}return Object.keys(t).length===0?null:t}_fromJSONIndexedColors(e){if(!e||e.length===0)return V.EmptyArray;const t=[];if(e?.length>0)for(let n=0;n<e.length;n++)try{t.push(this.parseColor(e[n]))}catch{console.warn("Unable to parse color: "+e[n])}return t}_fromJSONInternal(e){this._indexedColors=this._fromJSONIndexedColors(e.indexedColors);const t=e.named;for(let o=0;t&&o<t.length;o++)this._setCustomCellStyleInternal(e.named[o]);let n=Qs;if(this._defaultTableStyle=null,e.tables){e.tables.defaultTableStyle&&(n=e.tables.defaultTableStyle);const o=e.tables.styles?Object.keys(e.tables.styles):null;for(let i=0;o&&i<o.length;i++){const l=o[i],a=e.tables.styles[l];this._setCustomTableStyleInternal(l,a)}}this._defaultTableStyle=this.getTableStyle(n);let r=[];if(e.mruColors?.length>0)for(let o=0;o<e.mruColors.length;o++)try{r.push(this.parseColor(e.mruColors[o]))}catch{console.warn("Unable to parse color: "+e.mruColors[o])}this._mruColors=r}};const yu="BinaryResource must have only one initial data value.",bu="Resource is closed.";class vu{constructor(e){if(this._listeners=new Set,this._type=e.type,this._name=e?.name,e.base64){const t=e.base64;this._asArrayBufferResolve=async()=>{const n=await Promise.resolve(t);return Promise.resolve(gi.base64ToArrayBuffer(n))}}if(e.fetch){if(this._asArrayBufferResolve)throw new Error(yu);const t=e.fetch;this._asArrayBufferResolve=async()=>{let n,r=null;r=typeof t=="string"?t:e.input;const o=await fetch(r,n),i=o.headers.get("Content-Type");return!this._type&&i&&(this._type=i),o.arrayBuffer()}}if(e.buffer){if(this._asArrayBufferResolve)throw new Error(yu);this._asArrayBufferResolve=async()=>{let t=null;return t=typeof e.buffer=="function"?await e.buffer():e.buffer,Promise.resolve(t)}}if(e.file){if(this._asArrayBufferResolve)throw new Error(yu);this._asArrayBufferResolve=async()=>await(await Promise.resolve(e.file)).arrayBuffer()}if(!this._asArrayBufferResolve)throw new Error("BinaryResource must have an initial data value.");this._refs=new Set,this._isClosed=!1}getName(){return this._name}async toJSONAsync(){const e=await this.toBuffer(),t={base64:gi.arrayBufferToBase64(e)};return this._type!==gi.DEFAULT_MIME_TYPE&&(t.type=this._type),this._name&&(t.name=this._name),t}async toBuffer(){if(this._asArrayBuffer)return this._asArrayBuffer;try{this._asArrayBuffer=this._asArrayBufferResolve()}catch(e){throw e}return this._asArrayBuffer}async getType(){return this._type?this._type:(await this.toBuffer(),this._type??gi.DEFAULT_MIME_TYPE)}addReference(e){if(this._isClosed)throw new Error(bu);this._refs.add(e)}deleteReference(e){if(this._isClosed)throw new Error(bu);if(this._refs.size===0||!this._refs.has(e))return;this._refs.delete(e);const t=this;if(this._refs.size===0){const n=this._listeners;n.forEach(r=>{r.onUnload?.(t),n.delete(r)}),this._asArrayBuffer=null,this._isClosed=!0}}addUnloadListener(e){if(this._isClosed)throw new Error(bu);this._listeners.add(e)}get isIResource(){return!0}isClosed(){return this._isClosed}}let Wv=class{constructor(s,e,t){this._state=s,this._fromJSON=e,this._onLastEnd=t,this._state.openScopes.add(this),this._isClosed=!1}endPersist(){if(!this._state.openScopes.delete(this))throw new Error("PersistScope is closed.");this._isClosed=!0,this._state.openScopes.size===0&&this._onLastEnd()}toResourceId(s){if(this._isClosed)throw new Error("PersistScope is closed.");let e=this._state.byRefs.get(s);return e!==void 0||(e=this._state.byRefs.size,this._state.byRefs.set(s,e),this._state.byIds.set(e,s)),e}fromResourceId(s){return this._state.byIds.get(s)??null}fromJSON(s){if(this._isClosed)throw new Error("PersistScope is closed.");if(!s||s.length===0)return;const e=this._state.byRefs.size;for(let t=0;t<s.length;t++){const n=s[t],r=this._fromJSON(n);this._state.byRefs.set(r,e+t),this._state.byIds.set(e+t,r)}}toJSONAsync(){if(this._isClosed)throw new Error("PersistScope is closed.");const s=[];return this._state.byRefs.forEach((e,t)=>{s[e]=Promise.resolve(t.toJSONAsync())}),Promise.all(s)}};class Ew{constructor(){this._resources=new Set}add(e){if(typeof e=="string"){let r=!1;this._resources.forEach(o=>{o.getName()===e&&(r=!0,e=o)}),r||(e=new vu({name:e,fetch:e,type:null}))}let t=null;t=e instanceof vu?e:new vu({...e});const n=this;return this._resources.has(t)||(t.addUnloadListener({onUnload:r=>{n._resources.delete(t)}}),this._resources.add(t)),t}getItems(e){return Array.from(this._resources)}getCount(){return this._resources.size}beginPersist(){this._persistOpen||(this._persistOpen={byRefs:new Map,byIds:new Map,openScopes:new Set});const e={},t=new Set,n=this;return new Wv(this._persistOpen,r=>{const o=n.add({base64:r.base64,name:r.name,type:r.type});return o.addReference(e),t.add(o),o},()=>{t.forEach(r=>{r.deleteReference(e)}),n._persistOpen=null})}}class jv{constructor(e,t,n){this._state=e,this._fromJSON=t,this._onLastEnd=n,this._state.openScopes.add(this),this._isClosed=!1}endPersist(){if(!this._state.openScopes.delete(this))throw new Error("PersistScope is closed.");this._isClosed=!0,this._state.openScopes.size===0&&this._onLastEnd()}add(e){if(this._isClosed)throw new Error("PersistScope is closed.");let t=this._state.byRefs.get(e);return t!==void 0||(t=this._state.byRefs.size,this._state.byRefs.set(e,t),this._state.byIds.set(t,e)),t}at(e){return this._state.byIds.get(e)??null}fromJSON(e){if(this._isClosed)throw new Error("PersistScope is closed.");e&&e.length!==0&&this._fromJSON(e)}toJSONAsync(){if(this._isClosed)throw new Error("PersistScope is closed.");const e=[];return this._state.byRefs.forEach((t,n)=>{e[t]=Promise.resolve(n.toJSONAsync?n.toJSONAsync():n)}),Promise.all(e)}}class lh{constructor(){this._nextId=0,this._lastReadId=-1,this._lastReadValue=null,this._stringsByText=new Map,this._stringsById=new Map}addMultiple(e,t=!1){const n=this._stringsByText,r=this._stringsById,o=e.length;let i=this._nextId;for(let l=0;l<o;l++){const a=e[l];n.get(a)!==void 0&&t||(n.set(a,i),r.set(i,a),i++)}this._lastReadId=-1,this._nextId=i}add(e){const t=this._stringsByText,n=t.get(e);if(n!==void 0)return n;const r=this._nextId++;return t.set(e,r),this._stringsById.set(r,e),this._lastReadId=-1,r}getItems(e){if(e?.id!==void 0){const t=this.getById(e.id);return t?[t]:[]}return Array.from(this._stringsById.values())}getById(e){if(this._lastReadId===e)return this._lastReadValue;const t=this._stringsById.get(e)??null;return this._lastReadId=e,this._lastReadValue=t,t}getCount(){return this._stringsById.size}beginPersist(){this._persistOpen||(this._persistOpen={byRefs:new Map,byIds:new Map,openScopes:new Set});const e=this;return new jv(this._persistOpen,t=>(Array.isArray(t)?e.addMultiple(t):e.add(t),t),()=>{e._persistOpen=null})}}var Yt;class Gv extends Lo{constructor(e){super(e),e.json&&(this._resource=e.fromResourceId(e.json.resId))}getType(){return"picture"}toJSON(e){const t={},n=e?.(this._resource);n!==null&&(t.resId=n);const r=this._getState();return r&&r.effects&&(t.effects=r.effects),t}getTypeDescription(){return"Picture"}async _asDataUrl(){if(this._dataUrl)return this._dataUrl;const e=await this.getDetails(),t=await ql.getImageDataUrl(e.asUrl());return this._dataUrl=t.dataUrl,this._dataUrl}toHtml(){return null}async toImage(){const e=(await this._asDataUrl()).substring(ql.DATA_URL_PNG_PREFIX.length),t=gi.base64ToArrayBuffer(e);return new Blob([t],{type:Ip.png})}async getDetails(){return this._details||(this._details=new Promise(async(e,t)=>{try{const n=await this._resource.toBuffer(),r=await this._resource.getType(),o=await ql.loadImageDetails(n,r);e({getNaturalDimensions:()=>o.naturalDimensions,asUrl:()=>o.asUrl,asSVGText:()=>o.asSVGText})}catch(n){t(n)}})),this._details}_fromDrawingJSON(e,t){this._resource?.deleteReference(this),this._resource=t?.(e.resId),this._resource.addReference(this)}_toDrawingJSON(e){const t={},n=e?.(this._resource);return n!==null&&(t.resId=n),t}_processDelete(){super._processDelete()}}(Yt||(Yt={})).Status={Ready:"ready",Error:"error",Starting:"starting",Stopping:"stopping",Off:"off"};let xd=class Rw extends gn{constructor(e,t=null,n,r,o){if(super(e,n,t),this._sheetName=r||null,this._getEntireCoords=o??md,this._coords=Uv(n,this._getEntireCoords()),!n)throw new Error("ReferenceRange requires a coords");this._validateCoords(n)}toType(e){return new Rw(this._values,e,this._coords,this._sheetName,this._getEntireCoords)}getCoords(){return this._coords}get isIReferenceRange(){return!0}isLiteral(){return!1}_validateCoords(e){const t=this._getEntireCoords?.();if(t&&(e.rowStart<t.rowStart&&e.rowStart!==Number.MIN_SAFE_INTEGER||e.rowEnd>t.rowEnd&&e.rowEnd!==Number.MAX_SAFE_INTEGER||e.colStart<t.colStart&&e.colStart!==Number.MIN_SAFE_INTEGER||e.colEnd>t.colEnd&&e.colEnd!==Number.MAX_SAFE_INTEGER))throw new Nt}get[Symbol.toStringTag](){return"[ReferenceRange]"}toString(){return`${Pr(this._coords,this._getEntireCoords?.())}`}};const Uv=(s,e)=>{let t=s.rowStart,n=s.rowEnd,r=s.colStart,o=s.colEnd,i=!1;return r===Number.MIN_SAFE_INTEGER&&(r=e.colStart,i=!0),t===Number.MIN_SAFE_INTEGER&&(t=e.rowStart,i=!0),n===Number.MAX_SAFE_INTEGER&&(n=e.rowEnd,i=!0),o===Number.MAX_SAFE_INTEGER&&(o=e.colEnd,i=!0),i?{rowStart:t,rowEnd:n,colStart:r,colEnd:o}:s},rm=(s,e)=>s.value?.once===e.value?.once,qv=(s,e)=>s.colStart===e.colStart&&s.rowStart===e.rowStart,Iw=(s,e,t)=>!!t&&s===t.rowStart&&e===t.colStart,Jv=(s,e=0,t=0)=>{const n=s._values,r=s._coords,o=n.getRuns({bounds:r}),i=n.getOrientation()!==B.Orientation.Row,l=i?r.colStart:r.rowStart,a=i?r.rowStart:r.colStart,c=new At.Builder(null,e,t);let u=o.next();for(;!u.done;){const d=u.value;c.addValues(d[0]-l,d[1]-a,d[2]),u=o.next()}return c.build()},Ca=(s,e,t,n,r,o,i,l,a,c,u,d,h=!1)=>{let f,g,m=null,p=r.size();d===void 0&&(d=o.getOrientation()===B.Orientation.Column);const w=e?e.length:0,S=t?t.length:0;let b;const v=w+S;for(let _=0;_<v&&p>0;_++){const C=_<w?e[_]:t[_-w],E=r.search(C),x=E.length;for(let R=0;R<x;R++){const I=E[R];if(!Iw(I.rowStart,I.colStart,C)){if(I.value.getError())continue;b||(b=[]),b.push(I)}r.remove(I,qv);const A=I.value;A.getCycleId()!==s&&a?.insert(I),A.getError()||(o.delete(I),n.insertNonOverlapping({colStart:I.colStart,rowStart:I.rowStart,colEnd:I.colEnd,rowEnd:I.rowEnd,value:null},{onIntersect:(M,k)=>{if(M.value!==null)return i?.push(M),m=J.unionRanges(m,M),l?.insertNonOverlapping(M),m=J.unionRanges(m,M),k}})),p--}}for(let _=0;_<w;_++){const C=e[_],E={colStart:C.colStart,rowStart:C.rowStart,colEnd:C.colEnd,rowEnd:C.rowEnd,value:null};n.insertNonOverlapping(E,{onIntersect:(x,R)=>{if(x.value===null)return;const I=J.sanitizeRange(R);return h&&l?.insertNonOverlapping(I),c?.insertNonOverlapping({...R,value:!1}),i?.push(I),m=J.unionRanges(m,I),R}}),u?.insertNonOverlapping(E,{onIntersect:(x,R)=>{if(x.value!==null)return i?.push(R),m=J.unionRanges(m,R),R},onUpdates:(x,R,I)=>{g||(g=[]);const A=x.length;for(let k=0;k<A;k++){const F=x[k];g.push(F)}f||(f=[]);const M=R.length;for(let k=0;k<M;k++){const F=R[k],L=J.sanitizeRange(F);f.push(L)}}})}const y=d?B.Orientation.Column:B.Orientation.Row;if(b){const _=b.length,C=new Array(_);for(let E=0;E<_;E++){const x=b[E],R=x.value.setError(!0,s);a?.insert(R),C[E]=R,m=J.unionRanges(m,x);const I={colStart:x.colStart,rowStart:x.rowStart,colEnd:x.colStart,rowEnd:x.rowStart};n.insertNonOverlapping({colStart:x.colStart,rowStart:x.rowStart,colEnd:x.colStart,rowEnd:x.rowStart,value:new rr(x,y)}),i?.push(I)}r.load(C)}for(let _=0;_<S;_++){const C=J.sanitizeRange(t[_]);n.insertNonOverlapping({colStart:C.colStart,rowStart:C.rowStart,colEnd:C.colEnd,rowEnd:C.rowEnd,value:new rr(C,y)}),h&&l?.insertNonOverlapping(C),i?.push(C),m=J.unionRanges(m,C)}return m},Ed=(s,e,t)=>{if(!e)return s;const n=e.block;if(!n)return s;const r=s??[],o=e.colIndex,i=e.rowIndex;let l,a,c,u;t?(l=t.colStart,a=t.rowStart,c=t.colEnd,u=t.rowEnd):(l=o,a=i,c=o,u=i);const d={colStart:l,rowStart:a,colEnd:c,rowEnd:u,value:{blockEntry:{colStart:l,rowStart:a,colEnd:c,rowEnd:u,value:n},width:1,height:1,index:-1,$absWidth:!1,$absHeight:!1,once:e}};let h=e.dynamic;return h||(h=[],e.dynamic=h),h.push(d),r.push(d),r};class ah{constructor(e){this._fullCalcRequired=!1,this._iterationId=0,this._cycleId=1,this._pendingInvalidations=new Set,this._emitter=null,this._isProcessingJSON=!1,this._collectDirties=(o,i=!1,l,a)=>{const c=this._formulaSpatial,u=this._precedentSpatial;let d=Yv,h=0;if(i){const f=c.all();for(let g=0;g<f.length;g++){const m=f[g].value.calcs,p=m.length;for(let w=0;w<p;w++){const S=m[w],b=S.length;for(let v=0;v<b;v++){const y=S[v];y.markId!==o&&(d[h++]=y,y.markId=o,y.pending=!1,y.pendingResolved=!1,y.pendingPromise&&(y.pendingPromise.cancelled=!0))}}}}else{const f=l.length;for(let g=0;g<f;g++){const m=l[g];lm.length=0;const p=lm;u.search(m,!1,p),c.search(m,!1,p);const w=p.length;if(w===0)continue;const S=m.colStart,b=m.rowStart,v=m.colEnd-S,y=m.rowEnd-b;for(let _=0;_<w;_++){const C=p[_],E=C.value,x=E.blockEntry?.value??E,R=x.ref,I=R.colEnd-R.colStart,A=R.rowEnd-R.rowStart,M=C.colEnd-C.colStart-I,k=C.rowEnd-C.rowStart-A,F=E.once;if(F)F.markId<=o&&(F.removed?(u.remove(C,rm),F.removed=!1):d[h++]=F,F.markId=o);else{let L=0,N=0,D=I,O=A;if(!E.$absHeight){const z=b-C.rowStart;N=Math.min(Math.max(z-k,0),A),O=Math.min(y+b,A)}if(!E.$absWidth){const z=S-C.colStart;L=Math.min(Math.max(z-M,0),I),D=Math.min(v+z,I)}const H=x.calcs;for(let z=N;z<=O;z++){const j=H[z];for(let q=L;q<=D;q++){const P=j[q];P.markId!==o&&(d[h++]=P,P.markId=o,P.pendingPromise&&(P.pendingPromise.cancelled=!0))}}}}}a&&a.forEach(g=>{if(Array.isArray(g)){const m=g.length;for(let p=0;p<m;p++){const w=g[p],S=w.length;for(let b=0;b<S;b++){const v=w[b];v.markId===o||v.removed||(d[h++]=v,v.markId=o,v.pendingPromise&&(v.pendingPromise.cancelled=!0))}}}else g.markId===o||g.removed||(d[h++]=g,g.markId=o,g.pendingPromise&&(g.pendingPromise.cancelled=!0))})}return d.length=h,d};const t=(e={strings:new lh,...e}).getEntireCoords??md;if(this._getEntireCoords=t,this._options=e,this._strings=e.strings,this._onCalculated=e?.onCalculated??(()=>{}),this._cycleId=1,this._values=new wr({orientation:B.Orientation.Column}),this._getFormulaParser=e.getFormulaParser,!this._getFormulaParser)throw new Error("Formula parser is not defined");this._latest={graph:this},this._iterationId=0;const n=this;this._formulaSpatial=new _t({updateEntryOptions:{isMergeOnShift:!0,isSplitOnExpand:!0,onUpdates:(o,i,l)=>{const a=l._cloneKey??n;if(a._isProcessingJSON)return;let c=a._notifyFormulaInsertEntries,u=a._notifyFormulaRemoveEntries;const d=a._precedentSpatial,h=i?i.length:0;if(h>0){let g=u?u.length:0;u?u.length=g+h:(u=new Array(h),a._notifyFormulaRemoveEntries=u);for(let m=0;m<h;m++){const p=i[m],w=p.value,S=w.ref;u[g+m]=S;const b=S.rowStart,v=S.colStart,y=w.formula.getDirectPrecedentsAt(b,v);if(!y)continue;const _=y.length;for(let C=0;C<_;C++){const E=y[C];if(E===null||E instanceof He.Known)continue;const x=d.search(E),R=x.length;for(let I=0;I<R;I++){const A=x[I];A.value.blockEntry.value===p.value&&d.remove(A)}}}}const f=o?o.length:0;if(f>0){const g=[];for(let m=0;m<f;m++){const p=o[m],w=p.colEnd-p.colStart,S=p.rowEnd-p.rowStart,b=p.value,v=b.formula,y=b.ref,_=y.rowStart,C=y.colStart,E=[],x=v.getDirectPrecedentsAt(_,C,!0,Al,Ml),R=x.length;for(let I=0;I<R;I++){const A=x[I];if(A instanceof He.Known)continue;const M=Al[I],k=Ml[I],F={colStart:A.colStart,rowStart:A.rowStart,colEnd:A.colEnd+(k?0:w),rowEnd:A.rowEnd+(M?0:S),value:{blockEntry:p,width:w+1,height:S+1,index:I,$absWidth:k,$absHeight:M,once:null}};E.push(A),g.push(F)}c||(c=[],a._notifyFormulaInsertEntries=c),c.push({colStart:p.colStart,rowStart:p.rowStart,colEnd:p.colEnd,rowEnd:p.rowEnd,value:{tokens:v.getTokens(),references:v.getReferences(),precedents:E}})}d.load(g)}}}}),this._contentfulSpatial=new _t({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0}});const r={updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!1}};this._precedentSpatial=new _t(r),this._volatile=new Set,this._spillSpatial=new _t(r),this._errorSpatial=new _t(r),this._pendingSpatial=new _t(r),this._invalidations=new _t,this._notifyValues=new _t,this._notifySpills=new _t,this._notifyFormats=new _t,this._notifyPending=new _t,this._calculation=e.calculation,this._clearScope()}addListeners(e,t){return this._emitter||(this._emitter=new wn(this)),this._emitter.addListeners(e,t)}shift(e){const t=e.cloneIfUpdate??!0?this.clone(this):this,n={...e};delete n.cloneIfUpdate,delete n.onShift,t._values.shift(n.range,n.direction);const r=t._contentfulSpatial;t._contentfulSpatial=r.shift(n);const o=t._spillSpatial;t._spillSpatial=o.shift(n);const i=t._formulaSpatial;if(i.isEmpty())return t;const l=e.range,a=e.direction,c=a===B.Direction.Left||a===B.Direction.Right;a!==B.Direction.Up&&B.Direction.Left,c?(l.colEnd,l.colStart):(l.rowEnd,l.rowStart),t._notifyFormulaInsertEntries,t._notifyFormulaRemoveEntries;const u=t._getEntireCoords(),d=new Map;this._precedentSpatial.visitRanges({...l,colEnd:c?u.colEnd:l.colEnd,rowEnd:c?l.rowEnd:u.rowEnd},w=>{let S=w.value;if(w.value.once)return;let b=S.blockEntry,v=d.get(b);v||(v={rows:[],cols:[],index:[]},d.set(b,v)),v.index.push(S.index)});const h=[],f=[],g=d.entries();let m=g.next();const p=(w,S,b,v)=>{let y=w.value;const _=y.formula.getReferences(),C=S.length;for(let E=0;E<C;E++){const x=_[E];x!==null&&(x instanceof He.Known||typeof x!="string"&&x[E])}return w.value=y,w};for(;!m.done;){const[w,S]=m.value,b=w.value,v=S.rows.sort(),y=v.length,_=S.cols.sort().length,C=S.index.sort();if(f.push(w),y===0&&_===0){const x={...w};p(x,C),h.push(x),m=g.next();continue}let E=0;for(let x=0;x<y;x++){const R=v[x];if(R===E)continue;Au[0]={colStart:b.ref.colStart,rowStart:E,colEnd:b.ref.colEnd,rowEnd:R-1,value:b},Au[1]={colStart:b.ref.colStart,rowStart:R,colEnd:b.ref.colStart,rowEnd:b.ref.rowEnd,value:b};const I=tC(b,Au,B.Orientation.Row,R);let A=I[0];p(A,C),h.push(A),A=I[1],p(A,C),h.push(A),E=R}m=g.next()}return i._updateNodes(h,f),t._fullCalcRequired=!0,this._invalidate(h),t}clone(e){if(e!==void 0&&this._cloneKey===e)return this;const t=new ah(this._options);t._cloneKey=e,t._values=this._values.clone(t),t._contentfulSpatial=this._contentfulSpatial.clone(t),t._formulaSpatial=this._formulaSpatial.clone(t),t._precedentSpatial=this._precedentSpatial.clone(t),t._volatile=new Set(this._volatile),t._spillSpatial=this._spillSpatial.clone(t),t._errorSpatial=this._errorSpatial.clone(t),t._pendingSpatial=this._pendingSpatial.clone(t),t._invalidations=this._invalidations.clone(t),t._notifyValues=this._notifyValues.clone(t),t._notifySpills=this._notifySpills.clone(t),t._notifyFormats=this._notifyFormats.clone(t),t._notifyPending=this._notifyPending.clone(t);const n=this._notifyFormulaInsertEntries;n&&(t._notifyFormulaInsertEntries=[...n]);const r=this._notifyFormulaRemoveEntries;r&&(t._notifyFormulaRemoveEntries=[...r]);const o=this._pendingActions;return o&&(t._pendingActions=[...o]),t._cycleId=this._cycleId,t._emitter=this._emitter,t._fullCalcRequired=this._fullCalcRequired,this._latest.graph=t,t._iterationId=this._iterationId+1,t}invalidate(e){const t=this._invalidations;if(Array.isArray(e)){const n=e.length;for(let r=0;r<n;r++){let o=e[r];typeof o=="string"&&(o=Bn(o)),t.insertNonOverlapping(o)}}else{let n=e;typeof n=="string"&&(n=Bn(n)),t.insertNonOverlapping(n)}}setFormulaAt(e,t){let n,r=null;return typeof e=="string"?n=Bn(e,kt):(kt.colStart=e.colIndex,kt.rowStart=e.rowIndex,kt.colEnd=e.colIndex,kt.rowEnd=e.rowIndex,n=kt),t?r=this._setInputs(null,[{colStart:n.colStart,rowStart:n.rowStart,colEnd:n.colEnd,rowEnd:n.rowEnd,value:t}]):this.delete(n),r}getFormulaAt(e,t){let n;typeof e=="string"&&(n=Bn(e,kt));const r=this._formulaSpatial.search(n);if(r.length===0)return null;const o=r[0].value;return o.formula?o.formula.getTextAt(n.rowStart,n.colStart,t):void 0}_formulaAt(e,t){si.colStart=t,si.rowStart=e,si.colEnd=t,si.rowEnd=e;const n=this._formulaSpatial.search(si);if(n.length===0)throw new Error(`No formula found at ${Qi({rowIndex:e,colIndex:t})}`);return n[0]}getDirectPrecedentsAt(e,t,n){return this._formulaAt(e,t).value.formula.getDirectPrecedentsAt(e,t,n)}getReferencesAt(e,t){return this._formulaAt(e,t).value.formula.getReferences()}setReferenceAt(e,t,n,r){const o=this._formulaAt(e,t).value.formula.setReferenceAt(n,r).getTextAt(e,t);return this.setFormulaAt({rowIndex:e,colIndex:t},o),this}evaluateAt(e,t,n){const r=this._formulaAt(e,t),o=r.value,i=o.ref,l=i.colStart-t,a=i.rowStart-e,c=this._calculation._getContext(),u=this._calculation._getScope();return u.sheetName=this._options.getSheetName?.(),u.rowIndex=e,u.colIndex=t,u.node=o.calcs[a][l],r.value.formula.evaluate(c,n)}setInputAt(e,t){let n=null;const r=typeof e=="string"?ds(e,Xv):e;if(t!==null){const o=new At.Builder,i=this._values.getOrientation()===B.Orientation.Column,l=i?r.colIndex:r.rowIndex,a=i?r.rowIndex:r.colIndex;o.addValue(l,a,t),n=this.setInputs(o.build(),null)}else this.delete(J.cellToRange(r,kt));return n}setInputs(e,t){return this._setInputs(e,t)}delete(e){typeof e=="string"&&(e=qn(e));const t=this._setInputs(null,[{...e,value:null}],e);return this._emitter?.notify("onInvalidate"),t.removes}_createCopySpillEntries(e,t,n,r,o){const i=r??[],l=o??[],a=t.colStart,c=t.rowStart,u=t.colEnd,d=t.rowEnd,h=n.colStart,f=n.rowStart,g=e.search(t),m=g.length;for(let p=0;p<m;p++){const w=g[p];l&&l.push(w);const S=w.rowStart,b=w.colStart;if(S<c||S>d||b<a||b>u||w.value.getError())continue;const v=h+(w.colEnd-b),y=f+(w.rowEnd-S),_={colStart:h,rowStart:f,colEnd:v,rowEnd:y};i.push({colStart:h,rowStart:f,colEnd:v,rowEnd:y,value:new wa(_,0,!1)})}return{removes:l,inserts:i}}_copyCalcs(e,t,n){const r=e._formulaSpatial;if(r.isEmpty())return;const o=this._getEntireCoords(),i=o.colStart,l=o.rowStart,a=o.colEnd,c=o.rowEnd,u=r.createCopiedEntries(t,n),d=u.inserts;let h=d.length,f=0;const g=e._spillSpatial;let m=[];for(;f<h;){let p=d[f],w=p.value,S=w.ref,b=S.colStart,v=S.rowStart,y=S.colEnd,_=S.rowEnd;this._createCopySpillEntries(g,t,S,m,null);let C=w.formula.getReferences();const E=C.length;for(let x=0;x<E;x++){const R=C[x];if(!R||R.isFormulaError||typeof R=="string")continue;const I=R,A=I.colStart,M=I.rowStart,k=I.colEnd,F=I.rowEnd;let L=I.$colStart?A:A+b,N=I.$rowStart?M:M+v,D=I.$colEnd?k:k+y,O=I.$rowEnd?F:F+_;if(A===Number.MIN_SAFE_INTEGER&&(L=i,D=a),M===Number.MIN_SAFE_INTEGER&&(N=l,O=c),L<i||D>a||N<l||O>c){const H=i-L,z=l-N,j=a-D,q=c-O;oi.colStart=Math.max(b,b+H),oi.rowStart=Math.max(v,v+z),oi.colEnd=Math.min(y,y+j),oi.rowEnd=Math.min(_,_+q);const P=Rs(p,oi,la);if(P){const U=P.length;p=P[U-1],w=p.value,S=w.ref,b=S.colStart,v=S.rowStart,y=S.colEnd,_=S.rowEnd;for(let ne=0;ne<U-1;ne++){const ee=P[ne];d.push(ee),h++}}else w=w.setReferenceAt(x,null),p.value=w,C=w.formula.getReferences()}}d[f++]=p}this._formulaSpatial._updateNodes(d,u.removes),r._mergeNodes({colStart:n.colStart-1,rowStart:n.rowStart-1,colEnd:n.colEnd+1,rowEnd:n.rowEnd+1}),m&&this._spillSpatial._updateNodes(m,[]),this._fullCalcRequired=!0,this._invalidate(d),this._invalidate(u.removes)}_moveCalcs(e,t,n){const r=e._formulaSpatial.createCopiedEntries(t,n);console.log("_moveCalcs",r,"from:",t,"to:",n);const o=this._formulaSpatial,i=(f,g,m,p)=>{let w=f.value;const S=w.formula.getReferences(),b=S.length,v=g.colStart-m.colStart,y=g.rowStart-m.rowStart,_=w.ref,C=m.colStart-_.colStart,E=m.colEnd-_.colEnd,x=m.rowStart-_.rowStart,R=m.rowEnd-_.rowEnd;for(let I=0;I<b;I++){const A=S[I];if(!A||A.isFormulaError||typeof A=="string")continue;const M=A,k=M.colStart,F=M.rowStart,L=M.colEnd,N=M.rowEnd;let D=v,O=y;const H=C<=k&&E>=L||k==Number.MIN_SAFE_INTEGER,z=x<=F&&R>=N||F==Number.MIN_SAFE_INTEGER;let j=!z;M.$colStart||D===0||k===Number.MIN_SAFE_INTEGER?j=!1:j||(j=k<C||k>E,j||!M.$colEnd||M.$colStart||(j=!0));let q=!H;M.$rowStart||O===0||F===Number.MIN_SAFE_INTEGER?q=!1:q||(q=F<x||F>R,j||!M.$rowEnd||M.$rowStart||(q=!0));let P=!z;M.$colEnd||D===0||F===Number.MIN_SAFE_INTEGER?P=!1:P||(P=L<C||L>E,j||!M.$colStart||M.$colEnd||(P=!0));let U=!H;if(M.$rowEnd||O===0||F===Number.MIN_SAFE_INTEGER?U=!1:U||(U=N<x||N>R,U||!M.$rowEnd||M.$rowStart||(U=!0)),!(j||P||q||U))continue;const ne={...M};j&&(ne.colStart+=D),q&&(ne.rowStart+=O),P&&(ne.colEnd+=D),U&&(ne.rowEnd+=O),w=w.setReferenceAt(I,ne)}return f.value=w,f},l=e._spillSpatial;let a=[],c=[];const u=r.inserts,d=u.length;for(let f=0;f<d;f++){const g=u[f];this._createCopySpillEntries(l,t,g,a,c),u[f]=i(g,t,n)}o._updateNodes(r.inserts,[]),e._formulaSpatial._updateNodes([],r.removes);const h=[];a.length>0&&(this._spillSpatial._updateNodes(a,[]),e._spillSpatial._updateNodes([],c),Ca(this._cycleId,c,V.EmptyArray,e._contentfulSpatial,l,e._values,h,e._notifyValues,e._notifySpills,e._notifyPending,e._errorSpatial,e._values.getOrientation()!==B.Orientation.Row,!1)),this._fullCalcRequired=!0,this._invalidate(r.inserts),e._invalidate(h),e._invalidate(r.removes)}getSnapshot(e){const t=this,n=Object.freeze({...e});let r=n.range;return typeof r=="string"&&(r=Bn(r)),{async copyTo(o,i){const l=o.calcGraph;let a=o.range;typeof a=="string"&&(a=Bn(a));const c=fa(a,r,i?.fitDestination,i?.transpose);return{...n,...i}.isCut?l._moveCalcs(t,r,c):l._copyCalcs(t,r,c),a},getCoords:()=>r,getSource:()=>t,getName:()=>"Calculation",getMarkOptions:()=>n,isISnapshot:!0}}autoFill(e,t){return typeof e=="string"&&(e=Bn(e)),typeof t=="string"&&(t=Bn(t)),this._copyCalcs(this,e,t),this}_scheduleRecalculation(e){const t=this._pendingInvalidations;if(e)if(Array.isArray(e)){const r=e.length;for(let o=0;o<r;o++)t.add(e[o])}else t.add(e);const n=this;V.debounce(()=>{const r=n._latest.graph,o=r._volatile,i=r._cycleId;t.forEach(l=>{l.cycleId>i||o.add(l)}),t.clear(),r.calculate()},100)()}_notifyCalculated(e){const t=this,n=t._notifyValues,r=n.all();return new Promise(o=>{V.nextTick(()=>{const i=t._cycleId;let l,a=t._fullCalcRequired;a||(typeof e=="boolean"?a=e:e&&(l=e,a=l.full??!1));const c={};let u=null;const d=r.length;if(d>0){n.clear();let b=r,v=null;for(let I=0;I<d;I++){const A=r[I],M=A.colStart,k=A.colEnd;if(M!==k){v||(v=[]);for(let F=M+1;F<=k;F++)v.push({colStart:F,rowStart:A.rowStart,colEnd:F,rowEnd:A.rowEnd});A.colEnd=M}}v&&(b=r.concat(v)),b.sort(J.columnFirstRangeComparator);const y=new At.Builder(I=>new Zn(I));let _;const C=t._values,E=C.getOrientation()===B.Orientation.Column,x=b.length;for(let I=0;I<x;I++){const A=b[I];u=J.unionRanges(u,A,kt);const M=C.getRuns({bounds:A});let k=M.next();const F=A.colStart,L=A.rowStart,N=A.colEnd,D=A.rowEnd,O=E?L:F,H=E?N:D,z=E?D:N;let j=E?F:L,q=O;for(;!k.done;){const P=k.value,U=P[0];for(;j<U;)_||(_=[]),_.push({colStart:E?j:q,rowStart:E?q:j,colEnd:E?j:z,rowEnd:E?z:j}),j++,q=O;const ne=P[1],ee=P[2],ve=Math.max(ne,O),le=Math.min(ne+ee.length-1,z);y.addValues(U,ve,ee),q<ve&&(_||(_=[]),_.push({colStart:E?U:q,rowStart:E?q:U,colEnd:E?U:ve-1,rowEnd:E?ve-1:U})),q=le+1,le>=z?(j=U+1,q=O):j=U,k=M.next()}for(;j<=H;)q<=z&&(_||(_=[]),_.push({colStart:E?j:q,rowStart:E?q:j,colEnd:E?j:z,rowEnd:E?z:j})),j++,q=O}const R=y.build();R&&(c.valueInserts=R),_&&(c.valueRemoves=_)}const h=t._notifyPending,f=h.all();if(f.length>0){h.clear();const b=t._pendingSpatial;let v;const y=f.length;for(let _=0;_<y;_++){const C=f[_];b.insertNonOverlapping(C,{onIntersect:(E,x)=>(v||(v=[]),v.push({...x}),u=J.unionRanges(u,x),x.value===!1&&(x.value=null),x)})}v&&v.length>0&&(c.pendingUpdates=v,u=J.unionRangesArrays(v,u,kt))}const g=t._notifySpills,m=g.all();if(m.length>0){g.clear();const b=t._spillSpatial;let v,y,_;const C=m.length;for(let E=0;E<C;E++){const x=m[E],R=x.value;if(R.getCycleId()!==i)v||(v=[]),v.push({colStart:x.colStart,rowStart:x.rowStart,colEnd:x.colEnd,rowEnd:x.rowEnd});else{const I=b.search(x),A=I.length;for(let M=0;M<A;M++){let k=I[M];if(Iw(x.rowStart,x.colStart,k)&&R.getCycleId()===i){y||(y=[],_=new Set);const F=lr(k.colStart)+Sr(k.rowStart);if(_.has(F))continue;_.add(F),y.push({colStart:x.colStart,rowStart:x.rowStart,colEnd:x.colEnd,rowEnd:x.rowEnd,value:k.value.getError()})}}}}y&&(c.spillInserts=y,u=J.unionRangesArrays(y,u,kt)),v&&(c.spillRemoves=v,u=J.unionRangesArrays(v,u,kt))}const p=t._notifyFormats.all();p.length>0&&(c.formatInserts=p,u=J.unionRangesArrays(p,u,kt),t._notifyFormats.clear());const w=t._notifyFormulaInsertEntries;if(w){const b=t._formulaSpatial;for(let v=w.length-1;v>=0;v--){const y=w[v];b.search(y).length===0?w.splice(v,1):u=J.unionRanges(u,y,kt)}c.formulaInserts=w,t._notifyFormulaInsertEntries=void 0}const S=t._notifyFormulaRemoveEntries;S&&(c.formulaRemoves=S,u=J.unionRangesArrays(S,u,kt),t._notifyFormulaRemoveEntries=void 0),u&&(c.bounds=J.sanitizeRange(u)),Object.keys(c).length===0?c.cycleId=i-1:(c.cycleId=i,t._cycleId++),a&&(c.isFull=!0),t._fullCalcRequired=!1,t._options.onCalculated?.(c),o(c)})})}_setInputs(e,t,n){if(this._calculation.getStatus()===Yt.Status.Starting)return this._addToPending(()=>{const x=this._setInputs(e,t,n),R={formulaInserts:x.inserts??V.EmptyArray,formulaRemoves:x.removes??V.EmptyArray,cycleId:this._cycleId,bounds:J.unionRanges(J.unionRangesArrays(x.inserts),J.unionRangesArrays(x.removes))};return Promise.resolve(R)}),eC;const r=this._values.getOrientation()!==B.Orientation.Row,o=this._spillSpatial,i=this._errorSpatial,l=this._contentfulSpatial,a=[],c=this._formulaSpatial;let u,d,h=!c.isEmpty(),f=h?[]:null,g=this._values;if(e&&e.tuples){if(u=e.tuples,f){let x=e.bounds;if(h)if(x){const A=Hi(x,r);a.push(A)}else{const A={colStart:Number.MIN_SAFE_INTEGER,rowStart:Number.MIN_SAFE_INTEGER,colEnd:Number.MAX_SAFE_INTEGER,rowEnd:Number.MAX_SAFE_INTEGER};a.push(A)}const R={majorStart:0,minorStart:0,majorEnd:0,minorEnd:0},I=u.length;for(let A=0;A<I;A++){const M=u[A],k=M[0];R.majorStart=k,R.majorEnd=k;const F=M[1],L=F.length;for(let N=0;N<L;N++){const D=F[N];R.minorStart=D[0];const O=D[1];R.minorEnd=R.minorStart+O.length-1;const H=Hi(R,r);f&&c.search(H).length>0&&f.push(H)}}}d=hf(e.tuples,r)}(n||u)&&(Ca(this._cycleId,n?[n]:V.EmptyArray,d,l,o,g,a,this._notifyValues,this._notifySpills,this._notifyPending,i,r,!1),n&&g.delete(n),u&&g.setValues(u));const m=this._calculation._getContext(),p=this._calculation._getScope();let w,S;p.sheetName=this._options.getSheetName?.();const b=this._getFormulaParser(),v=(x,R)=>{const I=x.rowStart,A=x.colStart,M={...x,value:null};if(c.insertNonOverlapping(M,{noMerge:!0,onIntersect:(k,F)=>k.value===null?null:(S||(S=[]),S.push(k),F)}),R!==null){p.rowIndex=I,p.colIndex=A;const k=b.parse(m,R),F=new Mr(x,k),L={...x,value:F};w||(w=[]),w.push(L)}},y=f?f.length:0;for(let x=0;x<y;x++)v(f[x],null);const _=t?t.length:0;for(let x=0;x<_;x++){const R=t[x],I=R.value;v(J.sanitizeRange(R),I)}const C=S?S.length:0,E=this._precedentSpatial;for(let x=0;x<C;x++){const R=S[x].value.calcs;if(R){const I=R.length;for(let A=0;A<I;A++){const M=R[A];for(let k=0;k<M.length;k++){const F=M[k];if(F.dynamic){for(let L=0;L<F.dynamic.length;L++){const N=F.dynamic[L];E.remove(N)}F.dynamic=null}}}}}return t&&(c._updateNodes(w,V.EmptyArray),Ca(this._cycleId,S,w,l,o,g,a,this._notifyValues,this._notifySpills,this._notifyPending,i,r,!0)),this._invalidate(a),{inserts:this._notifyFormulaInsertEntries??V.EmptyArray,removes:this._notifyFormulaRemoveEntries??V.EmptyArray}}_invalidate(e){if(!e||e.length==0)return;const t=this._invalidations,n=mr(e,B.Orientation.Column,2);for(let r=0;r<n.length;r++)t.insertNonOverlapping(n[r]);this._emitter?.notify("onInvalidate")}_markAndPlan(e,t,n){let r;ni=0,Iu=0,Nl=0,ri=0;const o=this._precedentSpatial,i=this._formulaSpatial;Eu=0,kl=0;const l=this._cycleId,a=t.length;for(let h=0;h<a;h++){const f=t[h];f.markId!==n&&(f.markId=n,f.cycleId=l,f.inDegree=0,Cu[ni++]=f,xu[kl++]=f)}const c=(h,f,g)=>{(e||h.state===_d)&&(r||(r=[]),r.push(f),e||g(h))},u=h=>{h.markId!==n&&(h.markId=n,h.cycleId=l,h.inDegree=0,Cu[ni++]=h,xu[kl++]=h)};for(;Eu<kl;){const h=xu[Eu++],f=h.colIndex,g=h.rowIndex;kt.colStart=f,kt.rowStart=g,kt.colEnd=f,kt.rowEnd=g;const m=o.search(kt),p=m.length;if(p===0)h.dependents=V.EmptyArray;else for(let w=0;w<p;w++){const S=m[w],b=S.value.once;b?c(b,S,u):sm(S,g,f,u)}}for(let h=0;h<ni;h++){const f=Cu[h],g=f.block,m=f.rowIndex,p=f.colIndex,w=g.formula.getDirectPrecedentsAt(m,p);let S=0;const b=f.precedents;for(let v=0;v<w.length;v++){const y=w[v];if(y.isFormulaError){b[v]=y;continue}{const A=y;A.calc=void 0,b[v]=A}const _=y.colStart,C=y.rowStart,E=y.colEnd,x=y.rowEnd,R=i.search(y),I=R.length;for(let A=0;A<I;A++){const M=R[A],k=M.colStart,F=M.rowStart,L=M.colEnd,N=M.rowEnd,D=Math.max(k,_),O=Math.max(F,C),H=Math.min(L,E),z=Math.min(N,x),j=M.value.calcs;for(let q=O;q<=z;q++){const P=j[q-F];for(let U=D;U<=H;U++){const ne=P[U-k];ne.markId===n&&(y.calc=ne,S++)}}}}f.inDegree=S,f.inDegree===0&&(Ru[Nl++]=f)}const d=h=>{h.markId===n&&(h.inDegree--,h.inDegree===0&&(Ru[Nl++]=h))};for(;Iu<Nl;){const h=Ru[Iu++];im[ri++]=h;const f=h.colIndex,g=h.rowIndex;kt.colStart=f,kt.rowStart=g,kt.colEnd=f,kt.rowEnd=g;const m=o.search(kt),p=m.length;for(let w=0;w<p;w++){const S=m[w],b=S.value.once;b?c(b,S,d):sm(S,g,f,d)}}return ri<ni?{completed:!1,onces:r}:{completed:!0,onces:r}}_evaluate(e){const t=this._calculation._getContext(),n=this._calculation._getScope();n.sheetName=this._options.getSheetName?.();let r=Qv;r.length=0;let o=0,i=!0;const l=this._cycleId,a=this._invalidations,c=this._contentfulSpatial,u=this._notifyValues,d=this._notifySpills,h=this._precedentSpatial,f=this._spillSpatial,g=this._values,m=g.getOrientation(),p=m===B.Orientation.Column;let w;n.spillSpatial=this._spillSpatial,n.values=g;const S=t.getEntireCoords.bind(t);let b;for(let v=0;v<ri;v++){const y=im[v];if(y.state===gf&&l===y.cycleId){y.state=_d;continue}if(y.dynamic){for(let ae=0;ae<y.dynamic.length;ae++){const fe=y.dynamic[ae];h.remove(fe)}y.dynamic=null}const _=y.block,C=y.colIndex,E=y.rowIndex;let x=e?void 0:y.cachedValue,R=y.error;!R&&x&&x.isFormulaError&&(R=x);let I=!1;const A=y.precedents;if(A){const ae=A.length,fe=y.inputs;for(let ye=0;ye<ae;ye++){const he=A[ye],we=he.calc;if(we&&we.pending){I=!0;continue}if(he.isFormulaError){fe[ye]=he;continue}const be=he.colStart,me=he.rowStart,de=he.colEnd;he.rowEnd!==me||be!==de?(o>0&&(r.length=o,om(r,g,u,p),o=0),fe[ye]=new xd(g,null,{...he},null,S)):fe[ye]=we===void 0?he:we.cachedValue}y.pendingPrecedents=I}const M=p?C:E,k=p?E:C;n.node=y,n.colIndex=C,n.rowIndex=E;const F=_.formula;let L,N;const D=y.pending;let O=D;if((I||y.pendingPromise)&&(O=!0,L=y.cachedValue??null,y.pendingPromise&&(y.pendingResolved?(y.pendingPromise=null,y.pendingResolved=!1,O=!1):(y.pendingPromise.cancelled=!0,L=void 0))),L===void 0&&(n.formula=F,n.colIndex=C,n.rowIndex=E,L=F.evaluate(t,void 0,y.inputs),n.formula=null,N=L&&L.then?L:null,O=!!N),O!==D&&(y.pending=O,w||(w=oo(p)),w.append(M,k,O)),N&&(L=y.cachedValue??null,!N.__originator)){N.__originator=l;const ae=y;Tl.add(ae),ae.pendingPromise=N,ae.pendingResolved=!1,N.then(fe=>{if(Tl.delete(ae),N.cancelled)return;ae.pendingPromise=N,ae.pendingResolved=!0;let ye=rc(fe,t);ye===null&&(ye=0),ae.cachedValue=ye,this._scheduleRecalculation(ae)},fe=>{})}let H=1,z=1;const j=x instanceof gn;let q;const P=x instanceof He.Spill;if(j||P){ei.colStart=C,ei.rowStart=E,ei.colEnd=C,ei.rowEnd=E;const ae=f.search(ei);for(let fe=0;!q&&fe<ae.length;fe++){const ye=ae[fe];ye.colStart===C&&ye.rowStart===E&&(q=ye)}if(q){if(j){const ye=x;H=ye.getWidth(),z=ye.getHeight()}const fe={colStart:C,rowStart:E,colEnd:C+H-1,rowEnd:E+z-1};f.remove(q),q&&q.value.getError()||(c.insertNonOverlapping({...fe,value:null}),g.delete(fe),u.insertNonOverlapping(fe))}}let U=1,ne=1;const ee=L,ve=ee?.isIRange;let le,Ce=L instanceof He.Spill;if(ve&&ee.size>1){U=ee.getWidth(),ne=ee.getHeight();const ae={colStart:C,rowStart:E,colEnd:C+U-1,rowEnd:E+ne-1},fe=t.getEntireCoords(),ye=!J.isRangeWithinRange(ae,fe);if(ye&&(ae.colEnd=Math.min(ae.colEnd,fe.colEnd),ae.rowEnd=Math.min(ae.rowEnd,fe.rowEnd)),Ce=ye,!Ce){const be=c.search(ae);if(Ce=be.length>1,!Ce&&be.length===1){const me=be[0],de=J.intersectRanges(ae,me,kt);(de&&(de.rowEnd!==de.rowStart||de.colStart!==de.colEnd)||de.colStart!==C||de.rowStart!==E)&&(Ce=!0)}}let he,we;if(Ce)L=He.BuiltIn.Spill,U=1,ne=1,he=[[M,[[k,[L]]]]],g.setValues(he),we={colStart:C,rowStart:E,colEnd:C,rowEnd:E};else{const be=Jv(ee,M,k);be&&(he=be.tuples),he&&g.setValues(he),we=ae}le={...ae,value:new wa(ae,l,Ce)},f.insert(le),b=Ed(b,y,ae),u.insertNonOverlapping(we),a.insertNonOverlapping(we),c.insertNonOverlapping({...we,value:new rr(we,m)})}(!J.isEqualRanges(q,le)||Ce||P)&&(q&&d.insert(q),le&&d.insert(le)),U===H&&ne===z||(y.state=gf,a.insertNonOverlapping({colStart:C,rowStart:E,colEnd:C+Math.max(U,H)-1,rowEnd:E+Math.max(ne,z)-1}),i=!1);let re=L&&L.isFormulaError?L:null;F.getError()&&(re=F.getError()),(re||R&&!e)&&(re&&!re.equals(R)||R&&R.equals(re)),y.cachedValue=L,r[o++]=y}if(n.node=null,n.colIndex=Number.MAX_SAFE_INTEGER,n.rowIndex=Number.MAX_SAFE_INTEGER,w){const v=w.done(!0);this._notifyPending.load(v)}return o>0&&(r.length=o,om(r,g,u,p),o=0),{completed:i,dynamic:b,count:ri}}async calculate(e){const t=this._calculation.getStatus();if(t===Yt.Status.Starting)return void this._addToPending(()=>this.calculate(e));if(t!==Yt.Status.Ready)return;let n=this._fullCalcRequired;n||(typeof e=="boolean"?n=e:e&&(n=e.full??!1));const r=this._invalidations;if(this._formulaSpatial.isEmpty()){if(r.clear(),Tl.size>0){const u=++ti;Tl.forEach(d=>{d.markId=u})}return this._notifyCalculated(e)}let o=n;const i=this._volatile;let l=++ti,a=this._collectDirties(l,o,r.all(),i);if(r.clear(),i.clear(),!o&&a.length===0)return this._notifyCalculated(e);o&&this._clearCalcs();const c=this._resetScope();for(;a.length>0;){l=++ti;const u=this._markAndPlan(o,a,l).onces;if(u){const h=this._precedentSpatial,f=u.length;for(let g=0;g<f;g++)h.remove(u[g],rm)}a.length=0;const d=this._evaluate(o);if(d.dynamic&&this._precedentSpatial.load(d.dynamic),c.dynamicPrecedentsInserts&&(this._precedentSpatial.load(c.dynamicPrecedentsInserts),c.dynamicPrecedentsInserts=[]),c.conflatingFormats){const h=c.conflatingFormats.done(!0),f=this._notifyFormats;for(let g=0;g<h.length;g++){const m=h[g];f.insertNonOverlapping(m)}c.conflatingFormats=null}d.completed||(o=!1,l=++ti,a=this._collectDirties(l,o,r.all(),i),r.clear())}return this._clearScope(),this._notifyCalculated(e)}_clearScope(){const e=this._calculation._getScope();e&&(e.rowIndex=0,e.colIndex=0,e.node=null,e.values=this._values,e.formulaSpatial=this._formulaSpatial,e.volatile=this._volatile,e.conflatingFormats=null,e.dynamicPrecedentsInserts=null,e.formula=null,e.getEntireCoords=md)}_resetScope(){const e=this._calculation._getScope();if(e)return e.rowIndex=0,e.colIndex=0,e.node=null,e.values=this._values,e.formulaSpatial=this._formulaSpatial,e.volatile=this._volatile,e.conflatingFormats=null,e.dynamicPrecedentsInserts=null,e.formula=null,e.getEntireCoords=this._getEntireCoords,e}_clearCalcs(){const e=this._values,t=this._spillSpatial,n=this._contentfulSpatial,r=t.all();for(let o=0;o<r.length;o++){const i=r[o];i.value.getError()||(e.delete(i),n.insertNonOverlapping({...i,value:null}))}t.clear(),this._errorSpatial.clear(),this._pendingSpatial.clear(),this._volatile.clear(),this._clearNotifications()}_clearNotifications(){this._invalidations.clear(),this._notifyValues.clear(),this._notifySpills.clear(),this._notifyFormats.clear(),this._notifyPending.clear()}_clearAll(){this._cycleId!==1&&this._cycleId++,ti++,this._formulaSpatial.clear(),this._contentfulSpatial.clear(),this._pendingInvalidations.clear(),this._values.clear(),this._precedentSpatial.clear(),this._volatile.clear(),this._spillSpatial.clear(),this._errorSpatial.clear(),this._pendingSpatial.clear(),this._clearNotifications(),this._notifyFormulaInsertEntries=void 0,this._notifyFormulaRemoveEntries=void 0}_addToPending(e){let t=this._pendingActions;if(!t){this._pendingActions=t=[];const n=this;n._calculation.addListeners({onReady:()=>{(async()=>{const r=n._pendingActions,o=r.length;for(let i=0;i<o;i++){const l=r[i],a=await l.bind(n)();n._options.onCalculated?.(a)}this._pendingActions=null})()},onError:()=>{}},{once:!0})}t.push(e)}fromJSON(e){const t=this._calculation.getStatus();if(t===Yt.Status.Starting)return void this._addToPending(()=>Promise.resolve(this.fromJSON(e)));if(t!==Yt.Status.Ready)return;this._clearAll();const n={cycleId:0,isFull:!0};if(!e)return n;this._isProcessingJSON=!0;try{if(e.data){const i=e.data;this._values.setValues(i);const l=this._values.getOrientation()===B.Orientation.Column,a=hf(i,l);this._contentfulSpatial.load(a)}const r=this._formulaSpatial,o=e.formulas;if(o){const i=e.dynamic,l=new Set;if(i){const w=i.length;for(let S=0;S<w;S++){const b=i[S],v=b[0].split(":")[0];l.add(v)}}const a=o.length,c=new Array(a),u=[],d=[],h=this._calculation._getContext(),f=this._calculation._getScope();f.colIndex=0,f.rowIndex=0;const g=this._getFormulaParser();for(let w=0;w<a;w++){const S=o[w],b=S[0],v=Bn(b),y=S[1],_=v.rowStart,C=v.colStart;f.colIndex=C,f.rowIndex=_;let E=g.parse(h,y);const x=E.getDirectPrecedentsAt(_,C,!0,Al,Ml),R=x.length;R===1&&(E=E.wrapImplicit(_,C,l));const I={...v},A=new Mr(I,E);v.value=A,c[w]=v;const M=v.rowEnd,k=v.colEnd-C,F=M-_,L=[];for(let N=0;N<R;N++){const D=x[N];if(D instanceof He.Known)continue;const O=Al[N],H=Ml[N],z={colStart:D.colStart,rowStart:D.rowStart,colEnd:D.colEnd+(H?0:k),rowEnd:D.rowEnd+(O?0:F),value:{blockEntry:v,width:k+1,height:F+1,index:N,$absWidth:H,$absHeight:O,once:null}};L.push(D),d.push(z)}u.push({colStart:I.colStart,rowStart:I.rowStart,colEnd:I.colEnd,rowEnd:I.rowEnd,value:{tokens:E.getTokens(),references:E.getReferences(),precedents:L}})}if(r.load(c),this._precedentSpatial.load(d),u.length>0&&(n.formulaInserts=u),i){const w=[],S=[];let b;const v=this._values,y=i.length;for(let _=0;_<y;_++){const C=i[_],E=C[0],x=Bn(E),R=C[1],I={...x},A=I.colStart,M=I.rowStart,k=I.colEnd,F=I.rowEnd;ns.colStart=A,ns.rowStart=M,ns.colEnd=A,ns.rowEnd=M;const L=r.search(ns);if(L.length!==1)continue;const N=L[0].value,D=N.ref,O=N.calcs,H=M-D.rowStart,z=A-D.colStart,j=O[H][z];if(R)j.cachedValue=He.BuiltIn.Spill;else{const P=new gn(v,I);j.cachedValue=P}x.value=new wa(I,0,R),S.push(x);const q={colStart:A,rowStart:M,colEnd:k,rowEnd:F,value:R};J.isSingleCell(q)||w.push(q),Ed(b,j,I)}this._spillSpatial.load(S),this._precedentSpatial.load(b),w.length>0&&(n.spillInserts=w)}const m=e.volatile,p=m?m.length:0;if(p>0){const w=this._volatile,S=b=>{w.add(b)};for(let b=0;b<p;b++){const v=m[b],y=Bn(v,ns),_=r.search(y),C=_.length;for(let E=0;E<C;E++){const x=_[E];Kv(x,y,S)}}}}}catch(r){throw r}finally{this._isProcessingJSON=!1}return n}async toJSON(e=!1){const t=this._formulaSpatial.all(),n=t.length;if(n===0)return null;const r={};if(n>0){const a=new Array(n);for(let c=0;c<n;c++){const u=t[c];a[c]=u.value.toJSON()}r.formulas=a}const o=this._spillSpatial.all(),i=o.length;if(i>0){const a=this._getEntireCoords(),c=new Array(i);for(let u=0;u<i;u++){const d=o[u],h=Pr(d,a);c[u]=[h,d.value.getError()]}r.dynamic=c}const l=this._volatile;if(l.size>0){const a=l.values();let c=a.next();const u=this._values.getOrientation()===B.Orientation.Column,d=oo(!0);for(;!c.done;){const m=c.value;if(Array.isArray(m))for(let p=0;p<m.length;p++){const w=m[p];for(let S=0;S<w.length;S++){const b=w[S],v=b.colIndex,y=b.rowIndex,_=u?v:y,C=u?y:v;d.append(_,C)}}else{const p=m.colIndex,w=m.rowIndex,S=u?p:w,b=u?w:p;d.append(S,b)}c=a.next()}const h=d.done(!0),f=h.length,g=new Array(f);for(let m=0;m<f;m++){const p=h[m],w=Pr(p,this._getEntireCoords());g[m]=w}r.volatile=g}return r}}const om=(s,e,t,n)=>{const r=new At.Builder(Zv),o=oo(n);s.sort(n?J.columnFirstCellComparator:J.rowFirstCellComparator);const i=s.length;for(let c=0;c<i;c++){const u=s[c],d=u.colIndex,h=u.rowIndex;if(!u.cachedValue?.isIRange){const f=n?d:h,g=n?h:d;let m=u.cachedValue;r.addValue(f,g,m),o.append(f,g)}}const l=r.build();l&&l.tuples&&e.setValues(l.tuples);const a=o.done(!0);for(let c=0;c<a.length;c++){const u=a[c];t.insertNonOverlapping(u)}},Kv=(s,e,t)=>{const n=s.colStart,r=s.rowStart,o=s.colEnd,i=s.rowEnd,l=e.colStart,a=e.rowStart,c=e.colEnd,u=e.rowEnd,d=Math.max(n,l),h=Math.max(r,a),f=Math.min(o,c),g=Math.min(i,u),m=s.value.calcs;for(let p=h;p<=g;p++){const w=p-r,S=m[w];for(let b=d;b<=f;b++){const v=b-n;t(S[v],w,v)}}},sm=(s,e,t,n)=>{const r=s.value,o=r.$absHeight,i=r.$absWidth,l=r.width,a=r.height,c=r.blockEntry.value.calcs,u=t-s.colStart,d=e-s.rowStart,h=Math.min(Math.max(u,0),l-1),f=Math.min(Math.max(d,0),a-1);if(o||i)if(i){const g=c[f];for(let m=0;m<l;m++)n(g[m])}else if(o)for(let g=0;g<a;g++)n(c[g][h]);else for(let g=0;g<a;g++){const m=c[g];for(let p=0;p<l;p++)n(m[p])}else n(c[f][h])},Xv={rowIndex:0,colIndex:0},kt={rowStart:0,colStart:0,rowEnd:0,colEnd:0},Al=[],Ml=[],ns={rowStart:0,colStart:0,rowEnd:0,colEnd:0},ei={rowStart:0,colStart:0,rowEnd:0,colEnd:0};new He.Calc("Cyclical dependency");const Zv=s=>new Zn(s);let ti=0;const Bo=1e4,Yv=new Array(Bo),Qv=new Array(Bo),Tl=new Set,Cu=new Array(Bo);let ni=0;const xu=new Array(Bo);let Eu=0,kl=0;const Ru=new Array(Bo);let Iu=0,Nl=0;const im=new Array(Bo);let ri=0;const lm=new Array(Bo),oi={colStart:0,rowStart:0,colEnd:0,rowEnd:0},si={colStart:0,rowStart:0,colEnd:0,rowEnd:0},Au=[null,null],eC=Object.freeze({inserts:V.EmptyArray,removes:V.EmptyArray});function tC(s,e,t,n){const r=s;if(r?.getSplit){const o=r.getSplit(e,t,n);if(o===void 0)return;e[0].value=o[0],e[1].value=o[1]}return e}class nC{constructor(e,t=!0){this._options={...sC,...e},this._getFunction=this._options.getFunction,this._isColumn=t}_setInstanceScope(e){this._instanceScope=e}async _initialize(){const e=await ec._validate(!0),t=oC();this._calcScope=t,this._runtime=new rC(this._options,e);const{initializeBuiltIns:n}=await ao(async()=>{const{initializeBuiltIns:o}=await import("./BuabryqTvHfqYpLE-DpI2rgMV.js");return{initializeBuiltIns:o}},__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url),r=this;return this._builtInFunctions=Object.freeze(n(()=>r)),{builtInFunctions:this._builtInFunctions,calcScope:this._calcScope}}getBuiltInFunctions(){return this._builtInFunctions}getFunction(e){return this._builtInFunctions.get(e)??this._getFunction?.(e)}getNumberFormat(e,t){return Vt.Parser.formatValue(e,t,{date1904:this._options.isDate1904?.()??!1})}getEntireCoords(){return this._calcScope.getEntireCoords()}getFormulaAt(e,t){const n=this._calcScope.formulaSpatial;if(!n)return null;ii.colStart=t,ii.rowStart=e,ii.colEnd=t,ii.rowEnd=e;const r=n.search(ii);return r.length===0?null:r[0].value.formula.getTextAt(e,t)??null}markVolatile(){const e=this._calcScope,t=e.volatile;t&&t.add(e.node)}formatResults(e){const t=this._calcScope,n=this._isColumn,r=n?t.colIndex:t.rowIndex,o=n?t.rowIndex:t.colIndex;t.conflatingFormats||(t.conflatingFormats=oo(n)),t.conflatingFormats.append(r,o,e)}getSheetIndex(e){const t=this._calcScope;return e===void 0&&(e=t.sheetName),this._options.getSheetIndex?.(e)??-1}getSheetCount(){return this._options.getSheetCount?.()??1}isValidDate(e){return Ms(e)}fromOADate(e){return Ts(e,this._options.isDate1904?.()??!1)}toOADate(e){return Ki(e,this._options.isDate1904?.()??!1)}_fromTuples(e,t=null,n=!1){if(!e)return null;const r=Hi(e.bounds,!0),o=this._calcScope,i=this._isColumn?B.Orientation.Column:B.Orientation.Row,l=new wr({orientation:i,maxCoords:o.getEntireCoords()});return l.setValues(e.tuples),new gn(l,r,t,n)}getValueAt(e,t){return this._calcScope.values.getValueAt(e,t)??null}getSpillAt(e,t){const n=this._calcScope.spillSpatial;if(!n)return null;li.rowStart=e,li.colStart=t,li.rowEnd=e,li.colEnd=t;const r=n.search(li);if(r.length===0)return null;for(let o=0;o<r.length;o++){const i=r[o];if(i.rowStart===e&&i.colStart===t)return this.getReference(J.sanitizeRange(i))}return null}getRange(e,t){if(e?.isIRange)return e;let n;const r=Array.isArray(e);if(t=t??r,r)if(Array.isArray(e[0]))n=e;else{if(e[0]?.isIRange)throw He.BuiltIn.Value;n=[e]}else n=[[e]];const o=this._isColumn,i=o?B.Orientation.Column:B.Orientation.Row,l=this._fromTuples(Da(n,o,Pn(0,0,void 0,void 0,o),!0),void 0,t);if(l)return l;const a=new wr({orientation:i,maxCoords:this._calcScope.getEntireCoords()});return new gn(a,J.EmptyRange,void 0,t)}getPosition(){const e=this._calcScope;return{colIndex:e.colIndex,rowIndex:e.rowIndex}}getReference(e,t){if(!e)throw He.BuiltIn.Ref;const n=this._calcScope,r=n.getEntireCoords;if(typeof e=="string"){if(t)throw He.BuiltIn.Ref;try{const c=oh(e,r(),el,()=>{throw He.BuiltIn.Ref},t);if(c.length>1)throw He.BuiltIn.Ref;e=c[0]}catch{throw He.BuiltIn.Ref}}if(!e)throw He.BuiltIn.Ref;const o=n.values;let i;const l=n.node;let a;if(l){const c=l.precedents;a=iC(c,e)}if(a){const c=a.calc;i=c&&c.isIReferenceRange?c.cachedValue:new xd(o,void 0,e,null,r)}else n.dynamicPrecedentsInserts=Ed(n.dynamicPrecedentsInserts,l,e),i=new xd(o,void 0,e,null,r);return i}getAddress(e,t=!1){e||(e=this.getPosition());const n=this.getEntireCoords().sheetName;return e.colIndex!==void 0?((r,o,i=!1)=>i?pa(r,o):lu(r,o))(e,n,t):((r,o,i=!1)=>(i?pa({colIndex:r.colStart,rowIndex:r.rowStart,$colIndex:r.$colStart,$rowIndex:r.$rowStart,sheetName:r.sheetName},o):lu({colIndex:r.colStart,rowIndex:r.rowStart,$colIndex:r.$colStart,$rowIndex:r.$rowStart,sheetName:r.sheetName},o))+":"+(i?pa({colIndex:r.colEnd,rowIndex:r.rowEnd,$colIndex:r.$colEnd,$rowIndex:r.$rowEnd},null):lu({colIndex:r.colEnd,rowIndex:r.rowEnd,$colIndex:r.$colEnd,$rowIndex:r.$rowEnd},null)))(e,n,t)}parseAsDateTime(e,t=!1){return function(n,r=!1,o=!1){let i=n,l=c0(n,r,!0);l&&(i=l.leadingText);let a=null;if(i.trim().length>0&&(a=qd(i,r),!a&&o))return null;!a&&l?.leadingText.trim().length>0&&(l=null);let c=0;return a&&(c+=a.asOADate),l&&(c+=l.parsed.oaDateTime),c}(e,this._options.isDate1904?.()??!1,t)}getRuntime(){return this._runtime}get[Symbol.toStringTag](){return"[CalculationContext]"}toString(){let e="";const t=this._instanceScope;let n;return t&&(n=t.toString?.()),n&&n&&(e=`${e}:[${n}]`),e}}class rC{constructor(e,t){this._options=e,this._license=t}getCurrencySymbol(){return"$"}getNumberDecimalSeparator(){return"."}getNumberGroupSeparator(){return","}isDate1904(){return this._options.isDate1904?.()??!1}getDescription(){return"Calculation Runtime"}getLocation(){return V.isNode()?process.cwd():window.location?.href??"/"}getVersion(){try{const e="0.6.6";if(e.indexOf(".env.")===-1)return`${e}`}catch{return"local"}}getOS(){return V.getOS()}getUser(){return this._license?.licensee?.()??null}}const oC=()=>({rowIndex:0,colIndex:0,sheetName:null,node:null,values:null,formulaSpatial:null,spillSpatial:null,volatile:null,conflatingFormats:null,dynamicPrecedentsInserts:null,formula:null,getEntireCoords:()=>Yi}),sC={getSheetIndex:s=>-1,getSheetCount:()=>1,getSheetName:()=>null,getEntireCoords:()=>Yi,getNamed:(s,e)=>null,getFunction:s=>null,isDate1904:()=>!1},iC=(s,e)=>{if(!s)return;const t=s.length;if(t===0)return;const n=e.colStart,r=e.rowStart,o=e.colEnd,i=e.rowEnd;for(let l=0;l<t;l++){const a=s[l],c=a;if(c!==void 0&&a.colStart===n&&a.rowStart===r&&a.colEnd===o&&a.rowEnd===i)return c}return null},ii={rowStart:0,colStart:0,rowEnd:0,colEnd:0},li={rowStart:0,colStart:0,rowEnd:0,colEnd:0};class lC{_setScope(e){this._scope=e}_getScope(e=!1){const t=this._scope;if(!t&&!e)throw new Error("FunctionContext can only be used in a function.");return t}getNumberFormat(e,t){return this._getScope().getNumberFormat(e,t)}getEntireCoords(){return this._getScope().getEntireCoords()??Yi}isValidDate(e){return this._getScope().isValidDate(e)}parseAsDateTime(e,t){return this._getScope().parseAsDateTime(e,t)}fromOADate(e){return this._getScope().fromOADate(e)}toOADate(e){return this._getScope().toOADate(e)}getRange(e){return this._getScope().getRange(e)}getValueAt(e,t){return this._getScope().getValueAt(e,t)}getPosition(){return this._getScope().getPosition?.()??z1}getReference(e,t){return this._getScope().getReference(e,t)}getFormulaAt(e,t){return this._getScope().getFormulaAt?.(e,t)??null}getSpillAt(e,t){return this._getScope().getSpillAt?.(e,t)??null}getSheetIndex(e){return this._getScope().getSheetIndex?.(e)??-1}getSheetCount(){return this._getScope().getSheetCount?.()??1}markVolatile(){this._getScope().markVolatile?.()}formatResults(e){this._getScope().formatResults?.(e)}getFunction(e){return this._getScope().getFunction?.(e)??null}getAddress(e,t){return this._getScope().getAddress(e,t)}getRuntime(){return this._getScope().getRuntime()}get[Symbol.toStringTag](){return"[FormulaContext]"}toString(){const e=this._getScope();if(e){const t=e.toString?.();if(t)return t}return e?"":"{NO SCOPE}"}}const aC=new lC,Va="__SHEETXL";let Io;const am={FormulaContext:Io,ScalarType:Me,IRange:B,FormulaError:He,Observable:YS};let xa;function ch(s){Io||(Io=aC,am.FormulaContext=Io),xa=globalThis[Va],globalThis[Va]=am,Io._setScope(s)}function Wa(){xa?(globalThis[Va]=xa,xa=void 0):delete globalThis[Va],Io&&Io._setScope(null)}var Or;(Or||(Or={})).Context={Workbook:"workbook",Sheet:"sheet",Ranges:"ranges",Range:"range",Calculation:"calculation"};let ja=class{constructor(e,t,n,r=null,o=!1){this._ct=Or.Context.Calculation,this._builtIn=!1,this._broadcast=!1,this._pj=null,this._json=e,this._n=e.name,this._d=new hC(e),this._ct=e.context??Or.Context.Calculation;const i=e.parameters;let l;this._pj=i,t||(console.log(`TypeFunction '${e.name}' was not provided a function implementation.`),t=()=>{}),this._fn=t.bind(this),this._cf=n??uC,this._builtIn=o,l=r?typeof r=="function"?r:()=>Promise.resolve(r):cC(e),this._descFn=l;const a=i?.length??0;let c=a===1||a===2;c&&(i[0].arrayDepth>0||i[0].range)&&(c=!1),c&&a===2&&(i[1].arrayDepth>0||i[1].range)&&(c=!1),this._broadcast=c}execute(...e){const t=this._pj,n=[],r=this._cf?.();ch(r);let o=!1,i=null;const l=t?.length??0;let a,c=this._broadcast;if(c){const u=lf(e[0]);if(l===1&&u)c=!1;else if(l===2){const d=lf(e[1]);u&&d&&(c=!1)}}try{for(let d=0;!o&&d<l;d++){const h=t[d];let f=h.scalar??null;f!==Me.Null&&f!=="*"||(f=null);let g=h.range??null;const m=h.rest??!1,p=h.optional??!1;let w=e[d];if(p&&w===null&&(w=void 0),w===void 0){if(p){n.push(void 0);continue}if(!p&&!m)throw d<=e.length?um.ARGS_TOO_FEW([h.name],this._n):um.PARAM_MISSING(h.name,this._n);if(d>=e.length){o=!0;continue}}const S=h.arrayDepth??0;let b=(h.range?2:0)+S;const v=h.rest??!1;if(v)for(;d<e.length&&!i;)w!==void 0&&(i=Rd(r,n,w,f,g,S,v,b)),w=e[++d];else c&&(g="l",b=2),i=Rd(r,n,w,f,g,S,v,b),o=!!i}if(i)throw i;for(;n.length>0&&n[n.length-1]===void 0;)n.length--;const u=this._fn;if(c){if(n.length===1){const d=n[0];let h=t[0].scalar;h!==Me.Null&&h!=="*"||(h=null),a=d.map(f=>{if(f instanceof He.Known)return f;let g=f;try{g=u(g),(Array.isArray(g)||g?.isIRange)&&(g=He.BuiltIn.Value)}catch(m){g=m}return g},{type:h})}if(n.length===2){const d=n[0];let h=t[0].scalar;h!==Me.Null&&h!=="*"||(h=null);const f=n[1];let g=t[1].scalar;g!==Me.Null&&g!=="*"||(g=null),a=d.broadcast(f,(m,p)=>{if(m instanceof He.Known)return m;if(p instanceof He.Known)return p;let w;try{w=u(m,p),(Array.isArray(w)||w?.isIRange)&&(w=He.BuiltIn.Value)}catch(S){w=S}return w},{type:h,otherType:g})}}else a=u(...n);a=rc(a,r)}catch(u){throw u}finally{Wa()}return a}getName(){return this._n}getDeclaration(){return this._d}async getDescriptor(e){if(this._desc)return this._desc;const t=await Promise.resolve(this._descFn(e));return this._desc=new gC(this,t),this._desc}isBuiltIn(){return this._builtIn}getContext(){const e=this._ct;if(e==="sheet"||e==="workbook"||e==="ranges"||e==="range"){const t=this._json;return t&&t.behavior&&t.behavior.default?"autoRun":"macro"}return"formula"}get[Symbol.toStringTag](){return"[TypedFunction]"}toString(){let e="";const t=this._pj;return t.length>0&&(e=t.map(n=>{let r=n.name;return n.rest&&(r="..."+r),n.optional&&(r+="?"),r+=": "+((o,i)=>{if(i){const l=P1.get(i)??"InvalidRange";return o?`${l}<${sf.get(o)??"InvalidScalar"}>`:l}return sf.get(o)??"InvalidScalar"})(n.scalar,n.range),r+="[]".repeat(n.arrayDepth),r}).join(", ")),`${this.getName()}(${e})`}get isIFunction(){return!0}get isITypedFunction(){return!0}};const cC=s=>async e=>{const t={};for(let n=0;n<s.parameters.length;n++)t[s.parameters[n].name]=V.camelToPrettyCase(s.parameters[n].description);return{summary:V.camelToPrettyCase(s.name),parameters:t,category:"User Defined"}},uC=()=>null;class Aw{constructor(e){this._s=e.scalar,this._r=e.range??null,this._d=e.arrayDepth??0}getScalarType(){return this._s}getRangeType(){return this._r}getArrayDepth(){return this._d}}class dC extends Aw{constructor(e){super(e),this._n=e.name,this._o=e.optional??!1,this._rest=e.rest??!1,this._e=e.enums?Object.freeze(e.enums):V.EmptyArray}getName(){return this._n}isOptional(){return this._o}isRest(){return this._rest}getEnums(){return this._e}}class cm extends Aw{constructor(e){super(e),this._a=e.async??!1,this._stream=e.stream??!1}isAsync(){return this._a}isStreaming(){return this._stream}}class hC{constructor(e){if(this._n=e.name,e.parameters){const t=e.parameters.length,n=new Array(t);for(let r=0;r<t;r++)n[r]=new dC(e.parameters[r]);this._p=Object.freeze(n)}else this._p=V.EmptyArray;e.returnType?this._r=new cm(e.returnType):this._r=new cm({scalar:null,arrayDepth:0,range:null})}getName(){return this._n}getParameters(){return this._p}getReturnType(){return this._r}}class gC{constructor(e,t){if(this._n=t.name,this._fn=e,this._s=t.summary??V.camelToPrettyCase(t.name),this._c=t.category??"Uncategorized",this._h=t.hidden??!1,t.links&&t.links.length>0){const n=t.links.length,r=new Array(n);for(let o=0;o<n;o++)r[o]=Object.freeze([t.links[o][0],t.links[o][1]]);this._l=Object.freeze(r)}else this._l=V.EmptyArray;if(t.parameters){for(const n in t.parameters)if(Object.prototype.hasOwnProperty.call(t.parameters,n)){const r=t.parameters[n].description,o=t.parameters[n].example,i=t.parameters[n].defaultValue,l={};r&&(l.description=r),o&&(l.example=o),i!==void 0&&(l.defaultValue=i),Object.freeze(l)}}}getName(){return this._n}getSummary(){return this._s}getCategory(){return this._c}isHidden(){return this._h}getLinks(){return this._l}getParameters(){return this._p}get[Symbol.toStringTag](){return"[Descriptor]"}toString(){const e=this._fn;return`${this.getSummary()}: ${e}`}}const Rd=(s,e,t,n,r,o,i,l)=>{if(t&&t.colStart!==void 0)if(r)t=s.getReference?.(t);else{const a=t.colStart,c=t.rowStart,u=t.colEnd;t=t.rowEnd!==c||a!==u?s.getReference?.(t):s.getValueAt(c,a)}if(l===0){let a=((c,u=null,d=!1)=>{let h=c;for(;Array.isArray(h);){if(h.length>1)return d?He.BuiltIn.Value:h;h=h[0]}if(h?.isIRange){if(h.size!==1)return d?He.BuiltIn.Value:h;h=h.getValueAt(0,0)}return u&&(h=nr(h,pn(h,!0),u)),h})(t,n,!0);return a instanceof He.Known?a:void e.push(a)}if(l===2)return Zs(s,e,t,n,r,Array.isArray(t));if(l===1||l===3){let a;const c=i?e:[];if(r){const u=Array.isArray(t);if(u){const d=t.length;for(let h=0;!a&&h<d;h++)a=Zs(s,c,t[h],n,r,u)}else a=Zs(s,c,t,n,r,u)}else if(l===3){let u=(d=>{let h=d,f=0;for(;Array.isArray(h);)f++,h=h[0];return h.isIRange&&(f+=2),f})(t);for(let d=u;d<2;d++)t=[t],u++;if(u===3){const d=t.length;for(let h=0;!a&&h<d;h++)a=Zs(s,c,t[h],n,r,!0)}else a=Zs(s,c,t,n,r,!0)}else a=X0(s,c,t,n,r,r!==null);return a?.isFormulaError?a:void(i||e.push(c))}{if(!Array.isArray(t)){if(n&&(t=nr(t,pn(t,!0),n,!1),t?.isFormulaError))return e.push(t),t;t=[t]}const a=t.length;for(let c=0;c<a;c++){const u=[],d=Rd(s,u,t[c],n,r,o,i,l-1);if(d?.isFormulaError)return d;u.length>0&&e.push(u)}}},um={PARAM_MISSING:(s,e)=>new He.NA(`Parameter ${s} is missing${e?` for ${e}`:""}.`),ARGS_TOO_FEW:(s,e)=>new He.Parse(`Argument type ${s.join(", ")} is missing${e?` for ${e}`:""}.`)};class Mw{constructor(e){this._emitter=null,this._readonly=null,this._closed=!1,this._options={...e};const t=this;this._transactions=this._options.transactions??new ir({transient:!0}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){t._emitter.notify("onCollectionChange")}}),this._emitter=new wn(this,this._transactions),this._readonly=e?.readonlyFunctions,this._initState()}getItems(e){const t=this._getState();if(!t)return V.EmptyArray;const n=e?.name?e.name.toUpperCase():null,r=e?.type?e.type:null;let o;e?.category&&e.category.toUpperCase(),e?.text&&e.text;const i=(a,c)=>(!n||c===n)&&(!r||a.getContext()===r)&&(o||(o=[]),void o.push(a)),l=this._readonly;return l&&l.forEach(i),t.itemsByKey.forEach(i),o??V.EmptyArray}getByName(e){if(!e)return null;const t=this._getState();if(!t)return null;if(!t)return V.EmptyArray;const n=e.toUpperCase(),r=this._readonly;if(!r||!r.size)return null;let o=r.get(n);return o||(o=t.itemsByKey.get(n),o||null)}getCount(){const e=this._getState();if(!e)return 0;let t=e.itemsByKey.size;return this._readonly&&(t+=this._readonly.size),t}validateName(e){return this._validateName(e)}_validateName(e,t=!1){if(this._closed)throw new Error(Kn)}add(e){if(this._closed)throw new Error(Kn);if(!e)throw new Error("Item must be specified.");let t;if(e.isIFunction){const o=e,i=e._json;t=new ja(i,o._fn,()=>this._options.context,o._desc)}else{const o=e;t=new ja(o.declaration,o.execute,()=>this._options.context,o.descriptor)}const n=this._getState(),r=t.getName().toUpperCase();return n.itemsByKey.set(r,t),t}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(Kn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_updateState(e,t="Update",n){if(!e)return;const r=this._beginCommit(t);try{r.updateState(this,e),r.commit(n)}catch(o){throw r.rollback(),o}}_initState(){this._updateState(e=>({...e,itemsByKey:new Map}),"Initialize",{forceAmend:!0})}addListeners(e,t){return this._emitter.addListeners(e,t)}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}get isFunctionCollection(){return!0}}class Tw extends Lo{constructor(e){super(e),this._status=Yt.Status.Off,this._statusTransition=null,this._emitter=new wn(this)}_getContext(){return this._context}_getScope(){return this._scope}start(){return this._statusTransition||(this._statusTransition=(async()=>{if(this._status===Yt.Status.Off)try{this._status=Yt.Status.Starting,this._emitter.notify("onStatusChange"),this._emitter.notify("onStarting");const e=this,t=this._options,n=a=>e.getFunctions().getByName(a)??t?.getFunction?.(a),r=new nC({...t,getFunction:n});this._context=r;const o=await r._initialize(),i=o.builtInFunctions;this._functions=new Mw({transactions:this._transactions,context:r,readonlyFunctions:i});const l=await ao(()=>import("./B6SR0BPXF3_HR9Gp-Ce3Ivkr_.js"),__vite__mapDeps([8,2,3,4,1,5,6,7]),import.meta.url);this._formulaParser=new l.FormulaParser,this._scope=o.calcScope,this._status=Yt.Status.Ready,this._emitter.notify("onStatusChange"),this._emitter.notify("onReady")}catch(e){throw this._status=Yt.Status.Off,this._emitter.notify("onError",e),this._emitter.notify("onStatusChange"),e}finally{this._statusTransition=null}})()),this._statusTransition}_createGraph(e){const t=this._options;return new ah({...t,...e,getFormulaParser:()=>this._formulaParser,calculation:this})}async stop(){this._status===Yt.Status.Ready&&(this._status=Yt.Status.Stopping,this._emitter.notify("onStatusChange"),this._emitter.notify("onStopping"),this._status=Yt.Status.Off,this._emitter.notify("onStatusChange"),this._emitter.notify("onStop"))}getStatus(){return this._status}getFunctions(){return this._checkReady(),this._functions}getRuntime(){return this._checkReady(),this._runtime}_checkReady(){if(this._status!==Yt.Status.Ready)throw new Error(this._statusMessage())}_statusMessage(){switch(this._status){case Yt.Status.Off:return"Calculation is off";case Yt.Status.Starting:return"Calculation is starting";case Yt.Status.Ready:return"Calculation is ready";default:return"Unknown calculation status"}}}var dm,Fl,Id,Ol,an;(Fl=dm||(dm={})).NumberFilterOperatorType={Equal:"equal",GreaterThan:"greaterThan",GreaterThanOrEqual:"greaterThanOrEqual",LessThan:"lessThan",LessThanOrEqual:"lessThanOrEqual",NotEqual:"notEqual"},Fl.Type={Color:"color",Custom:"custom",Dynamic:"dynamic",Items:"items",Icon:"icon",Top10:"top10"},Fl.DynamicType={AboveAverage:"aboveAverage",BelowAverage:"belowAverage",LastMonth:"lastMonth",LastQuarter:"lastQuarter",LastWeek:"lastWeek",LastYear:"lastYear",M1:"M1",M2:"M2",M3:"M3",M4:"M4",M5:"M5",M6:"M6",M7:"M7",M8:"M8",M9:"M9",M10:"M10",M11:"M11",M12:"M12",NextMonth:"nextMonth",NextQuarter:"nextQuarter",NextWeek:"nextWeek",Null:"null",Q1:"Q1",Q2:"Q2",Q3:"Q3",Q4:"Q4",ThisMonth:"thisMonth",ThisQuarter:"thisQuarter",ThisWeek:"thisWeek",Today:"today",Tomorrow:"tomorrow",YearToDate:"yearToDate",Yesterday:"yesterday"},Fl.DateItemGroupingType={Day:"day",Hour:"hour",Minute:"minute",Month:"month",Second:"Second",Year:"year"},(Ol=Id||(Id={})).Type={AboveAverage:"aboveAverage",BeginsWith:"beginsWith",CellIs:"cellIs",ColorScale:"colorScale",ContainsBlanks:"containsBlanks",ContainsErrors:"containsErrors",ContainsText:"containsText",DataBar:"dataBar",DuplicateValues:"duplicateValues",EndsWith:"endsWith",Expression:"expression",IconSet:"iconSet",NotContainsBlanks:"notContainsBlanks",NotContainsErrors:"notContainsErrors",NotContainsText:"notContainsText",TimePeriod:"timePeriod",Top10:"top10",UniqueValues:"uniqueValues"},Ol.OperatorType={BeginsWith:"beginsWith",Between:"between",ContainsText:"containsText",EndsWith:"endsWith",Equal:"equal",GreaterThan:"greaterThan",GreaterThanOrEqual:"greaterThanOrEqual",LessThan:"lessThan",LessThanOrEqual:"lessThanOrEqual",NotBetween:"notBetween",NotContains:"notContains",NotEqual:"notEqual"},Ol.TimePeriod={Last7Days:"last7Days",LastMonth:"lastMonth",LastWeek:"lastWeek",NextMonth:"nextMonth",NextWeek:"nextWeek",ThisMonth:"thisMonth",ThisWeek:"thisWeek",Today:"today",Tomorrow:"tomorrow",Yesterday:"yesterday"},Ol.ConditionalBoundsType={Formula:"formula",Max:"max",Min:"min",Num:"num",Percent:"percent",Percentile:"percentile"},(an||(an={})).HeaderTextStyle={A1:"a1",Zero:"zero",One:"one"};class fC{constructor(e,t,n,r){this._mergedReading=[],this._colsReading=[],this._rowsReading=[],this._styles=e,this._topLeft=r??{rowIndex:0,colIndex:0},this._sheet=new Nd({styles:this._styles,date1904:t,container:{getName:()=>n,getIndex:()=>1}}),this._cellUpdater=this._sheet.getEntireRange().startIncrementalUpdates()}applyCSSStyle(e,t){let n=!1;e.style||(e.style={},n=!0);let r=e.style,o={...t};if(t.msoIgnore){const d=t.msoIgnore.split(",");let h=Object.keys(o);for(let f=0;f<h.length;f++){const g=h[f];d.includes(g)&&delete o[g]}}const i=_a(o.fontFamily);r.font={},i&&(r.font.family=i.family,r.font.fallbacks=i.fallbacks,r.font.size=i.size),r.font.size=o.fontSize,r.font.weight=o.fontWeight,r.font.style=o.fontStyle,r.font.fill=o.color;const l=(d=>{if(!d)return lb;let h=ke.UnderlineStyle.None,f=!1;return(d=d.toLowerCase()).includes("underline")&&(h=ke.UnderlineStyle.Single),(d.includes("line-through")||d.includes("linethrough"))&&(f=!0),{underline:h,strike:f}})(o.textDecoration);r.font.underline=l.underline,r.font.strike=l.strike,o.textUnderlineStyle&&(r.font.underline=dw(o.textUnderlineStyle)),r.alignment={},o?.textAlign&&(r.alignment.horizontal=(d=>{const h=V.textToKey(d);return Yr.get(h)||null})(o.textAlign)),o?.textAlign&&!r.alignment.horizontal&&o?.textAlign!=="general"&&(o.textAlign==="center-across"?r.alignment.horizontal=oe.HorizontalAlignment.CenterContinuous:o.textAlign==="fill"?r.alignment.horizontal=oe.HorizontalAlignment.Fill:o.textAlign==="121"||o.textAlign==="010"?(r.alignment.horizontal=oe.HorizontalAlignment.Distributed,r.alignment.justifyLastLine=o.textAlign==="121"):console.warn("unknown text-align",o.textAlign)),o.verticalAlign&&(o.verticalAlign.toLowerCase()==="super"?r.font.verticalAlign=ke.VerticalAlignment.Super:o.verticalAlign.toLowerCase()==="sup"?r.font.verticalAlign=ke.VerticalAlignment.Sub:r.alignment.vertical=(d=>{const h=V.textToKey(d);return Ar.get(h)||null})(o.verticalAlign),r.alignment.vertical||(o.verticalAlign==="121"?r.alignment.vertical=oe.VerticalAlignment.Distributed:console.warn("unknown vertical-align",o.verticalAlign))),o.msoCharIndentCount&&(r.alignment.indent=o.msoCharIndentCount),o.whiteSpace&&(r.alignment.overflow=o.whiteSpace==="no-wrap"||o.whiteSpace==="nowrap"?oe.Overflow.Visible:oe.Overflow.Wrap),o.msoTextControl==="shrinktofit"&&(r.alignment.overflow=oe.Overflow.Shrink);let a=null;if(o.background?a=o.background:o.backgroundColor&&(a=o.backgroundColor),a&&(r.fill={color:a}),o.msoPattern){let d=$b(o.msoPattern);d&&(d.patternType===Pe.BuiltInSheetPattern.Solid?r.fill={color:d.foreground}:d.patternType!==Pe.BuiltInSheetPattern.None&&(a&&(d.background=a),r.fill=d))}o.msoRotate!==void 0&&(r.alignment.rotation=(d=>{let h=parseFloat(d);return isNaN(h)||(h%=360,h>0?h=360-h:h<0&&(h*=-1)),h})(o.msoRotate));const c=(d,h)=>{d&&(r.border||(r.border={}),r.border[d]=h)};o.border&&o.border!=="none"&&(c("top",o.border),c("left",o.border),c("right",o.border),c("bottom",o.border)),o.borderTop&&c("top",o.borderTop),o.borderLeft&&c("left",o.borderLeft),o.borderRight&&c("right",o.borderRight),o.borderBottom&&c("bottom",o.borderBottom),o.msoDiagonalUp&&c("diagonalUp",o.msoDiagonalUp),o.msoDiagonalDown&&c("diagonalDown",o.msoDiagonalDown);let u=r.numberFormat;o.msoNumberFormat&&(u=(d=>{let h=d.replace(/(\\[0-9]{4})/g,f=>String.fromCharCode(parseInt(f.replace(/\\/g,""),16)));return h=h.replace(/(\\.{1})/g,f=>f.substring(f.length-1,f.length)),h.includes("\\")&&(h=h.replace(/(\\.{1})/g,f=>f.substring(f.length-1,f.length))),h=h.replace(/^"(.*)"$/,"$1"),h})(o.msoNumberFormat),u.includes("\\")?u=null:u==="Fixed"?u=Vt.Styles.lookupStyle(r.numberFormat).formatType===Vt.Type.Number?null:Vt.Type.Number:u==="Percent"&&(u=Vt.Styles.lookupStyle(r.numberFormat).formatType===Vt.Type.Percentage?null:Vt.Type.Percentage)),u&&(r.numberFormat=u),e.style=this._styles.normalize(r),n&&Object.keys(e.style).length===0&&delete e.style}onCell(e,t,n,r,o){const i=r(o);let l={value:t!==void 0?t:n??""};if(typeof l.value=="string"&&l.value.length===0&&(l.value=void 0),i&&this.applyCSSStyle(l,i),o?.tagName.toUpperCase()==="TD"){let a=l.style,c=a?.font??{};(o.querySelectorAll("s").length>0||o.querySelectorAll("strike").length>0)&&(c.strike=!0),o.querySelectorAll("sub").length>0&&(c.verticalAlign=ke.VerticalAlignment.Sub),o.querySelectorAll("sup").length>0&&(c.verticalAlign=ke.VerticalAlignment.Super),(o.querySelectorAll("b").length>0||o.querySelectorAll("strong").length>0)&&(c.weight=700),o.querySelectorAll("i").length>0&&(c.style=ke.Style.Italic),o.querySelectorAll("u").length>0&&(c.underline=ke.UnderlineStyle.Single),Object.keys(c).length>0&&(a||(a={},l.style=a),a.font||(a.font=c));const u=o.querySelectorAll("a");if(u.length>0){const d=u[0].getAttribute("href");d&&(l.hyperlink=d)}}if(!J.isSingleCell(e)){const a={rowStart:this._topLeft.rowIndex+e.rowStart,colStart:this._topLeft.colIndex+e.colStart,rowEnd:this._topLeft.rowIndex+e.rowEnd,colEnd:this._topLeft.colIndex+e.colEnd};this._mergedReading.push(a)}if((l.value!==void 0||l.style||!(Object.keys(l).length<=1))&&(this._cellUpdater.pushAt(this._topLeft.rowIndex+e.rowStart,this._topLeft.colIndex+e.colStart,l),!J.isSingleCell(e)&&i.msoIgnore)){if(i.msoIgnore.includes("colspan")){const a={};i&&this.applyCSSStyle(a,i);const c=e.colEnd-e.colStart;for(let u=1;u<=c;u++)this._cellUpdater.pushAt(this._topLeft.rowIndex+e.rowStart,this._topLeft.colIndex+e.colStart+u,a);e={...e,colEnd:e.colStart}}i.msoIgnore.includes("rowspan")&&(e={...e,rowEnd:e.rowStart})}}onNoTable(e,t,n){this.onCell({rowStart:this._topLeft.rowIndex,colStart:this._topLeft.colIndex,rowEnd:this._topLeft.rowIndex,colEnd:this._topLeft.colIndex},e,null,t,n)}onRowStart(e,t,n,r){const o=n(r);if(o.msoHeightSource!=="userset")return;let i=r.getAttribute("height")??o.height,l=null;if(i&&(l=ys(i,this._styles.getNormal().getFont().getSize(),"px")),l===null)for(let a=0;a<r.cells.length;a++){const c=r.cells[a],u=c.getAttribute("height")??n(c).height;let d=ys(u,this._styles.getNormal().getFont().getSize(),"px");d!==null&&(l=Math.max(d,l??0))}l!==null&&this._rowsReading.push({address:{min:this._topLeft.rowIndex+e,max:this._topLeft.rowIndex+e+t-1},update:{size:l*ke.getDeviceScale()}})}onColumn(e,t,n,r){const o=n(r);if(o.msoWidthSource!=="userset")return;let i=r.getAttribute("width")??o.width,l=null;i&&(l=ys(i,this._styles.getNormal().getFont().getSize(),"px")),l!==null&&this._colsReading.push({address:{min:this._topLeft.colIndex+e,max:this._topLeft.colIndex+e+t-1},update:{size:l*ke.getDeviceScale()}})}onDone(){this._colsReading.length>0&&this._sheet.getColumnHeaders().updateHeaderPairs(this._colsReading),this._rowsReading.length>0&&this._sheet.getRowHeaders().updateHeaderPairs(this._rowsReading),this._sheet.doBatch(()=>{this._cellUpdater.apply()}),this._mergedReading.length>0&&this._sheet.getRanges(this._mergedReading).merge()}sheet(){return this._sheet}}let hm=!1;class mC{constructor(e,t){this._mapStylesByName=new Map,this._arrStyleNames=[],this._mapStylesByName=e,this._arrStyleNames=t}setNode(e){this._node=e}addStyle(e,t){t!=null&&(this._node?.styles||(this._node.styles=new Map),this._node.styles.set(e,t))}addAttribute(e,t){t!=null&&(this._node?.attributes||(this._node.attributes=new Map),this._node.attributes.set(e,t),e.toLowerCase()==="rowspan"&&parseInt(t)>1&&(this._node.rowspan=parseInt(t)),e.toLowerCase()==="colspan"&&parseInt(t)>1&&(this._node.colspan=parseInt(t)))}addSharedStyle(e,t){let n=this._mapStylesByName.get(e);n?n={...t}:(this._arrStyleNames.push(e),n=t),this._mapStylesByName.set(e,n)}setPlainText(e){this._node.plainText=e}setHTMLText(e){this._node.htmlText=e.replace(/(?:\r\n|\r|\n)/g,"<br>")}}const gm=s=>{const e={};if(!s)return e;s.endsWith(";")||(s+=";");const t=new RegExp(';(?=([^"]*"[^"]*")*[^"]*$)',"gsm");let n,r=0;for(;(n=t.exec(s))!==null;){try{let o=s.substring(r,n.index).trim();const i=new RegExp(':(?=([^"]*"[^"]*")*[^"]*$)',"gsm");let l,a,c;for(;(c=i.exec(o))!==null;)l=unescape(o.substring(0,c.index)).trim(),a=unescape(o.substring(c.index+1,o.length)).trim();a!==null&&a!=="null"&&(l&&(l=d0(l)),e[l]=a)}catch(o){console.warn(o)}r=n.index+1}return e},Dl=(s,e)=>{const t=[];if(!s)return t;const n=s.children;for(let r=0;r<n.length;r++){const o=n.item(r);if(o.nodeType===1){const i=o.tagName.toUpperCase();e.includes(i)&&t.push(o)}}return t},pC=(s,e,t)=>{try{let n=null,r=null;const o=a=>((c,u)=>{if(!c)return{};let d={},h=u.get(c.localName);h&&(d=Object.assign(d,h));const f=c.getAttribute("class");if(f){const m=u.get("."+f);m&&(d=Object.assign(d,m))}const g=c.getAttribute("style");if(g){const m=gm(g);m&&(d=Object.assign(d,m))}return c.getAttribute("align")&&!d.textAlign&&(d.textAlign=c.getAttribute("align")),d})(a,r);if(s)try{n=[];const a="P, H1, H2, H3, H4, H5, H6, PRE",c=s.querySelector("parsererror");if(c)return console.warn("error",c),!1;const u=s.querySelectorAll("html"),d=u[u.length-1];r=(p=>{const w=p.querySelectorAll("style"),S=new Map;if(w.length<=0)return S;for(let b=0;b<w.length;b++){const v=w[b].childNodes;for(let y=0;y<v.length;y++)if(v[y].nodeType===Node.TEXT_NODE){const _=new RegExp("<!--(.*)-->","gs");let C=v[y].textContent;const E=_.exec(v[y].textContent);if(E&&E.length>1&&(C=E[1]),C=C.replace(/^\s/,""),C?.startsWith("table")){const x=new RegExp("{(.*?)}","gs");let R,I=0;for(;(R=x.exec(C))!==null;)try{const A=C.substring(I,R.index),M=gm(R[1]);S.set(A.trim(),M),I=R.index+R[0].length}catch(A){console.warn(A)}return S}}}return S})(d);const h=d.querySelectorAll("body"),f=h[h.length-1];let g=f.querySelectorAll("table")[0],m=!1;if(!g){let p=f.querySelectorAll("span");g=p[0],m=p.length>1}if(g||(g=Dl(f,a)[0]),g||(g=Dl(s,a)[0]),g?.nodeName.toUpperCase()==="TABLE"){t.onStart?.(r);const p=g;t.onTableStart?.(o,p);const w=Dl(p,"COLGROUP");for(let v=0;w&&v<w.length;v++){const y=Dl(w[v],"COL");let _=0;for(let C=0;C<y.length;C++){const E=y[C],x=parseFloat(E.getAttribute("span")),R=isNaN(x)?1:x;t.onColumn?.(_,R,o,E),_+=R}}const S=p.rows;let b=0;for(let v=0;v<S.length;v++){const y=S[v],_=parseFloat(y.getAttribute("span")),C=isNaN(_)?1:_;t.onRowStart?.(b,C,o,y);const E=[];n.push(E);const x=y.cells;for(let R=0;R<x.length;R++){let I=x[R],A=!1;for(let M=0;!A&&M<I.childNodes.length;M++)if(I.childNodes[M].nodeType===8){const k=I.childNodes[M].textContent;if(k!=="[if gte vml 1]"&&k!=="[if !vml]"&&k==="[endif]"){const F=I.childNodes[M+1];F?.querySelectorAll&&F.querySelectorAll("table, td").length===2&&(I=F?.querySelectorAll("table, td")[1],A=!0)}}E.push({htmlValue:I.textContent?.replace(/^"|"$/gi,""),element:I})}b+=C,t.onRowDow?.(b,C,o,y)}t.onTableDone?.(o,p)}else{if(g?.nodeName.toUpperCase()==="SPAN"){const p=e?e[0]?.[0]:null,w=m&&p?p:g.textContent.replace(/^"|"$/gi,"");return t.onStart?.(r),t.onCell({colStart:0,colEnd:0,rowStart:0,rowEnd:0},e?e[0]?.[0]:null,w,o,g),t.onDone?.(),!0}if(g?.textContent){const p=g.textContent.replace(/^"|"$/gi,"");return t.onStart?.(r),t.onNoTable?.(p,o,g),t.onDone?.(),!0}}}catch(a){console.warn(a),n=null}!n||n.length!==0&&(n.length!==1||n[0]!==null&&n[0].length!==0)||(n=null);const i=e&&(e.length===0||e.length===1&&(e[0]===null||e[0].length===0));n&&i&&(e=null);const l=a=>{const c=new Set;let u=1,d=1;for(let h=0;h<Math.max(e?e.length:0,n?n.length:0);h++){let f=0,g=0,m=n&&n[h]?n[h].length:e[h]?e[h].length:0;for(;g<m;){const p=h+"-"+f;if(!c.has(p)){u=Math.max(u,f+1),d=Math.max(d,h+1);let w=null;const S=n?n[h]?.[g]?.element:void 0;if(S&&(S.getAttribute("rowspan")||S.getAttribute("colspan"))){const b=parseInt(S.getAttribute("colspan"))||1,v=parseInt(S.getAttribute("rowspan"))||1;u=Math.max(u,f+b),d=Math.max(d,h+v),w={rowStart:h,colStart:f,rowEnd:h+Math.max(0,v-1),colEnd:f+Math.max(0,b-1)};for(let y=h;y<h+v;y++)for(let _=f;_<f+b;_++)y===h&&_===f||c.add(y+"-"+_)}else w={rowStart:h,colStart:f,rowEnd:h,colEnd:f};a(w,e?e[h]?.[f]:void 0,n?n[h]?.[g]?.htmlValue:null,o,S||null),g++}f++}}};if(n&&e){let a=0,c=0;l(u=>{a=Math.max(a,u.colEnd+1),c=Math.max(c,u.rowEnd+1)}),e&&n&&(e.length!==c||e[0].length!==a)&&(console.warn("mismatched mimeTypes",e,n),e=null)}return l(t.onCell.bind(t)),t.onDone?.(),!i||n!==null}catch(n){throw console.warn(n),n}};class wC{constructor(e){if(!e)throw new sr("snapshot is required.");this._snapshot=e}getItemType(){return"range"}getItem(){return this._snapshot}editMode(){return this._snapshot?.getMarkOptions().editMode??null}isCut(){return this._snapshot?.getMarkOptions().isCut??!1}getName(){return this._snapshot.getName()}toText(){return this._snapshot.toText()}toHtml(){return this._snapshot.toHtml()}toImage(){return this._snapshot.toImage()}get isClipboardItem(){return!0}}class SC{constructor(e,t,n,r){if(this._parsed=void 0,!e)throw new sr("nativeItems are required.");this._native=e,this._markOptions=Object.freeze(t??{}),this._styles=n,this._isDate1904=r}getItemType(){return"range"}isCut(){return!1}toText(){return this._native?.text}toHtml(){return this._native?.html?.documentElement.outerHTML||null}toImage(){return this._native?.image}getItem(){const e=this._parsed;if(e===void 0)throw new Error("Must call 'parse()' before getItem().");if(e===null)return null;if(this._snapshot)return this._snapshot;const t=this;return this._snapshot={copyTo:(n,r)=>e.copyTo(n,{...t._markOptions,...r}),getMarkOptions:()=>t._markOptions,getName:()=>e?.getName()??"Clipboard Data",getCoords:()=>e?.getCoords?.()??null,toText:()=>t.toText(),toHtml:()=>t.toHtml(),toImage:()=>t.toImage(),getSource:()=>e?.getSource?.()??null,isISnapshot:!0},this._snapshot}async parse(){let e,t=this._native?.text,n=this._native.html;if(n===null&&t&&t.includes("<table"))try{const r=new DOMParser().parseFromString(t,Ip.html),o=r.querySelector("parsererror");if(o)throw new Error("Unable to parse: "+o);n=r,t=null}catch{console.warn("Discovered text as html table but could could not parse.")}try{const r=new fC(this._styles,this._isDate1904,n?"HTML":"Text"),o=await Promise.resolve(t?((l,a="	")=>new Promise((c,u)=>{ao(()=>import("./paGhkNtzUuyqCkUg-DiP-oemB.js"),__vite__mapDeps([9,1,2,3,4,5,6,7]),import.meta.url).then(d=>d.p).then(d=>{try{const h=d.parse(l,{delimiter:a}).data;h.length>1&&(h[h.length-1].length===0||h[h.length-1].length===1&&h[h.length-1][0].length===0)&&h.pop(),c(h)}catch(h){console.warn(h),u(h)}},d=>{u(d)})}))(t):[[]]);let i;if(pC(n,o,r)?(e=r.sheet(),i=e.getUsedRange()):n=null,i)return this._parsed={async copyTo(l,a){return(await l.copyFrom(i,a))?.getCoords()??null},getCoords:()=>i.getCoords(),getSource:()=>e,getName:()=>e.getName()},!0}catch(r){throw r}if(!t&&!n&&this._native.image){const r=this;return this._parsed={async copyTo(o,i){const l=o.getSheet(),a=await l.getMovables().addImage({buffer:r._native.image.arrayBuffer()},{type:"picture",description:"Copy Image from Clipboard"});return l.getView().selectMovables([a]),null},getName:()=>"Image"},!0}return!1}get isClipboardItem(){return!0}}var ft;(ft||(ft={})).Visibility={Visible:"visible",Hidden:"hidden",VeryHidden:"veryHidden"};var lo;let _C=(lo=class extends lc{constructor(e){if(super(e),!e.content)throw new Error("Content type is required");this._content=e.content,this._uuid=V.uuidV4(),this._optionsMovable=e;const t=this;this._optionsMovable.setContainerZIndexCallback?.(()=>{t._processZIndex()}),this._optionsMovable.setContainerSelectionCallback?.((r,o)=>{t._processContainerSelect(r,o)}),e.json&&this._fromJSON(e.json);const n=this._content.addListeners({onDelete:()=>{t._options.deleteFromContainer&&t._options.deleteFromContainer?.()}},{transactional:!0});this._updateState({contentListenerRemove:n},null,[])}getUUID(){return this._uuid}getContent(){return this._content}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._getEmitter().notify("onBoundsChange"),this._getEmitter().notify("onAnyChange")}_processZIndex(){this._getEmitter().notify("onAnyChange")}_processContainerSelect(e,t){this._getEmitter().notify("onSelectionChange")}isSelected(){return this._optionsMovable.isSelected?.()??!1}async scrollIntoView(e){return this._optionsMovable.scrollIntoView?.(e)??!1}async select(e){if(await this._optionsMovable.select?.(e)===!1)return!1;if(e?.autoFocus!==!1){const t=await this._getEmitter().notify("onRequestFocus",{async:!0});if(!t)return!1;for(let n=0;n<t.length;n++)if(t[n]===!1)return!1}return!0}unselect(){const e=this._optionsMovable.isSelected?.()??!1;return this._optionsMovable.unselect?.(),e}_clone(){const e=this.isSelected(),t=this.getZIndex(),n=this._optionsMovable.getMaxBounds,r=this._options.maxRangeCoords,o=this.getContent(),i={beginPersistResource:this._optionsMovable.beginPersistResource,getBoundsAtCoords:this._optionsMovable.getBoundsAtCoords,getCoordsAtBounds:this._optionsMovable.getCoordsAtBounds,isSelected:()=>e,getZIndex:()=>t,getMaxBounds:n,maxRangeCoords:r,transactions:new ir({transient:!0}),json:this.toJSON(),initialAnchor:this.getAnchorCoords(),content:o},l=new lo(i),a=this._getState();return l._updateState({...a}),l}getSnapshot(e,t){const n=this._optionsMovable.getCoordsAtBounds(e),r=this._getState().offsets;let o=this.getAnchorCoords();if((r.br.x>0||r.br.y>0)&&(o={...o},o.colEnd-=r.br.x>0?1:0,o.rowEnd-=r.br.y>0?1:0),!J.isRangeWithinRange(o,n))return null;const i=this,l=i._clone(),a=Object.freeze({...t});let c=!1;return{async copyTo(u,d){const h={...a,...d};return await l._doCopy(u,h),h.isCut&&!c&&(i.delete(),c=!0),u.bounds},getCoords:()=>l.getBounds(),getSource:()=>l,getName:()=>l.getName(),getMarkOptions:()=>a,toText:()=>l._toText(),toHtml:()=>l._toHtml(),toImage:()=>l._toImage(),isISnapshot:!0}}async _doCopy(e,t){const n=this._optionsMovable.beginPersistResource(),r=this.toJSON(n.toResourceId.bind(n));r.content.json.name=`${this.getName()} (Copy)`;const o=r.content.json;delete r.content;const i=e.movables;if(!i)throw new Error("Movables is required");const l=e.bounds??this.getBounds();try{await i.add({...r,...t,fromResourceId:n.fromResourceId.bind(n),bounds:l,type:this.getContent().getType(),json:o,description:"Copy Movable"})}finally{n.endPersist()}}_toText(){return this.getContent().toText?.()}_toHtml(){return this.getContent().toHtml?.()}_toImage(){return this.getContent().toImage?.()}setName(e){return this._updateState({name:e},{description:"Set Movable Name"},["onNameChange"]),this}getName(){return this.isClosed()?null:this._getState()?.name}setDescription(e){return this._updateState({description:e},{description:"Set Movable Description"}),this}getDescription(){return this.isClosed()?null:this._getState()?.description}setHidden(e=!1){return this._updateState({hidden:e},{description:"Set Movable Visibility"}),this}isHidden(){return this._getState()?.hidden??!1}setLockAspectRatio(e){return this._updateState({lockAspectRatio:e},{description:"Set Lock Aspect Ratio"}),this}isLockAspectRatio(){return this._getState()?.lockAspectRatio??this._optionsMovable.defaultLockAspectRatio??!1}setRotation(e=0){return this._updateState({rotation:e},{description:"Set Movable Rotation"}),this}getRotation(){return this._getState()?.rotation??0}moveToBack(){return this._optionsMovable.moveToBackOnContainer?.(),this}moveBackward(){return this._optionsMovable.moveBackwardOnContainer?.(),this}moveToFront(){return this._optionsMovable.moveToFrontOnContainer?.(),this}moveForward(){return this._optionsMovable.moveForwardOnContainer?.(),this}getZIndex(){return this._optionsMovable.getZIndex?.()??0}setBounds(e,t){if(!e)return this;let n={...this.getBounds(),...e};if(this._optionsMovable.getMaxBounds&&(n={x:Math.max(n.x,this._optionsMovable.getMaxBounds().x),y:Math.max(n.y,this._optionsMovable.getMaxBounds().y),width:Math.min(n.width,this._optionsMovable.getMaxBounds().width),height:Math.min(n.height,this._optionsMovable.getMaxBounds().height)}),n.width<0||n.height<0)throw new Nt;const r=this._updateMovableLocation({bounds:n,anchorType:Ut.Type.Absolute}),o=this._beginCommit(t?.description??"Set Movable Bounds");return this._updateState({offsets:r.offsets,anchor:r.anchor},{description:"Update Movable Bounds"}),this._options.setContainerCoords(r.anchor),this._invalidateBounds(),o.commit(),this}_updateMovableLocation(e){let t=e.offsets??{tl:{x:0,y:0},br:{x:0,y:0}},n=e.anchor??this.getAnchorCoords(),r=e.anchorType??this.getAnchorType();const o=e.bounds??this.getBounds();if(o){if(r===Ut.Type.Absolute){n=this._optionsMovable.getCoordsAtBounds(o);const i=this._optionsMovable.getBoundsAtCoords(n);t={...t,tl:{x:o.x-i.x,y:o.y-i.y}}}if(r===Ut.Type.Absolute||r===Ut.Type.OneCell){const i=this._optionsMovable.getBoundsAtCoords({rowStart:n.rowStart,colStart:n.colStart,colEnd:n.colStart,rowEnd:n.rowStart}),l=this._optionsMovable.getCoordsAtBounds({x:i.x,y:i.y,width:o.width+Math.min(i.width,t.tl.x),height:o.height+Math.min(i.height,t.tl.y)});n={...n,colEnd:l.colEnd,rowEnd:l.rowEnd};const a=this._optionsMovable.getBoundsAtCoords({colStart:n.colEnd,rowStart:n.rowEnd,colEnd:n.colEnd,rowEnd:n.rowEnd}),c=o.width-(a.x-i.x-Math.min(t?.tl.x??0,i.width)),u=o.height-(a.y-i.y-Math.min(t?.tl.y??0,i.height));t={...t,br:{x:c,y:u}}}return t!==e.offsets&&(t.br.y<=0&&(t.br={...t.br,y:0},n.rowEnd--),t.br.x<=0&&(t.br={...t.br,x:0},n.colEnd--)),{anchor:n,offsets:t}}}_calcAbsoluteBounds(e,t={tl:{x:0,y:0},br:{x:0,y:0}}){if(!e)return null;const n=this._optionsMovable.getBoundsAtCoords({rowStart:e.rowStart,colStart:e.colStart,colEnd:e.colStart,rowEnd:e.rowStart});let r=t.br.x?0:1,o=t.br.y?0:1;const i=this._optionsMovable.getBoundsAtCoords({colStart:e.colEnd+r,rowStart:e.rowEnd+o,colEnd:e.colEnd+r,rowEnd:e.rowEnd+o}),l=Math.min(n.x+(t?.tl.x??0),n.x+n.width),a=Math.min(n.y+(t?.tl.y??0),n.y+n.height);return{x:l,y:a,width:Math.min(i.x+(t?.br.x??0),i.x+i.width)-l,height:Math.min(i.y+(t?.br.y??0),i.y+i.height)-a}}getBounds(){return this._getState()?.bounds}setAnchorType(e){return V.validEnumValue(Ut.Type,e),this._updateState({anchorType:e},{description:"Set Movable Resize Behavior"},["onAnchorTypeChange"]),this}_processContainerShift(e){const t=this.getAnchorType(),n=this._getState()?.offsets;let r=n,o=!1;const i=e.before,l=e.orientation===B.Orientation.Column,a=e.intersect,c=e.amount;let u=e.after;if(t!==Ut.Type.Absolute){let f=l?a.colStart:a.rowStart,g=l?i.colStart:i.rowStart;t===Ut.Type.TwoCell&&(g=l?i.colEnd:i.rowEnd),o=f<=g}if(o&&(t!==Ut.Type.OneCell||u)||(u=i),o&&u&&c<0&&(l?(a.colStart<=i.colStart&&a.colEnd>=i.colStart&&(r={...r,tl:{...r.tl,x:0}}),r.br.x>0&&a.colStart<=i.colEnd&&a.colEnd>=i.colEnd&&(r={...r,br:{...r.br,x:0}},u={...u,colEnd:u.colEnd+1})):(a.rowStart<=i.rowStart&&a.rowEnd>=i.rowStart&&(r={...r,tl:{...r.tl,y:0}}),r.br.y>0&&a.rowStart<=i.rowEnd&&a.rowEnd>=i.rowEnd&&(r={...r,br:{...r.br,y:0}},u={...u,rowEnd:u.rowEnd+1}))),u!==null){const{offsets:f,anchor:g}=this._updateMovableLocation({anchor:u,offsets:r});r=f,u=g}let d=null;const h=this._beginCommit("Shifting Movable Bounds");try{if(n!==r||!J.isEqualRanges(i,u)){const f={offsets:r,anchor:u};this._updateState(f)}this._invalidateBounds(),d=super._processContainerShift({...e,after:u}),h.commit()}catch(f){throw h.rollback(),f}return d}_invalidateBounds(){const e=this.getAnchorCoords();if(e===null)return null;const t=this._getState()?.offsets,n=this._calcAbsoluteBounds(e,t);this._updateState({bounds:n},null,["onBoundsChange"])}_processContainerDelete(){super._processContainerDelete(),this._getState().contentListenerRemove?.(),this.getContent().delete()}_processContainerLayout(){const e=this.getAnchorCoords(),t=this._getState()?.offsets,{offsets:n,anchor:r}=this._updateMovableLocation({anchor:e,offsets:t}),o=this._beginCommit("Updating Movable Bounds");try{if(t!==n||e!==r){const i={offsets:n,anchor:r};this._updateState(i)}this._invalidateBounds(),super._processContainerLayout(),o.commit()}catch(i){throw o.rollback(),i}}_processAnchorCoords(){super._processAnchorCoords()}_fromJSON(e){const t={tl:{x:0,y:0},br:{x:0,y:0}},n={...J.EmptyRange};e.anchor&&(t.tl.x=e.anchor.tl?.x??0,t.tl.y=e.anchor.tl?.y??0,t.br.x=e.anchor.br?.x??0,t.br.y=e.anchor.br?.y??0,n.colStart=e.anchor.tl?.c??0,n.rowStart=e.anchor.tl?.r??0,n.colEnd=Math.max(n.colStart,(e.anchor.br?.c??0)+(t.br.x>0?0:-1)),n.rowEnd=Math.max(n.rowStart,(e.anchor.br?.r??0)+(t.br.y>0?0:-1)));const r=this._beginCommit("Load Movable"),o=e.content.json,i={offsets:t,name:o.name??null,description:o.name??null,hidden:o.hidden??!1,rotation:o.rotation??0,lockAspectRatio:o.lockAspect??null};e.anchorType&&(i.anchorType=e.anchorType),i.name||(i.name=`${this._content.getTypeDescription()} ${++lo.instanceCounter}`),i.bounds=this._calcAbsoluteBounds(n,t),this._updateState(i,{description:"Load Movable"}),this._optionsMovable.setContainerCoords?.(n),r.commit()}toJSON(e){const t=this._getState(),n=t.anchor,r=t.offsets,o={tl:{c:n.colStart,r:n.rowStart},br:{c:n.colEnd+(r.br.x?0:1),r:n.rowEnd+(r.br.y?0:1)}};r&&(r.tl?.x&&(o.tl.x=V.roundAccurately(r.tl.x,1)),r.tl?.y&&(o.tl.y=V.roundAccurately(r.tl.y,1)),r.br?.x&&(o.br.x=V.roundAccurately(r.br.x,1)),r.br?.y&&(o.br.y=V.roundAccurately(r.br.y,1)));const i=this._content.toJSON(e)??{},l={anchor:o,content:{type:this._content.getType(),json:i}},a=t.anchorType;return a&&a!==Ut.Type.TwoCell&&(l.anchorType=this.getAnchorType()),t.hidden&&(l.hidden=t.hidden),t.name&&(l.name=t.name),t.description&&(l.name=t.description),t.rotation!==void 0&&t.rotation!==0&&(l.rotation=t.rotation),V.isDefined(t.lockAspectRatio)&&t.lockAspectRatio!==this._optionsMovable.defaultLockAspectRatio&&(l.lockAspect=t.lockAspectRatio),l}get isIMovable(){return!0}},lo.instanceCounter=0,lo);class yC{constructor(e,t,n,r,o,i){this._add=e,this._getItems=t,this._getCount=n,this._updateSelected=r,this._addListeners=o,this._addImage=i}async add(e){return this._add(e)}getItems(e){return this._getItems(e)}getCount(){return this._getCount()}updateSelected(e,t){return this._updateSelected(e,t)}addListeners(e,t){return this._addListeners(e,t)}addImage(e,t){return this._addImage(e,t)}}const Mu={transactional:!0,ignoreDataChanges:!0};class fm extends P0{constructor(e){super({...e,type:"namedReference"});const t=this;this._listener=r=>{const o=this._getState().ranges;let i=r.getSource(),l=!1;const a={ranges:i};if(r.trigger==="moveCells"){const d=t._getState(),h=r.getTo(),f=r.getFrom(),g=[];for(let w=0;w<o.getCount();w++){const S=o.at(w);if(g.push(S.getCoords()),!S.isInvalid()){for(let b=0;b<f.getCount();b++){const v=f.at(b).getCoords(),y=S.getCoords();if(!J.isRangeWithinRange(y,v))continue;const _=h.getCoords(),C=_.colStart-v.colStart+y.colStart,E=_.rowStart-v.rowStart+y.rowStart,x={...y,colStart:C,rowStart:E,colEnd:C+(y.colEnd-y.colStart),rowEnd:E+(y.rowEnd-y.rowStart)};(h.size!==1||J.isRangeWithinRange(x,_))&&(g[w]=h.getSource().getRange(x).getCoords(),l=!0)}if(!l)return}}const m=this._options.addressToRanges(g);let p;d.removeListener?.(),m.isInvalid()||(p=m.addListener(t._listener,Mu)),a.ranges=m,a.removeListener=p}this._updateState(a,null,["onRangesChange"]);const c=i.getCoords();let u=!c||c.length===0;for(let d=0;!u&&d<c.length;d++)if(!c[d]){u=!0;break}u&&t.delete()};const n=e.value;if(n&&!n.isInvalid()){const r=n.addListener(this._listener,Mu);this._updateState({ranges:n,removeListener:r},null)}}setReference(e){const t=this._options.addressToRanges(e);if(t&&!t.isInvalid()){this._getState().removeListener?.();const n=t.addListener(this._listener,Mu);this._updateState({ranges:t,removeListener:n},null)}return null}async select(e){return await this._getState().ranges.select(e),this}getRanges(){return this._getState().ranges}setHidden(e=!1,t){return this._updateState({hidden:e},{description:"Set Hidden",...t},[]),this}setScope(e,t){return this._updateState({scope:e},{description:"Set Scope",...t},[]),this}getType(){return"reference"}getValue(){return this._getState().ranges}toJSON(){const e=super._toJSON();return e.ref=this._getState().ranges.toString(),e}_getDescription(){return`Named '${this.getName()}'`}_processDelete(){const e=this._getState();e&&e.removeListener?.(),super._processDelete()}}const mm="Item must be specified.",pm="Name must be a non-empty string",wm=(s,e=null)=>`Named item '${s}' already exists${e?`in scope ${e}`:""}.`,Sm=s=>{const e=[];for(let t=0;t<s.getCount();t++){let n=null;try{n=s.at(t),n.isICellRange&&(n=n.getFixed(!0))}catch(r){console.warn("Invalid range",r)}e.push(n?n.toString().toLowerCase():rn)}return e.sort(),e.join(",")},bC=/^[^a-zA-Z_\\]+$/,vC=/^[^a-zA-Z0-9_.]+$/;class kw{constructor(e){this._emitter=null,this._closed=!1,this._lastLookup=V.EmptyArray,this._lastLookupAddress=null,this._lastLookupScope=null,this._lastLookupType=null,this._allowExtrudes=!1,this._options={...e};const t=this;this._transactions=this._options.transactions??new ir({transient:!0}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){r?.initial||t._emitter.notify("onCollectionChange")}}),this._emitter=new wn(this,this._transactions),this._initState(),this._fromJSON(this._options?.json)}getItems(e){if(this.isClosed())return V.EmptyArray;const t=this._getState();if(!t)return V.EmptyArray;const n=t.itemsSpatial;if(n.isEmpty())return V.EmptyArray;if(e&&e.address===this._lastLookupAddress&&e.scope===this._lastLookupScope&&e.type===this._lastLookupType&&e.allowExtrudes===this._allowExtrudes)return this._lastLookup;this._lastLookupAddress=e?.address??void 0,this._lastLookupScope=e?.scope??void 0,this._lastLookupType=e?.type??void 0,this._allowExtrudes=e?.allowExtrudes??void 0;let r=null;if(e?.address){const u=this._options.addressToRanges(e?.address);if(!u)return console.debug("invalid address",e?.address),this._lastLookup=null,null;r=u.getCoords()}let o=null;if(r){o=[];for(let u=0;u<r.length;u++){const d=n.search(r[u]),h=d.length;for(let f=0;f<h;f++)o.push(d[f])}}else o=n.all();if(!o||o.length===0)return this._lastLookup=V.EmptyArray,V.EmptyArray;const i=new Set,l=new Set;o.forEach(u=>{const d=u.value;if(!e?.type||d.getType()===e.type){if(r&&!e?.allowExtrudes){const h=d.getRanges?.();if(!h||h.getCount()===0)return;for(let f=0;f<r.length;f++)if(!J.isRangeWithinRange(u,r[f]))return}!e?.scope||d.getScope()!==e.scope&&e.scope!=="all"?d.getScope()||l.add(d):i.add(d)}});const a=new Map;l.forEach(u=>{a.set(u.getName(),u)}),i.forEach(u=>{a.set(u.getName(),u)});let c=[];return a.forEach(u=>{c.push(u)}),c=c.sort((u,d)=>{let h=u.getType().localeCompare(d.getType());return h!==0?h:u.getName().localeCompare(d.getName())}),this._lastLookup=c,c}lookupByRanges(e){const t=this._options.addressToRanges(e);if(!t||t.getCount()===0)return null;const n=this._getState();if(!n||n.itemsByKey.size===0)return null;const r=Sm(t),o=n.itemsByFullRange.get(r);if(!o)return null;const i=[];return o.forEach(l=>{const a=n.itemsByKey.get(l);a&&i.push(a.item)}),i.length>0?i:null}getByName(e,t=!1){if(!e)return null;const n=this._getState();if(!n||n.itemsByKey.size===0||typeof e!="string")return null;const r=e.toLowerCase(),o=this._options.getCurrentScope();if(!t&&o){const i=r+":"+o.toLowerCase(),l=n.itemsByKey.get(i);if(l)return l.item}return n.itemsByKey.get(r)?.item??null}getCount(){const e=this._getState();return e?e.itemsByKey.size:0}getRanges(e){const t=this._options.addressToRanges(e),n=[];for(let r=0;r<t.getCount();r++){const o=t.at(r).getFixed(!0).getCoords();n.push(o)}return this._options.addressToRanges(n)}findValidName(e,t=null,n=!1){if(!e)throw new Error("A template string must be specified.");const r=this,o=i=>{try{return r._validateName(i,t,n),!0}catch{}return!1};return o(e)?e:u0(e,o)}validateName(e,t=null,n=!1){return this._validateName(e,t,n)}_validateName(e,t,n=!1){if(this._closed)throw new Error(Kn);if(!e||e.length===0)throw new Error(pm);if(e.length>255)throw new Error("Name must not exceed 255 characters.");if(e.indexOf(" ")!==-1)throw new Error("Name must not contain any spaces.");const r=e.trim().toLowerCase(),o=r.substring(1,e.length-1);if(new RegExp(bC).test(r[0]))throw new Error("First letter must be either a letter, an underscore, or a backslash.");if(new RegExp(vC).test(o))throw new Error("Name must be either letters, numbers, periods or underscores.");if(r.length===1&&(r[0]==="r"||r[0]==="c"))throw new Error("Name can not be 'r' or 'c'.");if(((a,c=J1,u=Z0,d=!1)=>{let h=nw(a,d);if(!h||h[2]||!h[1])return!1;const f=pd(a,wd);if(!f)return!1;const g=f.rowIndex;if(g<0||g>c)return!1;const m=f.colIndex;return!(m<0||m>=u)})(e))throw new Error("Name can not be an address.");let i=e.toLowerCase()?.trim();t&&(i=i+":"+t.toLowerCase());const l=this._getState()?.itemsByKey.get(i);if(l){const a=l.item.getRanges();if(!n||a||a.getCount()>0)throw new Error(wm(e,t))}}addReference(e,t,n=!1){const r=this._options.addressToRanges(t),o=this.getByName(e);let i=null;const l=this._beginCommit(`${o&&n?"Update":"Insert"} Named '${e}'`);try{if(o){if(!n)throw new Error(wm(e));this._delete(o,{description:`Delete Named '${o.getName()}'`})}i=new fm({value:r,addressToRanges:this._options.addressToRanges,json:{name:e,ref:r.toString()},transactions:this._transactions}),this.add(i),l.commit()}catch(a){throw l.rollback(),a}return i}add(e){if(this._closed)throw new Error(Kn);if(!e)throw new Error(mm);if(!e.getName||typeof e=="string")throw new Error("Add must take a 'INamed' object. To add a string use 'addReference'.");if(this._validateName(e.getName(),e.getScope(),!1),this._options.isReadOnly?.())throw new Error("Names are read-only.");const t=this._beginCommit(`Insert Named Item '${e.getName()}'`),n=this._add([e]);if(n===null)return t.rollback(),null;const r=n.itemsByKey.get(e.getName().toLowerCase());return this._updateState(o=>({...o,...n})),t.commit(),r?.item??null}_toKey(e){let t=e.getName().toLowerCase();return t.startsWith("_xlnm.")&&(t=t.substring(6)),e.getScope()?t+":"+e.getScope().toLowerCase():t}_delete(e,t){if(!e)throw new Error(mm);if(this._closed)throw new Error(Kn);const n=this._beginCommit(t?.description??`Delete Named Item '${e.getName()}'`);let r=null;try{const o=this._getState()?.itemsByKey,i=this._toKey(e);if(r=o.get(i),!r)throw new Error(`Item '${e.getName()}' does not exist.`);const l=this._cloneState();this._index(i,null,l),this._updateState(a=>({...a,...l})),n.commit()}catch(o){throw n.rollback(),o}return this._emitter.notify("onCollectionChange"),r.item}_cloneState(){const e=this._getState();return{itemsBySource:new Map(e.itemsBySource),itemsByKey:new Map(e.itemsByKey),itemsSpatial:e.itemsSpatial.clone(),itemsByFullRange:new Map(e.itemsByFullRange),itemsByPartialRange:new Map(e.itemsByPartialRange)}}_index(e,t,n){const r=n.itemsByKey.get(e);if(r){const i=r.asPartialRanges;if(i)for(let a=0;a<i.length;a++){const c=n.itemsByPartialRange.get(i[a]);if(c)if(c.size===1)n.itemsByPartialRange.delete(i[a]);else{const u=new Set(c);u.delete(e),n.itemsByPartialRange.set(i[a],u)}}const l=r.asFullRange;if(l){const a=n.itemsByFullRange.get(l);if(a)if(a.size===1)n.itemsByFullRange.delete(l);else{const c=new Set(a);c.delete(e),n.itemsByFullRange.set(l,c)}}if(r.nodes)for(let a=0;a<r.nodes.length;a++)n.itemsSpatial.remove(r.nodes[a]);r.unwatch?.(),n.itemsByKey.delete(e),n.itemsBySource.delete(r.item)}let o=null;if(t){let i=[],l=null,a=null;o=t.getRanges?.();const c=this._toKey(t);if(o){const{asFullRange:f,asPartialRanges:g,asRanges:m}=(p=>{const w=p.getCoords(),S=Sm(p),b=S.split(",");return{asFullRange:S,asPartialRanges:b,asRanges:w}})(o);if(l=f,a=g,m){for(let p=0;p<g.length;p++){let w=n.itemsByPartialRange.get(g[p]);const S=w?new Set(w):new Set;S.add(c),n.itemsByPartialRange.set(g[p],S),i.push({...m[p],value:t})}if(n.itemsSpatial.load(i),f){let p=n.itemsByFullRange.get(f);const w=p?new Set(p):new Set;w.add(c),n.itemsByFullRange.set(f,w)}}}const u=this,d=t.addListeners({onDelete:f=>{u._delete(f)},onAnyChange:f=>{const g=u._beginCommit(`Update Named '${f.getName()}'`);try{const m=u._cloneState(),p=m.itemsBySource.get(f).globalKey;u._index(p,f,m),u._updateState(w=>({...w,...m})),g.commit()}catch(m){throw g.rollback(),m}}},{transactional:!0}),h={item:t,asFullRange:l,asPartialRanges:a,unwatch:d,nodes:i,globalKey:c};n.itemsByKey.set(c,h),n.itemsBySource.set(t,h)}}_add(e){if(this._closed)throw new Error(Kn);const t=this._getState();if(!e)return t;const n=this._cloneState(),r=e.length;for(let o=0;o<r;o++){const i=e[o];if(!i.getName())throw new Error(pm);const l=this._toKey(i);try{this._index(l,i,n)}catch(a){console.debug(`Unable to add named item '${l}'.`,a)}}return n}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(Kn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_updateState(e,t="Update"){if(!e)return;this._lastLookup=V.EmptyArray,this._lastLookupAddress=null,this._lastLookupType=null,this._lastLookupScope=null;const n=this._beginCommit(t);try{n.updateState(this,e),n.commit()}catch(r){throw n.rollback(),r}}fromJSON(e){if(this._closed)throw new Error(Kn);this._fromJSON(e)}_initState(){this._updateState(e=>({...e,items:new Set,itemsByKey:new Map,itemsSpatial:new _t,itemsByFullRange:new Map,itemsByPartialRange:new Map}))}_fromJSON(e){const t=this._beginCommit("Load Names");try{if(e){const n=[],r=e.length;for(let i=0;i<r;i++){const l=e[i];try{const a=this._options.addressToRanges(l.ref),c=new fm({value:a,addressToRanges:this._options.addressToRanges,deleteFromContainer:u=>{this._delete(c,u)},json:l,transactions:this._transactions});n.push(c)}catch(a){console.debug("Unable to load named item.",l,a.message)}}const o=this._add(n);this._updateState(i=>({...i,...o}))}t.commit({viewAfter:{initial:!0}})}catch(n){throw t.rollback(),n}}toJSON(){const e=this._getState();if(!e||e.itemsByKey.size===0)return null;const t=[],n=Array.from(e.itemsByKey.keys()).sort(),r=n.length;for(let o=0;o<r;o++){const i=e.itemsByKey.get(n[o]).item,l=i.toJSON?.();l&&t.push(l)}return t.length===0?null:t}addListeners(e,t){return this._emitter.addListeners(e,t)}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}get isNamedCollection(){return!0}}class CC extends Lo{constructor(e){super(e),e.json&&this._updateState({data:e.json})}getType(){return"chart"}getDescription(){return`Chart: ${this._getState()?.data?.types?.[0]?.type??"unknown"}`}toJSON(e){const t=this._getState();let n=null;return t&&t.data&&(n=t.data),n}getTypeDescription(){return"Chart"}}class xC extends Lo{constructor(e){super(e),e.json&&this._updateState({data:e.json})}getType(){return"shape"}getDescription(){return`Shape: ${this._getState()?.data}`}toJSON(e){const t=this._getState();let n=null;return t&&t.data&&(n=t.data),n}getTypeDescription(){return"Shape"}}class EC extends Lo{constructor(e){super(e),e.json&&this._updateState({data:e.json})}getType(){return"custom"}getDescription(){return`CustomElement: ${this._getState()?.data}`}toJSON(e){const t=this._getState();let n=null;return t&&t.data&&(n=t.data),n}getTypeDescription(){return"CustomElement"}}const _m=(s,e,t=!0,n=!0)=>{let r=0,o=0;if(!t&&!n)return{x:r,y:o};let i=!1,l=0;do{const a={x:e.x+r,y:e.y+o,width:0,height:0},c=s.getItems({bounds:a});if(i=!1,c.length>0){for(let u=0;!i&&u<c.length;u++){const d=c[u].getBounds();d.x===a.x&&d.y===a.y&&(i=!0)}i&&(r+=t?16:0,o+=n?16:0)}}while(i&&++l<100);return{x:r,y:o}};class RC{constructor(e,t,n){this._add=e,this._get=t,this._getByName=n}add(e,t){if(!e)throw new Error(Cd);return this._add(e,t)}getItems(e){if(e&&e.name&&Object.keys(e).length===0)return[this._getByName(e.name)];let t;e?.address&&(t=e.address);const n=this._get(t,e?.excludeHidden,e?.fullyContained);if(e?.name){const r=e.name.toLocaleLowerCase();for(let o=0;o<n.length;o++)if(n[o].getName().toLocaleLowerCase()===r)return[n[o]]}return n}getByName(e){if(typeof e!="string")throw new Error("Get by name must take a valid name.");return this._getByName(e)}getCount(){return this._get(null,!1,!1).length}}const vn=(s,e,t)=>{if(!s)return e;let n=e;const r=t===B.Direction.Right||t===B.Direction.Down;for(;;){const o=s(n,!r);if(o===0)return n;r?n+=o:n-=o}},IC=Object.freeze({colIndex:0,rowIndex:0}),Ad=Object.freeze([]),Tu=Object.freeze({cell:J.EmptyCell,ranges:Ad,rangeIndex:-1}),Nw=(s,e=B.Direction.Right,t,n,r,o=null)=>{if(o&&J.isEqualSelectionCoords(o,s))return s;const i=s.ranges[s.rangeIndex];if(!J.isRangesIntersect({rowStart:s.cell.rowIndex,colStart:s.cell.colIndex,rowEnd:s.cell.rowIndex,colEnd:s.cell.colIndex},i))return s;let l={...s.cell},a=s.rangeIndex;switch(e){case B.Direction.Right:l.colIndex=vn(r,l.colIndex+1,e);break;case B.Direction.Left:l.colIndex=vn(r,l.colIndex-1,e);break;case B.Direction.Down:l.rowIndex=vn(n,l.rowIndex+1,e);break;case B.Direction.Up:l.rowIndex=vn(n,l.rowIndex-1,e)}const c=h=>{if(h){a=s.rangeIndex>=s.ranges.length-1?0:s.rangeIndex+1;const f=s.ranges[a];l={colIndex:f.colStart,rowIndex:f.rowStart}}else{a=s.rangeIndex<=0?s.ranges.length-1:s.rangeIndex-1;const f=s.ranges[a];l={colIndex:f.colEnd,rowIndex:f.rowEnd}}};if(e===B.Direction.Right&&l.colIndex>i.colEnd&&l.rowIndex===i.rowEnd)c(!0);else if(e===B.Direction.Left&&l.colIndex<i.colStart&&l.rowIndex===i.rowStart)c(!1);else if(e===B.Direction.Down&&l.colIndex===i.colEnd&&l.rowIndex>i.rowEnd)c(!0);else if(e===B.Direction.Up&&l.colIndex===i.colStart&&l.rowIndex<i.rowStart)c(!1);else{let h=l.rowIndex,f=l.colIndex;switch(e){case B.Direction.Right:f>i.colEnd&&(h=vn(n,h+1,e),f=i.colStart,h>i.rowEnd&&(h=i.rowStart));break;case B.Direction.Left:f<i.colStart&&(h=vn(n,h-1,e),f=i.colEnd,h<i.rowStart&&(h=i.rowEnd));break;case B.Direction.Down:h>i.rowEnd&&(f=vn(r,f+1,e),h=i.rowStart,f>i.colEnd&&(f=i.colStart));break;case B.Direction.Up:h<i.rowStart&&(f=vn(r,f-1,e),h=i.rowEnd,f<i.colStart&&(f=i.colEnd))}l={rowIndex:h,colIndex:f}}let u=t(l);if(!J.isRangeWithinRange(u,i)){const h=J.intersectRanges(u,i);h&&(u=h)}let d={rowStart:vn(n,u.rowStart,B.Direction.Down),colStart:vn(r,u.colStart,B.Direction.Right),rowEnd:vn(n,u.rowEnd,B.Direction.Up),colEnd:vn(r,u.colEnd,B.Direction.Left)};if(d.rowStart!==l.rowIndex||d.colStart!==l.colIndex){switch(e){case B.Direction.Right:s.ranges[a].colStart===d.colStart&&s.ranges[a].colEnd===d.colEnd&&(l.rowIndex=d.rowEnd),l.colIndex=d.colEnd;break;case B.Direction.Left:s.ranges[a].colStart===d.colStart&&s.ranges[a].colEnd===d.colEnd&&(l.rowIndex=d.rowStart),l.rowIndex===d.rowStart?l.colIndex=d.colStart+1:l.colIndex=d.colStart;break;case B.Direction.Down:s.ranges[a].rowStart===d.rowStart&&s.ranges[a].rowEnd===d.rowEnd&&(l.colIndex=d.colEnd),l.rowIndex=d.rowEnd;break;case B.Direction.Up:s.ranges[a].rowStart===d.rowStart&&s.ranges[a].rowEnd===d.rowEnd&&(l.colIndex=d.colStart),l.colIndex===d.colStart?l.rowIndex=d.rowStart+1:l.rowIndex=d.rowStart}return o&&console.warn("call recursive > 1"),Nw({cell:l,ranges:s.ranges,rangeIndex:a},e,t,n,r,o??s)}return{ranges:s.ranges,cell:l,rangeIndex:a}};class AC{constructor(e){this._adjusting=null,this._emitter=null,this._coords=Tu,this._sheet=e.sheet,this._emitter=new wn(this);const t=e.sheet;this._adjusting=null,this._hiddenRowsAt=(n,r)=>t.getRowHeaders().hiddenHeadersAt(n,r),this._hiddenColumnsAt=(n,r)=>t.getColumnHeaders().hiddenHeadersAt(n,r),this._getCellCoordsAsRangeCoords=n=>{const r=J.cellToRange(n);if(t.isClosed())return r;const o=t.getRange(r,{excludeHidden:!0}).getMerges();return o.length===0?r:o[0]},this._canSelectionSpanMergedCells=n=>{const r=t.getRange(n);return r.isEntireColumns()||r.isEntireRows()},this._getMergedRanges=n=>t.getRange(n,{excludeHidden:!0}).getMerges(),this._isContentfulCell=()=>!1,this._contentfulCellFinder=(n,r,o,i,l,a)=>{const c=t.getSelectedRange().getExtended(i,n).getCoords();switch(i){case B.Direction.Up:return c.rowStart;case B.Direction.Down:return c.rowEnd;case B.Direction.Left:return c.colStart;case B.Direction.Right:return c.colEnd}},this._scrollCellCoordsIntoView=(n,r)=>t.scrollTo(n,r?{scroll:r}:void 0),this._selectionPolicy=e.selectionPolicy??"multiple",this._newSelectionMode=e.newSelectionMode??"clear"}navigate(e,t=!1,n=!1,r=0){const o=this._coords;if(!o.cell)return this;let i=o.cell,l=o.cell;if(t&&o.ranges.length>0){const S=o.ranges[o.rangeIndex],b=o.cell;switch(e){case B.Direction.Up:l={rowIndex:b.rowIndex===S.rowStart?S.rowEnd:S.rowStart,colIndex:S.colEnd},i={rowIndex:b.rowIndex===S.rowStart?S.rowStart:S.rowEnd,colIndex:S.colStart};break;case B.Direction.Down:l={rowIndex:b.rowIndex===S.rowEnd?S.rowStart:S.rowEnd,colIndex:S.colEnd},i={rowIndex:b.rowIndex===S.rowEnd?S.rowEnd:S.rowStart,colIndex:S.colStart};break;case B.Direction.Left:l={rowIndex:S.rowEnd,colIndex:b.colIndex===S.colStart?S.colEnd:S.colStart},i={rowIndex:S.rowStart,colIndex:b.colIndex===S.colStart?S.colStart:S.colEnd};break;case B.Direction.Right:l={rowIndex:S.rowEnd,colIndex:b.colIndex===S.colEnd?S.colStart:S.colEnd},i={rowIndex:S.rowStart,colIndex:b.colIndex===S.colEnd?S.colEnd:S.colStart}}}const a=this._getCellCoordsAsRangeCoords(l);let{rowStart:c,colStart:u}=a;const d=this._magicCell;if(d)switch(e){case B.Direction.Up:case B.Direction.Down:d.colIndex>=a.colStart&&d.colIndex<=a.colEnd&&(u=d.colIndex);break;case B.Direction.Left:case B.Direction.Right:d.rowIndex>=a.rowStart&&d.rowIndex<=a.rowEnd&&(c=d.rowIndex)}if(!r){const S=this._getMaxRange();switch(e){case B.Direction.Up:c=vn(this._hiddenRowsAt,Math.max(a.rowStart-1,S.rowStart??0),e);break;case B.Direction.Down:c=vn(this._hiddenRowsAt,Math.min(a.rowEnd+1,S.rowEnd??Number.MAX_SAFE_INTEGER),e);break;case B.Direction.Left:u=vn(this._hiddenColumnsAt,Math.max(a.colStart-1,S.colStart??0),e);break;case B.Direction.Right:u=vn(this._hiddenColumnsAt,Math.min(a.colEnd+1,S.colEnd??Number.MAX_SAFE_INTEGER),e)}if(n){const b=this._getMaxRange();let v=0;switch(e){case B.Direction.Up:v=b.rowStart??0,c=this._contentfulCellFinder({...l,colIndex:this._coords.cell.colIndex},this._isContentfulCell,this._hiddenRowsAt,e,!1,Math.max(v,this._hiddenRowsAt(v,!1)));break;case B.Direction.Down:v=b.rowEnd??Number.MAX_SAFE_INTEGER,c=this._contentfulCellFinder({...l,colIndex:this._coords.cell.colIndex},this._isContentfulCell,this._hiddenRowsAt,e,!1,Math.min(v,v-this._hiddenRowsAt(v,!0)));break;case B.Direction.Left:v=b.colStart??0,u=this._contentfulCellFinder({...l,rowIndex:this._coords.cell.rowIndex},this._isContentfulCell,this._hiddenColumnsAt,e,!1,Math.max(v,this._hiddenColumnsAt(v,!1)));break;case B.Direction.Right:v=b.colEnd??Number.MAX_SAFE_INTEGER,u=this._contentfulCellFinder({...l,rowIndex:this._coords.cell.rowIndex},this._isContentfulCell,this._hiddenColumnsAt,e,!1,Math.min(v,v-this._hiddenColumnsAt(v,!0)))}}}let h=null;r&&(h={});const f={rowIndex:c,colIndex:u},g=this._getCellCoordsAsRangeCoords(f),m={rowIndex:g.rowStart,colIndex:g.colStart};t||(this._magicCell=f);const p=this._firstActiveCoords,w=J.isEqualCells(p,m)&&J.isEqualCells(p,i);if(t&&!w?this.modify(m,i):this.clearAndModify(m),h)this._scrollCellCoordsIntoView(h);else{if(t&&p){const S=this._getMaxRange();if(e===B.Direction.Right&&p.colIndex===S.colEnd||e===B.Direction.Left&&p.colIndex===S.colStart||e===B.Direction.Up&&p.rowIndex===S.rowEnd||e===B.Direction.Down&&p.rowIndex===S.rowStart)return this}e===B.Direction.Left||e===B.Direction.Right?this._scrollCellCoordsIntoView({colStart:f.colIndex}):e!==B.Direction.Up&&e!==B.Direction.Down||this._scrollCellCoordsIntoView({rowStart:f.rowIndex})}return this}getCoords(){return this._coords}updateCoords(e){const t=this._coords;if(J.isEqualSelectionCoords(t,e))return;const n=((r,o,i)=>{if(!r)return Tu;let l=o.cell;J.isEqualCells(l,r?.cell)||(l=Object.freeze({colIndex:Math.max(0,Math.min(r?.cell?.colIndex??o.cell?.colIndex??0)),rowIndex:Math.max(0,Math.min(r?.cell?.rowIndex??o?.cell?.rowIndex??0))}));const a=r?.ranges?[...r.ranges]:[];let c=!1;const u=a.length;let d=u===0;for(let g=0;g<u;g++){const m=a[g];a[g]=Object.freeze({colStart:Math.max(i.colStart,Math.min(m.colStart,i.colEnd)),colEnd:Math.max(i.colStart,Math.min(m.colEnd,i.colEnd)),rowStart:Math.max(i.rowStart,Math.min(m.rowStart,i.rowEnd)),rowEnd:Math.max(i.rowStart,Math.min(m.rowEnd,i.rowEnd))}),d=d||J.isCellWithinRange(l,m),c=c||Object.keys(m).length>4}let h=o?.ranges??[];!c&&J.isEqualRangesArrays(h,a)||(h=a);let f=r?.rangeIndex??o?.rangeIndex??Tu.rangeIndex;if(f=Math.max(-1,Math.min(f,h.length-1)),!d){const g=h[f];let m=l.rowIndex;m<g.rowStart?m=g.rowStart:m>g.rowEnd&&(m=g.rowEnd);let p=l.rowIndex;p<g.colStart?p=g.colStart:p>g.colEnd&&(p=g.colEnd),l=Object.freeze({colIndex:p,rowIndex:m})}return Object.freeze({cell:l,ranges:h,rangeIndex:f})})(e,this._coords,this._getMaxRange());return this._coords=n,!J.isEqualCells(n.cell,t.cell)&&this._scrollCellCoordsIntoView({colStart:n.cell.colIndex,rowStart:n.cell.rowIndex}),this._emitter.notify("onChange"),this}isEntire(){const e=this._coords;if(e.ranges.length===0)return!1;const t=this._getMaxRange();for(let n=0;n<e.ranges.length;n++){const r=e.ranges[n];if(!J.isRangeWithinRange(t,r))return!1}return!0}traverse(e=B.Orientation.Row,t=!1){let n=B.Direction.Right;n=e===B.Orientation.Row?t?B.Direction.Left:B.Direction.Right:t?B.Direction.Up:B.Direction.Down;const r=this._coords;if(r.ranges.length===0)return this.navigate(n);const o=this._getCellCoordsAsRangeCoords(r.cell);if(J.isEqualRangesArrays([o],r.ranges))return this.navigate(n);const i=Nw(r,n,this._getCellCoordsAsRangeCoords.bind(this),this._hiddenRowsAt.bind(this),this._hiddenColumnsAt.bind(this));this.updateCoords(i)}clear(){this._setSelectionRanges(Ad)}modify(e,t,n){if(this._selectionPolicy==="single")return;const r=this._coords,o=this._rangesFromCellOptional(r,e,t??r.cell);if(!o)return;const i=r.rangeIndex;this._setSelectionRanges(l=>l.length?l.map((a,c)=>i===c?o:a):[o]),n&&o&&this._setSelectionCell({colIndex:o.colStart,rowIndex:o.rowStart})}append(e,t=e,n){if(this._selectionPolicy!=="multiple"||!e||this._isCellOutOfBounds(e)||this._isCellOutOfBounds(t))return;const r=this._coords,o=this._cellToRangeActual(e,t);if(!o)return;const i=r.ranges.length>0?[...r.ranges]:[this._cellToRangeActual(r.cell,r.cell)];i.push(o);const l={ranges:i,cell:{rowIndex:o.rowStart,colIndex:o.colStart,...n},rangeIndex:i.length-1};J.isEqualSelectionCoords(l,r)||this.updateCoords(l)}clearAndModify(e,t,n){const r=this._coords;e={...r.cell,...e},t=t??e;const o=this._rangesFromCellOptional(r,e,t);if(!o)return;const i={rowIndex:o.rowStart,colIndex:o.colStart},l={...i,...n},a=this._newSelectionMode;a==="clear"?(this._firstActiveCoords=l,this.clear()):a==="modify"?this.modify(i):this.append(i),this._setSelectionCell(l)}setAdjusting(e){this._adjusting=e,this._emitter.notify("onAdjustingChange")}getAdjusting(){return this._adjusting}addListeners(e,t){return this._emitter.addListeners(e,t)}_setSelectionRanges(e){const t=this._coords;let n=typeof e=="function"?e(t.ranges):e??Ad;if(J.isEqualRangesArrays(n,t.ranges))return;let r=Math.max(n.length?0:-1,Math.min(t.rangeIndex,n.length-1)),o=t.cell;r===-1||J.isCellWithinRange(o,n[r])||(o={rowIndex:n[r].rowStart,colIndex:n[r].colStart}),n.length===1&&J.isSingleCell(n[0])&&J.isCellWithinRange(o,n[0])&&(n=[],r=-1);const i={cell:o,ranges:n,rangeIndex:r};J.isEqualSelectionCoords(i,t)||this.updateCoords(i)}_setSelectionCell(e){const t=this._coords,n=e??IC,r=this._getCellCoordsAsRangeCoords(n);if(!J.isSingleCell(r)&&t.ranges.length===0)return this.updateCoords({ranges:[r],rangeIndex:0,cell:n});if(J.isEqualCells(n,t.cell))return;let o=t.ranges,i=t.rangeIndex;t.ranges.length===1&&(J.isSingleCell(t.ranges[0])&&J.isCellWithinRange(n,t.ranges[0])||!J.isCellWithinRange(n,t.ranges[0]))&&(o=[],i=-1);const l={ranges:o,rangeIndex:i,cell:n};return J.isEqualSelectionCoords(l,t)?void 0:this.updateCoords(l)}_isCellOutOfBounds(e){const t=this._getMaxRange();return e.rowIndex<t.rowStart||e.colIndex<t.colStart||e.colIndex>t.colEnd||e.rowIndex>t.rowEnd}_cellToRangeActual(e,t){const n={rowStart:Math.min(e.rowIndex,t.rowIndex),colStart:Math.min(e.colIndex,t.colIndex),rowEnd:Math.max(e.rowIndex,t.rowIndex),colEnd:Math.max(e.colIndex,t.colIndex)};if(this._canSelectionSpanMergedCells(n))return n;const r=this._getCellCoordsAsRangeCoords(e),o=this._getCellCoordsAsRangeCoords(t),i={rowStart:Math.min(r.rowStart,o.rowStart),colStart:Math.min(r.colStart,o.colStart),rowEnd:Math.max(r.rowEnd,o.rowEnd),colEnd:Math.max(r.colEnd,o.colEnd)},l=this._getMergedRanges(i);return J.extendRangeToUnionRanges(i,l)}_rangesFromCellOptional(e,t,n){const r=e.ranges.length>0?e.ranges[e.rangeIndex]:{rowStart:e.cell.rowIndex,colStart:e.cell.colIndex,rowEnd:e.cell.rowIndex,colEnd:e.cell.colIndex},o={rowStart:Math.min(t.rowIndex??r.rowStart,n.rowIndex??r.rowStart),colStart:Math.min(t.colIndex??r.colStart,n.colIndex??r.colStart),rowEnd:Math.max(t.rowIndex??r.rowEnd,n.rowIndex??r.rowEnd),colEnd:Math.max(t.colIndex??r.colEnd,n.colIndex??r.colEnd)},i={rowIndex:o.rowStart,colIndex:o.colStart},l={rowIndex:o.rowEnd,colIndex:o.colEnd};if(!(this._isCellOutOfBounds(i)||this._isCellOutOfBounds(l)))return this._cellToRangeActual(i,l)}_getMaxRange(){return this._sheet.getEntireRange().getCoords()}toString(){let e="";return e+=`selection:[${this._sheet.getRange(this._coords.cell).toString()}`,this._coords.ranges&&this._coords.ranges.length>0&&(e+=`, ${this._sheet.getRanges(this._coords.ranges).toString()}`),this._coords.rangeIndex!==void 0&&this._coords.rangeIndex!==-1&&(e+=`, ${this._coords.rangeIndex}`),e+="]",e}}let MC=class Md{constructor(e,t){this._c=e,this._m=t}getModel(){return this._m}getCoords(){return this._c}getPropertiesAt(e,t,n){return this._m.getPropertiesAt(e,t,n)}getSplit(e){const t=this._m;return[new Md(e[0],t),new Md(e[1],t)]}};class TC extends Lo{constructor(e){if(super({...e}),this._coordsCache=null,!e.json)throw new Error("json is required");this._sheet=e.sheet,this._styles=e.sheet?.getStyles()??new tl,this._options={...e},e.setOnContainerCoordsChange(this._processCoordsChange.bind(this)),e.setCreateSpatial(this._createSpatial.bind(this)),this._getContainerRanges=e.getContainerRanges,this._setContainerRanges=e.setContainerRanges;const t=this;this._options.transactions.addStateListener(this,{onRestoreOrRevert(){t._coordsCache=null},onBeforeCommitEnd(){t._coordsCache=null}}),this._fromJSON({...e.json})}getRanges(){return this._getContainerRanges()}setRanges(e,t){const n=this.getRanges(),r=this._setContainerRanges(e,t);return this._processCoordsChange({before:n?.getCoords()??null,after:r?.getCoords()??null}),this}setType(e,t){return this._updateState({type:e},{description:"Set Conditional Format Type",...t}),this}getType(){return this._getState().type}setPriority(e,t){return this._updateState({priority:e},{description:"Set Priority",...t}),this}getPriority(){return this._getState().priority}setStopIfTrue(e,t){return this._updateState({stopIfTrue:e},{description:`Set Stop ${e??!1}`,...t}),this}getStopIfTrue(){return this._getState().stopIfTrue??!1}getScalar(){return this._getState().value??null}getColorScale(){return this._getState().colorScale??null}getContainsText(){return this._getState().text}getCustom(){return this._getState().formulas}getDataBar(){return this._getState().dataBar??null}getIconSet(){return this._getState().iconSet}getPresetCriteria(){return this._getState().style}getTopBottom(){return this._getState()}getSnapshot(e){this.toJSON();const t=null,n=this,r=Object.freeze({...e});let o=!1;return{async copyTo(i,l){i.conditionals;const a=i.range;({...r,...l}).isCut&&!o&&(n.delete(),o=!0);const c={colStart:a.colStart,rowStart:a.rowStart,colEnd:t.colEnd-t.colStart+a.colStart,rowEnd:t.rowEnd-t.rowStart+a.rowStart};return console.log("implement copyTo"),c},getCoords:()=>t,getSource:()=>n,getName:()=>"Conditional Format",getMarkOptions:()=>r,isISnapshot:!0}}_processRestoreOrRevert(e,t,n){super._processRestoreOrRevert(e,t,n)}_createSpatial(e){return new MC(e,this)}_processCoordsChange(e){this._coordsCache=null,e.after?this._emitter.notify("onAnyChange"):this._delete()}update(e,t){if(this.isClosed())throw new Error("Table has been closed. No further operations are allowed.");const n=this._getState(),r=this._beginCommit(t?.description??"Update Conditional Format");try{const o={...n,...e};this._updateState(o,t),this._getEmitter().notify("onAnyChange"),r.commit()}catch(o){throw r.rollback(),o}return this}_processDelete(){this._getState(),super._processDelete()}_processStateChange(e,t,n){super._processStateChange(e,t,n),this._getEmitter().notify("onAnyChange")}toJSON(){const e={},t=this._getState();if(t===null)return null;const n=this.getRanges()?.toString();return n?(e.ref=n,e.type=t.type,t.priority!==0&&(e.priority=t.priority),t.stopIfTrue&&(e.stopIfTrue=t.stopIfTrue),t.style&&(e.style=t.style),t.colorScale&&(e.colorScale=t.colorScale),t.dataBar&&(e.dataBar=t.dataBar),t.iconSet&&(e.iconSet=t.iconSet),t.aboveAverage&&(e.aboveAverage=t.aboveAverage),t.equalAverage&&(e.equalAverage=t.equalAverage),t.stdDev!==0&&(e.stdDev=t.stdDev),t.bottom&&(e.bottom=t.bottom),t.percent&&(e.percent=t.percent),t.rank!==0&&(e.rank=t.rank),t.operator&&(e.operator=t.operator),t.formulas&&(e.formulas=t.formulas),t.text&&(e.text=t.text),t.timePeriod&&(e.timePeriod=t.timePeriod),e):null}_fromJSON(e){const t={};t.type=e.type??Id.Type.CellIs,t.priority=e.priority??0,t.stopIfTrue=e.stopIfTrue??!1,t.style=e.style??null,t.colorScale=e.colorScale??null,t.dataBar=e.dataBar??null,t.iconSet=e.iconSet??null,t.aboveAverage=e.aboveAverage??!1,t.equalAverage=e.equalAverage??!1,t.stdDev=e.stdDev??0,t.bottom=e.bottom??!1,t.percent=e.percent??!1,t.rank=e.rank??0,t.operator=e.operator??null,t.formulas=e.formulas??null,t.text=e.text??null,t.timePeriod=e.timePeriod??null,this._updateState(t,{description:"Initialize Conditional Format"})}close(){super.close(),this.isClosed()||(this._updateState({},{description:"Close Conditional"}),this._stylesRemoveListener?.())}getCoords(){return this.getRanges().getCoords()[0]}getPropertiesAt(e,t,n){let r=this._coordsCache;r||(r=this._coordsCache=this.getRanges().getCoords());let o=0,i=0;const l={rowIndex:e,colIndex:t};for(let c=0;c<r.length;c++){const u=r[c];if(J.isCellWithinRange(l,u)){const d=e-u.rowStart,h=t-u.colStart;i=o+(d*(u.colEnd-u.colStart+1)+h+1)}o+=(u.rowEnd-u.rowStart+1)*(u.colEnd-u.colStart+1)}let a={fill:{type:"solid",color:"red"}};return a.fill.color=((c,u,d,h)=>{let f=1;u!==0&&(f=c/u);const g=d[0]+f*(h[0]-d[0]),m=d[1]+f*(h[1]-d[1]),p=d[2]+f*(h[2]-d[2]);return`rgb(${Math.round(g)}, ${Math.round(m)}, ${Math.round(p)})`})(i,o,[255,255,255],[255,0,0]),a}get isIConditionalFormat(){return!0}}class kC{constructor(e,t){this._add=e,this._get=t}add(e,t){if(!e)throw new Error(Ss);return this._add(e,t)}getItems(e){let t;return e?.address&&(t=e.address),this._get(t,e?.excludeHidden,e?.fullyContained)}getCount(){return this._get(null,!1,!1).length}}const ym=(s,e)=>{if(e){if(e.getType()===Pe.Type.Solid)s.background=pr(e.getColor())||"none",s["mso-pattern"]="black none";else if(e.getType()===Pe.Type.Pattern){const t=e;s.background=pr(t.getBackground())||"none";const n=pr(t.getForeground())||"";if(t.getPatternType()===Pe.BuiltInSheetPattern.Solid)s["mso-pattern"]=`${s.background} none`,s.background=n;else{const r=(o=>Gt.get(o)?.cssKey??"solid")(t.getPatternType());s["mso-pattern"]=n+(r?" ":"")+r}}else if(e.getType()===Pe.Type.Gradient){const t=e;s.background=pr(t.getStops()?.[0]?.getColor())||"auto",s.msoGradient=gw(t)||"auto"}}};class NC{constructor(e,t){if(this._visitedStyles=new Map,this._lastStyleClassId=63,this._wroteTD=!1,!e)throw new Error("Can not create with a null sheet.");this._sheet=e,this._includeSizeInCell=t??!1,this._normalStyle=e.getStyles().getNormal()}_createCSSStyle(e){const t=this._normalStyle,n={},r=(h,f)=>h===f||!(h&&!f)&&!(!h&&f)&&f.isEqual?.(h),o=e.getFont(),i=t.getFont();var l;r(o.getFill(),i.getFill())||(n.color=pr(o.getFill())),r(o.getSize(),i.getSize())||(n["font-size"]=Nf(o.getSize())),r(o.getWeight(),i.getWeight())||(n["font-weight"]=o.getWeight()),r(o.getStyle(),i.getStyle())||(n["font-style"]=o.getStyle()),r(o.getUnderline(),i.getUnderline())||(n["text-decoration"]="underline",n["text-underline-style"]=(l=o.getUnderline())===ke.UnderlineStyle.Single?"single":l===ke.UnderlineStyle.Double?"double":l===ke.UnderlineStyle.SingleAccounting?"single-accounting":l===ke.UnderlineStyle.DoubleAccounting?"double-accounting":"none"),r(o.getFamily(),i.getFamily())&&r(o.getFallbacks(),i.getFallbacks())||(n["font-family"]=za(o.getFamily(),o.getFallbacks())),r(e.getNumberFormat(),t.getNumberFormat())||(n["mso-number-format"]=Df(e.getNumberFormat()));const a=e.getAlignment(),c=t.getAlignment();if(!r(a.getHorizontal(),c.getHorizontal())){const h=a.getHorizontal();h===oe.HorizontalAlignment.CenterContinuous?n["text-align"]="center-across":h===oe.HorizontalAlignment.Fill?n["text-align"]="fill":h===oe.HorizontalAlignment.Distributed?n["text-align"]=a.getJustifyLastLine()?"121":"010":n["text-align"]=oe.toCSSHorizontalTextAlign(h)}if(!r(a.getVertical(),c.getVertical())){const h=a.getVertical();h===oe.VerticalAlignment.Distributed?n["vertical-align"]="121":n["vertical-align"]=Ff(h)}if(!r(a.getOverflow(),c.getOverflow())){const h=a.getOverflow();n["white-space"]=Of(h),h===oe.Overflow.Shrink&&(n["mso-text-control"]="shrinktofit")}var u;r(a.getRotation(),c.getRotation())||(n["mso-rotate"]=(u=a.getRotation(),(u%=360)<0&&(u+=360),u>180?u=360-u:u>1&&(u*=-1),u)),r(a.getIndent(),c.getIndent())||(n["mso-char-indent-count"]=a.getIndent()),r(e.getFill(),i.getFill())||ym(n,e.getFill());const d=e.getBorder();return d.getTop().isNone()||(n["border-top"]=_o(d.getTop())),d.getLeft().isNone()||(n["border-left"]=_o(d.getLeft())),d.getRight().isNone()||(n["border-right"]=_o(d.getRight())),d.getBottom().isNone()||(n["border-bottom"]=_o(d.getBottom())),d.getDiagonalUp().isNone()||(n["border-mso-diagonal-up"]=_o(d.getDiagonalUp())),d.getDiagonalDown().isNone()||(n["border-mso-diagonal-down"]=_o(d.getDiagonalDown())),Object.keys(n).length===0?null:n}_createCSSNormalStyle(){const e=this._normalStyle,t={"padding-top":"1px","padding-left":"1px","padding-right":"1px","mso-ignore":"padding"},n=e.getFont(),r=e.getAlignment();return t.color=pr(n.getFill()),ym(t,e.getFill()),t["font-size"]=Nf(n.getSize()),t["font-weight"]=n.getWeight(),t["font-style"]=n.getStyle(),t["text-decoration"]=uw(n.getUnderline(),n.getStrike()),t["font-family"]=za(n.getFamily(),n.getFallbacks()),t["mso-font-charset"]="0",t["mso-background-source"]="auto",t["mso-number-format"]=Df(e.getNumberFormat()),t["text-align"]=oe.toCSSHorizontalTextAlign(r.getHorizontal()),t["vertical-align"]=Ff(r.getVertical()),t.border="none",t["mso-pattern"]="auto",t["white-space"]=Of(r.getOverflow()),r.getOverflow()===oe.Overflow.Shrink&&(t["mso-text-control"]="shrinktofit"),t["mso-rotate"]="0",r.getIndent()>0&&(t["mso-char-indent-count"]=r.getIndent()),t["mso-protection"]="locked visible",t}onCell(e,t,n){let r;const o=e.getSpans();if(o.width>1||o.height>1){if(!e.isTopLeft())return!1;o.height>1&&n.addAttribute("rowspan",o.height),o.width>1&&n.addAttribute("colspan",o.width)}let i=e.toTextUnformatted();e.getNumberFormat().repeatPlaceholder&&(i=e.getNumberFormat().repeatPlaceholder.repeat(5)),n.setPlainText(i||"");const l=e.getStyle(),a=l.getFont();if(a.getVerticalAlignment()===ke.VerticalAlignment.Super&&(i=`<sup>${i}</sup>`),a.getVerticalAlignment()===ke.VerticalAlignment.Sub&&(i=`<sub>${i}</sub>`),a.getStrike()&&(i=`<s>${i}</s>`),e.getHyperlink()&&(i=`<a href="${e.getHyperlink().getAddress()}">${i}</a>`),n.setHTMLText(i||"&nbsp"),!this._wroteTD){const u=this._createCSSNormalStyle();n.addSharedStyle("td",u),this._wroteTD=!0}let c=this._visitedStyles.get(l);if(!c){const u=this._createCSSStyle(l);u&&(c="xl"+ ++this._lastStyleClassId,this._visitedStyles.set(l,c),n.addSharedStyle("."+c,u))}if(c&&n.addAttribute("class",c),this._includeSizeInCell){const u=this._sheet.getColumnHeaders().at(t.colIndex).getSize();n.addAttribute("width",u),n.addStyle("width",V.roundAccurately(u/ke.getDeviceScale(),2)+"pt");const d=this._sheet.getRowHeaders().at(t.rowIndex).getSize();n.addAttribute("height",d),n.addStyle("height",V.roundAccurately(d/ke.getDeviceScale(),2)+"pt")}return r}onRow(e,t,n,r){const o=e.getSize();r.addAttribute("height",o),r.addStyle("height",V.roundAccurately(o/ke.getDeviceScale(),2)+"pt"),e.isCustomSize()&&r.addStyle("mso-height-source","userset")}onColumn(e,t,n,r){const o=e.getSize();r.addAttribute("width",o),r.addStyle("width",V.roundAccurately(o/ke.getDeviceScale(),2)+"pt"),e.isCustomSize()&&r.addStyle("mso-width-source","userset"),n>1&&r.addAttribute("colspan",n)}}const bm=(s,e,t)=>{const n=s.getOrientation()===ct.Column,r=(n?"Column":"Row")+" Copy",o=s.getSnapshot(t);return{...o,getName:()=>r,getCoords:()=>e,copyTo:async(i,l)=>{const a=n?i.getColumnHeaders():i.getRowHeaders(),c={...t,...l};if(c.includeHeaders===!0){const u=await o.copyTo(a,c);return n?{colStart:u.min,rowStart:e.rowStart,colEnd:u.max,rowEnd:e.rowEnd}:{colStart:e.colStart,rowStart:u.min,colEnd:e.colEnd,rowEnd:u.max}}},getMarkOptions:()=>t}},FC=(s,e,t,n,r,o)=>{const i=t[0];let l,a;const c=()=>{if(a!==void 0)return;const[u,d]=((h,f)=>{const g=f.getRowHeaders(),m=f.getColumnHeaders(),p=f.getUsedRange()?.getCoords(),w=g.getUsedRange()?.getCoords(),S=m.getUsedRange()?.getCoords(),b={...J.EmptyRange,...p,colEnd:Math.max(p?.colEnd??0,S?.max??0),rowEnd:Math.max(p?.rowEnd??0,w?.max??0)},v=new Map,y=[];h.onStart?.();const _={rows:[],cols:[]},C=new mC(v,y);C.setNode(_),h.onTable?.(C,b);let E=0;m.forEachSpan((D,O)=>{const H=O.getCoords();E=E+H.max-H.min+1;const z={};C.setNode(z),h.onColumn?.(O.getCellHeader(),H.min,H.max-H.min+1,C),_.cols.push(z)},{address:b,includeEmpty:!0,includeStyles:!0});let x=0;const R=[];if(g.forEachSpan((D,O)=>{const H=O.getCoords();x=x+H.max-H.min+1,R.push({min:H.min,max:H.max,value:O.getCellHeader()})},{address:b,includeEmpty:!0,includeStyles:!0,excludeHidden:!1}),E*x>5e4){if(!hm)throw hm=!0,new OS("Unable to write more than 50000 cells to system clipboard. Items can still be pasted within the application to but if you want to copy to another application select a smaller set of data.");return[null,null]}let I=0,A=-1,M=null;f.forEach((D,O)=>{const H=O.getCoords(),z=O.getCell();if(H.rowIndex!==A){H.rowIndex>R[I].max&&++I;const q=R[I];M={cells:[]},C.setNode(M),h.onRow?.(q.value,H.rowIndex,1,C),_.rows.push(M),A=H.rowIndex}const j={};C.setNode(j),h.onCell(z,H,C)!==!1&&M.cells.push(j)},{address:b,includeEmpty:!0,excludeHidden:!1}),h.onDone?.(),_.rows.length===0&&_.rows.push({cells:[]});const k=[];for(let D=0;D<y.length;D++){const O=y[D],H=v.get(O);k.push(O);let z="";const j=Object.keys(H);for(let q=0;q<j.length;q++){z+="        ",q===0&&(z+="{");const P=j[q];z+=`${P}:${H[P]};`,q===j.length-1?z+="}":z+=`
`}k.push(z)}const F=[`<div clipboard-uuid=xxx>
<html
  xmlns:v="urn:schemas-microsoft-com:vml"
  xmlns:o="urn:schemas-microsoft-com:office:office"
  xmlns:x="urn:schemas-microsoft-com:office:excel"
  xmlns="http://www.w3.org/TR/REC-html40"
>`];F.push(`<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Excel.Sheet>
<meta name=Generator content="Microsoft Excel 15">`),F.push(`<style>
table
        {mso-displayed-decimal-separator:"\\.";
        mso-displayed-thousand-separator:"\\,";}
@page
        {margin:.75in .25in .75in .25in;
        mso-header-margin:.3in;
        mso-footer-margin:.3in;
        mso-horizontal-page-align:center;}
tr
        {mso-height-source:auto;}
col
        {mso-width-source:auto;}
br
        {mso-data-placement:same-cell;}`),k.length>0&&F.push(k.join(`
`)),F.push("</style>"),F.push("</head>"),F.push("<body>"),F.push("<table>"),F.push("<!--StartFragment-->");const L=D=>{let O=(z=>{let j="";return z&&z.attributes&&z.attributes.length!==0&&z.attributes.forEach((q,P)=>{j.length>0&&(j+=" "),j+=`${P}=${q}`}),j})(D);O.length>0&&(O=" "+O);let H=(z=>{let j="";return z&&z.styles&&z.styles.length!==0&&(z.styles.forEach((q,P)=>{j.length>0&&(j+=";"),j+=P+":"+q}),j.length>0&&(j=`style='${j}'`)),j})(D);return H.length>0&&(H=" "+H),`${O}${H}`},N=[];return _.cols?.forEach(D=>{F.push(`  <col${L(D)}>`)}),_.rows.forEach(D=>{F.push(`  <tr${L(D)}>`);const O=[];D.cells.forEach(H=>{F.push(`    <td${L(H)}>${H.htmlText??H.plainText??""}</td>`);const z=`${V.castToString(H.plainText??"")?.replace(/"/g,'""')}`;O.push(z)}),N.push(O.join("	")),F.push("  </tr>")}),F.push("<!--EndFragment-->"),F.push("</table>"),F.push("</body>"),F.push("</html>"),F.push("</div>"),[F.join(`
`),N.join(`
`).concat(`
`)]})(new NC(e),e.getRange(i));l=u??null,a=d??null};return{copyTo(u,d){const h={...r,...d};return d.isCut,o(u,h)},getMarkOptions:()=>r,getSource:()=>s,getName:()=>n,getCoords:()=>i,toText:()=>(c(),a),toHtml:()=>(c(),l),toImage:()=>null,isISnapshot:!0}},Ea=(s,e)=>Math.round(s*e),vm=(s,e,t)=>{const n=[],r=[];if(!s||s.length===0)return{sizes:n,hidden:r};if(!e||!t)return console.warn("_HeaderUtils:default size and scaleFactor should be available"),{sizes:n,hidden:r};let o=0,i=0,l=0,a=null,c=-2;for(let u=0;u<s.length;u++){const d=s[u],h=d.min,f=d.max;o=n.length===0?0:n[n.length-1].runningOffsetMax,n.length>0&&n[n.length-1].spanSize>0&&o++,i<d.min&&n.push({indexMin:i,indexMax:h-1,runningOffsetMin:o,runningOffsetMax:Math.round(o+(h-i)*e*t)-1,runningHiddenRuns:l,spanSize:Math.round(e*t)});const g=n.length,m=n[g-1];o=g===0?0:m.runningOffsetMax,g>0&&m.spanSize>0&&o++;let p=0;d.value.h||(p=Ea(d.value?.sz??e,t));const w=p===0?0:-1;p===0&&(l+=f-h+1,c+1===h?a.max=f:(a={min:h,max:f,value:!0},r.push(a)),c=f),g>0&&m.spanSize===p&&m.indexMax+1===h?(m.indexMax=f,m.runningHiddenRuns=l,m.runningOffsetMax=m.runningOffsetMin+(f+1-m.indexMin)*p+w):n.push({indexMin:h,indexMax:f,runningOffsetMin:o,runningOffsetMax:Math.round(o+(f+1-h)*p)+w,runningHiddenRuns:l,spanSize:p}),i=f+1}return{sizes:n,hidden:r}};function ku(s,e,t){t!==void 0&&(t!==null?s[e]=t:delete s[e])}const Nu=()=>{},Cm=()=>0,OC=()=>!1,Fw=(s,e,t,n)=>{if(n!==void 0){if(n===null)return null;if(n?.isICellHeader)return n._headerState;if(n){const r=n,o={...t};let i,l=r.hidden,a=r.size;if(r.size!==void 0){if(typeof a=="function"){const c=t?.sz===void 0?s.getDefaultSize():t?.sz*s.getScaleFactor();a=a?.(c)}if(typeof a=="string"&&(a=ys(a,e.getNormal().getFont().getSize(),"px")),typeof a=="number"){const c=s.getMinSize(),u=s.getMaxSize();a=Math.max(c,Math.min(V.roundAccurately(a,c),u)),r.relativeSize!==!0&&(a/=s.getScaleFactor()),isNaN(a)&&(console.warn("headerSize can not be NaN"),a=void 0),a===0&&(l=!0,a=void 0),i=!r.autoSize}else a===null?(a=null,i=!r.autoSize):a!==void 0&&(console.warn("headerSize can not be type",a),a=void 0)}return ku(o,"sz",a),ku(o,"h",l),ku(o,"csz",i),Object.keys(o).length===0?null:o}}};class uh{constructor(e,t,n){this._sheetHeader=e;const r=this._sheetHeader.getSheet().getStyles();this._styles=r,this._headerState=t,this._template=n}getSize(){const e=this._headerState?.sz;return Math.round(e===void 0?this._sheetHeader.getDefaultSize():e*this._sheetHeader.getScaleFactor())}getDisplayText(){return""+this.asCell().getValue()}getOrientation(){return this._sheetHeader.getOrientation()}isHidden(){return this._headerState?.h??!1}isCustomSize(){return this._headerState?.cs??!1}getSheetHeader(){return this._sheetHeader}getStyle(){return this._headerState?.s??this._styles.getNormal()}asCell(){return this._cellTemplate||(this._cellTemplate=this._sheetHeader.getSheet().createTemporaryCell({style:this.getStyle(),...this._template})),this._cellTemplate}getSizeRelative(){return this.getSize()/this._sheetHeader.getScaleFactor()}createTemporaryCellHeader(e){const t=Fw(this._sheetHeader,this._sheetHeader.getSheet().getStyles(),this._headerState,e);return new uh(this._sheetHeader,t,this._template)}isEqual(e){if(!e)return!1;if(e===this)return;const t=e;if(!t.isICellHeader)return!1;const n=this._headerState,r=t._headerState;return n===r||!(n&&!r||r&&!n)&&this.getSize()===t.getSize()&&this.isCustomSize()===t.isCustomSize()&&this.isHidden()===t.isHidden()&&this.getStyle()===t.getStyle()}isEmpty(){const e=this._headerState;return!e||e.sz===void 0&&e.csz===void 0&&!e.cs&&e.h===void 0&&!(!e.s||e.s!==this._styles.getNormal()||e.cs)}get isICellHeader(){return!0}}const Ll="The columns are protected. To make a change, unprotect the sheet. You might be requested to enter a password.",Bl="The rows are protected. To make a change, unprotect the sheet. You might be requested to enter a password.",yo="Rows",bo="Columns";class xm{constructor(e){if(this._emitter=null,this._closed=!1,this._scaleFactor=1,this._defaultSize=-1,this._defaultCustomSize=-1,this._defaultPxSize=1,this._isColumn=!0,this._indexedSizes=[],this._indexedHidden=[],this._headerRunCoords=null,this._hasCustomFormats=!1,this._hasStyles=!1,this._hasHidden=!1,this._lastHeaderRead=null,this._readCache=null,this._lastVisibleRunsRead=null,this._lastVisibleRunCoords=null,this._options={isProtected:()=>!1,getUpdateId:()=>null,scaleFactor:()=>1,defaultSize:()=>100,minSize:()=>0,maxSize:()=>500,orientation:B.Orientation.Column,createCellHeader:(i,l,a)=>new uh(i,l,a),...e},!this._options.sheet)throw new Error("An ISheet must be provided");if(this._emptyHeader=this._options.createCellHeader(this,null,null),this._scaleFactor=this._options.scaleFactor(),this._defaultSize=this._options.defaultSize(),this._defaultSize<=0)throw new Error("defaultSize must be greater than 0");this._defaultPxSize=Ea(this._defaultSize,this._scaleFactor);const t=this._options.orientation===B.Orientation.Column;this._isColumn=t;const n=this._options.maxSheetCoords??{colStart:0,rowStart:0,colEnd:Number.MAX_SAFE_INTEGER,rowEnd:Number.MAX_SAFE_INTEGER};this._maxSheetCoords=n;const r=t?n.colEnd:n.rowEnd;this._maxDataIndex=r,this._maxRunCoords={min:0,max:r},this._maxDataRange=this.getRange(this._maxRunCoords),this._maxRangeCoords={colStart:0,rowStart:0,colEnd:t?r:0,rowEnd:t?0:r};const o=this;this._options.setContainerShiftedCallback&&this._options.setContainerShiftedCallback((i,l)=>{l<0?o._deleteHeaders(i,-l):o._insertHeaders(i,l)}),this._options.sheet&&(this._sheetRemoveListener=this._options.sheet.addListeners({onProtectionChange(){},onSelectionChange(i){o._selection=i.getSelection().getCoords(),o._selectionRuns=null},onStyleChange:()=>{},onViewChange(){const i={runs:o._headers};o._invalidSizes(),o._emitter.notify("onSizesChange",{params:i})}},{transactional:!1}),o._selection=o._options.sheet.getSelection().getCoords()),this._transactions=this._options.transactions??new ir({transient:!0}),this._emitter=new wn(o,this._transactions),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(i){o._lastHeaders!==i.headers&&o._onHeaderChange()}}),this.fromJSON(this._options?.json)}addListeners(e,t){return this._emitter.addListeners(e,t)}_invalidSizes(){const e=this._defaultCustomSize===-1?this._options.defaultSize():this._defaultCustomSize,t=this._options.scaleFactor();if(e!==this._defaultSize||t!==this._scaleFactor){this._defaultSize=e,this._scaleFactor=t,this._defaultPxSize=Ea(e,t);const n=vm(this._headers,e,t);this._indexedSizes=n.sizes,this._indexedHidden=n.hidden,this._lastVisibleRunsRead=null,this._lastVisibleRunCoords=null}}_onHeaderChange(){this._lastHeaders=null;const e=this._headers,t=this._getState();this._defaultCustomSize=t.defaultCustomSize;const n=this._defaultCustomSize===-1?this._options.defaultSize():this._defaultCustomSize;this._defaultSize=n;const r=this._scaleFactor;this._defaultPxSize=Ea(n,r);const o=vm(e,n,r);this._indexedSizes=o.sizes,this._indexedHidden=o.hidden,this._lastHeaderRead=null,this._readCache=k0(this._lastHeaders),this._lastVisibleRunsRead=null,this._lastVisibleRunCoords=null;const i=this._options.sheet.getStyles().getNormal();let l=!1,a=!1,c=!1,u=-1;for(let f=e.length-1;f>=0;f--){const g=e[f],m=g.value,p=m.s,w=m.csz||m.sz!==n;u!==-1||!w&&p===i||(u=g.max),l=l||m.cs,a=a||m.s!==i,c=c||m.h||m.sz===0}u=Math.min(u??0,this._maxDataIndex);const d=Math.min(e[0]?.min??u,u);this._headerRunCoords=Object.freeze({min:d,max:u}),this._hasCustomFormats=l,this._hasStyles=a,this._hasHidden=c;const h=t.runs;this._emitter.notify("onSizesChange",{params:h})}getSheet(){return this._options.sheet}getOrientation(){return this._isColumn?B.Orientation.Column:B.Orientation.Row}getTextAt(e){return this._options.getTextAt?.(e)??e+""}_scanHeaders(e,t,n,r,o,i){const l=o?.min??null,a=o?.max??null,c=i?.includeEmpty??!1,u=i?.includeStyles??!1,d=i?.excludeHidden??!1,h=i?.includeSizes??!1,f=this,g=this._options.sheet.getStyles().getNormal(),m=this._defaultSize,p=this._scaleFactor,w=this._emptyHeader;let S;const b={getCoords(){if(!S)throw new Error(_s);return{min:S.min,max:S.max}},getIndex:()=>S.min,getCellHeader(){if(!S)throw new Error(_s);return S.value?n(f,S.value):w},getA1(y){if(!S)throw new Error(_s);return this._parseHeaderRangeAddress({min:l+y,end:l+y})??S}},v=Ig(t,y=>{const _=y.value;if(!c&&!_)return;let C=c;if(h&&!C&&_&&(_.csz||_.sz!==m)&&(C=!0),u&&!C&&_&&(_.s&&_.s!==g||_.cs)&&(C=!0),_&&_.h===!0&&(C=!d),!C)return;let E=m;y.value&&(E=y.value.h?0:y.value?.sz??m),E*=p,S=y;const x=e(E,b);return x&&x.break?x:void 0},l,a);return S=null,v}getRange(e,t){if(!e)throw new Error(Ss);const n=this,r=this._parseHeaderRangeAddress(e);if(r.min<0||r.max>this._maxDataIndex)return function(a){return Object.freeze({getCoords:()=>null,getOrientation:()=>a.getOrientation(),toString:()=>rn,getA1:()=>rn,getCount:Cm,getVisibleCount:Cm,isEntireHeaders:OC,forEach:Nu,forEachSpan:Nu,forEachVisibleSpan:Nu,getUsedRange:gt,getSnapshot:gt,updateHeaders:gt,clear:gt,setHidden:gt,setSize:gt,at:gt,doBatch:gt,getSheetHeader:()=>a,isICellHeaderRange:!0})}(this);const o=(a,c,u,d=n._options.createCellHeader)=>{let h=r;if(c?.address){const g=n._parseHeaderRangeAddress(c?.address);if(g&&(h=Rg(r,g),!h))return}const f=this._scanHeaders(a,u,d,t,h,c);if(f&&f.break)return f.break},i=()=>{const a=n._isColumn?{colStart:r.min,colEnd:r.max}:{rowStart:r.min,rowEnd:r.max};return Nr(a,n._maxRangeCoords)??rn},l={getCoords:()=>r,getA1:i,toString:i,forEach:(a,c)=>{let u=Number.MAX_SAFE_INTEGER,d=null;const h={getIndex:()=>u,getCellHeader:()=>d.getCellHeader(),getA1:f=>d.getA1(f),getCoords:()=>d.getCoords()};return o((f,g)=>{d=g;for(let m=r.min;m<r.max;m++)u=m,a(f,h)},c,this._headers,()=>this.at(void 0))},forEachSpan:(a,c)=>o(a,c,this._headers),forEachVisibleSpan:(a,c)=>{const u=r?.min??null,d=r?.max??null;let h;if(h=c?.includeHidden?a(u,d):Ig(this._indexedHidden,f=>{if(f.value)return;const g=a(f.min,f.max);return g&&g.break?g:void 0},u,d),h&&h.break)return h.break},updateHeaders:(a,c)=>(n.updateHeaderPairs([{address:r,update:a}],{description:c?.description??`Update ${n._isColumn?bo:yo} ${toString()}`,...c}),l),setHidden:a=>(n.setHidden(r,a),l),getUsedRange:a=>{const c=n._headerRunCoords;return!c||c.min<0||c.max>n._maxDataIndex?null:Rg(c,r)?n.getRange(c,a):null},getCount:()=>r.max-r.min+1,getVisibleCount:()=>n.getVisibleCount(r.min,r.max),isEntireHeaders:()=>{const a=n._maxRunCoords;return!(r.min>a.min||r.max<a.max)},getSnapshot:a=>this._getSnapshot(r,a),clear:()=>(n._clear(r),l),setSize:(a,c)=>(n.setSize(r,a,c),l),at:a=>n.at(r.min+a),getOrientation:()=>n.getOrientation(),doBatch:(a,c)=>this.doBatch(u=>a(u),c),getSheetHeader:()=>n,isICellHeaderRange:!0};return Object.freeze(l)}getSelectedRange(e){const t=(n=>{if(!n)return null;let r=J.cellToRange(n.cell);for(let o=0;o<n.ranges.length;o++)r=J.unionRanges(r,n.ranges[o]);return r})(this._options.sheet.getSelection().getCoords());return this.getRange(t,e)}getUsedRange(e){return this.getRange(this._headerRunCoords,e)}getEntireRange(e){return e?this.getRange(this._maxRangeCoords,e):this._maxDataRange}at(e){if(e<0||e>this._maxDataIndex)return this._emptyHeader;if(this._lastHeaderRead?.offset===e)return this._lastHeaderRead.header;const t=N0(e,this._readCache);if(!t)return this._emptyHeader;const n=this._options.getTextAt?.(e)??e+"",r=this._options.createCellHeader(this,t,{value:n});return this._lastHeaderRead={offset:e,header:r},r}updateHeaderPairs(e,t){if(this.isProtected())throw new Error(this._isColumn?Ll:Bl);return this._updatePairsInternal(e,t)}_parseHeaderRangeAddress(e){if(e==null)throw new Error("Must specify a range.");const t=((n,r,o)=>{if(n==null)return null;let i={};if(typeof n=="number")i.colStart=n,i.colEnd=n,i.rowStart=n,i.rowEnd=n;else if(typeof n=="string"){if(r){if(n.match(/[0-9]+/))throw new Error("Invalid range address for header orientation")}else if(n.match(/[a-zA-Z]+/))throw new Error("Invalid range address for header orientation");let a=qn(n,o);if(!a){const c=Q0(n.toUpperCase(),!0);c?.colIndex!==void 0&&(i.colStart=c.colIndex,i.colEnd=c.colIndex),c?.rowIndex!==void 0&&(i.rowStart=c.rowIndex,i.rowEnd=c.rowIndex)}i={...i,...a}}const l={min:void 0,max:void 0};return r?(l.min=n.min??n.colStart??i.colStart,l.max=n.max??n.colEnd??i.colEnd):(l.min=n.min??n.rowStart??i.rowStart,l.max=n.max??n.rowEnd??i.rowEnd),l.min===void 0||l.max===void 0?null:l})(e,this._isColumn,this._maxRangeCoords);if(!t)throw new Error("Invalid header range.");return t}update(e,t,n){if(!e||(Array.isArray(e)||(e=[e]),e.length===0))return;const r=[];for(let o=0;o<e.length;o++){const i=this._parseHeaderRangeAddress(e[o]);this.getRange(i).forEachSpan((l,a)=>{const c=a.getCoords();r.push({address:c,update:t})},{includeEmpty:!0})}return this.updateHeaderPairs(r,n),this}setSize(e,t=null,n){(n?.relativeSize??!1)||typeof t!="number"||(t+="px");const r={size:t,autoSize:n?.autoSize??!1},o=`Resize ${this._isColumn?bo:yo}`;return this.update(e,r,{description:o,...n}),this}setHidden(e,t=null){const n={hidden:t},r=`${t?"Unhide":"Hide"} ${this._isColumn?bo:yo}`;return this.update(e,n,{description:r}),this}_clear(e,t){const n="Clear "+(this._isColumn?"Column Headers":"Row Headers");this.updateHeaderPairs([{address:e,update:null}],{description:n,...t})}_getSnapshot(e,t){if(e.min<0)return V.EmptyArray;t=Object.freeze({...t});const n=this,r=this._getState(),o=(this._isColumn?"Column":"Row")+" Headers";return{copyTo(i,l){const a={...t,...l},c=i.getCoords(),u=c.min-e.min,d=[];if(n._scanHeaders((h,f)=>{const g=f.getCoords();d.push({address:{min:g.min+u,max:g.max+u},update:f.getCellHeader()})},r.headers,n._options.createCellHeader,null,e,{includeSizes:!0,includeStyles:!0}),!a.fitDestination){let h=e.max-e.min+1,f=c.max-c.min+1,g=V.roundAccurately(f/h);if(g>1&&f%h===0){const m=d.length;for(let p=0;p<g;p++)for(let w=0;w<m;w++){const S=d[w],b=S.address,v=(p+1)*h;d.push({address:{min:b.min+v,max:b.max+v},update:S.update})}}}if(i.doBatch(()=>{i.clear(),i.getSheetHeader()._updatePairsInternal(d)},o),a.isCut){const h=n._maxRunCoords;e.min<=h.min&&e.max>=h.max&&n._clear(e)}return c},getCoords:()=>e,toText:()=>null,toHtml:()=>null,toImage:()=>null,getSource:()=>n,getName:()=>o,isISnapshot:!0}}isProtected(){return this._options?.isProtected()??!1}getScaleFactor(){return this._options.scaleFactor()??1}get _headers(){return this._lastHeaders===null&&(this._lastHeaders=this._getState()?.headers),this._lastHeaders}_updatePairsInternal(e,t){if(!e||e.length===0)return null;const n=t?.skipCustomSize??!1,r=this._isColumn,o=this.getSheet().getStyles(),i=this._beginCommit({description:t?.description??`Update ${r?bo:yo}`});let l=[...this._getState().headers],a=!1,c=!1;const u=r?pe.Edge.Top:pe.Edge.Left;pe.oppositeEdge(u);const d=r?pe.Edge.Right:pe.Edge.Bottom;pe.oppositeEdge(d);const h=this,f=(v,y)=>{if(this.isProtected())throw new Error(this._isColumn?Ll:Bl);c=c||y===null,!c&&y&&(c=!!y.isICellHeader||y?.size!==void 0||y?.hidden!==void 0),a=a||y===null||y?.style!==void 0||y?.isICellHeader;const _={onUpdate:(C,E)=>n&&C&&C.csz?C:Fw(h,o,C,E),onSplit:C=>[C.value,C.value],onMerge:(C,E,x,R)=>{if(!(C&&!E||!C&&E||!C&&!E)&&C.sz===E.sz&&C.csz===E.csz&&C.h===E.h&&C.cs===E.cs)return C},isCull:(C,E,x)=>C===void 0};l=gr(sd(l,{min:v.min,max:v.max,value:y},_))},g=e.length,m=new Array(g);for(let v=0;v<g;v++){const y=e[v],_=this._parseHeaderRangeAddress(y.address);if(_.min<0||_.max>this._maxDataIndex)throw new Nt(La);f(_,y.update),m[v]=_}let p=!1,w=l.length;if(w>0&&l[0].min===0&&l[w-1].max===this._maxDataIndex){let v=l[0],y=!1,_=-1;for(let x=0;!y&&x<w;x++){const R=l[x],I=R.min;if(_+1!==I){y=!0;continue}const A=R.max;_=A,v.max-v.min<A-I&&(v=R)}y||(this._defaultCustomSize=v.value?.sz??-1,p=!0);const C=this._defaultCustomSize===-1?this._options.defaultSize():this._defaultCustomSize,E=[];for(let x=0;x<w;x++){const R=l[x],I=R.value;if(I===null)continue;const A=Object.keys(I);A.length!==0&&(A.length!==1||I.sz===void 0||I.sz!==null&&I.sz!==C)&&E.push(R)}l=E,w=l.length}const S=[],b=this._defaultSize;for(let v=0;v<w;v++){const y=l[v],_=y.value;if(_===null)continue;let C=!1;_.sz!==void 0&&_.sz!==b&&(C=!0),_.csz&&(C=!0),_.h&&(C=!0),_.cs&&(C=!0),C&&S.push(y)}return l=S,w=l.length,p&&h._invalidSizes(),this._updateState({headers:l,defaultCustomSize:this._defaultCustomSize,runs:m}),i.commit(),m}hasCustomFormats(){return this._hasCustomFormats}hasCustomStyles(){return this._hasStyles}hasHidden(){return this._hasHidden}getDefaultSize(){return this._defaultPxSize}getMaxSize(){return Math.ceil(this._options.maxSize()*this._options.scaleFactor())}getMinSize(){return Math.floor(this._options.minSize()*this._options.scaleFactor())}findOffset(e){return((t,n,r)=>{if(n<0)return 0;if(!t||t.length===0)return n*r;const o=t[t.length-1];if(n>o.indexMax)return o.runningOffsetMax+Math.round((n-o.indexMax-1)*r+(o.spanSize!==0?1:0));const i=t[t.length===1?0:V.findEqualOrGreater(t,n,a=>a.indexMax)],l=n-i.indexMin;return i.runningOffsetMin+l*i.spanSize})(this._indexedSizes,e,this._defaultPxSize)}findIndex(e){return Math.min(Math.max(0,((t,n,r)=>{if(!t||t.length===0)return Math.floor(n/r);const o=t[t.length-1];if(n>o.runningOffsetMax)return o.indexMax+Math.ceil((n-o.runningOffsetMax)/r);const i=t[t.length===1?0:V.findEqualOrGreater(t,n,a=>a.runningOffsetMax)];if(i.spanSize===0)return Math.max(0,i.indexMin-1);const l=n-i.runningOffsetMin;return i.indexMin+Math.floor(l/i.spanSize)})(this._indexedSizes,e,this._defaultPxSize)),this._maxDataIndex)}findVisibleIndex(e){return this._lastVisibleRunsRead===e||(this._lastVisibleRunCoords=((t,n,r=Number.MAX_SAFE_INTEGER)=>{if(!t||t.length===0)return{min:n,max:n};let o=t.length-1,i=t[o];if(n>i.indexMax){const a=n-i.runningHiddenRuns;return{min:a,max:a}}o=t.length===1?0:V.findEqualOrGreater(t,n,a=>a.indexMax),i=t[o];const l=i.spanSize===0?Math.max(-1,i.indexMin-1-(t[o-1]?.runningHiddenRuns??1)):n-i.runningHiddenRuns;return{min:l,max:l+Math.min(r+1,i.spanSize===0?1:0)}})(this._indexedSizes,e,this._maxDataIndex),this._lastVisibleRunsRead=e),this._lastVisibleRunCoords}getSpanSize(e,t=e+1){return this.findOffset(t)-this.findOffset(e)}getVisibleCount(e,t){if(e>t)throw new Error("Invalid arguments.");if(e<0||t>this._maxDataIndex)throw new Nt;return this._hasHidden?((n,r,o)=>{let i=o-r+1;if(n.length===0)return i;let l=n.length-1,a=n[l];if(r>a.indexMax)return i;l=n.length===1?0:V.findEqualOrGreater(n,r,d=>d.indexMax),a=n[l];let c=a.runningHiddenRuns;if(a.spanSize===0&&r<=a.indexMax){const d=a.indexMax-a.indexMin+1;i-=Math.min(d,a.indexMax-r+1)}o>a.indexMax&&l<n.length&&(l=V.findEqualOrGreater(n,o,d=>d.indexMax),a=n[Math.min(l,n.length-1)]);let u=a.runningHiddenRuns;if(a.spanSize===0&&a.indexMin<=o){const d=a.indexMax-a.indexMin+1;i-=Math.min(d,o-a.indexMin+1),u-=d}return i-=u-c,i})(this._indexedSizes,e,t):t-e+1}isSelectedAll(e){const t=this.getSelectedRuns();if(t.length===0)return!1;const n=t[V.findEqualOrGreater(t,e,r=>r.max)];return!(!n||e<n.min||e>n.max)&&n.value.isSelectedAll}isSelected(e){const t=this.getSelectedRuns();if(t.length===0)return!1;const n=t[V.findEqualOrGreater(t,e,r=>r.max)];return!(!n||e<n.min||e>n.max)}getSelectedRuns(){let e=this._selectionRuns;return e||(this._selection&&(e=((t,n,r)=>{let o=[];n?.ranges&&n.ranges.length>0?o=n.ranges:n?.cell&&(o=[J.cellToRange(n?.cell)]);let i=[];const l=t.getOrientation()===B.Orientation.Column;for(let a=0;o&&a<o.length;a++){const c=o[a],u=l?c.colStart:c.rowStart,d=l?c.colEnd:c.rowEnd,h=l?c.rowStart:c.colStart,f=l?c.rowEnd:c.colEnd,g=l?r.rowStart:r.colStart,m=l?r.rowEnd:r.colEnd,p=h<=g&&f>=m;i=gr(sd(i,{min:u,max:d,value:{isSelectedAll:!1}},{onUpdate:(w,S)=>{const b=od(w,S);return b.isSelectedAll=w?.isSelectedAll||p,b}}))}return i})(this,this._selection,this._maxSheetCoords)),e||(e=V.EmptyArray)),this._selectionRuns=e,this._selectionRuns}hiddenHeadersAt(e,t=!1){if(this._indexedSizes.length===0)return 0;let n=this._indexedSizes.length===1?0:V.findEqualOrGreater(this._indexedSizes,e,o=>o.indexMax),r=this._indexedSizes[n];return!r||r.spanSize!==0||r.indexMin>e||r.indexMax<e?0:t?e-r.indexMin+1:r.indexMax-e+1}_insertHeaders(e,t){if(this.isProtected())throw new Error(this._isColumn?Ll:Bl);if(t<=0)return;const n=this._beginCommit({description:`Insert ${this._isColumn?bo:yo}`}),r=this._getState();let o=[...r.headers];o=gr(((l,a,c=1)=>{const u=V.findEqualOrGreater(l,a,g=>g.max),d=l.slice(0,u),h=[],f=[];if(!l[u])return{preceding:d,modified:f,trailing:h};l[u].min>=a?h.push({...l[u],min:l[u].min+c,max:l[u].max+c}):f.push({...l[u],min:l[u].min,max:l[u].max+c});for(let g=u+1;g<l.length;g++)h.push({...l[g],min:l[g].min+c,max:l[g].max+c});return{preceding:d,modified:f,trailing:h}})(o,e,t));const i=[{min:e,max:e+t}];this._updateState({headers:o,runs:gr(To([...r?.runs??[],...i]))}),n.commit()}_deleteHeaders(e,t){if(this.isProtected())throw new Error(this._isColumn?Ll:Bl);const n=this._beginCommit({description:`Delete ${this._isColumn?bo:yo}`}),r=this._getState();let o=[...r.headers];o=gr(jy(o,e,t));const i=[{min:e,max:e+t}];this._updateState({headers:o,runs:gr(To([...r?.runs??[],...i]))}),n.commit()}beginCommit(e){return this._beginCommit(typeof e=="string"?{description:e}:e)}doBatch(e,t){return this._transactions.doBatch(e,typeof t=="string"?{description:t}:{description:"Update Header",...t})}isClosed(){return this._closed}close(){this._sheetRemoveListener?.(),this._emitter.close(),this._transactionsRemoveListener?.(),this._closed=!0}_getState(){return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(e)}_updateState(e){const t=this._transactions.beginCommit();try{t.updateState(this,e),this._onHeaderChange(),t.commit()}catch(n){throw t.rollback(),n}}fromJSON(e){const t=e||{};this._defaultCustomSize=t.defaultSize??-1,this._defaultCustomSize<=0&&(this._defaultCustomSize=-1),this._invalidSizes();const n=this._options.sheet.getStyles().beginPersist();try{const r=[],o=t.headers?t.headers.length:0,i=this._maxDataIndex;for(let l=0;l<o;l++){let a=t.headers[l];if(a.min>=i)continue;let c={min:a.min,max:Math.min(a.max,i)};const u={};a.sz!==void 0&&a.sz!==-1&&(u.sz=a.sz),a.h!==void 0&&(u.h=a.h),a.csz!==void 0&&(u.csz=a.csz),a.cs!==void 0&&(u.cs=a.cs),Object.keys(u).length===0&&(u.cs=!0),c.value=u,r.push(c)}this._updateState({headers:r,defaultCustomSize:this._defaultCustomSize})}finally{n.endPersist()}}toJSON(){if(this._headers.length===0&&this._defaultCustomSize===-1)return null;const e={headers:[]};if(this._defaultCustomSize!==-1&&(e.defaultSize=V.roundAccurately(this._defaultCustomSize,8)),this._headers.length===0)return e;const t=this._defaultCustomSize,n=this.getSheet().getStyles().beginPersist();for(let r=0;r<this._headers.length;r++){const o=this._headers[r],i=o.value;if(!i)continue;const l={min:o.min,max:o.max};i.sz!==void 0&&i.sz!==t&&(l.sz=V.roundAccurately(i.sz,8),i.csz!==void 0&&(l.csz=i.csz)),i.h===!0&&(l.h=i.h),Object.keys(l).length>2&&e.headers.push(l)}return n.endPersist(),e}}class Em{constructor(e,t){this._c=e,this._tvTl=t}tvTl(){return this._tvTl(this._c)}getCoords(){return this._c}}const DC=s=>{let e="";const t=pa,n=s.length;for(let r=0;r<n;r++){const o=s[r];o.type==="cell"?e+=t(o.value):e+=o.value}return e},LC=(s,e=0,t=0)=>{let n="";const r=rw,o=s.length;for(let i=0;i<o;i++){const l=s[i];l.type==="cell"?n+=r(l.value,e,t):n+=l.value}return n};class BC{constructor(e,t,n){this._c=e,this._tokens=t,this._references=n||V.EmptyArray}getFormulaTextAt(e,t,n=!1){return n?DC(this._tokens):LC(this._tokens,e,t)}getTokensAt(e,t,n){let r=this._tokens;return n!==void 0&&(r=((o,i)=>{const l=o.length,a=[];if(i===void 0)return V.EmptyArray;let c=-1,u=!1;for(let d=0;!u&&d<l;d++){const h=o[d],f=h.evalIndex??Number.MAX_SAFE_INTEGER;if(c===-1){if(f!==i)continue;c=d}f>i?u=!0:a.push(h)}u=!1;for(let d=c-1;!u&&d>=0;d--){const h=o[d];(h.evalIndex??Number.MAX_SAFE_INTEGER)>i?u=!0:a.unshift(h)}return a.length>1&&a[0].type==="whitespace"&&a.shift(),a.length>1&&a[a.length-1].type==="whitespace"&&a.pop(),a})(r,n)),r=((o,i=0,l=0)=>{const a=o.length,c=new Array(a);for(let u=0;u<a;u++){const d=o[u];if(d.type!=="cell"){c[u]=d;continue}const h={...d},f={...h.value};h.value=f,c[u]=h,f.colIndex===Number.MIN_SAFE_INTEGER||f.$colIndex||(f.colIndex+=l),f.rowIndex===Number.MIN_SAFE_INTEGER||f.$rowIndex||(f.rowIndex+=i)}return c})(r,e,t),r}getReferencesAt(e,t){return((n,r=0,o=0)=>{const i=n.length,l=new Array(i);for(let a=0;a<i;a++){const c=n[a];if(typeof c=="string"||c instanceof He.Known){l[a]=c;continue}const u={...c};l[a]=u,u.colStart===Number.MIN_SAFE_INTEGER||u.$colStart||(u.colStart+=o),u.rowStart===Number.MIN_SAFE_INTEGER||u.$rowStart||(u.rowStart+=r),u.colEnd===Number.MIN_SAFE_INTEGER||u.$colEnd||(u.colEnd+=o),u.rowEnd===Number.MIN_SAFE_INTEGER||u.$rowEnd||(u.rowEnd+=r)}return l})(this._references,e,t)}toJSON(){const e=this._c;return[Pr(e),this.getFormulaTextAt(e.rowStart,e.colStart)]}getCoords(){return this._c}}let zC=class Td{constructor(e,t,n){this.groupId=e,this.uuid=t,this.noShift=n}onRemove(e){}getShifted(e){if(!e.after)return null;const t=this.noShift;return t?void 0:{...e.after,value:new Td(this.groupId,this.uuid,t)}}getSplit(e,t){}copyTo(e,t){return new Td(this.groupId,this.uuid,this.noShift)}canTile(e,t){return!1}},PC=class kd{constructor(e,t,n,r,o,i,l,a,c,u){this.uuid=e,this.spatialsIds=t,this.isRanges=r,this.coords=n,this.sheet=o,this.generation=i,this.handler=l,this.handlerW=a,this.removeListener=c,this.options=u}delete(){this.removeListener()}createRangeEvent(e,t){const n=this;let r;const o=()=>{if(r)return r;const l=n.sheet,a=n.isRanges,c=n.coords;return t||!c||c.length===0?Fr(l,l.getEntireRange().getCoords(),null,t):a?(r=l.getRanges(n.coords),r):(r=l.getRange(n.coords[0]),r)},i=e.trigger;return{getSource:o,trigger:i,isTransactional:e.isTransactional??!0,toString:()=>`SheetRangeEvent: ('${i}', ${o().toString()})`,timeStamp:e.timeStamp??Date.now()}}notify(e,t){const n=this.createRangeEvent(e,t),r=this.handler??this.handlerW.deref();try{r?.(n)}catch(o){console.warn(o)}this.options?.once&&this.removeListener()}processRemove(e){const t=this.spatialsIds,n=t.indexOf(e.value.uuid);console.assert(n!==-1,"invalid uuid");const r=this.coords,o=r.slice(0,n).concat(r.slice(n+1)),i=t.slice(0,n).concat(t.slice(n+1));return new kd(this.uuid,i,o,this.isRanges,this.sheet,this.generation,this.handler,this.handlerW,this.removeListener,this.options)}processShift(e){const t=this.spatialsIds.indexOf(e.value.uuid);console.assert(t!==-1,"invalid uuid");const n=[...this.coords];return n[t]={...n[t],...J.sanitizeRange(e)},new kd(this.uuid,this.spatialsIds,n,this.isRanges,this.sheet,this.generation,this.handler,this.handlerW,this.removeListener,this.options)}processSplit(e){}processMerge(e){}};const Ow=Object.freeze({coords:J.EmptyCell,topLeft:zr.EmptyTopLeft}),HC=Object.freeze({cell:J.EmptyCell,ranges:V.EmptyArray,rangeIndex:0}),Fu=Object.freeze({selection:HC,topLeft:zr.EmptyTopLeft,freezePanes:Ow,showRowHeaders:!0,showColumnHeaders:!0,showRowGridlines:!0,showColumnGridlines:!0,rowHeaderStyle:an.HeaderTextStyle.One,columnHeaderStyle:an.HeaderTextStyle.A1,showFormulas:!1,showZeros:!0,zoomScale:100,gridLineColor:null});class Ou{constructor(e){if(this._emitter=null,!e?.sheet)throw new Error("SheetView requires a sheet.");const t=new wn(this);this._emitter=t,this._sheet=e.sheet,this.clear(!1),e.json&&this._fromJSON(e.json)}addListeners(e,t){return this._emitter.addListeners(e,t)}setTopLeft(e){return this._state.topLeft=Object.freeze({left:e?.left??this._state.topLeft.left,top:e?.top??this._state.topLeft.top}),this._emitter.notify("onTopLeftChange"),this}getTopLeft(){return this._state.topLeft}getFreezePanes(){return this._state.freezePanes}setFreezePanes(e){return this._state.freezePanes=this._mergeFreezePanes(e),this._emitter.notify("onFreezeSplitChange"),this}_mergeFreezePanes(e){return e?{...this._state.freezePanes,coords:{colIndex:e?.coords?.colIndex??this._state.freezePanes.coords.colIndex,rowIndex:e?.coords?.rowIndex??this._state.freezePanes.coords.rowIndex},topLeft:{left:e?.topLeft?.left??this._state.topLeft.left,top:e?.topLeft?.top??this._state.topLeft.top}}:Ow}isShowRowHeaders(){return this._state.showRowHeaders}setShowRowHeaders(e){return this._state.showRowHeaders=e,this._notifyAll(),this}isShowColumnHeaders(){return this._state.showColumnHeaders}setShowColumnHeaders(e){return this._state.showColumnHeaders=e,this._notifyAll(),this}isShowRowGridlines(){return this._state.showRowGridlines}setShowRowGridlines(e){return this._state.showRowGridlines=e,this._notifyAll(),this}isShowColumnGridlines(){return this._state.showColumnGridlines}setShowColumnGridlines(e){return this._state.showColumnGridlines=e,this._notifyAll(),this}getRowHeaderStyle(){return this._state.rowHeaderStyle}setRowHeaderStyle(e){return this._state.rowHeaderStyle=e,this._notifyAll(),this}getColumnHeaderStyle(){return this._state.columnHeaderStyle}setColumnHeaderStyle(e){return this._state.columnHeaderStyle=e,this._notifyAll(),this}getZoomScale(){return this._state.zoomScale}setZoomScale(e){return this._state.zoomScale=e,this._notifyAll(),this}isShowFormulas(){return this._state.showFormulas}setShowFormulas(e){return this._state.showFormulas=e,this._notifyAll(),this}isShowZeros(){return this._state.showZeros}setShowZeros(e){return this._state.showZeros=e,this._notifyAll(),this}getGridLineColor(){return this._state.gridLineColor}setGridLineColor(e){return this._state.gridLineColor=e,this._notifyAll(),this}setRangeSelection(e){return this._state.selection=e,this._emitter.notify("onRangeSelectionChange"),this}getRangeSelection(){return this._state.selection}getMovableSelection(){return this._movableSelection}setMovableSelection(e){const t=this._movableSelection;return this._movableSelection=Object.freeze(e??[]),V.isEqualArrays(t,this._movableSelection)||this._emitter.notify("onMovableSelectionChange"),this}selectMovables(e,t=!1){const n=new Set(this._sheet.getMovables().getItems());let r=null,o=!1;if(t){r=[...this._movableSelection];for(let i=e.length-1;i>=0;i--){const l=e[i];let a=r.indexOf(l);if(a!==i){if(o=!0,!n.has(l))throw new Error(`Movable ${l.getName()} not found in sheet.`);a!==-1&&r.splice(a,1),r.unshift(l)}}}else o=!V.isEqualArrays(e,this._movableSelection),r=[...e];o&&(this._movableSelection=r,this._emitter.notify("onRangeSelectionChange"),this._emitter.notify("onMovableSelectionChange"))}unselectMovables(e){const t=this._movableSelection,n=[];for(let r=0;r<t.length;r++){const o=t[r];e.indexOf(o)===-1&&n.push(o)}return t.length!==n.length&&(this._movableSelection=n,this._emitter.notify("onRangeSelectionChange"),this._emitter.notify("onMovableSelectionChange")),this}_notifyAll(){const e=this._emitter;e.notify("onRangeSelectionChange"),e.notify("onTopLeftChange"),e.notify("onFreezeSplitChange"),e.notify("onAnyChange")}toJSON(){const e={},t=Object.keys(this._state);for(let r=0;r<t.length;r++){const o=this._state[t[r]];o!=null&&o!==Fu[t[r]]&&(e[t[r]]=o)}delete e.movableSelection,delete e.gridLineColor,this._state.gridLineColor instanceof $t&&(e.gridLineColor=this._state.gridLineColor.toString()),delete e.topLeft,!this._state.topLeft||this._state.topLeft.left===0&&this._state.topLeft.top===0||(e.topLeft={left:this._state.topLeft.left??0,top:this._state.topLeft.top??0}),delete e.selection;const n=this._state.selection;if(n){let r={};!n.cell||n.cell.colIndex===0&&n.cell.rowIndex===0||(r.cell=Qi(n.cell)),n.ranges&&n.ranges.length>0&&(r.ranges=rh(n.ranges),n.rangeIndex!==void 0&&n.rangeIndex!==-1&&n.rangeIndex!==0&&(r.rangeIndex=n.rangeIndex)),Object.keys(r).length>0&&(e.selection=r)}if(delete e.freezePanes,this._state.freezePanes&&(this._state.freezePanes.coords.colIndex!==0||this._state.freezePanes.coords.rowIndex!==0)){const r={};this._state.freezePanes.coords.colIndex!==0&&(r.c=this._state.freezePanes.coords.colIndex),this._state.freezePanes.coords.rowIndex!==0&&(r.r=this._state.freezePanes.coords.rowIndex),this._state.freezePanes.topLeft.left!==0&&(r.x=this._state.freezePanes.topLeft.left),this._state.freezePanes.topLeft.top!==0&&(r.y=this._state.freezePanes.topLeft.top),e.freezePanes=r}return Object.keys(e).length===0?null:e}_fromJSON(e){let t=JSON.parse(JSON.stringify(e||{}));t?.zoomScale&&(t.zoomScale=V.roundAccurately(parseFloat(e.zoomScale),2));const n=r=>{const o=this._sheet.getRange(r).getBounds(),i=(t.zoomScale??100)/100;return{x:o.x*i,y:o.y*i,width:o.width*i,height:o.height*i}};if(typeof t?.gridLineColor=="string"&&(this._sheet?.getStyles()?t.gridLineColor=this._sheet.getStyles().parseColor(e.gridLineColor):console.warn("Style was created with no styles so gridLineColor can't be parsed.")),t.topLeft)if(typeof t.topLeft=="string"){const r=n(ds(t.topLeft));t.topLeft={left:r.x,top:r.y}}else t.topLeft=Object.freeze({left:t.topLeft?.left??t?.x??0,top:t.topLeft?.top??t?.y??0});if(t.selection){let r=ds(t.selection.cell??"A1");if(t.selection.cell=r,t.selection.ranges){let o=Math.max(0,Math.min(t.selection.rangeIndex??t.selection.ranges?.length-1,t.selection.ranges?.length-1));t.selection.rangeIndex=o;let i=!1;for(let l=0;l<t.selection.ranges.length;l++){const a=Bn(t.selection.ranges[l]);t.selection.ranges[l]=a,l===o&&r&&!J.isCellWithinRange(r,a)&&(i=!0)}if(i)for(let l=0;i&&l<t.selection.ranges.length;l++)J.isCellWithinRange(r,t.selection.ranges[l])&&(i=!1,t.selection.rangeIndex=l);i&&(t.selection.ranges.push(J.cellToRange(r)),t.selection.rangeIndex=t.selection.ranges.length-1)}else delete t.selection.rangeIndex}if(t.freezePanes){const r=t.freezePanes;if(typeof r.coords=="string"&&(r.coords=ds(r.coords)),typeof r.topLeft=="string"){const o=ds(r.topLeft),i=n({colIndex:o.colIndex+1,rowIndex:o.rowIndex+1}),l=n({colIndex:(r?.coords?.colIndex??-1)+1,rowIndex:(r?.coords?.rowIndex??-1)+1});r.topLeft={left:0,top:0},t.topLeft||(t.topLeft={top:0,left:0}),o.colIndex>0&&(r.topLeft.left=t.topLeft?.left??0,t.topLeft.left=i.x-l.x+r.topLeft.left),o.rowIndex>0&&(r.topLeft.top=t.topLeft?.top??0,t.topLeft.top=i.y-l.y+r.topLeft.top)}t.freezePanes={coords:{colIndex:r?.coords?.colIndex??t.freezePanes?.c??0,rowIndex:r?.coords?.rowIndex??t.freezePanes?.r??0},topLeft:{left:r?.topLeft?.left??t.freezePanes?.x??0,top:r?.topLeft?.top??t.freezePanes?.y??0}}}this.update(t)}clear(e=!0){return this._state={...Fu},this._movableSelection=Object.freeze([]),e&&this._notifyAll(),this}update(e){return this._state={...Fu,...this._state,...e},this._state.freezePanes=this._mergeFreezePanes(this._state.freezePanes),this._state.zoomScale=Math.min(400,Math.max(10,this._state.zoomScale)),this._notifyAll(),this}get isISheetView(){return!0}}async function Rm(){const{getCrypto:s}=await ao(async()=>{const{getCrypto:e}=await import("./BNJ3M4LVn1rfr1_R-Djaqnfqq.js");return{getCrypto:e}},[],import.meta.url);return s()}const Im=async(s,e,...t)=>{const n=$C(...t);return s.subtle.digest(e,n)},$C=(...s)=>{const e=s.reduce((r,o)=>r+o.byteLength,0),t=new Uint8Array(e);let n=0;return s.forEach(r=>{t.set(new Uint8Array(r),n),n+=r.byteLength}),t.buffer},Am=s=>{const e=new Uint8Array(s);let t="";for(let n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return btoa(t)},hr=class hr{static async generateSaltAndHash(e,t=hr.DefaultAlgo,n=hr.DefaultSpinCount){if(!e)return null;const r=(await Rm()).getRandomValues(new Uint8Array(16)),o=Am(r.buffer);return{salt:o,hash:await hr._convertPasswordToHash(e,o,t,n)}}static async verifyPassword(e,t,n=hr.DefaultAlgo,r=hr.DefaultSpinCount){if(!e||!t)throw new sr;return((o,i)=>{const l=o.length,a=i.length;let c=l===a?0:1;for(let u=0;u<Math.max(l,a);u++)c|=o.charCodeAt(u%l)^i.charCodeAt(u%a);return c===0})(await hr._convertPasswordToHash(e,t.salt,n,r),t.hash)}static async _convertPasswordToHash(e,t,n,r){const o=await Rm();n=n.toUpperCase();const i=(c=>{const u=new ArrayBuffer(2*c.length),d=new DataView(u);for(let h=0;h<c.length;h++)d.setUint16(2*h,c.charCodeAt(h),!0);return new Uint8Array(u)})(e),l=(c=>{const u=atob(c),d=new Uint8Array(u.length);for(let h=0;h<u.length;h++)d[h]=u.charCodeAt(h);return d.buffer})(t);let a=await Im(o,n,l,i.buffer);for(let c=0;c<r;c++){const u=new Uint32Array([c]).buffer;a=await Im(o,n,a,u)}return Am(a)}};hr.DefaultAlgo="SHA-512",hr.DefaultSpinCount=1e5;let Ga=hr;class Dw{constructor(e,t=!1){this._emitter=null,this._emitter=new wn(this),this.fromJSON(e),this._isReadOnly=t}async lock(e,t,n,r){if(this._isReadOnly)return this;if(this.isLocked()&&!this._isPaused)throw new Error("Cannot lock an already locked object. Use unlock first.");try{this._validatePassword()}catch{throw new Error("A password is already set. Unlock first to change.")}let o;if(t){const i=await Ga.generateSaltAndHash(t,n,r);o={salt:i.salt,hash:i.hash},n&&(o.algorithm=n),r&&(o.spinCount=r)}else o=null;return e=e??{},this._updateProperties(e),this._properties=e,this._password=o,this._emitter.notify("onLockChange"),this._emitter.notify("onChange"),this}async unlock(e){if(this._isReadOnly)throw new Error("Cannot unlock a readonly workbook.");return await this._validatePassword(e),this._clearProperties(),this._password=null,this._identities=null,this._password=null,this._emitter.notify("onLockChange"),this._emitter.notify("onChange"),this}checkPassword(e){return this._validatePassword(e)}hasPassword(){return this._password!==null}async pause(e){return this._emitter.notify("onLockChange"),this._emitter.notify("onChange"),await this._validatePassword(e),this._password&&(this._isPaused=!0),this}resume(){return this._isPaused=!1,this}isPaused(){return this._isPaused}isLocked(){return this._properties!==null&&!this._isPaused}isReadOnly(){return this._isReadOnly}async _validatePassword(e){const t=this._password;if(!(e&&e.length!==0||t&&t.hash))return!0;if(!e)throw new Error("Password is required.");if(!await Ga.verifyPassword(e,{salt:t.salt,hash:t.hash},t.algorithm,t.spinCount))throw new Error("Invalid password.");return!0}getProperties(){return this._properties}_isPropertyAllowed(e){if(this._isReadOnly)return!1;if(!this.isLocked())return!0;const t=this._properties[e];return typeof t=="boolean"&&t}_updateProperties(e){this._properties={...e,...this._properties??{}}}_clearProperties(){this._properties=null}addListeners(e,t){return this._emitter.addListeners(e,t)}fromJSON(e){this._password=null,this._identities=null,this._isPaused=!1,this._properties=null,this._fromJSON(e??null),e&&(e.password&&(this._password=e.password),e.identities&&(this._identities=e.identities))}_fromJSON(e){}_toJSON(e){return e}toJSON(){if(!this._properties)return null;let e={};return e=this._toJSON(e)??{},this._password&&(e.password=this._password),this._identities&&(e.identities=this._identities),e}}const VC=Object.freeze({selectLockedCells:!0,selectUnlockedCells:!0,autoFilter:!1,deleteColumns:!1,deleteRows:!1,formatCells:!1,formatColumns:!1,formatRows:!1,insertColumns:!1,insertHyperlinks:!1,insertRows:!1,objects:!1,pivotTables:!1,scenarios:!1,sheet:!1,sort:!1,verifier:null});class Mm extends Dw{isAutoFilterAllowed(){return this._isPropertyAllowed("autoFilter")}isDeleteColumnsAllowed(){return this._isPropertyAllowed("deleteColumns")}isDeleteRowsAllowed(){return this._isPropertyAllowed("deleteRows")}isFormatCellsAllowed(){return this._isPropertyAllowed("formatCells")}isFormatColumnsAllowed(){return this._isPropertyAllowed("formatColumns")}isFormatRowsAllowed(){return this._isPropertyAllowed("formatRows")}isInsertColumnsAllowed(){return this._isPropertyAllowed("insertColumns")}isInsertHyperlinksAllowed(){return this._isPropertyAllowed("insertHyperlinks")}isInsertRowsAllowed(){return this._isPropertyAllowed("insertRows")}isObjectsAllowed(){return this._isPropertyAllowed("objects")}isPivotTablesAllowed(){return this._isPropertyAllowed("pivotTables")}isScenariosAllowed(){return this._isPropertyAllowed("scenarios")}isSortAllowed(){return this._isPropertyAllowed("sort")}isSelectLockedCellsAllowed(){return!1}isSelectUnlockedCellsAllowed(){return!1}_updateProperties(e){super._updateProperties(e),this._properties=e}_clearProperties(){super._clearProperties(),this._properties=null}_fromJSON(e){super._fromJSON(e),this._properties=e}_toJSON(e){let t=this._properties;if(t){e={...e,...t};const n=Object.keys(t);for(let r=0;r<n.length;r++){const o=t[n[r]];o!=null&&o!==VC[n[r]]&&(e[n[r]]=o)}}return super._toJSON(e)}}let dh=class Lw{constructor(e,t,n){this._coords=Object.freeze(e),this._sheet=t,this._readOnly=n?.readOnly??null}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new Lw(e,this._sheet,n)}_createRange(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new hh(e,this._sheet,n)}_validateWrite(){const e=this._readOnly;if(e)throw new Error(e)}getCoords(){return this._coords}[Symbol.iterator](){const e=this.entries({excludeCellDetails:!0});return{next(){const t=e.next();return t.done?Ct:{done:!1,value:t.value.value}},[Symbol.iterator](){return this}}}entries(e){const t=this.getCoords(),n=e?.reverse??!1;let r=n?t.length-1:0;const o=this;let i=o._createRange(t[r]),l=i.entries(e),a=l.next();return{next(){let c=a;do{if(a.done){if(r=n?r-1:r+1,r>=t.length||r<0)return a=Ct,c;i=o._createRange(t[r]),l=i.entries(e)}a=l.next()}while(a.done);return c},[Symbol.iterator](){return this}}}async select(e){const t=await this._sheet._autoSelect(e??!0,Ft(this.getCoords()));return this._createRanges(t)}calculate(){const e=this.getCoords();return this._sheet._calculate(e),this}addListener2(e,t){return this._sheet._addRangesListeners2(this.getCoords(),e,t,!0)}addListener(e,t){return this._sheet._addRangesListeners(this.getCoords(),e,t)}find(e,t){return this._sheet._find(this.getCoords(),e,t)}getFlattened(e){const t=this.getCoords();if(t.length===1)return this._createRanges(t,e);const n=e?.orientations??B.Orientations.Both,r=n===B.Orientations.Both,o=r?Number.MAX_SAFE_INTEGER:1,i=n===B.Orientations.Row?B.Orientation.Column:B.Orientation.Row;let l=dd(t,o,i);if(r){const a=dd(t,o,B.Orientation.Column);a.length<l.length&&(l=a)}return this._createRanges(l,e)}getVisible(e){const t=this._sheet._getVisible(this.getCoords(),e);return t&&t.length!==0?this._createRanges(t,e):null}getFixed(e){const t=[],n=this.getCoords();for(let r=0;r<n.length;r++)t.push(Cw(n[r],e));return this._createRanges(t,e)}autoFit(e){return this._validateWrite(),this._sheet._autoFit(this.getCoords(),e),this}clear(e,t){return this._validateWrite(),this._sheet._clear(this.getCoords(),e,t),this}updateStyle(e,t){return this._validateWrite(),this._sheet._updateStyles(this.getCoords(),e,t),this}getStyleUpdater(){return this._sheet._getStyleUpdater(this.getCoords())}merge(e){return this._validateWrite(),this._sheet._merge(this.getCoords(),e),this}unmerge(e){return this._validateWrite(),this._sheet._unmerge(this.getCoords(),e),this}getMerges(){return this._sheet._getMerges(this.getCoords(),this._options?.excludeHidden??!1)}insert(e,t){return this._validateWrite(),this._sheet._insertCells(this.getCoords(),e,t),this}delete(e,t){return this._validateWrite(),this._sheet._deleteCells(this.getCoords(),e,t),this}async insertFrom(e,t){this._validateWrite();const n=await this._sheet._insertFrom(this.getCoords(),e,t);return n?this._createRanges([n]):null}async copyFrom(e,t){const n=await this._sheet._copyFrom(this.getCoords()[0],e,t);return n?this._createRanges([n]):null}isInvalidAny(){const e=this.getCoords();if(!e||e.length===0)return!0;for(let t=0;t<e.length;t++)if(e[t]===null)return!0;return!1}getSnapshot(e){return this._sheet._getSnapshot(this.getCoords(),e)}getEntireRows(e,t){return this._createRanges($a(this.getCoords(),this._sheet._entireCoords,B.Orientation.Column,e),t)}getEntireColumns(e,t){return this._createRanges($a(this.getCoords(),this._sheet._entireCoords,B.Orientation.Row,e),t)}getDefaultShiftOrientation(){return this._sheet._getDefaultShiftOrientation(this.getCoords()[0])}getCount(){return this.getCoords()?.length??0}getCounts(e){return this._sheet._contentCounts(this.getCoords(),e,this._options?.excludeHidden??!1)}isContentful(){return this._sheet._isContentful(this.getCoords(),this._options?.excludeHidden??!1)}getRowCount(){return jf(this.getCoords(),B.Orientation.Row)}getColumnCount(){return jf(this.getCoords(),B.Orientation.Column)}isEntireRowsAny(){return Wi(this.getCoords(),this._sheet._entireCoords,!1)}isEntireColumnsAny(){return ji(this.getCoords(),this._sheet._entireCoords,!1)}isEntireRows(){return Wi(this.getCoords(),this._sheet._entireCoords,!0)}isEntireColumns(){return ji(this.getCoords(),this._sheet._entireCoords,!0)}isOverlapping(){return xi(this.getCoords())}at(e){const t=this.getCoords();if(e<0||e>t.length-1)throw new Nt;return this._createRange(t[e])}isReadOnly(){return this._readOnly!==null}isInvalid(){return!1}getA1(){return ew(this.getCoords(),this._sheet._entireCoords,Nr,co)}getSheet(){return this._sheet}doBatch(e,t){return this._sheet.doBatch(n=>e(n),typeof t=="string"?t:{description:"Ranges Update",...t})}get[Symbol.toStringTag](){return"[SheetRanges]"}toString(){return this.getA1()}get isICellRanges(){return!0}},hh=class Bw{constructor(e,t,n){this._coords=Object.freeze(e),this._sheet=t,this._readOnly=n?.readOnly??null}getCoords(){return this._coords}_createRange(e,t){const n=this._sheet;if(!e)return Fr(n,n._entireCoords);if(n._validateCoords(e),n._closed)return Fr(null,n._entireCoords,e);let r=this._options;return t&&(r={...this._options,getOptions:Br(this._options?.getOptions,t)}),new Bw(e,this._sheet,r)}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new dh(e,this._sheet,n)}_deriveRanges(e,t){const n=this.getCoords();let r=n;return t&&(r=t(n),!r)?null:this._createRanges(r,e)}_deriveRange(e,t,n){if(!e)return this;let r=this._sheet._rangeToCoords(e);if(!r)return this;const o=this.getCoords();if(Ri(r,o))return this;if(n){const a=n(r,o);if(!a)return this;r={...o,...a}}var i,l;return i=r,(l=o)&&(l.$colStart===void 0?delete i.$colStart:i.$colStart=l.$colStart,l.$rowStart===void 0?delete i.$rowStart:i.$rowStart=l.$rowStart,l.$colEnd===void 0?delete i.$colEnd:i.$colEnd=l.$colEnd,l.$rowEnd===void 0?delete i.$rowEnd:i.$rowEnd=l.$rowEnd),this._createRange(r,Br(this._options?.getOptions,t))}_validateMaxSize(e=5e4){const t=this.getCoords(),n=this._sheet,r=n._colHeaders.getVisibleCount(t.colStart,t.colEnd);if(n._rowHeaders.getVisibleCount(t.rowStart,t.rowEnd)*r>e)throw new Error(lw(e))}[Symbol.iterator](){const e=this.entries({excludeCellDetails:!0});return{next(){const t=e.next();return t.done?Ct:{done:!1,value:t.value.value}},[Symbol.iterator](){return this}}}entries(e){const t=this.getCoords();let n=t;const r=this._sheet;if(e?.address){const i=r._rangeToCoords(e?.address);if(!i)throw new Error($i(e?.address));if(n=J.intersectRanges(i,t),!n)return Qt}n.colEnd<n.colStart&&(n.colStart=t.colStart,n.colEnd=t.colEnd),n.rowEnd<n.rowStart&&(n.rowStart=t.rowStart,n.rowEnd=t.rowEnd);const o=this._options?.excludeHidden??!1;return r._cellIterator({excludeHidden:o,...e,includeRangeTypes:!e?.excludeCellDetails,bounds:n})}forEach(e,t){if(!e)return;const n=this.entries(t);let r=n.next();for(;!r.done;){const o=r.value,i=e(o.value,o.context);if(i)return i.break;r=n.next()}}_validateWrite(){const e=this._readOnly;if(e)throw new Error(e)}updateCells(e,t,n){this._validateWrite();const r=this.getCoords();n||(n=r);const o=this._sheet,i=o._isDataColumn,l={majorStart:i?r.colStart:r.rowStart,majorEnd:i?r.colEnd:r.rowEnd,minorStart:i?r.rowStart:r.colStart,minorEnd:i?r.rowEnd:r.colEnd},a=(t?.orientation??B.Orientation.Row)===B.Orientation.Column!==i,c=Da(Array.isArray(e)?e:[[e]],a,l);return o._updateTuples(c,{description:t?.description??`Set ${J.isSingleCell(n)?"Cell":"Range"} ${Nr(n,o._entireCoords)}`,...t},null,{isCell:!0}),this}setValues(e,t){if(!Array.isArray(e))throw new Error("'setValues' expects a 2d array; when working with a single value use 'setValue'.");return this._setValueOrValues(e,t)}setValue(e,t){if(Array.isArray(e))throw new Error(vf);return this._setValueOrValues(e,t)}setFormula(e,t){if(Array.isArray(e))throw new Error(vf);return this._setValueOrValues(e,t)}_setValueOrValues(e,t){this._validateWrite();let n=this.getCoords(),r=this;const o=this._sheet,i=o._isDataColumn,l=(t?.orientation??B.Orientation.Row)===B.Orientation.Column,a=Array.isArray(e);if(t?.skipBoundsCheck&&a){const h=e;let f=Math.max(0,h.length-1),g=0;for(let S=0;S<h.length;S++)g=Math.max(g,h[S].length-1);const m=l?n.colStart:n.rowStart,p=l?n.rowStart:n.colStart,w={...n,colEnd:l?m+f:p+g,rowEnd:l?p+g:m+f};J.isEqualRanges(w,n)||(n=w,r=this._deriveRange(w,t))}const c={majorStart:i?n.colStart:n.rowStart,majorEnd:i?n.colEnd:n.rowEnd,minorStart:i?n.rowStart:n.colStart,minorEnd:i?n.rowEnd:n.colEnd},u=l!==i;let d=null;return d=a?Da(Array.isArray(e)?e:[[e]],u,c):aa(e,c,i),o._updateTuples(d,{description:t?.description??`Set ${J.isSingleCell(n)?"Value":"Values"} ${Nr(n,o._entireCoords)}`,...t}),r}getValues(e){this._validateMaxSize(e?.maxSize);const t=this.getCoords(),n=this._sheet;return mu(n._cellIterator.bind(this._sheet),t,!1,e)}getValue(e){const t=this.getCoords();return this._sheet._getScalar(t.rowStart,t.colStart,e?.asJSDate)}calculate(e){return this._sheet._calculate([this.getCoords()],{full:e}),this}getCells(e){this._validateMaxSize(e?.maxSize);const t=this.getCoords(),n=this._sheet;return mu(n._cellIterator.bind(this._sheet),t,!0,e)}getCell(e){const t=this.getCoords();let n=t.colStart,r=t.rowStart;const o=this._sheet;if(e){const l=o._cellToCoords(e);if(!J.isCellWithinRange(l,t))throw new Error("The cell is outside of the bounds of the range.");n=l.colIndex,r=l.rowIndex}const i=mu(o._cellIterator.bind(this._sheet),{colStart:n,rowStart:r,colEnd:n,rowEnd:r},!0,null);return i.length===0?o._emptyCell:i[0][0]}async select(e){const t=this._sheet,n=await t._autoSelect(e??!0,Ft([this.getCoords()]));return this._createRange(n[0])}find(e,t){return this._sheet._find([this.getCoords()],e,t)}getFixed(e){return this._createRange(Cw(this.getCoords(),e))}getSurrounding(e){const t=this._sheet;return this._createRange(t._surroundingRegion(this.getCoords(),e))}getExtended(e,t){let n=null;const r=this.getCoords();switch(e){case B.Direction.Up:n={colIndex:r.colStart,rowIndex:r.rowStart};break;case B.Direction.Down:n={colIndex:r.colStart,rowIndex:r.rowEnd};break;case B.Direction.Left:n={colIndex:r.colStart,rowIndex:r.rowStart};break;case B.Direction.Right:n={colIndex:r.colEnd,rowIndex:r.rowStart}}const o=this._sheet,i=t?o._cellToCoords(t):n;if(!J.isCellWithinRange(i,r))throw new Error("Invalid cell.");let l=o._extendRange(e,i);return l=J.unionRanges(r,l),this._createRange(l)}getEntireRows(e,t){const n=this._sheet;return this._createRange($a([this.getCoords()],n._entireCoords,B.Orientation.Column,e)[0],t)}getEntireColumns(e,t){const n=this._sheet;return this._createRange($a([this.getCoords()],n._entireCoords,B.Orientation.Row,e)[0],t)}getRowHeaders(e){const t=this.getCoords();return this._sheet._rowHeaders.getRange(t,e)}getColumnHeaders(e){const t=this.getCoords();return this._sheet._colHeaders.getRange(t,e)}getDifferences(e,t){return this._deriveRanges(t,n=>{const r=this._sheet,o=r._rangeToCoords(e),i=fd(n,o,B.Orientation.Row);return r._getVisible(i,t)})}getIntersect(e,t){return this._deriveRange(e,t,(n,r)=>J.intersectRanges(n,r))}getUnion(e,t){return this._deriveRange(e,t,(n,r)=>J.unionRanges(n,r))}getResizeTo(e,t,n){if(t=t??0,(e=e??0)<0||t<0)throw new Error("Invalid range. The Range must be at a size of at least 1x1'.");const r=this.getCoords();return this._deriveRange({colStart:r.colStart,rowStart:r.rowStart,colEnd:t+r.colStart-1,rowEnd:e+r.rowStart-1},n)}getResizeBy(e,t,n){e=e??0,t=t??0;const r=this.getCoords();return this._deriveRange({colStart:r.colStart,rowStart:r.rowStart,colEnd:r.colEnd+t,rowEnd:r.rowEnd+e},n)}getOffsetTo(e,t,n){const r=this.getCoords(),o=t,i=e,l={colStart:o,rowStart:i,colEnd:r.colEnd-r.colStart+o,rowEnd:r.rowEnd-r.rowStart+i};return this._deriveRange(l,n)}getOffsetBy(e,t,n){const r=this.getCoords(),o=r.colStart+e,i=r.rowStart+t,l={colStart:o,rowStart:i,colEnd:r.colEnd-r.colStart+o,rowEnd:r.rowEnd-r.rowStart+i};return this._deriveRange(l,n)}getUsedRange(e){const t=this._sheet._getUsedCoords(e);if(!t)return null;const n=J.intersectRanges(t,this.getCoords());return n?this._deriveRange(n,e):null}isEmpty(){const e=this._sheet._getUsedCoords();return e?!J.intersectRanges(e,this.getCoords()):!0}getColumnStart(){return this.getCoords().colStart}getRowStart(){return this.getCoords().rowStart}getColumnEnd(){return this.getCoords().colEnd}getRowEnd(){return this.getCoords().rowEnd}getColumnCount(){const e=this.getCoords();return e.colEnd-e.colStart+1}getRowCount(){const e=this.getCoords();return e.rowEnd-e.rowStart+1}getVisible(e){return this._deriveRanges(e,t=>this._sheet._getVisible([t],e))}isContentful(e){return this._sheet._isContentful([this.getCoords()],e,this._options?.excludeHidden??!1)}getCounts(e){return this._sheet._contentCounts([this.getCoords()],e,this._options?.excludeHidden??!1)}getCount(e){return this._sheet._getCount([this.getCoords()],e,this._options?.excludeHidden??!1)}isEntireRows(){const e=this._sheet;return Wi([this.getCoords()],e._entireCoords,!0)}isEntireColumns(){const e=this._sheet;return ji([this.getCoords()],e._entireCoords,!0)}isEntireRange(){const e=this.getCoords(),t=this._sheet;return ji([e],t._entireCoords,!0)&&Wi([e],t._entireCoords,!0)}getWidth(){const e=this._coords;return e.colEnd-e.colStart+1}getHeight(){const e=this._coords;return e.rowEnd-e.rowStart+1}get size(){const e=this._coords;return e.colEnd-e.colStart+1*(e.rowEnd-e.rowStart+1)}getBounds(){return this._sheet._getBoundsAtCoords(this.getCoords())}isInvalid(){return!1}getDefaultShiftOrientation(){return this._sheet._getDefaultShiftOrientation(this.getCoords())}getDefaultSortCriteria(e,t){return this._sheet._getDefaultSortCriteria(this.getCoords(),e,t)}getMerges(){return this._sheet._getMerges([this.getCoords()],this._options?.excludeHidden??!1)}getSnapshot(e){return this._sheet._getSnapshot([this.getCoords()],e)}isReadOnly(){return this._readOnly!==null}addListener2(e,t){return this._sheet._addRangesListeners2([this.getCoords()],e,t,!1)}addListener(e,t){return this._sheet._addRangesListeners([this.getCoords()],e,t)}getSheet(){return this._sheet}autoFill(e,t){this._validateWrite();const n=this._sheet,r=n._rangeToCoords(e,()=>[],!0);return n._autoFill(this.getCoords(),r,t)?this._createRange(r):this}autoFit(e){return this._validateWrite(),this._sheet._autoFit([this.getCoords()],e),this}clear(e,t){return this._validateWrite(),this._sheet._clear([this.getCoords()],e,t),this}setHyperlink(e,t){return this._validateWrite(),this._sheet._setHyperlinks([this.getCoords()],e,t),this}setComments(e,t){return this._validateWrite(),this._sheet._setComments([this.getCoords()],e,t),this}updateStyle(e,t){return this._validateWrite(),this._sheet._updateStyles([this.getCoords()],e,t),this}getStyleUpdater(){return this._sheet._getStyleUpdater([this.getCoords()])}merge(e){return this._validateWrite(),this._sheet._merge([this.getCoords()],e),this}unmerge(e){return this._validateWrite(),this._sheet._unmerge([this.getCoords()],e),this}insert(e,t){return this._validateWrite(),this._sheet._insertCells([this.getCoords()],e,t),this}async insertFrom(e,t){this._validateWrite();const n=this._sheet,r=await n._insertFrom([this.getCoords()],e,t);return r?this._createRange(r):null}async copyFrom(e,t){this._validateWrite();const n=this._sheet,r=await n._copyFrom(this.getCoords(),e,t);return r?this._createRange(r):null}delete(e,t){return this._validateWrite(),this._sheet._deleteCells([this.getCoords()],e,t),this}sort(e){this._validateWrite();const t=this.getCoords(),n=this._sheet._sort(t,e);return J.isEqualRanges(n,t)?this:this._createRange(n)}doBatch(e,t){return this._sheet.doBatch(n=>e(n),typeof t=="string"?t:{description:"Range Update",...t})}startIncrementalUpdates(e){return this._sheet._createIncrementalUpdater(e,this)}getA1(){const e=this._sheet;return Nr(this.getCoords(),e._entireCoords)}get[Symbol.toStringTag](){return"[SheetRange]"}toString(){const e=this._sheet;return Nr(this.getCoords(),e._entireCoords)}get isICellRange(){return!0}};const WC=Math.pow(2,14),jC=Math.pow(2,20),Tm=s=>`${s}`,km=s=>lr(s),Nm=s=>`${s+1}`;let GC=0;const Fm=()=>[];let UC=0,Nd=class zw{constructor(e){this._lastTransactionUUID=null,this._emitter=null,this._initializing=!0,this._emitterMovables=null,this._rangesListenerSorted=null,this._lastCellDecoded={address:null,coords:null},this._lastCellSelected={coords:null,cell:null},this._lastCellRead={coords:null,cell:null},this._lastValueRead={range:null,isDateOrTime:null},this._lastGetRangeRead={},this._lastUsedCoordsRead={coords:null,range:null},this._lastActiveRead={selection:null,range:null,ranges:null},this._lastRangeRead={address:null,range:null,ranges:null},this._isDataColumn=!0,this._isDate1904=!1,this._colHeaders=null,this._colHeadersShiftCallback=null,this._colHeadersListener=null,this._colHeadersRemoveListener=null,this._rowHeaders=null,this._rowHeadersShiftCallback=null,this._rowHeadersListener=null,this._rowHeadersRemoveListener=null,this._closed=!1;const t=Object.freeze({...e});ec._validate(!0),this._transactions=t.transactions??new ir,this._ownTransactions=!t.transactions;const n=this._beginCommit({description:"New Sheet"}),r=this;try{this._entireCoords=Object.freeze({colStart:0,rowStart:0,colEnd:(t.maxColumns??WC)-1,rowEnd:(t.maxRows??jC)-1}),this._strings=t.strings??new lh,this._ownStrings=!t.strings;const o=t.styles??new tl;this._styles=o,this._ownStyles=!t.styles,this._names=t.names??new kw({addressToRanges:l=>r.getRanges(l),getCurrentScope:()=>r.getName(),isReadOnly:()=>r._options.readonly??!1,transactions:r._transactions}),this._ownNames=!t.names,this._namesRemoveListener=this._names.addListeners({onCollectionChange:l=>{r._calculateFull()}},{transactional:!1}),this._calculation=t.calculation??new Tw({getNamed:(l,a)=>{Om.address=l,Om.scope=a;const c=this._names.getItems({address:l,scope:a});return c&&c.length!==0?c[0].getRanges().getCoords():null},getSheetIndex:l=>l===void 0||l===r.getName()?1:0,getSheetCount:()=>1,isDate1904:()=>r.isDate1904(),strings:r._strings,transactions:r._transactions}),this._ownsCalculation=!t.calculation,this._normalStyleRanged=o.getNamed(Qe.BuiltInName.Normal).getRanged(),this._resources=t.resources??new Ew,this._ownResources=!t.resources;const i=async()=>{this._ownsCalculation&&await this._calculation.start(),this._starting=null};this._starting=i(),t.container?.setNameChangeCallback&&t.container.setNameChangeCallback(()=>{r._emitter.notify("onNameChange");const l=this._getState().rangesListenerMap,a=new Map;l.forEach((u,d)=>{a.set(d,{beforeState:u,afterState:u})});const c=this._beginCommit({description:"Set Name"});c.updateState(r,{}),c.commit({viewAfter:{ranges:[r._entireCoords],listeners:a},forceAmend:!0}),r._calculateFull()}),t.container?.setVisibilityCallback&&t.container.setVisibilityCallback(()=>{r._emitter.notify("onVisibilityChange")}),t.container?.setIndexCallback&&t.container.setIndexCallback(()=>{r._calculateFull()}),this._movables=new yC(this._addMovable.bind(this),this._searchMovables.bind(this),()=>{const l=r._getState();return l?l.movableMapModel?.size??0:0},this._updateSelectedMovables.bind(this),(l,a)=>this._emitterMovables.addListeners(l,a),this._addImage.bind(this)),this._emitterMovables=new wn(this._movables,this._transactions),this._tables=new RC(this._addTable.bind(this),(l,a,c)=>{const u=l?this._rangeToCoords(l):this._entireCoords;return r._getRangedEntries("tableSpatial",[u],{excludeHidden:a,fullyContained:c,onEntry:d=>d.model})},l=>{const a=r._getState();return a?a.tableMapName.get(l.toLocaleLowerCase()):null}),this._conditionals=new kC(this._addConditional.bind(this),(l,a,c)=>{const u=l?this._rangeToCoords(l):this._entireCoords,d=new Set;return r._getRangedEntries("conditionalSpatial",[u],{excludeHidden:a,fullyContained:c,onEntry:h=>{d.add(h.getModel())}}),Array.from(d)}),this._isDate1904=t.date1904??!1,this._options=t,this._emitter=new wn(this,this._transactions),this._entireRange=this.getRange(this._entireCoords),this._initState(),t?.container?.beforeFromJSON?.(this),t.json&&this._fromJSON(t.json),n.commit({forceAmend:this._ownTransactions,viewAfter:{initial:!0,skipProtectionCheck:!0}})}catch(o){throw n.rollback(),o}this._initializing=!1}_createRange(e,t,n=null){if(!e)return Fr(this,this._entireCoords);if(this._validateCoords(e),this._closed)return Fr(null,this._entireCoords,e);n===null&&this._options.readonly&&(n="Readonly sheet");let r=null;return(t||n)&&(r={getOptions:t,readOnly:n}),new hh((o=>{if(!o)return null;const i={colStart:o.colIndex??o.colStart??0,rowStart:o.rowIndex??o.rowStart??0,colEnd:o.colIndex??o.colEnd??0,rowEnd:o.rowIndex??o.rowEnd??0};return(o.$colStart||o.$colIndex)&&(i.$colStart=!0),(o.$colEnd||o.$colIndex)&&(i.$colEnd=!0),(o.$rowStart||o.$rowIndex)&&(i.$rowStart=!0),(o.$rowEnd||o.$rowIndex)&&(i.$rowEnd=!0),i})(e),this,r)}_createRanges(e,t,n=null){let r=null;return n===null&&this._options.readonly&&(n="Readonly sheet"),(t||n)&&(r={getOptions:t,readOnly:n}),new dh(e,this,r)}getRange(e,t){let n=!t&&e&&(e.rowStart!==void 0||typeof e=="string");if(n){if(typeof e=="string"){if(this._lastRangeRead.address===e)return this._lastRangeRead.range}else if(e.rowStart!==void 0&&Ri(e,this._lastRangeRead.address))return this._lastRangeRead.range}const r=this._rangesToCoords(e);if(r.length>1)throw new Error(ow);const o=this._createRange(r[0],t);return n&&(this._lastRangeRead.address={...e},this._lastRangeRead.range=o),o}getCell(e){const t=this.getRange(e);if(t.size!==1)throw new Error(df);return t.getCell()}getRanges(e,t){if(!e)throw new Error(Ss);const n=this._rangesToCoords(e);if(n.length===0)throw this._createRangeError(e);return this._createRanges(n,t)}getSelectedRange(e){const t=this.getSelection().getCoords();if(!e&&this._lastActiveRead.selection===t&&this._lastActiveRead.range)return this._lastActiveRead.range;const n=ls(t),r=this.getRange(n[0]);return e||(this._lastActiveRead.selection=t,this._lastActiveRead.range=r,this._lastActiveRead.ranges=this.getRanges(n)),r}getSelectedRanges(e){const t=this.getSelection().getCoords();if(!e&&this._lastActiveRead.selection===t&&this._lastActiveRead.ranges)return this._lastActiveRead.ranges;const n=ls(t),r=this.getRanges(n,e);return e||(this._lastActiveRead.selection=t,this._lastActiveRead.ranges=r,this._lastActiveRead.range=this.getRange(n[0])),r}getEntireRange(e){return e?this.getRange(this._entireCoords,e):this._entireRange}getUsedRange(e){const t=this._getUsedCoords(),n=t?this.getRange(t,e):null;return e||(this._lastUsedCoordsRead.coords=t,this._lastUsedCoordsRead.range=n),n}_cellToCoords(e){if(this._lastCellDecoded.address===e)return this._lastCellDecoded.coords;const t=this._rangeToCoords(e);if(!t||!J.isSingleCell(t))throw new Error(df);const n={colIndex:t.colStart,rowIndex:t.rowStart};return this._lastCellDecoded.address=e,this._lastCellDecoded.coords=n,n}_validateCoords(e,t=La){if(!J.isRangeWithinRange(e,this._entireCoords))throw new Nt(t);const n=e.colStart,r=e.rowStart,o=e.colEnd,i=e.rowEnd;if(i<r||o<n)throw new Error(sw);if(!(Number.isInteger(n)&&Number.isFinite(n)&&Number.isInteger(r)&&Number.isFinite(r)&&Number.isInteger(o)&&Number.isFinite(o)&&Number.isInteger(i)&&Number.isFinite(i)))throw new Error("Invalid range. All points must be valid integers.")}_createRangeError(e){return e?new Error(Ss):new Error($i(e))}_protectionCheck(e=null,t=null,n=null){if(e&&this._closed)return;if(!this._initializing&&this._options.readonly)throw new Error(((i="update")=>`Unable to ${i}, this sheet is readonly.`)(n));t&&!Array.isArray(t)&&(t=[t]);const r=e(t),o=this.getProtection();if(o?.getProperties()){if(r.length===0)throw new Error(Cl);if(r){const i=r.length;for(let l=0;l<i;l++)if(o[r[l]]!==!0)throw new Error(ob())}}}_rangesToCoords(e,t=null,n=!0,r=!1){if(t&&this._closed)return V.EmptyArray;if(e==null)return V.EmptyArray;const o=this,i=oh(e,this._entireCoords,r?qn:el,a=>{if(n&&typeof a=="string"){const c=o.getNames()?.getByName(a);if(c)return c.getRanges().getCoords();const u=this._options.resolveRange?.(a);if(u&&u.getSheet()===o)return console.warn(bf),[u.getCoords()];throw new Error(`Invalid sheet reference '${a}'.`)}}),l=i.length;for(let a=0;a<l;a++){const c=i[a];if(c){if(r){const u=c.sheetName;if(u&&u!==this.getName())throw new Error(bf)}this._validateCoords(c)}}if(!t)return i;if(i.length===0)throw this._createRangeError(e);return this._protectionCheck(t,i),i}_rangeToCoords(e,t=null,n=!0){if(!e)throw new Error(Ss);const r=t?i=>t(i):void 0,o=this._rangesToCoords(e,r,n);if(o.length===0)throw new Error($i(e));return o[0]}_collectRanges(e,t=[],n=!0,r=this._getState(),o=!1){if(!n||Object.keys(n).length===0)return;const i=a=>n===!0||n[a]!==void 0,l=(a,c,u)=>{if(n!==!0&&n[a]===void 0)return;const d=c.search(e,!1),h=d.length;if(h===0)return;const f=n[a];for(let g=0;g<h;g++){const m=d[g];if(f&&!J.isRangeWithinRange(e,m))continue;const p=J.intersectRanges(e,m);let w=m.value;w===void 0&&(w=!0),t.push({...p,value:{[u]:w}})}};if(i(je.Type.Merge)&&r.mergeSpatial){const a=r.mergeSpatial.search(e),c=a.length;for(let u=0;u<c;u++){const d=a[u],h=o?d:J.intersectRanges(e,d);t.push({...h,value:{merge:d.value}})}}if(l(je.Type.Unlock,r.unlockSpatial,"unlock"),l(je.Type.Contentful,r.contentfulSpatial,"contentful"),l(je.Type.Continuous,r.continuousFillSpatial,"continuous"),l(je.Type.Hyperlink,r.hyperlinkSpatial,"hyperlink"),l(je.Type.Comments,r.commentsSpatial,"comments"),l(je.Type.Style,r.directStyleSpatial,"directStyle"),l(je.Type.Formula,r.formulaSpatial,"formula"),l(je.Type.Pending,r.pendingSpatial,"pending"),l(je.Type.CalcError,r.calcErrorsSpatial,"calcError"),l(je.Type.Spill,r.spillSpatial,"spills"),i(je.Type.Conditional)&&r.conditionalSpatial){const a=r.conditionalSpatial.search(e),c=n[je.Type.Conditional],u=a.length;for(let d=0;d<u;d++){const h=a[d],f=J.intersectRanges(e,h);c&&!f||t.push({...f,value:{conditionals:[h.value]}})}}if(i(je.Type.Table)&&r.tableSpatial){const a=r.tableSpatial.search(e),c=n[je.Type.Table],u=a.length;for(let d=0;d<u;d++){const h=a[d];if(c&&!J.isRangeWithinRange(e,h))continue;const f=J.intersectRanges(e,h);t.push({...f,value:{table:h.value.model}})}}}_cellIterator(e){const t=this._cellOptions,n=this._strings,r=this._cellStateIterator(e);return{next(o){const i=r.next(o);if(i.done)return Ct;const l=i.value,a=new pu(n,e,t),c=a.context;return{done:!1,value:{value:a.setState(l),context:c}}},[Symbol.iterator](){return this}}}_rangeStateIterator(e){const t=this._getState();if(!t||!e||!e.includeRangeTypes)return Qt;const n=e?.bounds??this._getUsedCoords()??this._entireCoords;let r=null;e.includeRangeTypes===!0?r=tb:V.isObject(e.includeRangeTypes)&&(r=e.includeRangeTypes);const o=e?.excludeHidden,i=o===!0||o===B.Orientation.Row,l=o===!0||o===B.Orientation.Column,a=e?.includeMergeOverflow??!1,c=[],u=this,d={includeHidden:!l},h={min:n.colStart,max:n.colEnd},f={includeHidden:!i},g={min:n.rowStart,max:n.rowEnd};this._rowHeaders.getRange(g).forEachVisibleSpan((b,v)=>{this._colHeaders.getRange(h).forEachVisibleSpan((y,_)=>{u._collectRanges({rowStart:b,rowEnd:v,colStart:y,colEnd:_},c,r,t)},d)},f);const m=new Oa.IteratorInstance(c,e),p=e?.reverse??!1,w=e?.byCell;let S;return{next:b=>{if(S=m.next(b),S.done)return Ct;const v=S.value,y=(R=>{if(!R)return null;let I=null;const A=R.length;for(let M=0;M<A;M++){const k=R[M].value;if(!k)continue;I||(I={...I});const F=Object.keys(k),L=F.length;for(let N=0;N<L;N++){const D=F[N],O=I[D];if(O)if(Array.isArray(O)){const H=k[D];if(Array.isArray(H)){const z=H.length;for(let j=0;j<z;j++)O.push(H[j])}else O.push(H)}else I[D]=[O,k[D]];else I[D]=k[D]}}return I})(v.overlaps);let _,C=v.range;if(a){const R=y?.merge;if(R){const I=R.getCoords(),A=n.colStart,M=n.rowStart,k=I.colStart,F=I.rowStart;k<A&&M<F&&(_={colIndex:k,rowIndex:F})}}_||(_={colIndex:C.colStart,rowIndex:C.rowStart});const E={colIndex:C.colEnd,rowIndex:C.rowEnd};let x=null;return w&&(x={...v.cell}),{done:!1,value:{start:p?E:_,end:p?_:E,cell:x,intersection:y}}}}}_overflowAndStops(e,t){const n=this._getState();if(!n||!e)return null;let r=this._entireCoords;t&&(r={colStart:Math.max(r.colStart-t,r.colStart),rowStart:r.rowStart,colEnd:Math.min(r.colEnd+t,r.colEnd),rowEnd:r.rowEnd});const o={rowStart:e.rowStart,colStart:r.colStart,rowEnd:e.rowEnd,colEnd:r.colEnd},i={bounds:o,includeRangeTypes:rb,orientation:B.Orientation.Row,excludeHidden:!0,byCell:!1},l=e.colStart,a=e.colEnd;let c,u,d=-1;const h=(S,b)=>{let v=S.next();for(;!v.done;){const y=v.value,_=y.intersection,C=_.contentful;if(C){const E=y.start.rowIndex;if(!u||E!==d){const x=y.end.rowIndex,R=C.getCoords(),I=b?R.colEnd:R.colStart;let A=null;b&&(A=_.continuous),c||(c=[]);for(let M=E;M<=x;M++)c.push({rowIndex:M,colIndex:I,continuous:A,intersection:_,scalar:null,leftIndex:0,rightIndex:0,overflow:null,style:null})}d=E,u=y}v=S.next()}};l>r.colStart&&(o.colStart=r.colStart,o.colEnd=e.colStart-1,h(this._rangeStateIterator(i),!0)),d=-1,u=void 0,a<r.colEnd&&(o.colStart=e.colEnd+1,o.colEnd=r.colEnd,h(this._rangeStateIterator(i),!1));const f=n.cellValuesGrid;if(!c)return null;c.sort(J.columnFirstCellComparator);const g=c.length,m=this._cellOptions;let p,w;for(let S=0;S<g;S++){const b=c[S],v=b.rowIndex,y=b.colIndex,_=f.getValueAt(v,y);b.scalar=_;const C=b.continuous;if(typeof _=="string"||C){ui.colStart=y,ui.rowStart=v,ui.colEnd=y,ui.rowEnd=v;const E=Ni(0,ui,b.intersection,m);b.style=E;const x=bw(v,y,Me.String,E,_,null,null,C?.getCoords(),m);if(x){const R=x.leftIndex,I=x.rightIndex;b.leftIndex=R,b.rightIndex=I,(I>0&&y<l||R>0&&y>a)&&(b.overflow=x)}}b.overflow?(p||(p=[]),p.push(b)):(w||(w=[]),w.push(b))}return{overflows:p,stops:w}}_cellStateIterator(e){const t=this._getState();if(!t)return Qt;const n=e?.bounds,r=n??this._entireCoords,o=e?.orientation??B.Orientation.Row,i=e?.reverse??!1,l=e?.includeEmpty,a={bounds:r,orientation:o,reverse:i};let c;l&&(c={bounds:r,orientation:o,reverse:i});const u=e?.excludeHidden;if(u===!0||u===B.Orientation.Row){const O=fu(this._rowHeaders);a.processRowSkip=Js(O),l&&(c.processRowSkip=Js(O))}if(u===!0||u===B.Orientation.Column){const O=fu(this._colHeaders);a.processColumnSkip=Js(O),l&&(c.processRowSkip=Js(O))}const d=l||!e?.ignoreEmptyIntersections;let h=e.includeRangeTypes;h===!0&&(h=iw);const f=e?.includeMergeOverflow??!1,g=h?this._rangeStateIterator({bounds:r,orientation:o,reverse:i,includeRangeTypes:h,includeMergeOverflow:f,excludeHidden:e.excludeHidden,byCell:!0}):Qt;let m,p;if(f&&n){const O=this._overflowAndStops(n);O&&(m=O.overflows,m?.sort(J.createCellComparator(o,i)),p=O.stops,p?.sort(J.createCellComparator(o,i)))}const w=m?m.length:0,S=p?p.length:0;let b=0,v=0;const y=t?.cellValuesGrid??null;let _=y?y.entries(a):Qt,C=_.next(),E=null,x=null,R=null;C.done||(E=C.value[0],x=C.value[1]);let I=m?.[b++],A=g.next(),M=null;const k=o!==B.Orientation.Row;let F;const L=J.createCellComparator(o,i);let N;if(!A.done){const O=A.value;M=O.intersection,N=O.start}F=O=>{let H=null,z=null,j=null,q=!1,P=!1,U=null,ne=null,ee=!1;if(I&&(E?L(I,E)<0&&(ee=!0):N?L(I,N)<0&&(ee=!0):b<=w&&(ee=!0)),ee)H={colIndex:I.colIndex,rowIndex:I.rowIndex},z=I.scalar,j=I.intersection,I=m[b++];else if(E&&N){const ae=L(E,N);ae<0?(H=E,z=x,q=!0):ae>0?(H=N,j=M,P=!0):(H=E,z=x,j=M,q=!0,P=!0)}else if(E)H=E,z=x,q=!0;else{if(!N||!d)return Ct;H=N,j=M,P=!0}if(q&&(C=_.next(),C.done?E=null:(E=C.value[0],x=C.value[1])),P){const ae=d?void 0:E;if(A=g.next(ae),A.done)N=null,M=null;else{const fe=A.value;M=fe.intersection,N=fe.cell}}let ve=!1;const le=H.rowIndex,Ce=H.colIndex;k||(ve=le===R?.rowIndex);let re=!1;if(k||(re=le===E?.rowIndex),ve)U=R;else if(f){let ae=!1;for(;!ae&&v<S;){const fe=p[v],ye=fe.rowIndex;ye<le?v++:(ae=!0,ye===le&&fe.colIndex<Ce&&(v++,U={colIndex:fe.colIndex,rowIndex:fe.rowIndex}))}}if(re)ne=E;else if(f){let ae=!1;for(;!ae&&v<S;){const fe=p[v],ye=fe.rowIndex;ye<le?v++:(ae=!0,ye===le&&fe.colIndex>Ce&&(v++,ne={colIndex:fe.colIndex,rowIndex:fe.rowIndex}))}}return(q||ee)&&(R=H),{done:!1,value:[H,z,j,U,ne]}};let D={next:F,return:O=>null,throw:O=>null};return l&&(D=new V0(D,a)),D}_indexMerges(e,t=null){if(!(e&&e.length!==0||t&&t.length!==0))return;const n=this._getState();if(!n)return;const r=this._beginCommit({description:"indexMerges"}),o=n.mergeSpatial.clone();if(t){const i=t.length;for(let l=0;l<i;l++)o.remove(t[l])}if(e){const i=c=>this._getState().cellValuesGrid.getValueAt(c.rowStart,c.colStart),l=[],a=e.length;for(let c=0;c<a;c++){const u=e[c];l.push({...u,value:new Em(u,i)})}o.load(l)}this._updateState({mergeSpatial:o}),r.commit()}_updateStyles(e,t,n,r=!1){const o=n?.description??"Update Style";this._protectionCheck(()=>["formatCells"],e,o);const i=this._beginCommit({description:o}),l=Ys(e);try{const a=this._getState();if(!a)return V.EmptyArray;const c=a.directStyleSpatial,u=i.getId(),d=c.clone(u);let h=a.continuousFillSpatial;const f=this._styles,g=e.length;for(let m=0;m<g;m++){const p=(E,x)=>{let R=null;const I=sc(0,x,()=>{if(R)return R;const A=E.getCoords();return R=Is(f,E,A),R});return E.cloneWithUpdate(I)},w=!h.isEmpty();let S=null;const b=e[m],v=b.value,y=v!==void 0?v:t,_=p(new Jt(f,b),y),C=(E,x)=>{if(r&&E.value&&E.value.getProperties()?.numberFormat)return E;const R=J.sanitizeRange(E);let I,A=null,M=E.value;if(M||(M=new Jt(f,R)),typeof y=="function")A=p(M,y);else{let k=x.value._p??null;y!==null&&(k=y),A=M.cloneWithUpdate(k)}if(A.isEmpty()&&(A=null),A){const k=A._p?.alignment?.horizontal;!k||k!==oe.HorizontalAlignment.CenterContinuous&&k!==oe.HorizontalAlignment.Fill||(I=p(new Jt(f,b),{alignment:{horizontal:k}}))}return(I||w)&&(S||(S=[]),S.push({...E,value:I??null})),{...x,value:A}};if(d.insertNonOverlapping({...b,value:_},{onIntersect:C}),S){h===a.continuousFillSpatial&&(h=h.clone());const E=S.length;for(let x=0;x<E;x++){const R=S[x];h.insertNonOverlapping(R)}}}if(this._lastUsedCoordsRead.coords=null,this._updateState({directStyleSpatial:d,continuousFillSpatial:h}),n?.autoFit){const m=typeof n.autoFit=="boolean"?Du:n.autoFit;this._autoFit(e,m)}this._emitter.notify("onStyleChange"),r?this._commitAndAutoSelect(i,l,n?.autoSelect,{viewAfter:{ranges:e}}):i.commit({forceAmend:!0})}catch(a){throw i.rollback(),a}}_createIncrementalUpdater(e,t=null,n){const r=e?.orientation??B.Orientation.Row,o=e?.allowUnorderedWrites??!1,i=r===B.Orientation.Column,l=this._isDataColumn,a=i!==l,c=this;let u,d,h,f=a?new At.TransposedBuilder:new At.Builder,g=null;if(t){const b=t.getCoords(),v=b.colStart,y=b.rowStart,_=b.colEnd,C=b.rowEnd;g=(E,x)=>{if(E<y||E>C||x<v||x>_)throw new Nt}}i?(d=(b,v,y)=>(g?.(b,v),f.addValue(v,b,y),u),h=(b,v,y)=>(g?.(b,v+(y?.length??0)),f.addValues(v,b,y),u)):(d=(b,v,y)=>(g?.(b,v),f.addValue(b,v,y),u),h=(b,v,y)=>(g?.(b+(y?.length??0),v),f.addValues(b,v,y),u));const m=b=>{const v=f.build();return v&&c._updateTuples(v,b,null,n),t},p=o!==!1?J.createCellComparator(e?.orientation):null,w=V.isObject(o)?o:void 0;let S=null;return u=Object.freeze({push:(b,v)=>{const y=c._cellToCoords(b);return p&&(S&&p(y,S)<=0&&(m(w),f=a?new At.TransposedBuilder:new At.Builder),S=y),d(i?y.colIndex:y.rowIndex,i?y.rowIndex:y.colIndex,v)},pushAt:d,pushMultipleAt:h,apply:m}),u}_updateTuples(e,t,n=void 0,r=null){if(!e)return;const o=r?.isCell??!1,i=r?.isHyperlink??!1,l=e.tuples,a=e.bounds,c=this._beginCommit({description:t?.description??"Update Cells"});let u=null;const d=this._isDataColumn,h=d?B.Orientation.Column:B.Orientation.Row,f=this.getProtection().isLocked(),g=this.getProtection().isFormatCellsAllowed(),m=this._strings,p=a.majorStart,w=a.majorEnd,S=a.minorStart,b=a.minorEnd,v={colStart:d?p:S,rowStart:d?S:p,colEnd:d?w:b,rowEnd:d?b:w},y=this;(n=n??((me,de)=>{y._validateCoords(me,de??La)}))(v);const _={[je.Type.Style]:!1,[je.Type.Table]:!1};let C=!1;f&&this._hasRangedEntries("unlockSpatial",v)&&(_[je.Type.Unlock]=!1,C=!0),this._hasRangedEntries("mergeSpatial",v)&&(_[je.Type.Merge]=!1,C=!0);const E=this._rangeStateIterator({bounds:v,orientation:h,includeRangeTypes:_,reuseIterator:{done:!1,value:null}});let x=E.next(),R=-1,I=-1,A=-1,M=-1,k=null;if(!x.done){const me=x.value,de=me.start,xe=me.end;R=d?de.colIndex:de.rowIndex,I=d?xe.colIndex:xe.rowIndex,A=d?de.rowIndex:de.colIndex,M=d?xe.rowIndex:xe.colIndex,k=me.intersection}let F=(me,de)=>{do{if(!k||me<=A&&de<A)return null;if(me>=R&&de>=A&&me<=I&&de<=M)return k;if(x=E.next(),x.done)k=null,F=null,C=!1;else{const xe=x.value;R=d?xe.start.colIndex:xe.start.rowIndex,I=d?xe.end.colIndex:xe.end.rowIndex,A=d?xe.start.rowIndex:xe.start.colIndex,M=d?xe.end.rowIndex:xe.end.colIndex,k=xe.intersection}}while(k);return k};const L=c.getState(this),N=L.cellValuesGrid.clone(),D=L.calcGraph.clone(),O=L.formulaSpatial.clone(),H=L.spillSpatial.clone(),z=L.pendingSpatial.clone(),j=L.calcErrorsSpatial.clone(),q=L.contentfulSpatial.clone(),P=oo(d),U=oo(d,(me,de)=>{if(me===de)return de}),ne=oo(d,(me,de)=>{if(me===de)return de}),ee=oo(d,(me,de)=>{if(me===de)return de}),ve=[];let le=null,Ce=null;if(t?.textParser!==!1){const me=t&&t.textParser!==!0?t.textParser:{};Ce={ignoreQuotePrefix:!1,date1904:this._isDate1904,dateNF:!1,parse:null,...me},le=new pu(m,null,this._cellOptions)}const re=[],ae=this._cellOptions,fe=new Map,ye=Jf,he=(me,de,xe)=>{const Le=F?.(de,xe);if(Le?.merge){const Ge=Le.merge.getCoords(),ce=d?Ge.colStart:Ge.rowStart,We=d?Ge.rowStart:Ge.colStart;if(ce!==de||We!==xe)return}if(o&&me&&me.isICell){const Ge=me;if(Ge.isTopLeft()){const ce=Ge.getSpans();ve.push({colStart:d?de:xe,rowStart:d?xe:de,colEnd:(d?de:xe)+ce.width-1,rowEnd:(d?xe:de)+ce.height-1})}}let W=vd(me,ae,Ce,fe);if(W===void 0)return;const Ze=W.value;if(W.stringToParse){ci[0].colIndex=d?de:xe,ci[0].rowIndex=d?xe:de,ci[1]=Ze,ci[2]=Le,le.setState(ci);const Ge=Ce?.parse(W.stringToParse,le.context),ce=vd(Ge,ae,Ce,fe,!0);if(le.clear(),ce===null)return ce;ce!==void 0&&(W={...ce})}if(f){if(f&&(me===null||W.value!==void 0))throw new Error(Cl);if(!g&&W.style!==void 0)throw new Error(Cl)}if(!i){const Ge=W.style;Ge===void 0||Ge===null&&!o||U.append(de,xe,Ge);const ce=W.hyperlink;ce===void 0||ce===null&&!o||ne.append(de,xe,ce)}const Xe=W.formula;return Xe===void 0||Xe===null&&!o||ee.append(de,xe,Xe),Ze};let we=-1,be=-1;try{const me=l.length;for(let qe=0;qe<me;qe++){const De=l[qe],Te=De[0];if(we>=Te)throw new At.OutOfOrderError(`Duplicate or out of order major indices: {${Te}}.`);if(we=Te,be=Number.MIN_SAFE_INTEGER,Te<p||Te>w)throw new Nt("Provided major bounds is invalid");const ze=De[1],Z=[],Se=ze.length;for(let te=0;te<Se;te++){const ie=ze[te],$=ie[1],Y=$.length;let Q=ie[0],K=Q;if(be>K)throw new At.OutOfOrderError(`Duplicate or out of order minor indices: {${K}}.`);if(K<S||K+Y>b+1)throw new Nt("Provided minor bounds is invalid");let se=[];for(let X=0;X<Y;X++){const ue=$[X];let _e=null;if(C||typeof ue!="number"?(C||ue!==null||o)&&(_e=he(ue,Te,K)):_e=ue,_e==null){if(_e===null&&P.append(Te,K),se.length>0){const Re=ye(se,m);Z.push([Q,Re]),se=[]}Q=K+1}else se.push(_e);K++}if(be=K,se.length>0){const X=ye(se,m);Z.push([Q,X]),se=null}}Z.length>0&&re.push([Te,Z])}const de=P.done(),xe=de.length;for(let qe=0;qe<xe;qe++){const De=de[qe];N.delete(de[qe]),q.insertNonOverlapping({...De,value:null});const Te=D.delete(De);this._updateFormulaSpatial(O,null,Te)}let Le;re.length>0&&(N.setValues(re),Le={tuples:re,bounds:a});let W,Ze=ee.done();if(Ze.length>1&&(Ze=mr(Ze,B.Orientation.Column,1)),Le||Ze.length>0){const qe=D.setInputs(Le,Ze);W=this._updateFormulaSpatial(O,qe.inserts,qe.removes,L.directStyleSpatial)}const Xe=Kf(re,d),Ge=Xe.length;for(let qe=0;qe<Ge;qe++)q.insertNonOverlapping(Xe[qe]);const ce=U.done();ce.length>0&&this._updateStyles(ce),ve.length>0&&this._merge(ve);const We=ne.done();if(We.length>0&&this._setHyperlinks(We),this._updateState({cellValuesGrid:N,contentfulSpatial:q,calcGraph:D,formulaSpatial:O,spillSpatial:H,pendingSpatial:z,calcErrorsSpatial:j}),W&&W.length>0&&this._updateStyles(W,void 0,{},!0),t?.autoFit){const qe=typeof t.autoFit=="boolean"?Du:t.autoFit;this._autoFit([v],qe)}u={ranges:[v]},this._addEvent("data",v),this._commitAndAutoSelect(c,u,t?.autoSelect,{viewAfter:{formulas:[v],ranges:[v]}})}catch(me){throw c.rollback(),me}}_sort(e,t){typeof t=="boolean"&&(t={reverse:t});const n=t?.description??"Sort "+(t?.reverse?"Descending":"Ascending");this._protectionCheck(()=>["sort"],e,n);let r=1,o=1,i=!1;const l=this._getMerges([e]);if(l.length>0){i=!0;let P=l[0];if(r=P.colEnd-P.colStart+1,o=P.rowEnd-P.rowStart+1,(e.colEnd-e.colStart+1)%r!=0||(e.rowEnd-e.rowStart+1)%o!=0)throw new Error(yf);const U=l.length;for(let ne=1;ne<U;ne++){const ee=l[ne];if(ee.colEnd-ee.colStart+1!==r||ee.rowEnd-ee.rowStart+1!==o)throw new Error(yf)}}const a=t?.orientation??B.Orientation.Row,c=a===B.Orientation.Row;let u=t?.offset??0,d=e;t?.hasHeader&&(d={...d},c?d.rowStart+=o:d.colStart+=r,u=Math.max(u-1,0));const h={offset:u,reverse:t?.reverse??ms.DefaultRangeOptions.reverse,collatorOptions:t?.collatorOptions??ms.DefaultRangeOptions.collatorOptions},f=c?d.colStart:d.rowStart,g=c?d.colEnd-d.colStart:d.rowEnd-d.rowStart,m=[];if(t?.fields){const P=t?.fields.length??0;for(let U=0;U<P;U++){let ne=t.fields[U];typeof ne=="number"&&(ne={offset:ne}),m.push(ne)}}else m.push(h);const p=m.length;for(let P=0;P<p;P++){const U=m[P]={...h,...m[P]};if(U.offset<0||U.offset>g)throw new Nt("The sort offset is outside of the bounds of the sort.");U.offset+=f}const w=[];let S=null,b=null,v=null,y=Number.MIN_SAFE_INTEGER;m.sort((P,U)=>P.offset-U.offset);let _=null;const C=t?.includeHidden??!1;if(!C){const P=fu(c?this._rowHeaders:this._colHeaders);_=Js(P)}const E=this._cellIterator({bounds:d,orientation:a,excludeHidden:!C&&a,includeRangeTypes:{[je.Type.Style]:!1,[je.Type.Merge]:!1}}),x=c?o:r;let R=(c?d.rowStart:d.colStart)-x,I=E.next();for(;!I.done;){const P=I.value.context,U=P.getCell();if(i&&!U.isTopLeft()){I=E.next();continue}const ne=P.getCoords(),ee=c?ne.rowIndex:ne.colIndex,ve=c?ne.colIndex:ne.rowIndex;if(R!==ee){for(R+=x,_&&(R=_(R));R<ee;)w.push(null),R+=x;b=[],v=[],S={minorIndex:ee,values:b,sortValues:v},w.push(S),R=ee,y=m[0].offset}for(;ve>y;){const le=m[v.length];y=le?le.offset:Number.MAX_SAFE_INTEGER,ve>y&&v.push(null)}ve===y&&v.push(U),b.push(U),I=E.next()}if(!S||w.length===0)return;const A=new Map,M=new Map,k=t?.collators??ms.DefaultCollators,F=k.length;for(let P=0;P<F;P++)A.set(k[P].type,k[P].compare),M.set(k[P].type,P);let L=null,N=null,D=null;w.sort((P,U)=>{const ne=m.length;for(let ee=0;ee<ne;ee++){const ve=m[ee],le=P?P.sortValues[ee]:null,Ce=U?U.sortValues[ee]:null,re=le?le.getValue():null,ae=Ce?Ce.getValue():null,fe=re===null,ye=ae===null;if(re===ae)continue;if(fe&&ye)return 0;if(!fe&&ye)return-1;if(fe&&!ye)return 1;const he=le.getType(),we=Ce.getType();let be=0;if(he!==we){let me=M.get(he);be=M.get(we)-me}else{let me=N;if(L!==he){me=A.get(he),N=me,L=he;let de=M.get(we);D={...k[de].defaultOptions,...ve.collatorOptions}}be=me(re,ae,D)}return ve.reverse&&(be*=-1),be}return 0});const O=this._beginCommit({description:n});let H=[d];C||(H=this._getVisible(H,{orientations:c?B.Orientations.Row:B.Orientations.Column})),this._clear(H,void 0,void 0,!0);const z=this._createIncrementalUpdater({orientation:a});let j=c?d.rowStart:d.colStart;const q=w.length;for(let P=0;P<q;P++){const U=w[P];if(_&&(j=_(j)),U){const ne=U.values,ee=ne.length;for(let ve=0;ve<ee;ve++){const le=ne[ve],Ce=c?j:le.getCoords().rowIndex,re=c?le.getCoords().colIndex:j;z.pushAt(Ce,re,le)}}j+=x}return z.apply(),O.commit(),d}_autoFill(e,t,n){const{direction:r,amount:o}=((m,p)=>{let w=B.Direction.Down,S=0;const b={...m};if(p.colStart<m.colStart?(w=B.Direction.Left,S=m.colStart-p.colStart,b.colStart=p.colStart):p.colEnd>m.colEnd?(w=B.Direction.Right,S=p.colEnd-m.colEnd,b.colEnd=p.colEnd):p.rowStart<m.rowStart?(w=B.Direction.Up,S=m.rowStart-p.rowStart,b.rowStart=p.rowStart):p.rowEnd>m.rowEnd&&(w=B.Direction.Down,S=p.rowEnd-m.rowEnd,b.rowEnd=p.rowEnd),!J.isEqualRanges(b,p))throw new Error("Autofill destination must be the same as the range for 3 of the 4 edges.");return{direction:w,amount:S}})(e,t);if(o<=0)return!1;const i=r===B.Direction.Up||r===B.Direction.Down,l=this.getSelection().getCoords(),a=[],c=n?.previewOnly,u=n?.contentsOnly,d=n?.filler??zi.Types.Series,h={...n?.fillerOptions};let f=null,g=null;try{const m={...e};let p={...e};const w=[e],S=this._getMerges(w);if(S.length>0&&!J.isRangeWithinRange(J.unionRangesArrays(S),e))throw new Error(_f);const b={...p};let v=1;if(r===B.Direction.Left)m.colStart=p.colStart=e.colStart-o,m.colEnd=e.colStart-1,v=S.length===0?v:e.colEnd+1-e.colStart,b.rowStart=b.rowEnd;else if(r===B.Direction.Right)m.colEnd=p.colEnd=e.colEnd+o,m.colStart=e.colEnd+1,v=S.length===0?v:e.colEnd+1-e.colStart,b.rowStart=b.rowEnd;else if(r===B.Direction.Up)m.rowStart=p.rowStart=e.rowStart-o,m.rowEnd=e.rowStart-1,v=S.length===0?v:e.rowEnd+1-e.rowStart,b.colStart=b.colEnd;else{if(r!==B.Direction.Down)throw new Error(FS.MESSAGE_ERROR_INVALID_ARG(r));m.rowEnd=p.rowEnd=e.rowEnd+o,m.rowStart=e.rowEnd+1,v=S.length===0?v:e.rowEnd+1-e.rowStart,b.colStart=b.colEnd}if(o%v!==0)throw new Error((he=>`When filling with merged cells the amount to fill must be a multiple of the input range [${he}].`)(v));const y=i?"rowIndex":"colIndex",_=i?"colIndex":"rowIndex",C=i?e.rowEnd+1-e.rowStart:e.colEnd+1-e.colStart,E=i?e.rowStart:e.colStart,x=i?e.rowEnd:e.colEnd,R=i?t.rowStart:t.colStart,I=i?t.rowEnd:t.colEnd,A=i?r===B.Direction.Down:r===B.Direction.Right;A||(h.reverse=!0);const M=A?x+1:R,k=(A?I:E-1)-M+1,F=i?e.colEnd:e.rowEnd;a.push(J.unionRanges(m,e));const L=[];let N=null;c||(f=this._beginCommit({description:"Auto Fill",operation:{name:"autoFill",params:[e,t,n]}}));const D=this._cellIterator({bounds:c?b:e,reverse:!A,orientation:i?B.Orientation.Column:B.Orientation.Row,includeRangeTypes:{[je.Type.Style]:!1}});let O=D.next();for(;!O.done;){const he=O.value.context,we=he.getCell(),be=he.getCoords();N?.oppositeIndex!==be[_]&&(N={oppositeIndex:be[_],lastIndex:A?E-1:x+1,values:[]},L.push(N));const me=be[y];if(A)for(let xe=N.lastIndex+1;xe<me;xe++)N.values.push(null);else for(let xe=N.lastIndex-1;xe>me;xe--)N.values.push(null);N.lastIndex=me;const de=we.toDate();if(de)N.values.push(de);else{let xe=we.getValue();N.values.push(xe)}O=D.next()}const H=L.length;for(let he=0;he<H;he++){const we=L[he].values;for(let be=we.length;be<C;be++)we.push(null)}const z=(he,we)=>{if(he.canFill(we[0],[])){const be=he.createFillAt(we,h);if(be)return be}return zi.Types.Copy.createFillAt(we)},j=this;if(c){const he=L[L.length-1];if(L[L.length-1]?.oppositeIndex!==F)return null;const we=z(d,he.values);return c(be=>{const me=j._rangeToCoords(be);let de;r===B.Direction.Down||r===B.Direction.Right?de={rowIndex:me.rowEnd,colIndex:me.colEnd}:r===B.Direction.Left?de={rowIndex:me.rowEnd,colIndex:me.colStart}:r===B.Direction.Up&&(de={rowIndex:me.rowStart,colIndex:me.colEnd});const xe=i?de.rowIndex:de.colIndex,Le={value:we(A?xe-E:E-xe+C-1)};let W=null;return W=u?this.createTemporaryCell(Le,de):this.createTemporaryCell(null,de).createTemporaryCell(Le),W}),!1}const q=this._createIncrementalUpdater({orientation:i?B.Orientation.Column:B.Orientation.Row}),P=L.length;L.sort((he,we)=>he.oppositeIndex-we.oppositeIndex);for(let he=0;he<P;he++){const we=he,be=z(d,L[we].values),me=L[we].oppositeIndex,de=A?C:C+k-1,xe=this.isDate1904();for(let Le=0;Le<k;Le++){let W=be(de+(A?Le:-Le));Ms(W)&&(W=Ki(W,xe));const Ze=M+Le;i?q.pushAt(Ze,me,W):q.pushAt(me,Ze,W)}}this._clear([m],n?.contentsOnly?lt.Content.Formats:void 0),q.apply();const U=this._getMerges([p]),ne=J.unionRangesArrays(U);if(U.length>0&&!J.isRangeWithinRange(ne,p))throw new Error(_f);if(U.length>0){const he=[],we=o/v;if(i){const be=e.rowEnd-e.rowStart+1,me=r===B.Direction.Up?m.rowStart:e.rowEnd+1,de=U.length;for(let xe=0;xe<de;xe++){const Le=U[xe],W=Le.rowStart-e.rowStart,Ze=Le.rowEnd-Le.rowStart+1;for(let Xe=0;Xe<we;Xe++){const Ge=Xe*be;he.push({colStart:Le.colStart,rowStart:me+Ge+W,colEnd:Le.colEnd,rowEnd:me+Ge+W+Ze-1})}}}else{const be=e.colEnd-e.colStart+1,me=r===B.Direction.Left?m.colStart:e.colEnd+1,de=U.length;for(let xe=0;xe<de;xe++){const Le=U[xe],W=Le.colStart-e.colStart,Ze=Le.colEnd-Le.colStart+1;for(let Xe=0;Xe<we;Xe++){const Ge=Xe*be;he.push({colStart:me+Ge+W,rowStart:Le.rowStart,colEnd:me+Ge+W+Ze-1,rowEnd:Le.rowEnd})}}}this._merge(he)}const ee=this._getState(),ve={},le={};le.directStyleSpatial=ee.directStyleSpatial,le.continuousFillSpatial=ee.continuousFillSpatial;let Ce=e,re=m;if(!A){let he=(i?p.rowEnd+1-p.rowStart:p.colEnd+1-p.colStart)%C;const we=i?"rowStart":"colStart",be=i?"rowEnd":"colEnd";he!==0&&(re={...m,[be]:Math.min(m[be],m[we]+he)},Ce={...e,[we]:e[be]-he+1},m[we]=m[we]+he)}const ae=Object.keys(le),fe=ae.length;for(let he=0;he<fe;he++){const we=ae[he],be=le[we].createCopiedEntries(Ce,re),me=ee[we].clone(),de=be.removes,xe=de.length;for(let Le=0;Le<xe;Le++)me.remove(de[Le]);me.load(be.inserts),ve[we]=me}if(A){const he=this.getTables().getItems({address:{rowIndex:e.rowEnd,colIndex:e.colEnd}});if(he.length===1){const we=he[0],be=we.getRange().getCoords();we.resize({colStart:be.colStart,rowStart:be.rowStart,colEnd:i?be.colEnd:m.colEnd,rowEnd:i?m.rowEnd:be.rowEnd})}}const ye=ee.calcGraph.clone();ye.autoFill(e,m),ve.calcGraph=ye,this._updateState(ve),g={...l,ranges:a},f.commit({viewBefore:{view:this.getView(),selection:Ft([e]),selectOptions:n?.autoSelect},viewAfter:{view:this.getView(),selection:g,selectOptions:n?.autoSelect}}),this._autoSelect(n?.autoSelect??!1,g)}catch(m){throw f?.rollback(),m}return!0}_setHyperlinks(e,t,n){const r=n?.description??"Set Hyperlink";this._protectionCheck(()=>["insertHyperlinks","formatCells"],e,r);const o=Ft(e),i=this._beginCommit({description:r});let l=null;try{const a=this._getState();if(!a)return V.EmptyArray;const c=a.hyperlinkSpatial;let u=c,d=a.directStyleSpatial.clone();const h=e.length;for(let f=0;f<h;f++){const g=e[f];let m=null;const p=g.value,w=p!==void 0?p:t;let S;if(w!==null){if(w.isIHyperlink)S={...w._j},m=w.getDisplayText();else if(typeof w=="string")S={address:w},m=w;else if(w.address){const b=w,v={...b};delete v.displayText,S=v,m=b.displayText??b.address}}else S=null;if(l=J.unionRanges(l,g),c===u&&(u=c.clone()),S!==null||c.size()>0){if(m&&t){const b=this._createIncrementalUpdater({orientation:B.Orientation.Column},void 0,{isHyperlink:!0});for(let v=g.colStart;v<=g.colEnd;v++)for(let y=g.rowStart;y<=g.rowEnd;y++)b.pushAt(y,v,m);b.apply()}if(S===null)this._getRangedEntries("hyperlinkSpatial",[g],{onEntry:(b,v)=>(u.insertNonOverlapping({...v,value:S}),v.value)});else{u.insertNonOverlapping({...g,value:S});const b=this._styles,v=y=>{const _=y.value??new Jt(b,J.sanitizeRange(y));let C={..._.getPropertiesAt(0,0,null)};if(C.named){const E=b.getNamed(C.named)?.getRanged().getPropertiesAt(0,0,null);C=V.mergeContentful(E,C)}return delete C.font,C.named=Qe.BuiltInName.Hyperlink,{...y,value:_.cloneWithUpdate(C)}};d.insertNonOverlapping({...g,value:null},{onIntersect:v})}}}this._lastUsedCoordsRead.coords=null,this._updateState({hyperlinkSpatial:u,directStyleSpatial:d}),this._commitAndAutoSelect(i,o,n?.autoSelect,{viewAfter:{ranges:e}})}catch(a){throw i.rollback(),a}}_updateFormulaSpatial(e,t,n,r){if(n){const i=n.length;for(let l=0;l<i;l++){const a=n[l];e.remove(a)}}let o;if(t){const i=[],l=t.length;for(let a=0;a<l;a++){const c=t[a],u=J.sanitizeRange(c),d=new BC(u,c.value.tokens,c.value.references);if(i.push({colStart:u.colStart,rowStart:u.rowStart,colEnd:u.colEnd,rowEnd:u.rowEnd,value:d}),!r)continue;const h=c.value.precedents;let f,g,m=!1;const p=h.length;for(let w=0;!m&&w<p;w++){const S=h[w],b=S.colStart;if(S.colStart===void 0)continue;const v=S.rowStart;Qn.colStart=b,Qn.rowStart=v,Qn.colEnd=b,Qn.rowEnd=v;const y=r.search(Qn)[0];if(y){const _=y.value.getPropertiesAt(v,b,null),C=_?.numberFormat;if(C)if(f){g||(g=Vt.Styles.lookupStyle(f)?.formatType);const E=Vt.Styles.lookupStyle(C)?.formatType;Sy(E,g)>0?(g=E,f=C):m=!0}else f=C}}f&&(o||(o=[]),o.push({colStart:u.colStart,rowStart:u.rowStart,colEnd:u.colEnd,rowEnd:u.rowEnd,value:{numberFormat:f}}))}e.load(i)}return o}_realizeCalcedValues(e){if(!e)return;const t=this._getState();if(!t)return;const n=e.valueInserts,r=e.spillRemoves,o=e.errorRemoves,i=t.cellValuesGrid,l=this._beginCommit();e.isFull&&(t.calcErrorsSpatial.clear(),t.spillSpatial.clear(),t.pendingSpatial.clear());const a=e.valueRemoves;if(a){const g=t.contentfulSpatial,m=a.length;for(let p=0;p<m;p++){const w=a[p];i.delete(w),g.insertNonOverlapping({...w,value:null})}}if(r){const g=t.spillSpatial,m=r.length;for(let p=0;p<m;p++){const w=r[p];g.remove(w)}}if(o){const g=t.calcErrorsSpatial,m=o.length;for(let p=0;p<m;p++){const w=o[p];g.remove(w)}}this._updateFormulaSpatial(t.formulaSpatial,e.formulaInserts,e.formulaRemoves);const c=e.formatInserts;if(c){const g=c.length;for(let m=0;m<g;m++){const p=c[m],w={numberFormat:p.value};p.value=w}this._updateStyles(c,void 0,{autoFit:!0},!0)}if(n){const g=n.tuples;i.setValues(g);const m=this._isDataColumn,p=m?B.Orientation.Column:B.Orientation.Row,w=t.contentfulSpatial,S=g.length;for(let b=0;b<S;b++){const v=g[b],y=v[0],_=v[1],C=_.length;for(let E=0;E<C;E++){const x=_[E],R=x[0],I=R+x[1].length-1,A={colStart:m?y:R,rowStart:m?R:y,colEnd:m?y:I,rowEnd:m?I:y};w.insertNonOverlapping({colStart:A.colStart,rowStart:A.rowStart,colEnd:A.colEnd,rowEnd:A.rowEnd,value:new rr(A,p)})}}}const u=e.spillInserts;if(u){const g=u.length;for(let m=0;m<g;m++){const p=u[m],w=p.value;p.value=new wa(J.sanitizeRange(p),0,w)}t.spillSpatial.load(u)}const d=e.pendingUpdates;if(d){const g=t.pendingSpatial,m=d.length;for(let p=0;p<m;p++){const w=d[p];w.value===!1&&(w.value=null),g.insertNonOverlapping(w)}}const h=e.errorInserts;h&&t.calcErrorsSpatial.load(h);const f=e.formulaInserts;if(f){const g=mr(f);this._autoFit(g,Du)}if(l.commit({forceAmend:!0,viewAfter:{calculationSideEffect:!0}}),(e.bounds||e.isFull)&&!this._initializing){const g=this._rangesListenerMap;if(g.size>0){const m={isDataChange:!0,isTransactional:!1,timeStamp:Date.now(),isUndo:!1,trigger:"calc"};this._notifyRangeListeners(this._rangeListenerSpatial,g,[e.bounds??this._entireCoords],m)}(u||r)&&this._emitter.notify("onSpillsChange")}}_calculate(e,t){const n=this._getState().calcGraph;n.invalidate(e),n.calculate(t)}_calculateFull(){this._initializing||V.debounce(()=>{this._getState()?.calcGraph.calculate({full:!0})},100)()}_setComments(e,t,n){const r=n?.description??"Set Comments",o=Ft(e),i=this._beginCommit({description:r});let l=null;try{const a=this._getState();if(!a)return V.EmptyArray;const c=a.commentsSpatial;let u=c;const d=e.length;for(let h=0;h<d;h++){const f=e[h];let g=null;if(t!==null){let m=t;if(!m)continue;g=typeof m=="string"?{content:{runs:{text:m}}}:{...m}}l=J.unionRanges(l,f),c===u&&(u=c.clone()),u.insertNonOverlapping({...f,value:g})}this._lastUsedCoordsRead.coords=null,this._updateState({commentsSpatial:u}),this._commitAndAutoSelect(i,o,n?.autoSelect,{viewAfter:{ranges:e}})}catch(a){throw i.rollback(),a}}_clear(e,t=null,n,r=!1,o=!1){let i=null,l="Clear",a=!1,c=!1,u=!1,d=!1;t===lt.Content.Formulas?(l=`${l} Formulas`,d=!0):t===lt.Content.Values?(l=`${l} Values`,d=!0):t===lt.Content.Formats?(l=`${l} Formats`,a=!0,i=["formatCells"]):t===lt.Content.Comments?(l=`${l} Comments`,u=!0):t===lt.Content.Hyperlinks?(l=`${l} Hyperlinks`,c=!0,i=["formatCells"]):(i=[],l=`${l} All`,d=!0,a=!0,c=!0,u=!0),i!==null&&this._protectionCheck(()=>i,e,n?.description??l);const h=Ft(e),f=this._beginCommit({description:n?.description??l});let g=this._getState(),m=g.cellValuesGrid,p=g.calcGraph,w=g.contentfulSpatial,S=g.formulaSpatial,b=g.spillSpatial,v=g.pendingSpatial,y=g.calcErrorsSpatial,_=g.rangesListenerSpatial2;d&&(m=m.clone(),p=p.clone(),w=w.clone(),S=S.clone(),b=b.clone(),v=v.clone(),y=y.clone());try{if(c&&this._setHyperlinks(e,null),u&&this._setComments(e,null),a&&(this._updateStyles(e,null),r||this._unmerge(e)),a||d){Ca(0,e,[],w,b,m);const C=e.length;for(let E=0;E<C;E++){const x=e[E];if(d){m.delete(x);const A={...x,value:null};w.insertNonOverlapping(A);const M=p.delete(x);this._updateFormulaSpatial(S,null,M)}const R=this.getTables().getItems({address:x}),I=R.length;for(let A=0;A<I;A++){const M=R[A];J.isRangeWithinRange(M.getAnchorCoords(),x)&&(t===lt.Content.Formats?M.updateStyleOptions({name:null}):M.delete())}if(a){let A=g.conditionalSpatial;A.size()>0&&(A=A.clone(f.getId()),A.insertNonOverlapping({...x,value:null},{noMerge:!0}),g=this._updateState({conditionalSpatial:A}))}if(o){const A=_.search(x),M=A.length;for(let k=0;k<M;k++){const F=A[k];J.isRangeWithinRange(F,x)&&(_===g.rangesListenerSpatial2&&(_=_.clone()),console.log("cut and move listener"),_.remove(F))}}}}this._updateState({cellValuesGrid:m,calcGraph:p,contentfulSpatial:w,formulaSpatial:S,spillSpatial:b,pendingSpatial:v,calcErrorsSpatial:y,rangesListenerSpatial2:_}),this._commitAndAutoSelect(f,h,n?.autoSelect,{viewAfter:{ranges:e}})}catch(C){throw f.rollback(),C}}_merge(e,t=null){if(this._protectionCheck(Fm,e),e.length===1&&J.isSingleCell(e[0]))return;let n=B.Orientations.Both;t?.orientations?n=t?.orientations:t===B.Orientations.Row?n=B.Orientations.Row:t===B.Orientations.Column&&(n=B.Orientations.Column);const r=t?.discardMultipleValues??!1;let o=Ft(e);const i=this.getSelection().getCoords();let l=null;const a=this._beginCommit({description:t?.description??"Merge"});let c=e[0];try{const u=this._getMerges(e);if(xi(e)||u.length>0){const g=J.unionRangesArrays(u),m=J.unionRangesArrays(e);if(!(!g&&!m||g&&m&&J.isRangeWithinRange(g,m)))throw console.warn(Sf,e),new Error(Sf);this._unmerge(u)}const d=this._createIncrementalUpdater({orientation:B.Orientation.Column}),h=[],f=[];try{const g=this._entireCoords,m=this._getState().contentfulSpatial,p=this._getState().directStyleSpatial;let w=!1;const S=y=>{const _={rowIndex:y.rowStart,colIndex:y.colStart};let C=null;if(w){let L=0;const N=m.search(y),D=N.length;for(let O=0;O<D;O++){const H=J.intersectRanges(N[O],y);if(H&&(L+=(H.rowEnd-H.rowStart+1)*(H.colEnd-H.colStart+1)),L>1)throw new Ch("Merging cells would cause some values to be discarded. Use 'discardMultipleValues' option if desired.","discardMultipleValues")}}C||(C=_);let E=null,x=null,R=null,I=null,A=null,M=null,k=null;ln.colStart=y.colStart,ln.rowStart=y.rowStart,ln.colEnd=y.colStart,ln.rowEnd=y.rowStart;let F=p.search(ln);if(F.length>0){k=F[0].value?.getPropertiesAt(y.rowStart,y.colEnd,null);const L=k?.border;E=L?.left??null,x=L?.top??null,A=L?.right??null,M=L?.bottom??null}if(ln.colStart=y.colEnd,ln.colEnd=y.colEnd,F=p.search(ln),F.length>0){const L=F[0],N=L.value?.getPropertiesAt(y.rowStart,y.colEnd,null)?.border;N&&N.right&&(R=N.right)}if(ln.colStart=y.colStart,ln.colEnd=y.colStart,ln.rowStart=y.rowEnd,ln.rowEnd=y.rowEnd,F=p.search(ln),F.length>0){const L=F[0],N=L.value?.getPropertiesAt(y.rowEnd,y.colStart,null)?.border;N&&N.bottom&&(I=N.bottom)}if(!R||!I){ln.colStart=y.colEnd,ln.colEnd=y.colEnd,ln.rowStart=y.rowEnd,ln.rowEnd=y.rowEnd,F=p.search(ln);const L=F?.[0];if(L){const N=L.value?.getPropertiesAt(y.rowEnd,y.colEnd,null)?.border;N&&(R||(R=N.right??null),I||(I=N.bottom??null))}}h.push({...y,value:null}),h.push({...y,value:{...k,border:{top:x,left:E,right:R??A,bottom:I??M,horizontal:null,vertical:null}}}),J.isEqualCells(C,_)||d.pushAt(C.rowIndex,C.colIndex,null),f.push(y),c=J.unionRanges(c,y)},b=[...e].sort(J.createRangeComparator(B.Orientation.Column)),v=b.length;for(let y=0;y<v;y++){const _=b[y];if(!J.isSingleCell(_)){if(l||!i||!J.isCellWithinRange(i.cell,_)||i.cell.rowIndex===_.rowStart&&i.cell.colIndex===_.colStart||(l={...o,cell:{rowIndex:_.rowStart,colIndex:_.colStart}}),!r&&(w=m.search(_).length>0),this._validateOrRemoveOverlaps(_,"merge"),_.colStart<g.colStart||_.rowStart<g.rowStart||_.colEnd>g.colEnd||_.rowEnd>g.rowEnd)throw new Error("We can't merge outside of the maximum cell location.");if(n===B.Orientations.Column){const C=_.rowEnd!==g.rowEnd?_.rowEnd:Math.max(1,g.rowEnd);for(let E=_.rowStart;E<=C;E++)S({..._,rowStart:E,rowEnd:E})}else if(n===B.Orientations.Row){const C=_.colEnd!==g.colEnd?_.colEnd:Math.max(1,g.colEnd);for(let E=_.colStart;E<=C;E++)S({..._,colStart:E,colEnd:E})}else S(_)}}d.apply(),this._indexMerges(f),this._updateStyles(h),this._updateState({})}catch(g){throw g.type?new Ch(g.message??"Unable to merge",g.type):new Error(g.message??"Unable to merge")}l&&(o=l,this.getSelection().updateCoords(l)),a.commit({viewAfter:{view:this.getView(),selection:o,merges:e,ranges:e,selectOptions:t?.autoSelect}}),this._autoSelect(t?.autoSelect??!1,o)}catch(u){throw a.rollback(),u}}_unmerge(e,t){if(this._protectionCheck(Fm,e),xi(e))throw new Error("We can't unmerge intersecting ranges.");if(!this._getState())return null;const n=J.unionRangesArrays(e),r=Ft(e),o=this._beginCommit({description:t?.description??"Unmerge"}),i=o.getState(this).mergeSpatial,l=[];try{const a=e.length;for(let c=0;c<a;c++){const u=e[c],d=i.search(u),h=d.length;for(let f=0;f<h;f++){const g=d[f];if(!J.isSingleCell(u)&&!J.isRangeWithinRange(g,n))throw new Error("We can't unmerge partial cells.");l.push(g)}}if(l.length===0)return o.rollback(),null;this._indexMerges(null,l),this._commitAndAutoSelect(o,r,t?.autoSelect,{viewAfter:{merges:e,ranges:e}})}catch(a){throw o.rollback(),a}}_getMerges(e,t=!1){return e.length===0?V.EmptyArray:this._getRangedEntries("mergeSpatial",e,{excludeHidden:t,fullyContained:!1,onEntry:n=>n.getCoords()})}_clone(){const e={...this._options,container:null};this._ownStyles&&(e.styles=this._styles),this._ownStrings&&(e.strings=this._strings),this._ownResources&&(e.resources=this._resources),this._ownNames&&(e.names=this._names),this._ownsCalculation&&(e.calculation=this._calculation),e.transactions=new ir({transient:!0});const t=new zw(e),n=this._transactions.getState(this);t._updateState(n);const r=new Ou({sheet:this,json:this.getView().toJSON()});return r.selectMovables(this.getView().getMovableSelection()),t.setView(r),t}_getSnapshot(e,t){if(e.length===0)return V.EmptyArray;const n=this._getState();if(!n)return null;t=Object.freeze({...t});const r=this._clone();r.isMarked=!0;const o=this,i=o.getView(),l="Range",a=[],c=((w,S,b,v)=>{const y=[];let _=null,C=null;const E=b&&b.length>0;if(E){const R=b.length;for(let I=0;I<R;I++){const A=b[I].getSnapshot?.(v);A&&(y.push(A),_=Xu(A.getCoords(),_))}}else if(S){const R=S.length;for(let I=0;I<R;I++){const A=S[I],M=w.getMovables().getItems({excludeHidden:!1,fullyContained:!0,address:A}),k=M.length;for(let F=0;F<k;F++){const L=M[F].getSnapshot?.(v);L&&(y.push(L),_=Xu(w.getRange(A).getBounds(),_),C=J.unionRanges(C,A))}}}if(y.length===0)return null;const x=()=>v.description??(y?.length===1?Cs(y[0]?.getName()):"Drawings");return{copyTo:async(R,I)=>{const A={...v,...I},M=R.getSheet(),k=M.getView(),F=k.getMovableSelection(),L=R.getCoords(),N=A?.isCut??!1,D=k.getMovableSelection();k.selectMovables([]);const O=M.beginCommit(A.description??`${N?"Cut":"Copy"} ${x()}`);try{let H=0,z=0;if(D.length>0&&y.length>0){let P=Number.MAX_SAFE_INTEGER,U=Number.MAX_SAFE_INTEGER;for(let ae=0;ae<F.length;ae++){const fe=F[ae].getBounds();P=Math.min(fe.x,P),U=Math.min(fe.y,U)}let ne=Number.MAX_SAFE_INTEGER,ee=Number.MAX_SAFE_INTEGER;const ve=y.length;for(let ae=0;ae<ve;ae++){const fe=y[ae].getCoords();ne=Math.min(fe.x,ne),ee=Math.min(fe.y,ee)}H=P-ne,z=U-ee;const le=y[0].getCoords(),Ce={...le,x:le.x+H,y:le.y+z},re=_m(M.getMovables(),Ce);H+=re.x,z+=re.y}else if(_){const P=M.getRange(L).getBounds();H=P.x-_.x,z=P.y-_.y}const j=[],q=y.length;for(let P=0;P<q;P++){const U=y[P],ne=U.getCoords(),ee={...ne,x:ne.x+H,y:ne.y+z};j.push(U.copyTo({movables:M.getMovables(),bounds:ee},{autoSelect:{addToSelection:!0},...A}))}await Promise.all(j),O?.updateState(M,P=>P),O.commit({viewBefore:P=>({...P,view:w.getView(),movableSelection:D})})}catch(H){throw O.rollback(),H}return null},getName:x,getCoords:()=>C,getMarkOptions:()=>v,toText:()=>E?y[0].toText?.()??null:null,toHtml:()=>E?y[0].toHtml?.()??null:null,toImage:()=>E?y[0].toImage?.()??null:null,getSource:()=>w,isISnapshot:!0}})(r,e,i.getMovableSelection(),t);if(c){if(i.getMovableSelection().length>0)return c;a.push(c)}if(e.length>1)throw new Error(Cf);const u={singleMerge:null};a.push({copyTo(w,S){const b={...t,...S};let v=null;if(!b.skipBlanks){const _=w.getSheet(),C=w.getCoords(),E=fa(C,e[0],b?.fitDestination,b?.transpose);v=_.getRange(E);let x=!1;const R=v.getMerges();if(R.length===1&&J.isEqualRanges(R[0],C))if(J.isSingleCell(e[0]))x=!0;else{const I=(y=p)?{colIndex:y.colStart,rowIndex:y.rowStart}:null;r._getMerges([J.cellToRange(I)]).length===1&&(x=!0)}return x?(u.singleMerge=C,v.clear(b.type??lt.Content.Values)):v.clear(b.type),E}var y}});const d=r._entireCoords,h=e.length;for(let w=0;w<h;w++){const S=e[w],b=n.rangeListenerSpatial.search(S,!1),v=n.rangesListenerMap;a.push({async copyTo(y,_){if(!_.isCut)return;const C=new Set,E=b.length;for(let x=0;x<E;x++){const R=b[x].value,I=R.id;if(C.has(I))continue;const A=v.get(I);if(C.add(I),A.ranges[R.offset]===null)return;const M={isTransactional:!0,isDataChange:!1,trigger:"moveCells",from:r.getRanges(e),to:y},k=r._createRangeEvent(A.ranges,M);r._notifyRangeListener2(A,k,M)}return null},getMarkOptions:()=>t,getCoords:()=>null,isISnapshot:!0})}const f={excludeHidden:!1,fullyContained:!0,onEntry:w=>w.model};for(let w=0;w<h;w++){const S=e[w],b=r._getRangedEntries("tableSpatial",[S],f),v=b.length;for(let y=0;y<v;y++){const _=b[y],C=_.getAnchorCoords(),E=C.colStart-S.colStart,x=C.rowStart-S.rowStart,R=_.getSnapshot(t);a.push({async copyTo(I,A){const M=I.getSheet(),k=I.getCoords();if(r.getProtection().isLocked())return;const F={colStart:k.colStart+E,rowStart:k.rowStart+x,colEnd:k.colEnd+E,rowEnd:k.rowEnd+x};return R.copyTo({tables:M.getTables(),range:F},A)}})}}for(let w=0;w<h;w++){const S=e[w];a.push(bm(o.getColumnHeaders().getRange(S),S,Object.freeze({...t,includeHeaders:S.rowStart<=d.rowStart&&S.rowEnd>=d.rowEnd})))}for(let w=0;w<h;w++){const S=e[w];a.push(bm(o.getRowHeaders().getRange(S),S,Object.freeze({...t,includeHeaders:S.colStart<=d.colStart&&S.colEnd>=d.colEnd})))}const g=FC(o,r,e,l,t,(w,S)=>r._copyRange(o,r,e,w,S,u));a.push(g);const m=r._getState().calcGraph.getSnapshot({range:e[0]});a.push({async copyTo(w,S){const b=w.getSheet(),v=w.getCoords();if(r.getProtection().isLocked())return;const y=b._getState().calcGraph;return m.copyTo({calcGraph:y,range:v},S)}});const p=e[0];return((w,S,b,v,y,_,C=null)=>({async copyTo(E,x){let R=null;const I={...y,...x},A=b.beginCommit(I.description??_);try{const M=w.length;for(let k=0;k<M;k++){const F=await w[k].copyTo(E,I);F&&(R=J.unionRanges(R,F))}A.commit()}catch(M){throw A.rollback(),M}return R},getMarkOptions:()=>y,getName:()=>_,getSource:()=>S,getCoords:()=>v,toText(){let E=C?.toText?.()??null;const x=w.length;for(let R=0;!E&&R<x;R++)E=w?.[R].toText?.();return E??null},toHtml(){let E=C?.toHtml?.()??null;const x=w.length;for(let R=0;!E&&R<x;R++)E=w?.[R].toHtml?.();return E??null},toImage(){let E=C?.toImage?.()??null;const x=w.length;for(let R=0;!E&&R<x;R++)E=w?.[R].toImage?.();return E??null},isISnapshot:!0}))(a,o,r,p,t,l,g)}async _copyRange(e,t,n,r,o,i){if(n.length>1)throw new Error("Only a single selection is supported when using 'Insert Copy'.");if(!n||n.length===0)throw new Error("The source has no range.");const l=r.getSheet();let a=r.getCoords(),c={...n[0]};const u=(o={...o}).isCut;let d=!o.type||o.type===lt.Content.Formats,h=!o.type||o.type===lt.Content.Values,f=!o.type||o.type===lt.Content.Formats||o.type===lt.Content.Hyperlinks;const g=l.getEntireRange(),m=g.getCoords(),p=[],w=[],S=[];let b=[],v=[];const y=(o.fitDestination??!1)&&!J.isSingleCell(a),_=fa(a,c,y,o.transpose);if(y&&(c={...c,colEnd:c.colStart+Math.min(_.colEnd-_.colStart,c.colEnd-c.colStart),rowEnd:c.rowStart+Math.min(_.rowEnd-_.rowStart,c.rowEnd-c.rowStart)}),!J.isRangeWithinRange(_,m))throw console.warn(_,m),new Error("We can't paste outside of the sheet bounds.");let C=null;C=o.undoRange?{view:l.getView(),selection:Ft([o.undoRange.getCoords()])}:{sheet:l,selection:Ft([_])};const E=l.getTransactions().beginCommit({description:o.description??"Paste"});try{if(!this._getState())return V.EmptyArray;const x=new Set,R=o.transpose;let I=!((R||o.adjustCells)&&d)&&x.size===1;if(I){const U=x.values().next();I=J.isRangeWithinRange(c,U.value.getCoords())&&!Ri(c,U.value.getCoords())}I&&(I=l.getTables().getItems({address:_}).length===0),R&&(I=!0),i.singleMerge&&(d=!1,f=!1);const A=a.colStart-c.colStart,M=a.rowStart-c.rowStart,k=o.adjustCells;let F={...nb};if(delete F[je.Type.Style],!d){const U=this.getProtection().isLocked();F={},U&&(F[je.Type.Unlock]=!1)}const L=B.Orientation.Column;let N;if(h){N=g.startIncrementalUpdates({orientation:o.transpose?B.Orientation.Row:B.Orientation.Column});const U={orientation:L,includeRangeTypes:F,bounds:c},ne=new pu(this._strings,U,this._cellOptions),ee=(re,ae,fe)=>{const ye=re[0],he=ne.setState(re),we=ne.context,be=we.getCell(),me=be.isTopLeft();let de=M,xe=A;if(R){const Xe=ye.colIndex-c.colStart,Ge=ye.rowIndex-c.rowStart;de=Xe+fe+a.rowStart,xe=Ge+ae+a.colStart}else de=M+ye.rowIndex+ae,xe=A+ye.colIndex+fe;let Le=!1;const W={value:void 0,style:void 0,hyperlink:void 0};if(h&&(W.value=he,Le=!0),d){const Xe=re[2];Xe&&(Xe.directStyle||Xe.table)&&(W.style=be.getStyle(!I),Le=!0)}f&&(W.hyperlink=be.getHyperlink(),Le=!0);let Ze=W;if(k&&me){const Xe=k(he,we,{rowIndex:de,colIndex:xe},o);Xe!==void 0&&(Ze=Xe,Le=!0)}if(Le&&(N.pushAt(de,xe,Ze),d)){const Xe=be.getSpans();(Xe.width>1||Xe.height>1)&&me&&p.push({colStart:xe,rowStart:de,colEnd:xe+(o.transpose?Xe.height:Xe.width)-1,rowEnd:de+(o.transpose?Xe.width:Xe.height)-1})}},ve=this._cellStateIterator(U);let le={next(){const re=ve.next();if(re.done)return Ct;const ae=re.value[0];let fe;return re.value&&(fe=[ae,re.value]),{done:re.done,value:fe}}};if(!i.singleMerge&&!J.isEqualRanges(_,c)){const re=_.colEnd-_.colStart+1,ae=_.rowEnd-_.rowStart+1;le=new hd({delegate:le,bounds:c,orientation:L,dims:{major:o.transpose?ae:re,minor:o.transpose?re:ae}})}let Ce=le.next();for(;!Ce.done;){const re=Ce.value,ae=re[1],fe=re[0],ye=ae[0];ee(ae,fe.rowIndex-ye.rowIndex,fe.colIndex-ye.colIndex),Ce=le.next()}}const D=t._getState(),O={},H={transpose:R??!1};d&&(O.directStyleSpatial=D.directStyleSpatial,O.continuousFillSpatial=D.continuousFillSpatial,O.mergeSpatial=D.mergeSpatial),u&&(e._clear([c],void 0,void 0,!1,!0),b.push(c),O.rangesListenerSpatial2=D.rangesListenerSpatial2);const z=l,j=z._getState(),q=Object.keys(O),P=q.length;for(let U=0;U<P;U++){const ne=q[U],ee=O[ne].createCopiedEntries(c,_,H),ve=j[ne].clone(),le=ee.removes,Ce=le.length;for(let re=0;re<Ce;re++)ve.remove(le[re]);ve.load(ee.inserts),j[ne]=ve}z._updateState(j),b.push(_),v.push(_),w&&w.length>0&&z._colHeaders.updateHeaderPairs(w),S&&S.length>0&&z._rowHeaders.updateHeaderPairs(S),N?.apply(),p.length>0&&l.getRanges(p).merge(),E.commit({viewBefore:C,viewAfter:U=>({...U,view:l.getView(),selection:Ft(v),ranges:b})})}catch(x){throw console.warn(x),E.rollback(),new Error((R=>`Unable to paste: ${R}`)(x.message),{cause:x})}return J.unionRangesArrays(v)}_snapShotFromSource(e,t){if(e.isISnapshot)return e;const n=e;let r=null;if(n?.isICellRanges)throw new Error(Cf);if(r=n?.isICellRange?n:this.getRange(n),r.isICellRange){const o=r;if(o.isInvalid())throw new Error(xf);return o.getSnapshot(t)}throw new Error(xf)}async _copyFrom(e,t,n){if(!t)throw new Error("Both a source and a destination are required to copy.");const r=this._snapShotFromSource(t),o="Paste",i=this._beginCommit({description:n?.description??o});let l=null;try{const a=this.getRange(e);l=await r.copyTo(a,n);const c=r.getName(),u=[l];n?.isCut&&u.push(r.getCoords()),i.commit({description:c?n?.description??`${o} ${c}`:o,viewAfter:{view:this.getView(),selection:Ft([l]),ranges:u}})}catch(a){throw i.rollback(),a}return l}_createFilter(e,t,n){const r=this;return new xw({initialAnchor:e,maxRangeCoords:this._entireCoords,json:t,transactions:this._transactions,deleteFromContainer:o=>{const i=this._beginCommit({description:o?.description??"Delete Filter"});this._updateState({filter:null}),i.commit()},apply:o=>{console.log("apply Filter",o)},processUpdate:()=>{},isProtected:()=>!r._initializing&&!r.getProtection().isAutoFilterAllowed()})}insertFilter(e){const t=this._rangeToCoords(e,()=>["autoFilter"]);let n=this.getFilter();if(n)return n;n=this._createFilter(t);const r=Ft([t]),o=this._beginCommit({description:"Insert Filter"});return this._updateState({filter:n}),o.commit({viewAfter:{ranges:[t],view:this.getView(),selection:r,selectOptions:void 0}}),n}getFilter(){return this._getState()?.filter??null}insertSort(e){return this._rangeToCoords(e,()=>["sort"]),null}getSort(){return null}_getDefaultShiftOrientation(e){return kv(e,this._entireCoords)}_getDefaultSortCriteria(e,t,n){return qf(this,e,n?this._cellToCoords(n):null,t)}async _insertFrom(e,t,n){if(!t)throw new sr;const r=this._snapShotFromSource(t),o=r.getCoords();let i=fa(e[0],o,n?.fitDestination),l=Ys([i]),a=l;const c=n?.orientation??this._getDefaultShiftOrientation(i),u=this._beginCommit({description:n?.description??"Insert Copied Cells",autoSelect:n?.autoSelect});try{if(this._insertCells([i],c),await this._copyFrom(i,r,{...n,isCut:!1}),n.isCut){const d={...o};if(l=Ys([d]),i={...i},this===r.getSource()){if(c===B.Orientation.Row){if(i.colStart<d.colStart&&i.colEnd>=d.colStart||i.colEnd>d.colEnd&&i.colStart<=d.colEnd)throw new Error(Ef);if(d.colStart===i.colStart&&d.colEnd===i.colEnd){const h=d.rowEnd-d.rowStart+1;i.rowStart<=d.rowStart?(d.rowStart+=h,d.rowEnd+=h):(i.rowStart-=h,i.rowEnd-=h)}}else{if(i.rowStart<d.rowStart&&i.rowEnd>=d.rowStart||i.rowEnd>d.rowEnd&&i.rowStart<=d.rowEnd)throw new Error(Ef);if(d.rowStart===i.rowStart&&d.rowEnd===i.rowEnd){const h=d.colEnd-d.colStart+1;i.colStart<=d.colStart?(d.colStart+=h,d.colEnd+=h):(i.colStart-=h,i.colEnd-=h)}}a=Ys([i])}r.getSource().getRanges([d]).delete(c)}u.commit({viewBefore:{ranges:e,view:this.getView(),selection:l,selectOptions:n?.autoSelect},viewAfter:{ranges:e,view:this.getView(),selection:a,selectOptions:n?.autoSelect}}),this._autoSelect(n?.autoSelect??!1,a)}catch(d){throw u.rollback(),d}return i}_insertCells(e,t,n,r=void 0){const o=this;r=r??((m,p)=>{o._validateCoords(m,p??cu)});const i=n?.description??"Insert Cells",l=(t??this._getDefaultShiftOrientation(e[0]))===B.Orientation.Column;if(this._protectionCheck(()=>[l?"insertColumns":"insertRows"],e,i),xi(e))throw new Error("We can't insert cells with overlapping selections.");const a=this._entireCoords;let c=a.colEnd,u=a.rowEnd;const d=Ft(e),h=this._beginCommit({description:i,operation:{name:"insertCells"}}),f=h.getState(this),g=l?B.Direction.Right:B.Direction.Down;try{let m=f.cellValuesGrid,p=f.contentfulSpatial,w=f.unlockSpatial,S=f.mergeSpatial,b=f.directStyleSpatial,v=f.continuousFillSpatial,y=f.conditionalSpatial,_=f.hyperlinkSpatial,C=f.commentsSpatial,E=f.movableSpatial,x=f.tableSpatial,R=f.calcGraph,I=f.rangesListenerSpatial2,A=f.rangeListenerSpatial,M=f.rangesListenerMap;const k=new Map,F=Xr(e.slice(),B.Direction.Left),L=F.length;for(let H=0;H<L;H++){const z=F[H];c=Math.min(c,z.colStart),u=Math.min(u,z.rowStart);const j=l?z.colEnd-z.colStart+1:z.rowEnd-z.rowStart+1,q=m.getCoords();if(q){const ee={...z,colEnd:l?Math.max(z.colEnd,q?.colEnd??z.colStart)+(z.colEnd-z.colStart+1):z.colStart,rowEnd:l?z.rowStart:Math.max(z.rowEnd,q?.rowEnd??z.rowStart)+(z.rowEnd-z.rowStart+1)},ve=p.search(ee),le=ve.length;for(let Ce=0;Ce<le;Ce++){const re=ve[Ce],ae={...z};l?ae.colEnd=Math.max(ae.colEnd,re.colEnd)+j:ae.rowEnd=Math.max(ae.rowEnd,re.rowEnd)+j,r(ae)}m=m.clone(),m.shift(z,g),this._updateState({cellValuesGrid:m})}const P=z.colStart<=a.colStart&&z.colEnd>=a.colEnd,U=z.rowStart<=a.rowStart&&z.rowEnd>=a.rowEnd,ne=(ee,ve,le,Ce)=>{let re=null;le>1&&(re=ee.at(le-1));const ae=Ce-le+1;ve?.(le,ae),re&&ee.updateHeaderPairs([{address:{min:le,max:Ce},update:re}])};P&&ne(this._rowHeaders,this._rowHeadersShiftCallback,z.rowStart,z.rowEnd),U&&ne(this._colHeaders,this._colHeadersShiftCallback,z.colStart,z.colEnd),p=p.shift({range:z,direction:g,cloneIfUpdate:p===f.contentfulSpatial,coordValidator:r}),w=w.shift({range:z,direction:g,cloneIfUpdate:w===f.unlockSpatial,coordValidator:r}),S=S.shift({range:z,direction:g,cloneIfUpdate:S===f.mergeSpatial,coordValidator:r}),b=b.shift({range:z,direction:g,cloneIfUpdate:b===f.directStyleSpatial,coordValidator:r}),v=v.shift({range:z,direction:g,cloneIfUpdate:v===f.continuousFillSpatial,coordValidator:r}),y=y.shift({range:z,direction:g,cloneIfUpdate:y===f.conditionalSpatial,coordValidator:r}),_=_.shift({range:z,direction:g,cloneIfUpdate:_===f.hyperlinkSpatial,coordValidator:r}),C=C.shift({range:z,direction:g,cloneIfUpdate:C===f.commentsSpatial,coordValidator:r}),E=E.shift({range:z,direction:g,cloneIfUpdate:E===f.movableSpatial,coordValidator:r}),x=x.shift({range:z,direction:g,cloneIfUpdate:x===f.tableSpatial,coordValidator:r}),R=R.shift({range:z,direction:g,cloneIfUpdate:R===f.calcGraph}),A=A.shift({range:z,direction:g,cloneIfUpdate:A===f.rangeListenerSpatial,onShift:ee=>{M===f.rangesListenerMap&&(M=new Map(M)),this._processListenerShift(M,k,f.rangesListenerMap,ee)}}),I=I.shift({range:z,direction:g,cloneIfUpdate:I===f.rangesListenerSpatial2,coordValidator:r})}let N=f.formulaSpatial,D=f.spillSpatial,O=f.pendingSpatial;R!==f.calcGraph&&(N=N.clone(),D=D.clone(),O=O.clone()),this._updateState({contentfulSpatial:p,unlockSpatial:w,mergeSpatial:S,directStyleSpatial:b,continuousFillSpatial:v,conditionalSpatial:y,hyperlinkSpatial:_,commentsSpatial:C,movableSpatial:E,tableSpatial:x,calcGraph:R,formulaSpatial:N,spillSpatial:D,pendingSpatial:O,rangesListenerSpatial2:I,rangeListenerSpatial:A,rangesListenerMap:M}),this._commitAndAutoSelect(h,d,n?.autoSelect,{viewAfter:{ranges:F,listeners:k}})}catch(m){throw console.warn(m),h.rollback(),m instanceof Nt?new Error(m.message??cu):m}}_deleteCells(e,t,n){const r=(t??this._getDefaultShiftOrientation(e[0]))===B.Orientation.Column,o=n?.description??"Delete Cells";if(this._protectionCheck(()=>[r?"deleteColumns":"deleteRows"],e,o),xi(e))throw new Error("We can't delete cells with overlapping selections.");const i=this._entireCoords;let l=i.colEnd,a=i.rowEnd;const c=r?B.Direction.Left:B.Direction.Up,u=Ft(e),d=this._beginCommit({description:o,operation:{name:"deleteCells"}}),h=d.getState(this);try{let f=h.cellValuesGrid,g=h.contentfulSpatial,m=h.mergeSpatial,p=h.unlockSpatial,w=h.directStyleSpatial,S=h.continuousFillSpatial,b=h.conditionalSpatial,v=h.hyperlinkSpatial,y=h.commentsSpatial,_=h.movableSpatial,C=h.movableMapModel,E=h.tableSpatial,x=h.tableMapModel,R=h.calcGraph,I=h.rangesListenerSpatial2,A=h.rangeListenerSpatial,M=h.rangesListenerMap;const k=new Map,F=Xr(e.slice(),B.Direction.Left),L=F.length;for(let N=0;N<L;N++){const D=F[N];l=Math.min(l,D.colStart),a=Math.min(a,D.rowStart),f.getCoords()&&(f=f.clone(),f.shift(D,c),this._updateState({cellValuesGrid:f}));const O=D.colStart<=i.colStart&&D.colEnd>=i.colEnd,H=D.rowStart<=i.rowStart&&D.rowEnd>=i.rowEnd;O&&this._rowHeadersShiftCallback(D.rowStart,-1*(D.rowEnd-D.rowStart+1)),H&&this._colHeadersShiftCallback(D.colStart,-1*(D.colEnd-D.colStart+1)),g=g.shift({range:D,direction:c,cloneIfUpdate:g===h.contentfulSpatial}),p=p.shift({range:D,direction:c,cloneIfUpdate:p===h.unlockSpatial}),m=m.shift({range:D,direction:c,cloneIfUpdate:m===h.mergeSpatial}),w=w.shift({range:D,direction:c,cloneIfUpdate:w===h.directStyleSpatial}),S=S.shift({range:D,direction:c,cloneIfUpdate:S===h.continuousFillSpatial}),b=b.shift({range:D,direction:c,cloneIfUpdate:b===h.conditionalSpatial}),v=v.shift({range:D,direction:c,cloneIfUpdate:v===h.hyperlinkSpatial}),y=y.shift({range:D,direction:c,cloneIfUpdate:y===h.commentsSpatial}),_=_.shift({range:D,direction:c,cloneIfUpdate:_===h.movableSpatial}),E=E.shift({range:D,direction:c,cloneIfUpdate:E===h.tableSpatial}),R=R.shift({range:D,direction:c,cloneIfUpdate:R===h.calcGraph}),A=A.shift({range:D,direction:c,cloneIfUpdate:A===h.rangeListenerSpatial,onShift:z=>{M===h.rangesListenerMap&&(M=new Map(M)),this._processListenerShift(M,k,h.rangesListenerMap,z)}}),I=I.shift({range:D,direction:c,cloneIfUpdate:I===h.rangesListenerSpatial2})}this._updateState({contentfulSpatial:g,unlockSpatial:p,mergeSpatial:m,directStyleSpatial:w,continuousFillSpatial:S,conditionalSpatial:b,hyperlinkSpatial:v,commentsSpatial:y,movableSpatial:_,movableMapModel:C,tableSpatial:E,tableMapModel:x,calcGraph:R,rangesListenerSpatial2:I,rangeListenerSpatial:A,rangesListenerMap:M}),this._commitAndAutoSelect(d,u,n?.autoSelect,{viewAfter:{ranges:F,listeners:k}})}catch(f){throw d.rollback(),f instanceof Nt?new Error(f.message??cu):f}}_autoFit(e,t){if(this._closed)throw new Error(On);t={expandOnly:!1,skipCustomSize:!1,minContent:!1,...t};const n="Autofit";let r;const o=ji(e,this._entireCoords,!0),i=Wi(e,this._entireCoords,!0);!o&&i?(t.orientations=t.orientations??B.Orientations.Column,r=`${n} ${bo}`):!i&&o?(t.orientations=t.orientations??B.Orientations.Row,r=`${n} ${yo}`):i&&o?(t.orientations=t.orientations??B.Orientations.Both,r=`${n} All`):(t.orientations=t.orientations??B.Orientations.Both,r=`${n}`);let l=t.orientations!==B.Orientations.Row;this._colHeaders.isProtected()&&(l=!1);let a=t.orientations!==B.Orientations.Column;if(this._rowHeaders.isProtected()&&(a=!1),!a&&!l)return;const c=l&&(t.expandOnly===!1||t.expandOnly===B.Orientation.Row),u=a&&(t.expandOnly===!1||t.expandOnly===B.Orientation.Column),d=t.minContent,h=Ft(e),f=this._beginCommit({description:t.description??r});try{let g=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER,p=!1,w="",S=-1,b=!1,v=!1,y=!1,_=Number.MAX_SAFE_INTEGER,C=Number.MIN_SAFE_INTEGER;const E=this._styles.getNormal(),x=this._cellOptions,R=t.orientations===B.Orientations.Row,I=new Map,A=dd(e,1);A.sort(J.createRangeComparator(B.Orientation.Column));const M=A.length,k={skipCustomSize:t.skipCustomSize},F=ke.getDeviceScale(),L=this._defaultRowHeight()*F,N=(O,H=1)=>{if(O!==0&&O!==null&&!(H>1))return O=Math.max(O,L),z=>u?O:Math.max(z,O)},D=(O,H=1)=>{if(O!==0&&O!==null&&!(H>1))return z=>c?O:Math.max(z,O)};for(let O=0;O<M;O++){const H=[];let z=-1,j=!1,q=E,P=1,U=1,ne=1;const ee=A[O];let ve=ee.colStart,le=ee.rowStart,Ce=ee.colEnd,re=ee.rowEnd;const ae=this._getUsedCoords();(u||c)&&ae&&(ve=u?ae.colStart:ee.colStart,le=c?ae.rowStart:ee.rowStart,Ce=u?ae.colEnd:ee.colEnd,re=c?ae.rowEnd:ee.rowEnd);const fe={includeRangeTypes:{[je.Type.Style]:!1,[je.Type.Merge]:!1,[je.Type.Continuous]:!1,[je.Type.Contentful]:!1},excludeHidden:!1,bounds:{colStart:ve,rowStart:le,colEnd:Ce,rowEnd:re},orientation:B.Orientation.Column},ye=a?[]:void 0,he=l?[]:void 0,we=(De,Te,ze)=>{if(De>Te)return null;const Z=[];let Se=De;const te=ze?ze.length:0;for(let ie=0;ie<te;ie++){const $=ze[ie],Y=$.min,Q=$.max;if(Se>=Y){Se=Q+1;continue}const K={address:{min:Se,max:Y-1},update:Dm};Z.push(K),Se=Q+1}if(Se<=Te){const ie={address:{min:Se,max:Te},update:Dm};Z.push(ie)}return Z},be=this._rangeStateIterator(fe);let me=be.next();for(;!me.done;){const De=me.value,Te=De.intersection,ze=De.start,Z=De.end;ai.colStart=ze.colIndex,ai.rowStart=ze.rowIndex,ai.colEnd=Z.colIndex,ai.rowEnd=Z.rowIndex;const Se=J.intersectRanges(ai,ee,qC),te=Ni(0,Se,Te,x).getBestFit();if(a){const ie=Math.max(ze.rowIndex,le),$={address:{min:ie,max:Math.min(Z.rowIndex,re)},update:{size:N(te.height),autoSize:!0}};ye.push($)}if(l){const ie=Math.max(ze.colIndex,ve),$={address:{min:ie,max:Math.min(Z.colIndex,Ce)},update:{size:D(te.width),autoSize:!0}};he.push($)}me=be.next()}if(he){let De=this._colHeaders.updateHeaderPairs(he,k);De=gr(To(xg(De)));const Te=we(ee.colStart,ee.colEnd,De);Te&&this._colHeaders.updateHeaderPairs(Te,k)}if(ye){let De=this._rowHeaders.updateHeaderPairs(ye,k);De=gr(To(xg(De)));const Te=we(ee.rowStart,ee.rowEnd,De);Te&&this._rowHeaders.updateHeaderPairs(Te,k)}const de=this._cellStateIterator({...fe,includeRangeTypes:{[je.Type.Merge]:!1,[je.Type.Table]:!1,[je.Type.Style]:!1,[je.Type.Continuous]:!1},ignoreEmptyIntersections:!0});let xe,Le,W,Ze=de.next(),Xe=1,Ge=1;for(;!Ze.done;){const De=Ze.value,Te=De[0],ze=De[2];let Z=E;const Se=ze?.directStyle??ze?.table.getStyle()??null;Se===xe?Z=Le:(Z=Se?Ni(0,J.cellToRange(Te,JC),ze,x):E,Le=Z);let te=1,ie=1;const $=ze?.merge??null;if($===W)te=Xe,ie=Ge;else{if($){const Ne=$.getCoords();te=Ne.colEnd-Ne.colStart+1,ie=Ne.rowEnd-Ne.rowStart+1}else te=1,ie=1;Xe=te,Ge=ie}const Y=Te.colIndex,Q=Te.rowIndex,K=De[1],se=pn(K),X=J.isCellWithinRange(Te,ee),ue=ze?.continuous??null;ue&&(ne=ue.getCoords().colEnd-Y+1);let _e=!1,Re=!1;if(xe===Se&&te===P&&ie===U&&se!==Me.String&&se!==Me.Error&&X===j||(_e=!0,se===Me.RichData&&(Re=!0),Re&&(_e=!1)),xe=Se,W=$,(z!==Y||_e)&&(z!==-1&&H.push({col:z,style:q,spanWidth:te,spanHeight:ie,minVal:g,maxVal:m,hasZero:p,text:w,textId:S,hasFalse:v,hasTrue:b,hasEmpty:y,minRow:_,maxRow:C,colWidth:this._colHeaders.getSpanSize(z),measureWidth:-1,measureHeight:-1,colSpan:ne,isFit:j}),z=Y,q=Z,j=X,P=te,U=ie,g=Number.MAX_SAFE_INTEGER,m=Number.MIN_SAFE_INTEGER,p=!1,w="",S=-1,v=!1,b=!1,y=!1,_=Q),C=Q,!Re)if(K===null)y=!0;else switch(se){case Me.Number:K===0&&(p=!0),g=Math.min(g,K),m=Math.max(m,K);break;case Me.String:w=K,S=K;break;case Me.Error:w=K.toString(),S=-1;break;case Me.Boolean:K?b=!0:v=!0}Ze=de.next()}z!==-1&&H.push({col:z,style:q,spanWidth:P,spanHeight:U,minVal:g,maxVal:m,hasZero:p,text:w,textId:S,hasFalse:v,hasTrue:b,hasEmpty:y,minRow:_,maxRow:C,colWidth:this._colHeaders.getSpanSize(z),colSpan:ne,measureWidth:-1,measureHeight:-1,isFit:j});let ce=-1,We=-1;const qe=H.length;for(let De=0;De<qe;De++){const Te=H[De],ze=R||!Te.isFit,Z=Te.maxVal,Se=Te.style,te=Te.colSpan;let ie=Te.colWidth;if(te>1&&(ie=this._colHeaders.getSpanSize(z,z+te)),ce=0,We=0,Z!==Number.MIN_SAFE_INTEGER){const Y=eo(Me.Number,Se,Z,x,ie,d,ze);ce=Y.width,We=Y.height;const Q=Te.minVal;if(Q*Z<0){const K=eo(Me.Number,Se,Q,x,ie,d,ze);ce=Math.max(ce,K.width),We=Math.max(We,K.height)}if(Te.hasZero&&Q!==0&&Z!==0){const K=eo(Me.Number,Se,0,x,ie,d,ze);ce=Math.max(ce,K.width),We=Math.max(We,K.height)}}const $=Te.text;if($.length>0){const Y=eo(Me.String,Se,$,x,ie,d,ze,void 0,I);ce=Math.max(ce,Y.width),We=Math.max(We,Y.height)}if(Te.hasTrue||Te.hasFalse){const Y=eo(Me.Boolean,Se,!Te.hasFalse,x,ie,d,ze);ce=Math.max(ce,Y.width),We=Math.max(We,Y.height)}if(Te.hasEmpty){const Y=eo(Me.Boolean,Se,null,x,ie,d,ze);ce=Math.max(ce,Y.width),We=Math.max(We,Y.height)}Te.measureWidth=ce,Te.measureHeight=We}if(l){const De=[];for(let Te=0;Te<qe;Te++){let ze=H[Te];const Z=ze.col;let Se=H[Te+1],te=ze.measureWidth??0;for(;Se&&Se.col===Z;)Se.measureWidth&&(te=Math.max(Se.measureWidth??0,te)),Te++,ze=H[Te],Se=H[Te+1];te===0&&(te=null);const ie=D(te,ze.spanWidth);De.push({address:{min:Z,max:Z},update:{size:ie,autoSize:!0}})}this._colHeaders.updateHeaderPairs(De,k)}if(a){let De=1;const Te={onUpdate:(te,ie,$)=>{if(!(De>1))return te===null?ie:Math.max(ie,te)}};let ze=[];for(let te=0;te<qe;te++){const ie=H[te];De=ie.spanHeight,ze=gr(sd(ze,{min:ie.minRow,max:ie.maxRow,value:ie.measureHeight},Te))}const Z=ze.length,Se=new Array(Z);for(let te=0;te<Z;te++){const ie=ze[te],$=N(ie.value,1),Y={address:{min:ie.min,max:ie.max},update:{size:$,autoSize:!0}};Se[te]=Y}this._rowHeaders.updateHeaderPairs(Se,k)}}this._commitAndAutoSelect(f,h,t?.autoSelect,{viewAfter:{ranges:e}})}catch(g){throw f.rollback(),g}}_createRangeEvent(e,t){const n=this,r=()=>{const i=n._getState();return this._closed||i.deleted?Fr(null):e?Array.isArray(e)?n._createRanges(e):n._createRange(e):Fr(this,this._entireCoords)},o=t.trigger;return{getSource:r,getFrom:()=>t.from??null,getTo:()=>t.to??null,trigger:o,isUndo:t.isUndo??!1,isDataChange:t.isDataChange??!1,isTransactional:t.isTransactional??!0,toString:()=>`SheetRangeEvent: ('${o}', ${r().toString()})`,timeStamp:t.timeStamp??Date.now()}}_notifyAddressListeners(e,t,n,r){const o=t.entries();let i=o.next();const l=r.trigger;for(;!i.done;){const a=i.value[0];let c=i[1];if(c||(c=e.get(a)),c&&!n.has(a)){let u=!1;const d=c.options;d&&(u=l==="address"?d.ignoreAddressChanges:d.ignoreDataChanges),u!==!0&&c.notify(r),n.add(a)}i=o.next()}}_notifyDataListeners(e,t,n=null,r,o){if(!e)return;const i=n.length;for(let l=0;l<i;l++){const a=n[l];if(!a)continue;const c=e.search(a),u=c.length;for(let d=0;d<u;d++){const h=c[d].value.groupId;if(!r.has(h)){const f=t.get(h);f.options?.ignoreDataChanges!==!0&&f.notify(o),r.add(h)}}}}_notifyRangeListeners(e,t,n=null,r){if(!e)return;const o=new Set;r.timeStamp||(r.timeStamp=Date.now());const i=n.length;for(let l=0;l<i;l++){const a=n[l];if(!a)continue;const c=e.search(a),u=c.length;for(let d=0;d<u;d++){const h=c[d].value.id;if(o.has(h))continue;const f=t.get(h);o.add(h);const g=f.ranges,m=g.length;for(let p=0;p<m;p++){const w=g[p],S=this._createRangeEvent(w,r);this._notifyRangeListener2(f,S,r)}}}}_notifyRangeListener2(e,t=null,n=null){if(e.options?.ignoreDataChanges&&n?.isDataChange)return;const r=e.handler??e.handlerW.deref();if(r)try{r?.(t)}catch(o){console.warn(o)}}_notifyUsedRangeChange(){this._lastCellRead.coords=null,this._lastUsedCoordsRead.coords=null,this._emitter.notify("onUsedRangeChange")}_notifyMergeChange(){this._emitter.notify("onMergesChange")}addListeners(e,t){let n=null;if(e.onLayoutChange){const o=e,i={onSizesChange:()=>{o.onLayoutChange(this)}};n=[],n.push(this._colHeaders.addListeners(i,t)),n.push(this._rowHeaders.addListeners(i,t))}let r=this._emitter.addListeners(e,t);if(n){const o=r;r=()=>{const i=n.length;for(let l=0;l<i;l++)n[l]();o()}}return r}_addRangesListeners(e,t,n){if(this._closed)throw new Error(On);if(!t)throw new Error(mf);n=n?{...Pl,...n}:Pl;const r=n?.transactional??!1,o=this,i=GC++%Number.MAX_SAFE_INTEGER,l=()=>{let m=null,p=null;if(r){const v=o._getState();if(!v)return;m=v.rangeListenerSpatial.clone(),p=new Map(v.rangesListenerMap)}else m=o._rangeListenerSpatial,p=o._rangesListenerMap;const w=p.get(i);if(!w)return void console.log("Listener not found");const S=w.ranges,b=S.length;for(let v=0;v<b;v++){const y=J.sanitizeRange(S[v]);y!==null&&m.remove(y,(_,C)=>{if(C.value.id===i)return!0})}if(p.delete(i),r){const v=this._beginCommit({description:"Remove Range Listener"});this._updateState({rangeListenerSpatial:m,rangesListenerMap:p}),v.commit({forceAmend:!0})}},a=[...e];let c={id:i,handler:null,handlerW:null,removeListener:l,options:n,ranges:a};n?.weakly?c.handlerW=new WeakRef(t):c.handler=t;let u=null,d=null,h=null;if(r){h=this._beginCommit({description:"Add Range Listener"});const m=this._getState();u=m.rangeListenerSpatial.clone(),d=new Map(m.rangesListenerMap)}else u=o._rangeListenerSpatial,d=o._rangesListenerMap;const f=[],g=e.length;for(let m=0;m<g;m++){const p={...e[m],value:{id:i,offset:m,options:n}};f.push(p)}return u.load(f),d.set(i,c),h&&(this._updateState({rangeListenerSpatial:u,rangesListenerMap:d}),h.commit({forceAmend:!0})),l}_addRangesListeners2(e,t,n,r){if(this._closed)throw new Error(On);if(!t)throw new Error(mf);n=n?{...Pl,...n}:Pl;const o=n?.transactional??!1,i=this,l=V.uuidV4(),a=UC++,c=()=>{let y=null,_=null;const C=i._getState();if(!C)return;y=C.rangesListenerSpatial2.clone(),_=C.rangesListenerMap2;const E=_.get(l);if(E){const R=E?.spatialsIds,I=E?.coords,A=R.length;for(let M=0;M<A;M++){const k=R[M],F=I[M];y.remove(F,(L,N)=>{if(N.value.uuid===k)return!0})}_=new Map(C.rangesListenerMap2),_.delete(l)}const x=this._beginCommit({description:"Remove Range Listener"});this._updateState({rangesListenerMap2:_}),x.commit({forceAmend:!0}),o||this._rangesListenerSorted.delete(a)};let u=null,d=this._beginCommit({description:"Add Range Listener"});const h=this._getState();u=h.rangesListenerSpatial2.clone();let f=null,g=null;n?.weakly?g=new WeakRef(t):f=t;const m=[],p=[...e];let w=[];const S=e.length;for(let y=0;y<S;y++){const _={...e[y]};p[y]=_;const C=V.uuidV4(),E=new zC(l,C,n?.ignoreAddressChanges??!1);w.push(C);const x={...J.sanitizeRange(_),value:E};m.push(x)}u.load(m),n={...n};const b=new PC(l,w,p,r,this,a,f,g,c,n),v=new Map(h.rangesListenerMap2);return v.set(l,b),this._updateState({rangesListenerSpatial2:u,rangesListenerMap2:v}),o||this._rangesListenerSorted.set(a,b),d.commit({forceAmend:!0}),c}_getUsedCoords(e){const t=this._getState();if(!t)return null;let n=t.cellValuesGrid.getCoords();return n=J.unionRanges(t.mergeSpatial.getBoundingCoords(),n),n=J.unionRanges(t.directStyleSpatial.getBoundingCoords(),n),n=J.unionRanges(t.formulaSpatial.getBoundingCoords(),n),n=J.unionRanges(t.spillSpatial.getBoundingCoords(),n),n=J.unionRanges(t.pendingSpatial.getBoundingCoords(),n),n&&(n.colStart=Math.max(n.colStart,this._entireCoords.colStart),n.rowStart=Math.max(n.rowStart,this._entireCoords.rowStart),n.colEnd=Math.min(n.colEnd,this._entireCoords.colEnd),n.rowEnd=Math.min(n.rowEnd,this._entireCoords.rowEnd)),!n||n.rowStart>n.rowEnd||n.colStart>n.colEnd?(this._lastUsedCoordsRead.coords=null,null):(this._lastUsedCoordsRead&&this._lastUsedCoordsRead.coords&&Ri(this._lastUsedCoordsRead.coords,n)||(this._lastUsedCoordsRead.coords=n,this._lastUsedCoordsRead.range=null),this._lastUsedCoordsRead.coords)}_isContentful(e,t){return!!this._contentCounts(e,void 0,t)}_getCount(e,t=!1){const n=this._contentCounts(e,KC,t);return n?n[lt.Content.Values]??0:0}_contentCounts(e,t,n){if(!t){const d=Object.keys(lt.Content),h=d.length;t=[];for(let f=0;f<h;f++){const g=d[f],m=lt.Content[g];m!==lt.Content.Formats&&m!==lt.Content.Tables&&t.push(m)}}const r={},o=t.length;let i,l,a=!1;for(let d=0;d<o;d++){const h=t[d];h===lt.Content.Values?r[je.Type.Contentful]=!1:h===lt.Content.Formulas?r[je.Type.Formula]=!1:h===lt.Content.Formats?r[je.Type.Style]=!1:h===lt.Content.Tables&&(r[je.Type.Table]=!1,a=!0)}const c=()=>{i=new Set,l={};for(let d=0;d<o;d++){const h=t[d];l[h]=0}},u=e.length;for(let d=0;d<u;d++){const h=e[d],f=this._rangeStateIterator({includeRangeTypes:r,excludeHidden:n,bounds:h});let g=f.next();for(;!g.done;){l||c();const m=g.value,p=(m.end.colIndex-m.start.colIndex+1)*(m.end.rowIndex-m.start.rowIndex+1),w=m.intersection;if(w){w.contentful&&(l[lt.Content.Values]+=p),w.formula&&(l[lt.Content.Formulas]+=p);const S=w.table;S&&(a&&!i.has(S)&&(l[lt.Content.Tables]+=1,i.add(S)),w.contentful||(l[lt.Content.Values]+=p))}g=f.next()}}return l}getSelectedCell(){const e=this.getSelection().getCoords().cell,t=this._lastCellSelected;if(t?.cell&&J.isEqualCells(e,t.coords))return t.cell;const n=this.getRange(e).getCell();return this._lastCellSelected={coords:e,cell:n},n}find(e,t){return this.getEntireRange().find(e,t)}_find(e,t,n){if(this._closed)throw new Error(On);if(!t)return null;const r=[...e],o=n?.orientation??B.Orientation.Row,i=n?.reverse,l=!n?.disableWrap,a=n?.from?this._cellToCoords(n?.from):null;let c=null;if(a){let C=-1;for(let k=0;C===-1&&k<r.length;k++)J.isCellWithinRange(a,r[k])&&(C=k);c=J.cellToRange(a);let E=fd(r[C],c,o);E.push(c);const x=J.createRangeComparator(o,i);E.sort(x);let R=-1;const I=E.length;for(let k=0;k<I;k++)x(E[k],c)<=0&&(R=k);r.splice(C,1,...E);const A=C+R,M=[];for(let k=0;k<=A;k++)M.push(r.shift());if(l){const k=M.length;for(let F=0;F<k;F++)r.push(M[F])}}if(r.length===0)return Qt;const u=n?.fields?.includes(lt.Content.Formulas)??!1,d=n?.fields?.includes(lt.Content.Values)??!0,h=n?.matchEntireCell??!1,f=n?.matchCase??!1,g=n?.useRegex??!1,m=((C,E,x)=>{const R=E?"":"i";return x?new RegExp(C,R):new RegExp((I=>{let A=I.replace(/[|\\{}()[\]^$+.]/g,"\\$&");return A=A.replace(/~\?/g,"\\?"),A=A.replace(/~\*/g,"\\*"),A=A.replace(/~~/g,"~"),A})(C),R)})(t,f,g),p=t.length;let w=(C,E)=>{const x=A=>{if(!A)return!1;let M=!!A.match(m);return M&&h&&A.length!==p&&(M=!1),M},R=E.getCell();let I=!1;return!I&&u?I=x(R.getFormulaText()??R.toTextUnformatted(!0)):d&&(I=x(R.getNumberFormat().displayText)),I};if(n?.matchCustom){const C=n.matchCustom,E={matchCase:f,matchEntireCell:h,useRegex:g,fields:n?.fields??[lt.Content.Formulas]};let x,R,I=w;const A=()=>I(x,R);w=(M,k)=>(x=M,R=k,C(M,A,E,k))}let S=-1,b=null,v=Ct,y=!1;const _=()=>{if(v.done){if(S++,S>=r.length)return void(y=!0);b=this._cellIterator({reverse:i,orientation:o,includeRangeTypes:!1,bounds:r[S]})}if(v=b.next(),!v.done){const C=v.value;return w(C.value,C.context)}return!1};return{next:()=>{let C=null;for(;!y&&!C;)_()&&(C=v.value.context.getCell());return C?{value:C,done:!1}:Ct}}}isDate1904(){return this._isDate1904}_surroundingRegion(e,t){const n=this._getState(),r=t?.contentOnly??!1,o=this._entireCoords;if(!r){const l=n.tableSpatial.search(e);if(l.length>0){const a=l[0].value.model,c=a.getUsedRange().getCoords(),u=a.getRange().getCoords();return J.isEqualRanges(c,e)?u:J.isEqualRanges(u,e)?o:c}}const i=r?e:o;return((l,a,c=2e4)=>{if(!a||a.length===0)return null;let u,d=!1;for(let v=0;v<a.length;v++){const y=a[v];u=J.unionRanges(u,y.getBoundingCoords()),d=d||y.search(l).length>0}if(!u)return null;const h={...J.EmptyRange},f=l;let g=d?{...l}:null;if(!g){const v=(_=>{let C=[];const E=a.length;for(let x=0;x<E;x++){const R=a[x].search(_),I=R.length;C=I>0?new Array(I):void 0;for(let A=0;A<I;A++){const M=R[A];C[A]=M}}return C||V.EmptyArray})({colStart:l.colEnd,rowStart:l.rowEnd,colEnd:l.colEnd+1,rowEnd:l.rowEnd+1}),y=v.length;if(y>0){g={...l};for(let _=0;_<y;_++){const C=v[_];g.colEnd=Math.max(g.colEnd,C.colStart),g.rowEnd=Math.max(g.rowEnd,C.rowStart)}}}const m={...J.EmptyRange},p=()=>{const v=a.length;for(let y=0;y<v;y++){const _=a[y].search(h),C=_.length;for(let E=0;E<C;E++){const x=_[E];g=J.unionRanges(g,x,m)}}return g};h.colStart=l.colStart,h.rowStart=l.rowStart,h.colEnd=l.colEnd,h.rowEnd=l.rowEnd,p();const w={...g},S={...J.EmptyRange};let b=0;do{if(h.colStart=S.colStart=w.colStart,h.rowStart=S.rowStart=w.rowStart,h.colEnd=S.colEnd=w.colEnd,h.rowEnd=S.rowEnd=w.rowEnd,w.colStart>u.colStart&&(h.colStart=w.colStart-1,h.colEnd=w.colStart-1,h.rowStart=w.rowStart-1,h.rowEnd=w.rowEnd+1,p()),w.rowStart>u.rowStart&&(h.rowStart=w.rowStart-1,h.rowEnd=w.rowStart-1,h.colStart=w.colStart-1,h.colEnd=w.colEnd+1,p()),w.colEnd<u.colEnd&&(h.colStart=w.colEnd+1,h.colEnd=w.colEnd+1,h.rowStart=w.rowStart-1,h.rowEnd=w.rowEnd+1,p()),w.rowEnd<u.rowEnd&&(h.rowStart=w.rowEnd+1,h.rowEnd=w.rowEnd+1,h.colStart=w.colStart-1,h.colEnd=w.colEnd+1,p()),!g)return null;if(w.colStart=g.colStart,w.rowStart=g.rowStart,w.colEnd=g.colEnd,w.rowEnd=g.rowEnd,J.isEqualRanges(w,S))return J.isEqualRanges(f,w)?null:w;if(J.isEqualRanges(w,f))return null;if(J.isEqualRanges(w,S))return w;b++}while(b<c);return null})(e,[n.contentfulSpatial,n.mergeSpatial,n.formulaSpatial,n.spillSpatial,n.pendingSpatial])||i}_extendRange(e,t){if(this._closed)throw new Error(On);const n=this._entireCoords,r=this,o={excludeHidden:!0,onEntry:(u,d)=>d},i={excludeHidden:!0,onEntry:(u,d)=>u.tvTl()===void 0?null:d};let l;const a=r._getRangedEntries("mergeSpatial",[J.cellToRange(t)],i);a.length>0&&(l=a[0]);const c=[u=>r._getRangedEntries("mergeSpatial",u,i),u=>r._getRangedEntries("contentfulSpatial",u,o)];return((u,d,h,f,g)=>{let m,p,w,S={...d},b=J.cellToRange(S),v=f(b).length>0;if(v){let _=1,C=u===B.Direction.Up||u===B.Direction.Down;h&&(_+=C?h.rowEnd-h.rowStart:h.colEnd-h.colStart),u!==B.Direction.Left&&u!==B.Direction.Up||(_=-_),C?S.rowIndex=S.rowIndex+_:S.colIndex=S.colIndex+_,b=J.cellToRange(S),v=f(b).length>0}switch(u){case B.Direction.Up:b.rowStart=Math.min(g.rowStart,b.rowStart),p=f(b).sort(J.createRangeComparator(B.Orientation.Row,!0)),m=d.rowIndex,w=v?p.length===1&&m===p[0].rowStart?g.rowStart:p[0].rowStart:p.length===0?g.rowStart:p[0].rowEnd;break;case B.Direction.Down:b.rowEnd=Math.max(g.rowEnd,b.rowEnd),p=f(b).sort(J.createRangeComparator(B.Orientation.Row,!1)),m=d.rowIndex,w=v?p.length===1&&m===p[0].rowEnd?g.rowEnd:p[0].rowEnd:p.length===0?g.rowEnd:p[0].rowStart;break;case B.Direction.Left:b.colStart=Math.min(g.colStart,b.colStart),p=f(b).sort(J.createRangeComparator(B.Orientation.Column,!0)),m=d.colIndex,w=v?p.length===1&&m===p[0].colStart?g.colStart:p[0].colStart:p.length===0?g.colStart:p[0].colEnd;break;case B.Direction.Right:b.colEnd=Math.max(g.colEnd,b.colEnd),p=f(b).sort(J.createRangeComparator(B.Orientation.Column,!1)),m=d.colIndex,w=v?p.length===1&&m===p[0].colEnd?g.colEnd:p[0].colEnd:p.length===0?g.colEnd:p[0].colStart}if(v&&p.length>1){let _=!1;for(let C=1;!_&&C<p.length;C++){const E=p[C];switch(u){case B.Direction.Up:E.rowEnd<w-1?_=!0:w=Math.min(w,E.rowStart);break;case B.Direction.Down:E.rowStart>w+1?_=!0:w=Math.max(w,E.rowEnd);break;case B.Direction.Left:E.colEnd<w-1?_=!0:w=Math.min(w,E.colStart);break;case B.Direction.Right:E.colStart>w+1?_=!0:w=Math.max(w,E.colEnd)}}}const y=J.cellToRange(d);switch(u){case B.Direction.Up:y.rowStart=w;break;case B.Direction.Down:y.rowEnd=w;break;case B.Direction.Left:y.colStart=w;break;case B.Direction.Right:y.colEnd=w}return y})(e,t,l,u=>{const d=[],h=[u],f=c.length;for(let g=0;g<f;g++){const m=(0,c[g])(h),p=m.length;for(let w=0;w<p;w++){const S=m[w];d.push(S)}}return d},n)}_defaultFontDims(){if(this._defaultFontBoundsCache)return this._defaultFontBoundsCache;const e=this._styles.getNormal();let t=0,n=0;for(let r=0;r<=9;r++){const o=e.measureText(r.toString());t=Math.ceil(Math.max(o.width,t)),n=Math.max(o.lineHeight,n)}return this._defaultFontBoundsCache={width:t,height:n},this._defaultFontBoundsCache}getColumnWidthAsFontUnit(e){const t=Math.round(this._defaultFontDims().width),n=e/(this.getView().isShowFormulas()?2:1);if(!t||!e)return 0;let r=5;return n<r+t&&(r=n*(r/(r+t))),(n-r)/t}_defaultColWidth(){if(this._defaultColWidthCache)return this._defaultColWidthCache;const e=this._defaultFontDims()?.width||7,t=8*Math.round((8*e+5)/8);return this._defaultColWidthCache=t}_defaultRowHeight(){if(this._defaultRowHeightCache)return this._defaultRowHeightCache;let e=this._defaultFontDims();if(!e||e.width===0)return this._defaultRowHeightCache=20/ke.getDeviceScale(),this._defaultRowHeightCache;const t=this._styles.getNormal(),n=new Map;let r=e.height+2;return this._colHeaders.getUsedRange().forEachSpan((o,i)=>{const l=i.getCellHeader();l?.getStyle()!==t&&(r=Math.max((a=>{let c=n.get(a);return c===void 0&&(c=a.measureText("M").lineHeight+2,n.set(a,c)),c})(l.getStyle()),r))}),this._defaultRowHeightCache=Math.round(r/ke.getDeviceScale()*4)/4,this._defaultRowHeightCache}getProtection(){return this._protection??null}async _selectSheet(e,t){if(await this._options.container?.requestSelect?.()===!1)return!1;if(t===!1)return!0;const n={coords:e};t!==!0&&t!==void 0&&(n.scrollIntoView=t);const r=await this._emitter.notify("onRequestScrollIntoView",{params:n,async:!0});if(!r)return!1;const o=r.length;for(let i=0;i<o;i++)if(r[i]===!1)return!1;return!0}async scrollTo(e,t){const n={...t,coords:e},r=await this._emitter.notify("onRequestScrollIntoView",{params:n,async:!0});if(!r)return!1;const o=r.length;for(let i=0;i<o;i++)if(r[i]===!1)return!1}async _commitAndAutoSelect(e,t,n=!1,r){return r={...r,viewAfter:{view:this.getView(),selection:t,selectOptions:n,...r?.viewAfter}},e.commit(r),this._autoSelect(n,t)}async _autoSelect(e,t){if(!e)return;e===!0&&(e={autoFocus:!0,scrollIntoView:!0});const n=e?.autoFocus,r=e?.scrollIntoView,o=e?.anchor,i=this.getSelection().getCoords(),l=ls(t??i),a=this._entireCoords,c=((m,p,w)=>{if(!m||m.length===0||!p)return V.EmptyArray;const S=[...m];for(let b=0;b<S.length;b++){const v={...S[b]};let y=v;const _=p.search(v),C=v.rowStart<=w.rowStart&&v.rowEnd>=w.rowEnd,E=v.colStart<=w.colStart&&v.colStart>=w.colEnd;for(let x=0;x<_.length;x++){const R=_[x];C||(y.colStart=Math.min(y.colStart,R.colStart),y.colEnd=Math.max(y.colEnd,R.colEnd)),E||(y.rowStart=Math.min(y.rowStart,R.rowStart),y.rowEnd=Math.max(y.rowEnd,R.rowEnd))}S[b]=y}return S})(l,this._getState().mergeSpatial,a);let u=-1,d=null;if(!o){const m=i?.cell;for(let p=0;u===-1&&p<c.length;p++){const w=c[p];J.isCellWithinRange(m,w)&&(u=p,d=m)}}const h=Ys(c,d,u);this.getSelection().updateCoords(h);const f=h.ranges?.[h.rangeIndex]??J.cellToRange(h.cell),g=await this._selectSheet(f,r);if(r!==!1&&g===!1)return c;if(n!==!1){const m=await this._emitter.notify("onRequestFocus");if(!m)return c;const p=m.length;for(let w=0;w<p;w++)if(m[w]===!1)return c}return c}getSelection(){return this._rangeSelection}getView(){return this._view}setView(e){if(this._closed)throw new Error(On);if(!e)throw new Error("View can not be empty.");this._viewRemoveListener?.(),this._view=e,this._viewRemoveListener=e.addListeners(this._viewListener,{transactional:!1});const t=this.getSelection().getCoords();return this._rangeSelection.updateCoords(t),this._emitter.notify("onMovableSelectionChange"),this._emitter.notify("onTopLeftChange"),this._emitter.notify("onFreezeSplitChange"),this._emitter.notify("onViewChange",{source:e}),this}getTabColor(){return this._tabColor}setTabColor(e){if(this._closed)throw new Error(On);return this._tabColor=typeof e=="string"?this._styles.parseColor(e):e??null,this._emitter.notify("onTabColorChange"),this}getRowHeaders(){return this._rowHeaders}getColumnHeaders(){return this._colHeaders}async toJSON(e=!1){if(this._closed)throw new Error(On);await this._emitter.notify("onBeforeSave",{async:!0}),await Promise.resolve(this._starting);let t={};const n=this._getState();if(!n)return t;try{const p=this._strings.beginPersist();try{if(!e){const y=[],_=this._cellStateIterator({includeRangeTypes:!1,orientation:B.Orientation.Column});let C=_.next(),E=Number.MIN_SAFE_INTEGER,x=Number.MIN_SAFE_INTEGER,R=null,I=null,A=null,M=null;for(;!C.done;){const k=C.value[0],F=k.colIndex,L=k.rowIndex;F!==E&&(M&&y.push(M),R=[],A=[],M=[F,A],E=F,x=L-2),L>x+1&&(R=[],I=[L,R],A.push(I));const N=C.value[1],D=pn(N);let O;if(D===Me.Number||D===Me.Boolean)O=N;else if(D===Me.String)O=""+p.add(N);else if(D===Me.Error)O={t:D,v:N.getCode()};else if(D===Me.RichData){const H=N,z=H.type,j=H?.toJSON?.();z&&j&&(O={t:D,v:0})}else console.warn("error",O);R.push(O),x=L,C=_.next()}M&&y.push(M),y.length>0&&(t.data=y)}this._ownStrings&&(t.strings=await p.toJSONAsync())}catch(y){console.warn("error",y)}finally{p.endPersist()}const w=this._colHeaders.toJSON();w&&(w.headers&&w.headers.length>0&&(t.cols=w.headers),w.defaultSize!==void 0&&w.defaultSize!==-1&&(t.defaultColSize=w.defaultSize));const S=this._rowHeaders.toJSON();S&&(S.headers&&S.headers.length>0&&(t.rows=S.headers),S.defaultSize!==void 0&&S.defaultSize!==-1&&(t.defaultRowSize=S.defaultSize));const b=this.getProtection().toJSON();b&&(t.protection=b),this._view.setRangeSelection(this.getSelection().getCoords());const v=this._view.toJSON();v&&(t.view=v),this._tabColor&&(t.tabColor=this._tabColor.toString())}catch(p){console.warn(p)}const r=Xr(n.mergeSpatial.all());r.length>0&&(t.merges=rh(r));const o=Xr(n.directStyleSpatial.all());if(o.length>0){const p=this._styles.beginPersist();try{const w=[],S=o.length;for(let b=0;b<S;b++){const v=o[b],y=p.getElementID(v.value.toJSON());w.push({r:bs.rangeToString(v),v:y})}if(t.directStyles=w,this._ownStyles){const b=p.toJSON();b&&Object.keys(b).length>0&&(t.styles=b)}}catch(w){console.warn(w)}finally{p.endPersist()}}const i=Xr(n.hyperlinkSpatial.all()),l=i.length;if(l>0){const p=[];for(let w=0;w<l;w++){const S=i[w];let b=S.value;p.push({r:bs.rangeToString(S),v:b})}t.hyperlinks=p}const a=Xr(n.commentsSpatial.all()),c=a.length;if(c>0){const p=[];for(let w=0;w<c;w++){const S=a[w],b={...S.value};b.ref=bs.rangeToString(S),p.push(b)}t.comments=p}const u=this._resources.beginPersist();try{const p=this.getMovables().getItems(),w=p.length;if(w>0){const S=[];for(let b=0;b<w;b++)try{const v=p[b].toJSON(u.toResourceId.bind(u));v&&S.push(v)}catch(v){console.warn("Unable to persist movable",v)}S.length>0&&(t.movables=S)}this._ownResources&&(t.resources=await u.toJSONAsync())}catch(p){console.warn(p)}finally{u.endPersist()}const d=Xr(n.tableSpatial.all()),h=d.length;if(h>0){const p=[];for(let w=0;w<h;w++){const S=d[w].value.model.toJSON();p.push(S)}t.tables=p}const f=Array.from(n.conditionalModels.values()),g=f.length;if(g>0){const p=[];for(let w=0;w<g;w++){const S=f[w].model.toJSON();p.push(S)}t.conditionals=p}const m=await n.calcGraph.toJSON(!1);if(m){const p=m.formulas;p&&(t.formulas=p);const w=m.dynamic;w&&(t.dynamicArray=w);const S=m.volatile;S&&(t.volatile=S)}return this._emitter.notify("onSave",{params:t}),t}getStyles(){return this._styles}getResources(){return this._resources}getTransactions(){return this._transactions}getStrings(){return this._strings}_searchMovables(e){const t=e?.excludeHidden??!1,n=e?.bounds,r=e?.fullyContained,o=this,i=e?.address?this._rangeToCoords(e?.address):this._entireCoords;return this._getRangedEntries("movableSpatial",[i],{excludeHidden:t,fullyContained:r,onEntry:l=>{if(e?.type&&l.model.getContent().getType()!==e.type)return null;let a=null;if(t&&(l.model.isHidden()||(a=o._getBoundsAtCoords(l.model.getAnchorCoords()),a.width===0||a.height===0)))return null;if(n){a||(a=o._getBoundsAtCoords(l.model.getAnchorCoords()));const c=a,u=n;if(c.y>u.y+u.height||c.y+c.height<u.y||c.x>u.x+u.width||c.x+c.width<u.x)return null}return l.model}}).sort((l,a)=>l.getZIndex()-a.getZIndex())}_updateSelectedMovables(e,t){const n=this.getView().getMovableSelection();if(!n||n.length===0)return;let r="Movables";if(n.length===1){const i=n[0];r=Cs(i.getContent().getType())??"Drawing"}const o=this._beginCommit({description:`${t} ${r}`});try{const i=n.length;for(let l=0;l<i;l++)e(n[l]);o.commit()}catch(i){throw o.rollback(),i}}async _addMovable(e){if(!this.getProtection().isObjectsAllowed())throw new Error(pf);if(!e)throw new Error("No movable options provided");if(this._closed)throw new Error(On);const t={};e?.type&&(t.content={type:e.type,json:e?.json}),e?.anchorType&&(t.anchorType=e?.anchorType),e.bounds&&(t.anchor=null);const n=this._getState().movableSpatial,r=this._beginCommit({description:e?.description??"Insert Drawing"}),o=this._createMovableEntry(t,n.size(),e.fromResourceId),i=n.clone();i.insert(o);const l=this._getState().movableMapModel,a=new Map(l),c=o.value.model;a.set(c,o),this._updateState({movableSpatial:i,movableMapModel:a}),e.bounds&&o.value.model.setBounds(e.bounds,e);let u=null,d=null;if(e?.autoSelect!==!1){u={view:this.getView(),movableSelection:this.getView().getMovableSelection()};let h=e?.autoSelect??!1;h===!0&&(h={autoFocus:!0,scrollIntoView:!0,addToSelection:!1}),h&&this.getView().selectMovables([o.value.model],h.addToSelection),d=f=>({...f,view:this.getView(),movableSelection:this.getView().getMovableSelection()})}return r.commit({viewBefore:u,viewAfter:d}),this._emitterMovables.notify("onCollectionChange"),this._emitter.notify("onMovablesChange"),o.value.model}async _addImage(e,t={type:"picture"}){if(!e)throw new Error("An image must be provided as a string or a resource option.");if(!this.getProtection().isObjectsAllowed())throw new Error(pf);const n=this._resources.add(e),r=await n.toBuffer(),o=await n.getType(),i=this._getBoundsAtCoords(ls(this.getSelection().getCoords())[0]),{naturalDimensions:l,asUrl:a}=await ql.loadImageDetails(r,o);URL.revokeObjectURL(a);const c={...i,...l,...t?.bounds};if(V.isNullOrUndefined(t?.bounds?.x)||V.isNullOrUndefined(t?.bounds?.y)){const d=_m(this.getMovables(),c,V.isNullOrUndefined(t?.bounds?.x),V.isNullOrUndefined(t?.bounds?.y));c.x+=d.x,c.y+=d.y}t?.bounds&&t?.json?.lockAspect!==!1&&(V.isNullOrUndefined(t?.bounds.width)&&V.isDefined(t?.bounds.height)&&(c.width=c.height*l.width/l.height),V.isNullOrUndefined(t?.bounds.height)&&V.isDefined(t?.bounds.width)&&(c.height=c.width*l.height/l.width));const u={...t?.json,resId:0};return await this._addMovable({anchorType:Ut.Type.OneCell,description:"Insert Image",...t,bounds:c,type:"picture",json:u,fromResourceId:d=>d!==0?(console.warn("received an unexpected resourceId",d),null):n})}getTables(){return this._tables}getConditionals(){return this._conditionals}getMovables(){return this._movables}_doPerfTest(e=1e7,t=!1){const n=Array.from({length:e},(a,c)=>c);let r,o;r=performance.now(),t&&console.profile("nativeArray");const i=[e];for(let a=0;a<e;a++)i.push(a);t&&console.profileEnd("nativeArray"),window.noLoseArray=i,o=performance.now(),console.log(`NativeArray: ${e} records in ${o-r} milliseconds`),r=performance.now(),t&&console.profile("mixedType");const l=D1.fromArray(n);t&&console.profileEnd("mixedType"),window.noLoseList=l,o=performance.now(),console.log(`MixedTypedList: ${e} records in ${o-r} milliseconds`)}_validateOrRemoveOverlaps(e,t,n=null,r=!1){const o=this;t!=="merge"&&nf(this._getMerges([e]),e,(c,u)=>{if(u||!r)throw new Error(wf(t));o._unmerge([c])});const i=[],l=this.getTables().getItems({address:e}),a=l.length;for(let c=0;c<a;c++){const u=l[c];n!==u&&i.push(u.getAnchorCoords())}nf(i,e,(c,u,d)=>{if(u||!r)throw new Error(wf(t));l[d].delete()})}_addTable(e,t){let n=this._rangeToCoords(e,()=>["objects"]);const r=this._entireCoords;let o=t?.hasHeader;if(n.rowStart===n.rowEnd){if(n.rowEnd===r.rowEnd)throw new Error("A table must have a least two rows; one for the table header and one for data.");n.rowEnd=n.rowEnd+1}o===void 0&&(o=qf(this,n)?.options?.hasHeader??!1);const i=Ft([n]),l={...n},a=this._beginCommit({description:"Insert Table"});let c=null;try{o||(this._isContentful([n])&&this._insertCells([{...n,rowStart:n.rowStart,rowEnd:n.rowStart}],B.Orientation.Row),n={...n,rowEnd:n.rowEnd+1});const u={...t?.json,ref:n};this._validateOrRemoveOverlaps(n,"table",null,!0),u.styleOptions=t?.json?.styleOptions??{},u.styleOptions.name===void 0&&(t?.styleName?u.styleOptions.name=t.styleName:t?.styleName===void 0&&(u.styleOptions.name=this._styles.getDefaultTableStyle().getName()));const d=t?.isLoad;d!==!0&&(u.filter===void 0&&(u.filter={}),u.sort===void 0&&(u.sort={}));const h=this._createTableEntry(u,o&&!d),f=this._getState(),g=f.tableSpatial.clone();g.insert(h);const m=f.tableMapModel,p=new Map(m),w=h.value.model;p.set(w,h);const S=f.tableMapName,b=new Map(S);b.set(w.getName().toLocaleLowerCase(),w),t?.clearFormatting&&this.getRange(n).updateStyle(null),c=h.value.model,this._updateState({tableSpatial:g,tableMapModel:p,tableMapName:b}),this._emitter.notify("onTablesChange"),d||this._autoFit([c.getHeaderRange().getCoords()],{expandOnly:!0});const v=Ft([n]);a.commit({viewBefore:{view:this.getView(),selection:i,ranges:[l]},viewAfter:{view:this.getView(),selection:v,ranges:[n]}})}catch(u){throw a.rollback(),u}return c}_addConditional(e,t){const n=this._rangesToCoords(e,()=>["objects"]),r=t?.autoSelect?Ft(n):null,o=[...n],i=this._beginCommit({description:t?.description??"Insert Conditional"});let l=null;try{const a={...t,ref:o},c=this._getState(),u=c.conditionalSpatial.clone(),d=new Map(c.conditionalModels),h=this._createConditionalEntries(a,u,d);this._updateState({conditionalSpatial:u,conditionalModels:d}),l=h,i.commit({viewBefore:{view:this.getView(),selection:r,ranges:o},viewAfter:{view:this.getView(),selection:r,ranges:o}}),this._autoSelect(t?.autoSelect,r)}catch(a){throw i.rollback(),a}return l}createTemporaryCell(e,t=null){return e?.createTemporaryCell?e:(t?this.getRange(t).getCell():this._emptyCell).createTemporaryCell(e)}_getBoundsAtCoords(e){const t=this._rowHeaders,n=this._colHeaders,r=n.findOffset(e.colStart),o=t.findOffset(e.rowStart);return{x:r,y:o,width:n.findOffset(e.colEnd+1)-r,height:t.findOffset(e.rowEnd+1)-o}}_getCoordsAtBounds(e){const t=this._rowHeaders,n=this._colHeaders;return{colStart:n.findIndex(e.x),rowStart:t.findIndex(e.y),colEnd:n.findIndex(e.x+e.width),rowEnd:t.findIndex(e.y+e.height)}}getRangeAtBounds(e,t){if(!e)throw new sr;const n=this._getCoordsAtBounds(e);return this.getRange(n,t)}_getVisible(e,t){if(e.length===0)return e;const n=new _t;n.load(e);const r=t?.orientations??B.Orientations.Both,o=(l,a)=>{const c=n.search(l),u=c.length;for(let d=0;d<u;d++){const h=c[d],f=fd(h,l,a);n.remove(h),n.load(f)}},i=this._cellOptions.maxCoords;if(r===B.Orientations.Both||r===B.Orientations.Row){const l=this._rowHeaders,a=e.length;for(let c=0;c<a;c++){const u=e[c];l.getRange({min:u.rowStart,max:u.rowEnd}).forEachSpan((d,h)=>{if(d!==0)return;const f=h.getCoords();o({colStart:i.colStart,rowStart:f.min,colEnd:i.colEnd,rowEnd:f.max},B.Orientation.Row)})}}if(r===B.Orientations.Both||r===B.Orientations.Column){const l=this._colHeaders,a=e.length;for(let c=0;c<a;c++){const u=e[c];l.getRange({min:u.colStart,max:u.colEnd}).forEachSpan((d,h)=>{if(d!==0)return;const f=h.getCoords();o({colStart:f.min,rowStart:i.rowStart,colEnd:f.max,rowEnd:i.rowEnd},B.Orientation.Column)})}}return n.all()}_hasRangedEntries(e,t){const n=this._getState();if(!n)return V.EmptyArray;const r=n[e];if(!r)throw new Error(`Invalid range key ${e}`);return!(!r||r.isEmpty())&&r.has(t)}_getRangedEntries(e,t,n){if(t.length===0)return V.EmptyArray;const r=n?.excludeHidden??!1,o=n?.fullyContained??!1,i=n?.onEntry??null,l=this._getState();if(!l)return V.EmptyArray;const a=l[e];if(!a)throw new Error(`Invalid range key ${e}`);if(!a||a.isEmpty())return V.EmptyArray;const c=new Set,u=p=>{const w=p.length;for(let S=0;S<w;S++){const b=p[S];c.add(b)}},d=t.length;for(let p=0;p<d;p++){const w=t[p];if(r){if(r===!0){const S={min:w.colStart,max:w.colEnd},b={min:w.rowStart,max:w.rowEnd};this._rowHeaders.getRange(b).forEachVisibleSpan((v,y)=>{this._colHeaders.getRange(S).forEachVisibleSpan((_,C)=>{u(a.search({colStart:_,rowStart:v,colEnd:C,rowEnd:y},o))},zl)},zl)}else if(r===B.Orientation.Column){const S={min:w.colStart,max:w.colEnd};this._colHeaders.getRange(S).forEachVisibleSpan((b,v)=>{u(a.search({colStart:b,rowStart:w.rowStart,colEnd:v,rowEnd:w.rowEnd},o))},zl)}else if(r===B.Orientation.Row){const S={min:w.rowStart,max:w.rowEnd};this._rowHeaders.getRange(S).forEachVisibleSpan((b,v)=>{u(a.search({colStart:w.colStart,rowStart:b,colEnd:w.colEnd,rowEnd:v},o))},zl)}}else u(a.search(w,o))}if(c.size===0)return V.EmptyArray;const h=Array.from(c.values()),f=n?.sort;f&&h.sort(J.createRangeComparator(f.orientation,f.reverse));let g=[];const m=h.length;for(let p=0;p<m;p++){let w;w=void 0,i&&(w=i(h[p].value,h[p])),w===void 0&&(w=h[p].value),w!==null&&g.push(w)}return g||(g=V.EmptyArray),g}_processAnchorShift(e){let t=e.after;const n=J.sanitizeRange(e.after),r=J.sanitizeRange(e.before);e.after&&this._validateCoords(n,"We can't insert cells because this would push items off the end of the worksheet.");const o=e.before.value.processShiftCallback?.({...e,after:n,before:r});return o&&(Ri(o,n)||(t||(t=e.before),t={...t,...o})),t}_processListenerShift(e,t,n,r){if(r.isSplit||r.before.value.options.ignoreShifts)return[r.before];let o=null;r.after&&(o=J.intersectRanges(J.sanitizeRange(r.after),this._entireCoords),r.after,o.colStart,o.rowStart,o.colEnd,o.rowEnd);const i=r.before.value,l=i.id,a=e.get(l),c={...a},u=[...a.ranges];c.ranges=u,u[i.offset]=o?{...u[i.offset],...o}:null,e.set(l,c);const d=n.get(l);t.set(l,{beforeState:d,afterState:c})}delete(){if(this._closed)return;try{this._emitter.notify("onBeforeDelete")}catch(i){throw i instanceof Error?i:new Error(i.message??"Unable to delete.")}const e=this._beginCommit({description:`Delete Sheet '${this.getName()}'`}),t=this._getState();let n=t.rangeListenerSpatial,r=t.rangesListenerMap;const o=new Map;n=n.shift({range:this._entireCoords,direction:B.Direction.Left,cloneIfUpdate:n===t.rangeListenerSpatial,onShift:i=>{r===t.rangesListenerMap&&(r=new Map(r)),this._processListenerShift(r,o,t.rangesListenerMap,i)}}),this._updateState({rangeListenerSpatial:n,rangesListenerMap:r,deleted:!0}),this._deleteCells([this._entireCoords]),this._emitter.notify("onDelete"),this._rangesListenerMap.forEach((i,l)=>{o.set(l,{beforeState:i,afterState:null})}),e.commit({viewAfter:i=>({...i,view:this.getView(),selection:this.getSelection().getCoords(),listeners:o})})}doBatch(e,t){const n=this;return t=typeof t=="string"?{description:t}:{description:"Update Sheet",...t},this._transactions.doBatch(e,t,(r,o)=>{if(r.getDepth()===0&&(n._lastTransactionUUID=r.getId(),t?.autoSelect)){const i=r.getView()?.selection;i&&n._autoSelect(!0,i)}})}isClosed(){return this._closed}close(){if(this._closed)return;this._protectionRemoveListener?.(),this._protection=new Mm(void 0,this._options.readonly);const e=this._getState().tableMapModel.keys();for(const t of e)t.close();this._searchMovables().forEach(t=>{t.close()}),this._emitter.notify("onClose"),this._ownResources,this._namesRemoveListener?.(),this._ownNames&&this._names.close(),this._ownsCalculation&&this._calculation.close(),this._ownStyles,this._colHeaders.close(),this._rowHeaders.close(),this._emitter.close(),this._transactionsRemoveListener?.(),this._closed=!0}beginCommit(e){if(this._closed)throw new Error(On);return this._beginCommit(typeof e=="string"?{description:e}:e)}_getState(){return this._closed?null:this._transactions.getState(this)}_beginCommit(e){const t=this;return this._transactions.beginCommit(e,n=>{n.getDepth()===0&&(t._lastTransactionUUID=n.getId())})}_updateState(e){if(!e)return;this._lastGetRangeRead=null;const t=this._transactions.beginCommit();let n;try{n=t.updateState(this,e),t.commit()}catch(r){throw t.rollback(),r}return n}_addEvent(e,t){const n=this.getTransactions().getPendingView();if(!n)return;let r=n.events;if(r||(r={},n.events=r),e==="address"){let o=r.address;if(o||(o=new Map,r.address=o),typeof t=="string")o.set(t,null);else{const i=t;if(i.options.ignoreAddressChanges)return;o.set(i.uuid,t)}}else if(e==="data")if(typeof t=="string"){let o=r.dataListeners;o||(o=new Map,r.dataListeners=o),o.set(t,null)}else{let o=r.data;o||(o=[],r.data=o),o.push(t)}}_getScalar(e,t,n=!1){const r=this._getState();let o;if(o===void 0&&(o=r.cellValuesGrid.getValueAt(e,t)),o===void 0)return null;let i=o;if(n&&typeof i=="number"){let l=!1;Qn.colStart=t,Qn.rowStart=e,Qn.colEnd=t,Qn.rowEnd=e;const a=this._lastValueRead,c=this._lastValueRead.range;if(c&&J.isRangeWithinRange(Qn,c))l=a.isDateOrTime;else{const u=r.directStyleSpatial.search(Qn)[0];if(u){const d=u.value.getPropertiesAt(e,t,i),h=d?.numberFormat;h&&(l=Xi(h)||tc(h)),a.range=u,a.isDateOrTime=l}else a.range=null;l&&(i=Ts(i,this._isDate1904))}}return i}getStyleUpdater(e,t){return null}_initState(){const e=this,t=()=>{e._lastCellDecoded.address=null,e._lastCellSelected.coords=null,e._lastCellRead.coords=null,e._lastValueRead.range=null,e._lastGetRangeRead={},e._lastUsedCoordsRead.coords=null,e._lastActiveRead.selection=null,e._lastRangeRead.address=null};this._transactionsRemoveListener=this._transactions.addStateListener(this,{onBeforeCommitStart(m,p,w){if(!e._initializing&&!p?.skipProtectionCheck&&e.getProtection().isLocked())throw new Error(Cl)},async onBeforeCommitEnd(m,p,w){if(p?.ranges){const S={isDataChange:!0,isTransactional:!0,timeStamp:w.getTimestamp(),trigger:"setCells"},b=m.rangeListenerSpatial,v=m.rangesListenerMap;e._notifyRangeListeners(b,v,p.ranges,S)}if(p?.listeners){const S={isDataChange:!1,isTransactional:!0,timeStamp:w.getTimestamp(),trigger:"shiftCells"},b=m.rangeListenerSpatial,v=m.rangesListenerMap;e._notifyRangeListeners(b,v,p.ranges,S)}},async onRestoreOrRevert(m,p,w,S){if(t(),e._calculateFull(),p&&(p.view===e.getView()&&p.selection&&e._autoSelect(!0,p.selection),p.movableSelection&&e.getView().selectMovables(p.movableSelection)),e._emitter.notify("onInvalidated"),e._emitterMovables.notify("onInvalidated"),e._notifyUsedRangeChange(),e._rangesListenerMap.size>0){const b={isDataChange:!0,isTransactional:!1,timeStamp:w.getTimestamp(),isUndo:S,trigger:"invalidate"},v=m.rangeListenerSpatial,y=m.rangesListenerMap,_=new Set;y.forEach((C,E)=>{const x=C.id;if(_.has(x))return;const R=C.ranges;R&&(_.add(x),e._notifyRangeListeners(v,y,R,b))})}},async onAfterStateChange(m,p,w,S,b){t(),p&&w.getId()!==e._lastTransactionUUID&&p.view===e.getView()&&p.selection&&(S||b)&&e._autoSelect(!0,p.selection),e._lastTransactionUUID=w.getId(),p?.merges&&e._notifyMergeChange();const v=e._rangesListenerSorted;if(v.size>0){e._notifyUsedRangeChange();const y=new Set,_=m.rangesListenerMap2,C={isTransactional:!1,timeStamp:w.getTimestamp()};if((b||S)&&(C.trigger="restore",e._notifyAddressListeners(_,_,y,C),v.size>_.size)){const x=v.values();let R=x.next(),I=!1;for(;!I&&!R.done;){const A=R.value;I=_.has(A.uuid),I||(A.notify(C,"#N/A"),R=x.next())}}const E=p?.events;E&&(E.address&&(C.trigger="address",e._notifyAddressListeners(_,E.address,y,C)),E.dataListeners&&(C.trigger="data",e._notifyAddressListeners(_,E.dataListeners,y,C)),E.data&&(C.trigger="data",e._notifyDataListeners(m.rangesListenerSpatial2,m.rangesListenerMap2,E.data,y,C)))}if(p&&!p.calculationSideEffect&&p.ranges&&!p.initial&&m.calcGraph.calculate(),p?.ranges){e._notifyUsedRangeChange();const y=e._rangesListenerMap;if(y.size>0){const _={isDataChange:!0,isTransactional:!1,timeStamp:w.getTimestamp(),isUndo:S,trigger:"setCells"};e._notifyRangeListeners(e._rangeListenerSpatial,y,p.ranges,_)}}},onClose(){const m=e._getState();m&&m.movableSpatial.clear()}});const n=new AC({sheet:this}),r={onChange(){e._emitter.notify("onSelectionChange")}},o=n.addListeners(r,{transactional:!1});this._rangeSelection=n,this._rangeSelectionRemoveListener=o;const i=m=>{const p=e._getState();if(!p)return;const w=p.movableSpatial,S=m.length;for(let b=0;b<S;b++){const v=w.search(m[b]),y=v.length;for(let _=0;_<y;_++)v[_].value.processLayoutCallback?.()}};this._colHeadersListener={onSizesChange:(m,p)=>{const w=[];if(p){const S=p.length;for(let b=0;p&&b<S;b++){const v={colStart:p[b].min,rowStart:e._entireCoords.rowStart,colEnd:e._entireCoords.colEnd,rowEnd:e._entireCoords.rowEnd};w.push(v)}}i(w)}},this._rowHeadersListener={onSizesChange:(m,p)=>{const w=[];if(p){const S=p.length;for(let b=0;b<S;b++){const v=p[b],y={colStart:e._entireCoords.colStart,rowStart:v.min,colEnd:e._entireCoords.colEnd,rowEnd:e._entireCoords.rowEnd};w.push(y)}}i(w)}};let l=new Set;const a={onTopLeftChange(){e._emitter.notify("onTopLeftChange")},onFreezeSplitChange(){e._emitter.notify("onFreezeSplitChange")},onRangeSelectionChange(){const m=e.getSelection().getCoords();e._rangeSelection.updateCoords(m)},onMovableSelectionChange(m){const p=m.getMovableSelection(),w=new Map,S=new Set,b=e._getState().movableMapModel,v=p.length;for(let y=0;y<v;y++){const _=p[y];l.has(_)?l.delete(_):w.set(_,y),S.add(_)}l.forEach(y=>{b.get(y)?.value.processSelectionCallback(!1,!1)}),w.forEach((y,_)=>{b.get(_)?.value.processSelectionCallback(!0,y===0)}),l=S,e._emitter.notify("onMovableSelectionChange")},onAnyChange(){e._emitter.notify("onViewChange")}},c=new Ou({sheet:this});this._view=c,this._clearState(),this._viewRemoveListener=c.addListeners(a,{transactional:!1}),this._viewListener=a,this._colHeadersRemoveListener?.();const u=()=>Math.round(this._defaultFontDims().width);this._colHeaders=new xm({sheet:e,orientation:B.Orientation.Column,maxSheetCoords:this._entireCoords,transactions:this._transactions,isProtected:()=>!e._initializing&&!e.getProtection().isFormatColumnsAllowed(),getTextAt:m=>{const p=this.getView().getColumnHeaderStyle();return p===an.HeaderTextStyle.A1?km(m):p===an.HeaderTextStyle.Zero?Tm(m):p===an.HeaderTextStyle.One?Nm(m):void 0},defaultSize:()=>{const m=this.getView().isShowFormulas()?2:1;return this._defaultColWidth()/u()*m},scaleFactor:u,maxSize:()=>255,setContainerShiftedCallback:m=>{this._colHeadersShiftCallback=m}}),this._colHeadersRemoveListener=this._colHeaders.addListeners(this._colHeadersListener,{transactional:!0}),this._rowHeadersRemoveListener?.();const d=ke.getDeviceScale();this._rowHeaders=new xm({sheet:e,orientation:B.Orientation.Row,maxSheetCoords:this._entireCoords,transactions:this._transactions,isProtected:()=>!e._initializing&&!e.getProtection().isFormatRowsAllowed(),getTextAt:m=>{const p=this.getView().getRowHeaderStyle();return p===an.HeaderTextStyle.One?Nm(m):p===an.HeaderTextStyle.Zero?Tm(m):p===an.HeaderTextStyle.A1?km(m):void 0},defaultSize:()=>this._defaultRowHeight(),scaleFactor:()=>d,minSize:()=>0,maxSize:()=>409,setContainerShiftedCallback:m=>{this._rowHeadersShiftCallback=m}}),this._rowHeadersRemoveListener=this._rowHeaders.addListeners(this._rowHeadersListener,{transactional:!0}),this._defaultFontBoundsCache=null,this._defaultColWidthCache=null,this._defaultRowHeightCache=null;const h={colStart:0,rowStart:0,colEnd:0,rowEnd:0},f=[h],g={excludeHidden:!0,sort:{orientation:B.Orientation.Column,reverse:!1}};this._cellOptions={resolveRange:m=>{if(m===null)return this._createRange(null,void 0,"temporary cell");const p=this._rangesToCoords(m);return this._createRange(p[0],null)},date1904:this._isDate1904,sheet:this,normalStyleRanged:this._normalStyleRanged,colHeaders:this._colHeaders,styles:this._styles,maxCoords:this._entireCoords,getRange:this.getRange.bind(this),getProtection:this.getProtection.bind(this),calcGraph:()=>this._getState().calcGraph,nextContentful:(m,p,w=!1)=>{h.colStart=w?p:m.colIndex+1,h.rowStart=m.rowIndex,h.colEnd=w?m.colIndex-1:p,h.rowEnd=m.rowIndex,g.sort.reverse=w;const S=e._getRangedEntries("contentfulSpatial",f,g);if(!S||S.length===0)return p;const b=S[0],v=w?b.getState().colStart:b.getState().colEnd;return w?Math.min(v+1,m.colIndex):Math.max(v-1,m.colIndex)},opener:async(m,p,w,S)=>{if(m.startsWith("#")){m=m.substring(1);const b=this._rangesToCoords(m);return await this._autoSelect(p??!0,Ft(b)),!0}return window.open(m,w??"_blank",S),!0}},this._emptyCell=new Mv(this._cellOptions)}_clearState(){this._lastGetRangeRead=null,this._lastCellDecoded.address=null,this._lastCellSelected.coords=null,this._lastCellRead.coords=null,this._protectionRemoveListener?.(),this._protection=new Mm(void 0,this._options.readonly),this._protectionRemoveListener=this._protection.addListeners({onChange(){if(e._closed)throw new Error(On);e._getState().movableMapModel.forEach(l=>{l.value.processProtectionCallback?.()}),e._getState().tableMapModel.forEach(l=>{l.value.processProtectionCallback?.()}),e._emitter.notify("onProtectionChange")}}),this._stylesRemoveListener?.();const e=this;this._stylesRemoveListener=this._styles.addListeners({onAnyChange(){e._defaultColWidthCache=null,e._defaultRowHeightCache=null,e._defaultFontBoundsCache=null,e._emitter.notify("onLayoutChange"),e._emitter.notify("onStyleChange")}}),this._view.clear(!1),this._rangeListenerSpatial=new _t,this._rangesListenerMap=new Map,this._rangesListenerSorted=new mt;const t=l=>{const a=e._getState().rangesListenerSpatial2;if(a.isEmpty())return;const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=a.search(d),f=h.length;for(let g=0;g<f;g++){const m=h[g].value.groupId;e._addEvent("data",m)}}},n=this._entireCoords,r=n.rowEnd,o=n.colEnd,i=this._calculation._createGraph({onCalculated(l){e._realizeCalcedValues(l)},getEntireCoords:()=>e._entireCoords,getSheetName:()=>e.getName()});i.addListeners({onStart(l){},onInvalidate:()=>{}}),this._updateState({rangesListenerSpatial2:new _t({updateEntryOptions:{onShifted:l=>{let a=e._getState().rangesListenerMap2;if(a.size===0)return;a=new Map(a);const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=d.value.groupId;let f=a.get(h);f=f.processShift(d),e._addEvent("address",f),a.set(h,f)}e._updateState({rangesListenerMap2:a})},onRemoved:l=>{let a=e._getState().rangesListenerMap2;if(a.size===0)return;a=new Map(a);const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=d.value.groupId;let f=a.get(h);f=f.processRemove(d),e._addEvent("address",f),a.set(h,f)}e._updateState({rangesListenerMap2:a})}}}),rangesListenerMap2:new Map,cellValuesGrid:new wr({orientation:this._isDataColumn?B.Orientation.Column:B.Orientation.Row}),formulaSpatial:new _t,spillSpatial:new _t,pendingSpatial:new _t,calcErrorsSpatial:new _t,calcGraph:i,directStyleSpatial:new _t({updateEntryOptions:{isMergeOnShift:!0,isTrailingEdge:!0,onUpdated:t,onRemoved:t}}),continuousFillSpatial:new _t({updateEntryOptions:{isMergeOnShift:!0,isTrailingEdge:!0}}),conditionalModels:new Map,conditionalSpatial:new _t({updateEntryOptions:{onGroupUpdate(l,a){let c=e._getState().conditionalModels,u=c.get(a);if(!u)return;c=new Map(c);const d=u.spatials;u={...u},u.spatials=l,c.set(a,u),e._updateState({conditionalModels:c}),u.processCoordsChange({before:d,after:u.spatials})}}}),mergeSpatial:new _t({updateEntryOptions:{getShifted:(l,a)=>a?(a.value=new Em(J.sanitizeRange(a),l.value._tvTl),a):null,getSplit(l,a){throw new Error("We can't insert through merges. Unmerge and try again.")},onUpdated:t,onRemoved:t}}),movableMapModel:new Map,movableSpatial:new _t({updateEntryOptions:{getShifted(l,a,c){const u=l.value.processShiftCallback?.(c);let d=null;const h=new Map(e._getState().movableMapModel),f=l.value.model;return u?(d={...u,value:{...l.value}},h.set(f,d)):h.delete(f),e._updateState({movableMapModel:h}),d}}}),hyperlinkSpatial:new _t({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0}}),commentsSpatial:new _t({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0,onUpdated:t,onRemoved:t}}),tableMapModel:new Map,tableMapName:new Map,tableSpatial:new _t({updateEntryOptions:{getShifted(l,a,c){const u=new Map(e._getState().tableMapModel),d=l.value.model,h=l.value.processShiftCallback?.(c);let f=null;return h?(f={...h,value:{...a.value}},u.set(d,f)):u.delete(d),e._updateState({tableMapModel:u}),f}}}),filter:null,sort:null,rangeListenerSpatial:new _t,rangesListenerMap:new Map,contentfulSpatial:new _t({updateEntryOptions:{isSplitOnExpand:!0,isMergeOnShift:!0,onShifted:l=>{const a=e._getState().rangesListenerSpatial2;if(a.size()===0)return;const c=l.length;for(let u=0;u<c;u++){const d=l[u],h=a.search({colStart:d.colStart,rowStart:d.rowStart,colEnd:o,rowEnd:r}),f=h.length;for(let g=0;g<f;g++){const m=h[g].value.groupId;e._addEvent("data",m)}}},onRemoved:t,onUpdated:t}}),unlockSpatial:new _t({updateEntryOptions:{isMergeOnShift:!0}}),deleted:!1}),this._defaultFontBoundsCache=null,this._defaultColWidthCache=null,this._defaultRowHeightCache=null}_createTableEntry(e,t=!1){const n={model:null,processShiftCallback:null,processDeleteCallback:null,processProtectionCallback:null,currentName:null,removeListener:null};let r=null;r=typeof e.ref=="string"?qn(e.ref,this._entireCoords):e.ref;const o={...r,value:n},i=this,l=()=>n.model?i._getState().tableMapModel?.get(n.model):o,a=(d,h)=>!(!J.isEqualRanges(d,h)||d.value.model!==h.value.model),c={transactions:this._transactions,sheet:this,names:this._names,readSheetHeader:t,json:e,maxRangeCoords:this._entireCoords,setNameOnContainer(d){const h=l().value;if(!h.currentName||h.currentName.toLowerCase()===d.toLowerCase())return;const f="Set Table Name";i._protectionCheck(()=>["objects"],void 0,f);const g=i._beginCommit({description:f});try{const m=i._getState()?.tableMapName,p=d.toLocaleLowerCase();if(m.has(p))throw new Error((S=>`Name must be unique: '${S}' is already in use.`)(d));const w=new Map(m);w.delete(h.currentName),h.currentName=p,w.set(p,h.model),i._updateState({tableMapName:w}),g.commit()}catch(m){throw g.rollback(),m}},setContainerCoords(d,h){if(!d)return;const f=i._rangeToCoords(d,()=>["objects"]),g=l();if(!g)return;const m=g.value.model;i._validateOrRemoveOverlaps(f,"table",m);const p=i._beginCommit({description:h?.description??"Resize Table"}),w=i._getState(),S=w.tableSpatial.clone(),b=w.tableMapModel,v=new Map(b);S.remove(g,a);const y={...g,...f};return S.insert(y),v.set(y.value.model,y),i._updateState({tableSpatial:S,tableMapModel:v}),p.commit({viewAfter:{view:i.getView(),selection:Ft([u.getAnchorCoords()])}}),f},deleteFromContainer(d){const h=l();if(!h)return;const f=h.value.model,g=d?.description??`Delete Table '${f.getName()}`;i._protectionCheck(()=>["objects"],void 0,g);const m=i._beginCommit({description:g}),p=i._getState(),w=p.tableSpatial.clone(),S=p.tableMapModel,b=new Map(S),v=p.tableMapName,y=new Map(v);w.remove(h,a),b.delete(f),y.delete(f.getName().toLocaleLowerCase()),h.value.processDeleteCallback?.(),i._updateState({tableSpatial:w,tableMapModel:b,tableMapName:y}),i._emitter.notify("onTablesChange"),m.commit({viewAfter:{sheet:i,view:i.getView(),selection:Ft([f.getAnchorCoords()])}})},setContainerDeleteCallback(d){const h=l()?.value??n;h&&(h.processDeleteCallback=d,h.removeListener?.())},isProtected:()=>!i._initializing&&i.getProtection().isLocked(),setContainerProtectionCallback(d){(l()?.value??n).processProtectionCallback=d},setContainerShiftCallback(d){(l()?.value??n).processShiftCallback=d},processTableUpdate(){i._notifyUsedRangeChange()},initialAnchor:r},u=new Pv(c);return o.value.model=u,o.value.removeListener=u.addListeners({onStyleChange(d){i._emitter.notify("onStyleChange")},onDelete(d){i._emitter.notify("onStyleChange")}},{transactional:!1}),o.value.currentName=u.getName().toLocaleLowerCase(),o}_createConditionalEntries(e,t,n){const r="Conditional Format",o=()=>["objects"],i=e??{};let l=null;const a=this._entireCoords;if(typeof i.ref=="string"){l=[];const w=i.ref.split(","),S=w.length;for(let b=0;b<S;b++){const v=qn(w[b],a);v&&l.push(v)}}else l=Array.isArray(i.ref)?i.ref:[i.ref];const c=this,u=V.uuidV4(),d={model:null,removeListener:null,processCoordsChange:null,spatials:null};n.set(u,d);const h=()=>d.model?c._getState().conditionalModels.get(u):d;let f=w=>(console.log("default createSpatialEntry",w),null);const g=(w,S,b)=>{if(!d.model)return void(l=w);let v=S.spatials;if(v){const _=v.length;for(let C=0;C<_;C++)b.remove(v[C])}let y=[];if(w){const _=w.length;for(let C=0;C<_;C++){const E=w[C];y.push({...E,value:f(E)})}y.length>0&&b.insertGroup(y,u)}S.spatials=y},m=()=>{const w=h().spatials??l;return w?c.getRanges(w):null};var p;return d.model=(p={sheet:c,transactions:c._transactions,json:e,type:"conditional",setOnContainerCoordsChange:w=>{h().processCoordsChange=w},setCreateSpatial(w){f=w},setContainerRanges:(w,S)=>{const b=c._rangesToCoords(w,o);if(!d.model)return l=b,b&&b.length>0?c.getRanges(b):null;const v=c._beginCommit({description:S?.description??`Set ${r} Ranges`});let y=Ft(b);try{const _=c._getState();let C=_.conditionalSpatial;C=C.clone();let E=_.conditionalModels;E=new Map(E);let x=h();x={...x},E.set(u,x),g(b,x,C),c._updateState({conditionalSpatial:C,conditionalModels:E}),v.commit({viewBefore:{view:c.getView(),selection:Ft(m()?.getCoords())},viewAfter:{view:c.getView(),selection:y}}),c._autoSelect(S?.autoSelect,y)}catch(_){throw v.rollback(),_}return b&&b.length>0?c.getRanges(b):null},getContainerRanges:m,deleteFromContainer(w){let S=h();const b=c._beginCommit({description:w?.description??`Set ${r} Ranges`}),v=w?.autoSelect?Ft(S.spatials):void 0;try{const y=c._getState();let _=y.conditionalSpatial;_=_.clone();let C=y.conditionalModels;C=new Map(C),S={...S},g(null,S,_),C.delete(u),c._updateState({conditionalSpatial:_,conditionalModels:C}),this._commitAndAutoSelect(b,v,w?.autoSelect)}catch(y){throw b.rollback(),y}},isReadOnly:()=>!1,setContainerReadOnlyCallback(w){}},new TC({...p,createDescription:`New ${r}`})),d.removeListener=d.model.addListeners({onAnyChange(w){c._emitter.notify("onStyleChange")}},{transactional:!1}),g(l,d,t),d.model}_createMovableEntry(e,t,n){let r=null;if(e?.anchor)r={colStart:e.anchor.tl?.c??0,rowStart:e.anchor.tl?.r??0,colEnd:e.anchor.br?.c??0,rowEnd:e.anchor.br?.r??0},e.anchor.br?.x||(r.colEnd-=1),e.anchor.br?.y||(r.rowEnd-=1);else{const v=ls(this.getSelection().getCoords())[0];r={colStart:v.colStart,rowStart:v.rowStart,colEnd:v.colEnd,rowEnd:v.rowEnd}}const o={model:null,processShiftCallback:null,processLayoutCallback:null,processDeleteCallback:null,processZIndexCallback:null,processSelectionCallback:null,processProtectionCallback:null,zIndex:t},i={...r,value:o},l=()=>o.model?u._getState()?.movableMapModel?.get(o.model):i,a=(v,y)=>!(!J.isEqualRanges(v,y)||v.value.model!==y.value.model),c=(v,y,_=!0)=>{if(h)return;const C=l();if(!C)return;const E=y??"Update Drawing";u._protectionCheck(()=>["objects"],void 0,E);const x=u._beginCommit({description:E}),R=u._getState()?.movableSpatial,I=R.clone(),A=u._getState()?.movableMapModel,M=new Map(A);v(C,I,M)!==!1&&(u._updateState({movableSpatial:I,movableMapModel:M}),_&&(u._emitterMovables.notify("onCollectionChange",{source:u,transactional:!0}),u._emitter.notify("onMovablesChange")),x.commit({viewAfter:k=>{if(i.value.model.isSelected()&&!k?.movableSelection?.includes(i.value.model)){const F=[...k?.movableSelection??[]];return F.push(i.value.model),{...k,view:this.getView(),movableSelection:F}}}}))},u=this,d=e.content.type;let h=!0;const f=(v,y,_,C)=>{const E=_.all().sort((N,D)=>N.value.zIndex-D.value.zIndex),x=y.value.zIndex;if((v=Math.max(0,Math.min(E.length-1,v)))===x)return!1;const R=[],I=[],A=[],M=x<v,k=N=>{const D=E[N];R.push(D);const O={...D,value:{...D.value,zIndex:M?N-1:N+1}};D.value.zIndex===x&&(O.value.zIndex=v),I.push(O),C.set(O.value.model,O),A.push(O)};if(M)for(let N=x;N<=v;N++)k(N);else for(let N=x;N>=v;N--)k(N);const F=R.length;for(let N=0;N<F;N++)_.remove(R[N],a);_.load(I);const L=A.length;for(let N=0;N<L;N++)A[N].value.processZIndexCallback?.()},g=()=>u._resources.beginPersist(),m=d==="picture",p={content:null,fromResourceId:n,defaultLockAspectRatio:m,beginPersistResource:g,getMaxBounds:()=>u._getBoundsAtCoords(u._entireCoords),transactions:this._transactions,getBoundsAtCoords:u._getBoundsAtCoords.bind(u),getCoordsAtBounds:u._getCoordsAtBounds.bind(u),scrollIntoView:v=>u._selectSheet(l()?.value.model.getAnchorCoords(),v),select:async v=>{const y=l()?.value.model;if(!y)return!1;try{u.getView().selectMovables([y],v?.addToSelection)}catch(C){return console.warn(C),!1}const _=await u._selectSheet(l()?.value.model.getAnchorCoords(),v?.scrollIntoView);return!v?.scrollIntoView||_!==!1},unselect:()=>{const v=l()?.value.model;return!!v&&(u.getView().unselectMovables([v]),!0)},isSelected:()=>u.getView().getMovableSelection().includes(l()?.value.model),setContainerSelectionCallback(v){(l()?.value??o).processSelectionCallback=v},moveToBackOnContainer:()=>{c((v,y,_)=>f(0,v,y,_),"Move to Back")},moveBackwardOnContainer:()=>{c((v,y,_)=>f(v.value.zIndex-1,v,y,_),"Move Backwards")},moveForwardOnContainer(){c((v,y,_)=>f(v.value.zIndex+1,v,y,_),"Move Forward")},moveToFrontOnContainer(){c((v,y,_)=>f(y.size()-1,v,y,_),"Move To Front")},getZIndex:()=>l()?.value.zIndex??0,setContainerZIndexCallback(v){(l()?.value??o).processZIndexCallback=v},setContainerCoords(v){if(!v)return;const y=u._rangeToCoords(v,()=>["objects"]);return c((_,C,E)=>{const x={..._,...y};C.remove(_,a),C.insert(x),E.set(x.value.model,x)},"Update Drawing",!1),y},deleteFromContainer(v){const y=l();y?.value&&u.getView().unselectMovables([y.value.model]);const _=[];c((E,x,R)=>{R.delete(E.value.model),x.remove(E,a),E.value.processDeleteCallback?.(),_.push(E);const I=E.value.model.getZIndex(),A=x.all().sort((N,D)=>N.value.zIndex-D.value.zIndex),M=[],k=[],F=A.length;for(let N=I+1;N<F;N++){const D=A[N];M.push(D);const O={...D,value:{...D.value,zIndex:N-1}};k.push(O),R.set(O.value.model,O)}const L=M.length;for(let N=0;N<L;N++)x.remove(M[N],a);x.load(k)},v?.description??"Delete Drawing",!0);const C=_.length;for(let E=0;E<C;E++)_[E].value.processZIndexCallback?.()},setContainerDeleteCallback(v){(l()?.value??o).processDeleteCallback=v},isProtected:()=>!u._initializing&&!u.getProtection().isObjectsAllowed(),setContainerProtectionCallback(v){(l()?.value??o).processProtectionCallback=v},setContainerShiftCallback(v){(l()?.value??o).processShiftCallback=v},setContainerLayoutCallback(v){(l()?.value??o).processLayoutCallback=v},initialAnchor:r,maxRangeCoords:this._entireCoords,json:e},w=e.content.json,S={type:d,transactions:this._transactions,beginPersistResource:g,fromResourceId:n,defaultLockAspectRatio:m,json:w};let b=null;if(d==="picture")b=new Gv(S);else if(d==="chart")b=new CC(S);else if(d==="sp"||d==="cxnSp"||d==="grpSp")b=new xC(S);else{if(d!=="graphicFrame")throw new Error((v=>`Unsupported float type: ${v}`)(d));b=new EC(S)}return o.model=new _C({...p,content:b}),h=!1,i}_fromJSON(e){this._initializing=!0,this._emitter.notify("onBeforeLoad",{params:e}),this._clearState();const t=this._beginCommit({description:"Load Sheet",viewAfter:{initial:!0,skipProtectionCheck:!0}}),n=e||{},r=this._strings,o=r.beginPersist(),i=this._resources.beginPersist(),l=this._styles.beginPersist();try{this._ownStrings&&o.fromJSON(n.strings),this._ownResources&&i.fromJSON(n.resources),this._ownStyles&&l.fromJSON(n.styles),this._colHeaders.fromJSON({headers:n.cols,defaultSize:n.defaultColSize}),this._rowHeaders.fromJSON({headers:n.rows,defaultSize:n.defaultRowSize}),this.setView(new Ou({sheet:this,json:n.view})),this._rangeSelection.updateCoords(this._view.getRangeSelection()),n.tabColor&&(this._tabColor=this._styles.parseColor(n.tabColor));let a=this._getState();const c=a.cellValuesGrid,u=a.contentfulSpatial,d=n.data,h=d?.length??0,f=Jf,g=[];if(h>0){for(let z=0;z<h;z++){let j=d[z];typeof j=="string"&&(j=JSON.parse(j));const q=j[1],P=q.length;let U;for(let ne=0;ne<P;ne++){const ee=q[ne][1],ve=ee.length;for(let le=0;le<ve;le++){let Ce=ee[le],re=Ce?.t;if(re!==void 0)Ce=Ce?.v;else switch(typeof Ce){case"number":re=Me.Number;break;case"boolean":re=Me.Boolean;break;case"string":re=Me.String,Ce=parseInt(Ce)}ee[le]=[Ce,re]}U=f(null,r,ee),q[ne][1]=U}g.push(j)}c.setValues(g);const H=Kf(g,this._isDataColumn);u.load(H)}const m=this._entireCoords,p=a.directStyleSpatial,w=a.continuousFillSpatial,S=this._options.styles;if(e.directStyles){const H=[];let z=[],j=[];const q=e.directStyles,P=(ne,ee)=>{const ve=l.getElementJSON(ee),le=new Jt(S,J.sanitizeRange(ne),ve),Ce={...ne,value:le};H.push(Ce);const re=le._p?.alignment?.horizontal;re===oe.HorizontalAlignment.CenterContinuous&&z.push(ne),re===oe.HorizontalAlignment.Fill&&j.push(ne)};if(Array.isArray(q)){const ne=q.length;for(let ee=0;ee<ne;ee++){const ve=q[ee],le=ve.r;P(typeof le=="string"?qn(le,m):le,ve.v)}}p.load(H);const U=(ne,ee)=>{const ve=(ne=mr(ne,B.Orientation.Column,Number.MAX_SAFE_INTEGER)).length,le=new Array(ve);for(let Ce=0;Ce<ve;Ce++){const re=ne[Ce];le[Ce]={...re,value:new Jt(S,re,{alignment:{horizontal:ee}})}}w.load(le)};U(z,oe.HorizontalAlignment.CenterContinuous),U(j,oe.HorizontalAlignment.Fill)}a=this._updateState({cellValuesGrid:c,contentfulSpatial:u,directStyleSpatial:p,continuousFillSpatial:w});const b=n.merges;if(b){const H=[],z=b.length;for(let j=0;j<z;j++){const q=qn(b[j],m);H.push(q)}this._indexMerges(H)}const v=a.hyperlinkSpatial,y=n.hyperlinks;if(y){const H=y,z=[],j=H.length;for(let q=0;q<j;q++){const P=H[q];let U=P.r;U=typeof U=="string"?qn(U,m):J.sanitizeRange(U);let ne=P.v;typeof ne=="string"&&(ne={address:ne}),z.push({...U,value:ne})}v.load(z)}const _=a.commentsSpatial,C=n.comments;if(C){const H=C,z=[],j=H.length;for(let q=0;q<j;q++){const P=H[q];let U=P.ref;U=typeof U=="string"?qn(U,m):J.sanitizeRange(U);const ne={...P};delete ne.ref,z.push({...U,value:ne})}_.load(z)}const E=a.movableMapModel,x=a.movableSpatial;if(n.movables){const H=[],z=n.movables,j=z.length;for(let q=0;q<j;q++){const P=z[q];try{const U=this._createMovableEntry(P,q,i.fromResourceId.bind(i));E.set(U.value.model,U),H.push(U)}catch(U){console.warn("Unable to load movable",q,P,U)}}x.load(H)}const R=a.tableMapModel,I=a.tableMapName,A=a.tableSpatial,M=n.tables;if(M){const H=[],z=M.length;for(let j=0;j<z;j++){const q=M[j],P=this._createTableEntry(q),U=P.value.model;R.set(U,P),I.set(P.value.currentName,U),H.push(P)}A.load(H)}const k=a.conditionalSpatial,F=a.conditionalModels,L=n.conditionals;if(L){const H=L.length;for(let z=0;z<H;z++){const j=L[z];this._createConditionalEntries(j,k,F)}}const N=a.calcGraph,D=N.fromJSON({formulas:n.formulas,data:g,dynamic:n.dynamicArray,volatile:n.volatile});a=this._updateState({hyperlinkSpatial:v,commentsSpatial:_,movableSpatial:x,movableMapModel:E,tableSpatial:A,tableMapModel:R,tableMapName:I,conditionalSpatial:k,conditionalModels:F,calcGraph:N});const O=this._getUsedCoords();O&&this._autoFit([O],{orientations:B.Orientations.Row,skipCustomSize:!0}),t.commit(),D&&this._realizeCalcedValues(D),n.protection&&this._protection.fromJSON(n.protection),this._emitter.notify("onLoad")}finally{l.endPersist(),i.endPersist(),o.endPersist()}this._initializing=!1}getName(){return this._closed?rn:this._options.container?.getName?.()??null}setName(e){if(this._closed)throw new Error(On);const t=this._options.container?.setName;if(!t)throw new Error("Unable to set name for sheet.");return t(e),this}getVisibility(){return this._closed?ft.Visibility.VeryHidden:this._options.container?.getVisibility?.()??ft.Visibility.Hidden}setVisibility(e=!0){if(this._closed)throw new Error(On);const t=this._options.container?.setVisibility;if(!t)throw new Error("Unable to set visibility for sheet.");let n;return n=e===!0?ft.Visibility.Visible:e===!1?ft.Visibility.Hidden:e,t(n),this}async select(e){return await this._options.container?.requestSelect?.(e),this}duplicate(){return this._options.container?.duplicate?.()}setPosition(e){return this._options.container?.setPosition(e),this}getNames(){return this._names}getCalculation(){return this._calculation}get[Symbol.toStringTag](){return"[Sheet]"}toString(){return this.getName()||"(untitled sheet)"}get isISheet(){return!0}};const Om={address:null,scope:null},qC={colStart:0,rowStart:0,colEnd:0,rowEnd:0},ai={colStart:0,rowStart:0,colEnd:0,rowEnd:0},JC={colStart:0,rowStart:0,colEnd:0,rowEnd:0},zl={includeHidden:!1};Object.freeze({[lt.Content.Values]:Number.MAX_SAFE_INTEGER,[lt.Content.Formulas]:Number.MAX_SAFE_INTEGER}),Object.freeze({[lt.Content.Values]:1,[lt.Content.Formulas]:1});const Pl={ignoreDataChanges:!1},Qn={colStart:-1,rowStart:-1,colEnd:-1,rowEnd:-1},ci=[{colIndex:-1,rowIndex:-1},null,null,null,null],KC=[lt.Content.Values],Dm={size:null,autoSize:!0},Du={skipCustomSize:!0,expandOnly:!0,minContent:!0},ln={rowStart:0,colStart:0,rowEnd:0,colEnd:0},ui={rowStart:0,colStart:0,rowEnd:0,colEnd:0},Lu={showFormulaBar:!0,showTabs:!0,tabRatio:600,showHorizontalScrollbar:!0,showVerticalScrollbar:!0,showStatusBar:!0,activeSheetId:null};class Lm{constructor(e){this._emitter=null,this._emitter=new wn(this),this._state={...Lu},e?.json&&this._fromJSON(e?.json)}isShowFormulaBar(){return this._state.showFormulaBar}setShowFormulaBar(e){return this._state.showFormulaBar=e,this._emitter.notify("onViewChange"),this}isShowTabs(){return this._state.showTabs}setShowTabs(e){return this._state.showTabs=e,this._emitter.notify("onViewChange"),this}getTabRatio(){return this._state.tabRatio}setTabRatio(e){return this._state.tabRatio=e,this._emitter.notify("onViewChange"),this}isShowHorizontalScrollbar(){return this._state.showHorizontalScrollbar}setShowHorizontalScrollbar(e){return this._state.showHorizontalScrollbar=e,this._emitter.notify("onViewChange"),this}isShowVerticalScrollbar(){return this._state.showVerticalScrollbar}setShowVerticalScrollbar(e){return this._state.showVerticalScrollbar=e,this._emitter.notify("onViewChange"),this}isShowStatusBar(){return this._state.showStatusBar}setShowStatusBar(e){return this._state.showStatusBar=e,this._emitter.notify("onViewChange"),this}getActiveSheetId(){return this._state.activeSheetId}setActiveSheetId(e){return this._state.activeSheetId=e,this._emitter.notify("onViewChange"),this}addListeners(e,t){return this._emitter.addListeners(e,t)}toJSON(){let e={};const t=Object.keys(this._state);for(let n=0;n<t.length;n++){const r=this._state[t[n]];r!=null&&r!==Lu[t[n]]&&(e[t[n]]=r)}return Object.keys(e).length===0&&(e=null),e}_fromJSON(e,t=!0){let n=e||{};this.update(n,t)}update(e,t=!0){this._state={...Lu,...this._state,...e},t&&this._emitter.notify("onViewChange")}}class XC{constructor(e){this._emitter=null,this._closed=!1,this._options={...e};const t=this;this._transactions=this._options.transactions??new ir({transient:!0}),this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(n,r,o){t._emitter.notify("onCollectionChange")}}),this._emitter=new wn(this,this._transactions),this._initState(e?.initial)}add(e,t,n){const r=this;t&&t.addListeners({onDelete:c=>{r._updateState(u=>{if(!u.modules[e])return;const d=u.modules[e];if(d){const h={...u};return r._options.onRemove?.(e,d),r._emitter.notify("onCollectionChange"),delete h.modules[e],h}return u},"Delete Module")}},{once:!0});const o=this._getState()?.modules,i=o?.[e],l=n?.replace??!1;if(i&&!l)throw new Error(`Already existing '${e}'`);const a={...o};t?(a[e]=t,r._options.onAdd?.(e,t),this._updateState({modules:a},l?"Save Scripts":"Add Script")):(delete a[e],r._options.onRemove?.(e,null),this._updateState({modules:a},"Remove Script")),r._emitter.notify("onCollectionChange")}getItems(e){const t=this._getState();if(!t)return V.EmptyArray;const n=t.modules,r=Object.keys(n),o=r.length;if(o===0)return V.EmptyArray;const i=[],l=e?.name?e.name.toUpperCase():null;for(let a=0;a<o;a++){const c=r[a],u=n[c];let d=!0;l&&l!==c.toUpperCase()&&(d=!1),d&&i.push(u)}return i??V.EmptyArray}getByName(e){if(!e)return null;const t=this._getState();if(!t)return null;const n=e.toUpperCase(),r=t.modules,o=Object.keys(r),i=o.length;for(let l=0;l<i;l++){const a=o[l];if(n===a)return r[a]}return null}getCount(){const e=this._getState();return e?Object.keys(e.modules).length:0}beginCommit(e){return this._beginCommit(e)}_getState(){if(this._closed)throw new Error(Kn);return this._transactions.getState(this)}_beginCommit(e){return this._transactions.beginCommit(typeof e=="string"?{description:e}:e)}_updateState(e,t="Update",n){if(!e)return;const r=this._beginCommit(t);try{r.updateState(this,e),r.commit(n)}catch(o){throw r.rollback(),o}}_initState(e){let t=e??{};this._updateState({modules:t},"Initialize",{forceAmend:!0});const n=this._options.onAdd;if(n){const r=Object.keys(t),o=r.length;for(let i=0;i<o;i++){const l=r[i];n(l,t[l])}}}addListeners(e,t){return this._emitter.addListeners(e,t)}toJSON(){const e=this._getState();if(!e)return V.EmptyArray;const t=e.modules,n=Object.keys(t),r=n.length,o={};for(let i=0;i<r;i++){const l=n[i];o[l]=t[l].toJSON()}return o}isClosed(){return this._closed}close(){this._closed||(this._emitter.notify("onClose"),this._closed=!0,this._transactionsRemoveListener?.())}get isFunctionCollection(){return!0}}let Bu;const Hl="SheetXL",ZC=Bu||(Bu=V.deepFreeze({ISheet:{Visibility:ft.Visibility},ICell:{Content:lt.Content,CalcStatus:lt.CalcStatus},IColor:{Named:G.Named,Scheme:G.Scheme,Type:G.Type,AdjustmentType:G.AdjustmentType},Direction:Ot}),Bu);let $l;class YC extends ja{constructor(e,t,n,r=null,o=!1){super(e,t,n,r,o)}execute(...e){const t=e[0];if(!t||!t.isIWorkbook)throw new Error(`Macro '${this.getName()}' must be called with a valid workbook as the only argument.`);const n=this._ct;try{const r=[];switch(n){case Or.Context.Workbook:r.push(t);break;case Or.Context.Sheet:r.push(t.getSelectedSheet());break;case Or.Context.Ranges:r.push(t.getSelectedRanges());break;case Or.Context.Range:r.push(t.getSelectedRange());break;default:throw new Error(`Function '${this.getName()}' is not a valid macro function.`)}const o=async(l,a)=>{const c=await a;if(c!==void 0)if(c!==null){if(Array.isArray(c)){if(pn(c[0]?.[0]))return void l.setValues(c,{skipBoundsCheck:!0})}else if(pn(c))return void l.setValues([[c]]);c.isICell?l.updateCells(c):c.isICellRange&&await l.copyFrom(c)}else l.clear()};let i;return(async()=>{const l=(await this.getDescriptor()).getSummary()??`Macro '${this.getName()}'`;return await t.doBatch(async()=>{try{const a=t.getSelectedRange();let c=this._cf();c||(c=function(u){return new Proxy(u,{set:(d,h,f)=>(console.log(`Adding property "${h}" with value:`,f),d[h]=f,!0),deleteProperty:(d,h)=>(console.log(`Deleting property "${h}"`),delete d[h])})}({}));try{ch({getPosition:()=>a.getCell().getCoords()}),$l=globalThis[Hl],globalThis[Hl]=ZC,i=this._fn.call(c,...r),$l?(globalThis[Hl]=$l,$l=void 0):delete globalThis[Hl],Wa()}catch(u){throw u}finally{Wa()}await o(a,i)}catch(a){throw a}},l),{params:r,results:i}})()}catch(r){throw r}}}class QC{constructor(e){this._emitter=null;const t=e.json;if(this._json=t,!this._json)throw new Error("Module JSON is required.");this._emitter=new wn(this),this._functions=new Mw({transactions:null,readonlyFunctions:e.readonlyFunctions})}getFunctions(){return this._functions}getSource(){return this._json.source}getLanguage(){return this._json.language||"typescript"}getErrors(){return null}delete(){this._emitter.notify("onDelete")}addListeners(e,t){return this._emitter.addListeners(e,t)}toJSON(){return this._json}}const ex=async(s,e)=>{let t=null;try{ch(null)}catch(o){console.warn("Error setting global scope",o)}try{t=await new Function("modulePath","return import(modulePath)")(`data:text/javascript,${encodeURIComponent(s.compiled)}`)}catch(o){throw new Error("Invalid Javascript module.",{cause:o})}finally{Wa()}if(!e)throw new Error(`No function available for '${s.name??s.commitId}'.`);const n=e.name;let r=t[n];if(!r&&e.behavior.default&&(r=t.default),!r)throw new Error(`Found the descriptor for '${n}' but not the function. The descriptor manifest must be corrupt.`);return r},Bm=async(s,e=!1)=>{const t=s?.functions,n=new Map;if(t)for(let r=0;r<t.length;r++){const o=t[r],i=o[0],l=o[1];let a,c=e?()=>{}:await ex(s,i);a=i.context&&i.context!==Or.Context.Calculation?new YC(i,c,()=>null,l):new ja(i,c,()=>null,l),n.set(i.name.toUpperCase(),a)}return new QC({json:s,readonlyFunctions:n})};class tx{constructor(e){this._options=e,this._initState()}_initState(){}getModules(){return this._modules}async createModule(e){const t=await ao(()=>import("./index-BQ5g15rz.js"),__vite__mapDeps([10,1,2,3,4,5,6]),import.meta.url),n=await t.ScriptingUtils.compileTypescript(e);return n?await Bm(n,e?.declarationsOnly??!1):null}addModule(e,t,n){this._modules.add(e,t,n)}executeMacro(e,t){const n=this._modules.getItems({name:t}),r=n.length;for(let o=0;o<r;o++){const i=n[o].getFunctions().getByName(e);if(i)return i.execute(this._options.workbook)}throw new Error(`No macro ${e} found.`)}searchFunction(e){const t=e?.name,n=e?.moduleName,r=e?.type,o=this._modules;if(!o)return V.EmptyArray;const i=o.getCount();if(i===0)return V.EmptyArray;if(n){const a=this._modules.getItems({name:n});return a.length===0?V.EmptyArray():a[0].getFunctions().getItems({name:t,type:r})}const l=this._modules.getItems();for(let a=0;a<i;a++){const c=l[a].getFunctions().getItems({name:t,type:r});if(c.length>0)return c}return V.EmptyArray}async start(){if(this._modules)return Promise.resolve();const e=this._options?.workbook,t=this._options?.json;let n={};if(t){const l=Object.keys(t);for(let a=0;a<l.length;a++){const c=l[a],u=t[c],d=await Bm(u);n[c]=d}}const r=new XC({transactions:this._options?.transactions,initial:n,onRemove:this._options?.onRemove,onAdd:this._options?.onAdd});this._modules=r;const o=r.getItems();if(o.length===0)return Promise.resolve(V.EmptyArray);const i=o.length;for(let l=0;l<i;l++){const a=o[l];try{const c=a.getFunctions().getItems({type:"autoRun"}),u=c.length;for(let d=0;d<u;d++)await c[d].execute(e)}catch(c){console.error("Error executing autoRun script:",c)}}}toJSON(){const e=this._modules;if(!e)throw new Error("Scripts is initializing.");return e.toJSON()}}const nx=Object.freeze({lockStructure:!1,lockWindows:!1,lockRevision:!1,workbookPassword:null,revisionsPassword:null});class zm extends Dw{isWindowsAllowed(){return this._isPropertyAllowed("windows")}isRevisionAllowed(){return this._isPropertyAllowed("revision")}isStructureAllowed(){return this._isPropertyAllowed("structure")}_fromJSON(e){this._properties=e}_toJSON(e){let t=this._properties;if(t){e={...e,...t};const n=Object.keys(t),r=n.length;for(let o=0;o<r;o++){const i=n[o],l=t[i];l!=null&&l!==nx[i]&&(e[i]=l)}}return super._toJSON(e)}}const zu=s=>`Invalid SheetKey: ${s}`,Pu="A workbook must contain at least one visible worksheet.",Pm="Internal error no visible sheetRefs",yn="Workbook has been closed. No further operations are allowed.",wo="This workbook structure is protected. To make a change, unprotect the workbook. You might be requested to enter a password.",ac="A sheet name",Fd=`${ac} can not be blank.`,rx=`${ac} can not be longer than 31 characters.`,ox=`${ac} can not begin or end with a "'" (single quote).`;class sx{constructor(e,t){this._add=e,this._get=t}add(e){return this._add(e)}getItems(e){return this._get(e?.name,e?.visibility)}getByName(e){return this._get(e)?.[0]??null}getCount(){return this._get().length}}const Od=new RegExp(/[\\/\\*?:[\]]+/),ix=new RegExp(/\(((\d+)(?!.*\d))\)$/,"g"),lx=s=>`Sheet${s+1}`,Pw=(s,e)=>({...so,getSheet:()=>null,toString:()=>oc(s,e)}),Hm=(s,e=!1)=>{if(!s)throw new Error(Fd);if(Od.test(s)){if(!e)throw new Error((n=>`${n?`'${n}'`:ac} can not contain any of the following characters '\\ , / , * , ? , : , [ , ]'.`)(s));s=s.replace(Od,"")}if(s.length===0)throw new Error(Fd);const t=s.length;if(t>31){if(!e)throw new Error(rx);s=s.substring(0,31)}if(s.charAt(0)==="'"||s.charAt(t-1)==="'"){if(!e)throw new Error(ox);s=s.replace(/^'|'$/g,"")}return s};let Hw=class $w extends dh{constructor(e,t,n,r){super(e,t,r),this._workbook=n}getSource(){return this._workbook}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new $w(e,this._sheet,this._workbook,n)}_createRange(e,t){const n=e?{...e}:null;if(!(n&&this._workbook._getSheetRef(n.sheetName,ft.Visibility.VeryHidden))){const o=this._workbook.getSelectedSheet();return delete n?.sheetName,Pw(n,n?{sheetName:rn,...o.getEntireRange().getCoords()}:null)}let r=this._options;return t&&(r={...this._options,getOptions:Br(this._options.getOptions,t)}),new Vw(e,this._sheet,this._workbook,r)}async select(e){const t=[];let n=null;const r=this.getCoords();for(let a=0;a<r.length;a++){const c=r[a];c&&(n||(n=c.sheetName),c&&c.sheetName===n&&t.push(c))}n||(n=this._workbook.getSelectedSheet().getName());const o=this._workbook.getSheets().getByName(n);if(!o)return;const i=await o.getRanges(t).select(e),l=this._workbook._rangesAddressToCoords(i.getCoords());return this._createRanges(l,e)}addListener(e,t){if(!this.getCoords())return()=>{};const n=this._workbook._sheetToWBEvent(e);return super.addListener(n,t)}get[Symbol.toStringTag](){return"[WorkbookRanges]"}toString(){const e=this.getCoords(),t=this._sheet,n=t.getEntireRange().getCoords(),r={sheetName:t.getName(),...n};return ew(e,r,oc,co)}},Vw=class Ww extends hh{constructor(e,t,n,r){super(e,t,r),this._workbook=n}_createRanges(e,t){let n=this._options;return t&&(n={...this._options,getOptions:Br(this._options?.getOptions,t)}),new Hw(e,this._sheet,this._workbook,n)}_createRange(e,t){const n=this._sheet;if(!e)return Fr(n,n._entireCoords);if(n._validateCoords(e),n._closed)return Fr(null,n._entireCoords,e);let r=this._options;return t&&(r={...this._options,getOptions:Br(this._options?.getOptions,t)}),new Ww(e,this._sheet,this._workbook,r)}getSource(){return this._workbook}get[Symbol.toStringTag](){return"[WorkbookRange]"}toString(){const e=this._sheet,t=e?.getEntireRange().getCoords()??null;return oc(this.getCoords(),{...t,sheetName:e.getName()})}addListener(e,t){if(!this.getCoords())return()=>{};const n=this._workbook._sheetToWBEvent(e);return super.addListener(n,t)}};class GR{constructor(e){this._lastTransactionUUID=null,this._closed=!1,this._initializing=!0,this._emitter=null,this._names=null,this._calculation=null,this._isDate1904=!1;const t=this,n={...e},r=n.json;delete n.json,this._transactions=n.transactions??new ir,this._ownTransactions=!n.transactions,this._emitter=new wn(this,this._transactions);const o=this._beginCommit({description:(r?"Open":"New")+" Workbook"});try{this._strings=n.strings??new lh,this._ownStrings=!n.strings,this._resources=n.resources??new Ew,this._ownResources=!n.resources,this._createSheetName=n.createSheetNameCallback??lx;let i=n.createSheetCallback;i||(i=a=>new Nd(a)),this._sheetOnNameChange=new Map,this._sheetOnVisibilityChange=new Map,this._sheetOnIndexChange=new Map,this._createSheet=(a,c,u,d,h)=>{let f=null;const g={date1904:t.isDate1904(),readonly:t._options.readonly??!1,transactions:t._transactions,styles:t._styles,strings:t._strings,resources:t._resources,names:t._names,calculation:t._calculation,resolveRange:m=>t._options.resolveRange?.(m)??t.getRange(m),container:{beforeFromJSON:m=>{f=m,t._addSheetRef({name:c,id:a,visibility:u??ft.Visibility.Visible,sheet:m},d)},getName:()=>{const m=t._getSheetRef(f);return m?m.name:t._createSheetName(1)},setName:m=>{t._getSheetRef(f)&&t._setSheetName(f,m)},getIndex:()=>{const m=t._getSheetRef(f);return m?t._findOffsetForId(m.id,t._getSheetRefs(ft.Visibility.VeryHidden)):-1},setIndexCallback:m=>{t._sheetOnIndexChange.set(a,m)},setNameChangeCallback:m=>{t._sheetOnNameChange.set(a,m)},getVisibility:()=>{const m=t._getSheetRef(f);return m?m.visibility:ft.Visibility.Visible},setVisibility:m=>{t._setSheetVisibility(f,m)},setVisibilityCallback:m=>{t._sheetOnVisibilityChange.set(a,m)},duplicate:()=>t._duplicateSheet(f),setPosition:m=>{const p=t._getSheetRef(f,ft.Visibility.VeryHidden);return!!p&&(t._moveSheet(p,m),!0)},requestSelect:async()=>(t._setSelectedSheet(f),await this._emitter.notify("onRequestSelect",{source:t,params:f,async:!0}),t.getSelectedSheet()===f)}};return h&&(g.json=h),f=i(g,c,d,u),f},this._names=n.names??new kw({addressToRanges:a=>t.getRanges(a),getCurrentScope:()=>t.getSelectedSheet().getName(),isReadOnly:()=>t._options.readonly??!1,transactions:t._transactions}),this._ownNames=!n.names,this._calculation=n.calculation??new Tw({getNamed:(a,c)=>{try{rs.address=a,rs.scope=c;const u=this._names.getItems(rs);return u&&u.length!==0?u[0].getRanges().getCoords():null}catch{return null}},getSheetIndex:a=>{if(a===void 0)return t.getSelectedSheetIndex();const c=this._getSheetRefs(ft.Visibility.Hidden);a=a.toLowerCase();for(let u=0;u<c.length;u++)if(c[u].name.toLowerCase()===a)return u;try{rs.address=a,rs.scope=void 0;const u=this._names.getItems(rs);if(!u||u.length===0)return-1;let d=u[0].getRanges().getCoords()?.[0]?.sheetName;if(!d)return-1;const h=this._getSheetRefs(ft.Visibility.Hidden);d=d.toLowerCase();for(let f=0;f<h.length;f++)if(h[f].name.toLowerCase()===d)return f}catch{return-1}return-1},getSheetCount:()=>t.getSheets().getCount(),isDate1904:()=>t.isDate1904(),strings:t._strings,transactions:t._transactions}),this._ownsCalculation=!n.calculation,this._scripts=this._createScripts(),this._ownNames=!n.names,this._options={...n};const l=async()=>{this._ownsCalculation&&await this._calculation.start(),await this._scripts.start(),this._starting=null};this._starting=l(),r?this._fromJSON(r):(this._initState(),this._addSheet(!1)),this._emitter.notify("onLoad"),o.commit({forceAmend:this._ownTransactions})}catch(i){throw o.rollback(),i}this._sheets=new sx(i=>t._addSheetOptions(i),(i,l)=>i?[this.getSheet(i,l)]:this._getSheets(l)),this._initializing=!1}_initState(){let e=this._getSheetRefs();for(let r=e&&e.length-1;r>=0;r--);this._isDate1904=this._options.date1904??!1,this._theme=this._options.theme??new Qd().getDefaultTheme(),this._styles=this._options?.styles??new tl(this._theme),this._ownStyles=!this._options.styles,this._styles.getTheme()||this._styles.setTheme(this.getTheme()),this._activeSheetOffset=0,this.setView(new Lm),this._listenerProtection?.(),this._protection=new zm(void 0,this._options.readonly??!1),this._listenerProtection=this._protection.addListeners({onChange:r=>{t._emitter.notify("onProtectionChange")}});const t=this;this._transactionsRemoveListener=this._transactions.addStateListener(this,{onAfterStateChange(r,o,i){if(o&&o.activeSheetId!==void 0&&o.view===t.getView()&&i.getId()===t._lastTransactionUUID&&t._getSheetRef(o.activeSheetId)?.sheet.select(),o&&i.getId()!==t._lastTransactionUUID){let l=t.getView().getActiveSheetId();o.view===t.getView()&&(l=o.activeSheetId);let a=0;try{a=t._findOffsetForId(l,r.sheetRefsVisible)}catch{}t._activeSheetOffset=a}t._lastTransactionUUID=i.getId(),t._notifyAllChange()},onRestoreOrRevert(){t._emitter.notify("onInvalidated")}});const n=this._getState();n?.listenersSheets&&(n?.listenersSheets.forEach(r=>{r()}),n?.listenersSheets.clear()),this._updateState({sheetRefsAll:[],sheetRefsVisibleAndHidden:[],sheetRefsVisible:[],refsById:new Map,sheetsById:new Map,refsByLowerCaseName:new Map,sheetsByLowerCaseName:new Map,refsByInstance:new Map,lastId:-1,sheetsCreated:new Set,listenersSheets:new Map})}getView(){return this._view}setView(e){if(this._closed)throw new Error(yn);if(!e)throw new Error("View can not be empty.");this._listenerWorkbookView?.();const t=this;return this._listenerWorkbookView=e.addListeners({onViewChange:n=>{const r=t._getState();this._activeSheetOffset=this._findOffsetForId(this._view.getActiveSheetId(),r.sheetRefsVisible),t._emitter.notify("onViewChange")}}),this._view=e,t._emitter.notify("onViewChange"),this}isDate1904(){return this._isDate1904}setDate1904(e){if(this._closed)throw new Error(yn);return this._isDate1904=e,this._notifyAllChange(),this}getStyles(){return this._styles}getResources(){return this._resources}getTransactions(){return this._transactions}getStrings(){return this._strings}getTheme(){return this._theme}setTheme(e){if(this._closed)throw new Error(yn);if(!e)throw new Error("A value must be provided.");const t=this._theme;return this._theme=e,this.getStyles().setTheme(e),this._emitter.notify("onThemeChange"),t}getSelectedSheetIndex(){return this._activeSheetOffset}getSelectedSheet(){const e=this._getSheetRef(this.getSelectedSheetIndex());return e?e?.sheet:null}getSheet(e,t=ft.Visibility.Visible){const n=this._getSheetRef(e,t);if(!n)throw new Nt(`Sheet '${e}' not found.`);return n.sheet}getSheetAt(e,t=ft.Visibility.Visible){const n=this._getSheetRef(e,t);if(!n)throw new Nt((r=>`No sheet found at ${r}.`)(e));return n.sheet}getSheets(){return this._sheets}addSheet(e){return this.getSheets().add(e)}_getSheets(e=ft.Visibility.Visible){const t=this._getSheetRefs(e),n=[];for(let r=0;r<t.length;r++)n.push(t[r].sheet);return n}_getSheetRefs(e=ft.Visibility.Visible){if(this._closed)return V.EmptyArray;const t=this._getState();return t?e===ft.Visibility.Visible?t.sheetRefsVisible:e===ft.Visibility.Hidden?t.sheetRefsVisibleAndHidden:e===ft.Visibility.VeryHidden?t.sheetRefsAll:V.EmptyArray:[]}_getSheetRef(e,t=ft.Visibility.Visible){if(this._closed)return null;let n=null;return typeof e=="number"?this._getSheetRefs(t)[e]:(typeof e=="string"?n=this._getState().refsByLowerCaseName.get(e.toLowerCase()):e instanceof Nd?n=this._getState().refsByInstance.get(e):e?.id&&e.sheet&&(n=this._getState().refsById.get(e.id)),n)}_validateNewSheetName(e,t=!0){if(e==null)return e;if(Hm(e),t&&this._getState().sheetsByLowerCaseName.has(e.toLowerCase()))throw new Error("That name is already taken. Try a different one.");return e.substring(0,31)}findValidSheetName(e){e&&(e=Hm(e,!0));try{return((t,n)=>{try{if(n(t))return t}catch{}let r,o,i=ix.exec(t);for(i!==null?(r=t.substring(0,i.index),o=parseFloat(i[1])):(r=t+" ",o=1);o<256;){o++;const l="("+o+")",a=r.substring(0,31-l.length)+l;try{if(n(a))return a}catch{}}throw new Error(t+" is not a valid sheet name")})(e,t=>this._validateNewSheetName(t))}catch{return this._nextSheetName()}}isValidSheetNameCharacter(e){return!Od.test(e)}_addSheetOptions(e){if(this._closed)throw new Error(yn);if(!this.getProtection().isStructureAllowed())throw new Error(wo);let t,n=null;t=typeof e=="string"?{name:e}:typeof e=="number"?{index:e}:e,t={...t,description:t?.description??"Add Sheet"};const r=this.beginCommit(t);try{const o=t?.autoSelect;n=this._addSheet(!0,t.name,t.index??null);const i=this.getView().getActiveSheetId();let l,a;if(o!==!1){let c=this.getView().getActiveSheetId();c=this._getSheetRef(n).id,o&&(l={view:this.getView(),activeSheetId:i},a={view:this.getView(),activeSheetId:c})}if(r.commit({description:`Add Sheet '${n.getName()}'`,viewBefore:l,viewAfter:a}),o!==!1){const c=typeof o=="boolean"?void 0:o;n.select(c)}}catch(o){throw r.rollback(),o}return n}_nextSheetName(e=null){let t=e?e.toLowerCase():null;const n=this._getState(),r=n.sheetsByLowerCaseName;if(e&&r.has(t))throw new Error((i=>`The sheet name '${i}' already exist in workbook.`)(e));t=(e=this._validateNewSheetName(e))?e.toLowerCase():null;let o=n.lastId+1;for(;!e;){const i=this._createSheetName(o),l=i.toLowerCase();r.has(l)?o++:e=i}return this._updateState({lastId:o}),e}_addSheet(e,t=null,n=null){t=this._nextSheetName(t);const r=this._getState(),o=this._createSheet(r.lastId,t,ft.Visibility.Visible,n,null);if(!o)throw new Error(Fd);return e&&this._emitter.notify("onSheetsChange"),o}_updateSheetRefStates(e){if(this._closed)throw new Error(yn);if(!this._initializing&&!this.getProtection().isStructureAllowed())throw new Error(wo);const t=e,n=[],r=[];for(let o=0;o<t.length;o++)t[o].visibility===ft.Visibility.Visible?(n.push(t[o]),r.push(t[o])):t[o].visibility===ft.Visibility.Hidden&&r.push(t[o]);this._updateState({sheetRefsAll:t,sheetRefsVisible:n,sheetRefsVisibleAndHidden:r})}_addSheetRef(e,t=null){const n=this._getState(),r=n.sheetRefsAll,o=Math.max(0,Math.min(r.length,t??r.length));let i=[...r.slice(0,o),e,...r.slice(o)];this._updateSheetRefStates(i);const l=e.sheet,a=e.name.toLowerCase(),c=new Map(n.refsById);c.set(e.id,e);const u=new Map(n.refsByLowerCaseName);u.set(a,e);const d=new Map(n.refsByInstance);d.set(l,e);const h=new Map(n.sheetsById);h.set(e.id,l);const f=new Map(n.sheetsByLowerCaseName);f.set(a,l);const g=this;let m=n.listenersSheets;if(l!==void 0){const S=l.addListeners({onBeforeDelete:b=>{g._validateDeleteSheet(b)},onDelete(b){let v=g._getSheetRef(b,ft.Visibility.VeryHidden);if(!v)return;const y=g._beginCommit({description:`Remove Sheet ${v.name}`});try{const _=g._getState(),C=_.sheetRefsAll,E=g._findOffsetForId(v.id,C);let x=[...C];x.splice(E,1),g._updateSheetRefStates(x);const R=new Map(_.refsById);R.delete(v.id);const I=new Map(_.sheetsById);I.delete(v.id);const A=v.name.toLowerCase(),M=new Map(_.refsByLowerCaseName);M.delete(A);const k=new Map(_.sheetsByLowerCaseName);k.delete(A);const F=new Map(_.refsByInstance);F.delete(b),_.listenersSheets.get(v.id)();const L=new Map(_.listenersSheets);L.delete(v.id),g._adjustRemoveSelectionIfRequired(E,v.id),g._adjustSheetNamesIfRequired(),g._emitter.notify("onSheetsChange");const N=new Set(_.sheetsCreated);N.has(l)&&N.delete(l),g._updateState({refsById:R,sheetsById:I,refsByLowerCaseName:M,sheetsByLowerCaseName:k,refsByInstance:F,sheetsCreated:N,listenersSheets:L}),y.commit()}catch(_){throw y.rollback(),_}}});m=new Map(n.listenersSheets),m.set(e.id,S)}let p=n.lastId;p!==-1&&(p=Math.max(p,e.id)),this._updateState({lastId:p}),this._updateState({refsById:c,refsByLowerCaseName:u,refsByInstance:d,sheetsById:h,sheetsByLowerCaseName:f,listenersSheets:m}),this._adjustSheetNamesIfRequired();const w=new Set(this._getState().sheetsCreated);return w.add(e.sheet),this._updateState({sheetsCreated:w}),e}_adjustRemoveSelectionIfRequired(e,t){if(this._view.getActiveSheetId()===t){let n;const r=this._getState().sheetRefsVisible;n=e<r.length?r[e].id:r[e-1].id,this._view.setActiveSheetId(n)}}_adjustSheetNamesIfRequired(){const e=this._getState(),t=e.lastId;if(t===-1)return;let n=this._view.getActiveSheetId();n==null&&(this._view.setActiveSheetId(t),n=t),e.refsById.get(n).visibility===ft.Visibility.Visible&&(this._activeSheetOffset=this._findOffsetForId(n,e.sheetRefsVisible))}_validateDeleteSheet(e){if(this._closed)throw new Error(yn);if(!this.getProtection().isStructureAllowed())throw new Error(wo);let t=this._getSheetRef(e);if(!t)throw new Error((r=>`Invalid reference for delete: ${r}`)(e));const n=this._getState().sheetRefsVisible;if(n.length===1&&n[0].id===t.id)throw new Error(Pu)}_findOffsetForId(e,t){for(let n=0;n<t.length;n++)if(t[n].id===e)return n;throw new Error(Pm)}find(e,t){if(this._closed)throw new Error(yn);const n=this._getSheets();if(n.length===1)return n[0].find(e,t);const r=!t?.reverse;let o=t?.disableWrap??!1;const i=this.getSelectedSheetIndex();let l=i,a=n[l],c=!1;t={...t,disableWrap:!0};let u,d=a.find(e,t),h=d.next(),f=!1;if(t?.from){const p=this._rangesAddressToCoords(t?.from);u={colIndex:p[0].colStart,rowIndex:p[0].rowStart}}else u={colIndex:0,rowIndex:0};const g=J.createCellComparator(t?.orientation,t?.reverse);delete(t={...t}).from;const m=()=>{if(!f&&h.done&&(c&&l===i?f=!0:r?(l++,l>n.length-1&&(l=0,c=!0)):(l--,l<0&&(l=n.length-1,c=!0)),o&&c&&(f=!0),!f))return a=n[l],d=a.find(e,t),h=d.next(),h;if(!f&&c&&l===i&&(h.done||!h.done&&g(h.value.getCoords(),u)>=0)&&(f=!0),f)return Ct;const p=h;return h=d.next(),p};return{next:()=>{let p=m();for(;!f&&p.done;)p=m();return p}}}replace(e,t,n){let r=0,o=null;const i=typeof t=="function",l=n?.maxCount??Number.MAX_SAFE_INTEGER;let a=n.maxCount?"":"All";const c=typeof t=="string"?` with '${h0(t)}'`:"";let u=n?.description??"Replace";const d=this._transactions.beginCommit({description:u});try{let h=null,f=null,g=e.next();for(;!g.done&&r<l;){const m=g.value,p=m.getSheet();p!==h&&(h=p,f!==null&&f.apply(),f=h.getEntireRange().startIncrementalUpdates({orientation:n?.orientation,allowUnorderedWrites:!0}));const w=i?t(m):t;w!==void 0&&w!==m&&(f.push(m,w),r++,o=m),g=e.next()}f?.apply(),r===1&&l===1&&o&&(a=o.getA1()),d.commit({description:n?.description??`Replace ${a}${c}`})}catch(h){throw d.rollback(),h}return{count:r,last:o}}_nextSheetIndex(e,t=this._getSheetRefs()){return t.length===1?0:(e===void 0&&(e=this.getSelectedSheetIndex()),(e=Math.max(0,Math.min(e,t.length-1)))>=t.length-1?0:e+1)}_prevSheetIndex(e,t=this._getSheetRefs()){return t.length===1?0:(e===void 0&&(e=this.getSelectedSheetIndex()),(e=Math.max(0,Math.min(e,t.length-1)))<=0?t.length-1:e-1)}getNextSheet(e){if(this._closed)throw new Error(yn);const t=this._getSheetRefs();return t[this._nextSheetIndex(e,t)]?.sheet??null}getPreviousSheet(e){if(this._closed)throw new Error(yn);const t=this._getSheetRefs();return t[this._prevSheetIndex(e,t)]?.sheet??null}async _duplicateSheet(e){if(this._closed)throw new Error(yn);if(!this.getProtection().isStructureAllowed())throw new Error(wo);const t=this._getSheetRefs(),n=this.getSelectedSheetIndex();let r=null;if(e){if(r=this._getSheetRef(e),!r)throw new Error(zu(r))}else r=t[n];if(!r)return null;const o=r.sheet,i=this._strings.beginPersist(),l=this.getResources().beginPersist(),a=this.getStyles().beginPersist();let c=null;const u=this.beginCommit(`Duplicate '${o.getName()}'`);try{const d=this._getState().refsByInstance.get(o),h=await o.toJSON(),f=t.length+1,g=this.findValidSheetName(d.name),m=this._createSheet(f,g,d.visibility,n,h);this._emitter.notify("onSheetsChange"),c=m,u.commit()}catch(d){throw u.rollback(),d}finally{a.endPersist(),l.endPersist(),i.endPersist()}return c}_createRange(e,t){const n=e?{...e}:null;if(!(n&&this._getSheetRef(n.sheetName,ft.Visibility.VeryHidden))){const i=this.getSelectedSheet();return i?(delete n?.sheetName,Pw(n,n?{sheetName:rn,...i.getEntireRange().getCoords()}:null)):void console.warn(Pm)}const r=this.getSelectedSheet();let o=null;return t&&(o={getOptions:t}),new Vw(e,r,this,o)}_createRanges(e,t){const n=this.getSelectedSheet();let r=null;return t&&(r={getOptions:t}),new Hw(e,n,this,r)}getRange(e,t){try{const n=this._rangesAddressToCoords(e);if(n.length!==1)throw new Error(ow);return this._createRange(n[0],t)}catch(n){throw n instanceof Nt?new Nt(n.message):new Error(n.message??$i(e))}}getRanges(e,t){const n=this._rangesAddressToCoords(e);if(n.length===0)throw new Error($i(e));return this._createRanges(n,t)}_activeRangeCoords(){const e=this.getSelectedSheet(),t=ls(e.getSelection().getCoords()),n=e.getName(),r=[];for(let o=0;o<t.length;o++)r.push({sheetName:n,...t[o]});return r}getSelectedRange(e){return this.getRange(this._activeRangeCoords()[0],e)}getSelectedRanges(e){return this.getRanges(this._activeRangeCoords(),e)}getSelectedCell(){return this.getSelectedSheet().getSelectedCell()}_rangesAddressToCoords(e,t=!0,n=ft.Visibility.Hidden){if(!e)throw new Error(Ss);const r=this.getSelectedSheet(),o=r?.getEntireRange().getCoords(),i={...o},l=r?.getName();if(l&&(i.sheetName=l),typeof e=="string"){const u=e.trim().toLowerCase();if(u==="r"||u==="c"){const d=this.getSelectedCell().getCoords(),h={};u==="r"?h.rowStart=h.rowEnd=d.rowIndex:h.colStart=h.colEnd=d.colIndex,e=h}}const a=this,c=oh(e,i,el,u=>{if(!t)return null;if(typeof u=="string"){const d=a.getNames().getByName(u);if(d)return d.getRanges()?.getCoords()}throw new Error(`Invalid sheet reference '${u}'.`)});for(let u=0;u<c.length;u++)this._validateCoords(c[u],n);return c}_validateCoords(e,t=ft.Visibility.Visible,n=La){if(e===null)return;const r=this.getSheet(e.sheetName,t).getEntireRange().getCoords();if(!J.isRangeWithinRange(e,r))throw new Nt(n);if(e.rowEnd<e.rowStart||e.colEnd<e.colStart)throw new Error(sw)}_updateSheetRef(e,t){const n=this._getState();let r=[...n.sheetRefsAll];r[this._findOffsetForId(e.id,n.sheetRefsAll)]=t,this._updateSheetRefStates(r);const o=new Map(n.refsById);o.set(e.id,t);const i=e.name.toLowerCase(),l=t.name.toLowerCase(),a=new Map(n.refsByLowerCaseName);a.delete(i),a.set(l,t);const c=new Map(n.sheetsByLowerCaseName);let u=c.get(i);c.delete(i),c.set(l,u);const d=new Map(n.refsByInstance);return d.set(u,t),this._updateState({refsById:o,refsByLowerCaseName:a,sheetsByLowerCaseName:c,refsByInstance:d}),t}_setSheetName(e,t){if(this._closed)throw new Error(yn);if(!this.getProtection().isStructureAllowed())throw new Error(wo);const n=this._getSheetRef(e);if(!n)throw new Error(zu(e));if(t===n.name)return n.sheet;t=this._validateNewSheetName(t);const r=Object.freeze({...n,name:t});let o=null;const i=this.beginCommit("Rename Sheet");try{const l=this._updateSheetRef(n,r);this._adjustSheetNamesIfRequired(),this._sheetOnNameChange.forEach((a,c)=>{n.id===c&&a()}),this._emitter.notify("onSheetsChange"),o=l.sheet,i.commit()}catch(l){throw i.rollback(),l}return o}_setSheetVisibility(e,t=ft.Visibility.Visible){if(this._closed)throw new Error(yn);if(!this.getProtection().isStructureAllowed())throw new Error(wo);const n=this._getSheetRef(e);if(!n)return null;if(t===n.visibility)return;let r=null,o="";t===ft.Visibility.Visible?o="Unhide Sheet":t===ft.Visibility.Hidden?o="Hide Sheet":t===ft.Visibility.VeryHidden&&(o="Very Hide Sheet");const i=this.beginCommit(o);try{const l=this._getState().sheetRefsVisible;if(t!==ft.Visibility.Visible&&l.length===1&&l[0].id===n.id)throw new Error(Pu);const a={...n,visibility:t};let c=-1;t!==ft.Visibility.Visible&&(c=this._findOffsetForId(n.id,l));const u=this._updateSheetRef(n,a);t!==ft.Visibility.Visible&&this._adjustRemoveSelectionIfRequired(c,n.id),r=u.sheet,this._adjustSheetNamesIfRequired(),i.commit()}catch(l){throw i.rollback(),l}return this._sheetOnVisibilityChange.forEach((l,a)=>{n.id===a&&l()}),this._emitter.notify("onSheetsChange"),r}_moveSheet(e,t){if(this._closed)throw new Error(yn);if(!this.getProtection().isStructureAllowed())throw new Error(wo);let n=null;const r=this.beginCommit(`Move Sheet '${e.name}'`);try{const o=this._getState(),i=o.sheetRefsVisible;if(t<0||t>i.length-1)throw new Error(`Invalid to index: ${t}`);const l={view:this.getView(),activeSheetId:this.getView().getActiveSheetId()},a=o.sheetRefsAll,c=this._findOffsetForId(e.id,a),u=this._findOffsetForId(i[t].id,a);if(c===u)return;const d=a[c];let h=[...a];h.splice(c,1),h.splice(u,0,d),this._updateSheetRefStates(h),this._adjustSheetNamesIfRequired(),this._sheetOnIndexChange.forEach((f,g)=>{g>=c&&g<=u&&f()}),this._emitter.notify("onSheetsChange"),n=d.sheet,r.commit({viewBefore:l,viewAfter:{view:this.getView(),activeSheetId:this.getView().getActiveSheetId()}})}catch(o){throw r.rollback(),o}return n}_setSelectedSheet(e){if(this._closed)throw new Error(yn);const t=this._getSheetRef(e);if(!t)throw new Error(zu(e));let n=null;return t.visibility!==ft.Visibility.Visible&&this._setSheetVisibility(t,ft.Visibility.Visible),this._view.setActiveSheetId(t.id),n=t.sheet,n}getProtection(){return this._protection}getNames(){return this._names}getCalculation(){return this._calculation}getScripts(){return this._scripts??null}_notifyAllChange(){this._emitter.notify("onSheetsChange"),this._emitter.notify("onViewChange")}addListeners(e,t){return this._emitter.addListeners(e,t)}_sheetToWBEvent(e){const t=this;return n=>{const r=()=>{const i=n.getSource();if(i.isICellRanges){const l=[...i.getCoords()];for(let a=0;a<l.length;a++){const c=l[a];!c.sheetName&&i.getSheet().getName()&&(l[a]={...c,sheetName:i.getSheet().getName()})}return t.getRanges(l)}if(i.isICellRange){const l=i.getCoords(),a=i.getSheet().getName();return t.getRange({...l,sheetName:a})}},o={getSource:r,trigger:n.trigger,getFrom:()=>t.getRanges(n.getFrom()),getTo:()=>t.getRange(n.getTo()),isDataChange:n.isDataChange,isTransactional:n.isTransactional,isUndo:n.isUndo,toString:()=>`WorkbookRangeEvent: ('${n.trigger}', ${r().toString()})`,timeStamp:Date.now()};e(o)}}_fromJSON(e){if(this._emitter.notify("onBeforeLoad",{params:e}),this._initState(),!e.sheets||e.sheets.length===0)throw new Error(Pu);e.theme&&(this._theme=new cd(e.theme),this._styles.setTheme(this._theme));const t=this._strings.beginPersist(),n=this._resources.beginPersist(),r=this._styles.beginPersist();try{t.fromJSON(e.strings),n.fromJSON(e.resources),r.fromJSON(e.styles),e.date1904&&(this._isDate1904=!0),e.view||(e.view={});const o=e.sheets,i=o.length;let l=e.view.activeSheetId??null;l!==null&&(l=Math.min(Math.max(1,l),i));let a=null;for(let u=0;u<i;u++){const d=o[u],h=d.visibility||ft.Visibility.Visible,f=u+1;h===ft.Visibility.Visible?a=f:l!==null&&l===f&&(l=null),this._createSheet(f,d.name,h,void 0,d.sheet)}this._updateState({lastId:a}),e.names&&this._names.fromJSON(e.names),e.view.activeSheetId=l??a,this.setView(new Lm({json:e.view})),this._adjustSheetNamesIfRequired(),this._listenerProtection?.();const c=this;this._protection=new zm(e?.protection,this._options?.readonly),this._listenerProtection=this._protection.addListeners({onChange:u=>{c._emitter.notify("onProtectionChange",{source:u})}}),e.scripts&&(this._scripts=this._createScripts(e.scripts)),this._emitter.notify("onLoad")}finally{r.endPersist(),n.endPersist(),t.endPersist()}}_createScripts(e){return new tx({transactions:this._transactions,json:e,workbook:this,onAdd:(t,n)=>{const r=this._calculation;r.getStatus()!==Yt.Status.Off&&r.start().then(()=>{const o=n.getFunctions().getItems({type:"formula"});for(let i=0;i<o.length;i++){const l=o[i];this._calculation.getFunctions().add(l)}})},onRemove:(t,n)=>{}})}async toJSON(e=!1){if(this._closed)throw new Error(yn);await this._emitter.notify("onBeforeSave",{async:!0});const t={sheets:[]};await Promise.resolve(this._starting);const n=this._theme.toJSON();(n?Object.keys(n).length:0)>0&&(t.theme=n);const r=this._strings.beginPersist(),o=this._resources.beginPersist(),i=this._styles.beginPersist();try{const l=this._getSheetRef(this.getSelectedSheetIndex()).id;let a=l,c=null;const u=this._getState(),d=u.sheetRefsAll,h=u.sheetsById;for(let b=0;b<d.length;b++){const v=d[b],y=b+1,_=await h.get(v.id).toJSON(e),C={name:v.name,sheet:_};v.visibility===ft.Visibility.Visible?c=y:C.visibility=v.visibility,v.id===l&&(a=y),t.sheets.push(C)}const f=i.toJSON();f&&Object.keys(f).length>0&&(t.styles=f);const g=this.getProtection().toJSON();g&&(t.protection=g);const m=await r.toJSONAsync();m&&m.length>0&&(t.strings=m);const p=await o.toJSONAsync();p&&p.length>0&&(t.resources=p);const w=this._names.toJSON();w&&w.length>0&&(t.names=w);const S=this._view.toJSON();S&&(a!==c?S.activeSheetId=a:delete S.activeSheetId,Object.keys(S).length>0&&(t.view=S))}finally{i.endPersist(),o.endPersist(),r.endPersist()}if(this._scripts){const l=this._scripts.toJSON();l&&Object.keys(l).length>0&&(t.scripts=l)}return this._isDate1904&&(t.date1904=!0),this._emitter.notify("onSave",{params:t}),t}isClosed(){return this._closed}close(){if(this._closed)return;this._emitter.notify("onClose");const e=this._getState();e.listenersSheets.forEach(n=>{n()}),e.listenersSheets.clear();const t=e.sheetRefsAll;for(let n=t.length-1;n>=0;n--)try{t[n].sheet.close()}catch(r){console.warn("error on close",r)}this._ownResources,this._ownNames&&this._names.close(),this._ownsCalculation&&this._calculation.close(),this._ownStyles,this._transactionsRemoveListener?.(),this._closed=!0}beginCommit(e){if(this._closed)throw new Error(yn);return this._beginCommit(typeof e=="string"?{description:e}:e)}doBatch(e,t){const n=this;return t=typeof t=="string"?{description:t}:{description:"Update Workbook",...t},this._transactions.doBatch(e,t,(r,o)=>{r.getDepth()===0&&(n._lastTransactionUUID=r.getId())})}_beginCommit(e){const t=this;return this._transactions.beginCommit(typeof e=="string"?{description:e}:e,n=>{n.getDepth()===0&&(t._lastTransactionUUID=n.getId())})}_getState(){return this._transactions.getState(this)}_updateState(e,t="Update Workbook"){if(!e)return;const n=this._beginCommit(t);try{n.updateState(this,e),n.commit()}catch(r){throw n.rollback(),r}}get options(){return this._options}get[Symbol.toStringTag](){return"[Workbook]"}toString(){return""}get isIWorkbook(){return!0}}const rs={address:null,scope:null};(function(){try{if(typeof document<"u"){var s=document.createElement("style");s.appendChild(document.createTextNode(`._sheetxl-sheet_1qeq6_5 ._viewport-overlay_1qeq6_6{pointer-events:none}._sheetxl-sheet_1qeq6_5 ._viewport-overlay_1qeq6_6 *{pointer-events:initial}._sheetxl-sheet_1qeq6_5 .cell-container>*{overflow:hidden}._sheetxl-sheet_1qeq6_5 .cell-container .text-box{position:absolute}._sheetxl-sheet_1qeq6_5 .cell-container .text-line{text-rendering:optimizespeed;position:absolute;vertical-align:baseline;white-space:pre}._sheetxl-sheet_1qeq6_5 .cell-container .filter-button{position:absolute;display:flex;align-items:center;justify-content:center;flex-direction:row;margin-bottom:4px}._sheetxl-sheet_1qeq6_5 .cell-container .text-debug-bounds{position:absolute;background:green;pointer-events:none;opacity:.2}._sheetxl-sheet_1qeq6_5 .cell-container .fill{position:absolute}._sheetxl-sheet_1qeq6_5 .cell-container .pending{width:6px;height:6px;top:5px;left:4px;position:absolute;border:var(--sxl-app-color-primary-dark, grey) .5px;border-style:double;border-radius:50%;background-color:var(--sxl-app-color-button-surface, grey);opacity:1;animation:_pulse_1qeq6_1 1.5s infinite alternate}@keyframes _pulse_1qeq6_1{0%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:.8}to{transform:scale(1);opacity:1}}._sheetxl-sheet_1qeq6_5 .cell-container .slider{position:absolute;width:130%;height:2px;bottom:1px;opacity:0;animation:_fadeIn_1qeq6_1 0s .5s forwards;overflow-x:hidden}._sheetxl-sheet_1qeq6_5 .cell-container .line{position:absolute;opacity:.3;background:var(--sxl-app-color-primary-light, rgb(173, 173, 173)) .5px;width:100%;height:2px}._sheetxl-sheet_1qeq6_5 .cell-container .subline{position:absolute;background:var(--sxl-app-color-primary, rgb(77, 77, 77)) .5px;opacity:.9;height:3px}._sheetxl-sheet_1qeq6_5 .cell-container .inc{animation-delay:0s;animation:_increase_1qeq6_1 3s infinite}@keyframes _fadeIn_1qeq6_1{0%{opacity:0;height:0px}to{opacity:1;height:2px}}@keyframes _increase_1qeq6_1{0%{left:-150%;width:30%;animation-timing-function:ease}to{left:100%;width:30%}}._sheet-selection_12wyx_5 .fill-handle .dragging,._movable-area_314c6_5 .moveable-control-box .dragging{opacity:0}._movable-area_314c6_5 .moveable-control-box .moveable-control{width:11px;height:11px;margin-top:-5.5px;margin-left:-5.5px;background-color:var(--sxl-app-color-background, white);background-image:var(--sxl-app-image-background);border:2px solid var(--sxl-app-color-primary-dark, grey)}._movable-area_314c6_5 .moveable-control-box .moveable-line{background:var(--sxl-app-color-grey, grey)}@media (pointer: coarse){._movable-area_314c6_5 .moveable-control-box .moveable-control{width:22px;height:22px;margin-top:-11px;margin-left:-11px}}._editable-input_1bqx6_6{position:absolute;left:0;top:0;width:100%;min-height:calc(100% + 1px);border:none;padding:0;outline:none;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit;line-height:1.2;letter-spacing:inherit;text-transform:inherit;background:transparent}@keyframes _pop_1wyun_1{0%{transform:scale(1)}to{transform:scale(var(--scale))}}@keyframes _fadeIn_1wyun_33{0%{opacity:0}to{opacity:1}}._Wrapper_1wyun_25{display:flex;box-sizing:border-box;transform:translate3d(var(--translate-x, 0),var(--translate-y, 0),0) scaleX(var(--scale-x, 1)) scaleY(var(--scale-y, 1));transform-origin:0 0;touch-action:manipulation}._Wrapper_1wyun_25._dragOverlay_1wyun_37{z-index:999}._Item_1wyun_47{position:relative;display:flex;align-items:center;outline:none;box-sizing:border-box;transform-origin:50% 50%;-webkit-tap-highlight-color:transparent;transform:scale(var(--scale, 1))}._Item_1wyun_47:not(._withHandle_1wyun_61){touch-action:manipulation}._Item_1wyun_47._dragging_1wyun_66:not(._dragOverlay_1wyun_37){z-index:999}._Item_1wyun_47._dragOverlay_1wyun_37{cursor:inherit;animation:_pop_1wyun_1 .2s cubic-bezier(.18,.67,.6,1.22);transform:scale(var(--scale));opacity:1}._Row_1kr10_1{display:flex;box-sizing:border-box}._TabStrip_3x0dp_1::-webkit-scrollbar{display:none;height:0px}._TabStrip_3x0dp_1{overflow-y:auto;overflow-x:hidden;position:relative}._script-editor_iy654_5 .monaco-editor{position:absolute}._script-editor_iy654_5 .monaco-editor .margin-icon{display:block;width:16px;height:16px;background-size:16px;background-repeat:no-repeat;background-position:center;background-size:contain}._script-editor_iy654_5 .monaco-editor .formula{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="grey"><path d="m 12.106007,8.1692949 c 0.124174,-0.1578352 0.181773,-0.3565642 0.283755,-0.5271169 0.10273,-0.1715492 0.04413,-0.2027176 -0.129161,-0.2014713 -0.685452,0.00576 -1.371152,-0.00277 -2.056604,0.00501 C 10.021228,7.4479573 9.9586414,7.407817 9.9935503,7.2080883 10.145401,6.3413623 10.291269,5.4736396 10.51219,4.6213758 10.642847,4.1167002 10.782479,3.6117747 11.061498,3.1622046 11.339518,2.7138809 11.726751,2.5974365 12.2035,2.829328 c 0.398455,0.1934923 0.722604,0.4827333 0.990152,0.8340617 0.116944,0.1535968 0.27079,0.2740306 0.449073,0.1715499 0.343348,-0.1974819 0.644807,-0.4383502 0.819599,-0.826332 0.100985,-0.2244112 0.157836,-0.476001 0.04039,-0.7058977 C 14.339646,1.9840253 14.038187,1.7618584 13.707056,1.6394296 13.156999,1.4362128 12.562559,1.4840872 12.017239,1.6758341 11.38789,1.8970037 10.783727,2.2625445 10.259602,2.6724688 10.066109,2.8238217 9.8783519,2.9839017 9.7013165,3.1547035 9.0502751,3.7823067 8.5657962,4.529097 8.2246919,5.3651534 7.9823276,5.9595939 7.7888351,6.5660026 7.6913412,7.2015842 7.673637,7.318528 7.6357391,7.423253 7.5065759,7.4432009 7.3472438,7.4678879 7.1592376,7.4436995 6.9974121,7.4441728 6.6351128,7.4451447 6.2598478,7.3676233 5.9915515,7.6815496 5.8721151,7.8211835 5.7461952,7.9840062 5.6439635,8.1371045 c -0.1009847,0.1518511 -0.093255,0.3002122 0.085027,0.367535 0.1957362,0.073561 0.4528118,0.026182 0.6530361,0.0197 0.2645558,-0.00847 0.5291116,0.00501 0.7936674,-7.476e-4 0.1820229,-0.00374 0.2413669,0.030421 0.2064588,0.2358807 C 7.3487406,8.9587006 7.3095941,9.1492003 7.2804197,9.3464333 7.1804317,10.024404 7.0667304,10.700629 6.9525298,11.376606 6.7936963,12.314146 6.6371075,13.252434 6.4655575,14.188478 6.3017374,15.082631 6.1855427,15.985013 5.983074,16.873433 5.8249883,17.568607 5.7240037,18.277248 5.5556954,18.969682 5.4145655,19.550158 5.293882,20.143601 4.9722259,20.665731 4.7380909,21.045734 4.3959882,21.206312 3.9663652,21.104829 3.5778849,21.012322 3.2115961,20.866205 2.8951763,20.608631 2.6862246,20.438328 2.4473513,20.31141 2.1920214,20.458026 1.9519014,20.595915 1.7791048,20.851743 1.646453,21.088123 1.2205704,21.847879 1.915497,22.569984 2.6655289,22.684434 3.1692071,22.760986 3.666153,22.580208 4.1087416,22.356046 4.6996913,22.056582 5.2103511,21.635437 5.6387269,21.13874 5.9898058,20.731558 6.3575906,20.343327 6.6500737,19.890016 6.8450616,19.58756 7.0238427,19.274881 7.1866655,18.954471 7.7639005,17.817206 8.1227091,16.589926 8.4189318,15.354418 8.5613081,14.760227 8.716401,14.169777 8.8478064,13.572843 9.0268365,12.760724 9.1741996,11.934891 9.3083481,11.114294 9.3749255,10.707112 9.4310263,10.300679 9.5160532,9.8967389 9.5861222,9.5636133 9.6442168,9.2185186 9.6890985,8.8814035 9.7414633,8.4891827 9.990308,8.5136187 10.329668,8.4762164 c 0.286249,-0.03167 0.574492,-0.046376 0.861739,-0.067571 0.230395,-0.016703 0.494951,0.00396 0.711881,-0.088019 0.07754,-0.032911 0.147613,-0.080788 0.202719,-0.1513533 z"/><path d="M 22.473802,7.8481382 C 22.426924,7.6912996 22.341898,7.5501696 22.231437,7.4294861 22.130452,7.3192756 21.987827,7.1749046 21.851933,7.1098255 21.411589,6.8988785 20.817398,7.0838898 20.436149,7.3422154 20.23343,7.479854 20.052405,7.6519026 19.871131,7.8167201 19.691352,7.9802913 19.517061,8.1488492 19.35723,8.3321177 19.025101,8.7128687 18.724639,9.1210479 18.436396,9.5354601 18.296263,9.7374301 17.901549,10.472252 17.781115,10.399942 17.654198,10.323892 17.495365,9.5905657 17.435023,9.3843566 17.351243,9.0978583 17.29539,8.8016361 17.161741,8.5323425 16.97922,8.1643081 16.865268,7.7623629 16.608941,7.4307332 16.325934,7.0639457 16.001036,6.9584722 15.558946,7.092371 c -0.43436,0.1314054 -0.78469,0.4049374 -1.128539,0.6819608 -0.503927,0.4056851 -0.879442,0.926319 -1.256951,1.4439609 -0.28226,0.387483 -0.284753,0.3857373 0.04488,0.7380631 0.206458,0.2211702 0.202718,0.2184272 0.389229,-0.00847 0.2663,-0.3251469 0.524872,-0.6595196 0.882433,-0.8934057 0.261315,-0.1713009 0.417904,-0.1368908 0.57948,0.1326518 0.07929,0.1326517 0.146866,0.2752777 0.200225,0.4208957 0.335619,0.9141014 0.590201,1.8541344 0.89191,2.7784594 0.03815,0.117691 -0.01122,0.193991 -0.06707,0.278519 -0.356565,0.538837 -0.719363,1.074182 -1.123054,1.578607 -0.320409,0.401198 -0.643312,0.803891 -1.073932,1.097621 -0.187757,0.128912 -0.40768,0.217679 -0.635831,0.156839 -0.233887,-0.06283 -0.37377,-0.27478 -0.587459,-0.373521 -0.006,-0.003 -0.01272,-0.0052 -0.01895,-0.0079 -0.09974,-0.04064 -0.249845,-0.0389 -0.353074,-0.01571 -0.454059,0.102482 -0.697669,0.614139 -0.790177,1.023813 -0.08379,0.371776 -0.0013,0.778209 0.261315,1.062463 0.228899,0.24785 0.572248,0.351327 0.901634,0.356315 0.189003,0.0028 0.39995,-0.04663 0.57549,-0.11445 0.670241,-0.262062 1.181649,-0.887172 1.605038,-1.441717 0.285501,-0.374517 0.550555,-0.763994 0.829573,-1.143499 0.230645,-0.313677 0.68595,-1.247726 0.81586,-1.250718 0.07854,-0.0017 0.09924,0.185762 0.114199,0.241117 0.03341,0.123675 0.06658,0.247351 0.102232,0.370279 0.167561,0.578481 0.343848,1.156464 0.525122,1.730458 0.120934,0.384242 0.315921,0.782697 0.560779,1.103356 0.07431,0.09749 0.167311,0.190749 0.26306,0.266799 0.371276,0.296972 0.838799,0.27453 1.266177,0.123177 0.191498,-0.06757 0.370029,-0.163071 0.539335,-0.275527 0.781948,-0.519886 1.340732,-1.244235 1.868598,-2.002495 0.124423,-0.178781 0.107467,-0.278769 -0.03441,-0.428127 -0.367286,-0.386237 -0.357062,-0.389727 -0.705149,0.01995 -0.261066,0.306446 -0.527117,0.612643 -0.879442,0.818851 -0.245855,0.144621 -0.413416,0.103229 -0.592696,-0.118439 -0.14861,-0.183518 -0.246353,-0.396709 -0.33138,-0.614886 -0.349831,-0.901136 -0.588954,-1.838675 -0.885177,-2.757515 -0.21743,-0.674231 -0.223414,-0.680464 0.20945,-1.248723 0.447575,-0.587708 0.875703,-1.1968602 1.462163,-1.6613914 0.431119,-0.3416031 0.73183,-0.3226534 1.129037,0.059094 0.0788,0.075801 0.207456,0.1388856 0.316919,0.1476127 0.369781,0.029674 0.691187,-0.3024566 0.880939,-0.5792304 0.188006,-0.2727835 0.259319,-0.6183768 0.163072,-0.9392845 z"/></svg>');cursor:pointer}._script-editor_iy654_5 .monaco-editor .macro{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="grey"><path d="M 5.1933594,1.4433594 6.3417969,2.5234375 6.2109375,2.6621094 c -3.466072,3.6769426 -3.467641,9.6565186 0,13.3339846 l 0.1308594,0.136718 -1.1484375,1.082032 -0.1328125,-0.140625 c -4.0371886,-4.28224 -4.0373752,-11.2077961 0,-15.4902346 z m 14.4726566,0 0.132812,0.140625 c 4.03717,4.2822197 4.037356,11.2058636 0,15.4882816 l -0.132812,0.140625 -1.148438,-1.080079 0.130859,-0.138671 c 3.465532,-3.675243 3.466902,-9.6542123 0,-13.3320316 L 18.517578,2.5234375 Z M 7.7597656,4.4335937 8.8769531,5.5488281 8.7421875,5.6816406 c -2.0366665,2.0366662 -2.037411,5.3404354 0,7.3769534 L 8.8769531,13.191406 7.7597656,14.310547 7.625,14.173828 C 4.9718615,11.520692 4.9723209,7.222936 7.6269531,4.5683594 Z m 9.3398434,0 0.132813,0.1347657 c 2.653779,2.6537788 2.65545,6.9500666 0,9.6054686 l -0.132813,0.136719 -1.117187,-1.119141 0.134765,-0.132812 c 2.036637,-2.035554 2.037534,-5.3391996 0,-7.3769534 L 15.982422,5.5488281 Z m -4.669921,1.7011719 c 0.811773,0 1.627703,0.304374 2.25,0.90625 1.260638,1.2198223 1.260413,3.1986104 0,4.4179684 -0.355144,0.343115 -0.779063,0.585007 -1.226563,0.732422 l -0.234375,0.07617 v 3.386719 h 0.002 v 6.048828 c 0,0.436615 -0.351565,0.791016 -0.789062,0.791016 -0.43763,0 -0.791016,-0.354618 -0.791016,-0.791016 v -3.308594 -6.126953 l -0.234375,-0.07617 c -0.448339,-0.147699 -0.871819,-0.38969 -1.226562,-0.732422 -1.2608671,-1.22004 -1.2605877,-3.1984433 0,-4.4179684 0.62227,-0.6019293 1.438264,-0.90625 2.25,-0.90625 z m 0,1.5820313 c -0.417461,0 -0.829931,0.1510762 -1.146485,0.4570312 -0.615751,0.5967629 -0.616877,1.5583713 0,2.1562499 0.314469,0.303373 0.726552,0.455078 1.146485,0.455078 0.421182,0 0.833304,-0.153008 1.148437,-0.457031 0.61548,-0.5965047 0.616739,-1.5585025 0,-2.15625 C 13.261859,7.8661993 12.846121,7.7167969 12.429688,7.7167969 Z"/></svg>');cursor:pointer}._script-editor_iy654_5 .monaco-editor .autorun{background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="grey"><path d="M10 15h5.88c.27-.31.67-.5 1.12-.5.83 0 1.5.67 1.5 1.5s-.67 1.5-1.5 1.5c-.44 0-.84-.19-1.12-.5H11.9c-.46 2.28-2.48 4-4.9 4-2.76 0-5-2.24-5-5 0-2.42 1.72-4.44 4-4.9v2.07c-1.16.41-2 1.53-2 2.83 0 1.65 1.35 3 3 3s3-1.35 3-3zm2.5-11c1.65 0 3 1.35 3 3h2c0-2.76-2.24-5-5-5s-5 2.24-5 5c0 1.43.6 2.71 1.55 3.62l-2.35 3.9c-.68.14-1.2.75-1.2 1.48 0 .83.67 1.5 1.5 1.5s1.5-.67 1.5-1.5c0-.16-.02-.31-.07-.45l3.38-5.63C10.49 9.61 9.5 8.42 9.5 7c0-1.65 1.35-3 3-3m4.5 9c-.64 0-1.23.2-1.72.54l-3.05-5.07C11.53 8.35 11 7.74 11 7c0-.83.67-1.5 1.5-1.5S14 6.17 14 7c0 .15-.02.29-.06.43l2.19 3.65c.28-.05.57-.08.87-.08 2.76 0 5 2.24 5 5s-2.24 5-5 5c-1.85 0-3.47-1.01-4.33-2.5h2.67c.48.32 1.05.5 1.66.5 1.65 0 3-1.35 3-3s-1.35-3-3-3"/></svg>');cursor:pointer}`)),document.head.appendChild(s)}}catch(e){console.error("vite-plugin-css-injected-by-js",e)}})();/**
 * @license @sheetxl/react - React - React components needed to build advanced grid and spreadsheet UIs. - v0.6.6
 *
 * (C) 2025-present SheetXL Inc. & Michael T. Ford
 * License: The license can be found at https://www.sheetxl.com/license.
 */const Gi=(s=6e4)=>new Date(Math.floor(Date.now()/s)*s);Object.freeze(Object.defineProperty({__proto__:null,nowWithPrecision:Gi},Symbol.toStringTag,{value:"Module"}));const jw=Object.freeze([8,9,10,11,12,14,16,18,20,22,24,26,28,30,36,48,72]),Dd=(s,e=!0,t=jw)=>{if(!t||t.length===0)return s;if(s===void 0)return t[0];if(e&&s>=t[t.length-1]||!e&&s<=t[0])return s;let n=V.findEqualOrGreater(t,s);return e?(t[n]===s&&(n+=1),t[n]||(n-=1),t[n]):(n-=1,t[n])},UR=Object.freeze(Object.defineProperty({__proto__:null,DefaultFontSizes:jw,findNextFontSize:Dd},Symbol.toStringTag,{value:"Module"})),$m=T.memo(s=>{const{anchorLocation:e=Et.TopLeft,cellWidth:t,cellHeight:n,size:r=7,inset:o=1,darkMode:i,fill:l,pathProps:a,style:c,...u}=s,d=r,h=o;let f="red",g=[],m=[];return e===Et.TopLeft?(f=i?"rgb(255, 198, 246)":"green",g.push(h),m.push(h),g.push(h+d),m.push(h),g.push(h),m.push(h+d)):e===Et.TopRight?(f=i?"rgb(0, 255, 255)":"red",g.push(t-h),m.push(h),g.push(t-(h+d)),m.push(h),g.push(t-h),m.push(h+d)):e===Et.BottomRight?(f=i?"rgb(236, 252, 211)":"purple",g.push(t-h),m.push(n-h),g.push(t-(h+d)),m.push(n-h),g.push(t-h),m.push(n-(h+d))):e===Et.BottomLeft&&(f=i?"rgb(255, 236, 183)":"blue",g.push(h),m.push(n-h),g.push(h+d),m.push(n-h),g.push(h),m.push(n-(h+d))),ge.jsx("svg",{width:`${t}`,height:`${n}`,viewBox:`0 0 ${t} ${n}`,style:{position:"absolute",width:`${t}px`,height:`${n}px`,pointerEvents:"none",...c},...u,children:ge.jsx("path",{d:`M ${g[0]} ${m[0]} L ${g[1]} ${m[1]} L ${g[2]} ${m[2]} L ${g[0]} ${m[0]} Z`,fill:l??f,...a})})}),ax=s=>{const{renderBounds:e,darkMode:t,zoom:n,disabled:r,filter:o,onFilterButtonMouseDown:i,style:l,...a}=s,c=T.useMemo(()=>{let f=null;const g=o.getSortField();g&&(f=g.reverse);const m=o.getField(),p=m&&m.criteria&&m.criteria.length>0;return f===!0?p?"m 9.429858,10.25386 2,-1 v -3 l 3,-4 h -8 l 3,4 z M 5.849492,9.452298 H 4.24187 V 2.0761788 H 3.170122 V 9.452298 H 1.5625 l 2.143496,2.950446 z":"m 13.109228,9.865914 h -1.607622 v -7.37612 h -1.071748 v 7.37612 H 8.822236 l 2.143496,2.950446 z M 0.75000004,9.15 4.3000002,13.094444 7.8500003,9.15 Z":f===!1?p?"m 9.429858,10.25386 2,-1 v -3 l 3,-4 h -8 l 3,4 z M 5.849492,5.0266248 H 4.24187 V 12.402744 H 3.170122 V 5.0266248 H 1.5625 l 2.143496,-2.950446 z":"m 13.109228,5.44024 h -1.607622 v 7.37612 H 10.429858 V 5.44024 H 8.822236 L 10.965732,2.489794 Z M 0.75000004,9.15 4.3000002,13.094444 7.8500003,9.15 Z":p?"m 9.429858,10.25386 2,-1 v -3 l 3,-4 h -8 l 3,4 z M 0.75000004,9.15 4.3000002,13.094444 7.8500003,9.15 Z":"M 7.4533523,10.606423 2.2001838,4.9460198 2.966932,4.1188401 7.4533523,8.9589099 11.933438,4.1188401 12.700184,4.9460198"},[o]),[u,d]=T.useState(!1),h=Math.min(Math.min(18,e.height-8),e.width);return ge.jsx("div",{style:{width:`${h}px`,height:`${h}px`,right:"0px",boxShadow:`0px 0px 0px 0.5px var(${u&&!r?"--sxl-app-color-primary-light, rgba(0,0,0,.55)":"--sxl-app-color-border-button, grey"})`,backgroundColor:"var(--sxl-app-color-button-fill, white)",backgroundImage:"var(--sxl-app-image-background)",borderRadius:(h>12?1:0)+"px",marginRight:"2px",display:"flex",alignItems:"center",justifyContent:"center",cursor:r?void 0:"pointer",...l},onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),onMouseDown:f=>{i?.(f,o),f.preventDefault()},...a,children:ge.jsx("svg",{width:""+15*n,height:""+15*n,viewBox:"0 0 15 15",style:{fill:`var(${u&&!r?"--sxl-app-color-primary-dark":"--sxl-app-color-button-text"}, grey)`,opacity:r?.6:1},children:ge.jsx("path",{d:c})})})},cx=s=>{const{value:e,coords:t,bounds:n,children:r,style:o,range:i,zoom:l=1,view:a,bodyStyle:c,normalStyle:u,showFormulas:d,showZeros:h,docTheme:f,onLinkMouseDown:g,onFilterButtonMouseDown:m,filterButtonProps:p,createFilterButton:w=ax,...S}=s,b=n.height/l,v=n.width/l,y=e,_=y.getValue(),C=e.getStyle(),E=c?.darkMode??!1;let x,R;const I=_&&_.isFormulaError,A=I&&_ instanceof He.Parse;let M,k=d||A;if(k)if(y.isSpillOverflow())R="";else{const ze=y.getFormulaText();ze?R=ze:x=y.getNumberFormat(Vt.Type.General)}else x=y.getNumberFormat();k||(M=y.getTextOverflow());const F=M?M.colBounds.width+M.leftOffset+M.rightOffset:v,L=M?M.anchorBounds.x-M.leftOffset:0,N=M?M.anchorBounds.width:v,D=M?M.anchorBounds.x:0;let O,H=y.getRenderHorizontalAlignment();x&&(O=x?.formattedRuns,R=O?.runs[0]?.text??x.displayText);const z=y.getCalcStatus()===lt.CalcStatus.Pending;let j=null,q=C.getFill().toCSS(E,n),P=0,U=0;if(!C.getBorder().isEmpty()){const ze=C.getBorder().getRight();!ze.isNone()&&pe.BuiltInDefinitions.get(ze.getStyle()).width>1&&(P=1);const Z=C.getBorder().getBottom();!Z.isNone()&&pe.BuiltInDefinitions.get(Z.getStyle()).width>1&&(U=1)}let ne=null;if(v!==N||P||U||typeof q?.backgroundPosition=="number"){const{backgroundPosition:ze,...Z}=q,Se=ze??0,te=a?.getScrollTopLeft(),ie=Se?-(n.x+(te.left??0))%Se:0,$=Se?-(n.y+(te.top??0))%Se:0;(ze!==void 0||P||U||v!==N)&&(Object.keys(Z).length===1&&Z.background==="none"||(q=null,ne=ge.jsx("div",{className:"fill",style:{marginLeft:`${ie}px`,marginTop:`${$}px`,left:D*l,width:wt.boundPixel(N*l-ie+1+P),height:wt.boundPixel(n.height-$+1+U),...Z}},"background")))}let ee=null;const ve=y.getComments(),le=y.getWarnings(),Ce=y.getErrors();if(ve||I||Ce.length>0||le.length>0){const ze={size:7*l,darkMode:E,cellWidth:N*l+2,cellHeight:b*l+2,style:{top:-1,left:D*l-1}};ee=ee??[],(le.length>0||Ce.length>0||I)&&ee.push(ge.jsx($m,{anchorLocation:Et.TopLeft,...ze},`indicator-${ee.length}`)),ve&&ee.push(ge.jsx($m,{anchorLocation:Et.TopRight,...ze},`indicator-${ee.length}`))}const re=C.getFont();let ae=x?.conditionalColor;const fe=C.getAlignment(),ye=fe.getHorizontal()===oe.HorizontalAlignment.Fill,he=fe.getHorizontal()===oe.HorizontalAlignment.CenterContinuous||ye,we=he||k?0:fe.getRotation(),be=y.getInsets(),me=be.top+be.bottom;let de=be.left,xe=be.right;const Le={...o,left:o.left-1,top:o.top-1,width:o.width+1+P,height:o.height+1+U},W=y.getColumnFilter(),Ze=W&&!W?.hasHiddenButton();let Xe=null;z&&(Xe=ge.jsxs("div",{className:"slider",children:[ge.jsx("div",{className:"line"}),ge.jsx("div",{className:"subline inc"})]},"pending"));const Ge=!(z||Ze||ne||r||ee||O?.runs.length>1||M||we%360!=0);q?.background==="none"&&(q=null);let ce=he||!(!M||!(M.rightIndex>0||M.leftIndex>0||M.colSpan>1));if(!ce){const ze=y.getSpans();(ze.width>1||ze.height>1)&&(ce=!0)}const We={...q,...Le,pointerEvents:g?"auto":void 0};if(!V.isEmpty(R)||!V.isEmpty(x?.repeatPlaceholder)){const ze=x?.canWrap??!1;let Z=null,Se=null,te=null,ie=[],$=!0;h||k||_!==0||($=!1);const Y=y.getTextFrame(k);if($&&Y){let Q=F-1-(de+xe);if(we){Z=Y.layout().bounds;const Be={x:0,y:0,width:F-1,height:b};if(O){let Ue=O.width;if(x.repeatPlaceholder||x.repeatChars.length>0){const $e=on.boundsToPoints(Be),Ve=on.rotatePoints($e,-we);Ue=on.minBoundingRect(Ve).width}Z={...Z,width:Ue}}te=on.clipToOuterRect({...Z,width:Z.width+1+de+xe},Be,we),Q=te.width-1-(de+xe)+.01}let K=null;ze&&(K={width:Q});let se=null,X=x?.repeatPlaceholder;const ue=Y.layout(K);if(Z=ue.bounds,k?Z={...Z,width:0}:O&&(Z={...Z,width:x.repeatPlaceholder||x.repeatChars.length>0?Q:O.width}),we&&ze){let Be=null;ue.visitLines({visitTextLine:(Ue,$e)=>{let Ve=Ue.bounds;const Je=on.boundsToPoints(Ve),rt=on.rotatePoints(Je,we),et=on.minBoundingRect(rt);Ve={...Ve,x:(et.width-Ve.width)/2,y:(et.height-Ve.height)/2},Be=Be?on.unionBounds(Be,Ve):Ve}}),Z={...Be,width:Be.width+de+xe}}if(!X&&y.getType()!==Me.String&&Math.floor(Z.width)>Q){if(C.getNumberFormat()==="General"&&y.getType()===Me.Number){const Be=C.measureText("0"),Ue=Math.floor(Q/Be.width),$e=_,Ve=V.splitNumber($e),Je=Math.min(10,Ue-(Math.max(1,Ve.ipLength)+1)-($e<0?1:0));if(Je>=-1){const rt=`0${Je>0?".":""}${"#".repeat(Math.max(0,Je))}`;se=y.getNumberFormat(rt).displayText,se==="0"&&$e<0&&(se="-0")}else if(Math.abs($e)>=Math.pow(10,5)||Math.abs($e)<=Math.pow(10,-5)){const rt=Ue-5-($e<0?1:0);if(rt>=0){const et=`0.${"0".repeat(Math.max(0,rt-1))}E+00`;se=y.getNumberFormat(et).displayText}}}se||(X="#")}if(!X&&O?.lastRepeatIndex>=0&&O?.width>Q&&(X="#"),X&&Q>0){const Be=C.measureText(X),Ue=Math.floor((Q||1)/(Be?.width||1));se=Ue>0?X.repeat(Ue):""}if(k&&(H=oe.HorizontalAlignment.Left),se){const Be=C.measureText(se).width;Be&&(Z={...Z,width:Be})}if(Se={...Z,width:Z.width+de+xe,height:Z.height},we&&!ze){const Be=on.boundsToPoints(Se),Ue=on.rotatePoints(Be,we),$e=on.minBoundingRect(Ue);Se.width=$e.width,Se.height=$e.height}H===oe.HorizontalAlignment.Center||H===oe.HorizontalAlignment.CenterContinuous?Se.x=(F-Se.width)/2:H===oe.HorizontalAlignment.Right?Se.x=F-Se.width-.5:Se.x=.5,fe.getVertical()===oe.VerticalAlignment.Center?Se.y=(b-Se.height)/2:fe.getVertical()===oe.VerticalAlignment.Bottom?Se.y=b-Se.height-me:Se.y=me;const _e=Ge?{...S}:void 0,Re={style:{left:o.left-1,top:o.top-1,width:o.width+1,height:o.height+1,transform:we?`rotate(${we}deg)`:void 0,cursor:g?"pointer":void 0,pointerEvents:g?"auto":void 0,zIndex:ce?1:void 0,...q},onMouseDown:g,onDoubleClick:g?Be=>{Be.stopPropagation(),Be.preventDefault()}:null,..._e};A&&(Re.style.textDecorationStyle="wavy",Re.style.textDecorationColor=E?"rgb(0, 255, 255)":"red",Re.style.textDecorationLine="underline");const Ne=re.getSize(),Oe=(Be,Ue,$e,Ve,Je,rt,et,at=null)=>{let nt=Ne*l,ht=$e,tt=et?.runs?et.runs:[{type:Vt.ParseRunType.Text,text:Be,width:C.measureText(Be,nt).width}];et&&et?.width!==Z.width&&(Z={...Z,width:et?.width});let yt=de;if(et?.lastRepeatIndex>=0&&Q>et?.width){const dt=et.runs[et.lastRepeatIndex];if(dt){const Dt=[...tt],In=Math.max(0,Q-1-et.width);let Fn=0,An="";if(In>0){const un=Math.floor(In/dt.width);An=un>0?dt.text.repeat(un):"",Fn=In}Dt[et.lastRepeatIndex]={type:Vt.ParseRunType.Repeat,text:An,width:Fn},tt=Dt,Z={...Z,width:et.width+Fn}}}const Xt=(dt,Dt,In,Fn,An,un,Wt,$r,zo,Os=null)=>{let uo,Ds=ht.width;Je===oe.HorizontalAlignment.Justify?(Ds=An,rt||(uo="justify")):Je===oe.HorizontalAlignment.Distributed&&(Ds=An,uo=rt||dt.text.split(" ").length-1==0?"center":"justify");const{style:yr,className:sl,...Mn}=Os;let Po=dt.text;if(Je===oe.HorizontalAlignment.Fill&&x?.repeatChars.length===0){const en=Math.max(1,Math.floor((ht?.width??0)/(Wt?.width??1)));Po=Po.repeat(en)}let Ls=ht.height;const cr=re.getVerticalAlignment(),ho=cr===ke.VerticalAlignment.Sub,il=cr===ke.VerticalAlignment.Super;if(ho||il){const en=re.getSuperSubScale();nt*=en,Ls*=en}const It={textAlign:uo,textAlignLast:uo,...yr,...re.toCSS(E,l,!0),fontSize:nt*ke.getDeviceScale()};Ge||(It.background=void 0),ae&&(It.color=ae.toCSS(E));const ll=yt+Dt;let Ho=be.top+ht.y+0;if(ho&&(Ho+=zo-nt),un){const en=(Wt.x+ll)*l+1,Cn=(Wt.y+Ho)*l+1;Cn<0?It.marginTop=Cn:It.paddingTop=Cn,en<0?(It.width=(yr?.width??0)-en,It.left=(yr?.left??0)+en):It.paddingLeft=en,It.paddingRight=Math.max(0,(yr?.width??0)-Ds*l-en),It.paddingBottom=Math.max(0,(yr?.height??0)-ht.height*l-Cn),It.height=(yr?.height??0)+(Cn<0?-Cn:0),(Cn<0||en<0)&&(It.clipPath=`inset(${Cn<0?-Cn:0}px 0px 0px ${en<0?1-en:0}px)`)}else if(It.left=(Wt.x+ll)*l+1,It.top=(Wt.y+Ho)*l+1,It.width=Wt.width*l,It.height=Wt.height*l,we&&!ze){It.left=(Wt.x+Dt)*l+1,It.top=(Wt.y+(ht.y+0))*l+1;const en=on.centerPoint({x:yt+Dt,y:0,width:dt.width,height:ht.height}),Cn=on.centerPoint({x:yt,y:0,width:An,height:ht.height}),zs=on.rotatePoints([en],we,Cn),Ps={x:zs[0].x-en.x,y:zs[0].y-en.y};It.left=It.left+Ps.x*l,It.top=It.top+Ps.y*l;const $o={...ht,x:yt,y:be.top,width:ht.width+(de+xe)},mc=on.boundsToPoints($o),pc=on.rotatePoints(mc,we),Vo=on.minBoundingRect(pc);$o.width=Vo.width,$o.height=Vo.height;const al=on.centerPoint($o),Wo={x:al.x-Cn.x,y:al.y-Cn.y};It.left=It.left+Wo.x*l,It.top=It.top+Wo.y*l}It.lineHeight=Ls*l+"px";const Bs=Ge?void 0:"text-line";ie.push(ge.jsx("div",{className:sl?`${sl} ${Bs}`:Bs,style:It,...Mn,children:Po},`text-${ht.y}-${Fn}-${In}`))};if(fe.getOverflow()===oe.Overflow.Shrink&&Q>0){let dt=Z?.width??0,Dt=0;for(;dt>1&&dt>Q&&nt>2&&Dt<100;)nt*=Q/dt,dt=C.measureText(Be,nt).width,Dt++;Z={...Z,width:dt}}let Rn=ht.x;Je===oe.HorizontalAlignment.Right?Rn+=Z.width-ht.width:Je!==oe.HorizontalAlignment.Center&&Je!==oe.HorizontalAlignment.CenterContinuous||(Rn+=(Z.width-ht.width)/2),et?.lastRepeatIndex>=0&&(Rn=ht.x);const $n=tt.length;for(let dt=0;dt<$n;dt++){const Dt=tt[dt];(Dt.type===Vt.ParseRunType.Text||Dt.type===Vt.ParseRunType.Repeat)&&(Dt.type,Vt.ParseRunType.Repeat,Xt(Dt,Rn,dt,Ue,Je===oe.HorizontalAlignment.Justify||Je===oe.HorizontalAlignment.Distributed||et?.lastRepeatIndex>=0?Q:ht.width,Ge,{x:Se.x+L,y:Se.y,width:Dt.width,height:Z.height},0,Ve,at)),Rn+=Dt.width}};se?Oe(se,0,{x:0,y:0,...Z},ue.lines[0].baseline,H,!0,null,Re):ue.visitLines({visitTextLine:(Be,Ue,$e)=>{const Ve=Be.runs[0].text.replace(/\s+$/,""),Je=Ue===$e-1;let rt=H===oe.HorizontalAlignment.Justify&&(Je||Be.runs[0].text.endsWith(`
`))?oe.HorizontalAlignment.Left:H,et=0;Ue>0&&(fe.getVertical()===oe.VerticalAlignment.Distributed||fe.getVertical()===oe.VerticalAlignment.Justify)&&(et=Math.max(0,(b-(me+3)-Be.bounds.height*$e)/($e-1)*Ue)),fe.getVertical()===oe.VerticalAlignment.Distributed&&we&&we%90==0&&we%180!=0&&(rt=oe.HorizontalAlignment.Distributed),rt!==oe.HorizontalAlignment.Justify&&rt!==oe.HorizontalAlignment.Distributed&&rt!==oe.HorizontalAlignment.Fill||(Z={...Z,width:Q});let at=ye||x&&(x.repeatChars.length>0||x.spacingChars.length>0)?Z.width:Be.bounds.width;const nt={...Be.bounds,y:Be.bounds.y+et+0,width:at};Oe(Ve,Ue,nt,Y.lines[0].baseline,rt,Je,$e===1?O:null,Ge&&Ue>0?{...Re,style:{...Re.style,background:void 0}}:Re)}})}ie.length>0&&(j=ie)}if(Ge)return j&&j.length>0?j:ge.jsx("div",{style:We,...S});let qe=g?"auto":Le.pointerEvents,De=null;if(Ze){const ze={x:D*l-1,y:-1,width:N*l+1,height:b*l+1};qe="auto",De=w({renderBounds:ze,darkMode:E,className:"filter-button",disabled:!y.isEditAllowed(),zoom:l,filter:y.getColumnFilter(),onFilterButtonMouseDown:m,...p}),De&&(De=ge.jsx("div",{style:{...ze,position:"absolute",zIndex:2,display:"flex",alignItems:"end"},onDoubleClick:Z=>{Z.stopPropagation(),Z.preventDefault()},children:De},"filterButton"))}z&&!j&&(j=ge.jsx("div",{style:{position:"absolute",left:0,right:0,top:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:"..."},"pending-ellipsis"));const Te=[ne,j,r,ee,Xe,De];return ge.jsx("div",{style:{...q,...Le,pointerEvents:qe},...S,children:Te})},Vm={text:"",placeholder:""},Wm=(s,e)=>{if(!s.clean().getStyle().getNumberFormat().endsWith("%"))return!1;const t=e??s.dirty??"";return t.length===0||t.endsWith("%")&&!isNaN(parseFloat(t.substring(0,t.length-1)))},ux=Object.freeze([xn.Delete,xn.Home,xn.End]),dx=T.memo(T.forwardRef((s,e)=>{const{editState:t,onStartEdit:n,onChangeEdit:r,onSubmitEdit:o,onCancelEdit:i,onDoneEdit:l,defaultTextStyle:a,useRichStyling:c=!0,bodyStyle:u,activeCoords:d,sheet:h,commands:f,containerBounds:g,setNaturalDimensions:m,onFocus:p,disabled:w,style:S,zoom:b=1,linesVisible:v,autoFocus:y=!1,..._}=s,{height:C=0,width:E=0}=g??{},x=u?.darkMode??!1,R=T.useRef(null),[I,A]=T.useState(!1),[M,k]=T.useState(null),[F,L]=T.useState(()=>t);T.useEffect(()=>{U.current=!1,L(t)},[t]);const N=T.useMemo(()=>{const Z=F.clean();let Se=Z.getStyle();c||(Se=Se.createTemporaryStyle({font:{size:a?.fontSize}}));const te=Z.getFormula(),ie=Se.getAlignment(),$=te?oe.HorizontalAlignment.Left:ie.getHorizontal(),Y=ie.getVertical(),Q=ie.getOverflow()===oe.Overflow.Wrap||Z.getType()===Me.String&&($===oe.HorizontalAlignment.Justify||$===oe.HorizontalAlignment.Distributed||Y===oe.VerticalAlignment.Justify||Y===oe.VerticalAlignment.Distributed),K=(ue=>{if(!ue)return Vm;const _e=ue.clean();if(!_e)return Vm;let Re=_e.getStyle()?.getQuotePrefix();if(ue.dirty===void 0||ue.dirty===null){let Ne="",Oe=_e.getFormulaText();Oe&&(Ne=Oe,Re=!1),Ne||(Ne=_e.toTextUnformatted(!0)??"");let Be="";if(!ue.editMode&&_e.isSpillOverflow()){const Ue=_e.getSpill();if(Ue){const $e=Ue.getCell(),Ve=$e.getFormulaText();$e.isEqual(_e)||(Be=Ve)}}return Re&&(Ne="'"+Ne),{text:Ne,placeholder:Be}}return{text:ue.dirty??"",placeholder:""}})(F),se=K.text,X=oe.toCSSHorizontalTextAlign(c&&!te?F.clean()?.getRenderHorizontalAlignment():oe.HorizontalAlignment.Left);return{style:Se,isWrapped:Q,textValue:se,formula:te,frameVertAlign:Y,placeholder:K.placeholder,insets:c?Z.getInsets():zr.EmptyRect,textAlign:X}},[F,a,x,b,c]),D=T.useRef(null),O=_r(e,()=>({startEdit:Z=>{R.current=Z?.initialSelection;const Se={...t,editMode:Z?.editMode??!1};Z?.text!==void 0&&(Se.dirty=Z.text),Se.editMode===t.editMode&&Se.dirty===t.dirty||(L(Se),j?.(Se))},submitEdit:()=>ne(),cancelEdit(){ee()},autoFocus(){D.current.focus()},dispatchEvent:Z=>D.current.dispatchEvent(Z),focus(){D.current.focus()},getLineHeight:z}),[n,t]);T.useLayoutEffect(()=>{if(!M||!I)return;const Z=D.current;N.textValue,Z&&Z.setSelectionRange(M.start,M.end,M.direction)},[D.current,M,N.textValue]);const H=T.useMemo(()=>{const Z=F?.clean(),Se=N.style.createTemporaryTextFrame(N.textValue,Z?.getType()===Me.String),te=c?Z.getInsets().right+Z.getInsets().left:0;let ie=null;return N.isWrapped&&(ie={width:E-te}),Se.layout(ie)},[N,E,F,c]),z=Fe(()=>Math.ceil(H?.lines[0]?.bounds.height),[H]);T.useLayoutEffect(()=>{if(!H)return;const Z=N.style,Se=Z.getInsets()??zr.EmptyRect,te=c?Se.left+Se.right:0,ie=c?.04*Z.getFont().getSize():1,$=Math.round(N.isWrapped?void 0:H.bounds.width+te+ie),Y=Math.round(H.bounds.height);m?.({width:$,height:Y})},[H,m,N,c,F]);const j=Fe(r,[r]),q=Fe(Z=>{if(F.dirty===Z)return;const Se={...F};Se.dirty=Z,D.current,L(Se),j?.(Se)},[F]),P=Fe(Z=>{if(F.editMode===Z)return;const Se={...F};Se.editMode=Z,L(Se),j?.(Se)},[F]),U=T.useRef(!1),ne=Fe(()=>{if(U.current)return!1;try{o?.(F),l?.(),U.current=!0}catch{return!1}return!0},[o,F]),ee=Fe(()=>{U.current=!0,L(t),i?.(),l?.()},[i,t]),ve=Fe(Z=>{if(!D.current)return;if(Z.key,Z.isDefaultPrevented(),!(Z.isTrusted||Z.nativeEvent.ctrlKey||Z.nativeEvent.metaKey||Z.nativeEvent.altKey||Z.nativeEvent.isComposing||XS.indexOf(Z.nativeEvent.key)===-1&&Z.nativeEvent.key!=="Backspace")){const K={...F};let se=0;return Wm(K,K.dirty)&&!isNaN(parseFloat(Z.key))?(K.dirty?.endsWith("%")?K.dirty=(K.dirty.substring(0,K.dirty.length-1)??"")+Z.key+"%":K.dirty=(K.dirty??"")+Z.key+"%",se=K.dirty.length-1):Z.nativeEvent.key==="Backspace"?(K.dirty="",se=K.dirty.length):(K.dirty=(K.dirty??"")+Z.key,se=K.dirty.length),D.current.value=K?.dirty,R.current={start:se,end:se,direction:"forward"},D.current?.setSelectionRange(se,se,"forward"),L(K),j?.(K),void Z.preventDefault()}const Se=Z.nativeEvent.ctrlKey,te=Z.nativeEvent.shiftKey,ie=Z.nativeEvent.altKey,$=Z.nativeEvent.metaKey;if(Se&&Z.key==="z"&&Z.stopPropagation(),Z.which===xn.Escape)return Z.preventDefault(),void ee();if(Z.which===xn.F2)return P(!0),void Z.preventDefault();const Y=Z.target;if(Z.key==="%"&&Y.selectionStart===Y.selectionEnd&&Y.value[Y.selectionStart]==="%"&&F?.clean().getStyle().numberFormat.includes("%"))return k({start:Y.selectionStart+1,end:Y.selectionEnd+1,direction:Y.selectionDirection}),void Z.preventDefault();if(Z.which===xn.Enter){if(Z.preventDefault(),$||ie){const K=N.textValue.substring(0,Y.selectionStart)+`
`+N.textValue.substring(Y.selectionEnd);return q(K),void k({start:Y.selectionStart+1,end:Y.selectionStart+1,direction:Y.selectionDirection})}return void(ne()&&h.getSelection().traverse(B.Orientation.Column,te))}if(Z.which===xn.Tab)return Z.preventDefault(),void(ne()&&h.getSelection().traverse(B.Orientation.Row,te));let Q=null;switch(Z.which){case xn.Left:Q=B.Direction.Left;break;case xn.Right:Q=B.Direction.Right;break;case xn.Up:Q=B.Direction.Up;break;case xn.Down:Q=B.Direction.Down}if(Q&&!(Se||te||ie||$)&&!F.editMode)return void ne();F.editMode&&(Q||ux.includes(Z.which))&&Z.stopPropagation()},[F,h,N]),le=T.useCallback(()=>{D.current?.focus(),setTimeout(()=>{D.current?.select()},0)},[]),Ce=T.useCallback(()=>{D.current?.focus(),console.log("implement toggleRelativeReferences")},[]),re=Fe(()=>{const Z=D.current?.value;let Se="";if(d.rowIndex>0){const te=h.getRange({rowIndex:d.rowIndex-1,colIndex:d.colIndex}).getCell();te&&(Se=te.toTextUnformatted(!0))}q(Z+Se)},[d,h]);T.useEffect(()=>h.getRange(d).addListener(()=>{const Z={...F,clean:()=>h.getRange(d).getCell()};L(Z),j?.(Z)}),[d,h,F]);const ae=T.useCallback(()=>{const Z=F.clean().createTemporaryCell({value:Gi(),style:{numberFormat:"Medium Time"}}).toText();q((D.current?.value??"")+Z)},[h]),fe=T.useCallback(()=>{const Z=F.clean().createTemporaryCell({value:Gi(),style:{numberFormat:"Short Date"}}).toText();q((D.current?.value??"")+Z)},[h]),ye=T.useMemo(()=>({element:()=>D.current,doCopy:Z=>{const Se=D.current.value.substring(D.current.selectionStart,D.current.selectionEnd);if(Z?.isCut){const te=D.current.value.substring(0,D.current.selectionStart)+D.current.value.substring(D.current.selectionEnd,D.current.value.length);q(te)}return Se}}),[D.current]),he=T.useMemo(()=>({element:()=>D.current,doPaste:async(Z,Se)=>{const te=await Z.toText?.();if(!te)return!0;const ie=D.current.value.substring(0,D.current.selectionStart)+te+D.current.value.substring(D.current.selectionEnd,D.current.value.length);return q(ie),k({start:D.current.selectionStart+te.length,end:D.current.selectionStart+te.length,direction:"forward"}),!0}}),[D.current]),we=T.useMemo(()=>({contains:Z=>D.current?.contains(Z)||!1,focus(){D.current.focus()}}),[]),be=T.useMemo(()=>[new ot("selectAll",we,{label:"Select All",description:"Select all of the text in cell.",shortcut:{key:"a",modifiers:[Ae.Ctrl]}},le),new ot("startEditValueAbove",we,{label:"Copy From Above",description:"Copy the value from the cell above the active cell into the cell or the formula bar.",shortcut:[{key:'"',modifiers:[Ae.Ctrl]},{key:'"',modifiers:[Ae.Ctrl,Ae.Shift]}]},re),new ot("startEditCurrentTime",we,{label:"Current Time",description:"Insert the current time.",shortcut:{key:"Semicolon",modifiers:[Ae.Ctrl,Ae.Shift]}},ae),new ot("startEditCurrentDate",we,{label:"Current Date",description:"Insert the current date.",shortcut:{key:"Semicolon",modifiers:[Ae.Ctrl]}},fe),new Ee("relativeReferencesToggle",we,{label:"Toggle References",description:"Toggles cell references from relative to absolute, to partially absolute, back to relative again.",shortcut:{key:"F4"}},Ce),new Ee("toggleEditorFocus",we,{label:"Toggle Editor Focus",description:"Moves focus between editors such as formula editor and inline editor.",shortcut:{key:"F2",modifiers:[Ae.Ctrl]}})],[]),me=T.useMemo(()=>{let Z=null;const Se=()=>({contains:te=>D.current?.contains(te)||!1,focus(){D.current.focus()}});return Z=f?f.createChildGroup(Se,"editor",!1):new Qa(Se,"editor"),Z.addCommands(be,!0),Z},[f,be]),de=T.useMemo(()=>({notifier:null,source:ye,target:he,commands:me}),[ye,he,me]);Tp(de);const[xe,Le]=T.useState(!y);T.useEffect(()=>{Le(!1)},[]);const W=Fe(Z=>{A(!0),me?.activate();const Se=R.current;if(Se!==!1){let te,ie;const $=D.current.value;Wm(F,$)&&(te=$.length-1,ie=$.length-1),te=Se?.start??te??$.length,ie=Se?.end??ie??$.length,R.current=!1,k({start:te,end:ie,direction:"forward"})}p?.(Z)},[p,F]),Ze=N.insets;let Xe=Ze.left+1;const Ge=Ze.left+Ze.right+2-1,ce=H?.bounds.height??0;let We,qe=Ze.top;N.frameVertAlign===oe.VerticalAlignment.Center?qe=Math.max(0,(C-(Ze.top+Ze.bottom)-ce)/2):N.frameVertAlign===oe.VerticalAlignment.Bottom&&(qe=Math.max(0,C-(Ze.top+Ze.bottom)-ce)),v!==void 0&&H?.lines[0]?.bounds&&(We=H?.lines[0]?.bounds.height*v);const De=N.style.getFont();let Te=De.getSize();De.isSuperSub()&&(Te*=De.getSuperSubScale()),Te*=ke.getDeviceScale()*b;const ze=c?De.toCSS(x,b):null;return ge.jsx("div",{className:"sheet-cell-editor",onMouseDown:Z=>{D.current&&document.activeElement!==D.current&&requestAnimationFrame(()=>{D.current.focus()})},ref:O,..._,style:{display:"flex",flexGrow:1,alignSelf:"stretch",height:"100%",width:"100%",maxWidth:"100%",maxHeight:"100%",cursor:"initial",...S},children:ge.jsx("div",{className:"editor-placement",style:{display:"flex",flexGrow:1,position:"relative",top:qe*b+1,left:Xe*b,width:`calc(100% - ${Ge*b}px)`,maxWidth:`calc(100% - ${Ge*b}px)`,height:(We??ce)*b,maxHeight:(We??ce)*b},children:ge.jsx("textarea",{spellCheck:"false",placeholder:N.placeholder,ref:D,value:N.textValue,disabled:xe,readOnly:w||h.getProtection().isReadOnly(),name:"sheet-cell-editor",autoComplete:"off",autoCapitalize:"off",style:{flex:"1 1 100%",font:"inherit",...ze,fontSize:Te?`${Te}px`:"inherit",textAlign:N.textAlign,lineHeight:(H?.lines[0]?.bounds.height??0)*b+"px",height:(H?.bounds.height??0)*b,boxSizing:"border-box",padding:"0px",margin:"0px",borderWidth:0,outline:"none",resize:"none",overflow:"hidden",background:"transparent",maxHeight:"100%",maxWidth:"100%",width:"100%",userSelect:"text",position:"absolute",whiteSpace:N.isWrapped?"normal":"pre",wordWrap:"break-word"},onFocus:W,onBlur:()=>{A(!1)},onSelect:Z=>{},onChange:Z=>{D.current&&!U.current&&(R.current=!1,q(Z.target.value),N.textValue,Z.target.value,Z.target.selectionStart,Z.target.selectionEnd,Z.target.selectionDirection,k({start:Z.target.selectionStart,end:Z.target.selectionEnd,direction:Z.target.selectionDirection}))},onMouseDown:Z=>{I&&P(!0)},onKeyDown:ve})})})})),hx=(s,e)=>({clean:s,dirty:e,editMode:!1}),gx=s=>{const{length:e=0,width:t=1,dashArray:n=null,dashArrayAdditional:r=null,isDouble:o=!1,isAngled:i=!1,offsetX:l=0,offsetY:a=0,isVertical:c=!1,...u}=s,d=S=>{let b=null;if(S&&t>0){b="";for(let v=0;v<S.length;v++)b+=S[v],v<S.length-1&&(b+=",")}return b},h=d(n);let f=h;r&&(f=d(r));let g=t,m=e,p=null;if(o){g=Math.floor(t/2);const S=g+g/2+1;let b=null;b=c?`M ${wt.boundPixel(l+S)} ${wt.boundPixel(a)} L ${wt.boundPixel(l+S)} ${wt.boundPixel(a+m)}`:`M ${wt.boundPixel(l)} ${wt.boundPixel(a+S)} L ${wt.boundPixel(l+m)} ${wt.boundPixel(a+S)}`,p=ge.jsx("path",{strokeWidth:g,strokeDasharray:f,d:b,...u})}if(i){g=t/2;const S=g+g/2;let b=f,v=null;v=c?`M ${wt.boundPixel(l+S)} ${wt.boundPixel(a)} L ${wt.boundPixel(l+S)} ${wt.boundPixel(a+m)}`:`M ${wt.boundPixel(l)} ${wt.boundPixel(a+S)} L ${wt.boundPixel(l+m)} ${wt.boundPixel(a+S)}`,p=ge.jsx("path",{strokeWidth:g,strokeDasharray:b,strokeDashoffset:"1",shapeRendering:"crispEdges",d:v,...u})}let w=null;return w=c?`M ${wt.boundPixel(l+g/2)} ${wt.boundPixel(a)} L ${wt.boundPixel(l+g/2)} ${wt.boundPixel(a+m)}`:`M ${wt.boundPixel(l)} ${wt.boundPixel(a+g/2)} L ${wt.boundPixel(l+m)} ${wt.boundPixel(a+g/2)}`,ge.jsxs(ge.Fragment,{children:[ge.jsx("path",{strokeWidth:g,strokeDasharray:h,d:w,...u}),p]})};function Hu(s,e){if(typeof s=="function")return s(e);s&&(s.current=e)}var ks=parseInt(T.version.split(".")[0],10)>=19?function(s){return e=>{const t=[];for(const n of s){const r=Hu(n,e),o=typeof r=="function";t.push(o?r:()=>Hu(n,null))}return()=>{for(const n of t)n()}}}:function(s){return e=>{for(const t of s)Hu(t,e)}},fx=function(){},Gw=typeof window<"u",Ii=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mx=Gw?T.useLayoutEffect:T.useEffect,jm={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};const ko=Gw&&window.ResizeObserver!==void 0?function(){var s=T.useState(null),e=s[0],t=s[1],n=T.useState(jm),r=n[0],o=n[1],i=T.useMemo(function(){return new window.ResizeObserver(function(l){if(l[0]){var a=l[0].contentRect,c=a.x,u=a.y,d=a.width,h=a.height,f=a.top,g=a.left,m=a.bottom,p=a.right;o({x:c,y:u,width:d,height:h,top:f,left:g,bottom:m,right:p})}})},[]);return mx(function(){if(e)return i.observe(e),function(){i.disconnect()}},[e]),[t,r]}:function(){return[fx,jm]},px=(s,e)=>s.colStart===e.colStart?s.rowStart-e.rowStart:s.colStart-e.colStart,wx=(s,e)=>s.rowStart===e.rowStart?s.colStart-e.colStart:s.rowStart-e.rowStart,Sx=s=>{const{key:e,points:t,range:n,stroke:r,darkMode:o,forceThinBorder:i=!1,shiftIfWide:l=!1,isVertical:a=!1,intersections:c,layout:u}=s,d=pe.BuiltInDefinitions.get(i?pe.StrokeStyle.Thin:r.getStyle());if(!d)return null;const h=t[0],f=t[1],g=t[2],m=t[3];let p=1+(a?m-f:g-h),w=0;const S=r.getColor().toRGBA(o).toString(),b=d.description.toLowerCase().includes("double");let v,y;const _=a?"rowStart":"colStart",C=a?"rowEnd":"colEnd",E=a?f:h;if(c?.length>0){const A=c[0];if(A?.range[_]===n[_]){const M=pe.BuiltInDefinitions.get(A.stroke.getStyle());w=Math.floor(M.width/2)}if(c[c.length-1]?.range[C]===n[C]){const M=pe.BuiltInDefinitions.get(c[c.length-1].stroke.getStyle());p=Math.floor(p+(M.width===2?0:M.width/2))}if(b){const M=a?"colStart":"rowStart",k=a?"colEnd":"rowEnd",F=a?u?.getRowOffset:u?.getColOffset;let L=0,N=0;v=[],y=[];for(let D=0;D<c.length;D++){const O=c[D];if(O.stroke.getStyle()===pe.StrokeStyle.Double&&F){const H=F(O.range[_])-(E-w);O.range[M]<n[M]&&(v.push(H-L),L=H,v.push(1),L++),O.range[k]>n[k]&&(y.push(H-N),N=H,y.push(1),N++)}}v.length>0&&L<p&&v.push(p-L),y.length>0&&N<p&&y.push(p-N)}}let x=a?-Math.floor(d.width/2):-w,R=a?-w:-Math.floor(d.width/2);const I=l&&d.width>2?-1:0;return ge.jsx(gx,{offsetX:h+x+I,offsetY:f+R+I,length:p+w,isVertical:a,stroke:S,width:d.width,dashArray:v??d.pattern,dashArrayAdditional:y,isDouble:b,isAngled:d.description.toLowerCase().includes("slant")},e)},Uw=({getBorderAt:s,borderRenderer:e=Sx,getVisibleCells:t,darkMode:n,forceThinBorder:r=!1,defaultColor:o="black",shiftIfWide:i=!1})=>{const l=Fe(t,[t]);return{overlay:T.useMemo(()=>a=>{const c=a.toClipBounds(a.getRangeCoordsBounds(),-3);if(!c)return;const u=l(a);if(u.length===0)return;const d=a.getVisibleColumnOffsets(),h=a.getVisibleRowOffsets();let f=[],g=[];const m=a.getVisibleColumns(),p=a.getVisibleRows(),w=[],S=[],b=[],v=(E,x,R,I,A,M,k)=>{const F={index:I,stroke:A,visibleIndex:R,edge:M,length:k};E[x]||(E[x]=[]),E[x].length>0&&E[x][E[x].length-1]?.index===I?E[x][E[x].length-1]=F:E[x].push(F)};for(let E=0;E<u.length;E++){const x=u[E],R=x.coords;if(!R)continue;const I=x?.range??{rowStart:R.rowIndex,colStart:R.colIndex,rowEnd:R.rowIndex,colEnd:R.colIndex},A=a.getVisibleRangeCoords();if(!J.isRangesIntersect(I,A)&&!J.isRangeWithinRange(I,A))continue;const M=R.colIndex,k=R.rowIndex,F=d[M],L=h[k];if(I.rowEnd!==I.rowStart){const ee=h[I.rowStart]?.spanIndex??-1,ve=h[I.rowEnd]?.spanIndex??h[p[p.length-1]].spanIndex+1;f.push({...I,rowStart:ee,rowEnd:ve})}if(I.colEnd!==I.colStart){const ee=d[I.colStart]?.spanIndex??-1,ve=d[I.colEnd]?.spanIndex??d[m[m.length-1]].spanIndex+1;g.push({...I,colStart:ee,colEnd:ve})}const N=x.value,D=s(N,E);if(!D||D.isEmpty())continue;const O=D.getLeft(),H=D.getTop(),z=D.getRight(),j=D.getBottom();let q=1,P=1;if(!F||!L)continue;const U=F.spanIndex,ne=L.spanIndex;O.isNone()||v(w,U,ne,k,O,pe.Edge.Left,q),H.isNone()||v(S,ne,U,M,H,pe.Edge.Top,P),z.isNone()||v(w,U+P,ne,k,z,pe.Edge.Right,q),j.isNone()||v(S,ne+q,U,M,j,pe.Edge.Bottom,P)}const y=(E,x,R)=>{const I=[];return E.forEach((A,M)=>{let k=null;A.sort((F,L)=>F.visibleIndex-L.visibleIndex);for(let F=0;F<A.length;F++){const L=A[F];if(!L?.stroke||x[M]===void 0&&x[M-1]===void 0)continue;let N=!1;if(R)for(let z=0;!N&&z<f.length;z++){let j=f[z];j.colStart<=L.index&&j.colEnd>=L.index&&j.rowStart<M&&j.rowEnd>=M&&(N=!0)}else for(let z=0;!N&&z<g.length;z++){let j=g[z];j.rowStart<=L.index&&j.rowEnd>=L.index&&j.colStart<M&&j.colEnd>=M&&(N=!0)}if(N)continue;const D=L.stroke?.getColor(),O=D?D.toRGBA().toString():o,H=L.stroke.getStyle()+":"+O;(H!==k?.key||k&&k.visibleIndex+1<L.visibleIndex)&&(k&&I.push(k),k={key:H,index:x[M]??x[M-1]+1,visibleIndex:L.visibleIndex,edge:L.edge,stroke:L.stroke,from:L.index,to:L.index+L.length-1,intersections:[],length:1}),k.to=L.index+L.length-1,k.visibleIndex=L.visibleIndex}k&&I.push(k)}),I};f=f.sort(wx),g=g.sort(px);const _=y(w,m,!1),C=y(S,p,!0);if(_.length===0&&C.length===0)return null;for(let E=0;E<C.length;E++){const x=C[E];let R=V.findEqualOrGreater(_,x.from,A=>A.index),I=!1;for(;!I;){const A=_[R++];A&&A.index>=x.from&&A.index<=x.to+1&&A.from<=x.index&&A.to+1>=x.index&&(x.intersections.push({stroke:A.stroke,range:{rowStart:A.from,rowEnd:A.to+1,colStart:A.index,colEnd:A.index}}),A.intersections.push({stroke:x.stroke,range:{rowStart:x.index,rowEnd:x.index,colStart:x.from,colEnd:x.to+1}})),I=!A||A.index>x.to+1}}for(let E=0;E<C.length;E++){const x=C[E];let R=x.stroke;const I=`rBorder:${x.index}:${x.from}:${x.to}:${x.edge}`,A={rowStart:x.index,rowEnd:x.index,colStart:x.from,colEnd:x.to+1},M=a.getLayout(),k=!1,F=M.getColOffset(A.colStart),L=M.getRowOffset(A.rowStart),N=[F,L,M.getColOffset(A.colEnd),L];b.push(e({key:I,points:N,stroke:R,darkMode:n,forceThinBorder:r,shiftIfWide:i,range:A,intersections:x.intersections,layout:M,isVertical:k}))}for(let E=0;E<_.length;E++){const x=_[E];let R=x.stroke;const I=`cBorder:${x.index}:${x.from}:${x.to}:${x.edge}`,A={rowStart:x.from,rowEnd:x.to+1,colStart:x.index,colEnd:x.index},M=a.getLayout(),k=!0,F=M.getColOffset(A.colStart),L=[F,M.getRowOffset(A.rowStart),F,M.getRowOffset(A.rowEnd)];b.push(e({key:I,stroke:R,points:L,darkMode:n,forceThinBorder:r,shiftIfWide:i,range:A,intersections:x.intersections,layout:M,isVertical:k}))}return ge.jsx("svg",{width:`${c.width}`,height:`${c.height}`,viewBox:`0 0 ${c.width} ${c.height}`,preserveAspectRatio:"none",shapeRendering:"crispEdges",style:{position:"absolute",left:"0px",top:"0px",width:`${c.width}px`,height:`${c.height}px`,pointerEvents:"none",transitionTimingFunction:"linear",transitionDelay:"0",transitionProperty:"left, top, width, height",willChange:"left, top, width, height, stroke-dashoffset",overflow:"visible"},children:b},"borders")},[s,n])}},Gm=Et.Center,_x=Object.freeze({horizontal:!1,vertical:!1}),Um=zr.EmptyTopLeft,yx=(s,e)=>J.EmptyCell,bx=(s,e)=>new Promise((t,n)=>{n("StaticBorderRenderer does not support scrolling")}),qR=T.memo(s=>{const{getBorderAt:e,width:t,height:n,style:r,rowCount:o=2,columnCount:i=2,darkMode:l,forceThinBorder:a,children:c,...u}=s,d=T.useRef(null),[h,{width:f,height:g}]=ko(),m=t??f,p=n??g,w=T.useMemo(()=>{const F=[];for(let L=0;L<o;L++)for(let N=0;N<i;N++){const D={colIndex:N,rowIndex:L};F.push({coords:D,value:D})}return F},[]),S=T.useCallback(F=>w,[w]),{overlay:b}=Uw({getVisibleCells:S,getBorderAt:e,darkMode:l,forceThinBorder:a}),v=Math.floor(m/i),y=Math.floor(p/o),_={getColOffset:F=>Math.ceil(F*v)+0,getRowOffset:F=>Math.ceil(F*y)+0,getColIndex:F=>Math.floor((F-0)/v)-1,getRowIndex:F=>Math.floor((F-0)/y)-1},C={rowStart:0,colStart:0,rowEnd:o,colEnd:i},E={x:0,y:0,width:Math.max(0,m)+0,height:Math.max(0,p)+0},x=T.useMemo(()=>{const F={},L=Math.floor(m/i);for(let N=0;N<i;N++)F[N]={offset:N*L,size:L,spanIndex:N};return F},[m,p]),R=T.useMemo(()=>{const F={},L=Math.floor(p/o);for(let N=0;N<o;N++)F[N]={offset:N*L,size:L,spanIndex:N};return F},[m,p]);if(!b)return null;const I={width:m,height:p},A={width:m,height:p},M={getStage:()=>d.current,getTotalSize:()=>I,getViewportSize:()=>A,getLayout:()=>_,getCellCoordsAsRangeCoords:J.cellToRange,getVisibleRangeCoords:()=>C,getVisibleRows:()=>{const F=[];for(let L=0;L<o;L++)F.push(L);return F},getTotalRangeCoords:()=>C,getRelativePointFromClient:(F,L)=>({x:F,y:L}),getVisibleColumns:()=>{const F=[];for(let L=0;L<i;L++)F.push(L);return F},toClipBounds:(F,L)=>E,toViewBounds:F=>F,toAbsoluteBounds:F=>F,getBounds:()=>E,getInsets:()=>null,getRangeCoordsBounds:(F,L)=>null,getVisibleColumnOffsets:()=>x,getVisibleRowOffsets:()=>R,allViews:()=>({[Gm]:M}),getAnchor:()=>Gm,getZoom:()=>1,scrollCellCoordsIntoView:bx,getCellCoordsFromClient:yx,getScrollOrientation:()=>_x,getScrollTopLeft:()=>Um,getFreezeTopLeft:()=>Um},k=b(M);return ge.jsxs("div",{style:{...r,position:"relative",display:"flex"},...u,children:[ge.jsx("div",{ref:ks([d,h]),style:{flex:"1 1 100%",display:"flex",maxWidth:"100%",maxHeight:"100%"},children:c}),k]})});function qw(s){var e,t,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var r=s.length;for(e=0;e<r;e++)s[e]&&(t=qw(s[e]))&&(n&&(n+=" "),n+=t)}else for(t in s)s[t]&&(n&&(n+=" "),n+=t);return n}function Nn(){for(var s,e,t=0,n="",r=arguments.length;t<r;t++)(s=arguments[t])&&(e=qw(s))&&(n&&(n+=" "),n+=e);return n}const vx="_sheetxl-sheet_1qeq6_5",Cx="_viewport-overlay_1qeq6_6",xx=s=>{const{style:e,...t}=s??{};return ge.jsxs("svg",{style:{width:"135px",height:"37px",...e},viewBox:"0 0 135 37",...t,children:[ge.jsx("path",{d:"M 1.0984,0 C 0.4978,0 0.01,0.40548 0.01,0.90302 v 19.5766 H 0 v 15.61762 c 0,0.30574 0.185,0.57535 0.466,0.73886 v 0.1426 H 0.8565 C 0.9315,36.992 1.0086,37 1.0883,37 H 13.063 25.9706 v 0 h 8.7553 c 0.08,0 0.1563,-0.008 0.2308,-0.0213 h 0.054 v -0.0141 c 0.4621,-0.10457 0.8035,-0.45175 0.8035,-0.86739 v -15.312 c 0,-0.0328 0.01,-0.0658 0.01,-0.0995 V 0.90304 C 35.8242,0.4052 35.3363,6e-5 34.7358,6e-5 H 22.5969 V 1.7e-4 H 21.0014 V 6e-5 Z",fill:"#547dbe",fillRule:"evenodd"}),ge.jsx("path",{d:"M 1.4849,2.09543 V 9.06408 H 8.1947 V 2.09543 Z m 8.6592,0 V 9.06408 H 16.854 V 2.09543 Z m 8.685,0 v 6.96865 h 6.7098 V 2.09543 Z m 8.7355,0 v 6.96865 h 6.7099 V 2.09543 Z M 1.4849,11.04391 v 6.81444 h 6.7098 v -6.81444 z m 8.6592,0 v 6.81444 h 6.7099 v -6.81444 z m 8.685,0 v 6.81444 h 6.7098 v -6.81444 z m 8.7355,0 v 6.81444 h 6.7099 V 11.04391 Z M 1.4849,19.83872 v 6.68584 h 6.7098 v -6.68584 z m 8.6592,0 v 6.68584 h 6.7351 v -6.68584 z m 8.685,0 v 6.68584 h 6.7098 v -6.68584 z m 8.7355,0 v 6.68584 h 6.7099 v -6.68584 z m -26.052,8.38811 v 6.68588 h 6.7098 v -6.68588 z m 8.6592,0 v 6.68588 h 6.7355 v -6.68588 z m 8.685,0 v 6.68588 h 6.7099 v -6.68588 z m 8.7356,0 v 6.68588 h 6.7098 v -6.68588 z",fill:"#ffffff",fillRule:"evenodd"}),ge.jsx("path",{d:"m 1.4785,2.09737 v 6.96865 h 6.741 V 2.09737 Z m 0,8.94851 v 6.81449 h 6.741 v -6.81449 z m 0,8.79485 v 6.6858 h 6.741 v -6.6858 z m 0.028,8.388 v 6.68588 h 6.741 v -6.68588 z",fill:"#547dbe",fillRule:"evenodd",strokeWidth:"0.4"}),ge.jsx("path",{d:"M 120.9895,32.82218 V 10.13469 h 4.7986 v 18.71559 h 9.2153 v 3.9719 z m 0.4853,0 h -5.4976 l -5.275,-8.57923 -5.2751,8.57923 h -5.1481 l 7.5314,-11.69325 -7.0545,-10.99424 h 5.3067 l 4.8936,8.16618 4.7986,-8.16618 h 5.1796 l -7.118,11.24826 z M 95.9361,29.04099 c 0.5297,0 1.0381,-0.053 1.5254,-0.15888 0.4872,-0.10591 0.9745,-0.23299 1.4617,-0.3813 v 3.52703 c -0.5084,0.21183 -1.144,0.39189 -1.9066,0.54018 -0.7415,0.16946 -1.5571,0.2542 -2.4469,0.2542 -1.038,0 -1.9701,-0.16947 -2.7964,-0.5084 -0.805,-0.33894 -1.4511,-0.92148 -1.9384,-1.74763 -0.466,-0.84734 -0.6991,-2.01241 -0.6991,-3.49526 v -8.35686 h -2.2562 v -2.00181 l 2.6058,-1.58876 1.3664,-3.65411 h 3.0189 v 3.6859 h 4.8619 v 3.55878 h -4.8619 v 8.35686 c 0,0.65668 0.1906,1.15449 0.5719,1.49342 0.3814,0.31776 0.8792,0.47664 1.4935,0.47664 z M 79.1445,14.83743 c 2.3939,0 4.29,0.68847 5.6882,2.06535 1.3983,1.35581 2.0972,3.29411 2.0972,5.81491 v 2.28769 H 75.7444 c 0.042,1.33475 0.4342,2.38315 1.1758,3.14596 0.7626,0.76244 1.8113,1.14385 3.1459,1.14385 1.1227,0 2.1396,-0.10609 3.0506,-0.3179 0.9109,-0.23311 1.8536,-0.58257 2.8283,-1.0484 v 3.654 c -0.8476,0.42362 -1.7479,0.73087 -2.7012,0.92139 -0.9322,0.21181 -2.0655,0.3179 -3.4001,0.3179 -1.7373,0 -3.2731,-0.3179 -4.6078,-0.95333 -1.3346,-0.65673 -2.3833,-1.64162 -3.1459,-2.95507 -0.7627,-1.31344 -1.144,-2.96571 -1.144,-4.9568 0,-2.03367 0.3389,-3.71788 1.0169,-5.05235 0.6991,-1.35578 1.6629,-2.37258 2.8917,-3.0504 1.2286,-0.67783 2.6586,-1.0168 4.2899,-1.0168 z m 0.032,3.36815 c -0.911,0 -1.6736,0.29653 -2.2879,0.88967 -0.5933,0.59322 -0.9428,1.51461 -1.0487,2.76455 h 6.6415 c -0.021,-1.05904 -0.2967,-1.92796 -0.8262,-2.60567 -0.5297,-0.69905 -1.3559,-1.04855 -2.4787,-1.04855 z m -17.011,-3.36815 c 2.3939,0 4.29,0.68847 5.6882,2.06535 1.3982,1.35581 2.0973,3.29411 2.0973,5.81491 v 2.28769 H 58.7653 c 0.042,1.33475 0.4343,2.38315 1.1758,3.14596 0.7627,0.76244 1.8113,1.14385 3.1459,1.14385 1.1228,0 2.1397,-0.10609 3.0507,-0.3179 0.911,-0.23311 1.8536,-0.58257 2.8282,-1.0484 v 3.654 c -0.8475,0.42362 -1.7478,0.73087 -2.7011,0.92139 -0.9321,0.21181 -2.0655,0.3179 -3.4002,0.3179 -1.7372,0 -3.273,-0.3179 -4.6077,-0.95333 -1.3347,-0.65673 -2.3833,-1.64162 -3.1459,-2.95507 -0.7627,-1.31344 -1.144,-2.96571 -1.144,-4.9568 0,-2.03367 0.3389,-3.71788 1.0168,-5.05235 0.6991,-1.35578 1.6631,-2.37258 2.8918,-3.0504 1.2287,-0.67783 2.6587,-1.0168 4.2899,-1.0168 z m 0.032,3.36815 c -0.911,0 -1.6736,0.29653 -2.288,0.88967 -0.5931,0.59322 -0.9427,1.51461 -1.0486,2.76455 h 6.6414 c -0.021,-1.05904 -0.2965,-1.92796 -0.8262,-2.60567 -0.5297,-0.69905 -1.3558,-1.04855 -2.4786,-1.04855 z M 41.7033,13.59817 c 0,0.84739 -0.032,1.66288 -0.095,2.44668 -0.042,0.78385 -0.085,1.33456 -0.1271,1.65231 h 0.2542 c 0.5508,-0.88968 1.2605,-1.53575 2.1291,-1.93827 0.8686,-0.40251 1.8325,-0.60371 2.8917,-0.60371 1.8855,0 3.3896,0.50838 4.5124,1.52518 1.144,0.99558 1.716,2.60556 1.716,4.82998 V 32.82218 H 48.2498 V 22.68575 c 0,-2.49951 -0.9322,-3.74937 -2.7964,-3.74937 -1.4194,0 -2.4045,0.49788 -2.9553,1.49362 -0.5297,0.97424 -0.7945,2.38314 -0.7945,4.22592 v 8.16626 H 36.9688 V 8.67305 h 4.7348 z",fill:"#eb594d"}),ge.jsx("path",{d:"m 23.345,4.88926 c 1.4307,0 2.8282,0.229 4.1916,0.68692 1.3636,0.45803 2.6999,1.15712 4.0084,2.09748 l -1.8344,2.50966 C 28.6222,9.40175 27.5522,8.82162 26.5004,8.44306 25.4486,8.0645 24.3968,7.87524 23.345,7.87524 c -1.9935,0 -3.5435,0.40902 -4.6503,1.22728 -1.1068,0.81819 -1.6601,1.97842 -1.6601,3.48048 v 0.0183 c 0,1.05019 0.3179,1.8502 0.9538,2.39973 0.636,0.54952 1.4615,0.95869 2.4765,1.22731 1.015,0.26862 2.0975,0.51907 3.2468,0.75111 1.003,0.20755 1.9996,0.44872 2.9905,0.7235 0.9905,0.27478 1.8922,0.66562 2.7057,1.1724 0.813,0.50679 1.4615,1.1937 1.9444,2.06075 0.4832,0.86705 0.7247,1.99672 0.7247,3.38884 v 0.0367 c 0,2.45464 -0.8561,4.35355 -2.5682,5.69703 -1.7122,1.34311 -4.1216,2.01505 -7.2278,2.01505 -1.2963,0 -2.5162,-0.12207 -3.6598,-0.36658 -1.1434,-0.24413 -2.2134,-0.61071 -3.2102,-1.09898 -0.9968,-0.48864 -1.9292,-1.09897 -2.7975,-1.83175 l 1.9628,-2.47308 c 1.0763,0.92809 2.2534,1.62428 3.5314,2.08825 1.2779,0.46431 2.669,0.69627 4.1733,0.69627 2.1158,0 3.7513,-0.40613 4.9071,-1.21827 1.1558,-0.81214 1.7335,-1.95096 1.7335,-3.4164 v -0.0183 c 0,-1.06247 -0.2872,-1.87762 -0.8622,-2.44543 -0.5746,-0.56786 -1.3267,-0.99528 -2.2563,-1.28234 -0.9292,-0.28695 -1.9383,-0.52812 -3.0267,-0.72354 -1.0397,-0.18314 -2.0822,-0.39685 -3.1278,-0.64117 -1.0457,-0.24417 -2.0026,-0.60444 -2.8709,-1.08076 -0.8683,-0.47621 -1.5685,-1.15396 -2.1005,-2.0333 -0.532,-0.87933 -0.798,-2.05162 -0.798,-3.5171 v -0.0183 c 0,-2.4792 0.8255,-4.39955 2.4766,-5.7611 1.651,-1.36167 3.9807,-2.04258 6.9892,-2.04258 z",stroke:"#eb594d",strokeWidth:"2",fill:"#f9cecb"})]})},Ex=T.memo(s=>{const{colorLicensee:e="blue",colorError:t="red",colorCredits:n="grey",credits:r="All rights reserved - Michael Ford",feature:o,style:i,...l}=s??{},[a,c]=T.useState(null);ut.useEffect(()=>{(async()=>{const y=await ec.getDetails();c(y)})()},[]);const[u,d]=ut.useState(!1),h={opacity:.65},f=ut.useMemo(()=>{const y=a?.exceptions(),_=y?.length??0;if(_===0)return null;const C=[];for(let E=0;E<_;E++){const x=y[E];C.push(ge.jsx("div",{style:{opacity:.8,fontSize:"16px",textAlign:"left",color:t},children:x},E))}return C},[a,t]);if(a===null||a.isValidFor(o))return null;const g=a.type(),m=!f&&g.endsWith("ity"),p=a.licensee(),w=m?1.6:1,S=135/w,b=37/w;let v=null;return!g&&p?.length>0&&(v=ge.jsx("div",{style:{opacity:.7,fontWeight:"500",fontSize:"16px",textAlign:"left",color:e},children:p})),ge.jsx("div",{style:{pointerEvents:"none",display:"flex",flexDirection:"column",overflow:"hidden",...i},...l,children:ge.jsxs("div",{style:{position:"relative",display:"flex",flexDirection:"column"},children:[u?ge.jsx(xx,{style:h}):ge.jsx("svg",{width:S,height:b,style:h,children:ge.jsx("image",{style:{width:S,height:b},href:"https://www.sheetxl.com/watermark.svg",onError:()=>d(!0)})}),ge.jsxs("div",{children:[v,f,ge.jsx("div",{style:{height:"0px",fontSize:"16px",textAlign:"left",width:"0px",opacity:.8,color:n},children:r})]})]})})}),Rt=(s,e,t)=>{const n=T.useRef(e);n.current=e;const r=t?.fireOnModelChange??!0;T.useEffect(()=>{if(!s||!n.current)return;const o=Object.keys(n.current),i={},l=o.length;for(let c=0;c<l;c++){const u=o[c];i[u]=(d,h)=>{n.current[u]?.(d,h)}}const a=s.addListeners(i,t);if(r)for(let c=0;c<l;c++)i[o[c]](s);return()=>{a?.()}},[s])},JR=(s,e,t,n)=>{const r=T.useRef(t);r.current=t,T.useEffect(()=>{if(!s||!e||!r.current){const l={getSource:()=>null,trigger:"delete",isDataChange:!1,isTransactional:!1,isUndo:!1,timeStamp:Date.now()};return void r.current?.(l)}const o=l=>{r.current?.(l)},i=s.getRange(e).addListener(o,n);{const l=s.getRange(e);o({getSource:()=>l,trigger:"modelChange",isDataChange:!1,isTransactional:!1,isUndo:!1,timeStamp:Date.now()})}return()=>{i?.()}},[s,e])},Vl=new $t("transparent");function Rx(s){const{sheet:e,onRepeatCommandChange:t,bodyStyle:n,commands:r,target:o,notifier:i,onStartEdit:l,getViewport:a}=s,[c,u]=T.useState(null),[d,h]=T.useState(null),f=T.useRef(null),g=Fe(l,[l]),m=Fe(a,[a]),[p,w]=T.useState(),[S,b]=T.useState(()=>e?.getStyles().parseColor(G.Scheme.Bg2)),[v,y]=T.useState(()=>e?.getStyles().getNormal().getFont().getFill()),_=Fo();T.useRef(_.getMode()).current=_.getMode();const C=HS(),[E,x]=T.useState(V.EmptyArray),R=T.useCallback(()=>{if(f.current!==e)return;const $=e.getSelectedRanges();let Y=null;E.length>0&&J.isCellWithinRange(c,E[0].getRange().getCoords())&&(Y=E[0]);const Q=e?.getSelectedCell(),K=Q?.getCoords()??null;Eo.unstable_batchedUpdates(()=>{H(Y),u(K),h($)})},[e,E,d,c]),I=T.useCallback(V.debounce(R,210),[R]);T.useEffect(()=>{f.current=e,R()},[e]);const A=Fe(()=>e.getRange(c).getCell(),[e,c]),M=Fe(async($,Y,Q=null,K=!1,se=!0)=>{const X=$?.label?.(),ue=async()=>{const Oe=await Promise.resolve(se&&i?.showBusy?.(X??"Busy..."));try{await e.doBatch(async()=>Y(e),X),K&&_.setMode(null),Oe&&Oe()}catch(Be){if(Oe&&Oe(),!Be)return;i?.showError?.(Be)}},_e=[];let Re=!1;const Ne=async()=>(_e.push(ue),(async()=>{if(!Re){for(Re=!0;_e.length>0;){const Oe=_e.shift();Oe&&await Oe()}Re=!1}})());if(t){let Oe=null;if(Q!==!1&&$){const Be=Q??X;Oe=new ot($.key(),o,{label:Be,description:Be},Ne)}t(Oe)}return Ne()},[e,t,i]),k=Fe(($,Y,Q=!1,K)=>M($,se=>{const X=se.getSelectedRanges();Q&&X.updateStyle(null,K),X.updateStyle(Y,K),X.autoFit({expandOnly:B.Orientation.Column,minContent:!0,skipCustomSize:!0})}),[e]),F=Fe(($,Y,Q)=>{M($,K=>{let se=Y;(Q||Y?.address)&&(se=se??{},!Q&&Y?.address?.startsWith("#")?Q=Y?.address.substring(1):Q&&(se.displayText=Q)),K.getSelectedRange().setHyperlink(se)})},[e]),L=Fe(($,Y)=>{M($,Q=>{Q.getSelectedRange().setComments(Y)})},[e]),N=Fe(($,Y)=>{M($,Q=>{Q.getSelectedRanges().clear(Y)})},[e]),D=Fe(async($,Y,Q=!1,K=!1)=>M($,async se=>{let X=se.getSelectedRanges();Q&&(Y===B.Orientation.Row?X=X.getEntireRows(K):Y===B.Orientation.Column&&(X=X.getEntireColumns(K)));let ue=null;const _e=_.getMode()?.key;if(_e==="copy"||_e==="cut"){const Re=await C.getClipboard().readReference();Re&&Re.getItemType()==="range"&&(ue=Re.getItem(),ue.getCoords()||(ue=null))}if(ue){const Re=await X.insertFrom(ue,{...ue.getMarkOptions(),orientation:Y,autoSelect:!0});!Re||Re.isEntireRows()||Re.isEntireColumns()||Re.autoFit({orientations:B.Orientations.Row,minContent:!0}),_.setMode(null)}else X.insert(Y,{autoSelect:!0})},"Insert Cells",!1),[_]),[O,H]=T.useState(null),z=Fe($=>e.getStyles().setDefaultTableStyle($),[e]),j=Fe($=>{e.getStyles().getTableStyle($)?.delete()},[e]),q=Fe(($,Y)=>{M($,async Q=>{const K=Q.getSelectedRange(),se=Q.getSelectedCell().getCoords();let X=null,ue=0;const _e=se.rowIndex>0?Q.getRange({rowIndex:se.rowIndex,colIndex:se.colIndex}).getExtended(B.Direction.Up):null;_e&&Q.getRange({colStart:se.colIndex,rowStart:_e.getCoords().rowStart,colEnd:se.colIndex,rowEnd:_e.getCoords().rowStart}).isContentful()&&(X=B.Direction.Up,ue=se.rowIndex-_e.getCoords().rowEnd);const Re=se.colIndex>0?Q.getRange({rowIndex:se.rowIndex,colIndex:se.colIndex-1}).getExtended(B.Direction.Left):null;if(Re&&Q.getRange({colStart:Re.getCoords().colStart,rowStart:se.rowIndex,colEnd:Re.getCoords().colStart,rowEnd:se.rowIndex}).isContentful()){const Oe=se.colIndex-Re.getCoords().colEnd;(Oe<ue||!X)&&(X=B.Direction.Left,ue=Oe)}let Ne=null;if(X===B.Direction.Up){if(Ne={..._e.getCoords()},(Ne.rowEnd===se.rowIndex||!Q.getRange({colIndex:se.colIndex,rowIndex:se.rowIndex-1}).isContentful())&&Ne.rowStart>0&&Q.getRange({colIndex:se.colIndex,rowIndex:Ne.rowStart-1}).isContentful()){const Oe=_e.getExtended(B.Direction.Up);Ne={colStart:se.colIndex,rowStart:Oe.getCoords().rowStart,colEnd:se.colIndex,rowEnd:_e.getCoords().rowEnd}}Ne.rowEnd=se.rowIndex-1}else if(X===B.Direction.Left){if(Ne={...Re.getCoords()},(Ne.colEnd===se.colIndex||!Q.getRange({colIndex:se.colIndex-1,rowIndex:se.rowIndex}).isContentful())&&Ne.colStart>0&&Q.getRange({colIndex:Ne.colStart-1,rowIndex:se.rowIndex}).isContentful()){const Oe=Re.getExtended(B.Direction.Left);Ne={colStart:Oe.getCoords().colStart,rowStart:se.rowIndex,colEnd:Oe.getCoords().colEnd,rowEnd:se.rowIndex}}Ne.colEnd=se.colIndex-1}if(K.size!==1&&X){const Oe=K.getCoords(),Be=K.startIncrementalUpdates({orientation:B.Orientation.Column}),Ue={...Ne},$e=Oe.rowStart,Ve=Oe.rowEnd,Je=Oe.colStart,rt=Oe.colEnd,et=X===B.Direction.Up;for(let at=Je;at<=rt;at++){Ue.colStart=et?at:Ne.colStart+(at-Je),Ue.colEnd=et?at:Ne.colEnd+(at-Je);for(let nt=$e;nt<=Ve;nt++){Ue.rowStart=et?Ne.rowStart+(nt-$e):nt,Ue.rowEnd=et?Ne.rowEnd+(nt-$e):nt;const ht=Q.getRange(Ue).toString();Be.pushAt(nt,at,`=${Y}(${ht})`)}}Be.apply()}else{const Oe=Ne?Q.getRange(Ne).toString():"",Be=`=${Y}(`;g?.({text:`${Be}${Oe})`,editMode:!0,initialSelection:{start:Be.length,end:Be.length+Oe.length}})}},!1)},[e]),P=Fe(($,Y,Q=!1,K=!0)=>{M($,async se=>{let X=null;if(O)return void O.updateStyleOptions(Y);{const Re=se.getSelectedRanges().getFixed(!0),Ne=se.getSelectedRange().getDefaultSortCriteria();let Oe={ranges:Re,hasHeader:Ne?.options?.hasHeader??!1};X=K?new Promise((Be,Ue)=>{const $e={tableOptions:Oe,onCancel:()=>{Ue()},onDone:Ve=>{Be(Ve)},context:{getNames:()=>se.getNames()}};i.showWindow?.("tableNew",$e)}):{option:"Ok",tableOptions:Oe}}const ue=await Promise.resolve(X);if(ue?.option!=="Ok")throw null;const _e=await Promise.resolve(i?.showBusy?.($.label()));try{await se.getTables().add(ue.tableOptions.ranges.at(0),{styleName:Y?.name,clearFormatting:Q,hasHeader:ue.tableOptions.hasHeader}).getRange().select()}catch(Re){_e(),i?.showError?.(Re)}_e()},!1,!0,!1)},[O]),U=Fe(()=>n,[n]),ne=Fe($=>({styles:()=>e.getStyles(),table:()=>$,bodyStyle:U,getNames:()=>e.getNames()}),[e]),ee=Fe(async($,Y,Q,K=!0)=>{let se=null;if(!Y){let X=e.getSelectedRange();X.size===1&&(X=X.getSurrounding());let ue=e.getTables().getItems({address:e.getSelectedRange()});ue.length>0&&(Y=ue[0]),await X.select()}if(Y){if(K){try{Q&&await Y.select()}catch{}se=new Promise(async(X,ue)=>{$.update({context:ne(Y)});const _e={command:$,commands:W,notifier:i,onDone:Ne=>{X(Ne)}},Re=await i.showWindow?.("tableDetails",_e,{disableAutoDestroy:!0});setTimeout(()=>{Re.focus()},180)})}Promise.resolve(se).then(X=>{},X=>{i?.showError?.(X)})}},[i]),ve=Fe(async($,Y,Q=!1)=>{let K=null;if(Y)Y.isITable?K=Y:Y.getValue()&&(K=Y.getValue());else{const se=e.getTables().getItems({address:e.getSelectedRange()});se.length>0&&(K=se[0])}if(K){if(!Q){const se=K.getRange().getCoords(),X=(se.colEnd-se.colStart+1)*(se.rowEnd-se.rowStart+1);if(X>1e4&&await i?.showOptions({title:"Confirm",description:`Converting a table to range with '${X}' cells will set a large number of cell styles and may affect performance.
Continue?`,options:["Convert","Cancel"],defaultOption:"Convert"})!=="Convert")return}M($,async()=>{Q?K.delete():K.convertToRange()},!1,!0)}},[i]),le=Fe(($,Y,Q)=>{M($,async K=>{let se=K.getSelectedRanges();if(se.getCount()>1)throw new Error("Can not sort on multiple cell ranges. Please select a single range and try again.");let X=se.at(0);X.size===1&&(X=X.getSurrounding());const ue=K.getSelection().getCoords().cell;let _e=X.getDefaultSortCriteria(B.Orientation.Row,ue);if(!_e){if(Q)throw new Error("Invalid sort selection. Sort requires a single range with data.");return}let Re=_e.options;if(Q&&(Re=new Promise((Oe,Be)=>{const Ue={range:X,options:_e.options,cell:ue,onCancel:()=>{Be()},onDone:$e=>{$e?Oe($e.options):Be()}};i.showWindow?.("sort",Ue)})),Re=await Promise.resolve(Re),!Re)return;const Ne=await Promise.resolve(i?.showBusy?.($.label()));try{X.doBatch(()=>{const Oe={...Re,...Y};X.sort(Oe),X.autoFit({orientations:Oe?.orientation===B.Orientation.Column?B.Orientations.Column:B.Orientations.Row,skipCustomSize:!0,minContent:!0})},$?.label?.())}catch(Oe){Ne(),i?.showError?.(Oe)}Ne()},!1,!1,!1)},[i]),Ce=Fe(()=>{console.log("compactedSelection");const $=e.getSelection().getCoords(),Y=e.getSelectedRanges().getFlattened().getCoords(),Q=(X=>{const ue=new Blob([X],{type:"application/javascript"}),_e=URL.createObjectURL(ue),Re=new Worker(_e);return URL.revokeObjectURL(_e),Re})("console.log('hello from worker');");setTimeout(()=>{Q.terminate(),console.log("Worker terminated")},5e3);let K=-1;for(let X=0;K===-1&&X<Y.length;X++)J.isCellWithinRange($.cell,Y[X])&&(K=X);if(J.isEqualRangesArrays($.ranges,Y))return;const se={cell:$.cell,ranges:Y,rangeIndex:K};e.getSelection().updateCoords(se)},[e]),re=Fe(()=>{console.log("selectComments")},[e]),ae=Fe(async($=!1,Y=!1)=>{let Q=null;if(Y)Q=e.getEntireRange();else{const K=e.getSelectedRange();if(K.isEntireRange()){const se=e.getSelection().getCoords().cell,X=e.getRange(se);Q=X.getSurrounding(),Q.isEntireRange()&&(Q=X)}else Q=K.getSurrounding({contentOnly:$})}Q&&await Q.select()},[e]),fe=Fe(($,Y,Q)=>{M($,async K=>{let se=K.getSelectedRanges();Q&&(Y===B.Orientation.Row?se=se.getEntireRows():Y===B.Orientation.Column&&(se=se.getEntireColumns())),se.delete(Y)},"Delete Cells")},[e]);Fe(async $=>{let Y=null;const Q=m(),K=Math.min(Q.width-8,480),se=Math.min(Q.height-8,288);try{e.getSelectedRanges(),Y=await e.getMovables().add({bounds:{x:Q.left+(Q.width-K)/2,y:Q.top+(Q.height-se)/2,width:K,height:se},type:"chart",json:$.template}),Y.select(),_.setMode(null)}catch(X){i?.showError?.(X)}return Y},[e,i]);const ye=Fe(async($,Y,Q)=>{const K=await i?.showBusy?.($.label());try{const se=await e.getMovables().addImage(Y,{autoSelect:!0,...Q});return K(),_.setMode(null),se}catch(se){K();let X=se;typeof X!="string"&&(console.warn(se),X="Unable to resolve image."),i?.showMessage?.(X,{type:Vd.Error})}},[e,i]),he=Fe(($,Y)=>{M($,async Q=>{const K=Q.getSelectedRanges();K.doBatch(()=>{const se=Y===B.Direction.Up||Y===B.Direction.Down,X=K.getCoords().slice().sort(J.createRangeComparator(se?B.Orientation.Row:B.Orientation.Column));for(let ue=0;ue<X.length;ue++){const _e=X[ue];let Re=_e;const Ne=Q.getRange(Re).getMerges();let Oe=0,Be=0;if(Ne.length>0){const Ue=Ne[0];Oe=Ue.rowEnd-Ue.rowStart,Be=Ue.colEnd-Ue.colStart}Y===B.Direction.Left?Re={..._e,colStart:_e.colEnd+Be}:Y===B.Direction.Right?Re={..._e,colEnd:_e.colStart+Be}:Y===B.Direction.Up?Re={..._e,rowStart:_e.rowEnd+Oe}:Y===B.Direction.Down&&(Re={..._e,rowEnd:_e.rowStart+Oe}),Q.getRange(Re).autoFill(_e,{filler:zi.Types.Copy}),Q.getRange(_e).autoFit({orientations:B.Orientations.Row,skipCustomSize:!0,minContent:!0})}},{autoSelect:!0,description:$.label()})})},[i]),we=Fe(()=>{let $=null;const Y=e.getSelectedCell().getCoords();if(Y?.rowIndex>0){const Q=e.getRange({rowIndex:Y.rowIndex-1,colIndex:Y.colIndex}).getCell();Q&&($=Q.toTextUnformatted(!0))}g?.({text:$})},[e]),[be,me]=T.useReducer($=>$+1,0),[de,xe]=T.useReducer($=>$+1,0),Le=T.useMemo(()=>[new Ee("gridlinesToggle",o,{label:"Gridlines",scopedLabels:{view:"Gridlines"},description:"Toggle whether the lines between rows and columns in the sheet are displayed."}),new Ee("sheetViewToggleGridlinesRows",o,{label:"Row Gridlines",scopedLabels:{view:"Row Gridlines",gridlines:"Rows"},description:"Toggle whether the lines between rows in the sheet are displayed."}),new Ee("sheetViewToggleGridlinesColumns",o,{label:"Column Gridlines",scopedLabels:{view:"Columns Gridlines",gridlines:"Columns"},description:"Toggle whether the lines between columns in the sheet are displayed."}),new Ee("sheetViewFormatGridlinesColor",o,{label:"Gridlines Color",description:"Color the rows and column gridlines."}),new Ee("sheetViewToggleShowHeadings",o,{label:"Headings",scopedLabels:{view:"Headings"},description:"Toggle whether the row and column headings are displayed."}),new Ee("sheetViewToggleShowHeadingRows",o,{label:"Row Headings",scopedLabels:{view:"Row Headings",headings:"Rows"},description:"Toggle whether the row headings are displayed."}),new Ee("sheetViewToggleShowHeadingColumns",o,{label:"Column Headings",scopedLabels:{view:"Columns Headings",headings:"Columns"},description:"Toggle whether the column headings are displayed."}),new Ee("sheetViewToggleShowHeadingsNumeric",o,{label:"Numeric Headers",description:"Toggle whether cell headings show numbers or A1 conventions.",shortcut:{key:"h",modifiers:[Ae.Ctrl,Ae.Shift]}}),new Ee("sheetViewToggleFormulaView",o,{label:"Show Formulas",description:"Toggle whether cells show formula or values.",shortcut:[{key:"`",modifiers:[Ae.Ctrl]},{key:"`",modifiers:[Ae.Ctrl,Ae.Shift]}]}),new Ee("sheetViewToggleShowZeros",o,{label:"Show Zeros",description:"Toggle whether cell with zero value shows '0' or blank."}),new ot("selectComments",o,{label:"Select Comments",description:"Select the cells with comments.",shortcut:{key:"O",modifiers:[Ae.Ctrl,Ae.Shift]}},()=>re()),new Ee("selectAll",o,{label:"Select All",description:"Select the closest data or the entire sheet if no data is nearby.",shortcut:[{key:"A",modifiers:[Ae.Ctrl]},{key:"Space",modifiers:[Ae.Ctrl,Ae.Shift]}]},($=!1)=>ae(!1,$)),new ot("selectRegion",o,{label:"Select Region",description:"Select the closest data.",shortcut:{key:"*",modifiers:[Ae.Ctrl,Ae.Shift]}},()=>ae(!0,!1)),new ot("breakSelection",o,{label:"Select Visible",description:"Break the selection based on hidden rows and columns.",shortcut:{key:"Semicolon",modifiers:[Ae.Ctrl,Ae.Alt]}},()=>Ce()),new ot("formatTextRotate0",o,{label:"No Text Rotation",description:"Remove all text rotation."}),new ot("formatTextRotate45",o,{label:"Angle Clockwise",description:"Angle text 45 degrees downward."}),new ot("formatTextRotate90",o,{label:"Rotate Text Down",description:"Angle your text so that it aligns with the left."}),new ot("formatTextRotate270",o,{label:"Rotate Text Up",description:"Angle your text so that it aligns with the right."}),new ot("formatTextRotate315",o,{label:"Angle Counterclockwise",description:"Angle text 45 degrees upward."}),new Ee("formatTextRotateCustom",o,{label:"Custom Text Rotation",description:"Angle your text using a custom angle."}),new ot("formatTextRotateVertical",o,{label:"Vertical Text",description:"Stack text vertically."}),new ot("sortAscending",o,{label:"Sort Ascending",scopedLabels:{sort:"Ascending"},description:"Lowest to Highest."},function(){le(this,{reverse:!1},!1)}),new ot("sortDescending",o,{label:"Sort Descending",scopedLabels:{sort:"Descending"},description:"Highest to Lowest."},function(){le(this,{reverse:!0},!1)}),new ot("sortCustom",o,{label:"Custom Sort…",scopedLabels:{sort:"Custom…"},description:"Choose more options, such as sorting by multiple columns or rows, and case-sensitive sorts."},function(){le(this,{},!0)}),new Ee("protectionSheetToggle",o,{label:"Protect Sheet",scopedLabels:{sheet:"Protected"},description:`Prevent unwanted changes from others by limiting their ability to edit.
For example, you can prevent people from editing locked cells or making formatting changes.`}),new Ee("formatSheetTabColor",o,{label:"Tab Color",description:"Color the tab to help differentiate for other sheets."}),new Ee("formatCellStyle",o,{label:"Cell Styles",scopedLabels:{cellStyle:"Apply"},description:"A colorful style is a great way to make important data stand out on the sheet."},function($){k(this,{named:$.getName()},!0)}),new Ee("formatTableStyle",o,{label:"Format as Table",scopedLabels:{table:"Apply (Keep Styles)"},description:"Create a table or apply style to the current table."},function($){P(this,$)}),new Ee("formatTableStyleClearCellStyles",o,{label:"Format as Table (Clear Styles)",scopedLabels:{table:"Apply (Clear Styles)"},description:"Create a table or apply style to the current table and clears all cell styles."},function($){P(this,$,!0)}),new Ee("formatTableStyleClearTableStyle",o,{label:"Clear Table Style",scopedLabels:{table:"Clear Style"},description:"Remove all the styling that is specific for the table."},function(){P(this,{name:null},!0)}),new Ee("setDefaultTableStyle",o,{label:"Set Default Table Style",scopedLabels:{table:"Set As Default"},description:"Sets the default table style used when a table is inserted."},z),new Ee("deleteTableStyle",o,{label:"Delete Table Style",scopedLabels:{table:"Delete"},description:"Remove the current table style."},j),new Ee("formatBorder",o,{label:"Border",description:"Create an outline border."},function($){k(this,{border:$})}),new Ee("formatFillColor",o,{label:"Fill Color",description:"Color the background of the cells to make them stand out."},function($){k(this,{fill:$})}),new Ee("formatFontColor",o,{label:"Font Color",description:"Change the color of your text."},function($){k(this,{font:{fill:$}})}),new Ee("formatBoldToggle",o,{label:"Bold",description:"Toggle bold formatting of text.",shortcut:[{key:"B",modifiers:[Ae.Ctrl]},{key:"2",modifiers:[Ae.Ctrl]}]}),new Ee("formatItalicToggle",o,{label:"Italic",description:"Toggle italic formatting of text.",shortcut:[{key:"I",modifiers:[Ae.Ctrl]},{key:"3",modifiers:[Ae.Ctrl]}]}),new Ee("formatUnderlinedToggle",o,{label:"Underline",scopedLabels:{underline:"Single"},description:"Underline the text.",shortcut:[{key:"u",modifiers:[Ae.Ctrl]},{key:"4",modifiers:[Ae.Ctrl]}]}),new Ee("formatUnderlinedDoubleToggle",o,{label:"Double Underline",scopedLabels:{underline:"Double"},description:"Double underline the text."}),new Ee("formatUnderlinedAccountingToggle",o,{label:"Accounting Underline",scopedLabels:{underline:"Accounting"},description:"Use accounting underline for the text."}),new Ee("formatUnderlinedAccountingDoubleToggle",o,{label:"Double Accounting Underline",scopedLabels:{underline:"Double Accounting"},description:"Use accounting double underline the text."}),new Ee("formatStrikeThroughToggle",o,{label:"Strikethrough",description:"Toggle strike-through formatting of text.",shortcut:{key:"5",modifiers:[Ae.Ctrl]}}),new Ee("formatSuperscriptToggle",o,{label:"Superscript",description:"Format your text to be smaller and sit at the top of the line."}),new Ee("formatSubscriptToggle",o,{label:"Subscript",description:"Format your text to be smaller and sit at the bottom of the line."}),new Ee("formatAlignTopToggle",o,{label:"Align Top",description:"Align text to the top."}),new Ee("formatTextOverflowVisibleToggle",o,{label:"Overflow Text",description:"Overflow text to the next cells."}),new Ee("formatTextOverflowWrapToggle",o,{label:"Wrap Text",description:"Wrap text with the existing cell and increase the height as required."}),new Ee("formatTextOverflowClipToggle",o,{label:"Clip Text",description:"Clip text that falls outside of the existing cell."}),new Ee("formatTextOverflowShrinkToggle",o,{label:"Shrink Text",description:"Shrink the text font to fit within existing cell."}),new Ee("formatTextOverflowEllipsisToggle",o,{label:"Ellipsis Text",description:"Add a trailing '…' to the text to indicate text is partially hidden."}),new Ee("formatAlignMiddleToggle",o,{label:"Align Middle",description:"Align text so that it is centered between the top and bottom of the cell."}),new Ee("formatAlignBottomToggle",o,{label:"Align Bottom",description:"Align text to the bottom."}),new Ee("formatAlignJustifyVerticalToggle",o,{label:"Justify Vertically",description:"Each 'word' in each line of text inside the cell is evenly distributed across the height of the cell."}),new Ee("formatAlignDistributedVerticalToggle",o,{label:"Distribute Vertically",description:"Justify your content vertically."}),new Ee("formatAlignLeftToggle",o,{label:"Align Left",description:"Align your content to the left."}),new Ee("formatAlignCenterToggle",o,{label:"Align Center",description:"Center your content."}),new Ee("formatAlignRightToggle",o,{label:"Align Right",description:"Align your content to the right."}),new Ee("formatAlignJustifyToggle",o,{label:"Align Justify",description:"Justify your content."}),new Ee("formatAlignCenterContinuousToggle",o,{label:"Center Across",description:"Center your content across multiple cells."}),new Ee("formatAlignFillToggle",o,{label:"Fill Across",description:"Repeat the value to fill the entire cell."}),new Ee("formatAlignDistributedHorizontalToggle",o,{label:"Distribute Horizontally",description:"Each 'word' in each line of text inside the cell is evenly distributed across the width of the cell."}),new ot("formatFontSizeIncrease",o,{label:"Increase Font Size",description:"Make your text a bit bigger.",shortcut:{key:">",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,$=>({font:{size:Dd($.getFont().getSize(),!0)}}))}),new ot("formatFontSizeDecrease",o,{label:"Decrease Font Size",description:"Make your text a bit smaller.",shortcut:{key:"<",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,$=>({font:{size:Dd($.getFont().getSize(),!1)}}))}),new Ee("formatFontFamily",o,{label:"Font",description:"Select the font your text."},function($){k(this,{font:{family:$}})}),new Ee("formatFontSize",o,{label:"Font Size",description:"Change the size of your text."},function($){k(this,{font:{size:$}})}),new Ee("formatNumberDialog",o,{label:"Custom Number Format",scopedLabels:{numberFormat:"Custom"},description:"Create a custom number format.",shortcut:[{key:"1",modifiers:[Ae.Ctrl]},{key:"1",modifiers:[Ae.Ctrl,Ae.Alt]}]},function($,Y){const Q=this,K={initialValue:$??Y.state(),context:Y.context(),onInputOption:(se,X)=>{k(Q,{numberFormat:se})}};i.showWindow?.("numberFormat",K)}),new Ee("formatNumberFormat",o,{label:"Number Format",description:"Choose the format for your cells, such as percentage, currency, date or time."},function($){k(this,{numberFormat:$})}),new Ee("formatNumberFormatGeneralStyle",o,{label:"General Style",description:"Remove all specific formatting.",shortcut:{key:"Backquote",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,{numberFormat:Vt.Type.General})}),new Ee("formatNumberFormatNumberStyle",o,{label:"Number Style",description:"Format as number with two decimals and comma.",shortcut:{key:"1",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,{numberFormat:"#,##0.00"})}),new Ee("formatNumberFormatTimeStyle",o,{label:"Time Style",description:"Format as time with hour and minute, and AM or PM.",shortcut:{key:"2",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,{numberFormat:"h:mm AM/PM"})}),new Ee("formatNumberFormatDateStyle",o,{label:"Date Style",description:"Format as date with day, month, and year.",shortcut:{key:"3",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,{numberFormat:"d-mmm-yy"})}),new Ee("formatNumberFormatAccountingStyle",o,{label:"Accounting Style",description:"Format as Dollars, Euros, or other currency.",shortcut:{key:"4",modifiers:[Ae.Ctrl,Ae.Shift]}},function($){k(this,{numberFormat:$??'_($* #,##0.00_);_($* (#,##0.00);_($* "-"??_);_(@_)'})}),new Ee("formatNumberFormatPercentStyle",o,{label:"Percent Style",description:"Format as a percent with no decimal places.",shortcut:{key:"5",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,{numberFormat:"0%"})}),new Ee("formatNumberFormatScientificStyle",o,{label:"Scientific Style",description:"Format as a scientific number with two decimal places .",shortcut:{key:"6",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){k(this,{numberFormat:"0.00E+00"})}),new Ee("formatNumberFormatCommaStyle",o,{label:"Comma Style",description:"Format with a thousands separator.",shortcut:{key:",",modifiers:[Ae.Ctrl]}},function(){k(this,{numberFormat:'_(* #,##0.00_);_(* (#,##0.00);_(* "-"??_);_(@_)'})}),new Ee("formatNumberFormatIncreaseDecimal",o,{label:"Increase Decimal",description:"Show more decimal places for a more precise value."},function(){k(this,$=>({numberFormat:Vt.Parser.adjustDecimalPlaces($.getNumberFormat(),1)}))}),new Ee("formatNumberFormatDecreaseDecimal",o,{label:"Decrease Decimal",description:"Show few decimal places."},function(){k(this,$=>({numberFormat:Vt.Parser.adjustDecimalPlaces($.getNumberFormat(),-1)}))}),new Ee("displayPlaceholdersToggle",o,{label:"Display Placeholders",description:"Switch between hiding objects, displaying objects, and displaying placeholders for objects.",shortcut:{key:"6",modifiers:[Ae.Ctrl]}}),new ot("noOp",o,{label:"Do nothing",description:"Do Nothing.",shortcut:{key:"7",modifiers:[Ae.Ctrl]}},function(){}),new Ee("displayOutlineSymbolsToggle",o,{label:"Display Outline Symbols",description:"Display or hide the outline symbols.",shortcut:{key:"8",modifiers:[Ae.Ctrl]}}),new Ee("hideRows",o,{label:"Hide Rows",description:"Hide the rows.",shortcut:{key:"9",modifiers:[Ae.Ctrl]}}),new Ee("unhideRows",o,{label:"Unhide Rows",description:"Unhide the rows.",shortcut:{key:"(",modifiers:[Ae.Ctrl,Ae.Shift]}}),new Ee("hideColumns",o,{label:"Hide Columns",description:"Hide the columns.",shortcut:[{key:"0",modifiers:[Ae.Ctrl]},{key:"0",modifiers:[Ae.Ctrl,Ae.Alt]}]}),new Ee("unhideColumns",o,{label:"Unhide Columns",description:"Unhide the columns.",shortcut:{key:")",modifiers:[Ae.Ctrl,Ae.Shift]}}),new ot("calculate",o,{label:"Calculate Sheet",description:"Recalculate the formulas on the current sheet.",shortcut:{key:"=",modifiers:[Ae.Ctrl]}}),new Ee("insertFunction",o,{label:"Insert Function",disabled:!0,scopedLabels:{insert:"Function",insertFunction:"More Functions..."},description:"Work with the function in the current cell.",shortcut:{key:"F3",modifiers:[Ae.Shift]}},function($,Y){console.log("insertFunction")}),new Ee("insertFunctionSum",o,{label:"Quick Sum",scopedLabels:{insertFunction:"Sum"},description:"Quick sum of the cells.",shortcut:{key:"=",modifiers:[Ae.Alt]}},function(){q(this,"SUM")}),new Ee("insertFunctionAverage",o,{label:"Quick Average",scopedLabels:{insertFunction:"Average"},description:"Quick average of the cells."},function(){q(this,"AVERAGE")}),new Ee("insertFunctionCount",o,{label:"Quick Count",scopedLabels:{insertFunction:"Count Numbers"},description:"Quick count of the cells."},function(){q(this,"COUNT")}),new Ee("insertFunctionMax",o,{label:"Quick Max",scopedLabels:{insertFunction:"Max"},description:"Quick maximum of the cells."},function(){q(this,"MAX")}),new Ee("insertFunctionMin",o,{label:"Quick Min",scopedLabels:{insertFunction:"Min"},description:"Quick minimum of the cells."},function(){q(this,"MIN")}),new Ee("startEditCurrentTime",o,{label:"Current Time",description:"Insert the current time.",shortcut:{key:"Semicolon",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){g?.({text:e.createTemporaryCell({value:Gi(),style:{numberFormat:"Medium Time"}}).toText()})}),new Ee("startEditCurrentDate",o,{label:"Current Date",description:"Insert the current date.",shortcut:{key:"Semicolon",modifiers:[Ae.Ctrl]}},function(){g?.({text:e.createTemporaryCell({value:Gi(),style:{numberFormat:"Short Date"}}).toText()})}),new ot("sheetZoomOut",o,{label:"Zoom Out",description:"Zoom out to see less detail but more area.",shortcut:[{key:"-",modifiers:[Ae.Ctrl,Ae.Alt]},{key:"NumpadSubtract",modifiers:[Ae.Ctrl,Ae.Alt]}]}),new ot("sheetZoomIn",o,{label:"Zoom In",description:"Zoom in to see more detail but less area.",shortcut:[{key:"=",modifiers:[Ae.Ctrl,Ae.Alt]},{key:"NumpadAdd",modifiers:[Ae.Ctrl,Ae.Alt]}]}),new ot("sheetZoom100",o,{label:"Zoom 100%",description:"Zoom document to 100%.",shortcut:{key:"o",modifiers:[Ae.Ctrl,Ae.Alt]}}),new Ee("updateHyperlink",o,{label:"Link",scopedLabels:{contextMenu:"Insert Link…",insert:"Link…",hyperlink:"Edit"},description:"Create a hyperlink to either another webpage or another location within this document.",context:()=>A,shortcut:[{key:"K",modifiers:[Ae.Ctrl]},{key:"K",modifiers:[Ae.Ctrl,Ae.Alt]}]},async function($,Y){const Q=this,K={context:Y.context(),onUpdateHyperlink:(se,X)=>{F(Q,se,X)}};i.showWindow?.("hyperlink",K)}),new Ee("openHyperlink",o,{label:"Open Link",scopedLabels:{hyperlink:"Open"},shortcut:{key:"Enter",modifiers:[Ae.Ctrl]},description:"Open the hyperlink or goto another location within this document.",context:()=>A},async($,Y)=>{const Q=Y.context()();if(!Q)return;const K=Q.getHyperlink();if(K)try{await K.open()}catch(se){i?.showError?.(se)}}),new Ee("deleteHyperlink",o,{label:"Delete Link",scopedLabels:{hyperlink:"Delete"},description:"Remove the hyperlink.",context:()=>A},function($,Y){F(this,null,null)}),new ot("insertNote",o,{label:"Insert Note",scopedLabels:{contextMenu:"Insert Note…",insert:"Note"},shortcut:{key:"F2",modifiers:[Ae.Shift]},description:"Add a note to the cell."},($,Y)=>{((Q,K)=>{Q?.showMessage?.(ge.jsxs("p",{style:{marginTop:"0px",marginBottom:"0px"},children:[K," is not yet implemented.",ge.jsx("br",{}),ge.jsx("br",{}),"Please see the ",ge.jsx("a",{style:{whiteSpace:"nowrap"},href:"https://www.sheetxl.com/docs/guides/introduction/roadmap",target:"_blank",rel:"noopener",children:"SheetXL Roadmap"}),"."]}))})(i,Y.label())}),new Ee("updateComments",o,{label:"Comments",scopedLabels:{contextMenu:"Insert Comments…",insert:"Comments…"},shortcut:{key:"M",modifiers:[Ae.Ctrl,Ae.Alt]},description:"Add a comment to the current cell.",context:()=>A},async function($,Y){const Q=this,K={context:Y.context(),onUpdateComments:se=>{L(Q,se)}};i.showWindow?.("comments",K)}),new Ee("deleteComments",o,{label:"Delete Comments",description:"Remove any comments.",context:()=>A},function($,Y){L(this,null)}),new Ee("insertImageFromFile",o,{label:"Insert Image",scopedLabels:{contextMenu:"Insert Image…",insert:"Image…",insertImage:"From Device…"},description:"Insert a picture from your device."},async function($=null){let Y=null,Q=null;typeof $=="string"?Q=$:Y=$?.file?$.file:$,(Y||(Y=await V.openFileDialog(Q??"image/*"),Y))&&await ye(this,{file:Y},$?.options)}),new Ee("insertImageFromURL",o,{label:"Insert Image From Web",scopedLabels:{insert:"Image From Web",insertImage:"From the Web…"},description:"Insert a picture from the web."},async function($){if(!$){const Y=await i?.showInputOptions?.({title:"Insert Image from Web",description:"Enter the web address for the image to insert.",inputLabel:"Address",initialValue:"https://picsum.photos/360",inputProps:{style:{minWidth:"440px"}},options:["Insert"]});if(Y.option!=="Insert")return;$=Y.input}$&&ye(this,{fetch:$})}),new ot("insertTable",o,{label:"Insert Table",scopedLabels:{contextMenu:"Insert Table…",insert:"Table"},description:"Create a table. Tables enable auto formatting, sorting, filtering, and other advanced features.",shortcut:[{key:"L",modifiers:[Ae.Ctrl]},{key:"T",modifiers:[Ae.Alt,Ae.Ctrl]}]},function(){P(this)}),new Ee("editTable",o,{label:"Edit Table…",scopedLabels:{table:"Edit…",namedItem:"Edit…"},description:"Edit the table to adjust formatting, sorting, filtering, or other advanced features."},function($){let Y=null,Q=!1;$.isITable?Y=$:$.getValue()&&(Y=$.getValue(),Q=!0),ee(this,Y,Q)}),new Ee("deleteTable",o,{label:"Delete Table",scopedLabels:{delete:"Table",table:"Delete",namedItem:"Delete"},description:`Remove the table.

The table and table specific styling will be removed but the values will be preserved.`},function($){ve(this,$,!0)}),new Ee("convertTableToRange",o,{label:"Convert To Range",description:`Convert the table into a normal range  of cells.

The values and the formatting are preserved.`},function($){ve(this,$,!1)}),new Ee("tableTotalRowToggle",o,{label:"Toggle Table Total Row",description:"Toggle Total Row on/off.",scopedLabels:{table:"Total Row"},shortcut:{key:"T",modifiers:[Ae.Ctrl,Ae.Alt]}},function(){const $=this.context().table();$&&$.setShowTotals(!$.getShowTotals())}),new Ee("tableHeaderRowToggle",o,{label:"Toggle Table Header Row",description:"Toggle Header Row on/off.",scopedLabels:{table:"Header Row"}},function(){const $=this.context().table();$&&$.setShowHeaders(!$.getShowHeaders())}),new Ee("autoFilterToggle",o,{label:"Toggle Filter",scopedLabels:{filter:"Filter"},description:"Toggle Auto Filter on/off.",shortcut:{key:"L",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){const $=this.context().table();$&&$.setShowFilterButton(!$.getShowFilterButton())}),new Ee("autoFilterReapply",o,{label:"Reapply Filter",scopedLabels:{filter:"Reapply"},description:"Reapply the filter and sort with the latest changes.",shortcut:{key:"L",modifiers:[Ae.Ctrl,Ae.Alt]}}),new Ee("autoFilterClear",o,{label:"Clear Filter",scopedLabels:{filter:"Clear"},description:"Clear the filters criteria from the current filter.."}),new ot("startEditValueAbove",o,{label:"Copy From Above",description:"Copy the value from the cell above the active cell into the cell or the formula bar.",shortcut:[{key:"Quote",modifiers:[Ae.Ctrl]},{key:'"',modifiers:[Ae.Ctrl,Ae.Shift]}]},we),new Ee("formatPainterToggle",o,{label:"Format Painter",description:"Apply style to another part of your workbook."}),new ot("insertCells",o,{label:"Insert Cells",scopedLabels:{insertCells:"At Selection"},description:"Inserts cells at the current selection.",shortcut:{key:"=",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){D(this)}),new ot("insertCellsShiftRight",o,{label:"Insert Cells (Shift Right)",scopedLabels:{insertCells:"Shift Right"},description:"Insert cells to the left and shift the current cells to the right."},function(){D(this,B.Orientation.Column)}),new ot("insertCellsShiftDown",o,{label:"Insert Cells (Shift Down)",scopedLabels:{insertCells:"Shift Down"},description:"Insert cells above and shift the current cells downward."},function(){return D(this,B.Orientation.Row)}),new ot("insertRows",o,{label:"Insert Row(s)",scopedLabels:{insertCells:"Row(s)"},description:"Insert a row above the current position."},function(){return D(this,B.Orientation.Row,!0)}),new ot("insertColumns",o,{label:"Insert Column(s)",scopedLabels:{insertCells:"Column(s)"},description:"Insert a column before the current position."},function(){return D(this,B.Orientation.Column,!0)}),new ot("insertRowsAfter",o,{label:"Insert Row Below",scopedLabels:{insertCells:"Row Below"},description:"Insert a row below the current position."},function(){return D(this,B.Orientation.Row,!0,!0)}),new ot("insertColumnsAfter",o,{label:"Insert Column After",scopedLabels:{insertCells:"Column After"},description:"Insert a column after the current position."},function(){return D(this,B.Orientation.Column,!0,!0)}),new ot("deleteCells",o,{label:"Delete Cells",scopedLabels:{deleteCells:"At Selection"},description:"Delete the cells.",shortcut:{key:"-",modifiers:[Ae.Ctrl]}},function(){return fe(this)}),new ot("deleteCellsShiftUp",o,{label:"Delete Cells (Shift Up)",scopedLabels:{deleteCells:"Shift up"},description:"Delete cells the current current downward."},function(){return fe(this,B.Orientation.Row)}),new ot("deleteCellsShiftLeft",o,{label:"Delete Cells (Shift Left)",scopedLabels:{deleteCells:"Shift Left"},description:"Delete cells the current cells to the right."},function(){return fe(this,B.Orientation.Column)}),new ot("deleteRows",o,{label:"Delete Rows",scopedLabels:{deleteCells:"Rows"},description:"Delete the rows at the current selection."},function(){return fe(this,B.Orientation.Row,!0)}),new ot("deleteColumns",o,{label:"Delete Columns",scopedLabels:{deleteCells:"Columns"},description:"Delete the columns at the current selection."},function(){return fe(this,B.Orientation.Column,!0)}),new ot("flashFill",o,{label:"Flash Fill",description:"Do a flash fill.",shortcut:[{key:"e",modifiers:[Ae.Ctrl]},{key:"e",modifiers:[Ae.Ctrl,Ae.Alt]}]}),new ot("fillDown",o,{label:"Fill Down",description:"Copy the top-most value from the selection to the bottom of the selection.",shortcut:{key:"d",modifiers:[Ae.Ctrl]}},function(){return he(this,B.Direction.Down)}),new ot("fillRight",o,{label:"Fill Right",description:"Copy the left-most value from the selection to the right of the selection.",shortcut:[{key:"r",modifiers:[Ae.Ctrl]}]},function(){return he(this,B.Direction.Right)}),new ot("fillUp",o,{label:"Fill Up",description:"Copy the bottom-most value from the selection to the top of the selection."},function(){return he(this,B.Direction.Up)}),new ot("fillLeft",o,{label:"Fill Left",description:"Copy the right-most value from the selection to the left of the selection."},function(){return he(this,B.Direction.Left)}),new ot("formatBorderAddOutline",o,{label:"Add Outline Border",description:"Apply an outline border.",shortcut:{key:"7",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){return k(this,{border:{left:{style:pe.StrokeStyle.Thin,color:null},top:{style:pe.StrokeStyle.Thin,color:null},right:{style:pe.StrokeStyle.Thin,color:null},bottom:{style:pe.StrokeStyle.Thin,color:null}}})}),new ot("formatBorderClearOutline",o,{label:"Remove Outline Border",description:"Remove the outline border.",shortcut:{key:"_",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){return k(this,{border:null})}),new ot("formatIndentDecrease",o,{label:"Decrease Indent",description:"Move your content closer to the border."},function(){return k(this,$=>{const Y=$.getAlignment().getIndent()-1;return{alignment:{indent:Y>0?Y:0}}})}),new ot("formatIndentIncrease",o,{label:"Increase Indent",description:"Move your content further from the border."},function(){return k(this,$=>{const Y={alignment:{indent:$.getAlignment().getIndent()+1}};return $.getAlignment().getHorizontal()===oe.HorizontalAlignment.General&&(Y.alignment.horizontal=oe.HorizontalAlignment.Left),Y})}),new Ee("mergeToggle",o,{label:"Merge",description:"Combine and center the contents into a single cell.",shortcut:{key:"m",modifiers:[Ae.Ctrl]}}),new ot("mergeHorizontal",o,{label:"Merge Horizontally",description:"Combine the contents into horizontal rows."}),new ot("mergeVertical",o,{label:"Merge Vertically",description:"Combine the contents into vertical columns."}),new ot("unmerge",o,{label:"Unmerge",description:"Split merged cells into multiple cells."}),new ot("clearContents",o,{label:"Clear Contents",scopedLabels:{clear:"Contents"},description:`Clear only the contents in the cells.

The formatting is not cleared.`,shortcut:{key:"Delete"}},function(){N(this,lt.Content.Values)}),new ot("clearFormats",o,{label:"Clear Formats",scopedLabels:{clear:"Formats"},description:"Clear only the formatting that is applied to the cells."},function(){N(this,lt.Content.Formats)}),new ot("clearHyperlinks",o,{label:"Clear Hyperlinks",scopedLabels:{clear:"Hyperlinks"},description:"Clear only the hyperlinks in the cells."},function(){N(this,lt.Content.Hyperlinks)}),new ot("clearComments",o,{label:"Clear Comments",scopedLabels:{clear:"Comments"},description:"Clear the comments from the cells."},function(){N(this,lt.Content.Comments)}),new ot("clearAll",o,{label:"Clear All",scopedLabels:{clear:"All"},description:`Clears everything from the cells.

All contents and formatting are removed.`,shortcut:{key:"Delete",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){N(this)}),new Ee("freezeToggle",o,{label:"Freeze Panes",description:"Keep rows and columns visible while the rest of the sheet scrolls (based on current selection)."}),new Ee("freezeToggleHorizontal",o,{label:"Freeze Top Rows",description:"Keep the top rows visible while scrolling through the rest of the sheet."}),new Ee("freezeToggleVertical",o,{label:"Freeze Left Columns",description:"Keep the left columns visible while scrolling through the rest of the sheet."}),new ot("unfreeze",o,{label:"Unfreeze Panes",description:"Unfreeze both the rows and columns."}),new ot("autoFitRows",o,{label:"Autofit Rows",description:"Adjust the rows to the best height."}),new ot("autoFitColumns",o,{label:"Autofit Columns",description:"Adjust the columns to the best width."})],[]),W=T.useMemo(()=>{let $=null;return $=r?r.createChildGroup(o,"sheet",!1):new Qa(o,"sheet"),$.addCommands(Le,!0),$},[r,Le]),[Ze,Xe]=T.useState(!1),[Ge,ce]=T.useState(!1);T.useEffect(()=>{if(f.current!==e||!d)return;const $=d.getCoords(),Y=e.getTables().getItems({address:$[0]});x(ue=>V.isEqualArrays(ue,Y)?ue:Y),c&&Y[0]&&J.isCellWithinRange(c,Y[0].getRange().getCoords())?H(Y[0]??null):H(null);const Q=e.getSelectedRanges(),K=Q.getMerges().length>0,se=Q.isOverlapping();let X=!0;for(let ue=0;X&&ue<$.length;ue++)X=J.isSingleCell($[ue]);ce(se),Xe(Y.length===0&&!se&&(K||!X))},[de,d,e]),Mp(r,null,{onChange:()=>{const $=!e.getProtection().isFormatCellsAllowed(),Y=_.getMode()?.key==="formatPainter";W.getCommand("formatPainterToggle").update({disabled:$||!r?.getCommand("copy"),state:()=>Y}).updateCallback(()=>Y?void _.setMode(null):W.getCommand("copy").execute({editMode:{key:"formatPainter",description:"Use the mouse to apply the copied format to another selection.",cursor:`url("data:image/svg+xml,%3Csvg width='30' height='22' viewBox='0 0 30 22' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 26.737611,2.811068 V 2.0241451 c 0,-0.4328075 -0.354115,-0.7869227 -0.786923,-0.7869227 h -9.443074 c -0.432808,0 -0.786923,0.3541152 -0.786923,0.7869227 v 3.1476914 c 0,0.4328076 0.354115,0.7869235 0.786923,0.7869235 h 9.443074 c 0.432808,0 0.786923,-0.3541159 0.786923,-0.7869235 V 4.3849137 h 0.786923 v 3.1476915 h -7.869229 v 8.6561518 c 0,0.432808 0.354116,0.786923 0.786923,0.786923 h 1.573846 c 0.432807,0 0.786923,-0.354115 0.786923,-0.786923 V 9.1064513 H 29.09838 V 2.811068 Z M 10.714339,6.2116849 c -1.60877,0.0017 -3.2175361,0.00425 -4.8263048,0.00609 0.0012,1.5756989 0.00158,3.1513905 0.00244,4.7270891 -1.5978311,0.0017 -3.1956617,0.0034 -4.7934919,0.0043 0.00335,1.740011 0.00655,3.480012 0.00988,5.220023 1.5954589,0 3.1909181,0 4.7863775,0 -0.0017,1.606793 -0.00353,3.213585 -0.0051,4.820375 1.7440936,0.0016 3.4881881,0.0033 5.2322842,0.005 -0.0014,-1.608503 -0.0018,-3.217015 -0.0028,-4.825519 1.58518,0 3.17036,0 4.755543,0 0.0033,-1.741851 0.0073,-3.483705 0.01072,-5.225556 -1.58808,0 -3.176158,0 -4.764238,0 0,-1.5775391 0,-3.1550792 0,-4.7326117 -0.135065,1.3e-4 -0.270128,1.982e-4 -0.40519,4.047e-4 z' stroke='black' fill='white'/%3E%3C/g%3E%3C/svg%3E%0A") 7 12, pointer`}}))}},[_,be,r]),Rt(e.getView(),{onFreezeSplitChange:()=>{xe()}}),Rt(e.getSelection(),{onChange:()=>{I()}});const We=()=>{W.getCommand("sheetViewFormatGridlinesColor").update({state:()=>e.getView().getGridLineColor(),context:()=>({onColorSelect:$=>{},darkMode:n.darkMode,autoColor:e.getStyles().parseColor(n.strokeFill),schemeLookup:e.getStyles().schemeLookup(),recentColors:()=>e.getStyles().recentColors(),addRecentColor:$=>e.getStyles().addRecentColor($),clearRecentColors:()=>e.getStyles().clearRecentColors()})}),W.getCommand("formatSheetTabColor").updateCallback($=>{e.setTabColor($)}).update({state:()=>e?.getTabColor()??Vl,context:()=>({onColorSelect:$=>{},darkMode:n.darkMode,autoColor:Vl,schemeLookup:e.getStyles().schemeLookup(),recentColors:()=>e.getStyles().recentColors(),addRecentColor:$=>e.getStyles().addRecentColor($),clearRecentColors:()=>e.getStyles().clearRecentColors()})})},qe=()=>{W.getCommand("formatBorder").update({context:()=>({onBorderSelect:$=>{w($)},darkMode:n.darkMode,quickBorder:p,autoColor:e.getStyles().getNormal().getFont().getFill(),autoStyle:pe.StrokeStyle.Thin,createTemporaryBorder:$=>e.getStyles().getNormal().createTemporaryStyle({border:$}).getBorder(),schemeLookup:e.getStyles().schemeLookup()})})};T.useEffect(()=>{qe()},[p]),T.useEffect(()=>{const $=!e.getProtection().isInsertHyperlinksAllowed();W.getCommand("openHyperlink").update({disabled:!A().getHyperlink()}),W.getCommand("deleteHyperlink").update({disabled:$||!A().getHyperlink()});const Y=A().getHyperlink()?"Edit":"Insert",Q="Link";W.getCommand("updateHyperlink").update({label:()=>(A().getHyperlink(),`${Y} ${Q}`),scopedLabels:{contextMenu:`${Y} ${Q}…`,insert:`${Q}…`,hyperlink:`${Y}…`},disabled:$})},[A()?.getHyperlink(),be]),T.useEffect(()=>{const $=A().getComments(),Y=()=>$?"Edit":"Insert",Q=()=>$?"Comments":"Comment";W.getCommand("updateComments").update({label:()=>`${Y()} ${Q()}`,scopedLabels:{contextMenu:`${Y()} ${Q()}…`,insert:`${Q()}…`}})},[A()?.getComments(),be]),Rt(e,{onViewChange:()=>{const $=e.getView();W.getCommand("sheetViewToggleFormulaView").update({state:$.isShowFormulas()}),W.getCommand("sheetViewToggleShowZeros").update({state:$.isShowZeros()}),W.getCommand("gridlinesToggle").update({state:$.isShowColumnGridlines()||$.isShowRowGridlines()}),W.getCommand("sheetViewToggleGridlinesColumns").update({state:$.isShowColumnGridlines()}),W.getCommand("sheetViewToggleGridlinesRows").update({state:$.isShowRowGridlines()}),W.getCommand("sheetViewToggleShowHeadings").update({state:$.isShowColumnHeaders()||$.isShowRowHeaders()}),W.getCommand("sheetViewToggleShowHeadingColumns").update({state:$.isShowColumnHeaders()}),W.getCommand("sheetViewToggleShowHeadingRows").update({state:$.isShowRowHeaders()}),W.getCommand("sheetViewToggleShowHeadingsNumeric").update({state:()=>e.getView().getColumnHeaderStyle()===an.HeaderTextStyle.Zero&&e.getView().getRowHeaderStyle()===an.HeaderTextStyle.Zero}),We()},onTabColorChange:()=>{We()},onMergesChange:()=>{xe()},onMovablesChange:()=>{xe()},onTablesChange:()=>{xe()},onProtectionChange:()=>{xe(),me()},onStyleChange:()=>{We(),qe(),xe()}}),T.useEffect(()=>{We(),qe()},[n]),T.useEffect(()=>{const $=!e.getProtection().isFormatCellsAllowed(),Y=E.length>0&&!O||$,Q=ne(O),K={context:Q};W.getCommand("editTable").update(K),W.getCommand("deleteTable").update(K),W.getCommand("convertTableToRange").update(K);const se={context:Q,disabled:Y};W.getCommand("formatTableStyle").update({label:O?"Apply Table Style":"Format As Table",...se}),W.getCommand("formatTableStyleClearCellStyles").update(se),W.getCommand("deleteTableStyle").update(se),W.getCommand("convertTableToRange").update(se),W.getCommand("insertTable").update({disabled:Y||E.length>0});const X={context:Q,disabled:Y||E.length===0};W.getCommand("tableHeaderRowToggle").update(X),W.getCommand("tableTotalRowToggle").update(X),W.getCommand("autoFilterToggle").update(X),W.getCommand("formatTableStyleClearTableStyle").update({...X,disabled:X.disabled||!O||O.getStyleOptions().name===null})},[O,E,be]),T.useEffect(()=>{W.getCommand("sheetZoomOut").updateCallback(()=>{e.getView().update({zoomScale:V.findNextStep(e.getView().getZoomScale(),!1)})}),W.getCommand("sheetZoomIn").updateCallback(()=>{e.getView().update({zoomScale:V.findNextStep(e.getView().getZoomScale())})}),W.getCommand("sheetZoom100").updateCallback(()=>{e.getView().update({zoomScale:100})}),W.getCommand("gridlinesToggle").updateCallback(()=>{const $=e.getView().isShowColumnGridlines()&&e.getView().isShowRowGridlines();e.getView().update({showColumnGridlines:!$,showRowGridlines:!$})}),W.getCommand("sheetViewToggleGridlinesRows").updateCallback(()=>{e.getView().update({showRowGridlines:!e.getView().isShowRowGridlines()})}),W.getCommand("sheetViewToggleGridlinesColumns").updateCallback(()=>{e.getView().update({showColumnGridlines:!e.getView().isShowColumnGridlines()})}),W.getCommand("sheetViewFormatGridlinesColor").updateCallback($=>{e.getView().update({gridLineColor:$})}),W.getCommand("sheetViewToggleShowHeadings").updateCallback(()=>{const $=e.getView().isShowColumnHeaders()&&e.getView().isShowRowHeaders();e.getView().update({showColumnHeaders:!$,showRowHeaders:!$})}),W.getCommand("sheetViewToggleShowHeadingColumns").updateCallback(()=>{e.getView().update({showColumnHeaders:!e.getView().isShowColumnHeaders()})}),W.getCommand("sheetViewToggleShowHeadingRows").updateCallback(()=>{e.getView().update({showRowHeaders:!e.getView().isShowRowHeaders()})}),W.getCommand("sheetViewToggleShowHeadingsNumeric").updateCallback(()=>{const $=e.getView().getColumnHeaderStyle()===an.HeaderTextStyle.Zero&&e.getView().getRowHeaderStyle()===an.HeaderTextStyle.Zero;e.getView().update({columnHeaderStyle:$?an.HeaderTextStyle.A1:an.HeaderTextStyle.Zero,rowHeaderStyle:$?an.HeaderTextStyle.One:an.HeaderTextStyle.Zero})}),W.getCommand("sheetViewToggleFormulaView").updateCallback(()=>{e.getView().update({showFormulas:!e.getView().isShowFormulas()})}),W.getCommand("sheetViewToggleShowZeros").updateCallback(()=>{e.getView().update({showZeros:!e.getView().isShowZeros()})}),W.getCommand("calculate").updateCallback(()=>{e.getEntireRange().calculate(!0)}),W.getCommand("insertFunction").update({context:()=>({searchByCategory:$=>(console.log("category",$),[])})})},[e]),T.useEffect(()=>{const $=e.getView().getFreezePanes(),Y=()=>$.coords.rowIndex!==0,Q=()=>$.coords.colIndex!==0,K=()=>$.coords.rowIndex!==0||$.coords.colIndex!==0;W.getCommand("freezeToggle").updateCallback(()=>{K()?e.getView().setFreezePanes(null):K()?Q()?e.getView().setFreezePanes({coords:{rowIndex:c.rowIndex}}):Y()&&e.getView().setFreezePanes({coords:{colIndex:c.colIndex}}):e.getView().setFreezePanes({coords:c})}).update({state:K,disabled:()=>!c||!K()&&c.rowIndex===0&&c.colIndex===0}),W.getCommand("freezeToggleHorizontal").updateCallback(()=>{e.getView().setFreezePanes({coords:{rowIndex:Y()?0:c.rowIndex}})}).update({state:Y,disabled:()=>!c||!Y()&&c.rowIndex===0}),W.getCommand("freezeToggleVertical").updateCallback(()=>{e.getView().setFreezePanes({coords:{colIndex:Q()?0:c.colIndex}})}).update({state:Q,disabled:()=>!c||!Q()&&c.colIndex===0}),W.getCommand("unfreeze").updateCallback(()=>{e.getView().setFreezePanes(null)}).update({disabled:()=>!K()})},[de,c,e,n]);const De=A().getStyle(),Te=De.getFont(),ze=De.getAlignment(),Z=ze.getHorizontal(),Se=ze.getVertical(),te=ze.getOverflow(),ie=ze.getRotation();return T.useEffect(()=>{W.getCommand("formatCellStyle").update({context:()=>({styles:()=>e.getStyles(),named:()=>A().getStyle(!0).getNamed(),bodyStyle:U,createTemporaryCell:tt=>e.createTemporaryCell(tt)})}),W.getCommand("formatFillColor").update({state:()=>{let tt=null;const yt=De.getFill();return yt?.getType()===Pe.Type.Solid?tt=yt.getColor():yt?.getType()===Pe.Type.Gradient?tt=yt.getStops()?.[0]?.getColor():yt?.getType()===Pe.Type.Pattern&&(tt=yt.getBackground()),tt},context:()=>{const tt=e.getStyles();return{onColorSelect:yt=>{b(yt??Vl)},darkMode:n.darkMode,quickColor:S,autoColor:Vl,schemeLookup:tt.schemeLookup(),recentColors:tt.recentColors(),addRecentColor:yt=>tt.addRecentColor(yt),clearRecentColors:()=>tt.clearRecentColors()}}}),W.getCommand("formatFontColor").update({state:()=>Te.toJSON()?.fill?Te.getFill():null,context:()=>{const tt=e.getStyles();return{onColorSelect:yt=>{y(yt)},darkMode:n.darkMode,quickColor:v,autoColor:tt.getNormal().getFont().getFill(),schemeLookup:tt.schemeLookup(),recentColors:tt.recentColors(),addRecentColor:yt=>tt.addRecentColor(yt),clearRecentColors:()=>tt.clearRecentColors()}}}),W.getCommand("formatNumberFormat").update({state:()=>De.getNumberFormat(),context:()=>A}),W.getCommand("formatNumberDialog").update({state:()=>De.getNumberFormat(),context:()=>A}),W.getCommand("formatFontFamily").update({state:()=>Te.getFamily()}),W.getCommand("formatFontSize").update({state:()=>Te.getSize()});const $=function(){const tt=Te.getWeight()||0;return!isNaN(tt)&&tt>500};W.getCommand("formatBoldToggle").updateCallback(function(){k(this,{font:{weight:$()?400:700}})}).update({state:$});const Y=function(){return Te.getStyle()===ke.Style.Italic};W.getCommand("formatItalicToggle").updateCallback(function(){k(this,{font:{style:Y()?ke.Style.Normal:ke.Style.Italic}})}).update({state:Y}),W.getCommand("formatStrikeThroughToggle").updateCallback(function(){k(this,{font:{strike:!Te.getStrike()}})}).update({state:Te.getStrike()}),W.getCommand("formatUnderlinedToggle").updateCallback(function(){k(this,{font:{underline:Te.getUnderline()!==ke.UnderlineStyle.Single?ke.UnderlineStyle.Single:ke.UnderlineStyle.None}})}).update({state:Te.getUnderline()===ke.UnderlineStyle.Single}),W.getCommand("formatUnderlinedDoubleToggle").updateCallback(function(){k(this,{font:{underline:Te.getUnderline()!==ke.UnderlineStyle.Double?ke.UnderlineStyle.Double:ke.UnderlineStyle.None}})}).update({state:Te.getUnderline()===ke.UnderlineStyle.Double}),W.getCommand("formatUnderlinedAccountingToggle").updateCallback(function(){k(this,{font:{underline:Te.getUnderline()!==ke.UnderlineStyle.SingleAccounting?ke.UnderlineStyle.SingleAccounting:ke.UnderlineStyle.None}})}).update({state:Te.getUnderline()===ke.UnderlineStyle.SingleAccounting}),W.getCommand("formatUnderlinedAccountingDoubleToggle").updateCallback(function(){k(this,{font:{underline:Te.getUnderline()!==ke.UnderlineStyle.DoubleAccounting?ke.UnderlineStyle.DoubleAccounting:ke.UnderlineStyle.None}})}).update({state:Te.getUnderline()===ke.UnderlineStyle.DoubleAccounting}),W.getCommand("formatSuperscriptToggle").updateCallback(function(){k(this,{font:{verticalAlign:Te.getVerticalAlignment()!==ke.VerticalAlignment.Super?ke.VerticalAlignment.Super:ke.VerticalAlignment.Baseline}})}).update({state:Te.getVerticalAlignment()===ke.VerticalAlignment.Super}),W.getCommand("formatSubscriptToggle").updateCallback(function(){k(this,{font:{verticalAlign:Te.getVerticalAlignment()!==ke.VerticalAlignment.Sub?ke.VerticalAlignment.Sub:ke.VerticalAlignment.Baseline}})}).update({state:Te.getVerticalAlignment()===ke.VerticalAlignment.Sub});const Q=()=>te===oe.Overflow.Visible;W.getCommand("formatTextOverflowVisibleToggle").updateCallback(function(){k(this,{alignment:{overflow:(Q(),oe.Overflow.Visible)}})}).update({state:Q});const K=()=>te===oe.Overflow.Wrap;W.getCommand("formatTextOverflowWrapToggle").updateCallback(function(){k(this,{alignment:{overflow:K()?oe.Overflow.Visible:oe.Overflow.Wrap}})}).update({state:K});const se=function(){return te===oe.Overflow.Clip};W.getCommand("formatTextOverflowClipToggle").updateCallback(function(){k(this,{alignment:{overflow:se()?oe.Overflow.Visible:oe.Overflow.Clip}})}).update({state:se});const X=function(){return te===oe.Overflow.Shrink};W.getCommand("formatTextOverflowShrinkToggle").updateCallback(function(){k(this,{alignment:{overflow:X()?oe.Overflow.Visible:oe.Overflow.Shrink}})}).update({state:X});const ue=function(){return te===oe.Overflow.Shrink};W.getCommand("formatTextOverflowEllipsisToggle").updateCallback(function(){k(this,{alignment:{overflow:ue()?oe.Overflow.Visible:oe.Overflow.Ellipsis}})}).update({state:ue,disabled:!0});const _e=function(){return Se===oe.VerticalAlignment.Top};W.getCommand("formatAlignTopToggle").updateCallback(function(){k(this,{alignment:{vertical:_e()?oe.VerticalAlignment.Bottom:oe.VerticalAlignment.Top}})}).update({state:_e});const Re=function(){return Se===oe.VerticalAlignment.Center};W.getCommand("formatAlignMiddleToggle").updateCallback(function(){k(this,{alignment:{vertical:Re()?oe.VerticalAlignment.Bottom:oe.VerticalAlignment.Center}})}).update({state:Re});const Ne=function(){return Se===oe.VerticalAlignment.Bottom};W.getCommand("formatAlignBottomToggle").updateCallback(function(){k(this,{alignment:{vertical:(Ne(),oe.VerticalAlignment.Bottom)}})}).update({state:Ne});const Oe=function(){return Se===oe.VerticalAlignment.Justify};W.getCommand("formatAlignJustifyVerticalToggle").updateCallback(function(){k(this,{alignment:{vertical:Oe()?oe.VerticalAlignment.Bottom:oe.VerticalAlignment.Justify}})}).update({state:Oe});const Be=function(){return Se===oe.VerticalAlignment.Distributed};W.getCommand("formatAlignDistributedVerticalToggle").updateCallback(function(){k(this,{alignment:{vertical:Be()?oe.VerticalAlignment.Bottom:oe.VerticalAlignment.Distributed}})}).update({state:Be});const Ue=function(){return Z===oe.HorizontalAlignment.Left};W.getCommand("formatAlignLeftToggle").updateCallback(function(){k(this,{alignment:{horizontal:Ue()?oe.HorizontalAlignment.General:oe.HorizontalAlignment.Left}})}).update({state:Ue});const $e=function(){return Z===oe.HorizontalAlignment.Center};W.getCommand("formatAlignCenterToggle").updateCallback(function(){k(this,{alignment:{horizontal:$e()?oe.HorizontalAlignment.General:oe.HorizontalAlignment.Center}})}).update({state:$e});const Ve=function(){return Z===oe.HorizontalAlignment.CenterContinuous};W.getCommand("formatAlignCenterContinuousToggle").updateCallback(function(){const tt={alignment:{horizontal:Ve()?oe.HorizontalAlignment.General:oe.HorizontalAlignment.CenterContinuous,rotation:null}};k(this,tt)}).update({state:Ve});const Je=function(){return Z===oe.HorizontalAlignment.Fill};W.getCommand("formatAlignFillToggle").updateCallback(function(){const tt={alignment:{horizontal:Je()?oe.HorizontalAlignment.General:oe.HorizontalAlignment.Fill,rotation:null}};k(this,tt)}).update({state:Je});const rt=function(){return Z===oe.HorizontalAlignment.Distributed};W.getCommand("formatAlignDistributedHorizontalToggle").updateCallback(function(){k(this,{alignment:{horizontal:rt()?oe.HorizontalAlignment.General:oe.HorizontalAlignment.Distributed}})}).update({state:rt});const et=function(){return Z===oe.HorizontalAlignment.Right};W.getCommand("formatAlignRightToggle").updateCallback(function(){k(this,{alignment:{horizontal:et()?oe.HorizontalAlignment.General:oe.HorizontalAlignment.Right}})}).update({state:et});const at=function(){return Z===oe.HorizontalAlignment.Justify};W.getCommand("formatAlignJustifyToggle").updateCallback(function(){k(this,{alignment:{horizontal:at()?oe.HorizontalAlignment.General:oe.HorizontalAlignment.Justify}})}).update({state:at});const nt=!e.getProtection().isFormatCellsAllowed(),ht=Z===oe.HorizontalAlignment.CenterContinuous||Z===oe.HorizontalAlignment.Fill;W.getCommand("formatTextRotate0").updateCallback(function(tt){k(this,{alignment:{rotation:0}})}).update({disabled:nt||ht,state:ie===0}),W.getCommand("formatTextRotate45").updateCallback(function(tt){k(this,{alignment:{rotation:tt??1?45:0}})}).update({disabled:nt||ht,state:ie===45}),W.getCommand("formatTextRotate90").updateCallback(function(tt){k(this,{alignment:{rotation:tt??1?90:0}})}).update({disabled:nt||ht,state:ie===90}),W.getCommand("formatTextRotate270").updateCallback(function(tt){k(this,{alignment:{rotation:tt??1?270:0}})}).update({disabled:nt||ht,state:ie===270}),W.getCommand("formatTextRotate315").updateCallback(function(tt){k(this,{alignment:{rotation:tt??1?315:0}})}).update({disabled:nt||ht,state:ie===315}),W.getCommand("formatTextRotateCustom").updateCallback(function(tt){k(this,{alignment:{rotation:tt}})}).update({disabled:nt||ht,state:ie??0})},[De,e,n,S,v]),T.useEffect(()=>{const $=!e.getProtection().isFormatCellsAllowed(),Y=e.getSelectedRanges().getMerges().length>0,Q=async(dt,Dt)=>{M(Dt,async In=>{const Fn=async(un=!1)=>{const Wt=await Promise.resolve(i?.showBusy?.(Dt.label()));try{const $r=In.getSelectedRanges();if($r.merge({orientations:dt,discardMultipleValues:un}),dt===B.Orientations.Both){const zo={alignment:{horizontal:oe.HorizontalAlignment.Center}};$r.updateStyle(zo)}}catch($r){throw $r}finally{Wt?.()}};let An;try{await Fn()}catch(un){if(un.type!=="discardMultipleValues")throw un;An=!0}if(An&&i?.showOptions){if(await i?.showOptions({title:"Confirm",description:"Merging cells will only keep the upper-left value. Some data will be discarded. Continue?",options:["Merge","Cancel"],defaultOption:"Merge"})!=="Merge")return;await Fn(!0)}},void 0,void 0,!1)},K=dt=>{M(dt,async Dt=>{try{const In=Dt.getSelectedRanges();In.unmerge();const Fn={alignment:{horizontal:null}};In.updateStyle(Fn)}catch(In){throw In}})};W.getCommand("mergeToggle").updateCallback(function(){J.isSingleCell(e.getSelectedRange().getCoords())||(Y?K(this):Q(B.Orientations.Both,this))}).update({state:Y,disabled:!Ze||$}),W.getCommand("mergeHorizontal").updateCallback(function(){Q(B.Orientations.Column,this)}).update({disabled:!Ze||$}),W.getCommand("mergeVertical").updateCallback(function(){Q(B.Orientations.Row,this)}).update({disabled:!Ze}),W.getCommand("unmerge").updateCallback(function(){K(this)}).update({disabled:!Y||!Ze||$});const se={disabled:$};W.getCommand("hideRows").updateCallback(function(){M(this,dt=>{dt.getRowHeaders().setHidden(dt.getSelectedRanges().getCoords(),!0)})}).update(se),W.getCommand("hideColumns").updateCallback(function(){M(this,dt=>{dt.getColumnHeaders().setHidden(dt.getSelectedRanges().getCoords(),!0)})}).update(se),W.getCommand("unhideRows").updateCallback(function(){M(this,dt=>{dt.getRowHeaders().setHidden(dt.getSelectedRanges().getCoords(),!1)})}).update(se),W.getCommand("unhideColumns").updateCallback(function(){M(this,dt=>{dt.getColumnHeaders().setHidden(dt.getSelectedRanges().getCoords(),!1)})}).update(se),W.getCommand("autoFitRows").updateCallback(function(){M(this,dt=>{dt.getSelectedRanges().autoFit({orientations:B.Orientations.Row})})}).update(se),W.getCommand("autoFitColumns").updateCallback(function(){M(this,dt=>{dt.getSelectedRanges().autoFit({orientations:B.Orientations.Column})})}).update(se);let X=!1,ue=0,_e=!1,Re=!1,Ne=0,Oe=!1;!d||$||Ge||(X=d.isEntireColumnsAny(),X&&!d.isEntireColumns()?_e=!0:ue=d.getColumnCount(),Re=d.isEntireRowsAny(),Re&&!d.isEntireRows()?Oe=!0:Ne=d.getRowCount());const Be={disabled:$||d&&d.getCount()!==1};W.getCommand("sortAscending").update(Be),W.getCommand("sortDescending").update(Be);const Ue={disabled:X||Re||$||Ge},$e=X||$||Ge||Oe;$e&&(ue=1);const Ve=Re||$||Ge||_e;Ve&&(Ne=1);let Je="",rt="",et="",at="",nt="",ht="",tt="",yt="",Xt="";ue>1&&(ht=rt=ue+" ",tt=et="s"),Ne>1&&(yt=at=Ne+" ",Xt=nt="s"),_.getMode()?.key==="copy"?(Je=at=rt="Copied ",et=nt="s"):_.getMode()?.key==="cut"&&(Je=at=rt="Cut ",et=nt="s");let Rn="",$n="";if(d){const dt=d.getDefaultShiftOrientation()===B.Orientation.Column;Rn=` (${dt?"Shift Right":"Shift Down"})`,$n=` (${dt?"Shift Left":"Shift up"})`,W.getCommand("deleteCells").update({label:`Delete Cells${$n}`})}W.getCommand("insertCells").update({label:`Insert ${Je}Cells${Rn}`,scopedLabels:{insertCells:`${Je}At Selection`}}),W.getCommand("insertCellsShiftRight").update(Ue),W.getCommand("insertCellsShiftDown").update(Ue),W.getCommand("deleteCellsShiftUp").update(Ue),W.getCommand("deleteCellsShiftLeft").update(Ue),W.getCommand("insertRows").update({label:`Insert ${at}Row${nt}`,scopedLabels:{insertCells:`${at}Row${nt}`},disabled:Ve}),W.getCommand("insertRowsAfter").update({label:`Insert ${at}Row${nt} Below`,disabled:Ve}),W.getCommand("insertColumns").update({label:`Insert ${rt}Column${et}`,scopedLabels:{insertCells:`${rt}Column${et}`},disabled:$e}),W.getCommand("insertColumnsAfter").update({label:`Insert ${rt}Column${et} After`,disabled:$e}),W.getCommand("deleteRows").update({label:`Delete ${yt}Row${Xt}`,scopedLabels:{deleteCells:`${yt}Row${Xt}`},disabled:Ve}),W.getCommand("deleteColumns").update({label:`Delete ${ht}Column${tt}`,scopedLabels:{deleteCells:`${ht}Column${tt}`},disabled:$e})},[de,Ze,Ge,d,_,i,be]),T.useEffect(()=>{const $=e.getProtection(),Y=e.getProtection().isLocked(),Q=!$.isFormatCellsAllowed(),K={disabled:Q};W.getCommand("protectionSheetToggle").updateCallback(async(ue,_e)=>{let Re=null;try{if(Y){let Ne=null;if($.hasPassword()){const Oe=await i?.showInputOptions({title:"Password Required",description:"Enter a password to unprotected",options:["Unprotect","Cancel"],defaultOption:"Unprotect",inputType:"password"});if(Oe.option!=="Unprotect")return;Ne=Oe.input}Re=await Promise.resolve(i?.showBusy?.(_e.label())),await $.unlock(Ne)}else Re=await Promise.resolve(i?.showBusy?.(_e.label())),await $.lock();Re?.()}catch(Ne){Re?.(),i?.showError?.(Ne)}}).update({state:Y,label:()=>Y?"Unprotect Sheet":"Protect Sheet",scopedLabels:{sheet:Y?"Unprotect":"Protect"}}),W.getCommand("deleteTable").update(K),W.getCommand("sortAscending").update(K),W.getCommand("sortDescending").update(K),W.getCommand("sortCustom")?.update(K),W.getCommand("updateComments").update(K),W.getCommand("deleteComments").update(K),W.getCommand("insertChart")?.update(K),W.getCommand("insertImageFromFile").update(K),W.getCommand("insertImageFromURL").update(K),W.getCommand("formatBorder").update(K),W.getCommand("formatFillColor").update(K),W.getCommand("formatFontColor").update(K),W.getCommand("formatBoldToggle").update(K),W.getCommand("formatItalicToggle").update(K),W.getCommand("formatUnderlinedToggle").update(K),W.getCommand("formatStrikeThroughToggle").update(K),W.getCommand("formatSuperscriptToggle").update(K),W.getCommand("formatSubscriptToggle").update(K),W.getCommand("formatAlignTopToggle").update(K),W.getCommand("formatTextOverflowVisibleToggle").update(K),W.getCommand("formatTextOverflowWrapToggle").update(K),W.getCommand("formatTextOverflowClipToggle").update(K),W.getCommand("formatTextOverflowShrinkToggle").update(K),W.getCommand("formatAlignMiddleToggle").update(K),W.getCommand("formatAlignBottomToggle").update(K),W.getCommand("formatAlignDistributedVerticalToggle").update(K),W.getCommand("formatAlignJustifyVerticalToggle").update(K),W.getCommand("formatAlignLeftToggle").update(K),W.getCommand("formatAlignCenterToggle").update(K),W.getCommand("formatAlignRightToggle").update(K),W.getCommand("formatAlignJustifyToggle").update(K),W.getCommand("formatAlignCenterContinuousToggle").update(K),W.getCommand("formatAlignDistributedHorizontalToggle").update(K),W.getCommand("formatAlignFillToggle").update(K),W.getCommand("formatFontSizeIncrease").update(K),W.getCommand("formatFontSizeDecrease").update(K),W.getCommand("formatFontFamily").update(K),W.getCommand("formatFontSize").update(K),W.getCommand("formatNumberFormat").update(K),W.getCommand("formatNumberFormatGeneralStyle").update(K),W.getCommand("formatNumberFormatNumberStyle").update(K),W.getCommand("formatNumberFormatTimeStyle").update(K),W.getCommand("formatNumberFormatDateStyle").update(K),W.getCommand("formatNumberFormatAccountingStyle").update(K),W.getCommand("formatNumberFormatPercentStyle").update(K),W.getCommand("formatNumberFormatScientificStyle").update(K),W.getCommand("formatNumberFormatCommaStyle").update(K),W.getCommand("formatNumberFormatIncreaseDecimal").update(K),W.getCommand("formatNumberFormatDecreaseDecimal").update(K),W.getCommand("hideColumns").update(K),W.getCommand("unhideColumns").update(K),W.getCommand("hideRows").update(K),W.getCommand("unhideRows").update(K),W.getCommand("insertFunctionSum").update(K),W.getCommand("insertFunctionAverage").update(K),W.getCommand("insertFunctionCount").update(K),W.getCommand("insertFunctionMax").update(K),W.getCommand("insertFunctionMin").update(K),W.getCommand("insertFunction").update(K),W.getCommand("startEditCurrentTime").update(K),W.getCommand("startEditCurrentDate").update(K),W.getCommand("startEditValueAbove").update(K),W.getCommand("fillDown").update(K),W.getCommand("fillRight").update(K),W.getCommand("fillUp").update(K),W.getCommand("fillLeft").update(K),W.getCommand("formatCellStyle").update(K),W.getCommand("formatTableStyle").update(K),W.getCommand("formatPainterToggle").update(K),W.getCommand("formatBorderAddOutline").update(K),W.getCommand("formatBorderClearOutline").update(K),W.getCommand("formatIndentDecrease").update(K),W.getCommand("formatIndentIncrease").update(K),W.getCommand("clearContents").update(K),W.getCommand("clearFormats").update(K),W.getCommand("clearAll").update(K),W.getCommand("clearComments").update(K),W.getCommand("clearHyperlinks").update(K),W.getCommand("autoFilterClear").update(K),W.getCommand("autoFilterReapply").update(K);const se=Z===oe.HorizontalAlignment.CenterContinuous||Z===oe.HorizontalAlignment.Fill,X={disabled:Q||se};W.getCommand("formatTextRotate0").update(X),W.getCommand("formatTextRotate45").update(X),W.getCommand("formatTextRotate90").update(X),W.getCommand("formatTextRotate270").update(X),W.getCommand("formatTextRotate315").update(X),W.getCommand("formatTextRotateCustom").update(X),W.getCommand("formatTextRotateVertical").update(X)},[de]),W}var qm,Jm;(function(){if(Jm)return qm;Jm=1;var s=/^\s+|\s+$/g,e=/^[-+]0x[0-9a-f]+$/i,t=/^0b[01]+$/i,n=/^0o[0-7]+$/i,r=parseInt,o=typeof Ii=="object"&&Ii&&Ii.Object===Object&&Ii,i=typeof self=="object"&&self&&self.Object===Object&&self,l=o||i||Function("return this")(),a=Object.prototype.toString,c=Math.max,u=Math.min,d=function(){return l.Date.now()};function h(g){var m=typeof g;return!!g&&(m=="object"||m=="function")}function f(g){if(typeof g=="number")return g;if(function(w){return typeof w=="symbol"||function(S){return!!S&&typeof S=="object"}(w)&&a.call(w)=="[object Symbol]"}(g))return NaN;if(h(g)){var m=typeof g.valueOf=="function"?g.valueOf():g;g=h(m)?m+"":m}if(typeof g!="string")return g===0?g:+g;g=g.replace(s,"");var p=t.test(g);return p||n.test(g)?r(g.slice(2),p?2:8):e.test(g)?NaN:+g}qm=function(g,m,p){var w,S,b,v,y,_,C=0,E=!1,x=!1,R=!0;if(typeof g!="function")throw new TypeError("Expected a function");function I(L){var N=w,D=S;return w=S=void 0,C=L,v=g.apply(D,N)}function A(L){var N=L-_;return _===void 0||N>=m||N<0||x&&L-C>=b}function M(){var L=d();if(A(L))return k(L);y=setTimeout(M,function(N){var D=m-(N-_);return x?u(D,b-(N-C)):D}(L))}function k(L){return y=void 0,R&&w?I(L):(w=S=void 0,v)}function F(){var L=d(),N=A(L);if(w=arguments,S=this,_=L,N){if(y===void 0)return function(D){return C=D,y=setTimeout(M,m),E?I(D):v}(_);if(x)return y=setTimeout(M,m),I(_)}return y===void 0&&(y=setTimeout(M,m)),v}return m=f(m)||0,h(p)&&(E=!!p.leading,b=(x="maxWait"in p)?c(f(p.maxWait)||0,m):b,R="trailing"in p?!!p.trailing:R),F.cancel=function(){y!==void 0&&clearTimeout(y),C=0,w=_=S=y=void 0},F.flush=function(){return y===void 0?v:k(d())},F}})();var Km,Xm,$u={};Xm||(Xm=1,function(){if(Km)return $u;Km=1;var s=ut,e=typeof Object.is=="function"?Object.is:function(a,c){return a===c&&(a!==0||1/a==1/c)||a!=a&&c!=c},t=s.useState,n=s.useEffect,r=s.useLayoutEffect,o=s.useDebugValue;function i(a){var c=a.getSnapshot;a=a.value;try{var u=c();return!e(a,u)}catch{return!0}}var l=typeof window>"u"||window.document===void 0||window.document.createElement===void 0?function(a,c){return c()}:function(a,c){var u=c(),d=t({inst:{value:u,getSnapshot:c}}),h=d[0].inst,f=d[1];return r(function(){h.value=u,h.getSnapshot=c,i(h)&&f({inst:h})},[a,u,c]),n(function(){return i(h)&&f({inst:h}),a(function(){i(h)&&f({inst:h})})},[a]),o(u),u};return $u.useSyncExternalStore=s.useSyncExternalStore!==void 0?s.useSyncExternalStore:l,$u}());var Zm,Ym,Wl={exports:{}},as={exports:{}},Ix=as.exports;function Qm(s,e){typeof s=="function"?s(e):s!=null&&(s.current=e)}(function(){if(Ym)return Wl.exports;Ym=1;for(var s=(Zm||(Zm=1,(function(){var d,h,f,g,m,p;typeof performance<"u"&&performance!==null&&performance.now?as.exports=function(){return performance.now()}:typeof process<"u"&&process!==null&&process.hrtime?(as.exports=function(){return(d()-m)/1e6},h=process.hrtime,g=(d=function(){var w;return 1e9*(w=h())[0]+w[1]})(),p=1e9*process.uptime(),m=g-p):Date.now?(as.exports=function(){return Date.now()-f},f=Date.now()):(as.exports=function(){return new Date().getTime()-f},f=new Date().getTime())}).call(Ix)),as.exports),e=typeof window>"u"?Ii:window,t=["moz","webkit"],n="AnimationFrame",r=e["request"+n],o=e["cancel"+n]||e["cancelRequest"+n],i=0;!r&&i<t.length;i++)r=e[t[i]+"Request"+n],o=e[t[i]+"Cancel"+n]||e[t[i]+"CancelRequest"+n];if(!r||!o){var l=0,a=0,c=[],u=1e3/60;r=function(d){if(c.length===0){var h=s(),f=Math.max(0,u-(h-l));l=f+h,setTimeout(function(){var g=c.slice(0);c.length=0;for(var m=0;m<g.length;m++)if(!g[m].cancelled)try{g[m].callback(l)}catch(p){setTimeout(function(){throw p},0)}},Math.round(f))}return c.push({handle:++a,callback:d,cancelled:!1}),a},o=function(d){for(var h=0;h<c.length;h++)c[h].handle===d&&(c[h].cancelled=!0)}}Wl.exports=function(d){return r.call(e,d)},Wl.exports.cancel=function(){o.apply(e,arguments)},Wl.exports.polyfill=function(d){d||(d=e),d.requestAnimationFrame=r,d.cancelAnimationFrame=o}})();const Jw=T.memo(T.forwardRef((s,e)=>{const{style:t=wt.EmptyCssProperties,orientation:n,sheet:r,onShowTooltip:o,onCloseTooltip:i,onScrollOffset:l,showCustomScrollButtons:a=!1,offset:c=0,totalSize:u=0,viewportSize:d=0,...h}=s;if(!r)throw new Error("SheetScrollBar needs a sheet model");const[f]=ko(),g=Fe(o,[o]),m=Fe(i,[i]),p=T.useMemo(()=>w===null&&S===null?null:q=>{Qm(w,q),Qm(S,q)},[w=f,S=e]);var w,S;const[b,v]=T.useState(()=>{const q=r.getView().getTopLeft();return n===vo.Vertical?q.top:q.left}),y=()=>{const q=r.getView().getFreezePanes();return n===vo.Vertical?q.coords.rowIndex===0?{shift:0,scroll:0}:{shift:r.getRowHeaders().findOffset(q.coords.rowIndex)-q.topLeft.top,scroll:q.topLeft.top}:q.coords.colIndex===0?{shift:0,scroll:0}:{shift:r.getColumnHeaders().findOffset(q.coords.colIndex)-q.topLeft.left,scroll:q.topLeft.left}},[_,C]=T.useState(y),[E,x]=T.useState(null),[R,I]=T.useState(!1),A=n===vo.Vertical?r.getRowHeaders():r.getColumnHeaders(),M=()=>{const q=r.getUsedRange()?.getCoords()??J.EmptyRange,P=r.getSelection().getCoords().cell;return{colIndex:Math.max(q.colEnd,P.colIndex),rowIndex:Math.max(q.rowEnd,P.rowIndex)}},[k,F]=T.useState(M),L=k?(n===vo.Vertical?k.rowIndex:k.colIndex)+1:0,N=()=>{const q=M();J.isEqualCells(k,q)||F(q)};Rt(r.getView(),{onFreezeSplitChange:()=>{C(y)}}),Rt(r.getSelection(),{onChange:N}),Rt(r,{onUsedRangeChange:N}),T.useEffect(()=>{F(M())},[r]),T.useEffect(()=>{if(!E)return R&&m?.(),void I(!1);const q=A.getTextAt(A.findIndex(b/(r.getView().getZoomScale()/100)+_.scroll+_.shift));I(!0),g?.({...E,display:(n===vo.Vertical?"Row":"Column")+": "+q})},[c,b,_,n,E,A,R,r]);const D=Fe((q,P,U)=>{v(q);const ne=q+_.scroll,ee=P+_.shift,ve=U+_.shift+_.scroll;l?.(ne,ee,ve)},[l,_]),O=c-_.scroll,H=d-_.shift,z=u-(_.shift+_.scroll),j=A.findOffset(L)*(r.getView().getZoomScale()/100)-(_.scroll+_.shift);return ge.jsx(jS,{ref:p,style:t,offset:O,viewportSize:H,totalSize:z,orientation:n,showCustomScrollButtons:a,onMouseDown:q=>{x({anchor:{x:q.clientX,y:q.clientY}}),q.preventDefault()},onScrollOffset:D,onMouseOut:()=>{x(null)},onMouseUp:()=>{x(null)},minSize:j,...h})}));Jw.displayName="SheetScrollbar";const ep=(s,e,t=null)=>{const n=[];for(let r=0;r<s.length;r++)if(s[r].value.isSelectedAll){if(s[r].min===s[r].max&&s[r].min===t)continue;n.push({address:{min:s[r].min,max:s[r].max},update:e})}return n},tp=T.memo(T.forwardRef((s,e)=>{const{sheetHeader:t,gridRef:n,sheetElement:r,commands:o,oppositeSize:i=30,containerWidth:l,containerHeight:a,headerText:c,freezeStart:u,gridStyle:d,verticalPadding:h,horizontalPadding:f,onSheetContextMenu:g,onResizeHeadersStart:m,onResizeHeaders:p,onResizeHeadersEnd:w,onResizeHeadersDown:S,onResizeHeadersUp:b,scrollPoint:v,onSelectionStart:y,onSelectionEnd:_}=s,C=T.useMemo(()=>t.getOrientation(),[t]),E=T.useRef(null),[x,R]=T.useReducer(te=>te+1,0),[I,A]=T.useReducer(te=>te+1,0),M=t?.getSheet(),k=T.useRef(!1);T.useLayoutEffect(()=>{k.current=!0},[t]);const F=T.useMemo(()=>t.getEntireRange().getCoords().max+1,[t]),L=T.useMemo(()=>{const te=C===B.Orientation.Column;return{left:te?v.left:0,top:te?0:v.top}},[v]),[N,D]=T.useState(M?.getView().getZoomScale()/100),[O,H]=T.useState(null);Rt(t,{onSizesChange:te=>{D(M?.getView().getZoomScale()/100),be(he())}});const z=T.useCallback(()=>{E.current?.invalidate(),A()},[]),j=T.useCallback(V.debounce(()=>{z()},10),[]),[q,P]=T.useState(null);Rt(t.getSheet(),{onSelectionChange(){P(M?.getSelection().getCoords()),j()},onProtectionChange(){z()},onViewChange(){j()}}),T.useLayoutEffect(()=>{be(he())},[C,N,i]),T.useLayoutEffect(()=>{H(null),D(t?.getSheet().getView().getZoomScale()/100),be(he())},[t]);const U=T.useCallback(te=>t.at(te)?.isHidden()||t.at(te)?.getSize()===0,[t]),ne=T.useCallback((te,ie)=>t.hiddenHeadersAt(te,ie),[U]),ee=Fe(te=>t.isSelected(te),[t]),ve=Fe(te=>t.isSelectedAll(te),[t]),le=T.useCallback(()=>t.getMinSize(),[t]),Ce=T.useCallback(()=>t.getMaxSize(),[t]),re=Fe((te,ie,$)=>{ie/=N;const Y={size:ie=Math.max(le(),Math.min(V.roundAccurately(ie,le()),Ce())),hidden:!1},Q=[];if(ie<=0&&(Y.hidden=!0,Y.size=$),Q.push({address:{min:te,max:te},update:Y}),ie<0){const K=C===B.Orientation.Column,se=K?we.getColOffset:we.getRowOffset,X=K?we.getColIndex:we.getRowIndex,ue=se(te);let _e=X(ue+ie);const Re=se(_e);Re===ue+ie?_e--:Q.push({address:{min:_e,max:_e},update:{size:ue-Re+ie}}),te-_e>1&&Q.push({address:{min:_e+1,max:te-1},update:{hidden:!0}})}t.updateHeaderPairs(Q),p?.(te,ie,$)},[x,t,N,p]),ae=Fe((te,ie,$)=>{const Y=C===B.Orientation.Column;let Q=null,K={min:te,max:te};if(t.isSelectedAll(te)){const se=t.getSelectedRuns();se.length>1?Q="Resize "+(Y?"Columns":"Rows"):K=se[0];const X={hidden:ie<=0,size:(ie<=0?$:ie)/N};t.updateHeaderPairs(ep(se,X,te))}if(K){const se=K.max-K.min+1;let X;X=se===1?t.getRange(K).at(0).getDisplayText():t.getRange(K).toString(),Q=`Resize ${Y?"Column":"Row"}${se>1?"s":""} '${X}'`}w?.(te,ie,Q)},[x,t,w]),fe=Fe((te,ie)=>{const $=C===B.Orientation.Column;m(te,ie,`Resize ${$?"Column":"Row"}(s)`)},[m]),ye=Fe(te=>{let ie=!1;const $=C===B.Orientation.Column,Y=t.getSheet().getEntireRange().getCoords(),Q=[],K=t.getSelectedRuns(),se=X=>{let ue;ue=$?{colStart:X.min,rowStart:Y.rowStart,colEnd:X.max,rowEnd:Y.rowEnd}:{colStart:Y.colStart,rowStart:X.min,colEnd:Y.colEnd,rowEnd:X.max},Q.push(ue)};for(let X=0;X<K.length;X++){const ue=K[X];ue.value.isSelectedAll&&(ue.min<=te&&ue.max>=te&&(ie=!0),se(ue))}if(ie||se({min:te,max:te}),t.getSheet().getRanges(Q).autoFit({orientations:$?B.Orientations.Column:B.Orientations.Row}),U(te)){const X={hidden:null},ue=ep(K,X);ie||ue.push({address:te,update:X}),t.updateHeaderPairs(ue)}w?.(te,null,"Resize Column(s)")},[x,t,w,U]),he=()=>{const te=C===B.Orientation.Column;return{getColOffset:ie=>te?t.findOffset(ie):ie===0?0:i/N,getColIndex:ie=>te?t.findIndex(ie):0,getRowOffset:ie=>te?ie===0?0:i/N:t.findOffset(ie),getRowIndex:ie=>te?0:t.findIndex(ie)}},[we,be]=T.useState(()=>he()),me=T.useCallback((te,ie)=>te.nativeEvent.which!==Ap.Right||!ve(C===B.Orientation.Column?ie.colIndex:ie.rowIndex),[C,ve]),de=Fe(te=>{r.focusSheet()},[r]),xe=Fe(te=>{M?.getSelection().updateCoords(te)},[M]),{...Le}=Np({gridRef:n,commands:null,layout:we,selection:q,fillHandleBorderColor:d.body.fill,selectionBackgroundColor:d.selection.fill,selectionBorderColor:d.selection.strokeFill,selectionRemoveBackgroundColor:d.selectionRemove.fill,selectionRemoveBorderColor:d.selectionRemove.strokeFill,disableTouchSelection:!0,onSelectionChange:xe,canSelectionSpanMergedCells:te=>{const ie=M.getRange(te);return ie.isEntireColumns()||ie.isEntireRows()}}),W=Fe(()=>{y?.();const te=M?.getSelection();te&&te.setAdjusting(te.getCoords())},[M,y]),Ze=Fe(async()=>{M?.getSelection().setAdjusting(null),_?.()},[M,_]),{...Xe}=GS({orientation:C,headerCount:F,gridRef:E,gridMainRef:n,newSelection:Le?.newSelection,modifySelection:Le?.modifySelection,appendSelection:Le?.appendSelection,clearSelections:Le?.clearSelections,pointerDownInterceptor:me,onPointerUp:de,onDragStart:W,onDragEnd:Ze}),Ge=d.selection?.strokeFill;T.useEffect(()=>{if(!E.current)return void H(null);const te=C===B.Orientation.Column,ie=t.getSelectedRuns(),$=t.isProtected()?null:re,Y=(K,se,X)=>{if(X)return ge.jsx("div",te?{style:{position:"absolute",borderBottom:`${d.headerSelection.strokeWidth}px solid ${Ge}`,pointerEvents:"none",top:`${wt.boundPixel(-d.headerSelection.strokeWidth/2)}px`,left:`${wt.boundPixel(X.x-d.headerSelection.strokeWidth)}px`,width:`${wt.boundPixel(X.width+d.headerSelection.strokeWidth+1,!0)}px`,height:i+d.headerSelection.strokeWidth-.5+"px"}}:{style:{position:"absolute",borderRight:`${d.headerSelection.strokeWidth}px solid ${Ge}`,pointerEvents:"none",top:`${wt.boundPixel(X.y-d.headerSelection.strokeWidth)}px`,left:`${wt.boundPixel(-d.headerSelection.strokeWidth/2)}px`,width:i+d.headerSelection.strokeWidth-.5+"px",height:`${wt.boundPixel(X.height+d.headerSelection.strokeWidth+1,!0)}px`}},K)},Q=(K,se,X)=>{const ue={x:0,y:0,width:0,height:0};if(te){const _e=X.toClipBounds(X.getRangeCoordsBounds({rowStart:0,rowEnd:0,colStart:K,colEnd:Math.min(F,se)}),qu);if(!_e)return;ue.x=_e.x,ue.width=_e.width}else{const _e=X.toClipBounds(X.getRangeCoordsBounds({rowStart:K,rowEnd:Math.min(F,se),colStart:0,colEnd:0}),qu);if(!_e)return;ue.y=_e.y,ue.height=_e.height}return{x:ue.x,y:ue.y,width:ue.width,height:ue.height}};H([K=>{const se=[];let X=null,ue=te?K.getVisibleColumns():K.getVisibleRows();const _e=te?K.getTotalRangeCoords().colStart:K.getTotalRangeCoords().rowStart;ue.length>0&&ue[0]>_e&&(ue=[ue[0]-1,...ue]);let Re=[];const Ne=[];for(let Ve=0;Ve<ue.length;Ve++){const Je=ue[Ve],rt=Ve<ue.length-1?ue[Ve+1]:Je+ne(Je+1,!1)+1,et=Je+1!==rt;if(!X||X.max<Je)if(ie.length>0&&ie[ie.length-1].max>=Je){const ht=V.findEqualOrGreater(ie,Je,tt=>tt.max);X=ie[ht]}else X=null;let at=!1,nt=!1;if(X?.value&&(X.min<=Je||X.min<=rt&&!et)&&(at=!0,nt=X.value.isSelectedAll),Je===_e){let ht=!1,tt=!1;X?.value&&X.min<=Je&&(ht=!0,tt=X.value.isSelectedAll),Je>0&&Ne.push({index:Je-1,isNextHidden:et,isSelected:ht,isSelectedAll:tt,disabledResize:!0})}if(nt&&Re.push(Ne.length),Ne.push({index:Je,isHidden:Ve===0&&ne(Je,!1)>0,isNextHidden:et,isSelected:at,isSelectedAll:nt,onDividerMouseDown:S,onDividerResizeStart:fe,onDividerResize:$,onDividerMouseUp:b,onDividerResizeEnd:ae,onDividerAutoFit:ye}),et){let ht=!1,tt=!1;if(X&&X.min>=Je&&X.max<=rt-1&&X.value.isSelectedAll&&Re.push(Ne.length),!(X?.value&&X.max>=rt))if(ie.length>0&&ie[ie.length-1].max>=rt){const yt=V.findEqualOrGreater(ie,rt,Xt=>Xt.max);X=ie[yt]}else X=null;X?.value&&X.min<=rt&&(ht=X.value.isSelected,tt=X.value.isSelectedAll),rt>0&&Ne.push({index:rt-1,isHidden:!0,isSelected:ht,isSelectedAll:tt,onDividerMouseDown:S,onDividerResizeStart:fe,onDividerResize:$,onDividerMouseUp:b,onDividerResizeEnd:ae,onDividerAutoFit:ye})}}if(Re.length>0){let Ve=Re.length-1;if(Re.length>0){const et=Ne[Re[Ve]].index;let at=null;te?(at=K.getRangeCoordsBounds({rowStart:0,rowEnd:0,colStart:et,colEnd:et}),at.x+at.width>K.getBounds().width&&(Ve-=1,Ve===0&&(Ve=-1))):(at=K.getRangeCoordsBounds({rowStart:et,rowEnd:et,colStart:0,colEnd:0}),at.y+at.height>K.getBounds().height&&(Ve-=1,Ve===0&&(Ve=-1)))}const Je=ie?.[ie.length-1],rt=K.getAnchor();if(rt==="t"||rt==="l"){const et=Ne[Re[Math.max(0,Re.length-1)]];et.showTouchDivider=Je&&Je.max<=et.index}else Ve>=0&&(Ne[Re[Ve]].showTouchDivider=!0)}const{header:Oe,headerSelect:Be,headerSelectAll:Ue,headerHover:$e}=d??{};for(let Ve=0;Ve<Ne.length;Ve++)se.push(ge.jsx(US,{orientation:C,view:K,headerStyle:Oe,headerStyleSelect:Be,headerStyleSelectAll:Ue,headerStyleHover:$e,disabled:t.isProtected(),...Ne[Ve]},`divider${Ve}`));return se},K=>{const se=[];for(let X=0;ie&&X<ie.length;X++)se.push(Y(`selection:${K.getAnchor()}:${X}`,0,Q(ie[X].min,ie[X].max,K)));return se}])},[I,!0,Ge,d,we,F,u,x,N]),T.useEffect(()=>{E.current?.invalidate()},[x]);const ce=Fe(te=>c?c(te):t.getTextAt(te),[c,t]),We=Fe(te=>{const{header:ie,headerSelect:$,headerSelectAll:Y,headerHover:Q}=d??{},{range:K,key:se,...X}=te;return ge.jsx(qS,{orientation:C,index:C===B.Orientation.Column?K.colStart:K.rowStart,isSelected:ee,isSelectedAll:ve,zoomScale:100*N,headerText:ce,headerStyle:ie,headerStyleSelect:$,headerStyleSelectAll:Y,headerStyleHover:Q,verticalPadding:h,horizontalPadding:f,...X},se)},[x,F,d,N,t]),qe=Fo(),De=T.useMemo(()=>{const te="white",ie="black",$={};if(wt.detectIt().primaryInput!=="touch"){let Y=C===B.Orientation.Column?`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 8,14.5 2.3125,8.8125 h 3.25 V 1.5 h 4.875 v 7.3125 h 3.25 z' stroke='${ie}' fill='${te}'/%3E%3C/g%3E%3C/svg%3E%0A") 8 15, pointer`:`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='m 14.5,8 -5.6875,5.6875 v -3.25 H 1.5 v -4.875 h 7.3125 v -3.25 z' stroke='${ie}' fill='${te}'/%3E%3C/g%3E%3C/svg%3E%0A") 15 8, pointer`;qe.getMode()?.key==="formatPainter"&&(Y=`url("data:image/svg+xml,%3Csvg width='30' height='22' viewBox='0 0 30 22' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 26.737611,2.811068 V 2.0241451 c 0,-0.4328075 -0.354115,-0.7869227 -0.786923,-0.7869227 h -9.443074 c -0.432808,0 -0.786923,0.3541152 -0.786923,0.7869227 v 3.1476914 c 0,0.4328076 0.354115,0.7869235 0.786923,0.7869235 h 9.443074 c 0.432808,0 0.786923,-0.3541159 0.786923,-0.7869235 V 4.3849137 h 0.786923 v 3.1476915 h -7.869229 v 8.6561518 c 0,0.432808 0.354116,0.786923 0.786923,0.786923 h 1.573846 c 0.432807,0 0.786923,-0.354115 0.786923,-0.786923 V 9.1064513 H 29.09838 V 2.811068 Z M 10.714339,6.2116849 c -1.60877,0.0017 -3.2175361,0.00425 -4.8263048,0.00609 0.0012,1.5756989 0.00158,3.1513905 0.00244,4.7270891 -1.5978311,0.0017 -3.1956617,0.0034 -4.7934919,0.0043 0.00335,1.740011 0.00655,3.480012 0.00988,5.220023 1.5954589,0 3.1909181,0 4.7863775,0 -0.0017,1.606793 -0.00353,3.213585 -0.0051,4.820375 1.7440936,0.0016 3.4881881,0.0033 5.2322842,0.005 -0.0014,-1.608503 -0.0018,-3.217015 -0.0028,-4.825519 1.58518,0 3.17036,0 4.755543,0 0.0033,-1.741851 0.0073,-3.483705 0.01072,-5.225556 -1.58808,0 -3.176158,0 -4.764238,0 0,-1.5775391 0,-3.1550792 0,-4.7326117 -0.135065,1.3e-4 -0.270128,1.982e-4 -0.40519,4.047e-4 z' stroke='${ie}' fill='${te}'/%3E%3C/g%3E%3C/svg%3E%0A") 7 12, pointer`),$.cursor=Y}return $.backgroundColor=d?.header?.fill||"transparent",$},[C,x,qe,d]),Te=_r(e,()=>({scrollTo:te=>{E.current?.scrollTo(te)},forceRender:()=>{R()},getGridElement:()=>E.current}),[]),ze=T.useCallback(te=>{Xe.onPointerDown(te)},[Xe]),Z=T.useCallback(te=>{const ie=Xe.getCellCoordsFromClient(te.clientX,te.clientY);if(!ie||!g)return;const $=C===B.Orientation.Column;g({originalEvent:te,clientX:te.clientX,clientY:te.clientY,rowIndex:$?-1:ie.rowIndex,colIndex:$?ie.colIndex:-1}),te.stopPropagation(),te.preventDefault()},[Xe,g]),Se=T.useMemo(()=>{const te=C===B.Orientation.Column;return ge.jsx("div",{ref:Te,children:ge.jsx(kp,{className:"sheet-header",style:De,ref:E,scrollPoint:L,columnCount:te?F:1,rowCount:te?1:F,width:te?l:i,height:te?i:a,freezeLeft:te?u:void 0,freezeTop:te?void 0:u,hiddenColumnsAt:te?ne:void 0,hiddenRowsAt:te?void 0:ne,showGridLines:!1,layout:we,clipCells:!1,allowOverlaysOverflow:!0,enableMouseWheel:!1,onContextMenu:Z,onPointerDown:ze,zoom:N,cellRenderer:We,overlays:O})})},[O,we,l,a,L,De,I]);return T.useEffect(()=>{k.current=!1,E.current?.invalidate(),A()},[t,d]),Se})),Ax=T.memo(T.forwardRef((s,e)=>{const{view:t,sheet:n,getVisibleCells:r,gridStyle:o}=s,i=Fe((c,u)=>c.getStyle().getBorder(),[]),{overlay:l}=Uw({getVisibleCells:r,getBorderAt:i,darkMode:o.body.darkMode,shiftIfWide:!0}),a=l(t);return a&&t?a:null})),Mx={key:"copy",description:"'Copy' Select destination and press ENTER or choose Paste."},Tx={key:"cut",description:"'Cut' Select destination and press ENTER or choose Paste."},kx={type:lt.Content.Values},Nx={fitDestination:!0,type:lt.Content.Formats},Fx={fitDestination:!0,type:lt.Content.Formulas},Ox={transpose:!0},Dx={fitDestination:!0,adjustCells:(s,e,t)=>({value:`=${e.getA1({$colIndex:!0,$rowIndex:!0})}`})},Lx=({element:s,sheet:e,sheetView:t,commands:n,onClipboardUpdate:r,onPaste:o,selectionRenderer:i=KS,copyForegroundColor:l="rgb(33, 115, 70)",cutForegroundColor:a="rgb(33, 115, 70)",copyBackgroundColor:c="white",cutBackgroundColor:u="white",notifier:d,...h})=>{const f=Fe(i,[i]),g=T.useRef(null),m=Fo(),p=m.getMode(),w=T.useMemo(()=>({element:s,doCopy:_=>{const C=e.getSelectedRanges().getSnapshot(_);return new wC(C)}}),[e,t,s]),S=T.useMemo(()=>({element:s,importFromExternal:async(_,C)=>{const E=new SC(_,C,e.getStyles(),e.isDate1904());return await E.parse()?E:null},doPaste:async(_,C)=>{if(_?.getItemType()!=="range")return;C?.contentsOnly&&delete(C={...C,type:lt.Content.Values}).contentsOnly;const E=e.getSelectedRange(),x=_.getItem(),R=x.getName();return await E.doBatch(async()=>{const I=await E.copyFrom(x,C);!I||I.isEntireRows()||I.isEntireColumns()||I.autoFit({orientations:B.Orientations.Row,minContent:!0})},{description:"Paste"+(R?` ${R}`:""),autoSelect:!0}),!0}}),[e,t,d,s]),{clipboard:b,...v}=Tp({...h,source:w,commands:n,target:S,notifier:d,onClipboardUpdate:_=>{const C=_?.getItemType()==="range"?_:null;if(C){const E=_.editMode?.(),x={..._?.isCut?.()?Tx:Mx,...E,args:{isClipboard:!0,...E?.args},onModeChange:R=>{R?.args?.isClipboard||b.clear(!0),E?.onModeChange?.(R)}};m.setMode(x)}g.current=C,r?.(C)},onPaste:(_,C)=>{if(_?.getItemType()!=="range")return;let E=m.getMode()?.key==="cut"||_.isCut?.();if(!E&&m.getMode()?.key==="copy"){const x=_.getItem().getCoords(),R=e.getSelectedRanges().getCoords();let I=!1;if(!I&&x&&R&&_.getItem().getSource?.()===e)for(let A=0;!I&&A<R.length;A++)I=J.isRangesIntersect(x,R[A]);E=I}E&&m.setMode(null),s?.()?.focus(),o?.(_,C)}});T.useMemo(()=>{const _=s;if(!n)return;const C=[new Ee("pasteValues",_,{label:"Paste Values",scopedLabels:{paste:"Values"},description:`Paste only the values of the selected cells.

The formatting is not applied.`,shortcut:{key:"V",modifiers:[Ae.Ctrl,Ae.Shift]}}),new Ee("pasteFormats",_,{label:"Paste Formatting",scopedLabels:{paste:"Formatting"},description:`Paste only the formats of the selected cells.

The content is not applied.`}),new Ee("pasteFormulas",_,{label:"Paste Formulas",scopedLabels:{paste:"Formulas"},description:"Paste only the formulas of the selected cells. The values and formatting is not applied."}),new Ee("pasteTranspose",_,{label:"Paste Transpose",scopedLabels:{paste:"Transpose"},description:"Paste with the rows and columns flipped."}),new Ee("pasteLinks",_,{label:"Paste Links",scopedLabels:{paste:"Links"},description:"Paste as formula references to the original cells."})];n.addCommands(C,!0)},[n,s]),T.useEffect(()=>{if(!n)return;const _={disabled:!e.getProtection().isFormatCellsAllowed()};n.getCommand("pasteValues").updateCallback(C=>v.paste({...kx,...C})).update(_),n.getCommand("pasteFormats").updateCallback((C,E)=>v.paste({...Nx,description:E.label(),...C})).update(_),n.getCommand("pasteFormulas").updateCallback((C,E)=>v.paste({...Fx,description:E.label(),...C})).update(_),n.getCommand("pasteTranspose").updateCallback((C,E)=>v.paste({...Ox,description:E.label(),...C})).update(_),n.getCommand("pasteLinks").updateCallback((C,E)=>v.paste({...Dx,description:E.label(),...C})).update(_),n.getCommand("cut").update(_),n.getCommand("paste").update(_)},[e,n]);const y=T.useMemo(()=>{if(!p||!g.current)return;const _=p.key;if(_!=="copy"&&_!=="cut"&&_!=="formatPainter")return;const C=g.current.getItem();if(C.getSource()!==e)return;const E=g.current.isCut?.(),x=E?u:c,R=E?a:l,I=C.getCoords(),A=I?[I]:null;return A&&A.length!==0?M=>{const k=[];for(let F=0;F<A.length;F++){const L=A[F],N=M.toClipBounds(M.getRangeCoordsBounds(L,{top:0,left:0,right:1,bottom:1}),qu);N&&(k.push(f({range:L,key:`copy-selection-background-${F}`,x:N.x,y:N.y,width:Math.max(N.width,0),height:Math.max(N.height,0),stroke:x,strokeWidth:2})),k.push(f({range:L,key:`copy-selection-foreground-${F}`,x:N.x+(N.width<=2?-1:0),y:N.y,width:Math.max(N.width,3),height:Math.max(N.height,3),stroke:R,strokeWidth:2,isAnimatedStroke:!0})))}return k}:null},[p,e,t,l,c,a,u]);return{...v,clipboard:b,overlays:y}},Bx=T.memo(T.forwardRef((s,e)=>{const{view:t,element:n,sheet:r,gridStyle:o,commands:i,notifier:l}=s,a=o.body??{},c=r.getView(),{overlays:u}=Lx({element:n,sheet:r,sheetView:c,commands:i,copyForegroundColor:o.selection.strokeFill,copyBackgroundColor:a.fill,cutForegroundColor:o.selectionRemove.strokeFill,cutBackgroundColor:a.fill,notifier:l});return Rt(r?.getSelection(),{onChange(d){}}),T.useEffect(()=>{t?.getStage()},[t?.getStage()]),u&&t?u(t):null})),zx="_sheet-selection_12wyx_5",Px={key:"dragCut",description:"Drag selection to move cell contents.",cursor:"move"},Hx={key:"dragCutInsert",description:"Drag selection to insert cell contents.",cursor:"copy"},$x={key:"dragCopy",description:"Drag selection to copy cell contents."},Vx={key:"dragCopyInsert",description:"Drag selection to insert copied cell contents.",cursor:"move"},np=(s,e)=>e.ctrlKey&&e.shiftKey?Vx:e.ctrlKey?$x:e.shiftKey?Hx:Px,Wx={key:"fill",description:"Drag selection to extend series or fill.",cursor:"crosshair"},jx=T.memo(T.forwardRef((s,e)=>{const{view:t,commands:n,className:r,onFirstRender:o,notifier:i,onShowTooltip:l,onCloseTooltip:a,sheet:c,gridRef:u,gridStyle:d,isActive:h,editingCoords:f,...g}=s,m=t?.getBounds(),p=Fe(l,[l]),w=Fe(a,[a]),[S,b]=T.useState(()=>c?.getSelection().getCoords()),v=Fe(re=>{J.isEqualSelectionCoords(re,S)||c&&c.getSelection().updateCoords(re)},[c,S]),y=Fo(),_=T.useRef(null),[C,E]=T.useState(c?.getProtection().isLocked()),[x,R]=T.useState(c?.getView().getMovableSelection().length>0),I=wt.detectIt().primaryInput==="touch",A=!I&&h,M=f!==null||x,k=Fe(re=>{const ae=J.cellToRange(re);if(c.isClosed())return ae;const fe=c.getRange(ae,{excludeHidden:!0}).getMerges();return fe.length===0?ae:fe[0]},[c]),F=Fe((re,ae,fe,ye,he,we)=>{const be=c.getSelectedRange().getExtended(ye,re).getCoords();switch(ye){case B.Direction.Up:return be.rowStart;case B.Direction.Down:return be.rowEnd;case B.Direction.Left:return be.colStart;case B.Direction.Right:return be.colEnd}},[c]),L=Fe(()=>{const re=c.getUsedRange()?.getCoords(),ae=c.getRowHeaders().getUsedRange()?.getCoords(),fe=c.getColumnHeaders().getUsedRange()?.getCoords();return{...re,colEnd:Math.max(re?.colEnd??0,fe?.max??0),rowEnd:Math.max(re?.rowEnd??0,ae?.max??0)}},[c]),N=Fe((re,ae)=>c.getRowHeaders().hiddenHeadersAt(re,ae),[c]),D=Fe((re,ae)=>c.getColumnHeaders().hiddenHeadersAt(re,ae),[c]),O=Fe(re=>c.getRange(re,{excludeHidden:!0}).getMerges(),[c]),H=Fe(re=>{c?.getSelection().setAdjusting(re)},[c]),z=Fe(async()=>{c?.getSelection().setAdjusting(null),y.getMode()?.key==="formatPainter"&&(await n?.getCommand("pasteFormats")?.execute({}),y.setMode(null))},[y,S,c,n]),j=T.useMemo(()=>{const re=y.getMode();return re?.key==="cut"||re?.key==="copy"},[y]);Rt(c?.getView(),{onMovableSelectionChange:()=>{R(c.getView().getMovableSelection().length>0)}}),Rt(c?.getSelection(),{onChange(re){const ae=c.getSelection().getCoords();b(ae)}}),Rt(c,{onProtectionChange:()=>{E(c.getProtection().isLocked())}});const{body:q={}}=d||{},P=t.getLayout(),U=!(A&&S.ranges.length<=1&&f===null&&!C&&(!y.getMode()||j)),{overlay:ne,onPointerDown:ee}=Np({gridRef:u,commands:n,layout:P,getCellCoordsAsRangeCoords:k,selection:S,fillHandleBorderColor:q.fill,selectionBackgroundColor:h?d.selection.fill:d.selectionInactive.fill,selectionBorderColor:h?d.selection.strokeFill:d.selectionInactive.strokeFill,selectionRemoveBackgroundColor:h?d.selectionRemove.fill:d.selectionInactive.fill,selectionRemoveBorderColor:h?d.selectionRemove.strokeFill:d.selectionInactive.strokeFill,disableFillDrag:U,disableMoveDrag:I||!(h&&S.ranges.length<=1&&f===null&&!C),disableTouchSelection:M,onSelectionChange:v,onSelectionDragStart:H,onSelectionDragEnd:z,onMoveDragStart:(re,ae,fe)=>{y.setMode(np(0,fe))},onMoveDragUpdate:(re,ae,fe)=>{y.setMode(np(0,fe))},onMoveDragEnd:(re,ae)=>{y.setMode(null)},onMoveDragDone:async(re,ae,fe)=>{if(J.isEqualRanges(re,ae))return;const ye=c.getRange(ae);if(i?.showOptions){const de=ye.getDifferences(re);let xe=!1;const Le=de.getCount();for(let W=0;!xe&&W<Le;W++)xe=de.at(W).isContentful();if(xe&&await i?.showOptions({title:"Confirm",description:"There is already data here. Do you want to replace it?",options:["Replace","Cancel"],defaultOption:"Replace"})!=="Replace")return}const he=!fe.ctrlKey,we=fe.shiftKey,be=we?he?"Insert Moved Cells":"Insert Copied Cells":he?"Move Cells":"Copy Cells",me=await i?.showBusy?.(be);try{const de=c.getRange(re);await ye.doBatch(async()=>{we?await ye.insertFrom(re,{isCut:he,undoRange:de}):await ye.copyFrom(re,{isCut:he,undoRange:de}),de.autoFit({skipCustomSize:!0,orientations:B.Orientations.Row,minContent:!0}),ye.autoFit({skipCustomSize:!0,orientations:B.Orientations.Row,minContent:!0})},{description:be,autoSelect:!0})}catch(de){i?.showError?.(de)}finally{me?.()}},contentfulCellFinder:F,hiddenRowsAt:N,hiddenColumnsAt:D,mergedRanges:O,getDataCoords:L,canSelectionSpanMergedCells:re=>{const ae=c.getRange(re);return ae.isEntireColumns()||ae.isEntireRows()},onFill:async(re,ae)=>{const fe="Auto Fill",ye=await i?.showBusy?.(fe);try{await c.doBatch(()=>{c.getRange(re).autoFill(ae),c.getRange(ae).autoFit({orientations:B.Orientations.Row,skipCustomSize:!0,minContent:!0})},{description:fe,autoSelect:!0})}catch(he){i?.showError?.(he)}finally{_.current=null,ye?.()}},onFillPreview:(re,ae,fe)=>{if(u.current&&p){y.setMode(Wx);try{_.current?.direction!==fe&&(_.current=null,c.getRange(re).autoFill(ae,{previewOnly:Le=>{_.current={callback:Le,direction:fe}}}));const ye=_.current?.callback?.(ae);if(!ye||ye.isEmpty())return;const he=ye.toText();if(!he)return;const we=J.cellToRange(ye.getCoords()),be=t.getRelativePointFromClient(0,0);let me=0,de=0,xe=Vs.Bottom;if(fe===B.Direction.Down){me=P.getColOffset(we.colEnd+1)-be.x;const Le=P.getRowOffset(we.rowEnd),W=P.getRowOffset(we.rowEnd+1);de=W-(W-Le)/2-be.y,xe=Vs.Right}else if(fe===B.Direction.Right){de=P.getRowOffset(we.rowEnd+1)-be.y;const Le=P.getColOffset(we.colEnd),W=P.getColOffset(we.colEnd+1);me=W-(W-Le)/2-be.x,xe=Vs.Bottom}else if(fe===B.Direction.Up){me=P.getColOffset(we.colEnd+1)-be.x;const Le=P.getRowOffset(we.rowStart),W=P.getRowOffset(we.rowStart+1);de=W-(W-Le)/2-be.y,xe=Vs.Right}else if(fe===B.Direction.Left){de=P.getRowOffset(we.rowEnd+1)-be.y;const Le=P.getColOffset(we.colStart),W=P.getColOffset(we.colStart+1);me=W-(W-Le)/2-be.x,xe=Vs.Bottom}p({anchor:{x:me,y:de},display:he,placement:xe})}catch(ye){i?.showError?.(ye)}}},onFillDone:()=>{_.current=null,y.setMode(null),w?.()}}),ve=Fe(re=>{ee(wt.createSyntheticEvent(re))},[ee,f]);T.useEffect(()=>{const re=t?.getStage();if(re)return re.addEventListener("pointerdown",ve),()=>{re.removeEventListener("pointerdown",ve)}},[t?.getStage()]);const le=_r(e,()=>({}),[]),Ce=T.useRef(null);return ge.jsx("div",{className:Nn(r,"sheet-selection",zx),style:{position:"absolute",width:m?.width,height:m?.height,overflow:"hidden",pointerEvents:"none",willChange:"none"},ref:ks([le,Ce]),...g,children:ne(t)})})),jl=Object.freeze({x:0,y:0,width:0,height:0}),Gx={fireOnModelChange:!1},Ux=T.memo(T.forwardRef((s,e)=>{const{children:t,view:n,movable:r,onRefLoad:o,onRefUnload:i,onHide:l,onShow:a,onUnFocus:c,isDragging:u,updateFrameBounds:d,dragStart:h,style:f,disabled:g,renderMovable:m,...p}=s,[w,S]=T.useState(jl),[b,v]=T.useState(null),[y,_]=T.useState(!1),C=T.useRef(null);T.useLayoutEffect(()=>{if(r.isClosed())return;const x=r.getBounds();if(!x)return;const R=n.toViewBounds(x);S(R??jl),d(R??jl)},[n?.getBounds()]),Rt(r,{onBoundsChange:x=>{const R=x.getBounds();if(!R)return;const I=n.toViewBounds(R);S(I??jl),d(I)},onSelectionChange:()=>{const x=V.hasFocus(C.current,!0);!y&&!x||r.isSelected()||c()}}),Rt(r,{onRequestFocus:()=>V.whenFocus(C.current,!0)},Gx),T.useEffect(()=>{const x=C.current;return o(x),()=>{i(x)}},[]);const E=T.useMemo(()=>{if(!w)return null;let{width:x,height:R}=w;return m({view:n,movable:r,disabled:g,isDragging:u,style:{position:"relative",left:0,top:0,width:x,height:R},onHide:l,onShow:a})},[n,r,w.width,w.height,g,u]);return ge.jsx("div",{className:"movable",tabIndex:0,ref:ks([C,e]),style:{display:"flex",alignItems:"stretch",justifyContent:"stretch",position:"absolute",maxWidth:"auto",maxHeight:"auto",minWidth:"auto",minHeight:"auto",left:w.x,top:w.y,width:w.width,height:w.height,...f},onMouseDown:async x=>{const R=x.shiftKey||x.ctrlKey,I=r.isSelected(),A=x.currentTarget;R&&I?r.unselect():(I&&!R||await r.select({addToSelection:R}),h(x.nativeEvent,A),A.focus())},onFocus:x=>{x.relatedTarget&&!b&&v(x.relatedTarget),_(!0)},onBlur:x=>{b&&!C?.current?.contains(x.relatedTarget)&&v(null),x.relatedTarget&&_(!1)},...p,children:E})})),qx="_movable-area_314c6_5",Jx=T.memo(T.forwardRef((s,e)=>{const{view:t,movables:n,movablesView:r,renderMovable:o,transactional:i,onUnFocus:l,onFocus:a,disabled:c=!1,disableDrag:u=!1,disableResize:d=!1,className:h,style:f,renderDirections:g=["nw","n","ne","w","e","sw","s","se"],onFirstRender:m,...p}=s,w=t.getBounds(),S=Fe(m,[m]),b=Fe(l,[l]),v=Fe(a,[a]),[y,_]=T.useState([]),[C,E]=T.useState(!1),[x,R]=T.useState(!1),I=T.useRef(!0),A=T.useRef(new Map),M=T.useRef(new Map),k=T.useRef(new Map),F=T.useRef(new Map),L=T.useRef(new Map),N=T.useRef({onRequestFocus:ce=>(fe(ce),null)}),D=T.useRef(null),O=T.useRef(null),H=T.useRef(null),[z,j]=T.useReducer(ce=>ce+1,0);T.useLayoutEffect(()=>{j()},[t,n]),Rt(n,{onCollectionChange:()=>{const ce=n.getItems({address:t.getVisibleRangeCoords(),excludeHidden:!0}),We=L.current;We.forEach(De=>{De()}),We.clear();const qe=N.current;for(let De=0;De<ce.length;De++){const Te=ce[De];if(Te.isClosed())continue;const ze=Te.addListeners(qe);We.set(Te,ze)}j()},onInvalidated:()=>{j()}}),Rt(r,{onMovableSelectionChange(ce){P(),j()}});const q=T.useCallback((ce,We)=>{const qe=k.current.get(ce);H.current&&(H.current.getTargets().forEach(De=>{if(De===qe)return De.style.left=We.x+"px",De.style.top=We.y+"px",De.style.width=We.width+"px",void(De.style.height=We.height+"px")}),H.current.updateRect())},[]),P=()=>{const ce=[],We=r.getMovableSelection();We.forEach(qe=>{const De=k.current.get(qe);De&&We.indexOf(qe)!==-1&&ce.push(De)}),_(qe=>V.isEqualArrays(qe,ce)?qe:ce)},U=T.useRef(null),ne=T.useMemo(()=>new Promise(ce=>{U.current=ce}),[]),ee=T.useRef(null),ve=Fe(async(ce,We)=>{ee.current=We,await(async()=>!(!await ne.then()||!H.current))()&&ee.current===We&&H.current.dragStart(ce,We)},[y]),[le,Ce]=T.useState(!1),re=T.useRef(null),ae=T.useRef(null),fe=Fe(async(ce=null)=>{if(ce||(ce=r.getMovableSelection()[0]),!ce)return b?.(),!1;const We=k.current.get(ce);We?(await V.whenFocus(We),We.focus(),ae.current=We,re.current=null):re.current=ce},[r]);T.useEffect(()=>{le&&y.length>0&&ae.current!==y[0]&&fe(),I.current&&(S?.(),I.current=!1)},[y]);const ye=T.useMemo(()=>{const ce=n.getItems({address:t.getVisibleRangeCoords(),excludeHidden:!0});if(ce.length===0&&A.current.size===0)return null;const We=(Z,Se,te,ie=!0)=>{const $=Z.isSelected(),Y={tabIndex:te,view:t,movable:Z,onRefLoad:Q=>{re.current===Z&&(Q.focus(),ae.current=Q,re.current=null),k.current.set(Z,Q),M.current.set(Q,Z),Se.rendered=!0,P()},onRefUnload:Q=>{k.current.delete(Z),M.current.delete(Q),Se.rendered=!1,P()},onUnFocus:b,onHide:Q=>{Se.onHide=Q},onShow:Q=>{Se.onShow=Q},isDragging:$&&(x||C),disabled:c,renderMovable:o,updateFrameBounds:Q=>{q(Z,Q)},dragStart:ve,onMouseUp:()=>{if(ee.current=null,O.current){E(!1),R(!1);let Q=!1;F.current?.forEach(K=>{V.isEqualBounds(K.movable.getBounds(),K.startBounds)||(Q=!0)}),Q?we():be()}},style:{opacity:ie?C&&$?.7:void 0:0,zIndex:C&&$?Z.getZIndex()+ce.length:void 0,pointerEvents:ie?void 0:"none",cursor:x&&$?"grabbing":c||u?"initial":"move",boxShadow:!$||x&&!C?void 0:"1px 1px 2px 2px rgba(0,0,0,.15)"}};return ge.jsx(Ux,{...Y},`movable-${Z.getUUID()}`)},qe=A.current,De=new Map,Te=[];for(let Z=0;Z<ce.length;Z++){const Se=ce[Z];if(Se.isClosed())continue;let te=qe.get(Se);te||(te={frame:null,shown:null,onShow:null,onHide:null,rendered:!1,doShow:(ie,$)=>{if(!$||$.shown===!0)return;$.shown=!0;const Y=++$.visibilityRequestId;requestAnimationFrame(()=>{const Q=A.current.get(ie);Q&&Y===$.visibilityRequestId&&($.onShow?.(ie),Q.shown=!0)})},doHide:async(ie,$)=>{if(!$||$?.shown===!1)return;$.shown=!1;const Y=++$.visibilityRequestId,Q=await Promise.resolve($.onHide?.(ie));Y===$.visibilityRequestId&&Q!==!1&&($.shown=!1,A.current.delete(ie),j())},visibilityRequestId:0}),te.frame=We(Se,te,Z,!0),Te.push(te.frame),te.doShow(Se,te),qe.delete(Se),De.set(Se,te)}const ze=[];return r.getMovableSelection().forEach(Z=>{const Se=qe.get(Z);Se&&(Se.frame=We(Z,Se,-1,!1),ze.push(Se.frame),qe.delete(Z),De.set(Z,Se))}),qe.forEach((Z,Se)=>{Z.frame=We(Se,Z,-1,!1),ze.push(Z.frame),Z.doHide(Se,Z),qe.delete(Se),De.set(Se,Z)}),A.current=De,P(),[...ze,...Te]},[z,t,o,c,u,d,C,x]),he=Fe((ce,We)=>{const qe=`${We} ${y.length===1?Kd.capitalize(M.current?.get(y[0]).getContent().getType()):"Drawings"}`;O.current&&(console.warn(`Transaction ${O.current.getDescription()} is being replaced by ${qe}`),O.current.rollback(),O.current=null),O.current=i.beginCommit({description:qe}),F.current.clear();for(let De=0;De<y.length;De++){const Te=y[De],ze=M.current?.get(Te);ze?F.current.set(Te,{movable:ze,startBounds:t.toViewBounds(ze.getBounds())}):console.warn("invalid element",ze)}},[i,t,y]),we=T.useCallback(()=>{if(!O.current)return;const ce=[];F.current?.forEach(We=>{ce.push(We.movable)}),O.current.commit({viewAfter:{view:r,movableSelection:ce}}),F.current.clear(),O.current=null},[]),be=T.useCallback(()=>{O.current&&(O.current.rollback(),O.current=null)},[]),me=T.useRef(null);T.useEffect(()=>{me.current&&(me.current.onscroll=ce=>{ce.preventDefault(),ce.srcElement.scrollTop=0,ce.srcElement.scrollLeft=0})},[me.current]);const de=_r(e,()=>({isMovableArea:()=>!0,focusMovable:fe,focus:()=>{fe()}}),[r]),[xe,Le]=T.useState(null),W=T.useRef(!1),Ze=T.useRef(!1),Xe=T.useRef(!1);T.useEffect(()=>{if(c||y.length===0||Xe.current||W.current)return;if(Ze.current)return void requestAnimationFrame(()=>{H.current&&D.current&&H.current.refTargets.length>0&&(Xe.current=!0,U.current?.(!0)),_([...y])});W.current=!0;const ce=ut.lazy(async()=>{try{const We=await ao(()=>import("./Cyt8i0yMUhcyUi_X-jaVpGV8s.js"),__vite__mapDeps([11,4,1]),import.meta.url);return W.current=!1,Ze.current=!0,_([...y]),We}catch(We){return console.warn(We),U.current?.(!1),null}});Le(ce)},[y,c,u,d]);const Ge=T.useMemo(()=>!xe||c?null:ge.jsx(T.Suspense,{children:ge.jsx(xe,{className:Nn({dragging:C||x,resizing:C,moving:x}),container:null,ref:H,target:H.current?y:[],draggable:!c&&!u,resizable:!c&&!d,individualGroupable:!0,edgeDraggable:!1,throttleDrag:2,throttleResize:2,origin:!1,keepRatio:!1,renderDirections:g,onResizeStart:ce=>{he(ce.target,"Resize")},onResize:ce=>{if(!O.current)return ce.stopDrag(),void j();E(!0);const We=ce.direction[0]!==0&&ce.direction[1]!==0;let qe=0,De=0;for(let Te=0;Te<y.length;Te++){const ze=y[Te],Z=F.current.get(ze),Se=M.current.get(ze);if(!Z||!Se){console.warn("invalid element");continue}let te=ce.dist[0],ie=ce.dist[1],$=ce.drag.dist[0],Y=ce.drag.dist[1],Q=Z.startBounds.width,K=Z.startBounds.height;Te===0?(qe=Q,De=K):(te*=Q/qe,$*=Q/qe,ie*=K/De,Y*=K/De);const se={...Z.startBounds};if(se.width=Math.max(0,Q+te),se.height=Math.max(0,K+ie),ce.direction[0]===-1&&(se.width=Math.max(0,Math.min(Z.startBounds.x+Q,Q-$))),ce.direction[1]===-1&&(se.height=Math.max(0,Math.min(Z.startBounds.y+K,K-Y))),We&&(Se.isLockAspectRatio()||ce.inputEvent?.shiftKey)){const X=Q/K,ue=se.width/se.height;ue>X?se.height=se.width/X:ue<X&&(se.width=se.height*X)}ce.direction[0]===-1&&(se.x=Math.max(0,Math.min(Z.startBounds.x+Q,Z.startBounds.x+Q-se.width))),ce.direction[1]===-1&&(se.y=Math.min(Z.startBounds.y+K,Z.startBounds.y+K-se.height)),Z.movable.setBounds(t.toAbsoluteBounds(se))}},onResizeEnd:ce=>{E(!1),we()},onDragStart:ce=>{he(ce.target,"Move")},onDrag:ce=>{if(!O.current)return ce.stopDrag(),void j();R(!0);for(let We=0;We<y.length;We++){const qe=y[We],De=F.current.get(qe);De?De.movable.setBounds(t.toAbsoluteBounds({...De.startBounds,x:De.startBounds.x+ce.translate[0],y:De.startBounds.y+ce.translate[1]})):console.warn("invalid element")}},onDragEnd:ce=>{},onMouseUp:ce=>{}})}),[z,xe,y,t,c,u,d,C,x]);return ge.jsx("div",{className:Nn(h,"movable-area",qx),style:{width:w.width,height:w.height,...f,position:"absolute",overflow:"hidden",willChange:"transform"},ref:ks([de,me]),...p,children:ge.jsx("div",{className:"movable-scroll",style:{position:"absolute",cursor:"initial",left:0,top:0,width:w.width,height:w.height},...p,children:ge.jsxs("div",{ref:D,style:{position:"absolute",pointerEvents:"auto"},onFocus:ce=>{v?.(),Ce(!0)},onBlur:ce=>{Ce(!1)},onKeyDownCapture:ce=>{if(ce.isDefaultPrevented())return;const We=ce.nativeEvent.ctrlKey,qe=ce.nativeEvent.altKey,De=ce.nativeEvent.shiftKey;if(ce.which===xn.Escape){const te=r.getMovableSelection();let ie=[...te];return y.forEach($=>{if(ie.length===0)return;const Y=M.current.get($);let Q=ie.indexOf(Y);ie.splice(Q,1)}),ie.length!==te.length&&r.selectMovables(ie),ie.length===0&&b?.(),void ce.preventDefault()}const Te=.1,ze=te=>{n.updateSelected(ie=>{ie.setRotation(ie.getRotation()+te)},"Rotate")},Z=(te,ie=!0)=>{n.updateSelected($=>{const Y=$.getBounds();let Q=1+te;ie||(Q=1/Q);const K=Math.sqrt(Math.pow(Y.width,2)+Math.pow(Y.height,2)),se=Math.atan2(Y.height,Y.width),X=Q*K;if(X<10)return;const ue=X*Math.cos(se),_e=X*Math.sin(se),Re={x:Y.x+(Y.width-ue)/2,y:Y.y+(Y.height-_e)/2,width:ue,height:_e};$.setBounds(Re)},"Resize")},Se=te=>{n.updateSelected(ie=>{const $=ie.getBounds(),Y={x:$.x+(te.x??0),y:$.y+(te.y??0),width:$.width+(te.width??0),height:$.height+(te.height??0)};ie.setBounds(Y)},"Nudge")};if(ce.which===xn.Delete)n.updateSelected(te=>{te.delete()},"Delete"),ce.preventDefault();else if(ce.key==="a"&&We){const te=r.getMovableSelection();r.selectMovables(n.getItems(),!0),r.selectMovables(te,!0),ce.preventDefault()}else ce.key==="ArrowLeft"?(De?Z(Te,!1):qe?ze(-10):Se({x:We?-10:-1}),ce.preventDefault()):ce.key==="ArrowRight"?(De?Z(Te,!0):qe?ze(10):Se({x:We?10:1}),ce.preventDefault()):ce.key==="ArrowUp"?(De?Z(Te,!0):Se({y:We?-10:-1}),ce.preventDefault()):ce.key==="ArrowDown"&&(De?Z(Te,!1):Se({y:We?10:1}),ce.preventDefault())},children:[ye,Ge]})})})})),os=s=>{let e=Number.MAX_SAFE_INTEGER,t=Number.MAX_SAFE_INTEGER,n=0,r=0;for(let o=0;o<s.length;o++){const i=s[o].getBounds();e=Math.min(i.x,e),t=Math.min(i.y,t),n=Math.max(i.x+i.width,n),r=Math.max(i.y+i.height,r)}return{x:e,y:t,width:n-e,height:r-t}},rp=(s,e=!0)=>{const t=[],n=e?"x":"y",r=e?"y":"x",o=e?"width":"height";let i=0,l=Number.MAX_SAFE_INTEGER,a=0;for(let d=0;d<s.length;d++){const h=s[d],f=h.getBounds();i+=f[o],l=Math.min(f[n],l),a=Math.max(f[n]+f[o],a),t.push({bounds:f,movable:h})}const c=(a-l-i)/(s.length-1);t.sort((d,h)=>{const f=d.bounds[n],g=h.bounds[n];return f!==g?f-g:d.bounds[r]-h.bounds[r]});const u=new Map;u.set(t[0].movable,t[0].bounds);for(let d=1;d<t.length-1;d++){const h=t[d-1].bounds,f={...t[d].bounds};f[n]=h[n]+h[o]+c,t[d].bounds=f,u.set(t[d].movable,f)}return u.set(t[t.length-1].movable,t[t.length-1].bounds),u};function Kx(s){const{movables:e,movablesView:t,transactional:n,commands:r,target:o,onRepeatCommandChange:i,notifier:l}=s,a=Fo();T.useRef(a.getMode()).current=a.getMode();const c=Fe(async(b,v,y=null,_=!0)=>{const C=async()=>{const E=await Promise.resolve(l?.showBusy?.(b.label()));try{await v();const x=y??b?.label?.();if(i){let R=null;b&&x!==!1&&(R=new ot(b.key(),o,{label:x,description:x},C)),i(R)}E?.(),_&&a.setMode(null)}catch(x){E?.(),l?.showError?.(x)}};await C()},[i,l]),[u,d]=T.useReducer(b=>b+1,0),h=Fe((b,v,y)=>{if(!t)return;const _=t.getMovableSelection();if(_.length===0)return;let C="Drawings";if(_.length===1){const x=_[0];C=Kd.capitalize(x.getContent().getType())??"Drawing"}const E=`${b.label()} ${C}`;c(b,()=>{let x=null;n&&(x=n.beginCommit(E));const R=t.getMovableSelection();if(R.length===0)return;const I=y?.(R);for(let A=0;A<R.length;A++){const M=R[A];v(M,I)}x?.commit()})},[t,n]),[f,g]=T.useState(t.getMovableSelection()[0]??null),[m,p]=T.useState(!f||f?.isProtected()),w=T.useMemo(()=>[new Ee("moveToFront",o,{label:"Bring to Front",description:"Move to the front of all of the other drawings.",shortcut:{key:"BracketRight",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){h(this,b=>{b.moveToFront()})}),new Ee("moveForward",o,{label:"Bring Forward",description:"Move forward one layer in the z order.",shortcut:{key:"BracketRight",modifiers:[Ae.Ctrl]}},function(){h(this,b=>{b.moveForward()})}),new Ee("moveToBack",o,{label:"Send to Back",description:"Move to the back of all of the other drawings.",shortcut:{key:"BracketLeft",modifiers:[Ae.Ctrl,Ae.Shift]}},function(){h(this,b=>{b.moveToBack()})}),new Ee("moveBackward",o,{label:"Send Backward",description:"Move backwards one layer in the z order.",shortcut:{key:"BracketLeft",modifiers:[Ae.Ctrl]}},function(){h(this,b=>{b.moveBackward()})}),new Ee("toggleLockAspectRatio",o,{label:"Lock Aspect Ratio",description:"Toggle whether the aspect ratio should be maintained when resizing from corners."},function(){h(this,b=>{b.setLockAspectRatio(!b.isLockAspectRatio())})}),new Ee("formatAnchorTypeTwoCell",o,{label:"Move and size with cells",description:"Set your drawing to move and resize when underling sheet resizes."},function(){h(this,b=>{b.setAnchorType(Ut.Type.TwoCell)})}),new Ee("formatAnchorTypeOneCell",o,{label:"Move but don't size with cells",description:"Set your drawing to only move when underling sheet resizes."},function(){h(this,b=>{b.setAnchorType(Ut.Type.OneCell)})}),new Ee("formatAnchorTypeAbsolute",o,{label:"Don't move or size with cells",description:"Set your drawing to never move or resize when underling sheet resizes."},function(){h(this,b=>{b.setAnchorType(Ut.Type.Absolute)})}),new Ee("formatDrawAlignLeft",o,{label:"Align Left",description:"Align the selected drawings to the left."},function(){h(this,(b,v)=>{b.setBounds({x:v.x})},os)}),new Ee("formatDrawAlignCenter",o,{label:"Align Center",description:"Align the selected drawings vertically relative to each other."},function(){h(this,(b,v)=>{b.setBounds({x:(v.width-b.getBounds().width)/2+v.x})},os)}),new Ee("formatDrawAlignRight",o,{label:"Align Right",description:"Align the selected drawings to the right."},function(){h(this,(b,v)=>{b.setBounds({x:v.width-b.getBounds().width+v.x})},os)}),new Ee("formatDrawAlignTop",o,{label:"Align Top",description:"Align the selected drawings to the top."},function(){h(this,(b,v)=>{b.setBounds({y:v.y})},os)}),new Ee("formatDrawAlignMiddle",o,{label:"Align Middle",description:"Align the selected drawings horizontally relative to each other."},function(){h(this,(b,v)=>{b.setBounds({y:(v.height-b.getBounds().height)/2+v.y})},os)}),new Ee("formatDrawAlignBottom",o,{label:"Align Bottom",description:"Align the selected drawings to the bottom."},function(){h(this,(b,v)=>{b.setBounds({y:v.height-b.getBounds().height+v.y})},os)}),new Ee("formatDrawDistributeHorz",o,{label:"Distribute Horizontally",description:"Distribute the selected drawings horizontally with equal spacing between each."},function(){h(this,(b,v)=>{b.setBounds(v.get(b))},b=>rp(b))}),new Ee("formatDrawDistributeVert",o,{label:"Distribute Vertically",description:"Distribute the selected drawings vertically with equal spacing between each."},function(){h(this,(b,v)=>{b.setBounds(v.get(b))},b=>rp(b,!1))}),new Ee("formatDrawFlipHorz",o,{label:"Flip Horizontally",description:"Flip the selected drawings horizontally."}),new Ee("formatDrawFlipVert",o,{label:"Flip Vertically",description:"Flip the selected drawings vertically."}),new Ee("formatDrawGroup",o,{label:"Group",description:"Group the selected drawings into a single drawing."}),new Ee("formatDrawUngroup",o,{label:"Ungroup",description:"Break the group of a drawing into individual drawings."}),new Ee("formatDrawSwapShapes",o,{label:"Swap Shapes",description:"Swap the positions of the swap."}),new Ee("formatDrawSwapShapesHorz",o,{label:"Swap Shapes Horizontally",description:"Swap the positions of the swap horizontally."}),new Ee("formatDrawSwapShapesVert",o,{label:"Swap Shapes Vertically",description:"Swap the positions of the swap vertically."})],[t,f]);T.useEffect(()=>{},[a]);const S=T.useMemo(()=>{let b=null;return b=r?r.createChildGroup(o,"movable",!1):new Qa(o,"movable"),b.addCommands(w,!0),b},[r,w]);return Rt(f,{onAnyChange:()=>{S.getCommand("formatAnchorTypeTwoCell").update({state:f?.getAnchorType()===Ut.Type.TwoCell}),S.getCommand("formatAnchorTypeOneCell").update({state:f?.getAnchorType()===Ut.Type.OneCell}),S.getCommand("formatAnchorTypeAbsolute").update({state:f?.getAnchorType()===Ut.Type.Absolute}),S.getCommand("formatAnchorTypeAbsolute").update({state:f?.getAnchorType()===Ut.Type.Absolute}),S.getCommand("toggleLockAspectRatio").update({state:f?.isLockAspectRatio()})},onProtectedChange:b=>{p(b.isProtected())},onDelete:()=>{}}),Rt(t,{onMovableSelectionChange:()=>{const b=t.getMovableSelection()[0]??null;g(b),p(!b||b.isProtected()),d()}}),Rt(e,{onCollectionChange:()=>{d()}}),T.useEffect(()=>{const b={disabled:m};S.getCommand("formatAnchorTypeTwoCell").update(b),S.getCommand("formatAnchorTypeOneCell").update(b),S.getCommand("formatAnchorTypeAbsolute").update(b),S.getCommand("toggleLockAspectRatio").update(b);const v=e.getCount(),y=t.getMovableSelection(),_=m||v<=1||y.length===0;let C={disabled:_},E=C;if(!_&&y.length===1){const I=y[0];I.getZIndex()===0&&(C={disabled:!0}),I.getZIndex()===v-1&&(E={disabled:!0})}S.getCommand("moveToFront").update(E),S.getCommand("moveForward").update(E),S.getCommand("moveToBack").update(C),S.getCommand("moveBackward").update(C);const x={disabled:m||y.length<=1};S.getCommand("formatDrawAlignLeft").update(x),S.getCommand("formatDrawAlignCenter").update(x),S.getCommand("formatDrawAlignRight").update(x),S.getCommand("formatDrawAlignTop").update(x),S.getCommand("formatDrawAlignMiddle").update(x),S.getCommand("formatDrawAlignBottom").update(x),S.getCommand("formatDrawFlipHorz").update(x),S.getCommand("formatDrawFlipVert").update(x),S.getCommand("formatDrawGroup").update(x),S.getCommand("formatDrawUngroup").update(x),S.getCommand("formatDrawSwapShapes").update(x),S.getCommand("formatDrawSwapShapesHorz").update(x),S.getCommand("formatDrawSwapShapesVert").update(x);const R={disabled:m||y.length<=2};S.getCommand("formatDrawDistributeHorz").update(R),S.getCommand("formatDrawDistributeVert").update(R)},[u,m,u]),S}const KR=T.memo(T.forwardRef((s,e)=>{const{children:t,disabled:n,description:r,view:o,isDragging:i,onHide:l,onShow:a,...c}=s;T.useEffect(()=>{},[r]);const u=_r(e,()=>({isEmptyFrame:()=>!0}),[]),[d,{height:h,width:f}]=ko();return ge.jsx("div",{...c,ref:ks([u,d]),children:ge.jsx("div",{className:"chart-editor",style:{width:"100%",height:"100%",border:"var(--sxl-app-color-grey, grey) solid 1px",backgroundColor:"var(--sxl-app-color-background, white)",backgroundImage:"var(--sxl-app-image-background)",alignItems:"center",justifyContent:"center",zoom:o.getZoom(),display:"flex",position:"relative",filter:n?"blur(1px)":void 0,boxShadow:i?"1px 1px 2px var(--sxl-app-color-shadow, rgba(0,0,0,.15))":void 0},children:ge.jsx("div",{style:{textAlign:"center"},children:r})})})})),Xx=T.memo(T.forwardRef((s,e)=>{const{view:t,sheet:n,movableProps:r,renderMovable:o,commands:i,target:l,notifier:a,onRepeatCommandChange:c}=s,u=Kx({movables:n.getMovables(),movablesView:n?.getView(),transactional:n,onRepeatCommandChange:c,commands:i,target:l,notifier:a});T.useEffect(()=>{t?.getStage()},[t?.getStage()]);const d=T.useMemo(()=>ge.jsx(Jx,{ref:e,view:t,movables:n.getMovables(),disableResize:!n.getProtection().isObjectsAllowed(),disableDrag:!n.getProtection().isObjectsAllowed(),movablesView:n.getView(),transactional:n,renderMovable:o,...r,onFocus:()=>{u.activate(),r?.onFocus?.()}},"movable-area"),[n,r,i,u]);return d&&t?d:null})),Zx=T.memo(T.forwardRef((s,e)=>{const{view:t,sheet:n,gridStyle:r,getCellEditor:o,showProtectedError:i,setEditingCoords:l,commands:a,notifier:c=$S}=s,u=Fo(),[d,h]=T.useState(null),[f,g]=T.useState(null),[m,p]=T.useState(null),[w,S]=T.useState(null),[b,v]=T.useState(null);T.useLayoutEffect(()=>{if(m===null)return S(null),void v(null);const N=()=>{const D=n.getRange(m).getCell(),O=D.getStyle();let H,z=O.getFill()?.toCSS(r.body.darkMode);z.background!=="none"&&z.background!=="transparent"||(z=n.getStyles().getNormal().getFill().toCSS(r.body.darkMode)),z.background!=="none"&&z.background!=="transparent"||(z={background:r.body.fill}),S({style:z}),D&&!D.getFormula()&&(H=D?.getRenderHorizontalAlignment()),v(H??WS.Left)};return N(),n.getRange(m).addListener(()=>{N()})},[n,m,r?.body]);const y=Fe(()=>{let N=f.editState.dirty??"";if(f.editState.dirty!==void 0){const D=Kd.clampString(N);try{const O=f.sheet.getRange(f.coords),H=`Typing '${D}' into ${O.toString()}`;return O.setValue(N,{description:H,autoFit:!0}),p(null),g(null),u.setMode(null),l(null),!0}catch(O){throw c.showError(new Error(`Unable to enter '${D}'.`,{cause:O})),O}}},[n,f,c]),_=Fe(N=>n.getRange(N).getCell().getExtrusions()??J.cellToRange(N),[n]);Fe(N=>{let D=B.Orientation.Row,O=!1;N!==B.Direction.Up&&N!==B.Direction.Down||(D=B.Orientation.Column),N!==B.Direction.Left&&N!==B.Direction.Up||(O=!0),n.getSelection().traverse(D,O)},[n]);const C=T.useCallback((N,D)=>{if(o)return o(N,D);if(!n)return null;const{ref:O,...H}=N;return ge.jsx(dx,{ref:O,...H,sheet:n,bodyStyle:r?.body,activeCoords:D,commands:a,onChangeEdit:z=>{const j={sheet:n,coords:D,editState:z};u.setMode(q=>({...q,description:j.editState.editMode?"Edit":"Enter",args:{...q?.args,stateAndCoords:j}}))},editState:f.editState})},[n,w,o,f,m]),{overlay:E,startEdit:x,submitEdit:R,cancelEdit:I,onKeyboardEventNative:A,onPointerEventNative:M}=JS({view:t,activeCoords:d,getCellEditor:C,canEdit:()=>{const N=n.getProtection();if(N.isReadOnly())return!1;const D=N.isLocked();return D&&i(),!D},onBeforeStartEdit:N=>{const D=hx(()=>n.getRange(N).getCell()),O={sheet:n,coords:N,editState:Object.freeze(D)};u.setMode({key:"edit",args:{stateAndCoords:O}}),g(O)},onStartEdit:N=>{p(N),l(N)},onSubmitEdit:y,onCancelEdit:N=>{p(null),g(null),u.setMode(null),l(null)},onDoneEdit:N=>{u.setMode(null)},containerProps:w,borderStrokeFill:r.selection?.strokeFill,borderStrokeWidth:n?.getSelection().getCoords().ranges?.length>1?1:2,alignment:b,getRangeCoords:_});Rt(n.getSelection(),{onChange(N){h(n.getSelection().getCoords().cell)}});const k=Fe(N=>{M(N),m&&R()},[M,I,m]),F=T.useCallback(N=>{M(N)},[M]),L=T.useCallback(N=>{A(N)},[A]);return T.useEffect(()=>{const N=t?.getStage();if(N)return N.addEventListener("pointerdown",k),N.addEventListener("dblclick",F),N.addEventListener("keydown",L),()=>{N.removeEventListener("pointerdown",k),N.removeEventListener("dblclick",F),N.removeEventListener("keydown",L)}},[t?.getStage()]),T.useEffect(()=>{const N=u.getMode(),D=N?.key;D==="edit"||D==="enter"?f?N.args?.cancel?I():N.args?.submit?R():g(N.args?.stateAndCoords):x(N.args?.start):m&&I()},[u]),E(t,e)})),Kw="white",Xw="black",Yx=`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='m 14.5,8 -5.6875,5.6875 v -3.25 H 1.5 v -4.875 h 7.3125 v -3.25 z' stroke='${Xw}' fill='${Kw}'/%3E%3C/g%3E%3C/svg%3E%0A") 15 8, pointer`,Qx=`url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' xmlns='http://www.w3.org/2000/svg' %3E%3Cg%3E%3Cpath d='M 13.24564,12.979958 H 5.2023009 L 7.500398,10.681861 2.3296796,5.5111425 5.7768252,2.0639969 10.947543,7.2347153 13.24564,4.9366182 Z' stroke='${Xw}' fill='${Kw}'/%3E%3C/g%3E%3C/svg%3E%0A") 12 12, pointer`,eE=T.memo(T.forwardRef((s,e)=>{const{view:t,sheet:n}=s,[r,o]=ut.useState(n.getTables().getCount()>0),[i,l]=ut.useState(null),[a,c]=ut.useState(null),[u,d]=ut.useState(null),[h,f]=ut.useState(null),g=Fe(()=>{if(n.getTables().getCount()>0){o(!0);const y=n.getTables().getItems({address:t.getVisibleRangeCoords()});l(y.length>0?y:null)}else o(!1),l(null)},[n,t]),m=Fe(y=>{y.preventDefault(),y.stopPropagation();const _=t.getCellCoordsFromClient(y.clientX,y.clientY),C=n.getTables().getItems({address:_});C.length===1&&C[0].select()},[t,n]),p=Fe(y=>{y.preventDefault(),y.stopPropagation();const _=t.getCellCoordsFromClient(y.clientX,y.clientY),C=n.getTables().getItems({address:_});if(C.length===1){const E=C[0].getRange().getCoords(),x={colStart:E.colStart,rowStart:_.rowIndex,colEnd:E.colEnd,rowEnd:_.rowIndex};n.getRange(x).select()}},[t,n]),w=Fe(()=>{if(!r)return;const y=n.getTables().getItems({address:t.getVisibleRangeCoords()});l(y.length>0?y:null)},[n,r,t]);Rt(n?.getSelection(),{onChange(y){c(n.getSelection().getCoords().cell)}}),Rt(u,{onAnyChange(y){g(),w()}}),Rt(h,{onAnyChange(y){w()}}),Rt(n,{onTablesChange(y){g(),w()},onInvalidated(y){g(),w()}});const S=ut.useMemo(()=>V.debounce(V.throttle(w,300),300),[]);T.useEffect(()=>{S()},[t]),T.useEffect(()=>{let y=null;if(i)for(let _=0;_<i.length&&!y;_++){const C=i[_],E=C.getRange().getCoords();J.isCellWithinRange(a,E)&&(y=C)}d(y)},[a,i]);const b=Fe(y=>{let _=null;if(i)for(let C=0;C<i.length;C++){const E=i[C],x=E.getRange().getCoords();let R=t.getRangeCoordsBounds(x);const I=t.getRelativePointFromClient(y.clientX,y.clientY),A=I.x,M=I.y;if(A>=R.x&&A<=R.x+R.width&&M>=R.y&&M<=R.y+R.height){const k=t.getViewportSize();A<=0||M<=0||A>=k.width||M>=k.height||(_=E)}}f(_)},[t,i]);if(T.useEffect(()=>{const y=t?.getStage();if(y&&i)return y.addEventListener("mousemove",b),y.addEventListener("mouseleave",b),()=>{y.removeEventListener("mousemove",b),y.removeEventListener("mouseleave",b)}},[i,t?.getStage()]),!t||!i||i.length===0)return null;const v=[];for(let y=0;y<i.length;y++){const _=i[y];if(_.isClosed())continue;const C=_===h,E=_===u,x=_.getRange().getCoords(),R=t.getRangeCoordsBounds(x);let I;if(C||E){const A=_.getStyle().getProperties(),M=A.headerRow?.fill?.background??A.wholeTable?.border?.top?.color?.toString();if(M&&n){const k=n.getStyles().parseColor(M);k&&(I=k.toCSS())}I||(I="var(--sxl-app-color-shadow, rgba(0,0,0,.15))")}v.push(ge.jsx("div",{style:{position:"absolute",left:R.x,top:R.y,width:Math.min(16,R.width),height:R.height,pointerEvents:"all",cursor:Yx},onMouseDown:p},`table-select-row-${_.getName()}`)),v.push(ge.jsx("div",{style:{position:"absolute",left:R.x,top:R.y,width:Math.min(16,R.width),height:Math.min(16,R.height),pointerEvents:"all",cursor:Qx},onMouseDown:m},`table-select-${_.getName()}`)),v.push(ge.jsx(Fp,{x:R.x,y:R.y,width:R.width,height:R.height,range:x,strokeWidth:E?.5:0,stroke:I??"var(--sxl-app-color-grey, grey)",style:{willChange:"box-shadow",transition:"box-shadow 80ms ease-in-out",boxShadow:C?`${I} 0px 0px 1px 1px`:void 0}},`table-outline-${_.getName()}`))}return v})),tE=T.memo(T.forwardRef((s,e)=>{const{view:t,sheet:n,animationTime:r=60}=s,[o,i]=ut.useState(null),[l,a]=ut.useState(null),c=ut.useRef(null),u=Fe(()=>{const p=n.getSelectedCell(),w=p.getSpill()?.getCoords()??null;J.isEqualRanges(w,o)||(a(w?{transition:o?"move":"in",bounds:t.getRangeCoordsBounds(w),coords:w}:{transition:"out",bounds:t.getRangeCoordsBounds(o),coords:o}),i(w))},[n,t,o]);ut.useEffect(()=>(c.current&&(clearTimeout(c.current),c.current=null),l&&(c.current=setTimeout(()=>{a(null),c.current=null},r)),()=>{c.current&&(clearTimeout(c.current),c.current=null)}),[l,r]);const d=ut.useMemo(()=>V.debounce(V.throttle(u,80),80),[]);if(Rt(n?.getSelection(),{onChange(p){d()}}),Rt(n,{onSpillsChange(p){u()},onInvalidated(p){u()}}),!t||!o&&!l)return null;const h=n.getRange(o).getValue()instanceof He.Spill,f=[];let g=l?.bounds??t.getRangeCoordsBounds(o);if(l&&!V.isEqualBounds(l.bounds,t.getRangeCoordsBounds(l.coords))&&a(null),g=t.toClipBounds(g,-10),!g)return;const m="var(--sxl-app-color-primary-dark, rgba(0,0,0,.15))";return f.push(ge.jsx(Fp,{x:g.x,y:g.y,width:g.width,height:g.height,range:o,strokeWidth:1,stroke:m,style:{willChange:"transform, opacity, width, height, opacity, left, top",strokeDasharray:h?"6 3":void 0,opacity:l?.transition==="out"?0:1,transition:l?.transition?l.transition==="in"||l.transition==="out"?`opacity ${1.5*r}ms ease-in-out`:`left ${r}ms ease-out, top ${r}ms ease-out, width ${r}ms ease-out, height ${r}ms ease-out`:"none",boxShadow:`${m} 0px 0px 4px 0px`}},"spill-outline}")),f})),nE={position:"absolute",top:0,left:0,bottom:0,right:0},op=(s,e)=>{const t={...s},n=e?.getNormal().getFont(),r=n?.toCSS(),o={text:{fontFamily:r?.fontFamily,fontSize:n?.getSize()}},i=t.body=V.mergeContentful(s.body,o);return t.body=V.mergeContentful({fill:"#fff",strokeFill:"#dad8d6",strokeWidth:.5,text:{fontWeight:"400",fontStyle:"normal",fill:"#040404"}},i),t.buttonSurface=V.mergeContentful({fill:"#fff",text:{fill:"black"},edgeStrokeFill:"black"},t.buttonSurface),t.selection={fill:"rgba(16, 124, 65, 0.1)",strokeFill:"#217346",strokeWidth:2,...s.selection},t.selectionInactive={...t.selection,fill:"rgba(16, 124, 65, 0.1)",strokeFill:"#dad8d6",...s.selectionInactive},t.selectionRemove={...t.selection,fill:"rgba(200, 0, 0, 0.1)",strokeFill:"rgba(200, 0, 0, 1)",...s.selectionRemove},t.headerSelection={...t.selection,...s.headerSelection},t.headerSelectionInactive={...t.selectionInactive,...s.headerSelectionInactive},t.header=V.mergeContentful(t.body,{edgeStrokeFill:"rgb(171, 171, 171)",fill:"#f0f0f0",strokeShadow:void 0,edgeStrokeWidth:1},s.header),t.header=V.mergeContentful(t.header,o),t.headerSelect=V.mergeContentful(t.header,{fill:"rgba(16, 124, 65, 0.1)",text:{fill:t.headerSelection.strokeFill,fontWeight:"700"}},s.headerSelect),t.headerSelect=V.mergeContentful(t.headerSelect,o),t.headerSelectAll=V.mergeContentful(t.headerSelect,{},s.headerSelectAll),t.headerSelectAll=V.mergeContentful(t.headerSelectAll,o),t},rE={fireOnModelChange:!1},sp={},oE=T.memo(T.forwardRef((s,e)=>{const{sheet:t,gridStyle:n=sp,headersStyle:r=sp,onSheetContextMenu:o,showColumnHeaders:i,columnHeaderProps:l,showRowHeaders:a,rowHeaderProps:c,showScrollbars:u=!0,scrollPaneProps:d,onViewportChange:h,commands:f,onRepeatCommandChange:g,onMoveCell:m,overlays:p,renderMovable:w,viewportComponent:S,onElementLoad:b,getCellEditor:v,onFocus:y,onBlur:_,style:C=wt.EmptyCssProperties,notifier:E,onShowTooltip:x,onShowColumnTooltip:R,onShowRowTooltip:I,onCloseTooltip:A,gridProps:M,cellRenderProps:k,...F}=s;if(ut.useEffect(()=>{ec._validate(!0)},[]),!t)throw new Error("ISheet must be provided.");const[L,N]=ut.useReducer(Ie=>Ie+1,0),[D,{width:O,height:H}]=ko(),z=Fe(x,[x]),j=Fe(R,[R]),q=Fe(I,[I]),P=Fe(A,[A]),U=T.useRef(!1);T.useLayoutEffect(()=>{U.current=!0},[t]);const ne=t?.getStyles(),ee=T.useMemo(()=>op(n,ne),[n,ne]),ve=T.useMemo(()=>op(r,ne),[r,ne]),{body:le={},buttonSurface:Ce={}}=ee,{header:re={},headerSelect:ae={},headerSelectAll:fe={}}=ve,ye=T.useRef(null),[he,we]=T.useState(()=>t?.getView()),be=(he?.getZoomScale()??100)/100,me=T.useMemo(()=>({vertical:he.isShowColumnGridlines()&&be>=.4,horizontal:he.isShowRowGridlines()&&be>=.4}),[he?.isShowColumnGridlines(),he?.isShowRowGridlines(),be]),de=T.useMemo(()=>{if(he?.getGridLineColor())return{strokeDasharray:"1,1"}},[he?.getGridLineColor(),ee]),xe=i??he?.isShowColumnHeaders(),Le=a??he?.isShowRowHeaders(),[W,Ze]=T.useState({width:0,height:0}),Xe=T.useMemo(()=>{let Ie=40,Ke=20;const Ye=t?.getStyles().getNormal().getFont();if(W.width>0&&W.height>0){const it=Ye?.toCSS()?.fontFamily??ee.header.text.fontFamily,pt=Ye?.getSize()??ee.header.text.fontSize,xt=ke.getSharedMeasurer()(""+W.height,Math.ceil(pt*ke.getDeviceScale()),it);Ie=xt.width,Ke=xt.lineHeight}return{width:Math.round(Ie+5),height:Math.round(Ke+3)}},[W,ee?.header.text,t]),Ge=Le?be*Xe.width:re.edgeStrokeWidth,ce=xe?be*Xe.height:re.edgeStrokeWidth,We=Math.max(O,(t?.getColumnHeaders().getDefaultSize()??Xe.width)+Ge+1),qe=Math.max(H,(t?.getRowHeaders().getDefaultSize()??Xe.height)+ce+1),De=T.useRef(new Map),Te=T.useRef(null),ze=()=>({getColOffset:Ie=>t.getColumnHeaders().findOffset(Ie),getColIndex:Ie=>t.getColumnHeaders().findIndex(Ie),getRowOffset:Ie=>t.getRowHeaders().findOffset(Ie),getRowIndex:Ie=>t.getRowHeaders().findIndex(Ie)}),[Z,Se]=T.useState(()=>ze()),[te,ie]=T.useState(!1),[$,Y]=T.useState(null),Q=!0,K=ee.selection?.strokeFill,se=T.useCallback(()=>cr.current,[]),[X,ue]=T.useState(),_e=Fe(Ie=>{ue(Ie),t&&t.getView()&&t.getView().setTopLeft(Ie?{left:Ie.left,top:Ie.top}:null),h?.(Ie)},[t,h]),Re=T.useRef(null);T.useEffect(()=>{if(!X||!t)return;const Ie=t.getRangeAtBounds({x:X.left,y:X.top,width:X.width,height:X.height});Re.current?.(),Re.current=Ie.addListener(()=>{const Ke=Ie.getCoords();ye?.current?.invalidate(Ke)})},[X,t]);const[Ne,Oe]=T.useState(()=>t?.getView().getTopLeft()),Be=Fe(Ie=>{const Ke=J.cellToRange(Ie);if(t.isClosed())return Ke;const Ye=t.getRange(Ke,{excludeHidden:!0}).getMerges();return Ye.length===0?Ke:Ye[0]},[t]),Ue=Ie=>{if(!Ie||Ie.coords.colIndex===0&&Ie.coords.rowIndex===0)return null;const Ke={};return Ie.coords.colIndex>0&&(Ke[Et.Left]={index:Ie.coords.colIndex,scrollOffset:Ie.topLeft.left}),Ie.coords.rowIndex>0&&(Ke[Et.Top]={index:Ie.coords.rowIndex,scrollOffset:Ie.topLeft.top}),Ke},[$e,Ve]=T.useState(()=>Ue(t.getView().getFreezePanes())),Je=Fo(),rt=T.useCallback(()=>ye.current,[]),et=Fe(Ie=>{Je.setMode(Ke=>Ke?.key==="edit"?{...Ke,args:{...Ke.args}}:{key:"edit",args:{stateAndCoords:null,start:Ie}})},[]),at=Fe(()=>X,[X]),nt=Rx({sheet:t,commands:f,target:rt,onRepeatCommandChange:g,bodyStyle:le,notifier:E,onStartEdit:et,getViewport:at}),[ht,tt]=T.useState(t.getSelection().isEntire()),[yt,Xt]=T.useState(he?.getMovableSelection().length>0),Rn=$!==null||yt,$n=null,[dt,Dt]=T.useState(!1);T.useEffect(()=>{Dt(!1)},[t.getProtection()]);const In=Fe(()=>{dt||(Dt(!0),E.showMessage?.(ge.jsxs("span",{children:["This sheet is protected.",ge.jsx("br",{}),"To make a change, unprotect the sheet. You might be requested to enter a password."]}),{type:Vd.Error}))},[E,dt]),Fn=T.useMemo(()=>{const Ie=Je.getMode();return Ie?.cursor?Ie.cursor:null},[$n,Je]),[An,un]=T.useState(null),Wt=T.useRef(!1),[$r,zo]=T.useState([]),Os=T.useRef(null),[uo,Ds]=T.useState(zr.EmptyTopLeft),[yr,sl]=T.useState(zr.EmptyTopLeft);T.useEffect(()=>{Ds({left:Ne?.left,top:0})},[Ne?.left]),T.useEffect(()=>{sl({left:0,top:Ne?.top})},[Ne?.top]),Rt(t?.getView(),{onFreezeSplitChange:()=>{Ve(Ue(t.getView().getFreezePanes()))},onTopLeftChange:()=>{Oe(t.getView().getTopLeft())},onMovableSelectionChange:()=>{Xt(t.getView().getMovableSelection().length>0)}}),Rt(t?.getSelection(),{onChange:()=>{tt(t.getSelection().isEntire())}}),Rt(t,{onViewChange(){we(t.getView()),Se(ze())},onLayoutChange:()=>{const Ie=t.getEntireRange();Ze({height:Ie.getRowCount(),width:Ie.getColumnCount()}),Se(ze())},onStyleChange:()=>{ho()},onMovablesChange:()=>{},onInvalidated:()=>{ho()}}),Rt(t,{onRequestScrollIntoView:async(Ie,Ke)=>{if(!Ke)return;const Ye={colIndex:Ke?.coords.colStart,rowIndex:Ke?.coords.rowStart};return await ye.current?.scrollCellCoordsIntoView(Ye,Ke?.scroll),!0},onRequestFocus:()=>V.whenFocus(cr.current)},rE);const Mn=T.useRef(!1),Po=T.useMemo(()=>{const Ie=(Ye,it)=>{Wt.current=!0,un([pt=>{if(!pt.toClipBounds(pt.getRangeCoordsBounds({rowStart:0,rowEnd:W.height,colStart:Ye,colEnd:Ye})))return;const xt=pt.getLayout(),Mt=Math.max(0,xt.getColOffset(Ye)),vt=pt.getBounds(),tn=Math.min(vt.x+vt.width,xt.getColOffset(Ye+1)),Sn=pt.getAnchor();if(it!==null&&(Sn===Et.Left||Sn===Et.Center||Sn===Et.Right)){const Cc=V.roundAccurately(it*V.getDPI(),0),cl=V.roundAccurately(t?.getColumnWidthAsFontUnit(it/be),2).toFixed(2),xc="Width: "+(it?cl+" ("+Cc+" pixels)":"Hidden"),$s=Wo.current.getGridElement().getRelativePointFromClient(0,0),jo=0-$s.y,ul=0-$s.y+ce,Ec={x:Mt-($s.x-vt.x),y:jo,width:tn-Mt,height:ul-jo};requestAnimationFrame(()=>{Wt.current&&j?.({anchor:Ec,display:xc})})}const Vr=[0,0,0,vt.height],Hs={style:{boxShadow:`0.5px 0px 0px 0px ${n?.body?.fill}`},pathProps:{stroke:K}},yc={x:Mt-1,y:0,width:1,height:vt.height},bc={style:{boxShadow:`-0.5px 0px 0px 0px ${n?.body?.fill}`},pathProps:{stroke:K}},vc={x:tn-1,y:0,width:1,height:vt.height};return ge.jsxs(ut.Fragment,{children:[ge.jsx(dl,{linePoints:Vr,bounds:yc,...Hs}),ge.jsx(dl,{linePoints:Vr,bounds:vc,...bc})]},"resize-dividers")}])};let Ke=null;return{onResizeHeadersStart:(Ye,it,pt)=>{Ke=t.beginCommit(pt),Mn.current=!1,Ie(Ye,it)},onResizeHeaders:(Ye,it,pt)=>{Mn.current=!1,Ie(Ye,it)},onResizeHeadersDown:(Ye,it)=>{Mn.current=!0,setTimeout(()=>{Mn.current&&Ie(Ye,it)},280)},onResizeHeadersEnd:(Ye,it,pt)=>{Ke?.commit({description:pt}),Ke=null,Mn.current=!1,requestAnimationFrame(()=>P?.()),Wt.current=!1,un(null)},onResizeHeadersUp:Ye=>{Mn.current=!1,requestAnimationFrame(()=>P?.()),Wt.current=!1,un(null)},...l}},[t,l,ce,An]),Ls=T.useMemo(()=>{const Ie=(Ye,it)=>{Wt.current=!0,un([pt=>{if(!pt.toClipBounds(pt.getRangeCoordsBounds({rowStart:Ye,rowEnd:Ye,colStart:0,colEnd:W.width})))return;const xt=pt.getLayout(),Mt=Math.max(0,xt.getRowOffset(Ye)),vt=pt.getBounds(),tn=Math.min(vt.y+vt.height,xt.getRowOffset(Ye+1)),Sn=pt.getAnchor();if(it!==null&&(Sn===Et.Top||Sn===Et.Center||Sn===Et.Bottom)){const Cc=Math.floor(10*V.getDPI())/10,cl=V.roundAccurately(it*Cc,0),xc=V.roundAccurately(cl/be/(t?.getRowHeaders().getScaleFactor()*V.getDPI()),2).toFixed(2),$s="Height: "+(it?xc+" ("+cl+" pixels)":"Hidden"),jo=Vo.current.getGridElement().getRelativePointFromClient(0,0),ul=0-jo.x,Ec=0-jo.x+Ge,NS={x:ul,y:Mt-(jo.y-vt.y),width:Ec-ul,height:tn-Mt};requestAnimationFrame(()=>{Wt.current&&q?.({anchor:NS,display:$s})})}const Vr=[0,0,vt.width,0],Hs={style:{boxShadow:`0px 0.5px 0px 0px ${n?.body?.fill}`},pathProps:{stroke:K}},yc={x:0,y:Mt-1,width:vt.width,height:1},bc={style:{boxShadow:`0px -0.5px 0px 0px ${n?.body?.fill}`},pathProps:{stroke:K}},vc={x:0,y:tn-1,width:vt.width,height:1};return ge.jsxs(ut.Fragment,{children:[ge.jsx(dl,{linePoints:Vr,bounds:yc,...Hs}),ge.jsx(dl,{linePoints:Vr,bounds:vc,...bc})]},"resize-dividers")}])};let Ke=null;return{onResizeHeadersStart:(Ye,it,pt)=>{Ke=t.beginCommit(pt),Mn.current=!1,Ie(Ye,it)},onResizeHeaders:(Ye,it,pt)=>{Mn.current=!1,Ie(Ye,it)},onResizeHeadersDown:(Ye,it)=>{Mn.current=!0,setTimeout(()=>{Mn.current&&Ie(Ye,it)},280)},onResizeHeadersEnd:(Ye,it,pt)=>{Ke?.commit({description:pt}),Ke=null,Mn.current=!1,requestAnimationFrame(()=>P?.()),Wt.current=!1,un(null)},onResizeHeadersUp:Ye=>{Mn.current=!1,requestAnimationFrame(()=>P?.()),Wt.current=!1,un(null)},...c}},[t,c,Ge]),cr=_r(e,()=>{const Ie=Ye=>{t?.getView()&&t.getView().selectMovables([]),Te.current=null,ye?.current?.focus(Ye)},Ke=async(Ye=null)=>{if(Ye||(Ye=t?.getView().getMovableSelection()[0]),!Ye)return!1;const it=Ye.getAnchorCoords();if(!it)return!1;const pt=ye.current?.getViewFromCellCoords({colIndex:it.colStart,rowIndex:it.rowStart});if(!pt)return!1;const xt=pt.getAnchor();t?.getView().getMovableSelection().indexOf(Ye)===-1&&t?.getView().selectMovables([Ye]);let Mt=De.current?.get(xt);return Mt?.current?(await Mt.current.focusMovable(Ye),!0):(Te.current={movable:Ye,anchor:xt},!0)};return{getGridElement:()=>ye.current,getRowHeaderElement:()=>Vo.current,getColumnHeaderElement:()=>Wo.current,rowHeaderHeight:()=>ce,colHeaderWidth:()=>Ge,startEdit:et,submitEdit:()=>{Je.setMode(Ye=>Ye?.key!=="edit"?Ye:{key:"edit",args:{stateAndCoords:null,submit:!0}})},cancelEdit:()=>{Je.setMode(Ye=>Ye?.key!=="edit"?Ye:{key:"edit",args:{stateAndCoords:null,cancel:!0}})},isEditing:$!==null,focus:Ye=>{t?.getView().getMovableSelection().length>0&&Ke()||Ie(Ye)},focusSheet:Ie,focusMovable:Ke,contains:Ye=>ye?.current?.contains?.(Ye),invalidate:ho,isSheetElement:()=>!0,getSheet:()=>t}},[t]),ho=T.useCallback(Ie=>{U.current||(ye?.current?.invalidate(Ie),N?.())},[]);T.useEffect(()=>{ho()},[ee]);const il=ht?fe.edgeStrokeFill:re.fill,It=ht?ae.fill:typeof ee.headerHover=="function"?ee.headerHover(re)?.fill:re.fill,ll=T.useMemo(()=>S?ge.jsx("div",{className:Nn("sheetxl-viewport-overlay",Cx),style:{width:"100%",height:"100%",boxSizing:"border-box",position:"absolute"},children:S}):ge.jsx(ge.Fragment,{}),[S]);let Ho=null;xe&&Le&&(Ho=ge.jsxs("div",{tabIndex:-1,className:"top-left-corner",style:{padding:"2 2",position:"absolute",height:`${ce}px`,width:`${Ge}px`,zIndex:1,boxSizing:"border-box",cursor:"cell"},onMouseDown:Ie=>{let Ke=!Ie.ctrlKey;nt?.getCommand("selectAll")?.execute(!Ke||Ie.button!==0),Ie.nativeEvent.which===Ap.Right?o?.({originalEvent:Ie,clientX:Ie.clientX,clientY:Ie.clientY,rowIndex:-1,colIndex:-1}):ye.current?.focus()},children:[ge.jsx("div",{style:{height:ce-5+"px",width:ce-5+"px",clipPath:`path('M${ce-5} 0 L0 ${ce-5} L${ce-5} ${ce-5} L${ce-5} 0 Z')`,borderRight:`2px solid ${il}`,borderBottom:`2px solid ${il}`,background:`${It}`,boxSizing:"border-box",position:"absolute",right:"2px",bottom:"2px"}}),ge.jsx("div",{style:{position:"absolute",height:`${ce}px`,width:`${Ge}px`,boxSizing:"border-box",borderRight:`solid 1px ${re.strokeFill}`,borderBottom:`solid 1px ${re.strokeFill}`,right:"-1px",bottom:"-1px"}})]}));const Bs=Fe(({_left:Ie,_top:Ke})=>{},[]),en=Fe(Ie=>{if(!o)return;const Ke=ye.current.getViewFromClient(Ie.clientX,Ie.clientY)?.getCellCoordsFromClient(Ie.clientX,Ie.clientY);Ke&&(o({originalEvent:Ie,clientX:Ie.clientX,clientY:Ie.clientY,rowIndex:Ke.rowIndex,colIndex:Ke.colIndex}),Ie.stopPropagation(),Ie.preventDefault())},[o]),Cn=Fe(Ie=>{if(!(!Ie.shiftKey&&(Ie.ctrlKey||Ie.metaKey)))return;const{deltaY:Ke}=Ie;return Ke>0?nt.getCommand("sheetZoomOut")?.execute():Ke<0&&nt.getCommand("sheetZoomIn")?.execute(),Ke===0},[nt]);T.useEffect(()=>{zo(null),Os.current=null,Wt.current=!1,un(null);const Ie=t?.getView().getTopLeft();Bs(Ie),ye.current?.scrollTo(Ie),Oe(Ie),we(t.getView()),Ve(Ue(t.getView().getFreezePanes())),Se(ze()),N()},[t?.getView()]);const zs=Fe(Ie=>{const Ke=Ie.getVisibleRangeCoords();if(!Ke)return null;const Ye=[];return t.getRange(Ke).forEach((it,pt)=>{const xt=pt.getCoords(),Mt=pt.getCell();(vt=>{if(vt.isEmpty())return!1;const tn=vt.getSpans();if(tn.width>1||tn.height>1||vt.getStyle().hasVisibleStyling()||he.isShowFormulas()&&vt.getFormula()!==null)return!0;const Sn=vt.getValue();return Sn!==null&&!(!he.isShowZeros()&&Sn===0&&vt.getType()===Me.Number)})(Mt)&&Ye.push({coords:xt,value:Mt,range:he.isShowFormulas()?null:Mt.getExtrusions()})},{excludeHidden:!0,includeMergeOverflow:!0}),Ye},[t,he.isShowZeros(),he.isShowFormulas(),$]);T.useEffect(()=>{const Ie=[];p&&Ie.push(...p),An&&Ie.push(...An),V.isEqualArrays(Ie,Os.current)||(Os.current=Ie,zo(Ie))},[p,An,ee]);const Ps=T.useMemo(()=>({style:{boxShadow:`0.5px 0.5px 0px 0px ${n?.body?.fill}`},pathProps:{stroke:n?.body?.text?.fill??"black"}}),[ee?.header?.edgeStrokeFill]),$o=Fe(Ie=>{Ie.isDefaultPrevented()||Ie.isPropagationStopped()||(Te.current=null,t?.getView().getMovableSelection().length>0&&t.getView().selectMovables([]))},[t]),mc=T.useMemo(()=>{const Ie=Je.getMode();return Ie?.key==="cut"||Ie?.key==="copy"},[Je]),pc=Fe(async Ie=>{const Ke=Je.getMode();return Ie.keyCode===xn.Escape&&Ke?(Ie.preventDefault(),void Je.setMode(null)):Ie.keyCode===xn.Enter&&mc?(Ie.preventDefault(),await nt?.getCommand("paste")?.execute(),void Je.setMode(null)):void nt?.dispatchToFocusedCommand(Ie)},[nt,Je]),Vo=T.useRef(null),al=T.useMemo(()=>ge.jsx("div",{tabIndex:-1,style:{position:"relative",flex:"0",top:`${ce+1}px`,width:`${Ge+re.edgeStrokeWidth}px`,minWidth:`${Ge+re.edgeStrokeWidth}px`,borderRight:`solid ${re.edgeStrokeWidth}px ${re.edgeStrokeFill}`,height:`calc(100% - ${ce}px)`,boxSizing:"border-box",zIndex:"2"},children:ge.jsx(tp,{ref:Vo,sheetElement:cr.current,gridRef:ye,freezeStart:$e?.[Et.Top],oppositeSize:Ge,containerWidth:Ge,containerHeight:qe,sheetHeader:t.getRowHeaders(),gridStyle:ve,verticalPadding:Math.max(0,Math.floor(t.getStyles().getNormal().getFont().getSize()/10)),scrollPoint:yr,onSheetContextMenu:o,tabIndex:-1,style:{position:"relative",flex:"0",top:`${ce+1}px`,width:`${Ge+re.edgeStrokeWidth}px`,minWidth:`${Ge+re.edgeStrokeWidth}px`,borderRight:`solid ${re.edgeStrokeWidth}px ${re.edgeStrokeFill}`,height:`calc(100% - ${ce}px)`,boxSizing:"border-box",zIndex:"2",...Ls?.style},...Ls})}),[Ge,ce,qe,t,yr,$e?.[Et.Top],ee,Q,o,re.fill,c]),Wo=T.useRef(null),ES=T.useMemo(()=>ge.jsx("div",{tabIndex:-1,style:{position:"relative",left:"0px",width:"100%",height:`${ce+re.edgeStrokeWidth}px`,minHeight:`${ce+re.edgeStrokeWidth}px`,borderBottom:`solid ${re.edgeStrokeWidth}px ${re.edgeStrokeFill}`,boxSizing:"border-box",zIndex:"1"},children:ge.jsx(tp,{ref:Wo,sheetElement:cr.current,gridRef:ye,freezeStart:$e?.[Et.Left],oppositeSize:ce,containerWidth:We,containerHeight:ce,sheetHeader:t.getColumnHeaders(),gridStyle:ve,scrollPoint:uo,onSheetContextMenu:o,...Po,style:{...Po?.style,position:"relative",left:"0px",width:"100%",height:`${ce+re.edgeStrokeWidth}px`,minHeight:`${ce+re.edgeStrokeWidth}px`,borderBottom:`solid ${re.edgeStrokeWidth}px ${re.edgeStrokeFill}`,boxSizing:"border-box",zIndex:"1"}})}),[ce,We,t,uo,$e?.[Et.Left],ee,re.fill,Q,o,l]),RS=Fe(Ie=>{const{value:Ke,key:Ye,...it}=Ie;let pt=Ke,xt=$;if(!xt||xt.colIndex===Ie.coords.colIndex&&xt.rowIndex===Ie.coords.rowIndex||(xt=null),!pt){const tn=Ie.range;if(pt=t.getRange({rowIndex:tn.rowStart,colIndex:tn.colStart}).getCell(),pt.isEmpty())return null}let Mt=null;pt.getHyperlink()&&(Mt=async tn=>{if(k?.onLinkMouseDown?.(tn),tn.button===0&&!tn.isDefaultPrevented()){tn.stopPropagation(),tn.preventDefault();try{await pt.getHyperlink()?.open()}catch(Sn){E?.showError?.(Sn)}}}),xt&&xt.colIndex===Ie.range.colStart&&xt.rowIndex===Ie.range.rowStart&&(pt=pt.createTemporaryCell({value:null}));const vt=t.getStyles();return T.createElement(cx,{...it,key:Ye,bodyStyle:le,docTheme:vt.getTheme(),normalStyle:vt.getNormal(),showFormulas:he.isShowFormulas(),showZeros:he.isShowZeros(),onLinkMouseDown:Mt,...k,value:pt})},[t,Z,le,$,he?.isShowFormulas(),he.isShowZeros()]),IS=T.useCallback((Ie,Ke)=>{const{key:Ye,...it}=Ie;return[ge.jsx(Ax,{ref:Ke,getVisibleCells:zs,sheet:t,gridStyle:ee,...it},`border-${Ye}`),ge.jsx(eE,{ref:Ke,sheet:t,commands:nt,...it},`table-${Ye}`),ge.jsx(tE,{ref:Ke,sheet:t,...it},`spill-${Ye}`),ge.jsx(jx,{ref:Ke,sheet:t,commands:nt,notifier:E,onShowTooltip:z,onCloseTooltip:P,gridStyle:ee,gridRef:ye,editingCoords:$,isActive:Q,...it},`selection-${Ye}`),ge.jsx(Bx,{ref:Ke,sheet:t,commands:nt,gridStyle:ee,element:se,notifier:E,...it},`copy-paste-${Ye}`),ge.jsx(Xx,{ref:Ke,sheet:t,commands:nt,target:rt,notifier:E,renderMovable:w,movableProps:{onUnFocus:()=>{cr.current.focus()}},...it},`movable-${Ye}`),ge.jsx(Zx,{ref:Ke,sheet:t,commands:nt,notifier:E,gridStyle:ee,getCellEditor:v,showProtectedError:In,setEditingCoords:Y,...it},`editor-${Ye}`)]},[t,ye.current,ee,v,nt,E]),[bh,AS]=T.useState(!1),MS=T.useMemo(()=>{if(We===0||qe===0)return null;const Ie=t.getStyles().getNormal(),Ke=Ie.getFont(),Ye=Ie.getFill(),it=Ie.getBorder(),pt=Ie.getFill().getType()===Pe.Type.None;let xt=de,Mt=de;const vt=(Sn,Vr,Hs)=>Hs?{stroke:it.getBottom().isNone()?"none":Sn.getColor().toRGBA(le.darkMode).toString(),...Vr}:Vr;Mt=vt(it.getBottom(),Mt,!it.getBottom().isNone()),Mt=vt(it.getTop(),Mt,!it.getTop().isNone()),xt=vt(it.getRight(),xt,!it.getRight().isNone()),xt=vt(it.getLeft(),xt,!it.getLeft().isNone());let tn=he?.getGridLineColor()?.toRGBA(le.darkMode).toString()??le.strokeFill;return pt||(Mt=vt(it.getBottom(),Mt,!0),Mt=vt(it.getTop(),Mt,!0),xt=vt(it.getRight(),xt,!0),xt=vt(it.getLeft(),xt,!0)),ge.jsx(kp,{className:"sheetxl-sheet-primary",style:{...nE,...Ye.toCSS(le.darkMode),...Ke.toCSS(le.darkMode,be),"--sxl-app-color-background":le.fill,"--sxl-app-color-shadow":ee.colorShadow,"--sxl-app-color-grey":ee.colorGrey,"--sxl-app-color-button-fill":Ce.fill,"--sxl-app-color-button-text":Ce.text?.fill,"--sxl-app-color-button-border":Ce.edgeStrokeFill,"--sxl-app-color-primary-dark":ee.selection.strokeFill},ref:ye,zoom:be,...M,onFirstRender:Sn=>{AS(!0),M?.onFirstRender?.(Sn),nt?.activate()},showGridLines:me,gridLineColor:tn,gridLineColumnsProps:xt,gridLineRowsProps:Mt,freezeLeft:$e?.[Et.Left],freezeLeftProps:Ps,freezeTop:$e?.[Et.Top],freezeTopProps:Ps,width:We,height:qe,columnCount:W.width,rowCount:W.height,cursor:Fn??$n??"cell",clipCells:!0,layout:Z,cellRenderer:RS,overlayRenderer:IS,getCellCoordsAsRangeCoords:Be,getVisibleCells:zs,onWheelScroll:Cn,onPointerDown:$o,onKeyDown:pc,onViewportChange:_e,onImmediateScroll:Bs,scrollPoint:Ne,stageProps:{onFocus:()=>{nt?.activate()}},overlays:$r})},[L]);T.useEffect(()=>{U.current||N()},[Z,$e,be,nt,Ne?.left,Ne?.top,le,M,We,qe,Fn,$r,Q,$n]);let wc={flex:"1 1 100%",display:"flex",alignContent:"stretch",position:"relative"};u||(wc={...wc,...C});const TS=T.useMemo(()=>{const Ie=t.getStyles().getTheme(),Ke=Ie.getColorScheme(),Ye=Ie.getFontScheme();return{"--sxl-doc-color-dk1":Ke.getDk1().toCSS(le.darkMode),"--sxl-doc-color-dk2":Ke.getDk2().toCSS(le.darkMode),"--sxl-doc-color-lt1":Ke.getLt1().toCSS(le.darkMode),"--sxl-doc-color-lt2":Ke.getLt2().toCSS(le.darkMode),"--sxl-doc-color-accent1":Ke.getAccent1().toCSS(le.darkMode),"--sxl-doc-color-accent2":Ke.getAccent2().toCSS(le.darkMode),"--sxl-doc-color-accent3":Ke.getAccent3().toCSS(le.darkMode),"--sxl-doc-color-accent4":Ke.getAccent4().toCSS(le.darkMode),"--sxl-doc-color-accent5":Ke.getAccent5().toCSS(le.darkMode),"--sxl-doc-color-accent6":Ke.getAccent6().toCSS(le.darkMode),"--sxl-doc-color-hlink":Ke.getHlink().toCSS(le.darkMode),"--sxl-doc-color-fol-hlink":Ke.getFolHlink().toCSS(le.darkMode),"--sxl-doc-font-major":Ye.getMajorFont(),"--sxl-doc-font-minor":Ye.getMinorFont()}},[t.getStyles().getTheme()]);let Sc=ge.jsx("div",{style:wc,onTouchStart:()=>{vh()},onFocus:Ie=>{ie(!0),y?.(Ie)},onBlur:Ie=>{ie(!1),_?.(Ie)},ref:cr,...F,children:ge.jsx("div",{className:Nn("sheetxl-sheet",vx),style:{position:"absolute",width:"100%",height:"100%",boxSizing:"border-box",display:"flex",flexDirection:"column",flex:"1 1 100%",zIndex:"0",...TS},children:ge.jsxs("div",{style:{display:"flex",flexDirection:"row",flex:"1 1 100%"},children:[Ho,al,ge.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 100%",overflow:"hidden",position:"relative"},children:[ES,ge.jsxs("div",{style:{display:"flex",flexDirection:"column",flex:"1 1 100%",position:"relative",borderRight:`solid ${re.edgeStrokeWidth}px ${re.edgeStrokeFill}`,backgroundColor:le.fill},ref:D,onContextMenu:en,children:[MS,ll,ge.jsx(Ex,{style:{position:"absolute",right:24,bottom:4},colorLicensee:ee?.selection?.strokeFill,colorCredits:ee?.body?.text?.fill})]})]})]})})});if(u){const Ie=Ke=>ge.jsx(Jw,{...Ke,sheet:t});Sc=ge.jsx(LS,{style:{flex:"1 1 100%",overflow:"hidden",background:`${re.fill}`,minHeight:2*Xe.height,minWidth:2*Xe.width,...C},viewport:X,touchElement:ye.current?.stage,disableTouch:Rn,onScrollViewport:Ke=>{ye.current?.scrollTo(Ke)},createHorizontalScrollbar:Ie,createVerticalScrollbar:Ie,...d,children:Sc})}T.useEffect(()=>{U.current=!1,N?.(),te&&cr.current?.focus()},[t]);const[_c,kS]=T.useState(!1),vh=Fe(()=>{_c||kS(!0)},[_c]);return T.useEffect(()=>{if(bh)return typeof b=="function"&&b(),wt.detectIt().primaryInput==="touch"&&vh(),()=>{}},[b,bh,_c]),Sc}));oE.displayName="SheetElement";Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));const ip="data:image/webp;base64,UklGRhIPAABXRUJQVlA4TAYPAAAv/8F/EM8HIZJtWU0fdlTh3wRCIMlkE+EqkiTFyt57/KQ8/zKeEf5iaseNJClS1DGDxWcwvhfuCo5tW88SHw8Xh5ypbC3tnf8QHEfOB/D97w4PuFHBIx6MHJ74zvj/0aLdlH9AYWEjHiwOJR5M7Q+FAigmTRQOJRqczrVUKABQSMYgoAFFAhIwBkgaYEkBSABowDGgcYakUZirArQhRMUIIHGLBIAEEoDRfyokIAEAMhrSRmEOSPyS/jvR+BYFIWkUhLQhCpLGGQ2rhPiCOKPxDIVQmAZQDMYIjCTfNQXVJv8pnQqhuAonnczGDPv0VwFw/w+uGiAwQYjJXxffaJzROKPHoArGAPA+6o9AtiIj4XgAWGKCwAQBVNMSHQNEjTMqOSWPQEFRHOVl4vp/nnhI/DBNK8CGXCpeFvONip/jvPn67qb957v+Nssyv96/Jwg/xzT9yORhfR4fb6vF9ef39Nt62g55v37/7dRzfx9xFLRtIyX8ae+/AxARE8APxbCQtkidoqVGDBDxR3r8/59vo88vnW07v9nrY+l0tn0zemuSnn03W83Otn2zcarbfIrZqnG7Ykr77/nS5PP+/E6/iP7DgiRJiZX13F2QhYM/OrBtm7at/ZB927Zt27ZtPr/oK7Jt27b9x7dtGxcv1sFcc/R1woj+S2IkSZGkaXMpD2sZhqf3R5Y/23+2/2z/2f6z/Wf7z/af7T/bf7b/bP/97S8/r8tpn2+Rafa98ufeMc3nfK8v3V9QZHWVtFs5f/i2z8bd7+E/nX/Vuk9+uO6dF3IuWEy12r0S9eGUdA5q0RtuvnxxXpUFVPf5eQlfe7jG8j58Q6+uZZZNRGmv+GgOidbMMHMMy/WbJu7az/wcUqUk9C01LJNj5tZsDsnuizfPWh/F3WdN4FDO/eiYow4LozJuhpfDoPtcywyr8pAYDpv2RlmOB1TF7fBymPXAqA4Wwskrp3JY9oVZZA2efmm8m8O2Xa796tcoMprDvA2DAprXfkYWC9C0eflat2xrBgtRrKuDwgXemsKS5I6vr2zVzq9ZnLbUUzSHL5lFast+JTPi1rJUZWzN1bBuSSxZ7pvqaFfeVpYub2QtzaqI3McCtsppqPXPTWc0C9kjB3TqyFcsZ54b8/XpXJSHRW23qU1LJrC4PdFRlWsMzWCJ815ZpUYDU1no7mqiQ7VvYbnz9zIUaOkqFr3tZ7XnfKSHhe/+ON3pNJblL8N1QXEG+xlCXzXXmvKZjKJYn9IWKV7POMqIqlaYVtEMpU0l6lq46Eo3g2lvO2WtRPoB48m/SFXjwt3JiMqYp6eJkHWTGVQ3BZSky30Mq0/KVMTnZ2BN6aggV2UwtPa0UI+rGV1pylkm1RjB+IpZqpoxRG5ghGW/oZjr9xlj+xarZSiBBEaZe5BSxhK4jXHmeVElj/2Bkeb2KeQVzWKs7eumDnMZbemtlGEU4236UVUYyojb3UATK5Yx5lY30sOqRVlBn3YPdqKCgrexZ7SwcknQP13bfjWC6nD1XEcreHs8QgXOTg369bDmlxFQNU28mRpwYUMNXDcTQVXC2woYTOo2DrJxk1+ZQ9/9PIeNprjRs72ij4H2wbdZjdzdTDYizUXG9P3gnfZGDVy3gFMxD5ZBN9U7BWoJpoK2OpBvHvbYArWBUlFDgXu8QG2BVJanG2xLxC/UckNZZ6Om5VZmnd1NQfvtrRJzByPGXHr8ohqyn/eOr0MIZXAJZFvF1zGAUvC0AuzT+LpgXxJ7K/BuK/jA8LpiXhpPwZ3dcFN4XbIukUVgnVR01Y4WhVi19KLTC6Ca/vD4uevReM40PgHVY9GFMC2bHkAtG10Qy9K5rzHOLQkcGVwYwxJ6H+fspuAC2ZVSG5Rbjg0ulFk5Ta2FcUHTvcqtGrCo7aqZFo2EaK3oOXi0mpOO+xoinOB8cGgF2JTYrQC9EFoRJqV2Gp6Z3oisEItymxKBbniR+yIrxqDsBoCzUGQFpS+93fnYNiO4Z6FVwxc1WjXpotdCc0HoXHRMPucfY0qQTXJ6L+jqGCY0EzekcaOm+LY/g4PSCGCuirwgDtJ4dePy/uCvg2tJ8wNkhDzmObBsJDkhj7OagtL3rrwAhX84mnWiv8Yz+M/IXgyZHTFNc3jZ7dLYfSNo5uA2EpLzJT/c8b1liOY47CtHKOEfj+xcyRJ2vCqAx0MyRR2zE88uwr4hV9RxkoHGeIDv93Cf8aVotiT/uiTb0X+uKfFgnCw5Y473FWJxu7whx/wull0JkMwhx5MMJJ6UPeKYjyCZ43iw/BHHTwOxtAQAOPafwGEExem+vKd794bhxzckhNFvDgGbYbhCgoAbe46jcKsw0MbcH4Qv3hAH2vgOHIsbg4CNPScxuFcoWGPuhWFX8WnO/gt7hufPIVhSEstIOjN7ChF4WDhIY34RwcqGb4uHWfjnPZwmAQGN73PI7xkh4Yy5nvzuFhPOeKj4OkhQsqeJF9qz0DXAWB45sBFU7K6QXoKENTLOzPyC9PYIDGR8sfBOscikTwfzHp3MJlOPcujyB2TnYjiEMbeUfn0jOoRxP9GVeRgPYPyk6FqH3AaAUh5ZkOL4hpC/XLOim8/yXQ3yxXxWck9o4gb3h85/inFrhLfLQf3iIZIPNfmWLFQvniG4DyUPtYvHij7V0UXl4uxqua0vG3WLOUduNxjdELBn98vm8Jroy5z5jCSzJpY9m/CWnF43NYtvlHu8CclKxeJPxDabzNQrfkBsZ8pNteLMCKmdIDu1irmj1LaRn1rFraT2oAxVKh4oNcuHj7aRx9FNhof3pPaq5Djyzsi2RD3sDXmCSAejD/wqmeIM3y7JzS1b9YkfkfpAIchXdeI1Yu9ZqrHaxNOFdqGcVSbmgMyW974v2DmPb3A+lMhsbcl6rMrMXCCz9WSuKnFDmW0gdzWJc2S2suxVJO4s9YiT/uoRt5TZ1gJQjbitzMaJQC3iFVJfqhAElYiX6M3VCQ7FijMOokpYIfSTMFQLbYV+QQhlobUXtDJB9dBZ6OnOAFVEjtDznfyribpCz3e2ryoKLP9yJ4Uyu9x+rsmYUS2zS7yrjDSpjwuidbXxtdCmda46NghtGuPq4yOphx071LYKeZ+E7hXXamTk37XjTjzo+gqq0ThI7L2Nq9X7Z7Gexp1aq1ofnovVNO7cmfX67FyspXEnP/P74qxa1uho3Omrm6ZePpF73PkPzL41q5gbSOzu8PrOvGbek9uoXvF2Z1bKbQOvd8yajU3kdpHRx+W6yY4QfGfjfT4tV87dJLfBD1y+Kqudm0jwjjX5orx6+ol+ISM9viernxV/5+53wqw94f3OSCHJ/XII3Z/23S+tgPeHH5DovQgYoAWye5ovQkdldwpehNIDspuOLkSPkfDdCXaXo+7Pdj8G87pGemPRgnRI/Eua2/Pd78zMMvH3OhxtZhw/I/G7AytM78lvS6o4lQI4YuRQcbofwH5n//w6UqDeJwDtSBSpNyEcXSigSHkgHIqUqXq6x53xGUFoV56ZdHwZg41hYuU5jsF0b6AE6zEC0fEk0RqAwpIg0XKXwDiC6G9ghGsLwWgXolUZFzVxWAxjph3TgRyLsuFHIATsfQLS1gQRWw7laOMARGyyQUi61z5k/QiKRd1Dtq8Qi79e847ZDst/3Al+ROO7N6xn5HGtQWh62DdqiwiOWWyjtipAeLrXNGzvQjq40J5hu/ccIoPvOcbtUlBnFMF8VdZFswowGX6U4Yl+2KOLQHWiW+D2NUPl5/29Ijcb2NEGtYqc/ySw0wlzV2+038muI2AtFXWS2zCsewq3gsl+ZytEZnC/Xmi/011M0FpQYSPW/QRcwWC/80WfA3fcCXdOr2+ElFz+/U74CoFrnkPjFCy97I2tInRdo9T6RkgGku93yrYEz68HZdY3QrKQungC2DoKVCQTifM3g3g6yfboZfY76zCC2CeKHAvMNmPW/U47vogw9kKo4KzkLGMFzONOfFSo0Myk3O3A3xLMLlKowOxk3O/MtQlnj8QKy1C+/U69koCa6/BYQVnK1kcEtUV6kP1OvqsRVkOuV+wYMpuOqfY7ew8C26/7B+s6Y4maQXC7VMG6zFqaHigmvK0aravMZfm5E7SFfMJhdo/WRfZy/NwZ5hHk5vkgWscByNAj1YS5CxStwxCUb3dTQt2T4ToKQvGfO0kbgu3f28J1EIbCP3eWKwl40x8Yrm0ginaLQcg79ZCgX7UJRcEmnSPsncBBv2oZjGLF5sA/70y3oj/vTIcVcIpRHw3+nS1mnLHIzH1JAdV+MPhXk4WkRC5SQU1Sg3711QgJSnwfRWjhFPPuQ33e2b4oIi30WgZDblUd0kPzIbsvhzTRMMCm1yNddClc3iPqOO+ULrD2HSJ15EiEyr2YFFJVPFCeHqSSAh/gvPsZtZx32ptQPkd3xZx24NkYX1EbIsVczQUotivppivhSW1J2undDHDzGhqQfno+HZmHCkhDtYzG5fZzpKOOTUblxmrSUic2gjrv9KSoym8GJH0l6SozC40J9UlbHUnB4vETpK9OPorkZURWkcY6H4VjEbPupLWe9WKwriHpreZfIniyqPOkuSLmuaU3rRtpr4N7hf9/4yfSX+d2Sj6tqZdBKsx5j9Tu6EBa7IRLZLt6OUiRHZoqr62NSJddiHTLKsVJ+uzAWElXLBheRhrN4ZwmpcdakFarNS9bxDnMToMUW9148cTMKyfldvpu0WTecJz0mxEn1x2e+DzScQ6fTAsmZ2xtTz+n5juS5bGlM+m66meSZPl7Y2dnUnjLtmaIsSpxVEdSerkuvwiTmOedIMV38uKUcHfXqwFSflVL4zPDeJxhV3uyBB2/cnx4+sK8QJahqm47Y8PNg9c0JItRedyM2PAxMWqZQVakyrgZMeFg7y8PsS7VeuO70P4bxP3ZRaUGWZ6OmVv9oSk63llBVqkLh4Zt9IaW1Tt6tjfIYhWRY86YGCKH/WWGmUOWraaHxzw1yV2DMxQ2zHq51Tmyfl2o99bI25Jig2vP54ljDp9ykLWsdj3fkO9vvWPKtL8wndo7YeztOy8bcKh5OVncyhq2XNrd96ZpLrjy5/qYb/l8S7q2r1NJlj/bf7b/bP/Z/rP9Z/vP9p/tP9t/tv9s//3djwA=",sE=T.memo(T.forwardRef((s,e)=>{const{children:t,disabled:n,style:r,picture:o,description:i,isDragging:l,view:a,onHide:c,onShow:u,onKeyDownCapture:d,onFocus:h,onBlur:f,loadingPanel:g,...m}=s,[p,w]=T.useState(!1),[S,b]=T.useState(null),[v,y]=T.useState(null),[_,C]=T.useState(null);T.useEffect(()=>{y(null),o.getDetails().then(R=>{w(!1),y(R.asUrl()),R.asSVGText?.()&&C(R.asSVGText())}).catch(R=>{console.warn(R),w(!0),y(ip),C(null)})},[o]);const E=_r(e,()=>({isPictureEditor:()=>!0}),[]),x=T.useMemo(()=>{if(v||_)return ge.jsx("img",{style:{flex:"1",width:"100%",height:"100%",border:p?"var(--sxl-app-color-grey, grey) solid 1px":void 0,backgroundColor:p?"var(--sxl-app-color-background, white)":void 0,boxShadow:p?"0px 0px 3px var(--sxl-app-color-error, red)":void 0,objectFit:p?"contain":void 0,opacity:S?1:0,filter:"var(--sxl-app-filter-dark-invert)"},draggable:!1,src:v,onLoad:()=>{b(!0)},onError:({currentTarget:R})=>{console.log("error"),R.onerror=null,y(ip),w(!0)},alt:i??`${o.getType()}`})},[S,o,v,_,l]);if(!o.isClosed())return ge.jsxs("div",{className:"picture-editor",style:{position:"relative",display:"flex",flex:"1 1 100%",filter:l?"drop-shadow(1px 1px 1.5px var(--sxl-app-color-shadow, rgba(0, 0, 0, .25)))":void 0,...r,width:"100%",height:"100%"},tabIndex:0,...m,onKeyDownCapture:R=>{d?.(R)},ref:E,children:[S||p?void 0:g,x]})}));sE.displayName="PictureEditor";const XR=T.memo(T.forwardRef((s,e)=>{const{children:t,disabled:n,chart:r,view:o,isDragging:i,onHide:l,onShow:a,...c}=s;T.useEffect(()=>{},[r]);const u=_r(e,()=>({isChartEditor:()=>!0}),[]),[d,{height:h,width:f}]=ko();if(!r.isClosed())return ge.jsx("div",{...c,ref:ks([u,d]),children:ge.jsx("div",{className:"chart-editor",style:{width:"100%",height:"100%",backgroundColor:"var(--sxl-app-color-background, white)",backgroundImage:"var(--sxl-app-image-background)",alignItems:"center",justifyContent:"center",zoom:o.getZoom(),display:"flex",position:"relative",border:"var(--sxl-app-color-grey, grey) solid 1px",filter:n?"blur(1px)":void 0,boxShadow:i?"1px 1px 2px var(--sxl-app-color-shadow, rgba(0,0,0,.15))":void 0},children:ge.jsx("div",{style:{textAlign:"center"},children:r.getDescription()})})})})),iE="_editable-input_1bqx6_6",lE=s=>ge.jsx("input",{...s}),aE=T.memo(T.forwardRef((s,e)=>{const{style:t={},className:n,value:r="",onSubmit:o,onChange:i,onCancel:l,createInput:a=lE,notifier:c,styleHover:u={},dragging:d,maxLength:h,disabled:f=!1,readOnly:g=!1,...m}=s,[p,w]=T.useState(!1),[S,b]=T.useState(!1),[v,y]=T.useState(r);T.useEffect(()=>{y(r)},[r]);const _=T.useRef(null),[C,E]=T.useState(null),x=T.useCallback(function(L){const N=L.message;C!==N&&(c?.showMessage?.(N,{type:Vd.Error}),E(N))},[c,C]),R=T.useCallback(L=>{let N=!1;try{N=o?.(L)??!0}catch(D){x(D)}return N?(_.current=null,b(!1),y(L),N):(setTimeout(()=>{_.current?.focus()},0),N)},[o]),I=Fe(()=>{y(r),_.current=null,b(!1),l?.()},[l,r]),A=T.useMemo(()=>{if(!S)return null;const L={className:Nn(iE),autoFocus:!0,spellCheck:!1,name:"editable-label",autoComplete:"off",maxLength:h,type:"text",value:v,onFocus:N=>{_.current||(_.current=N.target,setTimeout(()=>{N.target?.select()},0))},onBlur:N=>{_.current&&R(v)},onChange:N=>{S&&y(N.target.value)},onMouseDown:N=>N.stopPropagation(),onKeyDown:N=>N.code==="Escape"?(N.preventDefault(),void I()):N.code==="Enter"?(N.preventDefault(),void R(N.target.value)):void(N.code!=="Tab"?N.stopPropagation():R(N.target.value))};return ge.jsx(ge.Fragment,{children:a(L)})},[S,v,R,I,a,f]),[M,k]=T.useState();T.useLayoutEffect(()=>{let L=Object.assign({},t);(d||p)&&(L=Object.assign(L,u)),k(L)},[d,p,u,t]),T.useEffect(()=>{A&&i?.(v)},[A,i,v]);const F=_r(e,()=>({startEdit(){f||g||b(!0)},cancel(){I()}}),[]);return ge.jsxs("div",{...m,ref:F,style:{flexDirection:"column",display:"flex",...M},className:Nn(n),children:[ge.jsxs("div",{style:{position:"relative",boxSizing:"content-box",whiteSpace:"pre",userSelect:"none",display:"flex",justifyContent:"center"},onDoubleClick:()=>{f||g||b(!0)},onMouseEnter:()=>w(!0),onMouseLeave:()=>w(!1),children:[ge.jsx("div",{className:"editable-label-container",style:{textAlign:"center",display:"flex",minHeight:"1em",marginTop:"2px",opacity:S?0:1},children:v}),A]}),ge.jsx("div",{style:{whiteSpace:"pre",position:"relative",maxHeight:"0px",height:"0px",visibility:"hidden",marginLeft:"1px",marginRight:"1px",overflow:"hidden",...u},children:v})]})})),uc=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0;function Ns(s){const e=Object.prototype.toString.call(s);return e==="[object Window]"||e==="[object global]"}function gh(s){return"nodeType"in s}function En(s){var e,t;return s?Ns(s)?s:gh(s)&&(e=(t=s.ownerDocument)==null?void 0:t.defaultView)!=null?e:window:window}function fh(s){const{Document:e}=En(s);return s instanceof e}function nl(s){return!Ns(s)&&s instanceof En(s).HTMLElement}function Zw(s){return s instanceof En(s).SVGElement}function As(s){return s?Ns(s)?s.document:gh(s)?fh(s)?s:nl(s)||Zw(s)?s.ownerDocument:document:document:document}const or=uc?T.useLayoutEffect:T.useEffect;function dc(s){const e=T.useRef(s);return or(()=>{e.current=s}),T.useCallback(function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.current==null?void 0:e.current(...n)},[])}function Ui(s,e){e===void 0&&(e=[s]);const t=T.useRef(s);return or(()=>{t.current!==s&&(t.current=s)},e),t}function Fi(s,e){const t=T.useRef();return T.useMemo(()=>{const n=s(t.current);return t.current=n,n},[...e])}function Ua(s){const e=dc(s),t=T.useRef(null),n=T.useCallback(r=>{r!==t.current&&e?.(r,t.current),t.current=r},[]);return[t,n]}function qa(s){const e=T.useRef();return T.useEffect(()=>{e.current=s},[s]),e.current}let Vu={};function rl(s,e){return T.useMemo(()=>{if(e)return e;const t=Vu[s]==null?0:Vu[s]+1;return Vu[s]=t,s+"-"+t},[s,e])}function Yw(s){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((o,i)=>{const l=Object.entries(i);for(const[a,c]of l){const u=o[a];u!=null&&(o[a]=u+s*c)}return o},{...e})}}const hs=Yw(1),qi=Yw(-1);function hc(s){if(!s)return!1;const{KeyboardEvent:e}=En(s.target);return e&&s instanceof e}function Ja(s){if(function(e){if(!e)return!1;const{TouchEvent:t}=En(e.target);return t&&e instanceof t}(s)){if(s.touches&&s.touches.length){const{clientX:e,clientY:t}=s.touches[0];return{x:e,y:t}}if(s.changedTouches&&s.changedTouches.length){const{clientX:e,clientY:t}=s.changedTouches[0];return{x:e,y:t}}}return function(e){return"clientX"in e&&"clientY"in e}(s)?{x:s.clientX,y:s.clientY}:null}const No=Object.freeze({Translate:{toString(s){if(!s)return;const{x:e,y:t}=s;return"translate3d("+(e?Math.round(e):0)+"px, "+(t?Math.round(t):0)+"px, 0)"}},Scale:{toString(s){if(!s)return;const{scaleX:e,scaleY:t}=s;return"scaleX("+e+") scaleY("+t+")"}},Transform:{toString(s){if(s)return[No.Translate.toString(s),No.Scale.toString(s)].join(" ")}},Transition:{toString(s){let{property:e,duration:t,easing:n}=s;return e+" "+t+"ms "+n}}}),lp="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function cE(s){return s.matches(lp)?s:s.querySelector(lp)}const uE={display:"none"};function dE(s){let{id:e,value:t}=s;return ut.createElement("div",{id:e,style:uE},t)}function hE(s){let{id:e,announcement:t,ariaLiveType:n="assertive"}=s;return ut.createElement("div",{id:e,style:{position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"},role:"status","aria-live":n,"aria-atomic":!0},t)}const Qw=T.createContext(null),gE={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},fE={onDragStart(s){let{active:e}=s;return"Picked up draggable item "+e.id+"."},onDragOver(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was moved over droppable area "+t.id+".":"Draggable item "+e.id+" is no longer over a droppable area."},onDragEnd(s){let{active:e,over:t}=s;return t?"Draggable item "+e.id+" was dropped over droppable area "+t.id:"Draggable item "+e.id+" was dropped."},onDragCancel(s){let{active:e}=s;return"Dragging was cancelled. Draggable item "+e.id+" was dropped."}};function mE(s){let{announcements:e=fE,container:t,hiddenTextDescribedById:n,screenReaderInstructions:r=gE}=s;const{announce:o,announcement:i}=function(){const[d,h]=T.useState("");return{announce:T.useCallback(f=>{f!=null&&h(f)},[]),announcement:d}}(),l=rl("DndLiveRegion"),[a,c]=T.useState(!1);if(T.useEffect(()=>{c(!0)},[]),function(d){const h=T.useContext(Qw);T.useEffect(()=>{if(!h)throw new Error("useDndMonitor must be used within a children of <DndContext>");return h(d)},[d,h])}(T.useMemo(()=>({onDragStart(d){let{active:h}=d;o(e.onDragStart({active:h}))},onDragMove(d){let{active:h,over:f}=d;e.onDragMove&&o(e.onDragMove({active:h,over:f}))},onDragOver(d){let{active:h,over:f}=d;o(e.onDragOver({active:h,over:f}))},onDragEnd(d){let{active:h,over:f}=d;o(e.onDragEnd({active:h,over:f}))},onDragCancel(d){let{active:h,over:f}=d;o(e.onDragCancel({active:h,over:f}))}}),[o,e])),!a)return null;const u=ut.createElement(ut.Fragment,null,ut.createElement(dE,{id:n,value:r.draggable}),ut.createElement(hE,{id:l,announcement:i}));return t?Eo.createPortal(u,t):u}var nn;function Ka(){}function Wu(s,e){return T.useMemo(()=>({sensor:s,options:e??{}}),[s,e])}(function(s){s.DragStart="dragStart",s.DragMove="dragMove",s.DragEnd="dragEnd",s.DragCancel="dragCancel",s.DragOver="dragOver",s.RegisterDroppable="registerDroppable",s.SetDroppableDisabled="setDroppableDisabled",s.UnregisterDroppable="unregisterDroppable"})(nn||(nn={}));const ar=Object.freeze({x:0,y:0});function eS(s,e){return Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))}function pE(s,e){const t=Ja(s);return t?(t.x-e.left)/e.width*100+"% "+(t.y-e.top)/e.height*100+"%":"0 0"}function tS(s,e){let{data:{value:t}}=s,{data:{value:n}}=e;return t-n}function wE(s,e){let{data:{value:t}}=s,{data:{value:n}}=e;return n-t}function ap(s){let{left:e,top:t,height:n,width:r}=s;return[{x:e,y:t},{x:e+r,y:t},{x:e,y:t+n},{x:e+r,y:t+n}]}function nS(s,e){if(!s||s.length===0)return null;const[t]=s;return t[e]}function cp(s,e,t){return e===void 0&&(e=s.left),t===void 0&&(t=s.top),{x:e+.5*s.width,y:t+.5*s.height}}const SE=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:n}=s;const r=cp(e,e.left,e.top),o=[];for(const i of n){const{id:l}=i,a=t.get(l);if(a){const c=eS(cp(a),r);o.push({id:l,data:{droppableContainer:i,value:c}})}}return o.sort(tS)};function _E(s,e){const t=Math.max(e.top,s.top),n=Math.max(e.left,s.left),r=Math.min(e.left+e.width,s.left+s.width),o=Math.min(e.top+e.height,s.top+s.height),i=r-n,l=o-t;if(n<r&&t<o){const a=e.width*e.height,c=s.width*s.height,u=i*l;return Number((u/(a+c-u)).toFixed(4))}return 0}const yE=s=>{let{collisionRect:e,droppableRects:t,droppableContainers:n}=s;const r=[];for(const o of n){const{id:i}=o,l=t.get(i);if(l){const a=_E(l,e);a>0&&r.push({id:i,data:{droppableContainer:o,value:a}})}}return r.sort(wE)};function up(s,e){return s&&e?{x:s.left-e.left,y:s.top-e.top}:ar}function bE(s){return function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reduce((o,i)=>({...o,top:o.top+s*i.y,bottom:o.bottom+s*i.y,left:o.left+s*i.x,right:o.right+s*i.x}),{...e})}}const vE=bE(1);function rS(s){if(s.startsWith("matrix3d(")){const e=s.slice(9,-1).split(/, /);return{x:+e[12],y:+e[13],scaleX:+e[0],scaleY:+e[5]}}if(s.startsWith("matrix(")){const e=s.slice(7,-1).split(/, /);return{x:+e[4],y:+e[5],scaleX:+e[0],scaleY:+e[3]}}return null}const CE={ignoreTransform:!1};function Fs(s,e){e===void 0&&(e=CE);let t=s.getBoundingClientRect();if(e.ignoreTransform){const{transform:c,transformOrigin:u}=En(s).getComputedStyle(s);c&&(t=function(d,h,f){const g=rS(h);if(!g)return d;const{scaleX:m,scaleY:p,x:w,y:S}=g,b=d.left-w-(1-m)*parseFloat(f),v=d.top-S-(1-p)*parseFloat(f.slice(f.indexOf(" ")+1)),y=m?d.width/m:d.width,_=p?d.height/p:d.height;return{width:y,height:_,top:v,right:b+y,bottom:v+_,left:b}}(t,c,u))}const{top:n,left:r,width:o,height:i,bottom:l,right:a}=t;return{top:n,left:r,width:o,height:i,bottom:l,right:a}}function dp(s){return Fs(s,{ignoreTransform:!0})}function gc(s,e){const t=[];return s?function n(r){if(e!=null&&t.length>=e||!r)return t;if(fh(r)&&r.scrollingElement!=null&&!t.includes(r.scrollingElement))return t.push(r.scrollingElement),t;if(!nl(r)||Zw(r)||t.includes(r))return t;const o=En(s).getComputedStyle(r);return r!==s&&function(i,l){l===void 0&&(l=En(i).getComputedStyle(i));const a=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(c=>{const u=l[c];return typeof u=="string"&&a.test(u)})}(r,o)&&t.push(r),function(i,l){return l===void 0&&(l=En(i).getComputedStyle(i)),l.position==="fixed"}(r,o)?t:n(r.parentNode)}(s):t}function oS(s){const[e]=gc(s,1);return e??null}function ju(s){return uc&&s?Ns(s)?s:gh(s)?fh(s)||s===As(s).scrollingElement?window:nl(s)?s:null:null:null}function sS(s){return Ns(s)?s.scrollX:s.scrollLeft}function iS(s){return Ns(s)?s.scrollY:s.scrollTop}function Ld(s){return{x:sS(s),y:iS(s)}}var cn;function lS(s){return!(!uc||!s)&&s===document.scrollingElement}function aS(s){const e={x:0,y:0},t=lS(s)?{height:window.innerHeight,width:window.innerWidth}:{height:s.clientHeight,width:s.clientWidth},n={x:s.scrollWidth-t.width,y:s.scrollHeight-t.height};return{isTop:s.scrollTop<=e.y,isLeft:s.scrollLeft<=e.x,isBottom:s.scrollTop>=n.y,isRight:s.scrollLeft>=n.x,maxScroll:n,minScroll:e}}(function(s){s[s.Forward=1]="Forward",s[s.Backward=-1]="Backward"})(cn||(cn={}));const xE={x:.2,y:.2};function EE(s,e,t,n,r){let{top:o,left:i,right:l,bottom:a}=t;n===void 0&&(n=10),r===void 0&&(r=xE);const{isTop:c,isBottom:u,isLeft:d,isRight:h}=aS(s),f={x:0,y:0},g={x:0,y:0},m=e.height*r.y,p=e.width*r.x;return!c&&o<=e.top+m?(f.y=cn.Backward,g.y=n*Math.abs((e.top+m-o)/m)):!u&&a>=e.bottom-m&&(f.y=cn.Forward,g.y=n*Math.abs((e.bottom-m-a)/m)),!h&&l>=e.right-p?(f.x=cn.Forward,g.x=n*Math.abs((e.right-p-l)/p)):!d&&i<=e.left+p&&(f.x=cn.Backward,g.x=n*Math.abs((e.left+p-i)/p)),{direction:f,speed:g}}function RE(s){if(s===document.scrollingElement){const{innerWidth:o,innerHeight:i}=window;return{top:0,left:0,right:o,bottom:i,width:o,height:i}}const{top:e,left:t,right:n,bottom:r}=s.getBoundingClientRect();return{top:e,left:t,right:n,bottom:r,width:s.clientWidth,height:s.clientHeight}}function cS(s){return s.reduce((e,t)=>hs(e,Ld(t)),ar)}function uS(s,e){if(e===void 0&&(e=Fs),!s)return;const{top:t,left:n,bottom:r,right:o}=e(s);oS(s)&&(r<=0||o<=0||t>=window.innerHeight||n>=window.innerWidth)&&s.scrollIntoView({block:"center",inline:"center"})}const IE=[["x",["left","right"],function(s){return s.reduce((e,t)=>e+sS(t),0)}],["y",["top","bottom"],function(s){return s.reduce((e,t)=>e+iS(t),0)}]];class Bd{constructor(e,t){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const n=gc(t),r=cS(n);this.rect={...e},this.width=e.width,this.height=e.height;for(const[o,i,l]of IE)for(const a of i)Object.defineProperty(this,a,{get:()=>{const c=l(n),u=r[o]-c;return this.rect[a]+u},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class Oi{constructor(e){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(t=>{var n;return(n=this.target)==null?void 0:n.removeEventListener(...t)})},this.target=e}add(e,t,n){var r;(r=this.target)==null||r.addEventListener(e,t,n),this.listeners.push([e,t,n])}}function Gu(s,e){const t=Math.abs(s.x),n=Math.abs(s.y);return typeof e=="number"?Math.sqrt(t**2+n**2)>e:"x"in e&&"y"in e?t>e.x&&n>e.y:"x"in e?t>e.x:"y"in e&&n>e.y}var Jn,bt;function hp(s){s.preventDefault()}function AE(s){s.stopPropagation()}(function(s){s.Click="click",s.DragStart="dragstart",s.Keydown="keydown",s.ContextMenu="contextmenu",s.Resize="resize",s.SelectionChange="selectionchange",s.VisibilityChange="visibilitychange"})(Jn||(Jn={})),function(s){s.Space="Space",s.Down="ArrowDown",s.Right="ArrowRight",s.Left="ArrowLeft",s.Up="ArrowUp",s.Esc="Escape",s.Enter="Enter",s.Tab="Tab"}(bt||(bt={}));const dS={start:[bt.Space,bt.Enter],cancel:[bt.Esc],end:[bt.Space,bt.Enter,bt.Tab]},ME=(s,e)=>{let{currentCoordinates:t}=e;switch(s.code){case bt.Right:return{...t,x:t.x+25};case bt.Left:return{...t,x:t.x-25};case bt.Down:return{...t,y:t.y+25};case bt.Up:return{...t,y:t.y-25}}};class mh{constructor(e){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=e;const{event:{target:t}}=e;this.props=e,this.listeners=new Oi(As(t)),this.windowListeners=new Oi(En(t)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Jn.Resize,this.handleCancel),this.windowListeners.add(Jn.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Jn.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:e,onStart:t}=this.props,n=e.node.current;n&&uS(n),t(ar)}handleKeyDown(e){if(hc(e)){const{active:t,context:n,options:r}=this.props,{keyboardCodes:o=dS,coordinateGetter:i=ME,scrollBehavior:l="smooth"}=r,{code:a}=e;if(o.end.includes(a))return void this.handleEnd(e);if(o.cancel.includes(a))return void this.handleCancel(e);const{collisionRect:c}=n.current,u=c?{x:c.left,y:c.top}:ar;this.referenceCoordinates||(this.referenceCoordinates=u);const d=i(e,{active:t,context:n.current,currentCoordinates:u});if(d){const h=qi(d,u),f={x:0,y:0},{scrollableAncestors:g}=n.current;for(const m of g){const p=e.code,{isTop:w,isRight:S,isLeft:b,isBottom:v,maxScroll:y,minScroll:_}=aS(m),C=RE(m),E={x:Math.min(p===bt.Right?C.right-C.width/2:C.right,Math.max(p===bt.Right?C.left:C.left+C.width/2,d.x)),y:Math.min(p===bt.Down?C.bottom-C.height/2:C.bottom,Math.max(p===bt.Down?C.top:C.top+C.height/2,d.y))},x=p===bt.Right&&!S||p===bt.Left&&!b,R=p===bt.Down&&!v||p===bt.Up&&!w;if(x&&E.x!==d.x){const I=m.scrollLeft+h.x,A=p===bt.Right&&I<=y.x||p===bt.Left&&I>=_.x;if(A&&!h.y)return void m.scrollTo({left:I,behavior:l});f.x=A?m.scrollLeft-I:p===bt.Right?m.scrollLeft-y.x:m.scrollLeft-_.x,f.x&&m.scrollBy({left:-f.x,behavior:l});break}if(R&&E.y!==d.y){const I=m.scrollTop+h.y,A=p===bt.Down&&I<=y.y||p===bt.Up&&I>=_.y;if(A&&!h.x)return void m.scrollTo({top:I,behavior:l});f.y=A?m.scrollTop-I:p===bt.Down?m.scrollTop-y.y:m.scrollTop-_.y,f.y&&m.scrollBy({top:-f.y,behavior:l});break}}this.handleMove(e,hs(qi(d,this.referenceCoordinates),f))}}}handleMove(e,t){const{onMove:n}=this.props;e.preventDefault(),n(t)}handleEnd(e){const{onEnd:t}=this.props;e.preventDefault(),this.detach(),t()}handleCancel(e){const{onCancel:t}=this.props;e.preventDefault(),this.detach(),t()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}function gp(s){return!!(s&&"distance"in s)}function fp(s){return!!(s&&"delay"in s)}mh.activators=[{eventName:"onKeyDown",handler:(s,e,t)=>{let{keyboardCodes:n=dS,onActivation:r}=e,{active:o}=t;const{code:i}=s.nativeEvent;if(n.start.includes(i)){const l=o.activatorNode.current;return(!l||s.target===l)&&(s.preventDefault(),r?.({event:s.nativeEvent}),!0)}return!1}}];class ph{constructor(e,t,n){var r;n===void 0&&(n=function(l){const{EventTarget:a}=En(l);return l instanceof a?l:As(l)}(e.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=e,this.events=t;const{event:o}=e,{target:i}=o;this.props=e,this.events=t,this.document=As(i),this.documentListeners=new Oi(this.document),this.listeners=new Oi(n),this.windowListeners=new Oi(En(i)),this.initialCoordinates=(r=Ja(o))!=null?r:ar,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:e,props:{options:{activationConstraint:t,bypassActivationConstraint:n}}}=this;if(this.listeners.add(e.move.name,this.handleMove,{passive:!1}),this.listeners.add(e.end.name,this.handleEnd),e.cancel&&this.listeners.add(e.cancel.name,this.handleCancel),this.windowListeners.add(Jn.Resize,this.handleCancel),this.windowListeners.add(Jn.DragStart,hp),this.windowListeners.add(Jn.VisibilityChange,this.handleCancel),this.windowListeners.add(Jn.ContextMenu,hp),this.documentListeners.add(Jn.Keydown,this.handleKeydown),t){if(n!=null&&n({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(fp(t))return this.timeoutId=setTimeout(this.handleStart,t.delay),void this.handlePending(t);if(gp(t))return void this.handlePending(t)}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(e,t){const{active:n,onPending:r}=this.props;r(n,e,this.initialCoordinates,t)}handleStart(){const{initialCoordinates:e}=this,{onStart:t}=this.props;e&&(this.activated=!0,this.documentListeners.add(Jn.Click,AE,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Jn.SelectionChange,this.removeTextSelection),t(e))}handleMove(e){var t;const{activated:n,initialCoordinates:r,props:o}=this,{onMove:i,options:{activationConstraint:l}}=o;if(!r)return;const a=(t=Ja(e))!=null?t:ar,c=qi(r,a);if(!n&&l){if(gp(l)){if(l.tolerance!=null&&Gu(c,l.tolerance))return this.handleCancel();if(Gu(c,l.distance))return this.handleStart()}return fp(l)&&Gu(c,l.tolerance)?this.handleCancel():void this.handlePending(l,c)}e.cancelable&&e.preventDefault(),i(a)}handleEnd(){const{onAbort:e,onEnd:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleCancel(){const{onAbort:e,onCancel:t}=this.props;this.detach(),this.activated||e(this.props.active),t()}handleKeydown(e){e.code===bt.Esc&&this.handleCancel()}removeTextSelection(){var e;(e=this.document.getSelection())==null||e.removeAllRanges()}}const TE={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class hS extends ph{constructor(e){const{event:t}=e,n=As(t.target);super(e,TE,n)}}hS.activators=[{eventName:"onPointerDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:n}=e;return!(!t.isPrimary||t.button!==0)&&(n?.({event:t}),!0)}}];const kE={move:{name:"mousemove"},end:{name:"mouseup"}};var zd;(function(s){s[s.RightClick=2]="RightClick"})(zd||(zd={}));class gS extends ph{constructor(e){super(e,kE,As(e.event.target))}}gS.activators=[{eventName:"onMouseDown",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:n}=e;return t.button!==zd.RightClick&&(n?.({event:t}),!0)}}];const Uu={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class fS extends ph{constructor(e){super(e,Uu)}static setup(){return window.addEventListener(Uu.move.name,e,{capture:!1,passive:!1}),function(){window.removeEventListener(Uu.move.name,e)};function e(){}}}var Di,Xa;function NE(s){let{acceleration:e,activator:t=Di.Pointer,canScroll:n,draggingRect:r,enabled:o,interval:i=5,order:l=Xa.TreeOrder,pointerCoordinates:a,scrollableAncestors:c,scrollableAncestorRects:u,delta:d,threshold:h}=s;const f=function(_){let{delta:C,disabled:E}=_;const x=qa(C);return Fi(R=>{if(E||!x||!R)return FE;const I={x:Math.sign(C.x-x.x),y:Math.sign(C.y-x.y)};return{x:{[cn.Backward]:R.x[cn.Backward]||I.x===-1,[cn.Forward]:R.x[cn.Forward]||I.x===1},y:{[cn.Backward]:R.y[cn.Backward]||I.y===-1,[cn.Forward]:R.y[cn.Forward]||I.y===1}}},[E,C,x])}({delta:d,disabled:!o}),[g,m]=function(){const _=T.useRef(null);return[T.useCallback((C,E)=>{_.current=setInterval(C,E)},[]),T.useCallback(()=>{_.current!==null&&(clearInterval(_.current),_.current=null)},[])]}(),p=T.useRef({x:0,y:0}),w=T.useRef({x:0,y:0}),S=T.useMemo(()=>{switch(t){case Di.Pointer:return a?{top:a.y,bottom:a.y,left:a.x,right:a.x}:null;case Di.DraggableRect:return r}},[t,r,a]),b=T.useRef(null),v=T.useCallback(()=>{const _=b.current;if(!_)return;const C=p.current.x*w.current.x,E=p.current.y*w.current.y;_.scrollBy(C,E)},[]),y=T.useMemo(()=>l===Xa.TreeOrder?[...c].reverse():c,[l,c]);T.useEffect(()=>{if(o&&c.length&&S){for(const _ of y){if(n?.(_)===!1)continue;const C=c.indexOf(_),E=u[C];if(!E)continue;const{direction:x,speed:R}=EE(_,E,S,e,h);for(const I of["x","y"])f[I][x[I]]||(R[I]=0,x[I]=0);if(R.x>0||R.y>0)return m(),b.current=_,g(v,i),p.current=R,void(w.current=x)}p.current={x:0,y:0},w.current={x:0,y:0},m()}else m()},[e,v,n,m,o,i,JSON.stringify(S),JSON.stringify(f),g,c,y,u,JSON.stringify(h)])}fS.activators=[{eventName:"onTouchStart",handler:(s,e)=>{let{nativeEvent:t}=s,{onActivation:n}=e;const{touches:r}=t;return!(r.length>1)&&(n?.({event:t}),!0)}}],function(s){s[s.Pointer=0]="Pointer",s[s.DraggableRect=1]="DraggableRect"}(Di||(Di={})),function(s){s[s.TreeOrder=0]="TreeOrder",s[s.ReversedTreeOrder=1]="ReversedTreeOrder"}(Xa||(Xa={}));const FE={x:{[cn.Backward]:!1,[cn.Forward]:!1},y:{[cn.Backward]:!1,[cn.Forward]:!1}};var Ji,Pd;(function(s){s[s.Always=0]="Always",s[s.BeforeDragging=1]="BeforeDragging",s[s.WhileDragging=2]="WhileDragging"})(Ji||(Ji={})),function(s){s.Optimized="optimized"}(Pd||(Pd={}));const mp=new Map;function Hd(s,e){return Fi(t=>s?t||(typeof e=="function"?e(s):s):null,[e,s])}function Za(s){let{callback:e,disabled:t}=s;const n=dc(e),r=T.useMemo(()=>{if(t||typeof window>"u"||window.ResizeObserver===void 0)return;const{ResizeObserver:o}=window;return new o(n)},[t]);return T.useEffect(()=>()=>r?.disconnect(),[r]),r}function OE(s){return new Bd(Fs(s),s)}function pp(s,e,t){e===void 0&&(e=OE);const[n,r]=T.useState(null);function o(){r(a=>{if(!s)return null;var c;if(s.isConnected===!1)return(c=a??t)!=null?c:null;const u=e(s);return JSON.stringify(a)===JSON.stringify(u)?a:u})}const i=function(a){let{callback:c,disabled:u}=a;const d=dc(c),h=T.useMemo(()=>{if(u||typeof window>"u"||window.MutationObserver===void 0)return;const{MutationObserver:f}=window;return new f(d)},[d,u]);return T.useEffect(()=>()=>h?.disconnect(),[h]),h}({callback(a){if(s)for(const c of a){const{type:u,target:d}=c;if(u==="childList"&&d instanceof HTMLElement&&d.contains(s)){o();break}}}}),l=Za({callback:o});return or(()=>{o(),s?(l?.observe(s),i?.observe(document.body,{childList:!0,subtree:!0})):(l?.disconnect(),i?.disconnect())},[s]),n}const wp=[];function Sp(s,e){e===void 0&&(e=[]);const t=T.useRef(null);return T.useEffect(()=>{t.current=null},e),T.useEffect(()=>{const n=s!==ar;n&&!t.current&&(t.current=s),!n&&t.current&&(t.current=null)},[s]),t.current?qi(s,t.current):ar}function _p(s){return T.useMemo(()=>s?function(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}(s):null,[s])}const yp=[];function mS(s){if(!s)return null;if(s.children.length>1)return s;const e=s.children[0];return nl(e)?e:s}const DE=[{sensor:hS,options:{}},{sensor:mh,options:{}}],LE={current:{}},Ra={draggable:{measure:dp},droppable:{measure:dp,strategy:Ji.WhileDragging,frequency:Pd.Optimized},dragOverlay:{measure:Fs}};class Li extends Map{get(e){var t;return e!=null&&(t=super.get(e))!=null?t:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(e=>{let{disabled:t}=e;return!t})}getNodeFor(e){var t,n;return(t=(n=this.get(e))==null?void 0:n.node.current)!=null?t:void 0}}const BE={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new Li,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Ka},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Ra,measureDroppableContainers:Ka,windowRect:null,measuringScheduled:!1},pS={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Ka,draggableNodes:new Map,over:null,measureDroppableContainers:Ka},ol=T.createContext(pS),wS=T.createContext(BE);function zE(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new Li}}}function PE(s,e){switch(e.type){case nn.DragStart:return{...s,draggable:{...s.draggable,initialCoordinates:e.initialCoordinates,active:e.active}};case nn.DragMove:return s.draggable.active==null?s:{...s,draggable:{...s.draggable,translate:{x:e.coordinates.x-s.draggable.initialCoordinates.x,y:e.coordinates.y-s.draggable.initialCoordinates.y}}};case nn.DragEnd:case nn.DragCancel:return{...s,draggable:{...s.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case nn.RegisterDroppable:{const{element:t}=e,{id:n}=t,r=new Li(s.droppable.containers);return r.set(n,t),{...s,droppable:{...s.droppable,containers:r}}}case nn.SetDroppableDisabled:{const{id:t,key:n,disabled:r}=e,o=s.droppable.containers.get(t);if(!o||n!==o.key)return s;const i=new Li(s.droppable.containers);return i.set(t,{...o,disabled:r}),{...s,droppable:{...s.droppable,containers:i}}}case nn.UnregisterDroppable:{const{id:t,key:n}=e,r=s.droppable.containers.get(t);if(!r||n!==r.key)return s;const o=new Li(s.droppable.containers);return o.delete(t),{...s,droppable:{...s.droppable,containers:o}}}default:return s}}function HE(s){let{disabled:e}=s;const{active:t,activatorEvent:n,draggableNodes:r}=T.useContext(ol),o=qa(n),i=qa(t?.id);return T.useEffect(()=>{if(!e&&!n&&o&&i!=null){if(!hc(o)||document.activeElement===o.target)return;const l=r.get(i);if(!l)return;const{activatorNode:a,node:c}=l;if(!a.current&&!c.current)return;requestAnimationFrame(()=>{for(const u of[a.current,c.current]){if(!u)continue;const d=cE(u);if(d){d.focus();break}}})}},[n,e,r,i,o]),null}function SS(s,e){let{transform:t,...n}=e;return s!=null&&s.length?s.reduce((r,o)=>o({transform:r,...n}),t):t}const fc=T.createContext({...ar,scaleX:1,scaleY:1});var to;(function(s){s[s.Uninitialized=0]="Uninitialized",s[s.Initializing=1]="Initializing",s[s.Initialized=2]="Initialized"})(to||(to={}));const $E=T.memo(function(s){var e,t,n,r;let{id:o,accessibility:i,autoScroll:l=!0,children:a,sensors:c=DE,collisionDetection:u=yE,measuring:d,modifiers:h,...f}=s;const g=T.useReducer(PE,void 0,zE),[m,p]=g,[w,S]=function(){const[X]=T.useState(()=>new Set),ue=T.useCallback(_e=>(X.add(_e),()=>X.delete(_e)),[X]);return[T.useCallback(_e=>{let{type:Re,event:Ne}=_e;X.forEach(Oe=>{var Be;return(Be=Oe[Re])==null?void 0:Be.call(Oe,Ne)})},[X]),ue]}(),[b,v]=T.useState(to.Uninitialized),y=b===to.Initialized,{draggable:{active:_,nodes:C,translate:E},droppable:{containers:x}}=m,R=_!=null?C.get(_):null,I=T.useRef({initial:null,translated:null}),A=T.useMemo(()=>{var X;return _!=null?{id:_,data:(X=R?.data)!=null?X:LE,rect:I}:null},[_,R]),M=T.useRef(null),[k,F]=T.useState(null),[L,N]=T.useState(null),D=Ui(f,Object.values(f)),O=rl("DndDescribedBy",o),H=T.useMemo(()=>x.getEnabled(),[x]),z=T.useMemo(()=>({draggable:{...Ra.draggable,...j?.draggable},droppable:{...Ra.droppable,...j?.droppable},dragOverlay:{...Ra.dragOverlay,...j?.dragOverlay}}),[(j=d)==null?void 0:j.draggable,j?.droppable,j?.dragOverlay]);var j;const{droppableRects:q,measureDroppableContainers:P,measuringScheduled:U}=function(X,ue){let{dragging:_e,dependencies:Re,config:Ne}=ue;const[Oe,Be]=T.useState(null),{frequency:Ue,measure:$e,strategy:Ve}=Ne,Je=T.useRef(X),rt=function(){switch(Ve){case Ji.Always:return!1;case Ji.BeforeDragging:return _e;default:return!_e}}(),et=Ui(rt),at=T.useCallback(function(tt){tt===void 0&&(tt=[]),et.current||Be(yt=>yt===null?tt:yt.concat(tt.filter(Xt=>!yt.includes(Xt))))},[et]),nt=T.useRef(null),ht=Fi(tt=>{if(rt&&!_e)return mp;if(!tt||tt===mp||Je.current!==X||Oe!=null){const yt=new Map;for(let Xt of X){if(!Xt)continue;if(Oe&&Oe.length>0&&!Oe.includes(Xt.id)&&Xt.rect.current){yt.set(Xt.id,Xt.rect.current);continue}const Rn=Xt.node.current,$n=Rn?new Bd($e(Rn),Rn):null;Xt.rect.current=$n,$n&&yt.set(Xt.id,$n)}return yt}return tt},[X,Oe,_e,rt,$e]);return T.useEffect(()=>{Je.current=X},[X]),T.useEffect(()=>{rt||at()},[_e,rt]),T.useEffect(()=>{Oe&&Oe.length>0&&Be(null)},[JSON.stringify(Oe)]),T.useEffect(()=>{rt||typeof Ue!="number"||nt.current!==null||(nt.current=setTimeout(()=>{at(),nt.current=null},Ue))},[Ue,rt,at,...Re]),{droppableRects:ht,measureDroppableContainers:at,measuringScheduled:Oe!=null}}(H,{dragging:y,dependencies:[E.x,E.y],config:z.droppable}),ne=function(X,ue){const _e=ue!=null?X.get(ue):void 0,Re=_e?_e.node.current:null;return Fi(Ne=>{var Oe;return ue==null?null:(Oe=Re??Ne)!=null?Oe:null},[Re,ue])}(C,_),ee=T.useMemo(()=>L?Ja(L):null,[L]),ve=function(){const X=k?.autoScrollEnabled===!1,ue=typeof l=="object"?l.enabled===!1:l===!1,_e=y&&!X&&!ue;return typeof l=="object"?{...l,enabled:_e}:{enabled:_e}}(),le=function(X,ue){return Hd(X,ue)}(ne,z.draggable.measure);(function(X){let{activeNode:ue,measure:_e,initialRect:Re,config:Ne=!0}=X;const Oe=T.useRef(!1),{x:Be,y:Ue}=typeof Ne=="boolean"?{x:Ne,y:Ne}:Ne;or(()=>{if(!Be&&!Ue||!ue)return void(Oe.current=!1);if(Oe.current||!Re)return;const $e=ue?.node.current;if(!$e||$e.isConnected===!1)return;const Ve=up(_e($e),Re);if(Be||(Ve.x=0),Ue||(Ve.y=0),Oe.current=!0,Math.abs(Ve.x)>0||Math.abs(Ve.y)>0){const Je=oS($e);Je&&Je.scrollBy({top:Ve.y,left:Ve.x})}},[ue,Be,Ue,Re,_e])})({activeNode:_!=null?C.get(_):null,config:ve.layoutShiftCompensation,initialRect:le,measure:z.draggable.measure});const Ce=pp(ne,z.draggable.measure,le),re=pp(ne?ne.parentElement:null),ae=T.useRef({activatorEvent:null,active:null,activeNode:ne,collisionRect:null,collisions:null,droppableRects:q,draggableNodes:C,draggingNode:null,draggingNodeRect:null,droppableContainers:x,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),fe=x.getNodeFor((e=ae.current.over)==null?void 0:e.id),ye=function(X){let{measure:ue}=X;const[_e,Re]=T.useState(null),Ne=Za({callback:T.useCallback($e=>{for(const{target:Ve}of $e)if(nl(Ve)){Re(Je=>{const rt=ue(Ve);return Je?{...Je,width:rt.width,height:rt.height}:rt});break}},[ue])}),Oe=T.useCallback($e=>{const Ve=mS($e);Ne?.disconnect(),Ve&&Ne?.observe(Ve),Re(Ve?ue(Ve):null)},[ue,Ne]),[Be,Ue]=Ua(Oe);return T.useMemo(()=>({nodeRef:Be,rect:_e,setRef:Ue}),[_e,Be,Ue])}({measure:z.dragOverlay.measure}),he=(t=ye.nodeRef.current)!=null?t:ne,we=y?(n=ye.rect)!=null?n:Ce:null,be=!!(ye.nodeRef.current&&ye.rect),me=up(de=be?null:Ce,Hd(de));var de;const xe=_p(he?En(he):null),Le=function(X){const ue=T.useRef(X),_e=Fi(Re=>X?Re&&Re!==wp&&X&&ue.current&&X.parentNode===ue.current.parentNode?Re:gc(X):wp,[X]);return T.useEffect(()=>{ue.current=X},[X]),_e}(y?fe??ne:null),W=function(X,ue){ue===void 0&&(ue=Fs);const[_e]=X,Re=_p(_e?En(_e):null),[Ne,Oe]=T.useState(yp);function Be(){Oe(()=>X.length?X.map($e=>lS($e)?Re:new Bd(ue($e),$e)):yp)}const Ue=Za({callback:Be});return or(()=>{Ue?.disconnect(),Be(),X.forEach($e=>Ue?.observe($e))},[X]),Ne}(Le),Ze=SS(h,{transform:{x:E.x-me.x,y:E.y-me.y,scaleX:1,scaleY:1},activatorEvent:L,active:A,activeNodeRect:Ce,containerNodeRect:re,draggingNodeRect:we,over:ae.current.over,overlayNodeRect:ye.rect,scrollableAncestors:Le,scrollableAncestorRects:W,windowRect:xe}),Xe=ee?hs(ee,E):null,Ge=function(X){const[ue,_e]=T.useState(null),Re=T.useRef(X),Ne=T.useCallback(Oe=>{const Be=ju(Oe.target);Be&&_e(Ue=>Ue?(Ue.set(Be,Ld(Be)),new Map(Ue)):null)},[]);return T.useEffect(()=>{const Oe=Re.current;if(X!==Oe){Be(Oe);const Ue=X.map($e=>{const Ve=ju($e);return Ve?(Ve.addEventListener("scroll",Ne,{passive:!0}),[Ve,Ld(Ve)]):null}).filter($e=>$e!=null);_e(Ue.length?new Map(Ue):null),Re.current=X}return()=>{Be(X),Be(Oe)};function Be(Ue){Ue.forEach($e=>{ju($e)?.removeEventListener("scroll",Ne)})}},[Ne,X]),T.useMemo(()=>X.length?ue?Array.from(ue.values()).reduce((Oe,Be)=>hs(Oe,Be),ar):cS(X):ar,[X,ue])}(Le),ce=Sp(Ge),We=Sp(Ge,[Ce]),qe=hs(Ze,ce),De=we?vE(we,Ze):null,Te=A&&De?u({active:A,collisionRect:De,droppableRects:q,droppableContainers:H,pointerCoordinates:Xe}):null,ze=nS(Te,"id"),[Z,Se]=T.useState(null),te=function(X,ue,_e){return{...X,scaleX:ue&&_e?ue.width/_e.width:1,scaleY:ue&&_e?ue.height/_e.height:1}}(be?Ze:hs(Ze,We),(r=Z?.rect)!=null?r:null,Ce),ie=T.useRef(null),$=T.useCallback((X,ue)=>{let{sensor:_e,options:Re}=ue;if(M.current==null)return;const Ne=C.get(M.current);if(!Ne)return;const Oe=X.nativeEvent,Be=new _e({active:M.current,activeNode:Ne,event:Oe,options:Re,context:ae,onAbort($e){if(!C.get($e))return;const{onDragAbort:Ve}=D.current,Je={id:$e};Ve?.(Je),w({type:"onDragAbort",event:Je})},onPending($e,Ve,Je,rt){if(!C.get($e))return;const{onDragPending:et}=D.current,at={id:$e,constraint:Ve,initialCoordinates:Je,offset:rt};et?.(at),w({type:"onDragPending",event:at})},onStart($e){const Ve=M.current;if(Ve==null)return;const Je=C.get(Ve);if(!Je)return;const{onDragStart:rt}=D.current,et={activatorEvent:Oe,active:{id:Ve,data:Je.data,rect:I}};Eo.unstable_batchedUpdates(()=>{rt?.(et),v(to.Initializing),p({type:nn.DragStart,initialCoordinates:$e,active:Ve}),w({type:"onDragStart",event:et}),F(ie.current),N(Oe)})},onMove($e){p({type:nn.DragMove,coordinates:$e})},onEnd:Ue(nn.DragEnd),onCancel:Ue(nn.DragCancel)});function Ue($e){return async function(){const{active:Ve,collisions:Je,over:rt,scrollAdjustedTranslate:et}=ae.current;let at=null;if(Ve&&et){const{cancelDrop:nt}=D.current;at={activatorEvent:Oe,active:Ve,collisions:Je,delta:et,over:rt},$e===nn.DragEnd&&typeof nt=="function"&&await Promise.resolve(nt(at))&&($e=nn.DragCancel)}M.current=null,Eo.unstable_batchedUpdates(()=>{p({type:$e}),v(to.Uninitialized),Se(null),F(null),N(null),ie.current=null;const nt=$e===nn.DragEnd?"onDragEnd":"onDragCancel";if(at){const ht=D.current[nt];ht?.(at),w({type:nt,event:at})}})}}ie.current=Be},[C]),Y=T.useCallback((X,ue)=>(_e,Re)=>{const Ne=_e.nativeEvent,Oe=C.get(Re);if(M.current!==null||!Oe||Ne.dndKit||Ne.defaultPrevented)return;const Be={active:Oe};X(_e,ue.options,Be)===!0&&(Ne.dndKit={capturedBy:ue.sensor},M.current=Re,$(_e,ue))},[C,$]),Q=function(X,ue){return T.useMemo(()=>X.reduce((_e,Re)=>{const{sensor:Ne}=Re;return[..._e,...Ne.activators.map(Oe=>({eventName:Oe.eventName,handler:ue(Oe.handler,Re)}))]},[]),[X,ue])}(c,Y);(function(X){T.useEffect(()=>{if(!uc)return;const ue=X.map(_e=>{let{sensor:Re}=_e;return Re.setup==null?void 0:Re.setup()});return()=>{for(const _e of ue)_e?.()}},X.map(ue=>{let{sensor:_e}=ue;return _e}))})(c),or(()=>{Ce&&b===to.Initializing&&v(to.Initialized)},[Ce,b]),T.useEffect(()=>{const{onDragMove:X}=D.current,{active:ue,activatorEvent:_e,collisions:Re,over:Ne}=ae.current;if(!ue||!_e)return;const Oe={active:ue,activatorEvent:_e,collisions:Re,delta:{x:qe.x,y:qe.y},over:Ne};Eo.unstable_batchedUpdates(()=>{X?.(Oe),w({type:"onDragMove",event:Oe})})},[qe.x,qe.y]),T.useEffect(()=>{const{active:X,activatorEvent:ue,collisions:_e,droppableContainers:Re,scrollAdjustedTranslate:Ne}=ae.current;if(!X||M.current==null||!ue||!Ne)return;const{onDragOver:Oe}=D.current,Be=Re.get(ze),Ue=Be&&Be.rect.current?{id:Be.id,rect:Be.rect.current,data:Be.data,disabled:Be.disabled}:null,$e={active:X,activatorEvent:ue,collisions:_e,delta:{x:Ne.x,y:Ne.y},over:Ue};Eo.unstable_batchedUpdates(()=>{Se(Ue),Oe?.($e),w({type:"onDragOver",event:$e})})},[ze]),or(()=>{ae.current={activatorEvent:L,active:A,activeNode:ne,collisionRect:De,collisions:Te,droppableRects:q,draggableNodes:C,draggingNode:he,draggingNodeRect:we,droppableContainers:x,over:Z,scrollableAncestors:Le,scrollAdjustedTranslate:qe},I.current={initial:we,translated:De}},[A,ne,Te,De,C,he,we,q,x,Z,Le,qe]),NE({...ve,delta:E,draggingRect:De,pointerCoordinates:Xe,scrollableAncestors:Le,scrollableAncestorRects:W});const K=T.useMemo(()=>({active:A,activeNode:ne,activeNodeRect:Ce,activatorEvent:L,collisions:Te,containerNodeRect:re,dragOverlay:ye,draggableNodes:C,droppableContainers:x,droppableRects:q,over:Z,measureDroppableContainers:P,scrollableAncestors:Le,scrollableAncestorRects:W,measuringConfiguration:z,measuringScheduled:U,windowRect:xe}),[A,ne,Ce,L,Te,re,ye,C,x,q,Z,P,Le,W,z,U,xe]),se=T.useMemo(()=>({activatorEvent:L,activators:Q,active:A,activeNodeRect:Ce,ariaDescribedById:{draggable:O},dispatch:p,draggableNodes:C,over:Z,measureDroppableContainers:P}),[L,Q,A,Ce,p,O,C,Z,P]);return ut.createElement(Qw.Provider,{value:S},ut.createElement(ol.Provider,{value:se},ut.createElement(wS.Provider,{value:K},ut.createElement(fc.Provider,{value:te},a)),ut.createElement(HE,{disabled:i?.restoreFocus===!1})),ut.createElement(mE,{...i,hiddenTextDescribedById:O}))}),VE=T.createContext(null),bp="button";function WE(s){let{id:e,data:t,disabled:n=!1,attributes:r}=s;const o=rl("Draggable"),{activators:i,activatorEvent:l,active:a,activeNodeRect:c,ariaDescribedById:u,draggableNodes:d,over:h}=T.useContext(ol),{role:f=bp,roleDescription:g="draggable",tabIndex:m=0}=r??{},p=a?.id===e,w=T.useContext(p?fc:VE),[S,b]=Ua(),[v,y]=Ua(),_=function(E,x){return T.useMemo(()=>E.reduce((R,I)=>{let{eventName:A,handler:M}=I;return R[A]=k=>{M(k,x)},R},{}),[E,x])}(i,e),C=Ui(t);return or(()=>(d.set(e,{id:e,key:o,node:S,activatorNode:v,data:C}),()=>{const E=d.get(e);E&&E.key===o&&d.delete(e)}),[d,e]),{active:a,activatorEvent:l,activeNodeRect:c,attributes:T.useMemo(()=>({role:f,tabIndex:m,"aria-disabled":n,"aria-pressed":!(!p||f!==bp)||void 0,"aria-roledescription":g,"aria-describedby":u.draggable}),[n,f,m,p,g,u.draggable]),isDragging:p,listeners:n?void 0:_,node:S,over:h,setNodeRef:b,setActivatorNodeRef:y,transform:w}}function _S(){return T.useContext(wS)}const jE={timeout:25};function GE(s){let{animation:e,children:t}=s;const[n,r]=T.useState(null),[o,i]=T.useState(null),l=qa(t);return t||n||!l||r(l),or(()=>{if(!o)return;const a=n?.key,c=n?.props.id;a!=null&&c!=null?Promise.resolve(e(c,o)).then(()=>{r(null)}):r(null)},[e,n,o]),ut.createElement(ut.Fragment,null,t,n?T.cloneElement(n,{ref:i}):null)}const UE={x:0,y:0,scaleX:1,scaleY:1};function qE(s){let{children:e}=s;return ut.createElement(ol.Provider,{value:pS},ut.createElement(fc.Provider,{value:UE},e))}const JE={position:"fixed",touchAction:"none"},KE=s=>hc(s)?"transform 250ms ease":void 0,XE=T.forwardRef((s,e)=>{let{as:t,activatorEvent:n,adjustScale:r,children:o,className:i,rect:l,style:a,transform:c,transition:u=KE}=s;if(!l)return null;const d=r?c:{...c,scaleX:1,scaleY:1},h={...JE,width:l.width,height:l.height,top:l.top,left:l.left,transform:No.Transform.toString(d),transformOrigin:r&&n?pE(n,l):void 0,transition:typeof u=="function"?u(n):u,...a};return ut.createElement(t,{className:i,style:h,ref:e},o)}),ZE=s=>e=>{let{active:t,dragOverlay:n}=e;const r={},{styles:o,className:i}=s;if(o!=null&&o.active)for(const[l,a]of Object.entries(o.active))a!==void 0&&(r[l]=t.node.style.getPropertyValue(l),t.node.style.setProperty(l,a));if(o!=null&&o.dragOverlay)for(const[l,a]of Object.entries(o.dragOverlay))a!==void 0&&n.node.style.setProperty(l,a);return i!=null&&i.active&&t.node.classList.add(i.active),i!=null&&i.dragOverlay&&n.node.classList.add(i.dragOverlay),function(){for(const[l,a]of Object.entries(r))t.node.style.setProperty(l,a);i!=null&&i.active&&t.node.classList.remove(i.active)}},yS={duration:250,easing:"ease",keyframes:s=>{let{transform:{initial:e,final:t}}=s;return[{transform:No.Transform.toString(e)},{transform:No.Transform.toString(t)}]},sideEffects:ZE({styles:{active:{opacity:"0"}}})};function YE(s){let{config:e,draggableNodes:t,droppableContainers:n,measuringConfiguration:r}=s;return dc((o,i)=>{if(e===null)return;const l=t.get(o);if(!l)return;const a=l.node.current;if(!a)return;const c=mS(i);if(!c)return;const{transform:u}=En(i).getComputedStyle(i),d=rS(u);if(!d)return;const h=typeof e=="function"?e:function(f){const{duration:g,easing:m,sideEffects:p,keyframes:w}={...yS,...f};return S=>{let{active:b,dragOverlay:v,transform:y,..._}=S;if(!g)return;const C={x:v.rect.left-b.rect.left,y:v.rect.top-b.rect.top},E={scaleX:y.scaleX!==1?b.rect.width*y.scaleX/v.rect.width:1,scaleY:y.scaleY!==1?b.rect.height*y.scaleY/v.rect.height:1},x={x:y.x-C.x,y:y.y-C.y,...E},R=w({..._,active:b,dragOverlay:v,transform:{initial:y,final:x}}),[I]=R,A=R[R.length-1];if(JSON.stringify(I)===JSON.stringify(A))return;const M=p?.({active:b,dragOverlay:v,..._}),k=v.node.animate(R,{duration:g,easing:m,fill:"forwards"});return new Promise(F=>{k.onfinish=()=>{M?.(),F()}})}}(e);return uS(a,r.draggable.measure),h({active:{id:o,data:l.data,node:a,rect:r.draggable.measure(a)},draggableNodes:t,dragOverlay:{node:i,rect:r.dragOverlay.measure(c)},droppableContainers:n,measuringConfiguration:r,transform:d})})}let vp=0;function QE(s){return T.useMemo(()=>{if(s!=null)return vp++,vp},[s])}const eR=ut.memo(s=>{let{adjustScale:e=!1,children:t,dropAnimation:n,style:r,transition:o,modifiers:i,wrapperElement:l="div",className:a,zIndex:c=999}=s;const{activatorEvent:u,active:d,activeNodeRect:h,containerNodeRect:f,draggableNodes:g,droppableContainers:m,dragOverlay:p,over:w,measuringConfiguration:S,scrollableAncestors:b,scrollableAncestorRects:v,windowRect:y}=_S(),_=T.useContext(fc),C=QE(d?.id),E=SS(i,{activatorEvent:u,active:d,activeNodeRect:h,containerNodeRect:f,draggingNodeRect:p.rect,over:w,overlayNodeRect:p.rect,scrollableAncestors:b,scrollableAncestorRects:v,transform:_,windowRect:y}),x=Hd(h),R=YE({config:n,draggableNodes:g,droppableContainers:m,measuringConfiguration:S}),I=x?p.setRef:void 0;return ut.createElement(qE,null,ut.createElement(GE,{animation:R},d&&C?ut.createElement(XE,{key:C,id:d.id,ref:I,as:l,activatorEvent:u,adjustScale:e,className:a,transition:o,rect:x,style:{zIndex:c,...r},transform:E},t):null))});function wh(s,e,t){const n=s.slice();return n.splice(t<0?n.length+t:t,0,n.splice(e,1)[0]),n}function tR(s,e){return s.reduce((t,n,r)=>{const o=e.get(n);return o&&(t[r]=o),t},Array(s.length))}function Gl(s){return s!==null&&s>=0}const Ul={scaleX:1,scaleY:1},nR=s=>{var e;let{rects:t,activeNodeRect:n,activeIndex:r,overIndex:o,index:i}=s;const l=(e=t[r])!=null?e:n;if(!l)return null;const a=function(c,u,d){const h=c[u],f=c[u-1],g=c[u+1];return!h||!f&&!g?0:d<u?f?h.left-(f.left+f.width):g.left-(h.left+h.width):g?g.left-(h.left+h.width):h.left-(f.left+f.width)}(t,i,r);if(i===r){const c=t[o];return c?{x:r<o?c.left+c.width-(l.left+l.width):c.left-l.left,y:0,...Ul}:null}return i>r&&i<=o?{x:-l.width-a,y:0,...Ul}:i<r&&i>=o?{x:l.width+a,y:0,...Ul}:{x:0,y:0,...Ul}},Sh=s=>{let{rects:e,activeIndex:t,overIndex:n,index:r}=s;const o=wh(e,n,t),i=e[r],l=o[r];return l&&i?{x:l.left-i.left,y:l.top-i.top,scaleX:l.width/i.width,scaleY:l.height/i.height}:null},bS="Sortable",vS=ut.createContext({activeIndex:-1,containerId:bS,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Sh,disabled:{draggable:!1,droppable:!1}});function rR(s){let{children:e,id:t,items:n,strategy:r=Sh,disabled:o=!1}=s;const{active:i,dragOverlay:l,droppableRects:a,over:c,measureDroppableContainers:u}=_S(),d=rl(bS,t),h=l.rect!==null,f=T.useMemo(()=>n.map(_=>typeof _=="object"&&"id"in _?_.id:_),[n]),g=i!=null,m=i?f.indexOf(i.id):-1,p=c?f.indexOf(c.id):-1,w=T.useRef(f),S=!function(_,C){if(_===C)return!0;if(_.length!==C.length)return!1;for(let E=0;E<_.length;E++)if(_[E]!==C[E])return!1;return!0}(f,w.current),b=p!==-1&&m===-1||S,v=function(_){return typeof _=="boolean"?{draggable:_,droppable:_}:_}(o);or(()=>{S&&g&&u(f)},[S,f,g,u]),T.useEffect(()=>{w.current=f},[f]);const y=T.useMemo(()=>({activeIndex:m,containerId:d,disabled:v,disableTransforms:b,items:f,overIndex:p,useDragOverlay:h,sortedRects:tR(f,a),strategy:r}),[m,d,v.draggable,v.droppable,b,f,p,a,h,r]);return ut.createElement(vS.Provider,{value:y},e)}const oR=s=>{let{id:e,items:t,activeIndex:n,overIndex:r}=s;return wh(t,n,r).indexOf(e)},sR=s=>{let{containerId:e,isSorting:t,wasDragging:n,index:r,items:o,newIndex:i,previousItems:l,previousContainerId:a,transition:c}=s;return!(!c||!n)&&(l===o||r!==i)&&(!!t||i!==r&&e===a)},iR={duration:200,easing:"ease"},CS="transform",lR=No.Transition.toString({property:CS,duration:0,easing:"linear"}),aR={roleDescription:"sortable"};function cR(s){let{animateLayoutChanges:e=sR,attributes:t,disabled:n,data:r,getNewIndex:o=oR,id:i,strategy:l,resizeObserverConfig:a,transition:c=iR}=s;const{items:u,containerId:d,activeIndex:h,disabled:f,disableTransforms:g,sortedRects:m,overIndex:p,useDragOverlay:w,strategy:S}=T.useContext(vS),b=function(fe,ye){var he,we;return typeof fe=="boolean"?{draggable:fe,droppable:!1}:{draggable:(he=fe?.draggable)!=null?he:ye.draggable,droppable:(we=fe?.droppable)!=null?we:ye.droppable}}(n,f),v=u.indexOf(i),y=T.useMemo(()=>({sortable:{containerId:d,index:v,items:u},...r}),[d,r,v,u]),_=T.useMemo(()=>u.slice(u.indexOf(i)),[u,i]),{rect:C,node:E,isOver:x,setNodeRef:R}=function(fe){let{data:ye,disabled:he=!1,id:we,resizeObserverConfig:be}=fe;const me=rl("Droppable"),{active:de,dispatch:xe,over:Le,measureDroppableContainers:W}=T.useContext(ol),Ze=T.useRef({disabled:he}),Xe=T.useRef(!1),Ge=T.useRef(null),ce=T.useRef(null),{disabled:We,updateMeasurementsFor:qe,timeout:De}={...jE,...be},Te=Ui(qe??we),ze=Za({callback:T.useCallback(()=>{Xe.current?(ce.current!=null&&clearTimeout(ce.current),ce.current=setTimeout(()=>{W(Array.isArray(Te.current)?Te.current:[Te.current]),ce.current=null},De)):Xe.current=!0},[De]),disabled:We||!de}),Z=T.useCallback(($,Y)=>{ze&&(Y&&(ze.unobserve(Y),Xe.current=!1),$&&ze.observe($))},[ze]),[Se,te]=Ua(Z),ie=Ui(ye);return T.useEffect(()=>{ze&&Se.current&&(ze.disconnect(),Xe.current=!1,ze.observe(Se.current))},[Se,ze]),T.useEffect(()=>(xe({type:nn.RegisterDroppable,element:{id:we,key:me,disabled:he,node:Se,rect:Ge,data:ie}}),()=>xe({type:nn.UnregisterDroppable,key:me,id:we})),[we]),T.useEffect(()=>{he!==Ze.current.disabled&&(xe({type:nn.SetDroppableDisabled,id:we,key:me,disabled:he}),Ze.current.disabled=he)},[we,me,he,xe]),{active:de,rect:Ge,isOver:Le?.id===we,node:Se,over:Le,setNodeRef:te}}({id:i,data:y,disabled:b.droppable,resizeObserverConfig:{updateMeasurementsFor:_,...a}}),{active:I,activatorEvent:A,activeNodeRect:M,attributes:k,setNodeRef:F,listeners:L,isDragging:N,over:D,setActivatorNodeRef:O,transform:H}=WE({id:i,data:y,attributes:{...aR,...t},disabled:b.draggable}),z=function(){for(var fe=arguments.length,ye=new Array(fe),he=0;he<fe;he++)ye[he]=arguments[he];return T.useMemo(()=>we=>{ye.forEach(be=>be(we))},ye)}(R,F),j=!!I,q=j&&!g&&Gl(h)&&Gl(p),P=!w&&N,U=P&&q?H:null,ne=q?U??(l??S)({rects:m,activeNodeRect:M,activeIndex:h,overIndex:p,index:v}):null,ee=Gl(h)&&Gl(p)?o({id:i,items:u,activeIndex:h,overIndex:p}):v,ve=I?.id,le=T.useRef({activeId:ve,items:u,newIndex:ee,containerId:d}),Ce=u!==le.current.items,re=e({active:I,containerId:d,isDragging:N,isSorting:j,id:i,index:v,items:u,newIndex:le.current.newIndex,previousItems:le.current.items,previousContainerId:le.current.containerId,transition:c,wasDragging:le.current.activeId!=null}),ae=function(fe){let{disabled:ye,index:he,node:we,rect:be}=fe;const[me,de]=T.useState(null),xe=T.useRef(he);return or(()=>{if(!ye&&he!==xe.current&&we.current){const Le=be.current;if(Le){const W=Fs(we.current,{ignoreTransform:!0}),Ze={x:Le.left-W.left,y:Le.top-W.top,scaleX:Le.width/W.width,scaleY:Le.height/W.height};(Ze.x||Ze.y)&&de(Ze)}}he!==xe.current&&(xe.current=he)},[ye,he,we,be]),T.useEffect(()=>{me&&de(null)},[me]),me}({disabled:!re,index:v,node:E,rect:C});return T.useEffect(()=>{j&&le.current.newIndex!==ee&&(le.current.newIndex=ee),d!==le.current.containerId&&(le.current.containerId=d),u!==le.current.items&&(le.current.items=u)},[j,ee,d,u]),T.useEffect(()=>{if(ve===le.current.activeId)return;if(ve!=null&&le.current.activeId==null)return void(le.current.activeId=ve);const fe=setTimeout(()=>{le.current.activeId=ve},50);return()=>clearTimeout(fe)},[ve]),{active:I,activeIndex:h,attributes:k,data:y,rect:C,index:v,newIndex:ee,items:u,isOver:x,isSorting:j,isDragging:N,listeners:L,node:E,overIndex:p,over:D,setNodeRef:z,setActivatorNodeRef:O,setDroppableNodeRef:R,setDraggableNodeRef:F,transform:ae??ne,transition:function(){if(ae||Ce&&le.current.newIndex===v)return lR;if(!(P&&!hc(A)||!c)&&(j||re))return No.Transition.toString({...c,property:CS})}()}}function Ya(s){if(!s)return!1;const e=s.data.current;return!!(e&&"sortable"in e&&typeof e.sortable=="object"&&"containerId"in e.sortable&&"items"in e.sortable&&"index"in e.sortable)}const uR=[bt.Down,bt.Right,bt.Up,bt.Left],dR=(s,e)=>{let{context:{active:t,collisionRect:n,droppableRects:r,droppableContainers:o,over:i,scrollableAncestors:l}}=e;if(uR.includes(s.code)){if(s.preventDefault(),!t||!n)return;const a=[];o.getEnabled().forEach(d=>{if(!d||d!=null&&d.disabled)return;const h=r.get(d.id);if(h)switch(s.code){case bt.Down:n.top<h.top&&a.push(d);break;case bt.Up:n.top>h.top&&a.push(d);break;case bt.Left:n.left>h.left&&a.push(d);break;case bt.Right:n.left<h.left&&a.push(d)}});const c=(d=>{let{collisionRect:h,droppableRects:f,droppableContainers:g}=d;const m=ap(h),p=[];for(const w of g){const{id:S}=w,b=f.get(S);if(b){const v=ap(b),y=m.reduce((C,E,x)=>C+eS(v[x],E),0),_=Number((y/4).toFixed(4));p.push({id:S,data:{droppableContainer:w,value:_}})}}return p.sort(tS)})({collisionRect:n,droppableRects:r,droppableContainers:a});let u=nS(c,"id");if(u===i?.id&&c.length>1&&(u=c[1].id),u!=null){const d=o.get(t.id),h=o.get(u),f=h?r.get(h.id):null,g=h?.node.current;if(g&&f&&d&&h){const m=gc(g).some((v,y)=>l[y]!==v),p=Cp(d,h),w=function(v,y){return!Ya(v)||!Ya(y)||!Cp(v,y)?!1:v.data.current.sortable.index<y.data.current.sortable.index}(d,h),S=m||!p?{x:0,y:0}:{x:w?n.width-f.width:0,y:w?n.height-f.height:0},b={x:f.left,y:f.top};return S.x&&S.y?b:qi(b,S)}}}};function Cp(s,e){return!(!Ya(s)||!Ya(e))&&s.data.current.sortable.containerId===e.data.current.sortable.containerId}const hR=s=>{let{transform:e}=s;return{...e,y:0}},gR=T.memo(T.forwardRef((s,e)=>{const{children:t,style:n,className:r,index:o,editing:i,editable:l,selectedIndex:a,background:c,activeColor:u,borderColor:d,borderWidth:h,dragging:f,...g}=s;return ge.jsxs("div",{ref:e,className:Nn(r),style:{...n,display:"flex",flexDirection:"column",background:a===o?"white":c,minHeight:"0px",fontFamily:"inherit",fontSize:"16px",fontWeight:a===o?"700":"400",lineHeight:"1",letterSpacing:"0px",textTransform:"none",minWidth:"unset"},...g,children:[ge.jsxs("div",{style:{flex:"1 1 100%",display:"flex",flexDirection:"row"},children:[ge.jsx("div",{style:{marginLeft:a===o?"0px":"-1px",marginTop:a===o?"0px":"4px",marginBottom:"0px",background:"grey",minWidth:"1px"}}),t,a===o?ge.jsx("div",{style:{marginLeft:"0px",marginTop:"0px",marginBottom:"0px",background:"grey",minWidth:"1px"}}):ge.jsx(ge.Fragment,{})]}),ge.jsx("div",{style:{flex:"1 1 100%",background:a===o&&u?u?.toCSS():"none",minHeight:"2px"}})]})})),tr={Wrapper:"_Wrapper_1wyun_25",fadeIn:"_fadeIn_1wyun_33",dragOverlay:"_dragOverlay_1wyun_37",Item:"_Item_1wyun_47",withHandle:"_withHandle_1wyun_61",dragging:"_dragging_1wyun_66",disabled:"_disabled_1wyun_74"},xS=ut.memo(ut.forwardRef(({color:s,dragOverlay:e,dragging:t,disabled:n,fadeIn:r,handle:o,height:i,index:l,listeners:a,onRemove:c,renderItem:u,sorting:d,style:h,transition:f,transform:g,value:m,wrapperStyle:p,...w},S)=>{T.useEffect(()=>{if(e)return document.body.style.cursor="grabbing",()=>{document.body.style.cursor=""}},[e]);const b=u?u({dragOverlay:!!e,dragging:!!t,sorting:!!d,index:l,fadeIn:!!r,listeners:a,ref:S,style:h,transform:g,transition:f,value:m}):ge.jsx(ge.Fragment,{children:m});return ge.jsx("div",{className:Nn("tab-item",tr.Wrapper,r&&tr.fadeIn,d&&tr.sorting,e&&tr.dragOverlay),style:{...p,transition:[f,p?.transition].filter(Boolean).join(", "),"--translate-x":g?`${Math.round(g.x)}px`:void 0,"--translate-y":g?`${Math.round(g.y)}px`:void 0,"--scale-x":g?.scaleX?`${g.scaleX}`:void 0,"--scale-y":g?.scaleY?`${g.scaleY}`:void 0,"--index":l},ref:S,children:ge.jsx("div",{className:Nn(tr.Item,t&&tr.dragging,o&&tr.withHandle,e&&tr.dragOverlay,n&&tr.disabled,s&&tr.color,"dragging"),style:h,"data-cypress":"draggable-item",...o?void 0:a,...w,tabIndex:o?void 0:-1,children:b})})})),xp={Row:"_Row_1kr10_1"},fR=T.memo(T.forwardRef(({children:s,horizontal:e,style:t},n)=>ge.jsx("div",{ref:n,style:{...t},className:Nn(xp.Row,e&&xp.horizontal),children:s}))),mR={...yS},pR=T.memo(T.forwardRef((s,e)=>{const{className:t,activationConstraint:n,animateLayoutChanges:r,adjustScale:o=!1,collisionDetection:i=SE,coordinateGetter:l=dR,dropAnimation:a=mR,getItemStyles:c=()=>({}),getNewIndex:u,handle:d=!1,items:h,onMove:f,isDisabled:g=()=>!1,measuring:m,modifiers:p,renderItem:w,renderDivider:S,reorderItems:b=wh,strategy:v=Sh,style:y,useDragOverlay:_=!0,onDragStart:C,wrapperStyle:E=()=>({})}=s,[x,R]=T.useState(()=>h);T.useEffect(()=>{R(h)},[h]);const[I,A]=T.useState(null),M=function(){for(var D=arguments.length,O=new Array(D),H=0;H<D;H++)O[H]=arguments[H];return T.useMemo(()=>[...O].filter(z=>z!=null),[...O])}(Wu(gS,{activationConstraint:n}),Wu(fS,{activationConstraint:n}),Wu(mh,{scrollBehavior:"Cypress"in window?"auto":void 0,coordinateGetter:l})),k=x.indexOf.bind(x),F=I?k(I):-1,L=[];x.map((D,O)=>{L.push(ge.jsx(wR,{id:D,handle:d,index:O,style:c,wrapperStyle:E,disabled:g(D),renderItem:w,animateLayoutChanges:r,useDragOverlay:_,getNewIndex:u},D+"-"+O));const H=S?.({key:"divider-"+O});H&&L.push(H)});const{getPortalContainer:N}=VS();return ge.jsxs($E,{sensors:M,collisionDetection:i,onDragStart:D=>{const{active:O}=D;O&&(C?.(D),A(O.id))},autoScroll:{canScroll:D=>!0},onDragEnd:D=>{if(A(null),D.over){const O=k(D.over.id);F!==O&&(R(H=>b(H,F,O)),f?.(F,O))}},onDragCancel:()=>{A(null)},measuring:m,modifiers:p,children:[ge.jsx("div",{style:{display:"flex",justifyContent:"flex-start",boxSizing:"border-box",...y},className:Nn(t,tr.Wrapper),children:ge.jsx(rR,{items:x,strategy:v,children:ge.jsx(fR,{ref:e,children:L})})}),_?Eo.createPortal(ge.jsx(eR,{adjustScale:o,dropAnimation:a,children:I?ge.jsx(xS,{value:x[F],handle:d,renderItem:w,wrapperStyle:E({index:F,isDragging:!0,id:x[F]}),index:F,dragging:!0,style:c({id:x[F],index:F,isSorting:I!==null,isDragging:!0,overIndex:-1,isDragOverlay:!0}),dragOverlay:!0}):null}),N()):null]})}));function wR({disabled:s,animateLayoutChanges:e,getNewIndex:t,handle:n,id:r,index:o,onRemove:i,style:l,renderItem:a,useDragOverlay:c,wrapperStyle:u}){const{attributes:d,isDragging:h,isSorting:f,listeners:g,overIndex:m,setNodeRef:p,transform:w,transition:S}=cR({id:r,animateLayoutChanges:e,disabled:s,getNewIndex:t});return ge.jsx(xS,{ref:p,value:r,disabled:s,dragging:h,sorting:f,handle:n,renderItem:a,index:o,style:l({index:o,id:r,isDragging:h,isSorting:f,overIndex:m}),onRemove:i?()=>i(r):void 0,transform:w,transition:S,wrapperStyle:u({index:o,isDragging:h,id:r}),listeners:g,"data-index":o,"data-id":r,dragOverlay:!c&&h,...d})}const SR="_TabStrip_3x0dp_1",_R=new $t("rgb(33, 115, 70)"),yR="#eee",bR=s=>ge.jsx(gR,{...s}),vR=T.memo(T.forwardRef((s,e)=>{const{children:t,style:n,className:r,selectedTabIndex:o=0,tabNames:i=[],onSelectedTabIndexChange:l,onTabNameChange:a,onTabMove:c,createScrollStartButton:u=BS,createScrollEndButton:d=zS,createScrollEdgeButton:h=PS,createTabButton:f=bR,createTabDivider:g,editLabelProps:m,disabled:p=!1,disableDrag:w=!1,background:S="white",activeColor:b=_R,borderColor:v=yR,borderWidth:y=1}=s,[_,C]=T.useState(o),[E,x]=T.useState(i),R=T.useCallback(me=>{const de=N.current?.[me]?.closest(".tab-item")??N.current?.[me];de&&P.current?.scrollTo({top:de.offsetTop,left:de.offsetLeft,behavior:"smooth"})},[]);T.useEffect(()=>{R(o)},[o]);const I=T.useCallback((me,de)=>{de!==_&&(C(de),l?.(de)),R(de)},[l,_]),A=T.useCallback((me,de)=>{c?.(me,de)},[c]),M=T.useRef(null),[k,F]=T.useState(-1),L=T.useCallback((me,de)=>{a?.(me,de)},[a]);T.useLayoutEffect(()=>{C(o)},[o]),T.useLayoutEffect(()=>{x(i)},[i]);const N=T.useRef([]),D=T.useRef(null);T.useImperativeHandle(e,()=>Object.assign({startEdit(me){N.current?.[me]?.startEdit()},cancel(me){N.current?.[me]?.cancel()}},D.current),[_,k]);const O=T.useCallback(({value:me,index:de,dragging:xe})=>{const{style:Le,maxLength:W,...Ze}=m||{},Xe=ge.jsx(aE,{ref:Ge=>{N.current[de]=Ge},value:me,disabled:p,maxLength:W,style:{color:_===de&&b?b?.toRGBA().toString():"inherit",flex:"1 1 100%",paddingTop:"1px",paddingBottom:"1px",...Le},styleHover:{},onSubmit:Ge=>(M.current=!1,F(-1),L(de,Ge)),onCancel:()=>{M.current=!1,F(-1)},onChange:Ge=>{M.current=!0,F(de)},...Ze});return f({onClick:Ge=>I(Ge,de),value:me,index:de,editing:k===de&&M.current,editable:!0,disabled:p,selectedIndex:_,background:S,activeColor:b,borderColor:v,borderWidth:y,dragging:xe,children:Xe})},[_,L,I,m,p,k,f]),[H,{width:z}]=ko(),[j,{width:q}]=ko(),P=T.useRef(null),[U,ne]=T.useState({left:0,top:0,width:0,height:0}),[ee,ve]=T.useState(null);T.useEffect(()=>{ee!==null&&P.current&&P.current.scrollTo({left:ee,behavior:"smooth"})},[ee]);const le=T.useCallback((me,de=!1)=>{if(!P.current)return 0;let xe=P.current.firstChild.getBoundingClientRect(),Le=P.current.firstChild.firstChild.children,W=0;return W=de?0:xh.getScrollTo(me,xe.left,Le,!0,Math.max(0,me-200)),ve(W),Math.max(0,W)},[]),Ce=T.useCallback((me,de=!1)=>{if(!P.current)return 0;let xe=P.current.firstChild.getBoundingClientRect(),Le=P.current.firstChild.firstChild.children,W=0;const Ze=Math.ceil(q-z);return W=de?Ze:xh.getScrollTo(me,xe.left,Le,!1,Math.max(0,me+200)),ve(W),Math.min(Ze,W)},[q,z]),re=T.useRef(null),ae=T.useRef(null),fe=T.useCallback(()=>{ae.current&&(clearTimeout(ae.current),ae.current=null,re.current=null)},[]),ye=T.useCallback((me,de,xe=260)=>{re.current=me,ae.current=setTimeout(()=>{const Le=de?le(re.current||me):Ce(re.current||me);Le!==re.current?ye(Le,de,120):fe()},xe)},[le,Ce,fe]);T.useEffect(()=>()=>fe(),[fe]);const he=T.useMemo(()=>({style:{marginLeft:"4px",marginRight:"6px"},disabled:Math.floor(U.left)<=0||Math.floor(q-z)===0,orientation:vo.Horizontal,onMouseUp:fe,onMouseLeave:fe,onMouseDown:()=>ye(P.current.scrollLeft,!0),onClick:me=>le(Math.min(P.current.scrollLeft,ee??Number.MAX_SAFE_INTEGER),me.ctrlKey)}),[U,ee,q,z]),we=T.useMemo(()=>({style:{marginLeft:"6px",marginRight:"4px"},disabled:Math.floor(q-z)<=Math.ceil(U.left),orientation:vo.Horizontal,onMouseUp:fe,onMouseLeave:fe,onMouseDown:()=>ye(P.current.scrollLeft,!1),onClick:me=>Ce(Math.max(P.current.scrollLeft,ee??0),me.ctrlKey)}),[U,ee,q,z]),be=T.useMemo(()=>ge.jsxs(ge.Fragment,{children:[ge.jsx("div",{style:{minWidth:"16px"}}),t,h?.(he)]}),[he,we,u,d,t,h]);return ge.jsxs("div",{style:{...n,display:"flex",alignItems:"stretch"},className:Nn(SR,r),ref:D,children:[ge.jsx("div",{style:{borderTop:`solid ${v} ${y}px`,position:"absolute",width:"100%"}}),ge.jsx("div",{style:{flex:"none",display:"flex",alignItems:"center"},children:be}),ge.jsx("div",{className:"Tabs",ref:H,style:{flex:"1 1 100%",display:"flex",position:"relative",overflow:"hidden"},children:ge.jsx("div",{style:{position:"relative",overflowY:"hidden",overflowX:"hidden",marginBottom:"3px"},ref:P,onScroll:me=>{ne({left:me.target.scrollLeft,top:me.target.scrollTop,width:me.target.scrollWidth,height:me.target.scrollHeight})},children:ge.jsx(pR,{isDisabled:me=>p||w,items:E,strategy:nR,modifiers:[hR],ref:j,renderItem:O,renderDivider:g,onMove:A,activationConstraint:{distance:15}})})}),ge.jsx("div",{style:{flex:"none",display:"flex",alignItems:"center"},children:h(we)})]})}));vR.displayName="TabStrip";const ZR=s=>ge.jsxs("svg",{...s,viewBox:"0 0 48 48",children:[ge.jsx("path",{d:"M 2.2827924,0 C 1.5038324,0 0.87090248,0.52603 0.87090248,1.17149 v 25.39667 h -0.01 v 20.2607 c 0,0.39663 0.24025002,0.74639 0.60481992,0.95852 v 0.18499 h 0.50664 c 0.0972,0.0173 0.19732,0.0276 0.30092,0.0276 h 15.5346916 16.7448 v 0 h 11.35822 c 0.10311,0 0.20276,-0.0104 0.29945,-0.0276 h 0.0696 v -0.0182 c 0.59938,-0.13566 1.04238,-0.58606 1.04238,-1.12526 V 26.96484 c 0.006,-0.0429 0.009,-0.0853 0.009,-0.12925 V 1.17154 c 0,-0.64586 -0.63293,-1.17149 -1.41189,-1.17149 h -15.7478 v 2e-4 h -2.06997 V 5e-5 Z",fill:"#547DBE"}),ge.jsx("path",{d:"m 2.8338324,2.7184 v 9.0404 H 11.538484 V 2.7184 Z m 11.2334116,0 v 9.0404 h 8.70465 V 2.7184 Z m 11.26696,0 v 9.0404 h 8.70465 V 2.7184 Z m 11.33258,0 v 9.0404 h 8.70465 V 2.7184 Z M 2.8338324,14.32723 v 8.84046 h 8.7046516 v -8.84046 z m 11.2334116,0 v 8.84046 h 8.70465 v -8.84046 z m 11.26696,0 v 8.84046 h 8.70465 v -8.84046 z m 11.33258,0 v 8.84046 h 8.70465 V 14.32723 Z M 2.8338324,25.73691 v 8.67308 h 8.7046516 v -8.67308 z m 11.2334116,0 v 8.67308 h 8.73721 v -8.67308 z m 11.26696,0 v 8.67308 h 8.70465 v -8.67308 z m 11.33258,0 v 8.67308 h 8.70465 V 25.73691 Z M 2.8693424,36.61859 v 8.67357 h 8.7046616 v -8.67357 z m 11.2339116,0 v 8.67357 h 8.73771 v -8.67357 z m 11.26697,0 v 8.67357 h 8.70465 v -8.67357 z m 11.33257,0 v 8.67357 h 8.70465 v -8.67357 z",fill:"#FFFFFF"}),ge.jsx("path",{d:"m 2.8254424,2.72091 v 9.04041 H 11.570544 V 2.72091 Z m 0,11.60889 v 8.84036 H 11.570544 V 14.3298 Z m 0,11.40958 v 8.67357 h 8.7451016 v -8.67357 z m 0.036,10.88167 v 8.67358 h 8.7451116 v -8.67358 z",fill:"#547DBE",fillOpacity:"0.4"}),ge.jsx("path",{d:"m 30.820434,6.19497 c 1.85291,0 3.66241,0.29708 5.4285,0.89113 1.7656,0.5942 3.49568,1.50108 5.19073,2.72107 l -2.37584,3.25571 c -1.40941,-1.01391 -2.79515,-1.76647 -4.15721,-2.25759 -1.36206,-0.49111 -2.72412,-0.73667 -4.08618,-0.73667 -2.5817,0 -4.58902,0.53064 -6.02232,1.59218 -1.43334,1.06143 -2.14989,2.56661 -2.14989,4.51523 v 0.0237 c 0,1.36241 0.41177,2.40021 1.23532,3.11315 0.82355,0.71288 1.89253,1.24367 3.20703,1.59217 1.31446,0.3485 2.71608,0.67341 4.20493,0.97439 1.29842,0.26929 2.58944,0.58216 3.87257,0.9386 1.28263,0.3565 2.45032,0.8635 3.50356,1.52097 1.05324,0.65747 1.89288,1.5486 2.51841,2.6734 0.62553,1.12485 0.93829,2.59035 0.93829,4.39635 v 0.0477 c 0,3.18435 -1.10849,5.64817 -3.32597,7.39066 -2.21698,1.7425 -5.33724,2.61399 -9.35978,2.61399 -1.67882,0 -3.25863,-0.15841 -4.73958,-0.47523 -1.4808,-0.31681 -2.86644,-0.79204 -4.15737,-1.42617 -1.29077,-0.63363 -2.49827,-1.42567 -3.6227,-2.37612 l 2.54179,-3.20819 c 1.39383,1.204 2.91819,2.10717 4.57323,2.70928 1.6549,0.60205 3.45641,0.90307 5.40463,0.90307 2.73991,0 4.85823,-0.52704 6.35447,-1.58048 1.49674,-1.05359 2.24511,-2.53098 2.24511,-4.43213 v -0.0237 c 0,-1.37834 -0.37197,-2.43583 -1.11639,-3.17245 -0.74442,-0.73668 -1.71824,-1.2912 -2.92194,-1.66359 -1.2037,-0.37223 -2.51051,-0.6851 -3.91993,-0.9386 -1.34627,-0.23762 -2.69635,-0.51485 -4.05046,-0.83182 -1.35417,-0.31677 -2.59339,-0.7841 -3.71782,-1.40204 -1.12448,-0.61779 -2.03125,-1.49708 -2.72017,-2.63782 -0.68898,-1.14078 -1.03341,-2.66156 -1.03341,-4.5627 v -0.0237 c 0,-3.21623 1.06898,-5.70753 3.20718,-7.47386 2.13805,-1.76648 5.15506,-2.64981 9.05121,-2.64981 z",strokeWidth:"2.5",stroke:"#EB594D",fill:"#f9CECB"})]}),_h=T.createContext(null);_h.displayName="DocThemesContext";const YR=s=>{const{themes:e,children:t}=s;return ge.jsx(_h.Provider,{value:e,children:t})},QR=()=>{const s=T.useContext(_h),[e]=T.useState(()=>new Qd);return T.useMemo(()=>s||e,[s])},CR="_script-editor_iy654_5",xR=ut.lazy(()=>ao(()=>import("./DkcoDi-4aZ6TgzgC-DJnLMZ8t.js"),__vite__mapDeps([12,4,1]),import.meta.url)),ER={lightbulb:{enabled:!1},tabSize:2,acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",accessibilitySupport:"auto",automaticLayout:!0,autoIndent:!1,codeLens:!0,colorDecorators:!0,contextmenu:!0,cursorBlinking:"blink",cursorSmoothCaretAnimation:!1,cursorStyle:"line",disableLayerHinting:!1,disableMonospaceOptimizations:!1,dragAndDrop:!0,glyphMargin:!0,fixedOverflowWidgets:!1,folding:!0,foldingStrategy:"auto",fontLigatures:!1,formatOnPaste:!0,formatOnType:!1,hideCursorInOverviewRuler:!1,highlightActiveIndentGuide:!0,links:!0,lineDecorationsWidth:8,lineNumbersMinChars:3,mouseWheelZoom:!1,multiCursorMergeOverlapping:!0,multiCursorModifier:"alt",overviewRulerBorder:!0,overviewRulerLanes:2,quickSuggestions:!0,quickSuggestionsDelay:100,readOnly:!1,renderControlCharacters:!1,renderFinalNewline:!0,renderIndentGuides:!0,renderLineHighlight:"all",renderWhitespace:"none",revealHorizontalRightPadding:30,roundedSelection:!0,rulers:[],scrollBeyondLastColumn:5,scrollBeyondLastLine:!0,selectOnLineNumbers:!0,selectionClipboard:!0,selectionHighlight:!0,showLightbulbIconMode:!1,showFoldingControls:"mouseover",smoothScrolling:!0,suggestOnTriggerCharacters:!0,wordBasedSuggestions:!0,wordSeparators:`~!@#$%^&*()-=+[{]}|;:'",.<>/?`,wordWrap:"off",wordWrapBreakAfterCharacters:"	})]?|&,;",wordWrapBreakBeforeCharacters:"{([+",wordWrapBreakObtrusiveCharacters:".",wordWrapColumn:80,wordWrapMinified:!0,wrappingIndent:"none"};let di,hi,Kr=["define","require"];const Ep=async(s,e,t)=>{const n=s.getModel();if(!n)return;const r=await e.languages.typescript.getTypeScriptWorker(),o=await r(n.uri),i=await o.getNavigationTree(n.uri.toString()),l=s.getPosition();let a={...l};a.lineNumber=1,a.column=1;let c=!1;for(let m=l.lineNumber;m>=1;m--)if(n.getLineContent(m).trim()===""){const p=yh(i,n.getOffsetAt({lineNumber:m,column:1}),"function");if(!p||IR(p)){c=!0,a.lineNumber=m+1;break}{const w=p.spans[0].start;m=n.getPositionAt(w).lineNumber,a.lineNumber=m}}let u=t,d=!1;!c&&!u.startsWith(`
`)&&a.lineNumber>1&&(u=`
`+u,d=!0);let h=!1;n.getLineCount()>1&&(u.endsWith(`

`)||(u+=`

`,h=!0));const f=[{range:new e.Range(a.lineNumber,a.column,a.lineNumber,a.column),text:`${u}`}];let g=null;n.pushEditOperations([],f,m=>(g=m[0].range,d&&g.startLineNumber++,h&&g.endLineNumber--,[new e.Selection(g.startLineNumber,g.startColumn,g.endLineNumber,g.endColumn)])),s.setSelection({startLineNumber:g.endLineNumber,startColumn:g.endColumn,endLineNumber:g.startLineNumber,endColumn:g.startColumn})};function RR(s,e){let t=null;for(let n=0;!t&&n<s.length;n++){const r=s[n];r.getName()===e.text&&(t=r)}return t?t.getContext():"formula"}function $d(s,e,t,n,r=[]){if(n.kind==="function"&&n.kindModifiers==="export"){const o=n.spans[0].start,i=s.getPositionAt(o);r.push({name:n.text,type:RR(t,n),lineNumber:i.lineNumber})}if(n.childItems)for(const o of n.childItems)$d(s,e,t,o,r);return r}function yh(s,e,t="function",n){const r=s.spans;for(let o=0;o<r.length;o++){const i=r[o];if(i.start<=e&&e<i.start+i.length){if(s.kind===t&&(!n||s.kindModifiers===n))return s;for(const l of s.childItems||[]){const a=yh(l,e,t,n);if(a)return a}}return null}}function IR(s){return s.kind==="comment"}const e2=T.memo(T.forwardRef((s,e)=>{const{className:t,style:n,commands:r,readOnly:o=!1,onClose:i,darkMode:l,loadingPanel:a,autoFocus:c=!0,onStatusChange:u,...d}=s,h=T.useRef(null),f=Fe(i,[i]),g=T.useRef(!1),m=T.useMemo(()=>({contains(O){if(!h.current)return;const H=h.current.editor;return H&&H.getDomNode()?.contains(O)},focus(){if(!h.current)return;const O=h.current.editor;return O&&O.getDomNode()?.focus()}}),[]),p=T.useMemo(()=>[new Ee("help",m,{label:"Script Commands",description:"Open Editor Commands",shortcut:{key:"F1"}},()=>{})],[]),w=T.useMemo(()=>{let O=null;const H=()=>m;return O=r?r.createChildGroup(H,"scriptEditor",!1):new Qa(H,"scriptEditor"),O.addCommands(p,!0),O},[r,p]),S=Mp(w,["executeSelectedScript"])[0],b=S?.context(),v=Fe(O=>{S?.execute(O)},[S]),y=T.useRef(""),[_,C]=T.useState(!1),E=Fe(async()=>{if(!h.current)return null;const O=h.current,H=O.editor;if(!H)return null;const z=O.monaco,j=await(async(q,P,U="export")=>{const ne=q.getModel();if(!ne)return null;const ee=await P.languages.typescript.getTypeScriptWorker(),ve=await ee(ne.uri),le=await ve.getNavigationTree(ne.uri.toString());let Ce=null,re=q.getSelection();const ae=re.startLineNumber===re.endLineNumber&&re.startColumn===re.endColumn?ne.getLineCount():Math.min(re.endLineNumber,ne.getLineCount());for(let fe=re.startLineNumber;!Ce&&fe<=ae;fe++){const ye=yh(le,ne.getOffsetAt({lineNumber:fe,column:1}),"function",U);ye&&(Ce=ye.text)}return Ce})(H,z);return u?.({message:(j??"").toUpperCase()}),j?{source:H.getValue(),name:j}:null},[u]),x=Fe(async(O,H,z)=>{const j=await b.getScripts().createModule({source:z?.getValue(),declarationsOnly:!0}),q=j?j.getFunctions().getItems():V.EmptyArray;j&&(async function(P,U){const ne=[];for(let ee=1;ee<P.getLineCount()+1;ee++){const ve={startLineNumber:ee,startColumn:1,endLineNumber:ee,endColumn:P.getLineLength(ee)+1},le=P.getValueInRange(ve).indexOf("modelt");le!==-1&&ne.push({message:"found 'modelt'",resource:"https://www.sheetxl.com",severity:U.MarkerSeverity.Hint,startLineNumber:ve.startLineNumber,startColumn:le+1,endLineNumber:ve.startLineNumber,endColumn:le+5})}U.editor.setModelMarkers(P,"owner",ne)}(O,H),async function(P,U,ne,ee){const ve=await U.languages.typescript.getTypeScriptWorker(),le=await ve(P.uri),Ce=await le.getNavigationTree(P.uri.toString()),re=$d(P,U,ee,Ce).map(ae=>{let fe=null,ye=null;return ae.type==="formula"?(fe="formula.margin-icon",ye="Formula"):ae.type==="macro"?(fe="macro.margin-icon",ye="Macro"):ae.type==="autoRun"&&(fe="autorun.margin-icon",ye="Auto Run"),{range:new U.Range(ae.lineNumber,1,ae.lineNumber,1),options:{isWholeLine:!1,glyphMarginClassName:fe,glyphMarginHoverMessage:{value:ye},stickiness:U.editor.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}}});k.current&&k.current.clear(),k.current=ne.createDecorationsCollection(re)}(O,H,z,q))},[b]),R=Fe(V.debounce(x,580),[]),I=Fe(async(O=void 0)=>{if(!h.current||!b)return;const H=h.current.editor.getPosition(),z={cursor:H?H.toString():""};O!==void 0&&(z.message=O),u?.(z);const j=E();b.setSelectedFunction(j)},[b,u]),A=T.useRef(null);T.useEffect(()=>{if(!b)return;const O={insertSnippet:z=>{h.current?.editor&&(_?Ep(h.current.editor,h.current.monaco,z):y.current=z)}};b.setEditor(O),b.setSelectedFunction(E());const H=b.addContainerListener({onBeforeSave:async()=>{if(!h.current?.editor||!b)return;const z=h.current.editor,j=b?.getScripts().getModules().getByName("scripting"),q=j?.getSource(),P=z.getValue();if(!((q?.length??0)!==P.length||q!==P))return;await b.saveSource(z.getValue());const U=(q?.length??0)!==P.length||q!==P;u?.({dirty:U})},onReadonlyChange(){},onScriptChange:async()=>{if(!h.current?.editor||!b)return;const z=h.current.editor,j=b.getScripts().getModules().getItems()[0]?.getSource()??"";z.setValue(j)}});return()=>{H(),b.setSelectedFunction(null),b.setEditor(null);const z=A.current;if(z){z.dispose();const j=z.debounceTimer;j!==void 0&&clearTimeout(j),A.current=null}}},[b,_]),T.useEffect(()=>()=>{if(!h.current?.editor)return;const O=h.current.editor;b?.saveSource(O.getValue())},[]);const M=Fe(O=>{const H=h.current;if(!H)return!1;const z=H.editor;return!!z&&(z.focus(),!0)},[]),k=T.useRef(null),F=Fe((O,H)=>{h.current={monaco:H,editor:O},C(!0),I("Loading Types");const z=b.getScripts().getModules().getItems()[0]?.getSource()??"";O.setValue(z),ao(()=>import("./BC91Htcrvw2he2mK-D4GG8lJP.js"),[],import.meta.url).then(q=>q.c).then(async q=>{I(""),q.AutoTypings.create(O,{shareCache:!0,dontAdaptEditorOptions:!0,monaco:H,onUpdate:(P,U)=>{if(P.type==="LookedUpPackage"&&P.success!==void 0){const ne=H.languages.typescript.typescriptDefaults.getDiagnosticsOptions();H.languages.typescript.typescriptDefaults.setDiagnosticsOptions({...ne,diagnosticCodesToIgnore:[]})}},onError:P=>{P==="Not implemented yet"&&(P="Compile Errors"),console.warn("Error compiling types",P)}}).then(P=>{A.current=P;const U=O.getModel();R(U,H,O)})}),O.addCommand("executeScript",function(q,...P){P?.[0]&&v({functionName:P?.[0]})},""),O.addAction({id:"executeScript",label:"Execute",keybindings:[H.KeyCode.F8],run:async q=>{const P=E();b.setSelectedFunction(P);const U=await P;v(U)}}),O.addAction({id:"saveScript",label:"Save Script",keybindings:[H.KeyMod.CtrlCmd|H.KeyCode.KeyS],run:q=>{b?.saveSource(O.getValue()).then(()=>{const P=b?.getScripts().getModules().getByName("scripting"),U=P?.getSource(),ne=O.getValue(),ee=(U?.length??0)!==ne.length||U!==ne;u?.({dirty:ee})})}}),O.onMouseDown(async q=>{if(q.target.type===H.editor.MouseTargetType.GUTTER_GLYPH_MARGIN){const P=q.target.position.lineNumber,U=await H.languages.typescript.getTypeScriptWorker(),ne=await U(j.uri),ee=await ne.getNavigationTree(j.uri.toString()),ve=O?.getValue(),le=(await b?.saveSource(ve)).getFunctions().getItems(),Ce=$d(j,H,le,ee).find(re=>re.lineNumber===P);if(Ce){const re=q.event.browserEvent.button;re===0?Ce.type==="macro"||Ce.type==="autoRun"?v({functionName:Ce.name}):Ce.type==="formula"&&b.quickInsertFunction?.(Ce.name):re===2&&(console.log("Context menu for function:",Ce.name),q.event.browserEvent.preventDefault())}}}),O.onDidChangeModelContent(()=>{R(j,H,O)}),H.editor.onDidChangeMarkers(q=>{q.some(P=>P.toString()===j.uri.toString())});const j=O.getModel();(function(q,P){P.languages.registerInlayHintsProvider("typescript",{provideInlayHints(U,ne,ee){const ve=[];for(let le=1;le<U.getLineCount()+1;le++){const Ce={startLineNumber:le,startColumn:1,endLineNumber:le,endColumn:U.getLineLength(le)+1},re="hint",ae=U.getValueInRange(Ce).indexOf("hint");ae!==-1&&ve.push({kind:P.languages.InlayHintKind.Type,position:{lineNumber:Ce.startLineNumber,column:ae+re.length+1},label:"[hint]"})}return{hints:ve,dispose:()=>{}}}})})(0,H),j.onDidChangeContent(q=>{const P=b?.getScripts().getModules().getByName("scripting"),U=P?.getSource(),ne=O.getValue(),ee=(U?.length??0)!==ne.length||U!==ne;u?.({dirty:ee})}),O.onDidChangeCursorPosition(q=>{I()})},[b,u]),L=T.useMemo(()=>_?null:a||ge.jsx("div",{style:{position:"absolute",width:"100%",height:"100%"},children:"Loading..."}),[_,a]),N=T.useMemo(()=>{if(!_){if(!di){di={};for(let H=0;H<Kr.length;H++){const z=Kr[H];di[z]=globalThis[z]}}if(hi)for(let H=0;H<Kr.length;H++){const z=Kr[H];globalThis[z]=hi[z]}}const O=b?.getScripts().getModules().getByName("scripting")?.getSource()??"";return ge.jsxs("div",{style:{display:"flex",flex:"1 1 100%",width:"100%",flexDirection:"row",position:"relative",boxSizing:"border-box"},children:[ge.jsx(T.Suspense,{children:ge.jsx(xR,{theme:l?"extended-dark":"extended",options:{...ER,fixedOverflowWidgets:!0,readOnly:o},language:"typescript",value:O,onValidate:H=>{let z=!1;for(let j=0;!z&&j<H?.length;j++)H[j].severity===8&&(z=!0)},beforeMount:H=>{H.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!1,noSyntaxValidation:!1,diagnosticCodesToIgnore:[2307]}),H.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0}),H.editor.defineTheme("extended",{base:"vs",inherit:!0,rules:[],colors:{}}),H.editor.defineTheme("extended-dark",{base:"vs-dark",inherit:!0,rules:[],colors:{}}),(async()=>{let z=!1,j=!1;try{const q=await(async()=>await(await fetch("https://cdn.jsdelivr.net/npm/@sheetxl/sdk/types/scripting.d.ts")).text())(),P=H.Uri.parse('inmemory://model/"sheetxl-models".d.ts');let U=H.editor.getModel(P);U?j=!0:U=H.editor.createModel(q,"typescript",P),H.editor.setModelMarkers(U,"default",[]),z=!0}catch(q){console.warn("cant load types",q)}if(!j){H.languages.registerLinkProvider("*",{provideLinks:(P,U)=>{const ne=[],ee={links:ne},ve=P.getLinesContent();for(let le=1;le<=ve.length;le++){const Ce=ve[le-1],re=H.editor.tokenize(Ce,"typescript");for(let ae=0;ae<re[0].length;ae++){const fe=re[0]?.[ae];if(fe&&fe.type.startsWith("string")){let ye=fe.offset,he=re[0]?.[ae+1]?.offset??Ce.length,we=new H.Range(le,ye+1,le,he+1),be=P.getValueInRange(we);const me=be[0];me!=="`"&&me!=="'"&&me!=='"'||(ye++,be=be.substring(1));const de=be[be.length-1];de!=="`"&&de!=="'"&&de!=='"'||(ye++,be=be.substring(0,be.length-1));try{b.getRanges(be)&&ne.push({range:{endColumn:he,endLineNumber:le,startColumn:ye,startLineNumber:le},tooltip:`Goto range '${be}'`,url:`/range/${be}`})}catch(xe){console.warn(xe)}}}}return ee}}),H.editor.registerLinkOpener({open(P){if(P?.path?.startsWith("/range/")){try{b.getRanges(P.path.substring(7))?.select()}catch(U){console.warn("invalid range",U)}return!0}return!1}});const q=H.languages.typescript.typescriptDefaults.getCompilerOptions();H.languages.typescript.typescriptDefaults.setCompilerOptions({...q,target:H.languages.typescript.ScriptTarget.ES2020,lib:["webworker","es2020","esnext.asynciterable"],downlevelIteration:!0,moduleResolution:H.languages.typescript.ModuleResolutionKind.NodeJs,allowSyntheticDefaultImports:!0,baseUrl:"inmemory://model/",allowNonTsExtensions:!0})}if(y.current&&(await Ep(h.current.editor,h.current.monaco,y.current),y.current=null),g.current&&requestAnimationFrame(async()=>{g.current&&H.editor.focus()}),!hi){hi={};for(let q=0;q<Kr.length;q++){const P=Kr[q];hi[P]=globalThis[P]}}(()=>{const q=(P,U)=>{try{if(U===void 0)try{delete globalThis[P]}catch{try{globalThis[P]=void 0}catch{}}else globalThis[P]=U}catch{}};for(let P=0;P<Kr.length;P++){const U=Kr[P];q(U,di[U])}di=void 0})(),C(!0)})()},onMount:F})}),L]})},[b,w,o,L,l]),D=_r(e,()=>({isScriptEditorElement:()=>!0,focus:O=>{M(O)},close:()=>{f?.()},getEditor:()=>b?.getEditor()}),[b]);return T.useEffect(()=>(c&&requestAnimationFrame(()=>{M()}),()=>{h.current?.editor&&requestAnimationFrame(()=>{D.current?.contains(document.activeElement)&&M()})}),[]),ge.jsx("div",{className:Nn("script-editor",CR,t),style:{display:"flex",flexDirection:"row",flex:"1 1 100%",position:"relative",...n},ref:D,...d,children:N})}));export{qR as $,DC as A,vR as B,sE as C,YR as D,QR as E,T0 as F,XR as G,Qd as H,KR as I,ec as J,ms as K,e2 as L,Me as M,G as N,ZR as O,$1 as P,nr as Q,ft as R,pn as S,dx as T,pe as U,ja as V,hx as W,oe as X,Pv as Y,rc as Z,Kd as _,oE as a,FR as a0,UR as a1,Hg as a2,gx as a3,GR as b,$t as c,cd as d,md as e,LC as f,tl as g,PR as h,Nd as i,lr as j,Vt as k,Rt as l,Sr as m,He as n,Ew as o,At as p,dm as q,ke as r,aC as s,bs as t,Pe as u,Qe as v,B as w,lt as x,JR as y,Jw as z};
